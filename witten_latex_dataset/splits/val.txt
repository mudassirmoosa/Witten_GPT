\documentclass[11pt,a4paper]{article}
\usepackage{cite}
%\usepackage[pdftex]{hyperref}
\usepackage{amsmath, amsthm, amssymb,slashed,upgreek}
%%%
\usepackage{ifpdf}
\ifpdf
  \usepackage[pdftex]{graphicx}
  \usepackage{epstopdf}
\else
  \usepackage[dvips]{graphicx}
\fi
%%%
\textheight 8.5in \textwidth 6.5in \oddsidemargin 0in \topmargin
-.35in
\parskip=\baselineskip
\def\Bbb{\mathbb}
\def\Tr{{\rm Tr}}
\def\16{{\bf 16}}
\def\1{{\bf 1}}
\def\2{{\bf 2}}
\def\3{{\bf 3}}
\def\4{{\bf 4}}
\def\ad{{\mathrm{ad}}}
 \def\Sp{{\mathrm{Sp}}}
 \def\Spin{{\mathrm{Spin}}}
 \def\SU{{\mathrm{SU}}}
 \def\SO{{\mathrm{SO}}}
 \def\frak{\mathfrak}
\def\bar{\overline}
\def\tilde{\widetilde}
\def\R{{\Bbb{R}}}\def\Z{{\Bbb{Z}}}
\def\N{{\mathcal N}}
\def\hat{\widehat}
\font\teneurm=eurm10 \font\seveneurm=eurm7 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
\font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}
\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}
\numberwithin{equation}{section}
\def\neg{\negthinspace}
\def\d{\mathrm d}
\def\C{{\Bbb C}}
\def\Z{{\Bbb Z}}
\def\A{{\mathcal A}}
\def\bar{\overline}
\def\W{{\mathcal W}}
\def\d{{\mathrm d}}
\def\O{{\mathcal O}}
\def\CP{\Bbb{CP}}
\def\R{{\Bbb R}}
\def\CS{{\mathrm {CS}}}
\def\Z{{\Bbb Z}}
\def\eff{{\mathrm{eff}}}
\def\Maxwell{{\mathrm{Maxwell}}}
\def\J{{\mathcal J}}
\def\L{{\mathcal L}}
\def\M{{\mathcal M}}
\def\t{{\mathfrak t}}
\def\A{{\mathcal A}}
\def\ad{{\mathrm{ad}}}
\def\d{{\mathrm d}}
\def\R{{\Bbb R}}
\def\Z{{\Bbb Z}}
\def\C{{\Bbb C}}
\def\Tr{{\mathrm{Tr}}}
\def\H{{\mathcal H}}
\def\t{{\mathfrak t}}
\def\CS{{\mathcal{CS}}}
\def\A{{\mathcal A}}
\def\V{{\mathcal V}}
\def\W{{\mathcal W}}
\def\O{{\mathcal O}}
\def\L{{\mathcal L}}
\def\D{{\mathcal D}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\begin{document}
\begin{titlepage}
\begin{flushright}

\end{flushright}
\vskip 1.5in
\begin{center}
{\bf\Large{Two Lectures On  Gauge Theory}}
{\bf\Large{ and Khovanov Homology}}
\vskip
0.5cm {Edward Witten} \vskip 0.05in {\small{ \textit{School of
Natural Sciences, Institute for Advanced Study}\vskip -.4cm
{\textit{Einstein Drive, Princeton, NJ 08540 USA}}}
}
\end{center}
\vskip 0.5in
\baselineskip 16pt
\begin{abstract} In the first of these two lectures, I use a comparison to symplectic Khovanov homology to motivate the idea that the Jones polynomial
and Khovanov homology of knots
 can be defined by counting the solutions of certain elliptic partial differential equations in 4 or 5 dimensions.  The second lecture is devoted to a description
of the rather unusual boundary conditions by which these equations should be supplemented. An appendix describes some physical background. (Versions of these lectures
have been presented at various institutions including
the Simons Center at Stonybrook, the TSIMF conference center in Sanya, and also  Columbia University and the University of Pennsylvania.)  \end{abstract}
%
\date{March, 2016}
\end{titlepage}
\def\Hom{\mathrm{Hom}}

\def\U{{\mathcal U}}
\section{Lecture One}



    
The first physics-based proposal concerning Khovanov homology of knots was made by Gukov, Vafa, and Schwarz \cite{GVS},
who suggested that vector spaces associated to knots that had been introduced a few years earlier by Ooguri and Vafa \cite{OV} were related to
what appears in Khovanov homology.   
A number of years later, I re-expressed this type of construction in terms of gauge theory and the counting of solutions of PDE's
\cite{Witten}.  That is the story I will describe today.   Several previous lectures are
available  \cite{WittenOne,WittenTwo}  (the second of these may be a better starting point)
and I will take a different approach here.




In any event, the goal is to construct invariants of a knot embedded in $\R^3$ (fig. \ref{Knot}).
 In the simplest version, the invariants will be obtained by simply counting, with signs,
 the solutions of an equation.   The solutions will have an integer-valued\footnote{To be more precise, $P$ takes values in a $\Z$-torsor, rather than being canonically an integer.
 This is related to the framing anomaly of Chern-Simons theory. See Lecture 2.}  topological invariant $P$, 
 and if $a_n$ is the ``number'' (counted algebraically) of solutions with $P=n$,   then the Jones polynomial\footnote{In approaches based on quantum field theory, the natural normalization
 of the Jones polynomial of a knot or link in $\R^3$ is such that the Jones polynomial of the empty link is 1.  (The Jones polynomial is sometimes defined so that it equals 1 for an unknot
 rather than for the empty link.)   We normalize the argument $q$ of the Jones polynomial to be the instanton counting parameter, in a sense that will be explained later.  With
 this choice, the Jones polynomial of the unknot (with standard framing) is $q^{1/2}+q^{-1/2}$ and in general, for a knot with zero framing,  the exponents in eqn. (\ref{generating}) are half-integers.}
 of the knot will be
 \be\label{generating}J(q)=\sum_n a_n q^n. \ee
 
     \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Knot.png}
 \end{center}
\caption{\small  A knot embedded in $\R^3$. \label{Knot}}
\end{figure}
 
 To get Khovanov homology, this situation is supposed to be ``categorified,'' that is, we want for each $n$
 to define a complex of vector spaces whose Euler characteristic is $a_n$.     The only general situation that I know of in which one can naturally
 categorify the counting of solutions of an equation is the case that
 the equation whose solutions we are counting describes the critical points of some Morse function $h$.  We will be in this framework.
 Our
 equations will be partial differential equations or PDE's, so $h$  will be a Morse
 function on an infinite-dimensional space of functions, namely the functions that appear in the PDE.  The categorification will involve a middle-dimensional
 cohomology theory of the function space, analogous to Floer theory.  Let us put this aside
 for a moment and assume we are just trying to describe the  uncategorified theory, that is the Jones polynomial.
 
 The equations whose solutions I claim should be counted to define the Jones polynomial and ultimately Khovanov homology
 might look ad hoc if written down without an explanation of where they come from.    I could have started today's lecture by explaining
 the physical setup, but this might be unhelpful for some.   I decided instead to try a different approach of motivating the equations
by comparing to an established mathematical approach to Khovanov homology, namely symplectic Khovanov homology \cite{SS,Manolescu,AS}.
 
 Going all the way back to the original work of Vaughn Jones \cite{Jones}, most approaches to the Jones polynomial define an invariant
 in terms of some sort of presentation of a knot, for example a projection to a plane -- such as the projection used in drawing fig. \ref{Knot}.
     One defines something
 that is manifestly well-defined and explicitly computable once such a presentation is given.  What one defines is not obviously independent of the knot presentation,
 but turns out to be.   That step is where the magic is.  And there is always  some magic.
 
 An approach based on counting solutions of PDE's has the opposite advantages and drawbacks.  Topological invariance is potentially
 manifest (given certain generalities about elliptic PDE's and assuming compactness is under control), but it may not be clear how to calculate.   The ideal is to have manifest three- or (in the categorified case) four-dimensional symmetry
 together with a method of calculation.  How might this be achieved?
 
 I will suggest how to guess the right equations starting from a knowledge of symplectic Khovanov homology.  But in order to do this, we need
 to know something about a possible strategy to actually 
  count the solutions of an equation.  So I will begin by explaining what we would  do if we knew which equations we want
  to analyze, and this will help us in guessing the equations.
 
      \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{LongKnot.png}
 \end{center}
\caption{\small  A knot embedded in $\R^3$ and stretched in one direction. \label{longknot}}
\end{figure}
 There is a standard strategy, applicable to the present problem, for trying to count solutions of a PDE under suitable conditions.
 The original version was  the Atiyah-Floer conjecture concerning Floer homology of a three-manifold \cite{AtiyahFloer}.
Adapting their approach to the present problem, the idea is to stretch a knot in one direction, say the $u$ direction, as in fig. \ref{longknot}.
  Then one wants it to be the case that except near the ends, the solutions are independent of $u$. 
   This is not automatically the case and in \cite{GaiWit}, where this strategy was followed for the present problem, it was necessary to make a perturbation to a more generic system of equations to get to a situation in which this would be true.
  
Given this, 
  we define a moduli space $\M$ of $u$-independent solutions.  We can think of these as the solutions in the presence of infinite parallel strands that run in the $u$ direction, as in fig. \ref{longknotthree}.
    \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{LongKnot3.png}
 \end{center}
\caption{\small Infinite parallel strands parametrized by $u$, with $-\infty\leq u \leq \infty$. \label{longknotthree}}
\end{figure}
  
  
      \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{LongKnot2.png}
 \end{center}
\caption{\small Semi-infinite strands that extend to $u=+\infty$. \label{longknottwo}}
\end{figure}
  
 Now as in fig. \ref{longknottwo} consider solutions in the presence of semi-infinite strands that extend to $u=+\infty$ or to $u=-\infty$ but not both.
 Let $\L_\ell$ and $\L_r$ be the moduli spaces of such solutions.  Thus a point in $\L_\ell$ represents a solution in a semi-infinite situation in which the strands terminate on the left (as drawn in fig. \ref{longknottwo}).
      Likewise $\L_r$ parametrizes solutions in the presence of semi-infinite strands that terminate on the right.
We assume that a solution in such a semi-infinite situation 
 is independent of $u$ for $u\to+\infty$ or $u\to-\infty$, respectively.  If this is so, then $\L_\ell$ and $\L_r$ come with natural maps to $\M$.  
 For simplicity in our terminology, we will assume that these maps are embeddings; this amounts to assuming that each solution in the interior in fig. \ref{longknot} can be extended over the left or over the right
  in at most one way.  This assumption is not necessary
 but makes the explanation simpler.
  
 
      
 The solutions for  a global knot like the one  in fig. \ref{longknot}
      can be understood as solutions in the middle that extend over both ends.  So the global solutions are intersection points
   of $\L_\ell$ and $\L_r$.      The integer $a_n$ that appears as a coefficient in the Jones polynomial is supposed to be the algebraic
   intersection number of $\L_\ell$ and $\L_r$:
   \be\label{intno} a_n=\L_\ell\cap \L_r.\ee
    (To be more exact, $a_n$ is this intersection number computed by counting only intersections with $P=n$.)
    
   
   In this language of intersections, categorification can happen if $\M$ is in a natural way a symplectic manifold and $\L_\ell$ and $\L_r$
   are Lagrangian submanifolds.    Then Floer cohomology -- i.e. the $A$-model or the Fukaya category -- of $\M$ gives a framework
   for categorification.    From the point of view of today's lecture, the reason that all this will happen is that, even before we stretched the knot
   to reduce to intersections in $\M$, the equations whose solutions we were counting are equations for critical points of some Morse function(al) $h$.
   
   In ``symplectic Khovanov homology,'' a version of such a story is developed for Khovanov homology (at least in a singly-graded version)
   with a very specific $\M$.    A description of this $\M$ that was proposed in \cite{K} (and exploited in a mirror version in \cite{CK}) 
   and which provided an important clue in my work is
   as follows.  $\M$ can be understood as a space of Hecke modifications.   Let me explain this concept.    Let $C$ be a Riemann surface
   and $E\to C$ a holomorphic $G_\C$ bundle over $C$, where $G_\C$ is some complex Lie group.   A Hecke modification of $E$ at a point $p\in C$
   is a holomorphic $G_\C$ bundle $E'\to C$ with an isomorphism to $E$ away from $p$:
   \be\label{maps}\varphi:E'|_{C\backslash p}\cong E|_{C\backslash p}. \ee
   
   For example, if $G_\C=\C^*$, the we can think of $E$ as a holomorphic line bundle $\L\to C$.    A holomorphic bundle $\L'$ that
   is isomorphic to $\L$ away from $p$ is
   \be\label{abn}\L'=\L(np)=\L\otimes \O(p)^n\ee
   for some integer $n$.   Here  $n$ can be thought of as a weight of the Langlands-GNO dual group of $\C^*$, which is another copy of
   $\C^*$.
   
   The reason that I write $G_\C$, making explicit that this is the complex form of the group, is that when we do gauge theory, the gauge group will be the
   compact real form and I will call this simply $G$.   In general, for any $G$, there is a corresponding Langlands-GNO dual group $G^\vee$,
   with complexification $G^\vee_\C$, such that Hecke modifications of a holomorphic  $G_\C$-bundle at a point $p\in C$ occur in families
   classified by dominant weights (or equivalently finite-dimensional representations) of $G^\vee_\C$ (or equivalently $G^\vee$).
   
   For example, if $G_\C=GL(2,\C)$, we can think of a $G_\C$-bundle $E\to C$ as a rank 2 complex vector bundle $E\to C$.
     The Langlanda-GNO dual group $G^\vee_\C$ is again $GL(2,\C)$, and a Hecke modification dual to the 2-dimensional representation of 
   $G^\vee_\C$ is as follows.   For some local decomposition $E\cong \O\oplus \O$ in a neighborhood of $p\in C$, one has
   $E'\cong \O(p)\oplus \O$.    The difference from the abelian case is that there is not just one Hecke modification of this type at $p$ but
   a whole {\it family} of them, arising from the choice of a subbundle $\O$ of $E$ that is going to be replaced by $\O(p)$.



     \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Points.png}
 \end{center}
\caption{\small  A configuration of  points $p_i\in\R^2$, at which we are going to make Hecke modifications. \label{points}}
\end{figure}

 Because of this dependence, the Hecke modifications of this type at $p$ form a family, parametrized by $\CP^1$.  
Suppose we are given $2n$ points on $\C\cong \R^2$ at which we are going to make Hecke modifications of this type of a trivial bundle rank 2 complex
vector bundle $E\to \C$ (fig. \ref{points}).
The space of all such Hecke modifications would be a copy of $(\Bbb{CP}^1)^{2n}$, with one copy of $\Bbb{CP}^1$ at each point. 
However, there is a natural subvariety $\M\subset( \Bbb{CP}^1)^{2n}$ defined as follows.  One adds a point $\infty$ at infinity 
to compactify $\C$ to $\CP^1$, so
we are now making Hecke modifications of a trivial bundle $E=\O\oplus \O\to \Bbb{CP}^1$.   A point in $(\Bbb{CP}^1)^{2n }$ determines
a way to perform Hecke modifications at the points $p_1,p_2,\dots,p_{2n}$ to make a new bundle $E'$.   The space $\M$ is defined by requiring
that $E'\otimes \O(-n\infty)$ is trivial.   (If we were working in $PGL(2,\C)$ rather than $GL(2,\C)$, we would just say that $E'$ should
be trivial.) 

Symplectic Khovanov homology is constructed by considering intersections of Lagrangian submanifolds of the space $\M$ of multiple
Hecke modifications from a trivial bundle to itself. 
We want to reinterpret this in terms of gauge theory PDE's.

In my work with Kapustin on gauge theory and geometric Langlands \cite{KW}, an important fact was that $\M$ can be realized as a moduli space of
solutions of a certain system of PDE's.    However, although $\M$ is defined in terms of bundles on a 2-manifold $\R^2\cong\C$, the PDE's
are in 3 dimensions -- on $\R^3$.    As a result of this, everything in the rest of the lecture will be in a dimension one more than
one might expect.   To describe the Jones polynomial -- an invariant of knots in 3-space -- we will count solutions of certain PDE's in 4 dimensions,
 and the categorified version -- Khovanov homology -- will involve PDE's in 5 dimensions.  

The 3-dimensional PDE's that we need are known as the Bogomolny equations.  They are equations, on an oriented three-dimensional Riemannian manifold $W_3$,
for a pair $A,\upphi$, where $A$
is a connection on a $G$-bundle $E\to W_3$,   and $\upphi$ is a section of $\ad(E)\to W_3$
(i.e. an adjoint-valued 0-form).   If $F=\d A+A\wedge A$ is the curvature of $A$, then the Bogomolny equations are 
\be\label{z}F=\star \d_A\upphi.\ee
(Here $\star$ is the Hodge star and $\d_A$ is the gauge-covariant extension of the exterior derivative.) 

The Bogomolny equations have many remarkable properties and we will focus on just one aspect.  We consider the Bogomolny equations on $W_3=\R\times C$ with $C$ a Riemann surface.   Any connection $A$ on a $G$-bundle $E\to C$ determines a holomorphic structure on $E$ (or more
exactly on its complexification):  one simply writes $\d_A=\bar\partial_A+\partial_A$ and uses $\bar\partial_A$ to define the complex structure.  
(In complex dimension 1, there is no integrability condition that must be obeyed by a $\bar\partial$ operator.)   So for any $y\in \R$,
by restricting $E\to \R\times C$ to $E\to \{y\}\times C$, we get a holomorphic bundle $E_y\to C$.   However, if the Bogomolny equations are
satisfied, $E_y$ is canonically independent of $y$.    Indeed, a consequence of the Bogomolny equations is that $\bar\partial_A$ is independent of $y$
up to conjugation.    If we parametrize $\R$ by $y$, then the Bogomolny equations imply that
\be\label{zop}\left[\frac{D}{Dy}-\mathrm{i} \upphi,\bar\partial_A\right]=0.\ee
Thus $\bar\partial_A$ is independent of $y$, up to a natural conjugation.

The Bogomolny equations admit solutions with  singularities at isolated points.  
To understand the basic picture, we take the three-manifold to be simply $\R^3$, and the gauge group to be  $U(1)$.  One fixes an integer $n$ and one observes that the Bogomolny equation has an exact solution
for any $x_0\in\R^3$:
\be\label{zup}\upphi=\frac{n}{2|\vec x-\vec x_0|},~~ F=\star \d\upphi.\ee
  I have only defined $F$ and not the connection $A$ whose curvature is $F$ or the line bundle $\L$ on which $A$ is  connection. Such
an $\L$ and $A$ exist (and are essentially unique) if and only if $n\in \Z$.  

     \begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{BogSing.png}
 \end{center}
\caption{\small Points $y_i\times p_i\in\R^3$ labeled by weights $n_i$ of the group $U(1)$.  \label{bogsing}}
\end{figure}

For $G=U(1)$, since the Bogomolny equations are linear, they have a unique solution with singularities of this type labeled by specified integers $n_1,n_2,\dots$
at specified points $p_i\in \R^3$ (fig. \ref{bogsing}).  We simply take $\upphi=\sum_i \frac{n_i}{2|\vec x-\vec x_i|}$, $F=\star\d\upphi$.
   We assume that $\sum_in_i=0$, which ensures that $\upphi$ and the connection $A$ vanish at infinity faster than $1/|\vec x|$.
 
 Now pick a decomposition $\R^3=\R\times \R^2$, where we identify $\R^2$ as $\C$.   Suppose that the singularities are at $y_i\times p_i$,
 with $y_i\in\R$, $p_i\in\C$.
For each $y\notin\{y_1,\dots,y_n\}$, the indicated solution of the Bogomolny equations determines a holomorphic line bundle $\L_y\to \C$, and upon adding a point at infinity, this
naturally extends to $\L_y\to\CP^1$.  (Here we use the fact that $A$ vanishes at infinity faster than $1/|\vec x|$.)
$\L_y$ is independent of $y$  up to isomorphism as long as  $y$ is not equal to one of the $y_i$, but even when $y$ crosses one of the $y_i$, $\L_y$ is constant
when restricted to $\CP^1\backslash p_i$.    In crossing $y=y_i$, $\L_y$ undergoes a Hecke modification
\be\label{mapt}\L_y\to \L_y\otimes \O(p_i)^{n_i}.\ee
$\L_y$ is trivial for $y\to -\infty$ and for $y\to +\infty$ (again because the solution vanishes at infinity faster than $1/|\vec x|$).   The solution thus describes a sequence of Hecke modifications mapping the trivial bundle
to itself.

We can do something similar for any simple Lie group $G$.  (The underlying idea was introduced by 't Hooft in the late 1970's \cite{thooft} and is important in
physical applications of quantum gauge theory.)   Let $T$ be the maximal torus of $G$ and let $\frak t$ be its Lie algebra.  Pick a homomorphism
$\rho:\frak{u}(1)\to \frak t.$   Up to a Weyl transformation, such a $\rho$ is equivalent to a dominant weight of the dual group $G^\vee$, so
it corresponds to a representation $R^\vee$ of $G^\vee$.    We turn the singular solution (\ref{zup})  of the $U(1)$ Bogomolny equations that we already
used (more exactly, the special case of this solution with $n=1$) into a singular
solution for $G$ simply by
\be\label{realt}(A,\upphi)\to (\rho(A),\rho(\upphi)).\ee
  Then we look for solutions of the Bogomolny equations for $G$ with singularities of this type at specified points $y_i\times p_i\in \R^3$. 

     \begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{BogSing2.png}
 \end{center}
\caption{\small Points in $\R^3$ labeled by homomorphisms $\rho_i:\frak{u}(1)\to \frak t$, or equivalently by representations of the dual group.  \label{bogsing2}}
\end{figure}
 
The picture is the same as before  
  except that now (fig. \ref{bogsing2}) the points $y_i\times p_i$ are labeled by homomorphisms
  $\rho_i:\frak{u}(1)\to \frak t$, or in other words by representations $R_i^\vee$ of the dual group $G^\vee$, rather than by integers $n_i$. 
  Also, now we must specify that the solution should go to 0 at infinity faster than $1/r$ (for $U(1)$, this was automatic once we set $\sum_in_i=0$).  Given this, such a solution describes a sequence
  of Hecke modifications at $p_i$ of type $\rho_i$, mapping a trivial $G$-bundle $E\to \CP^1$ to itself. 
  
 The moduli space $\M$ of solutions of the Bogomolny equations on $\R^3$ with the indicated singularities and
vanishing at infinity faster than $1/r$ is actually a hyper-Kahler manifold, essentially first studied by P. Kronheimer in the 1980's. 
If we pick a decomposition $\R^3= \R\times \R^2$, this picks one of the complex structures on the hyper-Kahler manifold and in that
complex structure, $\M$ is the moduli space
 $\M_{p_1,\rho_1;p_2,\rho_2;\dots}$ of all Hecke modifications  of the indicated types at the indicated points, mapping a trivial bundle over $\CP^1$
 to itself.   
 
 This construction can be used to account for a number of properties of spaces of Hecke modifications, but for today we want to focus on the
  application to knot theory.  The reduction to $\M$ is supposed to result from stretching a knot in one direction, so 
  we want $\M$ to be the space of $u$-independent solutions of some equations, as suggested in fig. \ref{longknotthree}.
  We already described $\M$ via solutions of some PDE's on $\R^3$, so now we have to 
     think of $\M$ as a space of $u$-independent solutions on $\R^4=\R^3\times \R$, where the second factor is parametrized by $u$.
 
  
There actually are natural PDE's in four dimensions that work. They play a role in the gauge theory approach to
 geometric Langlands \cite{KW}, and are  sometimes called the KW equations.  They are equations for a pair $A,\phi$ where $A$ is a connection on $E\to Y_4$, $Y_4$ a four-manifold, and $\phi$ is a 1-form
on $Y_4$ valued in $\ad(E)$:
\be\label{meqn}F-\phi\wedge \phi=\star\d_A\phi,~~~\d_A\star\phi=0.\ee
In a special case $Y_4=W_3\times \R$, with $A$ a pullback from $W_3$ and $\phi =\upphi\, \d u$ (where $\upphi$ is a section of $\mathrm{ad}(E)$ and 
$u$ parametrizes the second factor in $Y_4$) these
equations reduce to the Bogomolny equations on $W_3$:
\be\label{redb}F=\star\d_A\upphi.\ee

Therefore, the singular solution (\ref{realt}) of the Bogomolny equations that we have already studied can be lifted to a singular solution of the KW
equations, but now the singularity is along a line rather than a point. Of course, the singularity is still in codimension three. We view this solution as a model that tells us what sort of codimension three singularity to look
for in a more general situation.    If $Y_4$ is a 4-manifold and $S\subset Y_4$ is an embedded 1-manifold, labeled
by a homomorphism $\rho:\frak{u}(1)\to \frak{t}$ (or by a representation of $G^\vee$), then one can look for solutions of the KW equations with
a singularity  along $S$ associated to the given choice of $\rho$ (fig. \ref{LoopSing}).
     \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{LoopSing.png}
 \end{center}
\caption{\small A four-manifold $Y$ with an embedded 1-manifold $S$ along which one specifies a desired singularity.  \label{LoopSing}}
\end{figure}

    
If we specialize to the case that $Y_4=\R^3\times \R$, with   $S=\cup_i S_i$, and $S_i=p_i\times \R\subset \R^3\times \R$ ($p_i$ are
points in $\R^3$ and $\R$ is parametrized by $u$) 
     then the $u$-independent solutions of the KW equations are just the solutions of the Bogomolny equations on $\R^3$, with
     the chosen singularities.  So these solutions are parametrized by $\M$; and indeed one can show that these are all solutions of the KW
     equations in this situation with reasonable behavior at infinity. 


So we have an elliptic PDE in four dimensions and we can specify in an interesting way what sort of singularity it should have on an embedded
circle $S\subset Y_4$.    But this sounds like a ridiculous framework for knot theory, because there is no knottedness of a 1-manifold in 
a 4-manifold!


To resolve this point, we have to explain what is involved in categorification.
Let us practice with an ordinary equation rather than a partial differential equation.   Suppose that we are on a finite-dimensional 
compact oriented manifold
$N$ with a real vector bundle $V\to N$ with rank$(V)$=dimension$(N)$.    Suppose also we are given a section $s$ of $V$. 
We can define an integer by counting, with multiplicities (and in particular with signs) the zeroes of $s$.    This integer is the Euler class
$\int_M\chi(V)$. 

In general as far as I know, there is no way to categorify the Euler class of a vector bundle.    However, suppose that $V=T^*N$
and that $s=\d h$ where $h$ is a Morse function.    Then the zeroes of $s$, which are critical points of $h$,
 have a natural ``categorification'' described in Morse homology.
One defines a complex $\mathcal V$ with a basis vector $\psi_p$ for each critical point $p$ of $h$.   The complex is $\Z$-graded by assigning
to $\psi_p$ the ``index'' of the critical point $p$, and it has a natural differential that is defined by counting gradient flow lines between different critical points.


    \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Flow.png}
 \end{center}
\caption{\small A flow from one critical point to another.  \label{flowg}}
\end{figure}
Concretely the differential is defined by
\be\label{diffdef}\d\psi_p=\sum_q n_{pq}\psi_q\ee
where the sum runs over all critical points $q$ whose Morse index exceeds by 1 that of p, and the integer $n_{pq}$ is defined by counting flows from $p$ to $q$ (fig. \ref{flowg}).
    A ``flow'' is a solution of the gradient flow equation
    \be\label{flowz}\frac{\d \vec x}{\d t}=-\vec\nabla h.\ee
    (To define this equation, one has to pick a Riemannian metric on the manifold $N$.  The complex that one gets is independent of the metric up to
    quasi-isomorphism.  One considers flows that start at $p$ at $t=-\infty$ and end at $q$ at $t=+\infty$.  Such flows come in one-parameter families related by time translations
    and $n_{pq}$ is the number of such families, counted algebraically.)
    
This tells us what we need in order to be able to categorify a problem of counting solutions of the KW equations.
We have to be able to write those equations  as equations for a critical point of a functional $\Gamma(A,\phi)$:
\be\label{mext}\frac{\delta \Gamma}{\delta A}=\frac{\delta \Gamma}{\delta \phi}=0.\ee
And the associated gradient flow equation, which will be a PDE in 5 dimensions on $X_5=\R\times Y_4$
\be\label{wext}\frac{\d A}{\d t}=-   \frac{\delta \Gamma}{\delta A},~~~~~\frac{\d \phi}{\d t}=-   \frac{\delta \Gamma}{\delta \phi}\ee
has to be elliptic, so that it will makes sense to try to count its solutions. 

Generically, it is not true that the KW equations on a manifold $Y_4$ are equations for a critical point of some functional.  
However, this is true if $Y_4=W_3\times \R$ for some $W_3$.   If singularities are present on an embedded 1-manifold $S\subset Y_4$
then there is a further condition:  The KW equations in this situation are equations for critical points of a functional if and only if $S$ is contained
in  a 3-manifold $W_3\times p$, with $p$ a point in $\R$. (For an explanation of ``why'' this  is true, see the appendix.)    So to make categorification possible, we have to be in the situation that leads to
knot theory:  $S$ is an embedded 1-manifold in a 3-manifold $W_3$.  Once this restriction is made, the five-dimensional flow equations exist and
are indeed elliptic.  (They were introduced
independently in \cite{Witten} and \cite{Haydys} and are sometimes called the HW equations.)

Naively, this leads to ``categorified'' knot invariants for any three-manifold $W_3$, but to justify this claim one needs some compactness
properties for solutions of the equations under consideration.    I suspect that a proper proof of these compactness properties may require
that the Ricci tensor of $W_3$ is nonnegative, a very restrictive condition. 

What I have described so far is supposed to correspond (for $W_3=\R^3$, $G=SO(3)$ and $\rho$ corresponding to the 2-dimensional representation
of $G^\vee=SU(2)$) to ``singly-graded Khovanov homology.''   It is singly-graded because the only grading I have mentioned
is the grading that is associated to the Morse index, or in other words to categorification.   In the mathematical theory, one says that singly-graded
Khovanov homology becomes trivial (it does not distinguish knots) if one ``decategorifies'' it and forgets the grading.    In the approach I have described,
this is true because in the uncategorified version, the embedded 1-manifold $S$ is just a 1-manifold in a 4-manifold $Y_4$ (it has no reason to
be embedded in the 3-manifold $W_3\times p$) so there is no knottedness.

The physical picture makes clear where the additional ``$q$''-grading of Khovanov homology would come from.   It is supposed to come
from the second Chern-class, integrated over the 4-manifold $Y_4$.  The second Chern class is the  invariant that I called $P$ at
the beginning of the lecture.  But for topological reasons, the second Chern class cannot be defined in the presence of  a  codimension three singularity of the type I have
described on an embedded one-manifold $S\subset Y_4$.
(Because of the singularity, $Y_4$ behaves as a noncompact four-manifold on which there is no topological invariant corresponding to the second Chern class
of a $G$ bundle.)
And therefore the construction as I have presented it so far has no $q$-grading.
    
    
     \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Thimble.png}
 \end{center}
\caption{\small A four-manifold $Y_4$ with boundary, with a knot placed in its boundary.  \label{thimble}}
\end{figure}   
    The physical picture tells us what we have to do to get the $q$-grading:   $Y_4$ should be a manifold with boundary, with the knot
    placed in its boundary (fig. \ref{thimble}).
     The appropriate boundary condition will be the subject of Lecture Two and is such that the second Chern class
     can be defined.
      
      
 In \cite{GaiWit}, Gaiotto and I analyzed this problem  (in the uncategorified situation, meaning that we counted solutions in 4 dimensions, not 5, and for the simplest
 case of $G=SO(3)$) with the aim
 of showing directly, without referring to the physical picture, that the Jones polynomial is
 \be\label{pext}J(q)=\sum_na_nq^n\ee
 where $a_n$ is the number of solutions with second Chern class $n$.    The starting point was to stretch the knot in one direction,
 reducing to equations in one dimension less, as in fig. \ref{longknot}. It turns out that 
  the solutions in one dimension less that satisfy the boundary condition are related to a lot of interesting mathematical physics
 involving integrable systems, conformal field theory, geometric Langlands, and more.
What emerges is the ``vertex model'' construction of the Jones polynomial; the way it emerges is somewhat along the lines of work by Bigelow \cite{Bigelow} and  Lawrence \cite{Lawrence}.   
What our work added was a derivation of the vertex model from
 a starting point with manifest 3-dimensional symmetry.  The analog of this for the categorified theory   is expected to involve, in one version,
  a Fukaya-Seidel category with a certain superpotential.    The relevant model -- as well as a plausible variant that does not work -- has been explored and to a considerable
  extent understood in \cite{GalMoore}.


  \section{Lecture Two} 

In Lecture One, I explained that to define a $q$-grading in Khovanov homology, we have to be able to make sense of the second
Chern class of a solution of the KW equations on a four-manifold $Y_4$, in the presence of a knot.  As already explained, if the knot
is represented by a codimension 1 embedded submanifold $S\subset Y_4$, this will not work, because the singularity that we want to postulate
along $S$ does not allow the definition of a second Chern class as a topological invariant.  Instead, we embed the knot in the boundary of $Y_4$, as
 in fig. \ref{thimble}.
     The boundary condition that we use is subtle to describe, but has the property that the bundle is fixed on the boundary, so the second Chern class
     can be defined.  
      

We could actually get the $q$-grading for any $Y_4$ with boundary, but to also allow categorification, we want more specifically
$Y_4=W\times \R_+$, where $\R_+$ is a half-line, parametrized by $y$. 
For the Jones polynomial and Khovanov homology, we further take $W=\R^3$. (More general choices of $W$ are certainly also interesting, but not much is known
about what to expect. See \cite{GPV}.)  So as sketched in fig. \ref{thimble},
$Y_4$ is $\R^3\times \R_+$  with the knot embedded in the boundary.


For $y\to \infty$, we ask for $A,\phi\to 0$.    For $y\to 0$, there is a subtle boundary condition which is one of the main points
of the theory.   Describing it is actually my main goal for today.  This boundary condition depends on the knot  $K$, and on the labeling
of $K$ (or of each component of a link $L$) by a representation $R^\vee$  of the Langlands or GNO dual group $G^\vee$.   That is the
only place that $K$ enters the setup.    

The desired boundary condition is an elliptic boundary condition though possibly an unexpected one.   Here, ``elliptic'' means that although
the definition may look unexpected, the resulting properties are similar to what one would get with more familiar elliptic boundary conditions
such as Dirichlet or Neumann.   For example, on a compact four-manifold, the linearization of the KW equation becomes a Fredholm operator and  has discrete spectrum.

With this boundary condition, which I will describe in some detail,
the restriction to the boundary $W\times \{y=0\}$ of the bundle $E$ and connection $A$ are specified.   As a result, one can define
a second Chern class
\be\label{zort}n=\frac{1}{8\pi^2} \int_{W\times \R_+}\Tr\, F\wedge F.\ee
However, because the bundle is fixed on the boundary but is not trivialized, this invariant really takes values in a $\Bbb Z$-torsor associated to framings of $W$ and $K$.    ``Torsor'' means that it is not
true that $n$ is an integer in a canonical way; rather the value of $n$ mod $\Z$ depends only on the boundary conditions and not on the specific gauge field
that satisfies them.   One can ``trivialize the torsor'' and make $n$ an integer by picking framings of $W$ and $K$.  


To define a knot polynomial, one counts (with signs, in a standard way) the number $	a_n$ of solutions of the KW equations
with second Chern class $n$, and then one defines
\be\label{peft}J(q;K,R^\vee)=\sum_{n\in\Bbb Z}a_nq^n.\ee
  Compactness (not yet proved with the appropriate boundary conditions) of the solutions of the KW equations will mean
that there are only finitely many terms in the sum so that this is a Laurent polynomial.

As I explained in Lecture One, with this definition of the Jones polynomial, the ``categorification'' that leads to Khovanov homology is straightforward
in principle.    It arises because the KW equations can be ``lifted,'' in a certain sense, to certain elliptic differential equations in five
dimensions, and these equations can be interpreted as gradient flow equations.   But rather than say more about that today,
what I want to do is to describe the boundary condition that is needed for the four (or five) dimensional equations.    This boundary
condition is of a possibly somewhat unfamiliar type, and understanding it is essential for making progress with this subject.

The boundary
conditions have been studied in \cite{MW},  and were shown to be elliptic in the absence of a knot.    A paper is in progress on the case with a knot \cite{MWtwo},
and I will tell a little
about that case later.    I will carry out this discussion in the language of the four-dimensional equations, since going to five dimensions does not change much,
as was shown in \cite{MW}.

The boundary condition of interest is not a simple Dirichlet or Neumann boundary condition -- it is not defined by saying what fields or
derivatives of fields vanish along the boundary.    Rather, the boundary condition is defined by specifying a model solution of the KW
equations that has a singularity along the boundary, and saying that one only wants to consider solutions of the KW equation that
are asymptotic to this singular solution along the boundary.

The model solution is a solution on $\R^3\times \R_+$, where I will parametrize $\R^3$ by $x_1,x_2,x_3$ and $\R_+$ by
$y$.  There is a simple exact solution with $A=0$ and
\be\label{yef}\phi=\sum_{i=1}^3\frac{\t_i \cdot \d x_i}{y}, \ee
where $\t_i$ are elements of the Lie algebra $\frak g$ of $G$ that obey the $\frak{su}(2)$ commutation relations
\be\label{yyef}[\t_1,\t_2]=\t_3,~~\mathrm{and~cyclic~permutations}.\ee
  Thus the $\t_i$ are images of a standard basis of $\frak{su}(2)$ under some homomorphism $\rho:\frak{su}(2)\to \frak g$.
  Every $\rho$ leads to an interesting theory, but to get the Jones polynomial and Khovanov homology, we take $\rho$ to be
a principal embedding in the sense of Kostant.  (For $G=SU(2)$, this simply means that $\rho$ is the identity map
$\frak{su}(2)\to \frak g$. For $G=SU(N)$, it means that the $N$-dimensional representation of $\frak g$
is irreducible with respect to $\rho(\frak{su}(2))$.) 


The solution I have just described is what I call the Nahm pole solution, since the relevant singularity was introduced long ago
by Nahm  in his work on magnetic monopoles \cite{N}.   That was in the context of ``Nahm's equation,'' which is an ordinary differential equation for three
$\frak g$-valued functions $\phi_1,\phi_2,\phi_3$ of a real variable $y$:
\be\label{zefa}\frac{\d\phi_1}{\d y}+[\phi_2,\phi_3]=0,~~\mathrm{and~cyclic~permutations}.\ee
The KW equations reduce to Nahm's equation if we drop the dependence on $\vec x$
and set $A=\phi_y=0$.
  On $\R^3\times\R_+$, the Nahm pole boundary condition
just says that a solution is supposed to be asymptotic to the Nahm pole solution for $y\to 0$.

To state the Nahm pole boundary condition on $M_4=W_3\times \R_+$, for a more general 3-manifold $W_3$, one needs to specify some
terms of $\O(1)$ in the solution (for $y\to 0$) as well as the singular terms of order $1/y$.   For $G=SU(2)$, one takes the $G$-bundle
$E$ on which we are solving the equations to be, when restricted to $W_3\times \{y=0\}$, the frame bundle of $W_3$, so that $\ad(E)=TW_3$. 
Then one takes $A$, restricted to the boundary, to be the Levi-Civita connection on $TW_3$. 
 With this choice of $E$, the formula  
\be\label{torf}\phi=\sum_{i=1}^3\frac{\t_i \cdot \d x_i}{y} \ee
makes sense (one can think of the numerator $\sum_i\t_i\cdot \d  x_i$ as stating the identification $\ad(E)\cong TW_3$).   One can show that this choice
of $(A,\phi)$ obeys the Nahm pole boundary condition up to an error of $\O(y)$, and the Nahm pole boundary condition simply says that
the solution should agree with what I have described up to $\O(y)$.  (One can  generalize this to the case that the metric of $M_4$
is not a product near the boundary.)

Showing that the Nahm pole boundary condition is elliptic is mostly an exercise in ``uniformly degenerate elliptic operators,'' but one
needs to know some specific facts about the KW equations.   The main thing that one needs to know is that if $\L$ is the linearization
of the KW equations on a half-space $\R^4_+$ around the Nahm pole solution, then $\L$ as an operator between appropriate Hilbert spaces of functions on $\R^4_+$
has no kernel or cokernel.     Actually one can show in an elementary way that $\L^\dagger =-N\L N^{-1}$ with an explicit matrix
$N$, so it suffices to show that there is no kernel. 

Much the same argument that proves this actually proves the following statement:    The only solution of the KW equations on
$\R^4_+$, approaching the Nahm pole solution for  $y\to 0$ and also for $\sqrt{\vec x^2+y^2}\to\infty$, is the Nahm pole solution, and moreover this solution
is ``transverse'' (ln expanding around it, the operator $\L$ has zero kernel and cokernel).  In terms of
Khovanov homology, this means that the Khovanov homology of the empty link is of rank 1.

Before trying to prove these vanishing results, I will explain a simpler vanishing result for the KW equations on a four-manifold $M=M_4$
without boundary.  This will help us know what to aim for.\footnote{The vanishing result without boundary was obtained in \cite{KW}
and the case with a boundary was analyzed in \cite{MW}.}

 The KW equations actually have many different  useful Weitzenbock formulas.  I will first
state some formulas that are useful if we are on a manifold without boundary.   Let $\V=F-\phi\wedge \phi-\star \d_A\phi$, $\W=\d_A\star\phi$,
so the KW equations are $\V=\W=0$.   Clearly then the KW equations are equivalent to the vanishing of 
\be\label{zorf}I=-\int_{M}\Tr\left(\V\wedge\star \V+\W\wedge\star \W\right).\ee
A short calculation gives 
\be\label{morf}I=-\int_{M}\d^4x\sqrt{g}\Tr \left( \frac{1}{2}F_{ij}F^{ij}+D_i\phi_j D^i\phi^j+R_{ij}\phi^i\phi^j+\frac{1}{2}[\phi_i,\phi_j][\phi^i,\phi^j]   \right)\ee
with $R_{ij}$ the Ricci tensor.
If $R_{ij}$ is non-negative, then this is a sum of non-negative terms. The condition $I=0$ forces all these terms to vanish and leads to only a rather trivial class of solutions.

But it is possible to say something useful even if $R_{ij}$ is not non-negative, because
 it is possible to find a family of Weitzenbock formulas.   Define the selfdual 
and anti-selfdual two-forms $\V^+(t)=(F-\phi\wedge\phi+t\d_A\phi)^+$, $\V^-(t)=(F-\phi\wedge\phi-t^{-1}\d_A\phi)^-$.   The equations
$\V^+(t)=\V^-(t)=\W=0$ are a 1-parameter family of elliptic equations, parametrized by $t\in \Bbb{RP}^1$. 
One finds that 
 \begin{align}-\int_M\d^4x \sqrt g&\Tr\left(\frac{t^{-1}}{t+t^{-1}}\V^+_{ij}(t)\V^{+\,ij}(t)+\frac{t}{t+t^{-1}}\V_{ij}^-(t)\V^{-\,ij}(t)+\W^2\right)\cr &
=I +\frac{t-t^{-1}}{4(t+t^{-1})}\int_M \d^4 x \,\epsilon^{ijkl}\Tr F_{ij}F_{kl}. \notag\end{align}


In other words, the same quantity $I$ can be written as a sum of squares in many different ways, modulo the topological invariant
\be\label{noxt}J(t)= \frac{t-t^{-1}}{4(t+t^{-1})}\cdot 32\pi^2 P,~~~ P=\frac{1}{32\pi^2}\int_M \d^4 x \,\epsilon^{ijkl}\Tr F_{ij}F_{kl}.\ee
Now we can deduce the following:  (1) The KW equations cannot have any solutions for $t\not=0,\infty$ except with $P=0$ (if $P\not=0$ for some solution, then by looking at the Weitzenbock formula at some value of $t'$ with $J(t')<J(t)$, we reach a contradiction).  And (2):  If the KW equations are obeyed at one value of $t$ other than $0,\infty$, then they are obeyed at all
$t$.  This is an immediate consequence of the Weitzenbock formula, once we know that $P=0$.   The equations then reduce
to $\mathcal F=0$, where $\mathcal F=\d \A+\A\wedge\A$, with $\A$ the complex connection $\A=A+i\phi$, along with   $\d_A\star\phi=0$. 
According to a theorem of Corlette \cite{Corlette}, the solutions correspond to homomorphisms $\pi_1(M)\to G_\C$ that are in a certain sense semi-stable.

The moral of the story is that the KW equations participate in many different Weitzenbock formulas, not just one, and it is important
to know all of them.   However, none of the formulas that I have written down so far are useful for understanding the Nahm pole
boundary condition.   The reason is that if $\partial M\not=\varnothing$, then the preceding formulas (whose derivation involves integration by parts) will have boundary contributions
if we are on a manifold with boundary, and those boundary contributions
 are divergent in the case of a solution with Nahm pole boundary behavior.    This is inevitable because the expression
that I called $I$ in writing the Weitzenbock formula is divergent in the case of a solution with Nahm pole behavior.  A formula like
\be\label{woxt}-\int\Tr\left(\V\wedge\star\V+\W\wedge \star \W\right)=I+{\mathrm{boundary ~correction}} \ee
must have a boundary correction $-\infty$ in the case of a Nahm pole, since the left hand side is 0 and $I=+\infty$.
A Weitzenbock formula with such divergent terms is not likely to be useful.

To get around this, the best we could hope for would be a Weitenbock formula on $\R^4_+$
in which $I$ is replaced by a sum of squares
of quantities whose vanishing characterizes the Nahm pole solution $A=0$, $\phi=\vec\t\cdot \d\vec x/y$.
 The quantities that vanish\footnote{In the following,  indices $i,j$ take four values corresponding to $x_1,x_2,x_3,y$, but indices $a,b$ take only three values corresponding to $x_1,x_2,x_3$. Also, $\varepsilon_{abc}$ is the Levi-Civita antisymmetric tensor.} in the Nahm pole solution are the curvature $F$, covariant
derivatives and commutators that involve $\phi_y$, namely $D_i\phi_y$ and $[\phi_i,\phi_y]$, covariant derivatives of $\phi_b$
along $\R^3$ such as $D_a\phi_b$, and finally $W_a=D_y\phi_a+\frac{1}{2}\varepsilon_{abc}[\phi_b,\phi_c]$.  (Nahm's equation is $W_a=0$.) 
What we need is true.   Define the following sum of squares of the objects whose vanishing characterizes the Nahm pole solution:
\begin{align}I'=-\int_{\R^3\times \R_+}\d^4x\,\Tr\left(\frac{1}{2}\sum_{i,j}F_{ij}^2+\sum_{a,b}(D_a\phi_b)^2 +\sum_i(D_i\phi_y)^2\right.
\cr\left. +\sum_a[\phi_y,\phi_a]^2
+\sum_a W_a^2\right).\notag\end{align}



Then there is an identity along the lines that we need: 
\be\label{toxt}-\int_M\Tr\left(\V^2+\W^2\right)= I'+\Delta\ee
where $\Delta$ is a certain  boundary term
\be\label{teft}\Delta=-\int_{\partial\R_+^4}\Tr\left(\phi\wedge F +\dots  \right). \ee
(I have omitted some further terms in $\Delta$.)   $\Delta$ is the sum of a contribution at the boundary $y=0$ and on a large hemisphere
$\sqrt{\vec x^2+y^2}>>1$.

Now to get a vanishing theorem that will say that the global Nahm pole solution is the only solution on $\R^4_+$ that
obeys Nahm pole boundary conditions, we need to do the following. We have to prove that if $A,\phi$ approach the Nahm pole
solution for $y\to 0$ and for $\sqrt{\vec x^2+y^2}\to\infty$, then they approach it fast enough so that $\Delta=0$.    Once this is established,  the Weitzenbock formula
will say that a KW solution that satisfies the boundary condition must have $I'=0$.   But $I'$ was constructed so that it vanishes
for and only for the Nahm pole solution.

To find the expected behavior of a solution for $y\to 0$ is a matter of looking at an ODE in which one ignores the $\vec x$
dependence, since that is nonsingular.    In effect, then, we just have to look at the eigenvalues of the linearization of Nahm's
equation (or more exactly a doubled version of Nahm's equation with $A$ as well as $\phi$).    Half of the linearized eigenvalues
are negative and half are positive.  The Nahm pole boundary condition amounts to setting to 0 the coefficients of perturbations with negative
eigenvalues, and allowing the positive ones.  The positive eigenvalues are large enough to ensure that $\Delta=0$ when the Nahm pole
boundary condition is obeyed. 

This shows that there is no contribution to $\Delta$ from the boundary at $y=0$.  To show that there is no contribution to $\Delta$ at $\sqrt{\vec x^2+y^2}\to\infty$, one needs to look at the eigenvalues
of the ``angular'' part of the operator $\L$, which is an operator on a hemisphere $S^3_+$ with Nahm pole boundary conditions along
the boundary.    Those eigenvalues determine how fast a solution will vanish at infinity, assuming that it does vanish at
infinity.  Again the spectrum is such that there is no contribution to $\Delta$. 

This leads to the nonlinear vanishing theorem -- the global Nahm pole solution is the only solution
on the half-space that satisfies the boundary conditions.  Much the same argument proves a linearization of the same statement:
the operator $\L$ obtained by linearizing around the Nahm pole solution has trivial kernel (and hence also trivial cokernel, since $\L$ is
conjugate to $-\L^\dagger$). 

Together with the machinery of uniformly degenerate elliptic operators, this leads to the ellipticity of the Nahm pole boundary
condition in the absence of knots.   But what are we supposed to say in the presence of knots?    As already noted, the knot will be in the boundary  (fig. \ref{thimble}).
To incorporate a knot in the boundary, we  introduce a refinement of the Nahm pole boundary condition, such that $(A,\phi)$ obeys the Nahm pole boundary condition at a generic
boundary point away from a knot, but has some more subtle behavior near the knot. 



     \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{KnotModel.png}
 \end{center}
\caption{\small A model situation in which a knot is represented by a straight line $K=\R$ in the boundary of a half-space $\R_+^4$.  \label{knotmodel}}
\end{figure}   
  To describe what this more subtle behavior should be, we consider
the case that the knot is locally a straight line $\R\subset \R^3$, so we work on $\R^4_+$ with a knot that lives on a straight line $K$ in the boundary (fig. \ref{knotmodel}).

 
    \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Bpoint.png}
 \end{center}
\caption{\small Assuming translation invariance along the $K$ direction in fig. \ref{knotmodel}, we reduce to $\R^3_+=\R^2\times \R_+$, with the knot
now represented by a point $p$ in the boundary. \label{Bpoint}}
\end{figure}   

 The idea is going to be to find a singular model solution in the presence of the knot.   This solution will 
 coincide with the Nahm pole
 solution near a boundary point away from $K$, but it will look different near a point of $K$.   The model solution will depend
 on the choice of an irreducible representation $R^\vee$ of the dual group $G^\vee$.    Then a boundary condition is
 defined by saying that one only allows solutions of the KW equations that look like the model solution near a knot.  
 
 For this to make sense, the model solution must look the same near any point of $K$, so we assume that the model
 solution is invariant under translations along $K$.  So we reduce to equations on $\R^2\times \R_+$ with the knot now
 represented by a point $p\in\R^2$ (fig. \ref{Bpoint}).

  
  
  Once we reduce to 3 dimensions (and assume vanishing of $A_1$ and $\phi_y$ in a way that can be motivated by the Weitzenbock
  formula) the KW equations become tractable.     Pick coordinates so that $x_1$ runs along the knot $K$; $x_2,x_3$ parametrize
  the normal plane to  $K$ in the boundary; and $y$ measures the distance from the boundary.   
  Define the three operators
\begin{align}\D_1 & = D_2+iD_3=\frac{\partial}{\partial x_2}+i\frac{\partial}{\partial x_3}  +[A_2+iA_3,\,\cdot\, ]\cr
               \D_2& =D_y-i[\phi_1,\,\cdot\,]= \frac{\partial}{\partial y} +[A_y-i\phi_1,\,\cdot\,]\cr 
                  \D_3&=[\phi_2-i\phi_3,\,\cdot\,] , \notag \end{align}  
and also the ``moment map''
\begin{equation} \notag \mu=F_{23}-[\phi_2,\phi_3]-D_y\phi_1.\end{equation}     

The KW equations in this situation become
\be\label{moxy}0=[\D_i,\D_j],~~~i,j=1,\dots,3\ee
along with a ``moment map'' condition
\be\label{loft}\mu=0.\ee
These equations were introduced in \cite{KW} and were called the extended Bogomolny equations.
They are a sort of hybrid of three much-studied equations in the mathematics of gauge theory.    If we drop $\D_1$
(by assuming that the fields are independent of $x_2$ and $x_3$ and that $A_2=A_3=0$), we get Nahm's equation; if we drop $\D_2$
(by assuming that the fields are independent of $y$ and that $A_y=\phi_1=0$) we get Hitchin's equation; and if we drop $\D_3$ (by setting
$\phi_2=\phi_3=0$), we get the Bogomolny equations.

The full system of equations is tractable for the same reason each of those three specializations is.  There are two key facts: 
 (a) the equations $[\D_i,\D_j]=0$
are invariant under $G_\C$-valued gauge transformations ($G_\C$ is the complexification of $G$); 
 (b) the combination of setting $\mu=0$ and dividing by $G$-valued
gauge transformations is equivalent to forgetting the condition $\mu=0$ and dividing by $G_\C$-valued gauge transformations. 
This means that the solutions can be understood in terms of complex geometry.



It is reasonable to expect that the model solution possesses the symmetries of the knot.   So we assume that the model
solution is invariant under a rotation of the boundary $\R^2$ around the point $p\in\R^2$ at which the knot lives, and also invariant
under a scaling of $\R^2\times \R_+$ keeping $p$ fixed.    With these assumptions, the equations $[\D_i,\D_j]=\mu=0$
reduce to affine Toda equations
which are integrable.    One can find all the solutions in closed form, and the solutions that satisfy the Nahm pole boundary condition
away from the knot are classified by an irreducible representation $R^\vee$  of the dual group $G^\vee$.   These solutions were
found for $G=SO(3)$, $G^\vee=SU(2)$ in \cite{Witten} and more generally in \cite{Mikhaylov}. 

How would one go about proving that the KW equations with a boundary condition defined by one of these model equations is
a well-posed (elliptic) problem?    Basically, modulo generalities about uniformly degenerate elliptic operators, we need to
 show that the operator $\L$ obtained by linearizing around one of these
solutions has no kernel or cokernel.   It is again sufficient to show that the kernel vanishes, since $\L^\dagger$ is conjugate to $-\L$.  

Just as in the absence of a knot, we will actually find a nonlinear analog of the vanishing of the kernel of $\L$: any solution of the
KW equations on $\R^3\times \R_+$  (with the knot as an infinite straight line in the boundary, as before) that is asymptotic  to the model solution
both  along the boundary  and at infinity actually coincides
with it. 

The vanishing results we want are the sort that often 
follow from a Weitzenbock formula.    But none of the Weitzenbock formulas that
we considered before are well-adapted to the presence of a knot.   Even the more subtle Weitzenbock formula that includes
the Nahm pole singularity away from a knot
\be\label{tudd}-\int_M\Tr\left(\V^2+\W^2\right)= I'+\Delta\ee does
not give any useful information, because $I'$ (which is the sum of squares of quantities that vanish in the Nahm pole solution without a knot)
is divergent in the presence of a knot so $I'$ will be $+\infty$ and hence $\Delta$ will be $-\infty$ with a knot present.

So we need a new Weitzenbock formula. 
 We  imitate what we did before.    We find a collection of quantities $X_i$ whose vanishing characterizes the model
solution.  (Some obvious $X_i$ are real and imaginary parts of $[\D_i,\D_j]$,  and also $\mu$; the others are quantities like $[\phi_i,\phi_y]$ that vanish because the model
solution has $A_1=\phi_y=0$.)    Then if
\be\label{mudd}I'' =-\sum_i\int_{\R^3\times \R_+}\Tr\,X_i^2,\ee
we have to hope that there is an identity
\be\label{wudd}-\int_{\R^3\times \R_+}\Tr\left(\V\wedge\star \V+\W\wedge\star\W\right)= I''+\widehat \Delta,\ee
where $\widehat \Delta$ is a new boundary term.   It turns out that there is indeed an identity like this.

We still need to show that $\widehat\Delta=0$ 
in the case of a solution that obeys the KW equations and is asymptotic near the knot to the model
solution.   For this, one needs to know what is the asymptotic behavior near the boundary and at infinity of a solution of the KW
equations.     We already know the behavior at a generic boundary point, which was used in our proof of the well-posedness of
the Nahm pole boundary condition without a knot.   To find the behavior near the knot and also at infinity, we now
need to solve the angular part of the equation on a 2d hemisphere $S^2_+$ (fig. \ref{hemi}).

    \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Hemi.png}
 \end{center}
\caption{\small To prove the vanishing theorem in the presence of a knot, one has to study the angular operator near a singular point on the boundary. 
The angular operator is defined on the indicated hemisphere. \label{hemi}}
\end{figure} 


Again it turns out that the eigenvalues of the angular operator are favorable, so there is no contribution to $\widehat \Delta$ either
near $p$ or at infinity.    This fact together with the relevant Weitzenbock formula imply that a solution of the KW equations on
$\R^3\times \R_+$ that is asymptotic on the boundary and at infinity to the model solution with the knot actually coincides with that
model solution.    A linearized version of the same argument shows that the kernel of $\L$ vanishes, which is what we actually
needed to know for ellipticity.

This is the main step in showing that $\L$ is a Fredholm operator in the presence of an arbitrary knot $K$ embedded in
any three-manifold $W$.    Some details are still needed to show that this gives an elliptic boundary condition for the nonlinear
KW equations in the general case of a curved knot \cite{MWtwo}.

\appendix
\section{Some Physics Background}

In this appendix, I will briefly describe some physics background to the treatment of singly-graded Khovanov homology in Lecture One.
Only a bare outline of the string/M-theory context and the  framework of \cite{Witten} for doubly-graded Khovanov homology will be given.
 I aim primarily to explain what is different for the singly-graded theory.

The starting point is the existence of a six-dimensional superconformal field theory with $(0,2)$ supersymmetry, associated to any simply-laced
Lie group $G$, or more precisely to its Dynkin diagram.  This theory has a $\Spin(5)$ group of R-symmetries.   Making use of a subgroup $F=\Spin(2)\subset \Spin(5)$,
the theory can be topologically twisted in such a way that it can be compactified on a Riemann surface $C$ to give a four-dimensional theory with $\mathcal N=2$
supersymmetry.  These are the theories of class S, as studied in  \cite{Gaiotto}.  They have an R-symmetry group $\hat F=(\Spin(3)\times \Spin(2))/\Z_2\cong \mathrm{U}(2)$ (the subgroup of $\Spin(5)$
that commutes with $F$).  Using the $\Spin(3)$ factor, a theory of class S can be topologically twisted and
compactified on a four-manifold $M$ in a way that preserves one supercharge $Q$. This gives
 a theory on $M\times C$ that is topological along
$M$ and holomorphic along $C$.  (The holomorphy along $C$ means, for example, that the cohomology of $Q$ acting on local operators on $M\times C$ varies homomorphically
on $C$.)  The topological-holomorphic theory on $M\times C$ still has an $F=\Spin(2)$ symmetry,  because $F$ commutes with the group $\hat F$ that
was used in the twisting.

The underlying six-dimensional $(0,2)$ model admits half-BPS surface operators that can be supported on any two-manifold $U$ in six dimensions.
However, when the theory is formulated on $M\times C$ as summarized in the last paragraph, if we wish to preserve the supercharge $Q$
of the topological-holomorphic theory, the possible choices of $U$ are quite limited.  $U$ must be of the form $p\times C$, where $p$ is a point in $M$, or  $\Sigma\times q$, where $\Sigma\subset M$ is a two-manifold
and $q$ is a point in $C$.  The reason for this is essentially that any (complete, connected) complex submanifold of $C$ is $C$ itself or a point  $q\in C$.  For
constructing Khovanov homology, we take $U=\Sigma\times q$.

To get singly-graded Khovanov homology, we take $M$ to be simply $\R^4$, and $C$ to be a cylinder $\R\times S^1$.  The six-manifold $M\times C$ is then
simply $\R^4\times \R\times S^1$.  The supercharge $Q$ is invariant under rotations of $\R^4$ (combined with a suitable element of $\Spin(3)\subset \hat F$)
but not under more general rotations of $\R^4\times \R$.  Now we use the fact that the $(0,2)$ model, when formulated on $M'\times S^1$ for any five-manifold $M'$, with
the radius of $M'$ being much greater than that of $S^1$, reduces at long distances on $M'$ 
to maximally supersymmetric gauge theory, with gauge group $G$.  In the context of the topological-holomorphic theory described above, this reduction is valid without taking
any large distance limit.  The resulting supersymmetric gauge theory on $M'=\R^4\times \R$ is infrared-free  (in sharp contrast to the underlying $(0,2)$ model in six dimensions)  and can be
analyzed by classical methods.  In particular, the condition for $Q$-invariance becomes the HW equations, which were mentioned in Lecture One.    These are equations for a pair
consisting of a gauge field $A$, and a field $B$ on $\R^4\times \R$ that is an adjoint-valued section of the pullback to $\R^4\times \R$ of the bundle of selfdual two-forms on $\R^4$.

A surface operator
in six dimensions supported on $\Sigma\times q$ reduces in the gauge theory description to an 't Hooft-like surface operator supported on $\Sigma\times q'$, where $q\in \R\times S^1$
projects to $q'\in \R$.  A solution of the HW equations in the presence of this surface operator is supposed to have a singularity along $\Sigma\times q'$.  
This codimension three singularity should be modeled on the standard codimension three singularity of the Bogomolny equations, suitably embedded in the HW equations with
gauge group $G$.

   To categorify the quantum knot invariants associated to a representation $R^\vee$ of a 
simply-laced\footnote{If $G^\vee$ is not simply-laced, one requires a refinement described in section 5.5 of \cite{Witten}.}   compact Lie
group $G^\vee$, one studies
the HW equations with gauge group $G$ (the Langlands-GNO dual of $G^\vee$, which in particular has the same Lie algebra as $G^\vee$ if $G$ is simply-laced),
and with the appropriate singularity along $\Sigma\times q'$.  The appropriate singularity is obtained, as discussed in Lecture One, by embedding a singular $U(1)$ solution in $G$ using
the homomorphism $\rho:\frak{u}(1)\to\frak t\subset \frak{g}$ that is dual to $R^\vee$.

The HW equations on $\R^4\times \R$ are compatible with the familiar codimension three singularity on a two-manifold  $ V\subset \R^4\times \R$ 
if and only if $V$ is of the form $\Sigma\times q'$ with $\Sigma\subset \R^4$, $q'\in \R$.  This statement is easily verified by inspection of the HW equations.
The explanation that we have given here starting with the $(0,2)$ model serves to explain ``why'' it is true.   The restriction to $V\subset \R^4\times q'\subset \R^4\times \R$
is completely essential for getting knot theory out of this construction, since the relevant topology would disappear if $V$ were free to move in five dimensions.
For example, Khovanov homology arises in the ``time''-independent case $\Sigma=\R_t\times K\subset \R_t\times\R^3=\R^4$, where $K$ is a knot in $\R^3$ and the first factor in $\R^4=\R_t\times \R^3$
is parametrized by the ``time.''  If $V$ were free to vary in $\R^4\times \R$,
then $K$ would be free to vary in $\R^3\times \R$ (the product of the last two factors in $\R^4\times \R=\R_t\times \R^3\times \R$), and could be trivially unknotted.  Much the same point was
made   in Lecture One.   A more general
$V$ (not of the time-independent form $\R_t\times K$) is used to define the ``morphisms'' of Khovanov homology.

What we have described corresponds to the singly-graded version of Khovanov homology (with only the cohomological grading and no ``$q$''-grading).
The single grading comes from the symmetry group $F\cong \Spin(2)$ that was maintained throughout the construction.   To get doubly-graded Khovanov homology,
one takes $C$ to be not $\C^*=\R\times S^1$ but $\C$.  This is done by adding to $\C^*$ a point $q_0$ ``at infinity.''  $\C$ admits an $S^1$ action, leaving fixed the point $q_0$.
In the underlying $(0,2)$ model, one considers a surface operator supported on $U=\Sigma\times q_0$.  Reduction of $M\times C$ on the orbits of $S^1$ leads now to a description
in terms of gauge theory on $M\times \R_+$ (where $\R_+$, a half-line, is the quotient $C/S^1$).  The $S^1$ action leads to the desired second grading.
This doubly-graded version of the construction was the main subject of \cite{Witten}, and the details will not be repeated here.



Research supported in part by NSF Grant PHY-1314311. I thank M. Abouzaid, C. Manolescu, and R. Mazzeo for discussions.

\bibliographystyle{unsrt}
\begin{thebibliography}{99}

\bibitem{GVS}
S. Gukov, A. S. Schwarz, and C. Vafa,
``Khovanov-Rozansky Homology And Topological Strings,''
Lett. Math. Phys. {\bf 74} (2005) 53-74, hep-th/0412243.

\bibitem{OV}
H. Ooguri and C. Vafa, ``Knot Invariants And Topological Strings,''  Nucl. Phys.
{\bf{B577}}
(2000) 419, hep-th/9912123.

\bibitem{Witten}
E. Witten, ``Fivebranes And Knots,'' Quantum Topology {\bf 3} (2012) 1-137, arXiv:1101.3216.

\bibitem{WittenOne}
E. Witten, ``Khovanov Homology and Gauge Theory,''  in  R. Kirby, V. Krushkal, and Z. Wang, eds.,
{\it Proceedings Of The FreedmanFest} (Mathematical Sciences Publishers, 2012) 291-308, arXiv:1108.3103.

\bibitem{WittenTwo}
E. Witten, ``Two Lectures On The Jones Polynomial And Khovanov Homology,'' arXiv:1401.6996.

\bibitem{SS}
P. Seidel and I. Smith, ``A Link Invariant From The Symplectic Geometry of Nilpotent Slices,'' Duke Math. J. {\bf 134}
(2006) 453-514.

\bibitem{Manolescu}
C Manolescu, ``Nilpotent Slices, Hilbert Schemes, and the Jones Polynomial,'' Duke Math. J.  {\bf 132} (2006) 311-369.

\bibitem{AS}
M. Abouzaid and I. Smith, ``Khovanov Homology From Floer Cohomology,'' arXiv:1504.01230.

\bibitem{Jones}
V. F. R. Jones, ``A Polynomial Invariant For Knots Via Von Neumann Algebra,'' Bull. Am. Math. Soc. {\bf 12} (1985) 103-11.

\bibitem{AtiyahFloer}
M. F. Atiyah, ``Floer Homology,'' Progr. Math.  {\bf 133} (1995) 105.

\bibitem{GaiWit}
D. Gaiotto and E. Witten, ``Knot Invariants From Four-Dimensional Gauge Theory,''  Adv. Theor. Math. Phys. {\bf 16} (2012)  935, arXiv:1106.4789.

\bibitem{K} J. Kamnitzer, ``The Beilinson-Drinfeld Grassmannian and Symplectic Knot Homology,'' in D. A. Ellwood (ed.), {\it Grassmannians,
Moduli Spaces, and Vector Bundles} (Clay Math Institute, Cambridge MA and American Mathematical Society, Providence RI, 2011) 81-94.

\bibitem{CK} S. Cautis and J. Kamnitzer, ``Knot Homology Via Derived Categories Of Coherent Sheaves, I. The $\mathfrak{sl}(2)$ Case,''
Duke Math. J. {\bf 142} (2008) 511-588.

\bibitem{thooft} G. 't Hooft, ``On The Phase Transition Towards Permanent Quark Confinement,'' Nucl. Phys. {\bf B138} (1978) 1-25.

\bibitem{KW} A. Kapustin and E. Witten, ``Electric-Magnetic Duality And The Geometric Langlands Program,'' Commun. Numb. Th. Physics
{\bf 1} (2007) 1-236.

\bibitem{Bigelow}
S. Bigelow, ``A Homological Definition Of The Jones Polynomial,'' {\it Geometry and Topology Monographs}, Volume 4: Invariants of Knots and 3-Manifolds
(Kyoto, 2001), pp. 29-41.


\bibitem{Lawrence}
R. Lawrence, ``A Functorial Approach to the One-Variable Jones Polynomial,'' J. Diff. Geom. {\bf 37}  (1993) 689-710.

\bibitem{GalMoore}
D. Galakhov and G. W. Moore, ``Comments On The Two-Dimensional Landau-Ginzburg Approach,''
arXiv:1607.04222.

\bibitem{Haydys}
A. Haydys, ``Fukaya-Seidel Category And Gauge Theory,'' J. Symp. Geom. {\bf 13} (2015) 151-207,  arXiv:1010.2353.

\bibitem{GPV}
S. Gukov, P. Putrov, and C. Vafa, ``Fivebranes and 3-manifold Homology,'' arXiv:1602.05302.


\bibitem{MW}
R. Mazzeo and E. Witten,  ``The Nahm Pole Boundary Condition,''  in {\it The Influence Of Solomon Lefschetz in Geometry and Topology}, ed. L. Katzarkov et. al.
(American Mathematical Society, 2014),
 arXiv:1311.3167.

\bibitem{MWtwo} R. Mazzeo and E. Witten, ``The Nahm Pole Boundary Condition With Knots,'' to appear.



\bibitem{N}
W. Nahm, ``All Selfdual Multimonopoles for Arbitrary Gauge Groups'' (NATO ASI, 1983).

\bibitem{Corlette}
K. Corlette, ``Flat $G$-Bundles With Canonical Metric,'' J. Diff. Geom. {\bf 28} (1988) 361-82.

\bibitem{Mikhaylov}
V. Mikhaylov, ``On The Solutions Of Generalized Bogomolny Equations,'' JHEP 05 (2012) 112, arXiv:1202.4848.

\bibitem{Gaiotto}
D. Gaiotto, ``$\mathcal N=2$ Dualities,'' JHEP {\bf 1208} (2012) 034, arXiv:0904.2715.


\end{thebibliography}

\end{document}
========================================

\documentclass[12pt]{article} 
\usepackage[hyperfootnotes=false]{hyperref}
 %  \usepackage{epsfig}
     \usepackage{amsmath}
      \usepackage{amssymb}
  \usepackage{graphicx}
  \usepackage{xcolor}
  \setlength{\topmargin}{-.5in} \setlength{\oddsidemargin}{.0in}
  %\setlength{\evensidemargin}{-.21in}
  \setlength{\textheight}{8.7in} \setlength{\textwidth}{6.35in}
  \setlength{\footnotesep}{\baselinestretch\baselineskip}
  \newlength{\abstractwidth}
  \setlength{\abstractwidth}{\textwidth}
  \addtolength{\abstractwidth}{-6pc}
  \newcommand{\OL}[1]{ \hspace{1pt}\overline{\hspace{-1pt}#1
     \hspace{-1pt}}\hspace{1pt} }
 
%  \usepackage{showlabels}
 \usepackage{mciteplus} 

% \usepackage{xcolor}
 

\newcommand{\onefigure}[2]{\begin{figure}[htb]
\begin{center}\leavevmode\epsfbox{#1.eps}\end{center}
\caption{#2\label{#1}}

 \end{figure}}

\newcommand{\onefigureme}[3]{\begin{figure}[htb]
\begin{center} #3 \end{center}\caption{#2\label{#1}}

 \end{figure}}


   \thispagestyle{empty} \pagestyle{plain}

  %\renewcommand{\thefootnote}{\fnsymbol{footnote}}
  %\renewcommand{\thanks}[1]{\footnote{#1}} % Use this for footnotes
  %\newcommand{\starttext}{
  %\setcounter{footnote}{0}
  %\renewcommand{\thefootnote}{\arabic{footnote}}}
  
  \renewcommand{\theequation}{\thesection.\arabic{equation}}
  \newcommand{\be}{\begin{equation}}
  \newcommand{\bea}{\begin{eqnarray}}
  \newcommand{\eea}{\end{eqnarray}}
  \newcommand{\beq}{\begin{equation}}
  \newcommand{\ee}{\end{equation}}
  \newcommand{\eeq}{\end{equation}}
  \newcommand{\N}{{\cal N}}
  \newcommand{\<}{\langle\,}
  \newcommand{\oc}{{\cal O}_C}
  \renewcommand{\a}{\alpha}
  \renewcommand{\b}{\beta}
  \newcommand{\half}{{1\over 2}}
  \renewcommand{\>}{\rangle}

\def\32{{3 \over 2 } }
\def\sign{ {\rm sgn} }
\def\diff{\text{diff}}
  \def\ba{\begin{eqnarray}}
  \def\ea{\end{eqnarray}}
  \newcommand{\PSbox}[3]{\mbox{\rule{0in}{#3}\special{psfile=#1}\hspace{#2}}}
 
 \def\simleq{\; \raise0.3ex\hbox{$<$\kern-0.75em
      \raise-1.1ex\hbox{$\sim$}}\; }
 \def\simgeq{\; \raise0.3ex\hbox{$>$\kern-0.75em
      \raise-1.1ex\hbox{$\sim$}}\; }
 
\def\XM{q}
\def\YM{p}

\def\WM{\YM}
\def\ZM{{\YM'}}
\def\R{{\Bbb R}}
\def\Z{{\Bbb Z}}
\def\Ber{\text{Ber}}
\def\M{{\mathcal M}}

\def\Malpha{\gamma}
\def\Mbeta{\delta}

\def\taul{{\hat \tau }}
\def\tl{{\hat t}}
\def\ul{{\hat u}}
\def\sch{\Sch}
\def\Sch{{\rm Sch}}
%%%%%%%%%%%%%%%%%%%%%%%

\def\nref#1{(\ref{#1})}

% To insert figures: 
%\begin{figure}[h]
%\begin{center}
%\includegraphics[scale=1.]{RegionDefect}
%\caption{The R\'enyi entropies for an interval $A$ involve the two point function of defect operators $D$  inserted at the endpoints of the interval. 
%An operator in the $i^{th}$ CFT becomes an operator in the $(i+1)^{th}$ CFT when we go around the defect.}
%\label{RegionDefect}
%\end{center}
%\end{figure}



  \begin{document}






\begin{titlepage}
  \bigskip


  \bigskip\bigskip 
 
{\color{white} .}
 \vspace{20pt}


  \bigskip

\begin{center}
{\Large \bf {Fermionic Localization }}\vskip.2cm{\Large\bf{ of the Schwarzian Theory}}
 \bigskip
{\Large \bf { }} 
    \bigskip
\bigskip
\end{center}






  \begin{center}


 \bf {Douglas Stanford  and Edward Witten}
  \bigskip \rm
\bigskip
 
   Institute for Advanced Study,  Princeton, NJ 08540, USA  

  \bigskip \rm
\bigskip
 
\rm


\bigskip
\bigskip



% \vspace{2cm}
  \end{center}

   


 \bigskip\bigskip
  \begin{abstract}

The SYK model is a quantum mechanical model that has been proposed to be holographically dual to a $1+1$-dimensional model of a quantum black hole.
An emergent ``gravitational'' mode of this model is governed by an unusual action that that has been called the Schwarzian action.  It governs
a reparametrization of a circle.  We show that the path integral of the Schwarzian theory is one-loop exact.
The argument uses a method of fermionic localization, even though the model itself is purely bosonic.
  

 \medskip
  \noindent
  \end{abstract}
\bigskip \bigskip \bigskip
 
 

  \end{titlepage}

 

  %  \starttext \baselineskip=17.63pt \setcounter{footnote}{0}
   \tableofcontents

 % \sc
\def\Tr{{\mathrm{Tr}}}
\def\Pf{{\mathrm{Pf}}}

\section{Introduction}
The low-energy description of the SYK model \cite{Sachdev:1992fk,KitaevTalks} and of certain two-dimensional dilaton gravity models \cite{Jackiw:1984je,Teitelboim:1983ux,Almheiri:2014cka} is a theory of a degree of freedom $\phi(\tau)$ that describes a reparametrization of the thermal circle. This theory can be understood as the dynamics of a pseudo-Goldstone mode for the breaking of reparametrization invariance, and it is expected to describe a wide variety of systems with emergent approximate 1d conformal symmetry. The partition function is \cite{KitaevTalks,Maldacena:2016hyu,Jensen:2016pah,Maldacena:2016upp,Engelsoy:2016xyb}
\be\label{schZ}
Z(g) = \int\frac{d\mu[\phi]}{SL(2,\R )}\exp\left[-\frac{1}{2g^2}\int_0^{2\pi} d\tau\left(\frac{\phi''^2}{\phi'^2} - \phi'^2\right)\right].
\ee
The field $\phi(\tau)$ is restricted to be monotone increasing and to wind once around the circle, $\phi(\tau + 2\pi) = \phi(\tau) + 2\pi$, and we mod out by an $SL(2,\R )$ that acts as $f\rightarrow \frac{a f + b}{cf + d}$ where $f = \tan\frac{\phi}{2}$. The $SL(2,\R)$ invariance of the action is made more obvious by writing it as
\be\label{schaction}
I = \frac{1}{2g^2}\int d\tau\left(\frac{\phi''^2}{\phi'^2} - \phi'^2\right) = -\frac{1}{g^2}\int d\tau \left(\Sch(\phi,\tau) + \frac{1}{2}\phi'^2\right) = -\frac{1}{g^2}\int d\tau  \ \Sch\left(\tan\frac{\phi}{2},\tau\right).
\ee
Here
\be\label{schwdef}
\Sch(\phi,\tau)=\frac{\phi'''(\tau)}{\phi'(\tau)}-\frac{3}{2}\left(\frac{\phi''(\tau)}{\phi'(\tau)}\right)^2\ee
is the Schwarzian derivative of a change of coordinates in one dimension.  
We will refer to (\ref{schZ}) as the Schwarzian theory.

In the context of the SYK model, the coupling $g$ is related to the inverse temperature $\beta$, the original SYK coupling $J$, and the number of fermions $N$, by $\frac{1}{g^2}\propto \frac{N}{\beta J}$. At large $N$ and fixed temperature, this is a weakly coupled theory, dominated by small fluctuations about the saddle point $\phi = \tau$. But at very low temperatures $\beta > \frac{N}{J}$ the theory is strongly coupled, and the partition function is dominated by fluctuating configurations of the $\phi(\tau)$ field far from the saddle (see figure \ref{MC} in Appendix \ref{lattice} for pictures). This suggests that the low-energy properties of the SYK model might be difficult to study.

However, the purpose of this paper is to show that the integral (\ref{schZ}) is one-loop exact:\footnote{The work of \cite{Bagrets:2016cdf} already suggested that the Schwarzian theory was exactly solvable. Further strong evidence for one-loop exactness of this integral was reported in \cite{Cotler:2016fpe}. See also the recent work \cite{Bagrets:2017pwq}.}
\be
Z(g) = Z_{\mathrm{one-loop}}(g) = \frac{\#}{g^3}\exp\left(\frac{\pi}{g^2}\right).
\ee 
(Here $\#$ is a constant that depends on regularization but does not depend on $g$.)
As we will see, this fact can be explained by the Duistermaat-Heckman (DH) formula \cite{duistermaat1982variation}, which states that the integral over a symplectic manifold of $\exp(H/g^2)$, where $H$ generates via Poisson brackets a $U(1)$ symmetry of the manifold, is one-loop exact.\footnote{This assertion is actually a special case of a more general localization principle in equivariant cohomology \cite{BV,AB}. (This more general principle has been used, for example, in computing the prepotential of $\N=2$ supersymmetric theories in four dimensions \cite{Nekrasov}.) The statement that the path integral is one-loop exact assumes that the fixed
points of the $U(1)$ symmetry are isolated.  The general statement involves an integral over this fixed point set.
There is also a generalization that involves localization by nonabelian symmetries \cite{WittenOldpaper,JK,CMR}. We will not need any of
these generalizations here.} To apply the DH formula to the integral (\ref{schZ}), we need two facts. First, the space over which we integrate in (\ref{schZ}) is $\text{diff}(S^1)/SL(2,\R )$, which is symplectic.%\footnote{D.S. is grateful to Nikita Nekrasov and to Greg Moore for comments about the symplectic structure of $\text{diff}(S^1)/SL(2,\R )$ and the suggestion that this might be relevant to SYK.}
 And second, the Schwarzian action generates a $U(1)$ symmetry of this manifold that corresponds to time translations. Together, these two facts explain the one-loop exactness.

The Duistermaat-Heckman formula may be unfamiliar to some readers, so we will sketch a physics proof (along the lines of \cite{Bismut:1986oha,WittenOldpaper}). Suppose given a symplectic manifold $M$ with coordinates $x^i$, and with a Hamiltonian $H$ that generates a $U(1)$ symmetry via
\be
\delta x^i  = v^i = \omega^{ij}\partial_j H.
\ee
Here, $\omega^{ij}$ is the inverse of the symplectic form $\omega_{ij}$. We would like to evaluate the integral
\be\label{dhZ}
Z = \int d^nx d^n\psi \exp\left[\frac{1}{2}\omega_{ij}\psi^i\psi^j + \frac{H(x)}{g^2}\right].
\ee
Here the $\psi^i$ are Grassmann variables that transform  under diffeomorphisms of $M$ as the differentials $d x^i$, so that there is a natural measure $d^nx d^n\psi$.
Integrating out the $\psi$'s in eqn. (\ref{dhZ})  gives the symplectic measure $\mathrm{Pf}(\omega)d^nx$ for the integral over the $x$ coordinates (here $\mathrm{Pf}(\omega)$ is the Pfaffian\footnote{The Pfaffian is the square root of the determinant, but for an antisymmetric matrix such as $\omega$, it is more natural to speak of the Pfaffian.}
of the antisymmetric matrix $\omega_{ij}$).  This is the usual symplectic measure on the symplectic manifold $M$. The point of writing the measure this way is that (\ref{dhZ}) has a fermionic symmetry
\be
Qx^i = \psi^i, \hspace{20pt} Q \psi^i = v^i
\ee
that allows us to analyze the integral by  localization. To check the fermionic symmetry, one uses the fact that the symplectic form is closed, $d\omega = 0$. One can further check that $Q^2$ acts as the generator  of the $U(1)$ symmetry. Accordingly, $Q^2=0$ in acting on $U(1)$-invariant operators or functions.
It follows that we can add $QV$ to the action, for any $U(1)$-invariant $V$, without changing the integral. To prove the DH formula, we choose $V = g_{ij}v^i\psi^j$ where $g_{ij}$ is any $U(1)$-invariant metric. Then we add $QV$ to the action with a large coefficient. This localizes the integral to the critical points of $H$, along with the correct measure for the one-loop integral about those points. This establishes the one-loop exactness. We give some more details on this proof in a slightly more general setting in Appendix \ref{appendixDH}.

The plan of this paper is as follows. In section two, we will discuss the case of the Schwarzian theory in more detail, including the the symplectic form, the associated measure, perturbation theory, and the exact partition function. In section three, we will give further details on the relationship of the Schwarzian theory to the coadjoint orbit of Virasoro, and discuss some generalizations. In particular, we discuss the exact partition function and density of states of the $\mathcal{N} =1 $ and $\mathcal{N} = 2$ super-Schwarzian theories \cite{Fu:2016vas}. In Appendix A, we describe the extension of the DH formula
to a supermanifold.  In Appendix B, we describe a lattice regularization of the Schwarzian theory and some sample monte carlo configurations.
Finally, in Appendix C, we discuss some simple correlation functions in the Schwarzian theory.




\section{The Schwarzian Theory}

The localization argument for the Schwarzian theory relies on two facts:  the space we are integrating over is symplectic, and the action generates a $U(1)$ symmetry of that space. We will explain both of these facts in this section, before showing mechanically that the two-loop term vanishes and discussing the exact one-loop answer.

\subsection{The Symplectic Form and the Hamiltonians}\label{symham}
The space that we integrate over in the path integral (\ref{schZ}) is the symplectic manifold $\text{diff}(S^1)/SL(2,\R )$. As a first step, we should understand the symplectic form for this space and the integration measure that follows from it. The form $\omega$ can be derived from the fact that $\text{diff}(S^1)/SL(2,\R )$ is the orbit of a particular coadjoint vector under the action of the Virasoro group \cite{kirillov1981orbits,Witten:1987ty,Bakas:1988bq}, and coadjoint orbits are always symplectic. See section \ref{sthree} for more details.
We also give a direct explanation momentarily.

We can label points on $\text{diff}(S^1)/SL(2,\R)$ by elements $\tau(\phi)$ of $\text{diff}(S^1)$, with the understanding that we are identifying by a right action of $SL(2,\R)$ as $f\equiv \tan\frac{\phi}{2}\rightarrow \frac{af+b}{cf+d}$. In the application to the Schwarzian theory, it turns out to be somewhat more convenient to think in terms of the inverse $\text{diff}(S^1)$ element, which we write as $\phi(\tau)$. This is the same variable that appears in the action (\ref{schaction}). With this choice of coordinate, the symplectic form is given by \cite{Witten:1987ty,Alekseev:1988ce}
\begin{align}\label{omega}
\omega &= \int_0^{2\pi}d\tau\left[\left(\frac{d\phi(\tau)}{\phi'(\tau)}\right)'\wedge\left(\frac{d\phi(\tau)}{\phi'(\tau)}\right)'' - 2\,\Sch\left(\tan\frac{\phi}{2},\tau\right)\left(\frac{d\phi(\tau)}{\phi'(\tau)}\right)\wedge \left(\frac{d\phi(\tau)}{\phi'(\tau)}\right)'\right]\\
&=\int_0^{2\pi} d\tau \left[\frac{d\phi'(\tau)\wedge d\phi''(\tau)}{\phi'^2(\tau)} - d\phi(\tau)\wedge d\phi'(\tau)\right].\label{omega2}
\end{align}

This formula probably requires some explanation.  First of all, here $d$ is an abstract exterior derivative that acts on the field $\phi$ but not on
the spatial coordinate $\tau$ (or on a function of $\tau$).  One can think of $\phi(\tau)$ as a bosonic function in one dimension and $\psi(\tau)=d\phi(\tau)$
as a fermion.  As $d$ does not act on $\tau$, likewise it commutes with $\partial_\tau$, so for instance $d\phi'=d(\partial_\tau\phi)$ is the same as
$\partial_\tau d\phi$.  Using such facts, we  can rewrite (\ref{omega2}) in the form
\be\label{omega3} \omega=\int_0^{2\pi}d\tau\left( \left(\frac{d\phi'}{\phi'}\right)\partial_\tau\left(\frac{d\phi'}{\phi'}\right) -d\phi\partial_\tau d\phi\right).\ee
We have omitted the explicit wedge product symbol -- which one can think of as a reminder that $d\phi(\tau)$ is a fermionic field -- and we have
added a term that vanishes because $(d\phi')^2=0$ by fermi statistics.

Now let us describe and verify the important properties of $\omega$.   The first basic property is that it is closed, $d\omega=0$.  This is actually manifest in eqn.
(\ref{omega3}), which has been written entirely in terms of $d\phi$ and $d\phi'/\phi'=d\log\phi'$  (and their $\tau$ derivatives), both of which are exact and
in particular closed.

The second basic property of $\omega$ is that it is invariant under $\diff\,S^1$ acting on $\tau$.  An infinitesimal $\diff\,S^1$ transformation $\delta \tau=\alpha(\tau)$
acts on $\phi$ by 
\be\label{umn}\delta \phi(\tau)=\alpha(\tau)\phi'(\tau). \ee
This corresponds to a vector vield $V_\alpha$ on the space of $\phi$'s.  We want to know if $V_\alpha$ leaves $\omega$ invariant.

In general, if $\Omega$ is any differential form and $V$ is any vector field, the condition that $V$ leaves $\Omega$ fixed is that $(d\iota_V+\iota_V d)\Omega=0$.
Here $\iota_V$ is the operation of contracting $V$ with  $\Omega$.  If $d\Omega=0$, the condition reduces to $d(\iota_V\Omega)=0$.
We are in that situation because $d\omega=0$, so to show that $\omega$ is $V_\alpha$-invariant, we have to show that $d(\iota_{V_\alpha}\omega)=0$.
We will do this by finding a function $H_\alpha$ such that 
\be\label{defham}\iota_{V_\alpha}\omega=d H_\alpha.\ee

These functions have a special interpretation (or more exactly will have such an interpretation after we remove zero-modes and make $\omega$
nondegenerate). If $\omega$ is a symplectic form, then eqn. (\ref{defham}) means\footnote{In terms of indices, this equation reads $V_\alpha^i\omega_{ij}=\partial_j H_\alpha$.
This is equivalent to $V_\alpha^i=(\omega^{-1})^{ij}\partial_j H_\alpha$, which may be a more familiar version of the formula.} that  $H_\alpha$ is the Hamiltonian function that via Poisson brackets generates the infinitesimal transformation
(\ref{umn}) of $\phi$.  In particular, on setting $\alpha=1$, we will get the  Hamiltonian function $H$ associated to the ``time'' translation symmetry
 $\delta\phi=\phi'$. It will turn out that this function (up to a factor of $-1/g^2$) is the Schwarzian action (\ref{schaction}).  That fact is the basic reason
 that the Duistermaat-Heckman formula is relevant to the Schwarzian theory.  
   
 Concretely, $\iota_{V_\alpha}\omega$ is computed by replacing  one copy of $d\phi$ in eqn. (\ref{omega3}) with $\delta\phi=\alpha \phi'$.   One makes
 this replacement for any one copy of $d\phi$, but one has to take account of signs: $\iota_{V_\alpha}$ is regarded as a fermionic operator that anticommutes   
 with $d\phi$, so we include a plus or minus sign if it acts on the leftmost or rightmost factor of $d\phi$.   To make this explicit, let us write $\omega=\omega_1
 +\omega_2$, with $\omega_2=-\int_0^{2\pi}d\tau \,d\phi\partial_\tau d\phi$ and $\omega_1=\omega-\omega_2$.   
 Then $\iota_{V_\alpha}\omega_2=-2\int_0^{2\pi}d\tau \,\alpha\phi' \partial_\tau d\phi
 =-2\int_0^{2\pi}d\tau \,\alpha \phi' d\phi'$.  But this is $d H_{\alpha,2}$ with $H_{\alpha,2}=-\int_0^{2\pi}d\tau \,\alpha \,\phi'^2$.  
 
Similarly, 
\be\label{zota}\iota_{V_\alpha}\omega_1=2\int_0^{2\pi}d\tau\,\left(\frac{\partial_\tau(\alpha\phi')}{\phi'} \partial_\tau\frac{d\phi'}{\phi'}\right)=2\int_0^{2\pi}
d\tau\left(\left(\alpha'   +\alpha \frac{\phi''}{\phi'} \right)\partial_\tau \frac{ d\phi'}{\phi'}\right). \ee 
But this is $dH_{\alpha,1}$ with $H_{\alpha,1}=\int_0^{2\pi}d\tau\,\left(2\alpha' \frac{\phi''}{\phi'}+\alpha \left(\frac{\phi''}{\phi'} \right)^2\right)$.
Here we use $\partial_\tau (d\phi'/\phi')=d(\phi''/\phi')$.

Finally, then, the Hamiltonian function that generates the $\diff\,S^1$ transformation $\delta\phi=\alpha\phi'$ will be
\be\label{mota}H_\alpha=\int_0^{2\pi}d\tau \left( \alpha\left(\left(\frac{\phi''}{\phi'}\right)^2-(\phi')^2\right)+2\alpha' \frac{\phi''}{\phi'}\right) = -2\int_0^{2\pi}d\tau\, \alpha\,\sch\left(\tan\frac{\phi}{2},\tau\right).\ee
Setting $\alpha=1$, we learn that the ordinary Hamiltonian that generates $\delta\phi=\phi'$ will be the Schwarzian action (\ref{schaction}), up to a factor of $1/2g^2$.

So far, we have shown that $\omega$ is closed and $\diff\,S^1$ invariant and we have identified what will be the Hamiltonian functions.  
We still have to explain in what sense $\omega$ can be interpreted as a symplectic form.
Since $\phi(\tau)$ is monotone increasing and winds once around the circle, it can be interpreted as an element of $\diff\,S^1$, mapping $\tau$ to $\phi(\tau)$.  The form $\omega$ is a closed
form on $\diff\,S^1$, but is not symplectic because it is degenerate, that is it has zero-modes.  To see the zero-modes in the most direct way, let us expand around $\phi=\tau$,
which we think of as the identity element of $\diff\,S^1$, with $\phi=\tau+\sum_n u_n e^{in \tau}$.  At $u_n=0$,  one finds that
$\omega=(-2\pi i) \sum_{n\in \Z} (n^3-n)d u_n d u_{-n}$.  The function $n^3-n$ vanishes precisely for $n=-1,0,1$, so at the identity element of $\diff\,S^1$, $\omega$
has precisely three zero-modes, that is, it has a three-dimensional kernel.  Since $\omega$ is $\diff\,S^1$-invariant, the same is true everywhere.

The three zero-modes have a simple interpretation.   For $n=1,0,-1$, let $W_n$ be the vector field
\be\label{vecf}\delta\phi =e^{in\phi}. \ee
They generate an action of $SL(2,\R)$ on $\phi$, and this action commutes with the $\diff\,S^1$ action generated by the $V_\alpha$.   One may ask if $\omega$
is invariant under this second action of $SL(2,\R)$.  The criterion is again that $d\iota_{W_n}\omega=0$.  But here a short calculation with some integration by parts
reveals that more is true:
$\iota_{W_n}\omega=0$.  Thus $W_n$ are the three zero-modes of $\omega$.  $SL(2,\R)$ invariance of $\omega$ would require the weaker condition $d(\iota_{W_n}\omega)=0$.
The fact that actually $\iota_{W_n}\omega=0$ even without acting with $d$ means that $\omega$ is not just $SL(2,\R)$-invariant but is a ``pullback'' from a quotient space
in which one divides by $SL(2,\R)$.

Let us recall that if $G$ is a nonabelian group, then there is a left and right action of $G$ on itself.  The left action on $g\in G$ is by $g\to fg$, and the right action is by
$g\to g h^{-1}$, where here $f,h\in G$.  It is a matter of convention which is called the ``left'' action and which the ``right'' action, as the two are exchanged by $g\to g^{-1}$.
In the case at hand, the group of interest is $\diff\,S^1$, parametrized by $\phi$.  The ``left'' action is generated by $\delta\phi=\epsilon(\tau)\partial_\tau\phi$.
It commutes with the ``right'' action, which is generated by $\delta\phi=g(\phi)$ for an arbitrary function $g(\phi)=\sum_{n\in \Z}g_n e^{in\phi}$.    What we have found
in the last paragraph is that $\omega$ is a pullback from $\diff\,S^1/SL(2,\R)$, where $SL(2,\R)$ acts on the right as a subgroup of $\diff\,S^1$.  Differently put, we can view $\omega$ as a closed two-form on the
quotient space $\diff\,S^1/SL(2,\R)$.  If we do this, since we have removed the zero-modes, $\omega$ becomes nondegenerate and therefore is a symplectic form.
The quotient space $\diff\,S^1/SL(2,\R)$ admits only one action of $\diff\,S^1$, which descends from the left action of $\diff\,S^1$ on itself.  When viewed as a form 
on the quotient space, $\omega$ is $\diff\,S^1$-invariant, since it is left-invariant as a form on the group manifold.  


In general, given a symplectic manifold, once one picks  coordinates $u_1,\dots,u_n$,
the symplectic form becomes an antisymmetric matrix and the  measure in that coordinate
system is $d^nu$ times the Pfaffian of the matrix. In the present context, we use the function $\phi(\tau)$ (subject to a gauge condition to remove
zero-modes) to parametrize $\diff\,S^1/SL(2,\R)$.  In this parametrization, the symplectic measure is not just the ordinary path integral
measure $D\phi$, but is this times the Pfaffian of the symplectic form.  From a physical point of view, the evaluation of the Pfaffian is
more understandable 
 if we rename $d\phi(\tau)$ as a fermion field $\psi(\tau)$.  Then $\omega$, being bilinear in $\psi$,
is a quadratic fermion action, and the Pfaffian of $\omega$ is just the path integral for $\psi$ with this action.   We turn next
to an analysis of that path integral.




\subsection{Evaluation of the Measure}
Naively, it seems that the Pfaffian of (\ref{omega}) will give a nonlocal measure for $\phi$. However, this depends on the choice of gauge that is used to remove
$SL(2,\R)$ zero-modes.  If we pick a local gauge condition, like $\phi(0) = 0$, $\phi'(0) = 1$, $\phi''(0) = 0$, then the measure actually turns out to be local, and equal to the measure on $\text{diff}(S^1)/SL(2,\R )$ inherited from the measure on $\text{diff}(S^1)$ discussed in \cite{Bagrets:2016cdf}:
\be\label{naiveM}
d\mu_{\text{diff}(S^1)}[\phi] = \prod_\tau \frac{d\phi(\tau)}{\phi'(\tau)}.
\ee

Let us show in some detail how to derive this from the symplectic form. It is convenient to work with the expression for $\omega$ on the first line of (\ref{omega}). To compute the Pfaffian we view this as (minus two times) an action for a periodic fermion variable $\psi = d\phi(\tau)$. We can simplify the action somewhat by defining a new fermion variable $\eta = \psi/\phi'$. The change of variables from $\psi$ to $\eta$ gives us the infinite product of $1/\phi'(\tau)$ in (\ref{naiveM}) (minus three factors  for the gauge-fixing). This looks promising, but we have a leftover 
fermionic integral that seems to depend on $\phi(\tau)$:
\be\label{pfoft}
\int D\eta\, \eta(0)\eta'(0)\eta''(0)\exp\left[\frac{1}{2}\int d\tau \Big(\eta'\eta'' - T(\tau)\eta\eta'\Big)\right], \hspace{20pt} T(\tau) \equiv 2\,\Sch\left(\tan\frac{\phi}{2},\tau\right).
\ee
Remarkably, (\ref{pfoft}) is actually independent of $\phi(\tau)$. To show this, we evaluate the path integral by representing it as a trace in a Hilbert space. In other words, we canonically quantize the $\eta$ action. We can construct an equivalent action  that is linear in $\tau$ derivatives
by ``integrating in'' some additional fields:
\begin{align}\label{fot}
\int D\eta\, &\eta(0)\eta'(0)\eta''(0)\exp\left[\frac{1}{2}\int d\tau \Big(\eta'\eta'' - T(\tau)\eta\eta'\Big)\right]\\
&=\int {D}\eta\,{D}w\,{D}b \,{D}c\, c(0)\eta(0)b(0)b'(0)\exp\left[\frac{1}{2}\int d\tau\Big(w(\eta'-b) + b b' - T(\tau)\eta b -cc'\Big)\right]. \notag
\end{align}  (All fermion fields here are assumed to be periodic on the circle.)
Integrating out $w$ sets $b = \eta'$.  The action in (\ref{fot}) then reduces to the previous action in (\ref{pfoft}) and the fermion insertions $\eta(0)b(0)b'(0)$ reduce to the insertions $\eta(0)\eta'(0)\eta''(0)$
in (\ref{pfoft}). In order to have an even number of Majorana fermions, we have included in (\ref{fot}) a fourth decoupled field $c$ (and an insertion of $c(0)$ to make the periodic path integral nonzero).  For future reference, note that the equation of motion for $b$ gives $2b'+w+T(\tau)\eta=0$, so $c(0)\eta(0)b(0)b'(0)$
will be equivalent as an operator acting on physical states to $-\frac{1}{2} c(0)\eta(0)b(0)w(0)$:
\be\label{useeq}c(0)\eta(0)b(0)b'(0)\sim -\frac{1}{2} c(0)\eta(0)b(0)\left[w(0) +T(0)\eta(0)\right] = -\frac{1}{2} c(0)\eta(0)b(0)w(0).\ee
In the final step we used that $\eta(0)^2 = 0$.

To understand the Hilbert space for $w,b,\eta,c$, it is convenient to write the fields in terms of four canonical Majorana fermions
\be
\eta = \chi_1 + i\chi_2, \hspace{20pt} w = -\chi_1 + i\chi_2, \hspace{20pt} b = i\chi_3, \hspace{20pt} c = \chi_4.
\ee
Then the exponential  in (\ref{fot}) becomes
\be\label{readoff}
\exp\left[-\frac{1}{2}\int d\tau\Big(\sum_j\chi_j\chi_j' + i\chi_3(\chi_1-i\chi_2) - iT(\tau)\chi_3(\chi_1+i\chi_2)\Big)\right].
\ee
This theory is now easy to quantize in a four-dimensional Hilbert space, setting
\be
\chi_1 = \frac{1}{\sqrt{2}}X\otimes I, \hspace{20pt} \chi_2 = \frac{1}{\sqrt{2}}Y\otimes I, \hspace{20pt} \chi_3 = \frac{1}{\sqrt{2}}Z\otimes X, \hspace{20pt} \chi_4 = \frac{1}{\sqrt{2}}Z\otimes Y,
\ee
where $X,Y,Z$ are the standard Pauli matrices and $I$ is the identity. Then our path integral is a representation of the time evolution operator for a Euclidean quantum mechanics problem with a time-dependent (and non-Hermitian) Hamiltonian that we read off from (\ref{readoff}):
\be
H(\tau)= \frac{1}{2}\left[ i\chi_3(\chi_1-i\chi_2) - iT(\tau)\chi_3(\chi_1+i\chi_2)\right] = -\frac{i}{2}\left( \begin{array}{cccc}
0 & 0 & 0 & T(\tau)  \\
0 & 0 & T(\tau) & 0\\
0 & 1 & 0 & 0\\
1 & 0 & 0 & 0 \end{array} \right).
\ee
We can now compute the operator $U(2\pi) = P e^{-\int_0^{2\pi}H(\tau)d\tau}$ that describes evolution all the way around the circle, by solving the Schrodinger equation $\Psi' = -H \Psi$.
That equation is equivalent to a pair of equations
\be
\frac{d}{d \tau}\begin{pmatrix} \psi_1\cr \psi_2\end{pmatrix} = \frac{i}{2}\begin{pmatrix} 0 & T(\tau)\cr 1&0\end{pmatrix}\begin{pmatrix} \psi_1\cr \psi_2\end{pmatrix} \ee
for two-component wavefunctions.
Eliminating the bottom components, this equation
is equivalent to the second order equation
\be
\partial_\tau^2\Psi + \frac{1}{2}\Sch\left(\tan\frac{\phi}{2},\tau\right)\Psi = 0.
\ee
This equation has two linearly independent solutions $\cos(\phi/2)/\sqrt{\phi'}$ and $\sin(\phi/2)/\sqrt{\phi'}$, both of which satisfy $\Psi(\tau+2\pi) = -\Psi(\tau)$. We conclude that the operator
that describes time evolution around the circle is simply $U(2\pi) = -1$. The fact that this is independent of $\phi$ is the crucial point that underlies the fact that the path integral (\ref{pfoft}) is independent of $\phi$. 

Explicitly, the desired path integral (\ref{pfoft}) is $\Tr\,[(-1)^F U(2\pi) (-1/2)c\eta bw(0)] = 1$, where the factor $(-1)^F=Z\otimes Z$ expresses the fact that the fermions obey periodic boundary conditions, and
the insertions $(-1/2)c\eta bw(0) = -\frac{1}{4}(1 +Z)\otimes Z$ are the original fermion zero-mode insertions of eqn. (\ref{fot}),
expressed in eqn. (\ref{useeq}) in a Hamiltonian language. It follows that the measure reduces  to the naive measure (\ref{naiveM}).\footnote{There were various arbitrary choices of sign in this calculation, involving the ordering of fermion zero-mode insertions and the sign of the measure for the fermion zero-modes.  In general, on a symplectic manifold $M$ with symplectic form $\omega$, the sign of $\Pf(\omega)$ depends on the
orientation of $M$.  Conventionally, $M$ is oriented to make $\Pf(\omega)$ positive, and thus we have chosen
signs to get a result $+1$ rather than $-1$ in the above calculation.  In any case, the path integral measure that
we want is positive.}


\paragraph{Why This Measure?}

In general, if $G$ is any group, it acts on itself on both the left and the right, as we recalled in section \ref{symham}.  There is always
(up to a constant multiple) a unique left-invariant measure $\Omega_\ell$ on $G$, obtained by picking an arbitrary measure on the tangent
space to the identity in $G$ and then translating it over the group manifold so as to be left-invariant.  Under a mild condition on $G$, which is
satisfied for $\diff\,S^1$, a left-invariant measure is also right-invariant and it does not matter if we ask for a measure to be left- or right-invariant.\footnote{Let $h$ be any element of $G$, acting on $G$ on the right.  As the right action of $G$ on itself commutes with the left action, $h$
will transform a left-invariant measure $\Omega_\ell$ to another left-invariant measure $\Omega'_\ell$.  But as the left-invariant measure
is unique up to a real multiple, $h$ actually transforms $\Omega_\ell$ to $u(h)\Omega_\ell$ for some real constant $u(h)$.  The map $h\to u(h)$
is a one-dimensional real representation of $h$.  Thus if $G$ has no nontrivial real one-dimensional representations -- as is the case for
$\diff\,S^1$ -- $u(h)$ will be identically 1 and a left-invariant measure is automatically right-invariant. (In this case, the group $G$ is said
to be unimodular.)}   In the case of $\diff\,S^1$,
the convention adopted in section \ref{symham} was that the left action is  $\phi(\tau)\rightarrow \phi(g(\tau))$ and the right action is  $\phi(\tau) \rightarrow h(\phi(\tau))$.

The symplectic description of the measure is most natural on the quotient space $\diff\,S^1/SL(2,\R)$.  Here, since we divide by $SL(2,\R)$ acting
on the right, the only natural group action that remains is the one that descends from the left action of $SL(2,\R)$ on itself.  However,
the same measure can be constructed by starting with an invariant measure on $\diff\,S^1$ -- as just explained, it does not matter if
one takes this to be a left-invariant or right-invariant measure -- and then dividing by $SL(2,\R)$ (itself endowed with an invariant
measure).   This point of view about the measure was adopted in \cite{Bagrets:2016cdf}.  The starting point there was the measure (\ref{naiveM})
on the group manifold.  From that point of view, the right invariance of the measure on $\diff\,S^1$ seems more essential, because it is this
that enables one to divide by $SL(2,\R)$ and get a measure on the quotient.

Ideally, one would like to derive the symplectic or quotient measure directly from a theory where the Schwarzian action arises, such as SYK or dilaton gravity. We have not done this, but we will make two further comments that suggest that this choice is reasonable. 

First, the formula (\ref{naiveM}) makes it clear that the measure is UV-divergent, since it involves a product of $\phi'$ at each point. If we were to write this as a term in the action, we would have $S_{measure} = \delta(0)\int d\tau \log \phi'$. As we will see, this UV divergence is actually necessary to cancel divergences that appear in the naive perturbation theory of the Schwarzian action.\footnote{See \cite{Brezin:1976ap} for a similar phenomenon in the $O(N)$ sigma model. As in that setting, one can change variables in the Schwarzian theory to variables that simplify the measure and make the absence of UV divergences manifest, by choosing $\Phi = (\tan \frac{\phi}{2})'$. The measure (\ref{naiveM}) is simply flat in $\Phi$. This was pointed out in \cite{Bagrets:2016cdf}, where it is shown that the Schwarzian action is also simple in this coordinate. Unfortunately, it seems to become more complicated when we impose $SL(2,\R )$ gauge-fixing conditions, and we have not found a good way to use this $\Phi$ variable.}

Second, we note here that the one-loop exact answer for the partition function that we will get from (\ref{Zwithpsi}) agrees precisely with the answer in the triple-scaled limit of SYK \cite{Cotler:2016fpe} that is conjectured to isolate the pure Schwarzian theory. This suggests that at least in that limit, SYK produces the symplectic measure.

\subsection{Perturbation Theory}
In this section we show how to do perturbation theory for the Schwarzian action including the symplectic measure. We will evaluate the one-loop answer (which is the exact answer by the DH formula) and we will show explicitly that the two-loop term vanishes.

The integral of the Schwarzian action with the measure $\Pf(\omega)$ can be written as
\be\label{Zwithpsi}
Z(g) = \int \frac{\mathcal{D}\phi\mathcal{D}\psi}{SL(2,\R)}\exp\left\{-\frac{1}{2}\int_0^{2\pi} d\tau\left[\frac{\phi''^2}{g^2\phi'^2}  - \frac{\phi'^2}{g^2} + \frac{\psi''\psi'}{\phi'^2} - \psi' \psi\right]\right\}.
\ee
Here, we have introduced a periodic Grassmann field $\psi$ to write the Pfaffian of the symplectic form (\ref{omega2}) as a path integral. The formula (\ref{Zwithpsi}) is analogous to the expression (\ref{dhZ}) from the finite-dimensional setting.

We need to be careful about the space of fields over which we are integrating. As described above, the subtlety is due to the fact that the $\phi$ coordinate is a coordinate on $\text{diff}(S^1)$, whereas we want to integrate only over $\text{diff}(S^1)/SL(2,\R )$. For perturbation theory, a convenient choice of coordinates on the quotient space is to gauge-fix
\begin{align}\label{gaugeCond}
\int d\tau \,\varepsilon(\tau) = \int d\tau \,e^{\pm i\tau}\varepsilon(\tau) = 0, \hspace{20pt} 
\int d\tau\,\psi(\tau) = \int d\tau\, e^{\pm i\tau}\psi(\tau) = 0,
\end{align}
where we define $\varepsilon$ by $\phi(\tau) = \tau + g\varepsilon(\tau)$. Notice that $\varepsilon$ is a strictly periodic variable.

We will consider the first few orders of perturbation theory in $g$: the classical answer, the one-loop determinant, and the two-loop term. With our gauge conditions, the unique classical solution that satisfies $\phi(\tau+2\pi) = \phi(\tau)$  is simply $\phi(\tau) = \tau$ or equivalently $\varepsilon = 0$. The action for this configuration is $-\frac{\pi}{g^2}$. The expansion of the action about this solution in powers of $g$ is
\begin{align}
-I = \frac{\pi}{g^2} - \frac{1}{2}\int_0^{2\pi} du\Big[ &\varepsilon''^2  - \varepsilon'^2 + \psi'' \psi' - \psi' \psi + g\left(-2\varepsilon'\varepsilon''^2 - 2\varepsilon'\psi'' \psi'\right)\notag\\&+g^2\left(3\varepsilon'^2\varepsilon''^2 + 3 \varepsilon'^2\psi'' \psi'\right)+ O(g^3)\Big].
\end{align}
The quadratic action for $\varepsilon$ and $\psi$ is independent of $g$, so it looks like the one-loop term should just give a constant. However, we have a factor of $g$ for each fourier mode of $\varepsilon$ from the transformation of the measure $d\phi = g\, d\varepsilon$. The product over all fourier modes would give something $g$-independent, after regularization. But we are fixing three of the fourier modes in (\ref{gaugeCond}), so the correct regularized answer for the determinant is proportional to $g^{-3}$. We conclude that 
\be
Z_{one-loop}(g) = \frac{\#}{g^3}\exp\left(\frac{\pi}{g^2}\right).
\ee
This is the same conclusion that was reached in \cite{Maldacena:2016hyu}.

To do the two-loop computation we use the propagators\footnote{The exact form of $G(\tau)$ will not be needed, but it is given by 
\be
G(\tau) = \frac{1}{2\pi}\sum_{|n|\ge 2}\frac{e^{-in\tau}}{n^2(n^2-1)} = \frac{1}{2\pi}\left[-\frac{(\tau-\pi)^2}{2} + (\tau-\pi)\sin(\tau) + \frac{5}{2}\cos(\tau) + 1 + \frac{\pi^2}{6}\right]
\ee
for $0\le \tau\le 2\pi$, and extended by periodicity outside this range. Note that $G$ is an even function.}
\begin{align}
\langle \varepsilon(\tau)\varepsilon(0)\rangle &= G(\tau), \hspace{20pt} \langle \psi(\tau)\psi(0)\rangle = G'(\tau).
\end{align}
The two-loop term in $Z$ is the order $g^2$ contribution. This comes from either expanding down the $g^2$ term in the action once, or expanding down the $g$ term twice. The former gives
\be
-\frac{3g^2}{2}\int d\tau\left[\langle \varepsilon'^2\varepsilon''^2\rangle  + \langle \varepsilon'^2\psi''\psi'\rangle\right] = -\frac{3g^2}{2}\left[2G'''(0)^2 - G''(0)G''''(0) + G''(0)G''''(0)\right].
\ee
The first term is zero because $G$ is an even function.\footnote{This is slightly subtle, because $G$ has a singularity at $\tau = 0$ and $\lim_{\tau\rightarrow 0^+} G'''(\tau)$ is not zero. Our manipulations make sense if we replace $G$ with a function that smooths out the singularity in a symmetric way. Equivalently, we can put a cutoff on the absolute values of the frequencies that we consider.} The second and third terms (which come respectively from $\langle \varepsilon'^2\rangle\langle \varepsilon''^2\rangle$ and $\langle\varepsilon'^2\rangle\langle \psi''\psi'\rangle$) cancel. The second two-loop term, which we get by expanding the $O(g)$ term down twice, gives
\begin{align}
\frac{g^2}{2}\int d\tau_1d\tau_2&\left[\langle \varepsilon'\epsilon''(\tau_1)^2 \varepsilon'\varepsilon''(\tau_2)^2\rangle + \langle \varepsilon'\psi''\psi'(\tau_1)\varepsilon'\psi''\psi'(\tau_2)\rangle\right] \\
&= \frac{g^2}{2}\int d\tau_1d\tau_2\Big[-2G''G''''^2 -4 G'''^2 G'''' + G''G''''^2 - G''G'''G'''''\Big],
\end{align}
where all $G$ are $G(\tau_1-\tau_2)$. We can integrate the last term by parts to $G'''^2 G'''' + G'' G''''^2$. The expression inside the integral then reduces to $-3G'''^2G''''$, which is a total derivative. So we conclude that the entire two-loop contribution vanishes.

\subsection{The Exact Partition Function and Density of States}\label{exact}
The proof of the DH formula that we sketched in the Introduction uses a supersymmetric localization argument that is proved by constructing an extended
action with fermion fields and a suitable fermionic symmetry. 


We would like to implement this procedure for the reparametrization field $\phi(\tau)$ that appears in the Schwarzian action.
Here we have to take care of the following detail.  The procedure described in the introduction makes sense for any symplectic manifold $M$ with a $U(1)$
 symmetry.  However, the field $\phi(\tau)$ without any further condition or equivalence
 would represent an element of $\diff\,S^1$, which is not a symplectic manifold.  
 The localization procedure that we are looking for is only possible because in the Schwarzian theory, $\phi(\tau)$ is properly viewed as an element of
 the quotient space $\diff\,S^1/SL(2,\R)$, which is symplectic.
 
A related fact is the following.  To show the one-loop exactness of the path integral for the Schwarzian action, we will want the classical solution $\phi(\tau)=\tau$
to be $U(1)$-invariant, where $U(1)$ acts by shifting $\tau$ by a constant.  This is clearly not true if we regard $\phi(\tau)$ as an element of $\diff\,S^1$, since
$\phi(\tau)=\tau$ is not invariant under adding a constant to the right hand side.
But if $\phi$ is regarded as an element of $\diff\,S^1/SL(2,\R)$ (so that in particular $\phi$ is considered equivalent to $\phi+c$ for constant $c$)
then $\phi(\tau)=\tau$ is indeed $U(1)$-invariant.\footnote{For both of the issues we have raised, it would be just as good if $\phi$ were regarded
as an element of $\diff\,S^1/U(1)$, where $U(1)$ acts by a constant shift of $\phi$.  Here $\diff\,S^1/U(1)$ is a symplectic
manifold, and if $\phi$ is regarded as an element of $\diff\,S^1/U(1)$, then $\phi(\tau)=\tau$ is invariant under a constant shift of $\tau$.}

Therefore in order to implement the localization procedure, we have to view $\phi$ as an element of $\diff\,S^1/SL(2,\R)$.  A convenient way to do this is
to write 
$\phi=\tau+g\varepsilon$, where $\varepsilon$ is required to satisfy the constraints (\ref{gaugeCond}), and add a fermion field $\psi$ that satisfies the same
constraints.  One can then define the fermionic symmetry 
\be Q\varepsilon = \psi, ~~~~Q\psi=\varepsilon', 
\ee
whose square is the $U(1)$ generator corresponding to $d/d\tau$, in keeping with the general framework.  
To localize the path integral, we add $QV$ to the action with a large coefficient, where for example
\be
V = \int d\tau \psi \varepsilon', \hspace{20pt} QV = \int d\tau\left[\varepsilon'^2 + \psi'\psi\right].
\ee
Adding this term with a large coefficient $s$ does not  affect the one-loop or classical terms in the partition function, but because it makes the separated-point propagators small it suppresses higher-loop corrections. By the logic of the DH proof, the partition function is independent of $s$, so all loop
contributions must actually vanish. We conclude that
\be
Z(g) = Z_{one-loop}(g) = \frac{\#}{g^3}\exp\left(\frac{\pi}{g^2}\right).
\ee

\def\H{{\mathcal H}}
\paragraph{A Note On The Density Of States}
It is interesting to consider the density of states that gives rise to this partition function. In the application to SYK or dilaton gravity, we have that $g^2 = \beta/(2\pi C)$, where $\beta$ is the inverse temperature, and $C$ is a coefficient with dimensions of length. So in terms of $\beta$, the partition function is
\be\label{partbeta}
Z(\beta) \propto \frac{1}{\beta^{3/2}}\exp\left(\frac{2\pi^2 C}{\beta}\right).
\ee
This is equal to $\int_0^{\infty}\rho(E)e^{-\beta E}d E$   with
\be
\rho(E) \propto \sinh\left(2\pi\sqrt{2 CE}\right).
\ee

It is tempting to call $\rho(E)$ a density of states, but there is a difficulty with this interpretation.  
If $\rho(E)$ were a sum of delta functions with integer coefficients,
say $\rho(E)=\sum_i n_i \delta(E-E_i)$, we would interpret the Schwarzian theory as a quantum system 
with energy levels $E_i$, of multiplicity $n_i$.  Instead $\rho(E)$ is a smooth function of $E$.  One might think that this means that the Schwarzian theory 
is a quantum system with a continuous energy spectrum, but a moment's reflection shows
that that interpretation is not viable.  In general, if $\H$ is a Hilbert space and $H$ is a 
Hamiltonian operator acting on $\H$ with continuous spectrum, then $\Tr_\H\,\exp(-\beta H)$ is divergent
for any $\beta$.  (If $H$ has continuous spectrum in an 
interval $E_0\leq E\leq E_1$, then it has infinitely many energy levels in any subinterval of  the interval $[E_0,E_1]$.  The sum over
this infinity causes $\Tr_\H\,\exp(-\beta H)$ to diverge.)

In general, in physics, whenever one talks about a continuous density of states per unit energy, one always really has in mind 
the density of states per unit energy per unit ``$x$,'' where
$x$ is some other variable.  For example, a free particle in a box has a discrete spectrum of energy levels, but 
a free particle in infinite volume has a continuous density of states per unit
energy per unit volume.  Thus, by itself the partition function $Z(\beta)$ of the Schwarzian theory is not $\Tr_\H \, \exp(-\beta H)$ for any
quantum system, though it might be a factor in the partition function of a quantum system (such as the SYK model) in a suitable limit
(such as the large $N$ limit).

Technically, the fact that the Schwarzian path integral does not have a Hilbert space interpretation as  $\mathrm{Tr}_\H\,\exp(-\beta H)$
results from the fact that in defining this path integral, one divides by $SL(2,\R)$, a step that would not be available if $\tau$ is taken
to parametrize  a real line rather than a circle.  


\section{Generalizations}\label{sthree}
The Schwarzian theory has a family of generalizations, involving integrals over coadjoint orbits of Lie groups that include the Virasoro group. There are two facts that make it possible to get a one-loop exact theory this way: {\it (i)} these orbits are always symplectic manifolds, and {\it (ii)} they always have a $U(1)$ time translation generator associated to $L_0$ that we can use as an action. It is interesting that some of the theories one defines this way have already been shown to arise from generalizations of the SYK model.

\subsection{More Details on the Virasoro Case}
To begin, we will describe how one arrives at the ordinary Schwarzian theory using this perspective. Here the relevant integration space, $\text{diff}(S^1)/SL(2,\R )$, is a coadjoint orbit of the Virasoro group.  Virasoro is a central extension of $\text{diff}\,S^1$, and the central extension will play an essential role.

To understand the Virasoro coadjoint representation, it is helpful to briefly review the more familiar adjoint representation. An element of the adjoint representation is a linear combination $\sum_n v_n L_n$ of the Virasoro generators $L_n$, plus a multiple $a I$ of the central element $I$. (The eigenvalue of $I$ in a given representation is usually called $c$, the central charge.)   It is convenient to Fourier transform and consider $v(\tau) = \sum_n e^{in\tau}v_n$ and $L(\tau) = \sum_ne^{-in\tau}L_n$.   The Virasoro algebra, including the central extension, is \be
[L_m,L_n] = (m-n)L_{m+n} + \frac{I}{12}m^3\delta_{m,-n}, \hspace{20pt} [L_n,I] =0.
\ee
Then an element of the adjoint representation  is given by a pair $(v(\tau),a)$, which represents a Lie algebra element $\int \frac{d\tau}{2\pi} v(\tau)L(\tau) + aI $. 
An orbit in the  Lie algebra is obtained by conjugating this
element by a group element $g = \exp\left[i\int \frac{d\tau'}{2\pi}w(\tau')L(\tau')\right]$. This results in 
\be\label{adjointRep}
\text{Ad}_{\phi^{-1}}(v(\tau),a)= \left(\frac{v(\phi(\tau))}{\phi'(\tau)},a + \frac{1}{12}\int \frac{d\tau}{2\pi}\frac{v(\phi(\tau))}{\phi'(\tau)}\sch(\phi,\tau)\right).
\ee
Here $\phi(\tau)$ is related to $w(\tau)$ by $\phi(\tau) = e^{-w(\tau)\partial_\tau}\tau e^{w(\tau)\partial_\tau}$. In other words, $\phi^{-1}$ is the diffeomorphism that we get by exponentiating the vector field $w(\tau)$. We can understand the transformation of $v$ in a simple way as that of a vector field transforming under a diffeomorphism given by $\phi^{-1}$.

Now we would like to understand the coadjoint representation. This is simply the dual space of the adjoint representation. It can be parametrized as\footnote{The reason that we call the second parameter here $c$ is that the Virasoro
representation obtained by quantizing this orbit does have central charge $c$.  In other words, upon quantization, $c$
becomes the eigenvalue of the central element $I$ of the Virasoro algebra.} $(b(\tau),c)$, with the pairing
\be\label{pairing}
\langle (b(\tau),c),(v(\tau),a)\rangle = \int_0^{2\pi} \frac{d\tau}{2\pi}b(\tau)v(\tau) + ca.
\ee
The transformation of $(b(\tau),c)$ under the Virasoro group is determined by requiring that this pairing should be invariant when we transform both $(b(\tau),c)$ and $(v(\tau),a)$. It is easy to work out the necessary transformation using (\ref{adjointRep}). It turns out that the action preserves $c$, which is thus a constant that characterizes
the orbit (and after quantization, the representation).
This of course reflects the fact that $I$ is central and is dual to the fact that in the adjoint representation, the transformation of $v$ does not depend on $a$. The action on $b$ is 
\be\label{coadjointRep}
b_\phi\equiv \text{Ad}^*_{\phi^{-1}}\left(b(\tau)\right)= \phi'(\tau)^2b(\phi(\tau)) - \frac{c}{12}\sch(\phi,\tau).
\ee
We can interpret this formula by saying that $b$ transforms like (minus two times) a stress tensor in a 2d CFT.

Eq.~(\ref{coadjointRep}) defines the coadjoint representation. Coadjoint orbits are given by picking an initial $b(\tau)$ and then varying $\phi$. Since some $\phi$ configurations lead to the same coadjoint vector, the orbit is identified with a quotient of $\text{diff}(S^1)$, where the subgroup that we quotient by is the subgroup of $\text{diff}(S^1)$ that leaves the coadjoint vector unchanged. For example, if we choose an initial $b$ that is some generic constant value, then $\text{Ad}^*_{\phi^{-1}}(b)$ will only be invariant under constant shifts of $\phi$, and we get an orbit $\text{diff}(S^1)/U(1)$. However, if we choose the special constant value $b(\tau) = -\frac{c}{24}$, then we can write
\be\label{online}
\text{Ad}_{\phi^{-1}}^*\left(-\frac{c}{24}\right) = -\frac{c}{12}\sch\left(\tan\frac{\phi}{2},\tau\right).
\ee
It is clear that this is invariant under $SL(2,\R)$ transformations of $f \equiv \tan\frac{\phi}{2}$, so the orbit in this case is $\text{diff}(S^1)/SL(2,\R)$.   (This value of $b$ corresponds after quantization to the Virasoro representation that
comprises the identity operator and its descendants.)

Now, to relate this orbit to the Schwarzian theory, we will quote two general facts.  First, the orbit is a symplectic manifold. The symplectic form given by the pairing $\omega = \langle b_\phi,[v,v']\rangle$ where $v,v'$ are elements of the adjoint representation, which parametrize the tangent space to the coadjoint orbit. We can also parametrize this tangent space in terms of infinitesimal changes in $\phi$. The relation between these is given by $v(\tau) = d\phi^{-1}(\tau) = -\frac{d\phi(\tau)}{\phi'(\tau)}.$ 
It is easy to check that this identification and the Virasoro algebra leads to the expression for the symplectic form given in (\ref{omega}). Second, the symplectic generator of the group action associated to a given Lie algebra element is simply given by taking the pairing of $b_\phi$ with that element. If we take the Lie algebra element to be $L_0$, which generates $\tau \rightarrow \tau + \epsilon$, then we get the generator by taking the pairing of $b_\phi$ with a constant vector field. Using (\ref{pairing}) and (\ref{online}) this immediately gives the Schwarzian action discussed in the previous section.

Of course, we can also consider a more generic orbit, such as the orbit of some constant $b = b_0$. This does not arise in the SYK model, but it results in a perfectly reasonable one-loop exact path integral. In order for the theory to be stable for small fluctuations about the saddle point $\phi = \tau$, we require that $b_0 > -\frac{c}{24}$. Then the orbit is $\text{diff}(S^1)/U(1)$, and the partition function is
\be
Z(g) = \frac{\#}{g}\exp\left(\frac{-24b_0}{c}\cdot\frac{\pi}{g^2}\right).
\ee
Note that the one-loop determinant in this case is proportional to $\frac{1}{g}$ instead of $\frac{1}{g^3}$, because we have only one zero mode to gauge fix in the integral over $\phi$.

\subsection{Virasoro-Kac-Moody}
One simple generalization is to extend the Virasoro algebra to a Virasoro-Kac-Moody algebra with group $G$, and repeat the above steps. One finds an action that is the sum of the Schwarzian action plus the quantum mechanics for a particle moving on the group manifold, $L = \text{tr}\left[(g^{-1}\partial_\tau g)^2\right]$. The partition function for such a particle was already known to be one-loop exact \cite{0305-4470-22-13-024}. One expects this theory to be relevant at low-energies for generalizations of SYK with global symmetry \cite{Gu:2016oyy,Gross:2016kjj,Witten:2016iux,Klebanov:2016xxf}.

\subsection{Super-Virasoro}
We can get an interesting generalization by considering super-Virasoro algebras. The coadjoint representations of the $\mathcal{N} = 1$ and $\mathcal{N} = 2$ algebras were considered in \cite{Bakas:1988mq,Delius:1990pt,0253-6102-16-3-295}. We can understand the transformation of the coadjoint vector in a simple way as the transformation of the super stress tensor under superconformal transformations. For the application to SYK, we are interested in the orbit that corresponds to a super  stress tensor that vanishes on the line (where $f = \tan\frac{\phi}{2} = \tau$), and is invariant under global superconformal transformations. Taking this orbit, we can get an action for a one-loop exact theory by pairing the coadjoint vector with $L_0$. Concretely, the resulting action is the integral over super space of the super Schwarzian derivative. Such actions were previously argued to arise as the low-energy theories of $\mathcal{N} = 1$ and $\mathcal{N} = 2$ supersymmetric SYK models \cite{Fu:2016vas}.

The point of relating these theories to a coadjoint orbit is that it follows that the partition functions are one-loop exact.\footnote{This relies on some small extensions of the bosonic facts discussed above. First, it is easy to check directly (or see \cite{Kostant:1975qe}) that coadjoint orbits of super Lie algebras are symplectic supermanifolds. And second, the Duistermaat-Heckman formula generalizes to integrals over symplectic supermanifolds, as we show in Appendix \ref{appendixDH}.} We will make a few comments about both the $\mathcal{N} = 1$ and $\mathcal{N} = 2$ cases. For $\mathcal{N} = 1$, the super Schwarzian theory includes a bosonic field $f = \tan\frac{\phi}{2}$ and an antiperiodic Grassmann field $\eta$. The action is invariant under the global superconformal transformations, $OSp(1|2)$, which we interpret as a gauge symmetry, just as in the bosonic case. In other words, we integrate over all superconformal transformations modulo $OSp(1|2)$.\footnote{The theory also has a physical supersymmetry that is broken by the thermal (antiperiodic) boundary conditions for $\eta$. Note that $OSp(1|2)$ is not broken by this condition.} The classical term in the partition function is the same as in the bosonic model, $I = -\frac{\pi}{g^2}$. The one-loop term is proportional to an expression involving the number of bosonic and fermionic zero modes that we are quotienting by: $g^{\#_{f} - \#_{b}}$. The group $OSp(1|2)$ has three bosonic and two fermionic generators, so we get a one-loop factor $\frac{1}{g}$. Translating $g$ into dependence on the inverse temperature $\beta$ and a parameter $C = \beta/(2\pi g^2)$ proportional to the specific heat, we find
\be
Z(\beta) \propto \frac{1}{\beta^{1/2}}\exp\left(\frac{2\pi^2 C}{\beta}\right) \hspace{20pt} \implies\hspace{20pt} \rho(E) \propto \frac{\cosh(2\pi\sqrt{2CE})}{E^{1/2}}.
\ee
Notice that in this case, the density of states has a square-root growth at low energies.

In the $\mathcal{N} = 2$ case, we integrate over the usual bosonic field $f = \tan\frac{\phi}{2}$, two antiperiodic fermions $\eta, \bar{\eta}$, and a compact scalar $\sigma$, which is defined up to $\sigma \sim \sigma + 2\pi n \hat{q}$, where $\hat{q}$ is a parameter of the model. In the application to SYK, $\hat{q}$ is an odd integer that determines the number of fermions appearing in the supercharge \cite{Fu:2016vas}. The global super-conformal group is $SU(1,1|1)=OSp(2|2)$, which has four bosonic and four fermionic generators, giving a one-loop determinant that is independent of $g$. The main new feature in the $\mathcal{N} = 2$ case is that we have to sum over a family of saddles, where $\sigma$ winds $n$ times around the thermal circle \cite{Fu:2016vas}. We will use formulas for the super-Schwarzian action given in \cite{Fu:2016vas} and refer the reader there for details. The purely bosonic part of the action is
\be
I_b = \frac{1}{g^2}\int_0^{2\pi} d\tau \left[-\sch(\tan\frac{\phi}{2},\tau) +2(\partial_\tau\sigma)^2\right], \hspace{20pt} g^2 = \frac{\beta}{2\pi C},
\ee
Up to $SU(1,1|1)$ gauge transformations, the saddles are $\phi = \tau$ and $\sigma = n\hat{q}\tau$. The action for such a saddle is $I_b = -\frac{\pi}{g^2}(1 - 4n^2\hat{q}^2)$, and the bosonic one-loop determinant is independent of $n$. The fermionic part of the action is somewhat more complicated, but we will only need the quadratic part to compute the one-loop determinant. Expanding eqn. (5.32) from \cite{Fu:2016vas} about the saddle just described, we find
\begin{align}
I_{f,\,quad} &= \frac{1}{g^2}\int_0^{2\pi}d\tau \left[\eta \partial_\tau \bar{\eta} - 4(\partial_\tau\eta)(\partial_\tau - in\hat{q})^2\bar{\eta}\right]\\
&=\frac{2\pi i}{g^2}\sum_{m} (4m^2-1)(m-n\hat{q})\eta_{m-n\hat{q}}\bar{\eta}_{-m+n\hat{q}}.
\end{align}
In the second line we have expanded $\eta$ in modes, $\eta(\tau) = \sum_{p} \eta_p e^{ip\tau}$. We should impose antiperiodic (thermal) boundary conditions, so $m$ and $p$ are half-integers. The two zero modes for each fermion are $m = \pm\frac{1}{2}$. We are interested in the dependence of the determinant on the saddle point label $n$. To compute this, we can regularize by dividing by the determinant with $n = 0$. Taking the product over all non-zero modes, we get
\be
\prod_{m =...-\frac{5}{2},-\frac{3}{2},\frac{3}{2},\frac{5}{2},...}\frac{m-n\hat{q}}{m} = \prod_{m = \frac{3}{2},\frac{5}{2},...}\left(1 - \frac{n^2\hat{q}^2}{m^2}\right) = \frac{\cos(\pi\hat{q}n)}{1 - 4 \hat{q}^2n^2}%=\frac{(-1)^{n}}{1 - 4 \hat{q}^2n^2}
.
\ee
So the contribution from a given saddle is proportional to 
\be
Z_n(\beta) = \frac{\cos(\pi \hat{q}n)}{1 - 4 \hat{q}^2n^2}\exp\left[\frac{2\pi^2 C}{\beta}\left(1 - 4 n^2\hat{q}^2\right)\right].
\ee
Since $\hat{q}$ is odd, the factor of $\cos(\pi\hat{q}n)$ can be written for integer $n$ as $(-1)^n$, but we will leave it in this form for the moment, because we will consider non-integer $n$ below.

To compute the contribution of such a saddle to the density of states, we use the integral
\be
\int_0^\infty dE\left[\delta(E) + \sqrt{\frac{a}{E}}I_1(2\sqrt{aE})\right]e^{-\beta E} = e^{\frac{a}{\beta}}.
\ee
This is true for both positive and negative $a$, provided that the square root is defined the same way inside and outside the Bessel function. It follows that a single saddle point gives a contribution to the density of states proportional to
\be
\rho_n(E)= \frac{\cos(\pi \hat{q}n)}{1 - 4\hat{q}^2n^2}\left[\delta(E) + \sqrt{\frac{a_n}{E}}I_1(2\sqrt{a_nE})\right]\hspace{20pt} a_n\equiv 2\pi^2 C(1 - 4n^2\hat{q}^2).
\ee

We would like to determine which sum over saddles is appropriate for the SYK theory. This can be done by requiring consistency when the system is coupled to a chemical potential. Concretely, we imagine adding a factor $e^{i\alpha Q}$ in the thermal trace, where $Q$ is the $U(1)$ charge, normalized so that the original SYK fermions carry charge one. Inserting this factor is the same as doing the path integral with boundary conditions twisted by the $U(1)$ rotation. The action of this twist on the fields of the super-Schwarzian theory is
\be
\sigma \rightarrow \sigma+\hat{q}\alpha, \hspace{20pt} \eta \rightarrow e^{-i\hat{q}\alpha}\eta, \hspace{20pt} \bar{\eta}\rightarrow e^{i\hat{q}\alpha}\bar{\eta}.
\ee
This has precisely the same effect as adding to the integer saddle-point parameter $n$ a fractional part $\frac{\alpha}{2\pi}$, so the contribution of a given saddle gets modified as $Z_n\rightarrow Z_{n + \frac{\alpha}{2\pi}}$.

This observation allows us to detemine how to sum over saddles, as follows. We have to separately consider two cases, depending on whether the number of complex SYK fermions, $N$, is even or odd. In the case of even $N$, the possible values of the $U(1)$ charge are integers, so if we set $\alpha = 2\pi$, then $e^{i\alpha Q} = 1$ and the total partition function must be the same. Increasing $\alpha$ from zero to $2\pi$ has the effect of mapping $Z_{n}\rightarrow Z_{n+1}$, so to have a total partition function that is invariant, we need to sum over all values of $n$ with the same coefficient. On the other hand, when $N$ is odd, the possible charges are half-integer, so when we set $\alpha = 2\pi$ we have $e^{i\alpha Q} = -1$ and the total partition function should change by a sign. We can accomplish this by summing over even $n$ saddles with coefficient one, and odd $n$ saddles with coefficient minus one. This gives the density of states
\be
\rho_{\text{even}}(E) =\sum_{n = -\infty}^\infty \rho_n(E) \hspace{40pt} \rho_{\text{odd}}(E) = \sum_{n=-\infty}^\infty (-1)^n\rho_n(E),
\ee
where the subscript indicates whether $N$ is even or odd. These expression for $\rho$ are plotted in figure \ref{rhoofeplots}. To explain the rather strange form of the resulting curves, it is helpful to think about applying Poisson summation to these formulas. In both the even and odd cases, we can write the answer as
\begin{align}\label{justified}
\rho(E) \propto \sum_m \rho(E,m), \hspace{20pt} \rho(E,m) \equiv \int dn e^{2\pi i m n}\rho_n(E),
\end{align}
The only difference is that in the even case we sum over integer $m$, and in the odd case, we sum over half-integer values of $m$ (and not integer values). In the even case, this is a straightforward application of the Poisson summation formula. In the odd case, it requires an extra step where we apply Poisson summation separately to the even $n$ and odd $n$ sums, only combining terms at the end. This gives
\be\label{rhoodd}
\rho_{\text{odd}}(E) = \sum_{2m\in \Z} \rho_{\text{odd}}(E,m)
\ee
where
\begin{align}
\rho_{\text{odd}}(E,m) = \int dn e^{2\pi i m n} \left[\rho_n(E) - \rho_{n+1}(E)\right] = (1 - e^{-2\pi i m n})\rho(E,m).
\end{align}
In principle, the sum in (\ref{rhoodd}) involves both half-integer and integer values of $m$, because $m$ is the Poisson-summation dual of a variable $n$ that is being summed over even values. However, we see that the summand vanishes for integer values of $m$, so in practice we can sum only over half-integer $m$.

The point of writing the density of states as in (\ref{justified}) is that we can think of the fourier transform as an integral over imaginary values of the chemical potential, which has the effect of selecting the contribution of states of charge $m$. So $\rho(E,m)$ is the density of states in charge sector $m$. 

It is interesting to consider the range of energies that contribute in the various charge sectors. It is straightforward to check that the $\delta(E)$ contribution is present only for charges that satisfy $|m| < \frac{\hat{q}}{2}$. For the continuum part of the spectrum, we have to consider the fourier transform of the expression including the Bessel function. Despite appearances, the integrand is an entire function of $n$. In fact, this is also true for each term if we write the cosine as a sum of two exponentials (the naive pole at $1 - 4\hat{q}^2n^2 = 0$ is canceled by a zero of the Bessel function expression). Using the asymptotic behavior of the Bessel function at large $n$, we find that the contour can be closed either in the upper half plane or in the lower half plane (for $|m|<\frac{q}{2}$ we close in different directions for the two terms in the cosine) unless $E > E_0(m)$, with
\be
E_0(m) = \frac{1}{2C}\left(\frac{|m|}{2\hat{q}}-\frac{1}{4}\right)^2.
\ee
This is the lowest energy of the continuum part of the spectrum in charge sector $m$. The fact that different charge sectors start contributing rather sharply at different energies explains the odd shape of $\rho(E)$ in figure \ref{rhoofeplots}. Remembering that $\hat{q}$ is odd, we can see that  if $N$ is even (so that $m$ is an integer), we have that $E_0(m)$ is positive for all values of $m$. This means that there is a gap above the degenerate ground states described by the $\delta(E)$ term. By contrast, in the case of odd $N$, we have sectors of charge $m = \pm\frac{\hat{q}}{2}$ that are gapless.

The qualitative features of the low energy spectrum derived in the $\mathcal{N} = 0$, $\mathcal{N} = 1$ and $\mathcal{N} = 2$ theories all agree quite well with exact diagonalziation numerics for the SYK model, again at low energies. This is particularly impressive in the $\mathcal{N} = 2$ case, where the story is fairly complicated. We will not attempt a quantitative fit of these curves, but we compare informally in figure \ref{rhoofeplots}.

\begin{figure}
\begin{center}
\includegraphics[width=.24\textwidth]{n=0.pdf}
\includegraphics[width=.24\textwidth]{n=1.pdf}
\includegraphics[width=.24\textwidth]{n=2N=34.pdf}
\includegraphics[width=.24\textwidth]{n=2N=36.pdf}
\includegraphics[width=.24\textwidth]{num1.pdf}
\includegraphics[width=.24\textwidth]{num2.pdf}
\includegraphics[width=.24\textwidth]{num3.pdf}
\includegraphics[width=.24\textwidth]{num4.pdf}
\caption{{\bf Top:} Exact density of states of the Schwarzian theory near the ground state, for different amounts of supersymmetry. For the two $\mathcal{N} =2 $ cases we chose $\hat{q} = 3$ and we omitted the $\delta(E)$ contribution to the spectrum. {\bf Bottom:} The numerical density of states from exact diagonalization of (super) SYK with a four-fermion Hamiltonian. The Hilbert space dimensions used are respectively $2^{16},2^{16},2^{18},2^{19}$. The $\mathcal{N} = 0$ case is an average using data from \cite{Cotler:2016fpe}. The other curves are for a single realization.}\label{rhoofeplots}
\end{center}
\end{figure}


\section*{Acknowledgements}
We are very grateful to Wenbo Fu, Guy Gur-Ari, Juan Maldacena, Greg Moore, Nikita Nekrasov, Gabor Sarosi, Steve Shenker, and David Simmons-Duffin for discussions. D.S. is supported by the Simons Foundation grant 385600.  E.W. is supported in part by NSF Grant PHY-1606531.

\appendix

\section{Duistermaat-Heckman for Supermanifolds}\label{appendixDH}
In this appendix, we give a physics proof of a Duistermaat-Heckman formula for supermanifolds. The formula
says that on a symplectic supermanifold, the integral of the exponential of a generator of a $U(1)$ symmetry is one-loop exact.   This is a small generalization of the original DH formula, which was for integrals over bosonic symplectic manifolds. In the proof of the bosonic version of the formula
that was  sketched in the introduction, one introduces fermionic partners for the original purely bosonic integration variables. In the super case, we will introduce fermionic partners for the bosons, and bosonic partners for the fermions.

Let us make this more explicit. The starting point is a supermanifold $M$ with bosonic coordinates $t^1\dots t^p$ and fermionic coordinates $\theta^1\dots \theta^q$. We will use $x^A$ as a general coordinate that runs over both fermionic and bosonic values. For each bosonic coordinate, we introduce a fermionic partner that we call $dt^a$, and for each fermionic coordinate we introduce a bosonic partner that we call $d\theta^r$ (in the introduction, we called the fermions $\psi^a$ instead of $dt^a$). The reason that we introduce these coordinates is to write the symplectic measure as an integral. The reason that we refer to them as $dt,d\theta$ is that one can think about differential forms on $M$ simply as functions of this enlarged set of coordinates.\footnote{The space of $t,\theta,dt,d\theta$ is sometimes called $\Pi TM$, meaning a statistics-reversed version of the tangent bundle to the original manifold $M$. See e.g. \cite{Witten:2012bg} for details.} For example, the symplectic two-form is a function of the type
\be\label{fundef}
\omega = dt^a \omega_{ab}dt^b + dt^a\omega_{ar}d\theta^r + d\theta^r\omega_{ra} dt^a+ d\theta^r \omega_{rs}d\theta^s = dx^A\omega_{AB}dx^B.
\ee
Here, the supermatrix of components $\omega_{AB}$ are functions of the coordinates $t,\theta$ but not of their partners $dt,d\theta$. We take $\omega$ to be even-valued, which requires that $\omega_{ab},\omega_{rs}$ are even, while $\omega_{ar}$ is odd. The meaning of the statement that we have a symplectic manifold is that {\it (i)} this form is nondegenerate, in the sense that the supermatrix $\omega_{AB}$ is invertible at each point on our manifold, and {\it (ii)} $d\omega = 0$ where we define
\be
d = dt^a\frac{\partial}{\partial t^a} + d\theta^r \frac{\partial}{\partial \theta^r} = dx^A\frac{\partial}{\partial x^A}.
\ee
Note that $d$ is an ordinary differential operator acting in the space of functions of $t,\theta,dt,d\theta$.

Now, we assume that there is a function $H$ that generates a $U(1)$ symmetry of the manifold via the Hamiltonian flow
\begin{align}\label{flowH}
\delta x^A  = v^A = -\partial_B H\omega^{BA}
\end{align}
where $\omega^{AB}$ is the inverse of the supermatrix $\omega_{AB}$. Any function $H$ generates a flow that preserves $\omega$ and can be understood as a symmetry of the manifold. However, it is crucial that we are assuming the flow generated by $H$ is a $U(1)$ symmetry, so that all orbits close after the same amount of time. Now, we consider the integral
\be\label{integr}
Z = \int D(x^A, d x^A)\exp%\left(\left(\frac{1}{g^2}\right)
\left(\frac{1}{2}\omega +H\right)%\right)
,
\ee
where the integral runs over all of the variables $t,\theta,dt,d\theta$ with various indices and  $\omega$ is the function defined in eqn. (\ref{fundef}).  Just as  in the introduction, there
is a natural measure $D(x^A,dx^A)$ because the variables $dx^A$ transform the same way as $x^A$ but with opposite statistics.  In eqn. (\ref{integr}), the integral over the even variables $t$
and $d\theta$ is an ordinary integral, and the integral over the odd variables
$\theta$ and $dt$  is defined by the standard Berezin rules.  Since the exponent in (\ref{integr})  is quadratic in $d\theta$ and $d t$ ($\omega$ is homogeneous and
quadratic in those variables and $H$ does not depend on them),
the integral in (\ref{integr}) is Gaussian in the $d\theta$ and $dt$ variables. We can imagine doing these integrals first. The effect of doing these integrals is to give%, up to an overall power of $g$,
 the symplectic 
measure for the remaining integrals over $t,\theta$.  This measure 
is $d^px d^q\theta \sqrt{\Ber(\omega_{AB})}$.  Here $\Ber$ is the Berezinian, the superanalog
of the determinant.  So the integral in (\ref{integr}) is the integral over the original supermanifold of $\exp(H)$.%$\exp(H/g^2)$, times a simple power of $g$.

If $M$ is an ordinary (bosonic) symplectic manifold, then instead of $\sqrt{\det \omega}$ we have the more natural $\Pf(\omega)$, but in the superworld there is no analog
of the Pfaffian and we have to use the square root of the Berezinian. This is related to the following circumstance.  If $\omega$ is an ordinary symplectic form on a manifold (or just on
a vector space) then it determines an orientation.  This orientation determines a natural sign of the square root $\sqrt{\det\omega}$, and the square root with that sign is called the Pfaffian.
On a symplectic supermanifold,  the even tangent bundle\footnote{Technically, the even and odd tangent bundles of $M$ are naturally defined over
the reduced space of $M$, and not over $M$ itself.  For the purposes of the topological point that we are explaining here, this difference is immaterial.} of $M$ still has a natural orientation,
but the odd tangent bundle of $M$ does not.  Accordingly, there is no natural sign for the fermionic measure $d^q\theta$.  The upshot
is that although there is a natural symplectic measure that we can write informally as  $d^pxd^q\theta \sqrt{\text{Ber}(\omega)}$, the factors $d^px d^q\theta$ and $\sqrt{\text{Ber}(\omega)}$
do not separately have naturally-defined signs.  (Going back to eqn. (\ref{integr}), the overall measure $D(x^A,dx^A)$ is completely well-defined, but if we write it as the product of a
measure for $x,\theta$ and a measure for $dx,d\theta$, then both factors separately have sign problems.)


Now, we define a supersymmetry by
\be\label{superS}
Qx^A = dx^A, \hspace{20pt} Q(dx^A) = v^A,
\ee
where the variation $v^A$ is the flow generated by $H$, see (\ref{flowH}). It is straightforward to check using the fact that $d\omega = 0$ that the variation of the action vanishes, $Q(\frac{1}{2}\omega + H) = 0$. One can also show that $Q^2 x^A = v^A$ and $Q^2(dx^A) = d(v^A)$ so that $Q^2$ is simply the generator of the $U(1)$ flow associated to $H$. The final preliminary step is to choose a $U(1)$ invariant metric $g_{AB}$ (one can take any metric and average it over $U(1)$ to make it invariant; this is where it is important $H$ generates a compact $U(1)$ symmetry rather than a generic symplectomorphism).

To make the localization argument, we now define a Grassman-odd function
\be
V = g_{AB}v^A dx^B.
\ee
From the $U(1)$ invariance of the metric and the fact that $Q^2$ is the $U(1)$ generator, it follows  that $Q^2V = 0$. We can therefore localize by adding $s QV$ to the action with a large coefficient $s$. This does not change the integral; indeed, the integral of a $U(1)$-invariant $Q$-exact
function vanishes, and the formula
\be
e^{\frac{1}{2}\omega +H - sQV} = e^{\frac{1}{2}\omega+H} + Q\left[e^{\frac{1}{2}\omega+H}\left(-sV + \frac{s^2}{2}VQV + ...\right)\right],
\ee
shows that all terms that depend on $s$ are $Q$-exact.

The term that we added does not change the integral, but it does change the integrand, and it has the effect of localizing the integral to the critical points of $H$. To see this, we write
\be\label{QV}
QV =  dx^C\frac{\partial g_{AB}}{\partial x^C}v^Adx^B + dx^C\frac{\partial v^A}{\partial x^C}dx^B g_{AB}+ v^Bg_{AB}v^A.
\ee
When the localization parameter $s$ is large, we are localized to the region where $v^A$ and $dx^A$ are zero. This will be a location where the $\theta$ variables vanish, and the $t$ variables take some particular value, say $t_*$. We can then expand about this point as
\be
v^A = y^B \partial_B v^A(t_*), \hspace{20pt} y^a = t^a - t^a_*, \hspace{20pt} y^r = \theta^r.
\ee
We then see that the first term in (\ref{QV}) is cubic in the small deviation from the critical point and can be ignored relative to the second and third terms, which are quadratic. The quadratic action is
\be
QV_{\text{gaussian}} = \left[g_{CB}\partial_Av^C\right]_{\theta = 0, t = t_*}dx^Adx^B + \left[g_{DC}\partial_A v^C\partial_B v^D\right]_{\theta = 0,t = t_*}y^Ay^B.
\ee
Notice that the quantities in brackets are bosonic, depending only on $t_*$, so the quadratic terms only couple variables of the same fermionic parity. So we have separate Gaussian integrals over the $t,\theta,dt,d\theta$ variables. After doing these integrals, cancelling factors of the determinant of the metric and the localization parameter $s$, and using $\partial_A v^B(t_*) = -\partial_A(\omega^{CB}\partial_C H)|_{t_*} = -\omega^{CB}(t_*)\partial_A\partial_C H(t_*)$, we find that the contribution from the critical point $t_*$ is (up to measure factors of $2\pi$) 
\be
Z_{t_*} = e^{H(t_*)}\frac{\sqrt{\det\left[\partial_r\partial_s H\right]}}{\sqrt{\det \omega_{rs}}}\frac{\sqrt{\det \omega_{ab}}}{\sqrt{\det\left[\partial_a\partial_b H\right]}}\Bigg|_{\theta = 0,t=t_*} = e^{H(t_*)}\frac{\sqrt{\text{Ber}\,\omega_{AB}}}{\sqrt{\text{Ber}\left[\partial_A\partial_B H\right]}}\Bigg|_{\theta = 0,t = t_*}.
\ee
Here, as above, we use $r,s$ for fermionic indices, and $a,b$ for bosonic indices. Notice that mixed derivatives of $H$ and mixed components of $\omega$ vanish at the critical point, because they would have to be odd and therefore proportional to odd powers of $\theta$.  As we have explained above, there is no natural sign of the square root $\sqrt{\text{Ber}\,\omega_{AB}}$,
but $\sqrt{\text{Ber}\,\partial_A\partial_B H }$ has precisely the same problem and the ratio of the two square roots has a well-defined sign.  (Concretely, the sign of
 $\sqrt{\text{Ber}\,\omega_{AB}}$ and the sign of 
 $\sqrt{\text{Ber}\,\partial_A\partial_B H }$ depend on an orientation of the odd tangent bundle of $M$, but this dependence is absent in the ratio.)

If the function $H$ has more than one critical point (or equivalently if the $U(1)$ action on $M$ has more than one fixed point),
then  we should sum over these points to get the full answer for the integral.  As in the case of the bosonic Duistermaat-Heckman formula, if the critical points
form a moduli space $\mathcal M$ of positive dimension, one can express the original integral over $M$ as an integral over $\M$.   (For instance -- although this example involves
a further generalization to a nonabelian analog of Duistermaat-Heckman -- in the case of two-dimensional Yang-Mills theory, one can take $M$ to be the space of all gauge fields on
an oriented  two-manifold and then $\M$ is the moduli space of flat connections on $M$ \cite{WittenOldpaper}.)

This discussion has been somewhat abstract. For a concrete example, we can consider the purely fermionic manifold $\mathbb{C}\mathbb{P}^{0|2}$ which has the symplectic form
\begin{align}
\omega &= \partial \bar{\partial}\log(1 + \theta^1\bar{\theta}^1 + \theta^2\bar{\theta}^2)= -(1 - \theta^2\bar{\theta}^2)d\theta^1d\bar{\theta}^1 - \theta^1\bar{\theta}^2d\theta^2d\bar{\theta}^1 + (1\leftrightarrow 2).
\end{align}
We would like to consider the integral
\be
I = \int d^2\theta^1 d^2\theta^2d^2(d\theta^1)d^2(d\theta^2) \exp\left(\frac{1}{2}\omega_{ij}d\theta^id\theta^j + \frac{1}{g^2} H\right)
\ee
where $H$ is a symplectic generator of a $U(1)$. For example
\be
H = \theta^1\bar{\theta}^1 - \theta^1\bar{\theta}^1\theta^2\bar{\theta}^2 + (1\leftrightarrow 2)
\ee
which phase rotates $\theta^1,\bar{\theta}^1$ into each other and similarly $\theta^2,\bar{\theta}^2$. The Gaussian integral over the bosonic $d\theta$ variables gives us a measure factor proportional to $(1 + \theta^1\bar{\theta}^1 + \theta^2\bar{\theta}^2)$. We then do the final integral over the $\theta$ variables. This gives that $I$ is a multiple of $1/g^4$. This is the same as the ``one-loop'' answer where we replace everything by the lowest nonvanishing order in the $\theta$ variables. The fact that this works relies on a cancellation between a measure factor and a factor coming from the higher order term in $H$. This is similar to what happens in bosonic examples of DH integrals.


\section{A Lattice Version of the Schwarzian Theory}\label{lattice}
In this appendix, we discuss a lattice regularization of the Schwarzian path integral that preserves the exact $SL(2,\R )$ gauge symmetry of the Schwarzian action.\footnote{We are grateful to J.~Maldacena for suggesting this lattice implementation.  Note that we do
not expect the regularized theory to be one-loop exact.} This was not necessary for anything in the main text, but we include it in order to give a concrete picture of the important $\phi(\tau)$ configurations at different values of the coupling. We expect that the lattice theory is only one-loop exact in the continuum limit.

One can work in terms of the variable $f(\tau) = \tan\frac{\phi(\tau)}{2}$ or in terms of $\phi(\tau)$ directly. We start first with $f$. One approximates the continuum $f(\tau)$ by a lattice of values $f_i$ at $\tau=ai$, $i=0,1,2\dots$. Here we take the lattice spacing to be $a$ and the inverse temperature to be $2\pi$, so we have $n = \frac{2\pi}{a}$ points. Then one can make a lattice approximation to the Schwarzian using a conformal cross ratio of adjacent values:
\be
\frac{(f_{i+3}-f_{i+1})(f_{i+2}-f_i)}{(f_{i+3}-f_{i+2})(f_{i+1}-f_i)} = 4 - 2a^2 \text{Sch}(f,u) + O(a^3).
\ee
This preserves an exact $SL(2,\R )$ acting on all points as $f \rightarrow \frac{a f+b}{cf+d}$. So a lattice version of the Schwarzian theory, including a lattice version of the measure $\frac{df}{f'}$ from (\ref{naiveM}), is
\be
Z(g) = \int \left(\prod_{i = 1}^{n} \frac{df_i}{f_{i+1} - f_i}\right)e^{-\frac{1}{2ag^2} \sum_{i=1}^n \left[\frac{(f_{i+3}-f_{i_1})(f_{i+2}-f_i)}{(f_{i+3}-f_{i+2})(f_{i+1}-f_i)}-4\right]}.
\ee
In these formulas the index should be understood to ``wrap around'' the circle, so that $i = n+1$ is equivalent to $i = 1$. Notice that our measure is also exactly $SL(2,\R )$ invariant.

\begin{figure}[t]
\begin{center}
\includegraphics[scale = 0.43]{C=one.pdf}
\includegraphics[scale = 0.43]{C=onetenth.pdf}
\includegraphics[scale = 0.43]{C=onehundreth.pdf}
\caption{Typical configurations of the discretized $\phi$ varible that contribute to $Z(g)$ for the discretized Schwarzian theory. The configurations were generated using the Metropolis algorithm, with a lattice of $n = 300$. The figure at left contains only small fluctuations about the saddle point, which would be a straight line $\phi_j = \frac{2\pi j}{n}$.}\label{MC}
\end{center}
\end{figure}
We can also directly use the $\phi$ variable instead of $f$. Then the partition function is
\be
Z(g) = \int \left(\prod_{i = 1}^{n} \frac{d\phi_i}{\sin\frac{\phi_{i+1} - \phi_i}{2}}\right)e^{-\frac{1}{2a g^2} \sum_{i=1}^n \left[\frac{\sin\frac{\phi_{i+3}-\phi_{i_1}}{2}\sin\frac{\phi_{i+2}-\phi_i}{2}}{\sin\frac{\phi_{i+3}-\phi_{i+2}}{2}\sin\frac{\phi_{i+1}-\phi_i}{2}}-4\right]}.
\ee
This reduces to the expected thing once we realize
\be
\frac{\sin\frac{\phi_{i+3}-\phi_{i_1}}{2}\sin\frac{\phi_{i+2}-\phi_i}{2}}{\sin\frac{\phi_{i+3}-\phi_{i+2}}{2}\sin\frac{\phi_{i+1}-\phi_i}{2}}= 4 - 2a^2\left[\text{Sch}(\phi,u) + \frac{1}{2}\phi'^2\right] + O(a^3).
\ee
Both of the above partition functions are divergent because of the exact $SL(2,\R )$ gauge symmetry. We can fix this by fixing the values of three of the points. One choice is to fix $\phi_1 = 0, \phi_2 = \frac{2\pi}{n}, \phi_N = 2\pi(1 - \frac{1}{n})$. Then the integral over monotonic $\phi$ is convergent. Notice that the log divergence from the measure is cut off by the fact that the action diverges when neighboring values of $\phi$ coincide. 

Figure \ref{MC} shows some typical configurations contributing to $Z(g)$, sampled using the Metropolis algorithm, for different values of $g$ and with $n = 300$ points on the lattice. As $g$ increases, the free energy becomes increasingly dominated by the measure, which prefers to have all of the points at very similar values. Of course, the function $\phi_i$ is required to run between zero and $2\pi$, but for large $g$ it prefers to do this all at once in a few places. 

\section{Correlation Functions of the Schwarzian}
In this appendix, we show how to compute correlation functions of the Schwarzian derivative of $\phi$. To start, one can compute moments of the integrated Schwarzian by differentiating the partition function. For example:
\begin{align}\label{zpp1}
\int d\tau \langle \sch(\tau)\rangle &= \frac{1}{Z(g)}\frac{\partial}{\partial_{1/g^2}}{Z(g)} = \pi + \frac{3g^2}{2}\\
\int d\tau d\tau' \langle \sch(\tau)\sch(\tau')\rangle &= \frac{1}{Z(g)}\frac{\partial^2}{\partial_{1/g^2}^2}{Z(g)}= \pi^2 + 3\pi g^2 + \frac{3 g^4}{4}.\label{zpp}
\end{align}
Here and below, we are using the notation $\sch(\tau) \equiv \sch(\tan\frac{\phi(\tau)}{2},\tau)$. To get unintegrated 
correlators at fixed points, we proceed as follows. The composition rule
\be
\sch(f(y(x)),x) = \sch(f,y)(\partial_x y)^2 + \sch(y,x)
\ee
together with invariance of the measure implies
\be
Z(g) = \int \frac{d\mu[\phi]}{SL(2)}e^{\frac{1}{g^2}\int dx \sch(\tan\frac{\phi(y)}{2},x)} = \int \frac{d\mu[\phi]}{SL(2)}e^{\frac{1}{g^2}\int dx \left[(\partial_x y)^2\sch(\tan\frac{\phi}{2},y) + \sch(y,x)\right]}.
\ee
Relabeling $x\rightarrow h$ and $y\rightarrow \tau$, and using $\sch(y,x) = -(\partial_x y)^2\sch(x,y)$, we find
\be\label{bnm}
\int \frac{d\mu[\phi]}{SL(2)}e^{\frac{1}{g^2}\int \frac{d\tau}{h'(\tau)}\sch(\tan\frac{\phi(\tau)}{2},\tau)} = e^{\frac{1}{g^2}\int \frac{d\tau}{h'(\tau)}\, \sch(h,\tau)}Z(g) = e^{\frac{1}{2g^2}\int d\tau\frac{h''(\tau)^2}{h'(\tau)^3}}Z(g).
\ee
Here, we require that $h$ is a function that maps $S^1\rightarrow S^1$,
\be
h(\tau) = \tau + \epsilon(\tau),\hspace{20pt} \int \epsilon'(\tau)d\tau = 0.
\ee
Expanding (\ref{bnm}) to second order in $\epsilon$ we find
\be
\langle \sch(\tau)\sch(0)\rangle = -2g^2\langle \sch(0)\rangle\delta(\tau) - g^2\delta''(\tau) + \text{const.}
\ee
The value $\langle \sch(0)\rangle$ can be determined from (\ref{zpp1}) and the constant can be determined using the integrated correlator (\ref{zpp}). The result is 
\begin{align}
\langle \sch(\tau)\sch(0)\rangle &= -\left(g^2 + \frac{3 g^4}{2\pi}\right)\delta(\tau) - g^2\delta''(\tau) + \frac{1}{4}  + \frac{5g^2}{4\pi} + \frac{15g^4}{16\pi^2}.
\end{align}
Higher point correlation functions of the Schwarzian can be evaluated in a similar way. We will point out two interesting features. First, the correlators are constant away from coincident points. This can be understood from the fact that the equation of motion for $\phi$ is $\sch'(\tau) = 0$. Second, the actual values of the separated-point correlators are given by the corresponding moments of the energy of the system and the relation
\begin{align}
E = \frac{2\pi}{\beta g^2}\sch(\tau).
\end{align}
More precisely, what we mean is that the separate-points correlators of the Schwarzian give moments of the energy in the distribution $\rho(E)$. These can be computed in the usual way by differentiating (\ref{partbeta}). We have checked this mechanically up to the three-point function, but we expect that it holds in general.

 

\mciteSetMidEndSepPunct{}{\ifmciteBstWouldAddEndPunct.\else\fi}{\relax}
\bibliographystyle{utphys}
\bibliography{refs.bib}{}

\end{document}

\pagebreak

\begin{thebibliography}{99}
    
\end{thebibliography}

\end{document}
========================================

\documentclass[12pt,a4paper]{article}
\pdfoutput=1
\usepackage{jheppub}
\usepackage{amsfonts}
\usepackage{bbm}
\usepackage{graphicx}
%\usepackage{caption}
%\usepackage{subcaption}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amssymb,amsfonts,amsmath}

\usepackage{tikz}



%%%%%% Geometry %%%%%%%
\oddsidemargin 0.8 in
\textwidth 6.7in
\def\danger#1{\smallskip\noindent\rlap\dbend
\indent{\bf #1}\par\vskip-1.5pt\nobreak}


%%%%%% Fonts %%%%%%
\font\ticp=cmcsc14
\font\cmss=cmss10
\font\cmsss=cmss10 at 7pt
\font\manual=manfnt

%%%%%%% Environments  %%%%%%%%%
\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\non}{\nonumber}
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ben}{\begin{eqnarray*}}
\newcommand{\een}{\end{eqnarray*}}
\newcommand{\bem}{\begin{pmatrix}}
\newcommand{\eem}{\end{pmatrix}}
\newcommand{\bl}{\begin{align}}
\newcommand{\el}{\end{align}}
\newcommand{\beg}{\begin{gather}}
\newcommand{\eeg}{\end{gather}}
\newcommand{\eq}[1]{(\ref{#1})}
\newcommand\Top{\rule{0pt}{2.6ex}}
\newcommand\Bottom{\rule[-1.2ex]{0pt}{0pt}}
\newcommand{\XX}{{\mathcal X}}
\newcommand{\Y}{{\mathcal Y}}
 
%%%%% Theorem %%%%%%%
\newenvironment{theorem}{\begin{quote} \footnotesize }{ \normalsize \end{quote}}

%%%%%%% Better lists %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newenvironment{myenumerate}{
\begin{enumerate}
   \setlength{\itemsep}{1pt}
   \setlength{\parskip}{0pt}
   \setlength{\parsep}{0pt}}{\end{enumerate}}
\newenvironment{myitemize}{
\begin{itemize}
   \setlength{\itemsep}{1pt}
   \setlength{\parskip}{0pt}
   \setlength{\parsep}{0pt}}{\end{itemize}}
   


%%%%%%%%%%% Caligraphic %%%%%%%%%%%
\newcommand{\cA}{\mathcal{A}}
\newcommand{\cB}{\mathcal{B}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\cE}{\mathcal{E}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\cJ}{\mathcal{J}}
\newcommand{\cK}{\mathcal{K}}
\newcommand{\cL}{\mathcal{L}}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cN}{\mathcal{N}}
\newcommand{\cO}{\mathcal{O}}
\newcommand{\cS}{\mathcal{S}}
\newcommand{\cX}{\mathcal{X}}
\newcommand{\cY}{\mathcal{Y}}
\newcommand{\cW}{\mathcal{W}}
\newcommand{\cR}{\mathcal{R}}
\newcommand{\cT}{\mathcal{T}}
\newcommand{\cZ}{\mathcal{Z}}

%%%%%%%%%%%% Math fonts %%%%%%%%%%%

%---------- mathbb font --------------------------------

\newcommand{\bA}{\ensuremath{\mathbb{A}}}
\newcommand{\bB}{\ensuremath{\mathbb{B}}}
\newcommand{\bC}{\ensuremath{\mathbb{C}}}
\newcommand{\bD}{\ensuremath{\mathbb{D}}}
\newcommand{\bE}{\ensuremath{\mathbb{E}}}
\newcommand{\bF}{\ensuremath{\mathbb{F}}}
\newcommand{\bG}{\ensuremath{\mathbb{G}}}
\newcommand{\bH}{\ensuremath{\mathbb{H}}}
\newcommand{\bI}{\ensuremath{\mathbb{I}}}
\newcommand{\bJ}{\ensuremath{\mathbb{J}}}
\newcommand{\bK}{\ensuremath{\mathbb{K}}}
\newcommand{\bL}{\ensuremath{\mathbb{L}}}
\newcommand{\bM}{\ensuremath{\mathbb{M}}}
\newcommand{\bN}{\ensuremath{\mathbb{N}}}
\newcommand{\bO}{\ensuremath{\mathbb{O}}}
\newcommand{\bP}{\ensuremath{\mathbb{P}}}
\newcommand{\bQ}{\ensuremath{\mathbb{Q}}}
\newcommand{\bR}{\ensuremath{\mathbb{R}}}
\newcommand{\bS}{\ensuremath{\mathbb{S}}}
\newcommand{\bT}{\ensuremath{\mathbb{T}}}
\newcommand{\bU}{\ensuremath{\mathbb{U}}}
\newcommand{\bV}{\ensuremath{\mathbb{V}}}
\newcommand{\bW}{\ensuremath{\mathbb{W}}}
\newcommand{\bX}{\ensuremath{\mathbb{X}}}
\newcommand{\bY}{\ensuremath{\mathbb{Y}}}
\newcommand{\bZ}{\ensuremath{\mathbb{Z}}}

%---------- mathcal font -----------------------------

\newcommand{\scA}{\ensuremath{\mathcal{A}}}
\newcommand{\scB}{\ensuremath{\mathcal{B}}}
\newcommand{\scC}{\ensuremath{\mathcal{C}}}
\newcommand{\scD}{\ensuremath{\mathcal{D}}}
\newcommand{\scE}{\ensuremath{\mathcal{E}}}
\newcommand{\scF}{\ensuremath{\mathcal{F}}}
\newcommand{\scG}{\ensuremath{\mathcal{G}}}
\newcommand{\scH}{\ensuremath{\mathcal{H}}}
\newcommand{\scI}{\ensuremath{\mathcal{I}}}
\newcommand{\scJ}{\ensuremath{\mathcal{J}}}
\newcommand{\scK}{\ensuremath{\mathcal{K}}}
\newcommand{\scL}{\ensuremath{\mathcal{L}}}
\newcommand{\scM}{\ensuremath{\mathcal{M}}}
\newcommand{\scN}{\ensuremath{\mathcal{N}}}
\newcommand{\scO}{\ensuremath{\mathcal{O}}}
\newcommand{\scP}{\ensuremath{\mathcal{P}}}
\newcommand{\scQ}{\ensuremath{\mathcal{Q}}}
\newcommand{\scR}{\ensuremath{\mathcal{R}}}
\newcommand{\scS}{\ensuremath{\mathcal{S}}}
\newcommand{\scT}{\ensuremath{\mathcal{T}}}
\newcommand{\scU}{\ensuremath{\mathcal{U}}}
\newcommand{\scV}{\ensuremath{\mathcal{V}}}
\newcommand{\scW}{\ensuremath{\mathcal{W}}}
\newcommand{\scX}{\ensuremath{\mathcal{X}}}
\newcommand{\scY}{\ensuremath{\mathcal{Y}}}
\newcommand{\scZ}{\ensuremath{\mathcal{Z}}}
\newcommand\spin{\mathrm{Spin}}

%-------------- mathfrak font -----------------------------

\newcommand{\frakA}{\ensuremath{\mathfrak{A}}}
\newcommand{\frakB}{\ensuremath{\mathfrak{B}}}
\newcommand{\frakC}{\ensuremath{\mathfrak{C}}}
\newcommand{\frakD}{\ensuremath{\mathfrak{D}}}
\newcommand{\frakE}{\ensuremath{\mathfrak{E}}}
\newcommand{\frakF}{\ensuremath{\mathfrak{F}}}
\newcommand{\frakG}{\ensuremath{\mathfrak{G}}}
\newcommand{\frakH}{\ensuremath{\mathfrak{H}}}
\newcommand{\frakI}{\ensuremath{\mathfrak{I}}}
\newcommand{\frakJ}{\ensuremath{\mathfrak{J}}}
\newcommand{\frakK}{\ensuremath{\mathfrak{K}}}
\newcommand{\frakL}{\ensuremath{\mathfrak{L}}}
\newcommand{\frakM}{\ensuremath{\mathfrak{M}}}
\newcommand{\frakN}{\ensuremath{\mathfrak{N}}}
\newcommand{\frakO}{\ensuremath{\mathfrak{O}}}
\newcommand{\frakP}{\ensuremath{\mathfrak{P}}}
\newcommand{\frakQ}{\ensuremath{\mathfrak{Q}}}
\newcommand{\frakR}{\ensuremath{\mathfrak{R}}}
\newcommand{\frakS}{\ensuremath{\mathfrak{S}}}
\newcommand{\frakT}{\ensuremath{\mathfrak{T}}}
\newcommand{\frakU}{\ensuremath{\mathfrak{U}}}
\newcommand{\frakV}{\ensuremath{\mathfrak{V}}}
\newcommand{\frakW}{\ensuremath{\mathfrak{W}}}
\newcommand{\frakX}{\ensuremath{\mathfrak{X}}}
\newcommand{\frakY}{\ensuremath{\mathfrak{Y}}}
\newcommand{\frakZ}{\ensuremath{\mathfrak{Z}}}
\newcommand{\fraka}{\ensuremath{\mathfrak{a}}}
\newcommand{\frakb}{\ensuremath{\mathfrak{b}}}
\newcommand{\frakc}{\ensuremath{\mathfrak{c}}}
\newcommand{\frakd}{\ensuremath{\mathfrak{d}}}
\newcommand{\frake}{\ensuremath{\mathfrak{e}}}
\newcommand{\frakf}{\ensuremath{\mathfrak{f}}}
\newcommand{\frakg}{\ensuremath{\mathfrak{g}}}
\newcommand{\frakh}{\ensuremath{\mathfrak{h}}}
\newcommand{\fraki}{\ensuremath{\mathfrak{i}}}
\newcommand{\frakj}{\ensuremath{\mathfrak{j}}}
\newcommand{\frakk}{\ensuremath{\mathfrak{k}}}
\newcommand{\frakl}{\ensuremath{\mathfrak{l}}}
\newcommand{\frakm}{\ensuremath{\mathfrak{m}}}
\newcommand{\frakn}{\ensuremath{\mathfrak{n}}}
\newcommand{\frako}{\ensuremath{\mathfrak{o}}}
\newcommand{\frakp}{\ensuremath{\mathfrak{p}}}
\newcommand{\frakq}{\ensuremath{\mathfrak{q}}}
\newcommand{\frakr}{\ensuremath{\mathfrak{r}}}
\newcommand{\fraks}{\ensuremath{\mathfrak{s}}}
\newcommand{\frakt}{\ensuremath{\mathfrak{t}}}
\newcommand{\fraku}{\ensuremath{\mathfrak{u}}}
\newcommand{\frakv}{\ensuremath{\mathfrak{v}}}
\newcommand{\frakw}{\ensuremath{\mathfrak{w}}}
\newcommand{\frakx}{\ensuremath{\mathfrak{x}}}
\newcommand{\fraky}{\ensuremath{\mathfrak{y}}}
\newcommand{\frakz}{\ensuremath{\mathfrak{z}}}
\newcommand{\fraksl}{\ensuremath{\mathfrak{sl}}}

%%%%%%%%%%%%%%% Dotted %%%%%%%%%%%
\newcommand{\dalpha}{{\dot \alpha}}
\newcommand{\dbeta}{{\dot \beta}}
\newcommand{\dgamma}{{\dot \gamma}}
\newcommand{\dmu}{{\dot \mu}}
\newcommand{\dnu}{{\dot \nu}}
\newcommand{\drho}{{\dot \rho}}
\newcommand{\dsigma}{{\dot \sigma}}
\newcommand{\dlambda}{{\dot \lambda}}
\newcommand{\dtau}{{\dot \tau}}
\newcommand{\da}{{\dot a}}

%%%%%%%%%%%%%%% Primed %%%%%%%%%%%
\newcommand{\apm}{\alpha'}

%%%%%%%%%%%%%%% Hatted %%%%%%%%%%%
\newcommand{\ha}{{\hat a}}
\newcommand{\hh}{{\widehat h}}
\newcommand{\hb}{{\hat b}}
\newcommand{\hc}{{\hat c}}
\newcommand{\hK}{{\hat K}}
\newcommand{\hG}{{\hat G}}
\newcommand{\hj}{j^\circ}
\newcommand{\vh}{{\vec h}}
\newcommand{\vm}{{\vec m}}
\newcommand{\vn}{{\vec n}}
\newcommand{\vl}{{\vec l}}
\newcommand{\hnabla}{{\hat \nabla}}

%%%%%%%%%%%%%%%% Tilded %%%%%%%%%%%%
\newcommand{\til}{\tilde}
\newcommand{\tOO}{{\tilde \Omega}}
\newcommand{\taa}{{\tilde \alpha}}
\newcommand{\tG}{{\tilde G}}
\newcommand{\tg}{{\tilde g}}
\newcommand{\tK}{{\tilde K}}
\newcommand{\tE}{{\tilde E}}
\newcommand{\tS}{{\tilde S}}
\newcommand{\ta}{{\tilde a}}
%\newcommand{\T}{\widetilde}
%\newcommand{\tX}{\widetilde{X}}


%%%%%%%%%%%%%% Barred %%%%%%%%%%%%
\newcommand{\gb}{{\bar g}}
\newcommand{\zb}{{\bar z}}
\newcommand{\tb}{{\bar \tau}}
\newcommand{\rb}{{\bar \rho}}
\newcommand{\etab}{{\bar\eta}}

%%%%%%%%%%%%%%% Sets %%%%%%%%%%%%
\newcommand{\IR}{\mathbb{R}}
\newcommand{\IC}{\mathbb{C}}
\newcommand{\IZ}{\mathbb{Z}}
\newcommand{\IH}{\mathbb{H}}
\newcommand{\IO}{\mathbb{O}}
\newcommand{\IP}{\mathbb{P}}
\newcommand{\Zint}{\mathbb{Z}}
\newcommand{\Nint}{\mathbb{N}}
\newcommand{\IT}{\mathbb{T}}

%%%%%%%%%%%%%% Greek %%%%%%%%%%%%
\renewcommand{\a}{\alpha}
\renewcommand{\b}{\beta}
\renewcommand{\d}{\delta}
\newcommand{\e}{\epsilon}
\newcommand{\f}{\phi}               
\newcommand{\g}{\gamma}
\newcommand{\h}{\eta}
\renewcommand{\i}{\iota}


\renewcommand{\j}{\psi}
\renewcommand{\k}{\kappa}             
\renewcommand{\l}{\lambda}
\newcommand{\m}{\mu}
\newcommand{\n}{\nu}
\newcommand{\na}{\nabla}
\renewcommand{\o}{\Omega}  
\newcommand{\p}{\pi}
\renewcommand{\r}{\rho}                                     
\newcommand{\s}{\sigma}                                   
\renewcommand{\t}{\tau}
\renewcommand{\th}{\theta}
\renewcommand{\u}{\upsilon}
\newcommand{\x}{\xi}
\newcommand{\z}{\zeta}

\newcommand{\D}{\Delta}
\newcommand{\F}{\Phi}
\newcommand{\G}{\Gamma}
\newcommand{\J}{\Psi}
\renewcommand{\L}{\Lambda}
\renewcommand{\O}{\Omega}
\renewcommand{\P}{\Pi}
\newcommand{\T}{\Theta}
\newcommand{\U}{\Upsilon}
\newcommand{\X}{\Xi}

\newcommand{\vf}{\varphi}
\newcommand{\ve}{\varepsilon}
\newcommand{\vth}{\vartheta}

%%%%%%This paper%%%%%%%%%
\newcommand{\1}{{\textbf{1}}}
\newcommand{\inn}{{\,\in\,}}

%%%%%%% Useful %%%%%%%%%
%\parskip .3cm
%\parindent 0cm
%\pagestyle{empty}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\pa}{\partial}
\newcommand{\nn}{\nonumber}
\newcommand{\Tr}{\mbox{Tr}}
\newcommand{\tr}{\mbox{Tr}}
\newcommand{\sgn}{\mbox{sgn}}
\newcommand{\re}{\mathrm{Re}}  
\newcommand{\im}{\mathrm{Im}}
\renewcommand{\Im}{\mbox{Im}}
\renewcommand{\Re}{\mbox{Re}}
\renewcommand{\inf}{\infty}
\newcommand{\we}{\wedge}
\renewcommand{\c}{\cdot}
\newcommand{\+}{{\,+ \,}}
\newcommand{\one}{{\mathbf 1}}
\newcommand{\2}{{\mathbf 2}}
\newcommand{\4}{{\mathbf 4}}
\newcommand{\3}{{\mathbf 3}}
\newcommand{\6}{{\mathbf 6}}
\newcommand{\OO}{{\mathcal O}}
\newcommand{\R}{{\Bbb R}}
\newcommand{\Z}{{\Bbb Z}}
\newcommand{\V}{{\mathcal V}}
\newcommand{\W}{{\mathcal W}}
\newcommand\myfrac[2]{\genfrac{}{}{0pt}{}{#1}{#2}}
%%%%%%%%%%%% Colors %%%%%%%%%%%%%%%%
\newcommand{\MyRed}{\color [rgb]{0.8,0,0}}
\newcommand{\MyGreen}{\color [rgb]{0,0.7,0}}
\newcommand{\MyBlue}{\color [rgb]{0,0,0.8}}
\newcommand{\MyBrown}{\color [rgb]{0.8,0.4,0.1}}
\newcommand{\MyPurple}{\color [rgb]{0.6,0.0,0.6}}

%%%%%%%%%%% Comments %%%%%%%%%%%%%%%
%\def\tbs#1{{\MyPurple [{Tr\'esa}: #1]}}
%\def\ad#1{{\MyBlue [Atish: #1]}}
%\def\remove#1{{\MyRed [Remove: #1]}}
%\def\comment#1{{\MyGreen [Comment: #1]}}
\newcommand{\ad[1]}{{\MyBlue [Atish: #1]}}
\newcommand{\pp[1]}{{\MyRed [Pavel: #1]}}
\newcommand{\chk}{{\MyRed (Check)}}
\newcommand{\ew[1]}{{\MyGreen [Edward: #1]}}
%
%\newcommand{\remove[1]}{{\MyRed [Remove: #1]}}
%\newcommand{\comment[1]}{{\MyGreen [Comment: #1]}}

%%%%%%%%%%%% MISCELLANEOUS %%%%%%%%

\def\SS{\scriptscriptstyle}
\newcommand{\cfa}[4]{\!{\textstyle \left[ {{#1}\atop {#2}} {{#3}\atop{#4}} \right] }}

%%%%%%%%%% Sundry %%%%%%%%%%%%%%%%%%%
\newcommand{\BesselI}[3]{\hat I_{#1}\left( #2 \pi \sqrt{ #3 }\right)}

\newcommand{\Zar}[2]{Z\!\left[ {}^{#1}_{#2} \right]}

\newcommand{\ar}[2]{\left[ {}^{#1}_{#2} \right]}
\newcommand{\art}[2]{\left[ {}^{\frac{#1}{2}}_{\frac{#2}{2}} \right]}
\newcommand{\CP}{\Bbb{CP}}


\def\vt#1#2#3{ {\vartheta[{#1 \atop  #2}](#3\vert \tau)} }

\def\dbend{\lower3.5pt\hbox{\manual\char127}}
% \def\IZ{\relax\ifmmode\mathchoice
% {\hbox{\cmss Z\kern-.4em Z}}{\hbox{\cmss Z\kern-.4em Z}}
% {\lower.9pt\hbox{\cmsss Z\kern-.4em Z}} {\lower1.2pt\hbox{\cmsss
% Z\kern-.4em Z}}\else{\cmss Z\kern-.4em Z}\fi}
\def\sdtimes{\mathbin{\hbox{\hskip2pt\vrule height 4.1pt depth -.3pt
width .25pt \hskip-2pt$\times$}}  }

%%%Atish Macros%%%%

\def\IL{\relax{\rm I\kern-.18em L}}
\def\IH{\relax{\rm I\kern-.18em H}}
% \def\IR{\relax{\rm I\kern-.18em R}}
\def\inbar{\vrule height1.5ex width.4pt depth0pt}
% \def\IC{\relax\hbox{$\inbar\kern-.3em{\rm C}$}}
\def\rlx{\relax\leavevmode}

\def\ZZ{\rlx\leavevmode\ifmmode\mathchoice{\hbox{\cmss Z\kern-.4em Z}}
 {\hbox{\cmss Z\kern-.4em Z}}{\lower.9pt\hbox{\cmsss Z\kern-.36em Z}}
 {\lower1.2pt\hbox{\cmsss Z\kern-.36em Z}}\else{\cmss Z\kern-.4em
 Z}\fi}

% \def\IZ{\relax\ifmmode\mathchoice
% {\hbox{\cmss Z\kern-.4em Z}}{\hbox{\cmss Z\kern-.4em Z}}
% {\lower.9pt\hbox{\cmsss Z\kern-.4em Z}}
% {\lower1.2pt\hbox{\cmsss Z\kern-.4em Z}}\else{\cmss Z\kern-.4em
% Z}\fi}

%\def\codim{{\mathop{\rm codim}}}
%\def\cok{{\rm cok}}
%\def\coker{{\mathop {\rm coker}}}

\renewcommand{\labelenumii}{\arabic{enumi}-\roman{enumii}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Duality  and 
Mock Modularity}

%
%\preprint{}



\author[1]{Atish Dabholkar,}
\author[1]{Pavel Putrov,}
\author[2]{Edward Witten}

\affiliation[1]{International Centre for Theoretical Physics\\
Strada Costiera 11, Trieste 34151 Italy}

\affiliation[2]{School of Natural Sciences, Institute for Advanced Study\\
Einstein Drive, Princeton, NJ 08540, USA}

%\email{\it atish at ictp.it, putrov at ictp.it, witten at ias.edu}}\\

 

  

\abstract{We derive a holomorphic anomaly equation for the  Vafa-Witten partition function for twisted four-dimensional $\mathcal{N} =4$ super Yang-Mills theory on $\mathbb{CP}^{2}$ for the gauge group $SO(3)$ from  the path integral of the effective theory on the Coulomb branch.  The holomorphic kernel of this equation, which receives contributions only from the instantons, is not modular but `mock modular'.  The partition function has correct modular properties expected from $S$-duality only after including the anomalous nonholomorphic boundary contributions from anti-instantons. Using M-theory duality, we  relate this phenomenon to the holomorphic anomaly of  the elliptic genus of a two-dimensional noncompact sigma model and compute it independently in two dimensions. The anomaly both in four and in two dimensions can be traced to a topological term in the effective action of six-dimensional $(2,0)$ theory on the tensor branch. We consider generalizations to other manifolds and other gauge groups to show   that mock modularity is generic and essential for exhibiting duality when the relevant field space is noncompact.}
\keywords{duality, Yang-Mills theory, M-theory, mock modularity}

\begin{document}
\maketitle
%\setcounter{tocdepth}{2}
%\tableofcontents



\section{Introduction}

The hypothesis of  $S$-duality asserts that
 $\scN=4$ super Yang-Mills theory is invariant under the action of a large duality group ($SL(2,\mathbb{Z})$ or a close relative, depending on
the four-dimensional gauge group $G$) acting on $\tau\equiv \tau_1+i\tau_2=\theta/2\pi+4\pi i/g^2$; 
here $g$ and $\theta$ are the gauge coupling and theta angle; $\tau_1$ and $\tau_2$ denote the real and imaginary parts of $\tau$ throughout this paper.
But $S$-duality is hard to test, because  computations for strong coupling are difficult.   One way to circumvent this difficulty
is to consider a topologically twisted version of the theory in which localization can be used to perform computations for strong coupling.

In this paper, we will consider one particular twisting, originally studied in the present
context in \cite{Vafa:1994tf}.   With this twisting, a formal argument shows that the partition function on a compact four-manifold $X$ is holomorphic in $\tau$
or equivalently in $q=\exp(2\pi i\tau)$.  Furthermore, if a certain curvature condition (eqn. (2.58) in  \cite{Vafa:1994tf}) is satisfied, the evaluation of the path integral can formally be
argued to
localize  on the contribution of ordinary Yang-Mills instantons.  (Without this curvature condition, one localizes on the solutions of a more
complicated system of equations.)    The contribution to the path integral from the component of field space with instanton number\footnote{Here $n$ is an integer
for a simply-connected gauge group such as $G=SU(2)$, but may have a fractional part if  $G$ is not simply-connected.   The fractional part is  determined
by a two-dimensional cohomology class (for example, by the second Stieffel-Whitney class $w_2$ if $G=SO(3)$), and in the partition function  $\sum_n a_n q^n$, it is natural
to sum 
over all bundles  keeping this class fixed.   The values of $n$ in the sum are then congruent to each other mod  $\Bbb Z$.  A restriction on $w_2$ (and its analog for other groups)
is assumed in eqn. (\ref{expz}) and other similar formulas in this paper.}  $n$ is then $a_n q^n$,
where $a_n$ is the Euler characteristic of the instanton number $n$ moduli space $\scM_n$.   Thus the partition function after  summing over bundles
of all values of the instanton number is expected to be
\bea\label{expz} Z=\sum_n a_n q^n. \eea

The relevant curvature condition is  highly restrictive, but there are a number of four-manifolds that satisfy this condition
and for which computations of the $a_n$ were available in the mathematical literature  \cite{Klyachko:1991, Yoshioka:1994}.   
In particular, two important examples are a K3 surface and $\CP^2$. 
For K3, the expectations were borne out; the function $\sum_n a_n q^n$ is a holomorphic modular function\footnote{Here and below by a ``modular function'' we mean a function which is invariant under the action of a congruence subgroup of $SL(2,\Z)$, up to a possible multiplier system. For the reasons explained later, in this paper the partition function is assumed to be normalized so that it has modular weight zero.}.   What happens for $\CP^2$ is more complicated.
There is a natural modular function $Z(\tau,\bar\tau)$  whose holomorphic part is $\sum_n a_n q^n$, but this function is not holomorphic.   It has a ``holomorphic
anomaly''  which for $SO(3)$ bundles with $w_2=0$ reads\footnote{Up to a factor of 2, this formula  also holds for gauge group $SU(2)$.}
\bea\label{holanom} \frac{\partial Z}{\partial \bar \tau}=  \frac{3}{16\pi i\tau_2^{3/2}\eta(\tau)^3}\sum_{n\in\Bbb Z} \bar q^{n^2}. \eea
(There is a second such formula, which we  consider later,  for bundles with nonzero  $w_2$.) 
A microscopic explanation of the failure of holomorphy was not provided in  \cite{Vafa:1994tf}.   However, it was noted that the right hand side of eqn. (\ref{holanom})
-- and also its analog with $w_2\not=0$ -- looks like it could come from a sum over abelian anti-instantons on the Coulomb branch.   On the Coulomb
branch, the gauge group is broken from $SO(3)$ (or $SU(2)$)  to  $U(1)$, and $\bar q^{n^2}$ can be interpreted as the  exponential of the classical action for a $U(1)$
anti-instanton of flux $n$.  On this  interpretation, the origin of the factor $\frac{3}{16\pi i}\tau_2^{-3/2}$ is not immediately apparent.  It is anyway not clear
why we should be summing over anti-instantons in a theory that formally can be argued to localize on instantons.


Subsequent developments have made it clear that the holomorphic anomaly must indeed come from the Coulomb branch and more specifically from a surface
term at infinity on the Coulomb branch.   One development involves Donaldson theory of four-manifolds or more precisely its interpretation in terms of $\scN=2$ super Yang-Mills
theory.   A formal argument shows that certain correlation functions in a twisted version of the $\scN=2$ theory depend only on the smooth structure of a four-manifold $X$
and not on its Riemannian metric $g$.  These correlators are expected to coincide with the Donaldson  invariants.
From a mathematical point of view \cite{donaldson1987irrationality},
the Donaldson invariants are true invariants  for $b_2^+>1$ but  for $b_2^+=1$, they instead have 
a chamber structure: they
are generically invariant under a small change in the metric $g$, but they jump when one crosses certain ``walls'' in the space of metrics.     This phenomenon
is analogous to wall-crossing for BPS states in various supersymmetric models.   The wall-crossing phenomenon  was studied
in \cite{Moore:1997pc} from a gauge theory point of view and was  found to originate
from a surface term at infinity on the Coulomb branch.\footnote{For $b_2^+>1$,
there are enough fermion zero-modes on the Coulomb branch to prevent wall  crossing  behavior, so the Donaldson invariants are
 true topological invariants. There has been very little study of the case $b_2^+=0$,
 partly because nonzero Donaldson invariants for gauge group $SU(2)$ or $SO(3)$ (the groups most studied) can only arise if $b_1+b_2^+$ is odd, so that if $b_2^+=0$,
 $b_1$ must be nonzero.  But most of the interest in four-manifold theory is on simply-connected four-manifolds, which necessarily have $b_1=0$.
    However, the case $b_2^+=0$ certainly merits more study.} 
 In other words, the formal proof that certain correlation
functions are independent of $g$ involves integration by parts in field space.   Upon ``localization,'' the proof requires integration by parts on the Coulomb branch of the
theory, and there is a possibility of a surface term at infinity.   Such a surface term arises for $b_2^+=1$ and accounts for wall crossing.

Going back to $\scN=4$, the formal proof of holomorphy of the twisted theory again  involves integration by parts, so it is reasonable to ask if again there may be a surface term
at infinity on the Coulomb branch that accounts for the holomorphic anomaly.   
Indeed, it was pointed out in  \cite{Vafa:1994tf} that $\CP^2$ has $b_2^+=1$ (while K3 has $b_2^+>1$)  and it was suggested that
a holomorphic anomaly would arise on any four-manifold with $b_2^+=1$.    The goal of the present paper is to demonstrate this, by performing the appropriate
analog of the computation in \cite{Moore:1997pc}.


Before saying more about this, we pause to explain a dual version of the problem.   A two-dimensional supersymmetric field theory of a rather general type
has a natural invariant, the elliptic genus.  It is defined by a path integral on a torus $T^2$.  Fields in the sigma-model are taken to be periodic functions on the torus
up to possible twists by symmetries; the twists are chosen so that the supercurrent associated to one of the supersymmetries is invariant, but otherwise
one allows arbitrary twists.      For a sigma-model with a compact target space (or for any supersymmetric field theory with a discrete spectrum), the elliptic
genus is a holomorphic function of the modular parameter $\tau$.      However, for a sigma-model with a noncompact target space, the elliptic genus can have a holomorphic anomaly
\cite{Eguchi:2010cb,Troost:2010ud,Sugawara:2011vg,Ashok:2013pya,Murthy:2013mya,Hori:2014tda,Harvey:2014nha,Giveon:2015raa,Gaiotto:2019gef, Dabholkar:2019nnc}.    
The elliptic genus defined by a path integral on the torus is then still modular invariant,  but it is no longer holomorphic.  
In this situation, the elliptic genus becomes, in modern language, a mock modular function rather than an ordinary holomorphic modular function.    

 In a sigma-model with target $W$,
supersymmetric localization reduces the computation of the elliptic genus to an integral over the space of constant maps from $T^2$ to $W$.  This space of constant
maps   plays
the role of the Coulomb branch in the gauge theory.   The space of such constant maps is a copy of $W$.   The proof of holomorphy involves an integration
by parts on $W$, and the anomaly in holomorphy comes from a surface term at infinity.   For sigma-models,
this has been studied in a variety of ways in the literature.    The derivation in \cite{Gaiotto:2019gef}, with a direct calculation of the holomorphic anomaly
in terms of the behavior  at infinity in $W$, will be particularly useful as background to our computation.


The two  arenas for a holomorphic anomaly that we have mentioned -- gauge theory in four dimensions  and supersymmetric field theory in  two dimensions --
can be dual, for the  following reason.
  $S$-duality in four dimensions is believed to be intimately connected with the existence and properties of a certain superconformal field
theory in six dimensions, the $(2,0)$ model.
In  particular, the $(2,0)$ theory on Euclidean six manifold
$M= T^2 \times X$, in the limit that the area of the $T^2$ is very small, keeping fixed its complex structure, is expected to reduce to $\scN=4$ super Yang-Mills
theory on $X$, with the $\tau$ parameter of the gauge theory simply equal to the $\tau$ parameter that determines the complex structure of $T^2$.   
The twisting of the $\scN=4$ theory on $X$ that is under discussion here 
can be ``lifted'' to a twisting of the $(2,0)$ model on $T^2\times X$. Formally, the partition function of this twisted version of the theory
should not depend on the metric of $X$ and should depend holomorphically on
$\tau$.   But we will be exploring a possible anomaly in this holomorphy. 

We will study the $(2,0)$ theory on $T^2\times X$ in either of two limits.   If the $T^2$ is very small compared to $X$, then as already stated, we reduce to gauge theory on $X$.  We will call this the gauge theory region.
 In the opposite limit that $X$ is very small compared to $T^2$, we reduce to a supersymmetric (possibly
superconformal) field
theory on $T^2$.   We will call this the sigma-model region, since the
 supersymmetric model in question can be described as  a sigma-model in the asymptotic region of field space that is important for the holomorphic anomaly
 (something as simple as this is not expected in the interior).
Because the area of the $T^2$ does not matter in the topologically twisted theory, we must get the same holomorphic anomaly whether we compute in the sigma-model
region or the gauge theory region.


In the gauge theory region, we will exhibit the holomorphic anomaly by a computation somewhat analogous to that in  \cite{Moore:1997pc}, and in the sigma-model region,
we will exhibit the same anomaly by a calculation somewhat along lines of \cite{Gaiotto:2019gef}.
Actually, a computation using only the lowest order terms in the effective  action on the Coulomb branch of the gauge theory
or the target space of the sigma-model
will not show the holomorphic anomaly.  In that approximation, the holomorphic anomaly vanishes.  It is necessary to include a certain correction in the effective action. 
In understanding wall crossing in $\scN=2$ super Yang-Mills theory, the 1-loop quantum correction to the classical metric
on the Coulomb branch plays an important role.  For $\scN=4$,  there   is no such quantum correction to the metric of the Coulomb branch, but at the 1-loop
level, a half-BPS correction to the effective action on the Coulomb branch is generated  \cite{Dine:1997nq}.   By exploiting holomorphy or a relation to anomalies,
it can be shown that the coefficient of this interaction is 1-loop exact.      It turns out that this interaction has the right properties
to generate the expected holomorphic anomaly in the gauge theory approach. 

The six-dimensional $(2,0)$ model on its Coulomb branch likewise  has a half-BPS
coupling, first described in \cite{Ganor:1998ve,Intriligator:2000eq}, that reduces after $T^2$ compactification  to the half-BPS interaction of the $\scN=4$  super Yang-Mills theory that
was already mentioned.   This interaction as well has a precisely known coefficient.   
We will show that this 6d coupling, after  twisted compactification on $X$, has just the right properties to generate the expected 
holomorphic anomaly in the sigma-model approach.    

The computations of the   holomorphic anomaly both in the gauge theory region and the sigma model region yield the same result  on the right hand side of  \eqref{holanom},  but the various factors  have different origins in the two regions.  
\begin{myitemize}
\item The  factor of $3$  is related to the first Chern class of the canonical line bundle of $\mathbb{CP}^{2}$ in the gauge theory region and to the  quantum of $H$-flux in the sigma-model region. 
\item  The factor of  $\tau_2^{-3/2}$ comes  from the integral over the constant mode of the auxiliary field in the gauge theory region and from the integral over three non-compact bosonic zero-modes in the sigma model region. 
\item  The factor of  $\eta(\tau)^{-3}=\eta(\tau)^{-\chi(\mathbb{CP}^2)}$ is the contribution of point-like instantons in the gauge theory region and of the left-moving oscillators in the sigma model region.
 \item Finally, the anti-holomorphic theta-function $\sum_{n\in\mathbb{Z}}\bar{q}^{n^2}$ is a contribution of 
 abelian anti-instantons in the gauge theory region and of  right-moving momenta of a  compact chiral boson in the sigma model region. 
\end{myitemize}

In one important respect, our sigma model calculation in two dimensions is more complete than our corresponding gauge theory calculation.   In the sigma model, we will
have to do a path integral on a two-torus.  Such a path integral can be interpreted as a Hilbert space trace, and this determines its absolute normalization.
By contrast, in gauge theory we will be doing a Coulomb branch calculation on a general four-manifold $X$.   Such a path integral does not have a natural
normalization; it can be affected, for example, by topological terms proportional to the Euler characteristic and the signature of $X$.   To determine the absolute
normalization of the Coulomb branch path integral,  we would have to start in the ultraviolet with conventions that lead to a holomorphic expansion of the precise
form (\ref{expz}), and then deduce the resulting normalizations on the Coulomb branch.   We will not attempt to do that.  

Now we mention some previous and current work on related problems.
Mock modularity arising from Coulomb branch integrals in gauge  theories with ${\mathcal{N}}=2$ supersymmetry has been systematically explored in 
\cite{Korpas:2019cwg}, extending previous calculations that
had been done by more special methods \cite{Moore:1997pc,gottsche1998jacobi,Marino:1998rg,Malmendier:2008db,malmendier2010donaldson,Griffin:2012kw}.   Moreover, in forthcoming work, Manschot and Moore have analyzed the Coulomb branch integral
and the associated mock modularity in the ${\mathcal{N}}=2^*$ theory, which of course is closely related to ${\mathcal{N}}=4$ super Yang-Mills, which we study in the present
paper.   Their calculation might lead to a way to resolve the normalization issue mentioned in the last paragraph.   

We now comment on the relation between the holomorphic anomaly and mock modularity.
The naive holomorphic partition function of the twisted $SO(3)$ super Yang-Mills theory on $\mathbb{CP}^{2}$  is the  holomorphic kernel of the  anomaly equation \eqref{holanom} which receives contributions only from the instantons. It is holomorphic but not modular.   The presence of the  holomorphic anomaly implies that  the physical partition function  necessarily contains a nonholomorphic piece given by an Eichler integral of the anomaly \cite{Zagier:1975a} which receives contributions from the anti-instantons.  In modern terminology \cite{Zwegers:2008zna,MR2605321,Dabholkar:2012nd}, 
the holomorphic piece is  a (vector valued)  `mixed mock modular form' whereas the   anomaly is governed by its `shadow'. The physical partition function satisfying the anomaly equation is the `modular completion' and has  good modular properties, as expected from duality.

These considerations extend naturally  to other K\"ahler 4-manifolds with $b_{2}^{+}=1$, $b_1=0$ and to other groups. In general, when  the configuration space of the twisted theory is noncompact, the partition function is modular but not holomorphic, and satisfies a holomorphic anomaly equation similar to \eqref{holanom}.  This incompatibility  between holomorphy and modularity is the essence of mock modularity.  The  physical requirement of duality invariance of the  path integral  thus leads naturally to the mathematical formalism of mock modularity whenever the relevant configuration space is noncompact.



The structure of the paper is as follows. In Section \ref{sec:review} we review relevant facts about topologically twists of $\mathcal{N}=4$ SYM theory, their M-theory realizations and some generalities about holomorphic anomaly. In Section \ref{sec:CP2-4d} we derive the holomorphic anomaly equation for the $SO(3)$ super Yang-Mills theory on $\mathbb{CP}^2$ by a computation in the gauge theory region. In  Section \ref{sec:CP2-2d} we rederive the anomaly  in corresponding sigma model region. The nonholomorphic contributions in both regions can be seen  to originate from a topological term on the six-dimensional world volume theory of the Euclidean M5-brane described in Section \ref{sec:TopSix}.  In Section \ref{sec:generalizations} we present  generalizations to other manifolds and other gauge groups. 
 
\section{Twisting and Topological Field Theory}
\label{sec:review}

The contents of this section are as follows. In Section \ref{sec:gen}, we review the general notion of a topologically twisted theory. In Section \ref{sec:three-twists} we review all three possible twists of $\mathcal{N}=4$ 4d super Yang-Mills theory. In Section \ref{sec:twists-geom} and Section \ref{sec:twists-M} we comment on the geometric interpretation of the twists, including their realization in M-theory. In Section \ref{sec:anomaly-background} we give a general discussion on the origin of the holomorphic anomaly in topologically twisted theories.

\subsection{Generalities}
\label{sec:gen}

Here we briefly recall how $\scN=4$ super Yang-Mills theory can be ``topologically twisted'' to make what formally is a topological field theory.   We say ``formally''
because, as we will discuss, the proof of topological invariance always relies on integration by parts in field space, which can generate a surface term under some circumstances.
For more details on some of the following, see for example \cite{Vafa:1994tf}.

We first consider the theory on $\Bbb R^4$.
The rotation group in four dimensions, extended to encompass spin, is\footnote{In our conventions, self-dual 2-forms such as $F^{+} $ transform in  the representation $(\3, \one)$ of  $\spin(4) = SU(2)_{\ell} \times SU(2)_{r}$. Instanton configurations satisfy $F^{+}=0$ and hence are  anti-self-dual.}  $\spin(4)=SU(2)_\ell \times SU(2)_r$.   The $R$-symmetry group of $\scN=4$ super Yang-Mills
theory is $SU(4)_R$.   The global supersymmetries transform under $SU(2)_\ell\times SU(2)_r\times SU(4)_R$ as $(\2,\one,\4)\oplus (\one,\2,\overline\4)$,
where representations are labeled in a familiar way.

For ``twisting'' in the sense that we will consider, one picks a homomorphism $\rho:\spin(4) \to SU(4)_R$.   Then one defines a new group $\spin(4)'$, isomorphic to $\spin(4)$,
that consists of elements of $\spin(4)\times SU(4)_R$ of the form $g\times \rho(g)$, $g\in\spin(4)$.   

One picks $\rho$ so that the representation $(\2,\one,\4)\oplus (\one,\2,\overline\4)$ of $\spin(4)\times SU(4)_R$ contains at least one $\spin(4)'$ singlet.
Let us denote as $Q$ a supercharge of $\scN=4$ super Yang-Mills theory that is such  a singlet.   It will always obey $Q^2=0$.  The reason is that, more generally, if $Q$ is any linear combination of the global supercharges of $\scN=4$ super Yang-Mills theory, its  square will be a linear combination
of the translation generators,\footnote{We do not need to consider central charges in the supersymmetry algebra
for the following reason.  For our application, we will view $Q$ and $Q^2$ as automorphisms of the algebra of local operators.  Central charges commute with local operators, so
we can ignore them.   Central charges can always be defined by surface integrals at spatial infinity, so they
likewise would not appear if we quantize the theory on a compact spatial three-manifold and try to define a space of physical states
(it is natural to do this in topological field theory, but we will not actually do so in the present paper).   Central charges can appear if we 
quantize the theory on a noncompact three-manifold with boundary conditions at infinity  that correspond to spontaneous gauge symmetry breaking
(this is natural physically, but is usually less interesting in the context of topological field theory and is rather distant from our interests in the present
paper).} and these (as they commute with $SU(4)_R$) transform the same way under $\spin(4)'$ as under $\spin(4)$.  In particular, no nonzero translation generator is  $\spin(4)'$-invariant, so, if $Q$ is $\spin(4)'$-invariant, $Q^2$ must vanish. If there are multiple $\spin(4)'$-invariant supercharges $Q$ and $Q'$, this argument shows that
$Q^2=(Q')^2=\{Q,Q'\}=0$.

The basic idea of making a twisted topological field theory is now to view $Q$ as a BRST-like operator:   we only consider operators  and states that are $Q$-invariant,
and we consider an operator $\OO$ to be trivial if it is a $Q$-commutator, $\OO=\{Q,\OO'\}$ for some $\OO'$, and a state $\Psi$ to be trivial if it is $Q$-exact,
$\Psi=Q\Lambda$ for some $\Lambda$. 
Because $Q$ generates a symmetry of the path integral and  $Q^2=0$, adding $Q$-exact terms to the operators or states will not affect the expectation values of
$Q$-exact operators in $Q$-exact states.
 Specializing to $Q$-closed operators and states will lead to a topological field theory because in all cases (i.e. for every choice of $\rho$), the stress tensor, which measures the response of the theory to an infinitesimal change in a background metric, is $Q$-exact,
\bea\label{qexact}T_{\mu\nu}=\{Q,\Lambda_{\mu\nu}\} \eea
where   $\Lambda_{\mu\nu}$ is a linear combination of components of the supercurrent of the theory.   Equation (\ref{qexact}) is a special case of the usual
commutation relation of the supercharges and supercurrents, written in a way that is natural in the twisted theory.

So far we have considered the theory on $\Bbb R^4$.   It turns out that it is possible to formulate the twisted 
theory on a rather general four-manifold $X$, preserving the $Q$ symmetry,
as long as one imposes on $X$ a mild condition that depends on $\rho$ and is detailed below.   In fact, the generalization to a curved four-manifold $X$ can be made in a way that preserves all of the $\spin(4)'$ invariant supercharges, and the fact that any linear combination of them squares to zero.

With the goal of formulating the theory on a general manifold, we view $\spin(4)'$ as the rotation symmetry group, so in general fields do not have the same
spin they have under the original rotation group $\spin(4)$.   We use the $\spin(4)'$ quantum numbers in coupling the fields of the $\scN=4$ theory to a background
curved metric on any manifold $X$.   This defines the coupling to a curved background modulo some nonminimal terms (explicit coupling to the Riemann tensor of $X$) which in some
cases are needed to preserve the $\spin(4)'$ invariant supersymmetries.   

The coupling to the background curved  metric can be made in such as way that  eqn. (\ref{qexact}) still holds, that is, the stress tensor remains $Q$-exact.   
Formally, this  means we get a topological field theory: as long as we consider only $Q$-invariant operators and their matrix elements between $Q$-invariant states,
the expectation value or matrix element of $\{Q,\Lambda_{\mu\nu}\}$ will vanish because of $Q$-invariance of the path integral, and hence the response of the theory 
to a change in the background metric of $X$ will vanish.   However, as noted in the introduction, this step needs to be treated with care.   The claim that
$\langle \{Q,\V\}\rangle =0$ for any operator $\mathcal{V}$ is ultimately based on integration by parts in field space.  
An anomaly might come from a surface term at infinity.   For example, in Donaldson theory of four-manifolds, viewed as twisted $\scN=2$
super Yang-Mills theory, the relevant integral reduces to an integral on the Coulomb branch, and  one does find
an anomaly -- a surface term at infinity on the Coulomb branch -- that spoils topological invariance in the case $b_2^+(X)=1$ \cite{Moore:1997pc}.
As explained in the introduction, in the present paper we will find that a somewhat similar anomaly spoils holomorphy in twisted $\scN=4$ super Yang-Mills,
again if $b_2^+(X)=1$.  

\subsection{The Three Twisted Theories in Detail}
\label{sec:three-twists}

Now let us describe in more detail the twisted theories of interest.
In practice, there are three possible choices of the homomorphism $\rho:\spin(4)\to SU(4)_R$, given that we want to have at least one $\spin(4)'$-invariant supercharge $Q$:

(A) The choice of $\rho$ of primary interest in this paper is such that the $\4$ of $SU(4)_R$ transforms under 
$\spin(4)'=SU(2)'_\ell\times SU(2)'_r$  as $(\2, \one) \oplus(\2, \one)$.   Thus $\spin(4)'$ commutes with a residual subgroup $SU(2)_R\subset SU(4)_R$ which permutes the two $(\2, \one)$'s, and the $\4$ of $SU(4)_R$ transforms under $SU(2)'_\ell\times SU(2)'_r\times SU(2)_R$ as $
(\2,\one,\2)$.  The 16 global supersymmetries of the $\scN=4$ theory transform under $\spin(4)'\times SU(2)_R= SU(2)'_\ell\times SU(2)'_r\times SU(2)_R$
as $(\one,\one, \2)\oplus (\3, \one, \2) \oplus (\2,\2, \2)$.   In particular, the $(\one,\one,\2)$ is a pair of
$\spin(4)'$-invariant singlet supercharges.   Because they transform as $\2$ of a residual global $R$-symmetry $SU(2)_R$, it does not matter which linear combination
$Q$ we use in defining a topological field theory; all choices are equivalent up to the action of $SU(2)_R$.

(B) The choice of $\rho$ useful in applications to the geometric Langlands program \cite{Kapustin:2006pk} is such that the $\4$ of $SU(4)_R$ transforms under $\spin(4)'$
as $(\2,\one)\oplus (\one,\2)$.  Thus $\spin(4)'$ commutes with 
a residual $U(1)_R$ subgroup of $SU(4)_R$, which we normalize so that the $(\2,\one)$ and $(\one,\2)$ respectively  have
charges 1 and $-1$.   The supercharges of the theory transform under $\spin(4)'\times U(1)_R$ as $2(\one,\one)_\mathbf{1}\oplus (\3,\one)_\mathbf{1}\oplus (\one,\3)_\mathbf{1}\oplus 2(\2,\2)_\mathbf{-1}$,
where the subscript is  the  $U(1)_R$ charge, and a 2 in front means that a representation appears twice.    In particular, there are two $\spin(4)'$ singlets.
They transform the same way (both with charge 1) under the unbroken global symmetry $U(1)_R$.   We can choose $Q$ to be a linear combination 
$\alpha Q_1+\beta Q_2$ of the two
$\spin(4)'$ singlets $Q_1$ and $Q_2$.  The resulting family of topological field theories depends in a nontrivial fashion on the parameter $t=\alpha/\beta$, 
which  plays an important role in the application to
geometric Langlands.

(C) The last case is that the $\4$ of $SU(4)_R$  transforms under $\spin(4)'$ as $(\2,\one)\oplus 2(\one,\one)$.   Thus $\spin(4)'$ commutes with  a residual  $U(2)_R$ subgroup
of $SU(4)_R$, under which the two copies of $(\one,\one)$ transform as a doublet.   The global supersymmetries transform under $SU(2)'_\ell\times  SU(2)'_r\times U(2)_R$
as 
$(\one,\one,\one)_\mathbf{-1} \oplus (\3,\one,\one)_\mathbf{-1} \oplus (\2,\2,\one)_\mathbf{1} \oplus (\2,\one,\2)_\mathbf{1}\oplus (\one,\2,\2)_\mathbf{-1}$, where the subscript is the charge under
the center of $U(2)_R$.   In particular, there is up to scaling
a unique $\spin(4)'$ singlet global supercharge $Q$ that we can use to make a topological field theory.  

In each of the three cases, it is straightforward to determine how the fields of $\scN=4$ super Yang-Mills theory transform under $\spin(4)'$.   In particular, let
us look at the adjoint-valued scalar fields $\phi$ of the theory.  Before twisting, they  transform in the $\6$ of $SU(4)_R$.   
By examining how they transform in the twisted theory, we will find what condition
must be placed on $X$ so that the twisted topological field theory can be defined on $X$.    (No additional condition comes from the gauge field $A$, as it is $SU(4)_R$-singlet so it is
not affected by twisting; and no additional condition comes from the fermions, essentially because they are related to the bosons by the action of  $Q$ and so transform
the same way under $\spin(4)'$.)

(A$'$) With our first choice of $\rho$, the six scalars transform under $SU(2)'_\ell\times SU(2)'_r\times SU(2)_R$ as $(\3,\one,\one)\oplus (\one,\one,\3)$.   In particular,
this representation is not invariant under exchange of $SU(2)'_\ell$ and $SU(2)'_r$, so the theory with this twist does not have a parity or reflection symmetry,
and $X$ must be oriented.   However, the twisted scalars have integer spin, as do the fermions after twisting, so there is no need for $X$ to have a spin structure.
That is why we can take $X=\Bbb{CP}^2$, the case in which a holomorphic anomaly was found in \cite{Vafa:1994tf}.

(B$'$) With the second choice of $\rho$, the six scalars transform under $SU(2)'_\ell\times SU(2)'_r\times U(1)_R$ as $(\2,\2)_\mathbf{0}\oplus (\one,\one)_\mathbf{2}\oplus (\one,\one)_\mathbf{-2}$.
This is a reflection symmetric representation, so $X$ need not be oriented.  (If $X$ is unorientable, the parameter $t$ discussed earlier is no longer arbitrary,
since orientation-reversal acts nontrivially on this parameter.)    The twisted scalars have integer spin, so $X$ again does not require a spin structure and we can study this theory
on $\Bbb{CP}^2$.

(C$'$) With the third choice of $\rho$, the six scalars transform under $SU(2)'_\ell\times SU(2)'_r\times U(2)_R$ as $(\2,\1,\2)_\mathbf{1}\oplus (\one,\one,\one)_\mathbf{2}\oplus (\one,\one,\one)_\mathbf{-2}$.
This  representation is not reflection symmetric, so $X$ must be oriented.   In addition, some of the scalars have half-integer spin, so $X$ must carry a spin structure.

\subsection{Geometrical Realization}
\label{sec:twists-geom}

In what follows, it will be useful to be familiar with a geometrical realization \cite{Bershadsky:1995qy} of the three  twisted theories.   First let us consider a realization by D3-branes
in Type IIB superstring theory.   We can realize $\scN=4$ super Yang-Mills, with gauge group $U(N)$, by wrapping $N$ D3-branes on $X$.  Of course, Type IIB
superstring theory is naturally defined on a 10 dimensional spacetime $Y$, so $X$ will have a rank 6 normal bundle $\W$
in $Y$.     The scalars in the super Yang-Mills multiplet describe normal
oscillations of the D-branes, so they are valued in $\W$ tensored with the adjoint representation of the gauge group $G$.   Since we have determined how
the scalars transform under the symmetries, we can read off what must be the normal bundle to $X$ in $Y$:


(A$''$) With our first choice of $\rho$, three scalars transform  under $\spin(4)'$ as $(\3,\one)$.   This is the appropriate representation for a selfdual second rank tensor or
two-form.
So one summand in $\W$ is the bundle $\Omega_2^+(X)$ of selfdual two-forms on $X$.   The other scalars are $\spin(4)'$ singlets in the vector representation of $SU(2)_R$.
The upshot of this is that we can take $Y$ to be $\Omega^2_+(X)\times \R^3$, where here by $\Omega_2^+(X)$ we mean the total space of the rank three vector
bundle $\Omega_2^+(X)\to X$, 
and $\R^3$ is a copy of three-dimensional Euclidean space, with $SU(2)_R$ as its group of rotations.   $X$ is embedded in $\Omega^2_+(X)\times \R^3$
as the zero-section of $\Omega_2^+(X)$, times a point in $\R^3$, which we can choose to be the origin.  

 For some favorable choices of $X$, such as $\CP^2$ or $S^4$,
$\Omega_2^+(X)$ admits a complete metric of $G_2$ holonomy, such that the zero-section is a ``coassociative'' (or supersymmetric) submanifold.
This puts the supersymmetry of the twisted model in a standard framework.  
 For more generic $X$, there presumably is no nice complete metric of $G_2$ holonomy on $\Omega_2^+(X)$, but we can think of $\Omega_2^+(X)$
 as carrying a $G_2$ structure near the zero-section.   That is sufficient for purposes of gauge theory.
 
 (B$''$) With the second choice of $\rho$, four scalars transform under $\spin(4)'$ as $(\2,\2)$.   This is the representation that corresponds to the tangent or cotangent bundle
 of $X$.  Once $X$ is given a Riemannian metric, the two are equivalent; it will be more natural in what follows to think in terms of the cotangent bundle $T^*X$.
 The other two scalars are $\spin(4)'$ singlets but charged under $U(1)_R$.   The geometrical picture is that $Y=T^*X\times \R^2$, where $X$ is embedded as
 the zero-section of $T^*X$ times a point in $\R^2$, and   $U(1)_R$ acts as the rotation group of $\R^2$.
 
 In a few favorable cases, such as $X=\CP^2$, $T^*X$ carries a complete Calabi-Yau metric, such that the zero-section is a Lagrangian submanifold.   This puts
 the supersymmetry of the twisted model in a standard framework.   Even when that is not so, $T^*X$ is a symplectic manifold, and a brane supported on its zero section
 is a Lagrangian brane in the $A$-model of $T^*X$, still giving a standard framework for the supersymmetry of the twisted model.    (We expect that the analog of
 this for cases A$''$ and C$''$ is that $\Omega_2^+(X)$ or $S_+(X)$ will always carry a possibly unintegrable $G_2$ structure or $\spin(7)$ structure, and that
 this suffices for topological applications.   This point of view has not been studied systematically.)
 
 (C$''$) With the third choice of $\rho$, four scalars transform under $\spin'(2)_\ell\times \spin'(2)_r\times U(2)_R$ as $(\2,\one,\2)_\mathbf{0}$, where the subscript
 refers to the charge under the $U(1)_R$ center of $SU(2)_R$.     The other two
 transform as $(\one,\one,\one)_\mathbf{\pm 2}$.   The geometrical meaning is as follows.   Let $S_+(X)$ be the positive chirality spin bundle of $X$, viewed as a real
 vector bundle of rank 4.   Then $Y$ can be identified as $S_+(X)\times \R^2$, where $X$ is embedded as the zero-section of $S_+(X)$ times a point in $\R^2$.
 $SU(2)_R$ acts on the fiber of $S_+(X)\to X$, commuting with its structure group $\spin(4)'$, and $U(1)_R$ acts on $\R^2$ by rotations.

In a few favorable cases, $S_+(X)$ carries a complete metric of $\spin(7)$ holonomy, with the zero section as a coassociative submanifold, providing a standard
framework for the supersymmetry of the twisted model.   Even when such a complete metric does not exist, this provides a sufficient description for our application
to gauge theory.

\subsection{M-Theory Variant}
\label{sec:twists-M}

Instead of considering D3-branes in Type IIB superstring theory, we can consider M5-branes in M-theory.   Here we use the fact that M-theory on $T^2\times Z$,
for a two-torus $T^2$ and any $Z$, goes over, in the limit that the $T^2$ is small, to Type IIB on $S^1\times Z$.   
In this process, an M5-brane on $T^2\times X$ (where $X $ is any submanifold of $Z$)
goes over to a D3-brane on $X$ times a point in $S^1$.   Since strings or branes wrapped on $S^1$ will not be important in anything we say, we can here decompactify
 $S^1$ and replace it by a copy of $\R$.    The complex structure of the torus, $\tau$, plays the role of the complex coupling constant in 4d. 

The upshot of this is that the geometrical descriptions that were described earlier have M-theory variants:\footnote{In what follows, $X$ is short for the zero-section
of $\Omega_2^+(X)$, $T^*X$, or $S_+(X)$.}

(A$'''$) In the first example, we can consider M-theory on $T^2\times \Omega_2^+(X)\times \R^2$ with M5-branes wrapped on $T^2\times X$ times a point in $\R^2$.   

(B$'''$) In the second example, we can consider M-theory on $T^2\times T^*X\times \R$ with M5-branes wrapped on $T^2\times X$ times a point in $\R$.

(C$'''$) In the third example, we can consider M-theory on $T^2\times S_+(X)\times \R$ with M5-branes wrapped on $T^2\times X$ times a point in $\R$.   

In each of these cases, we have the option to make the $T^2$ larger or smaller than $X$.   In the limit that $T^2$  is very small, we return to the  Type IIB
description via D3-branes wrapped on $X$.   This in turn can be described in terms of the four-dimensional twisted versions of $\scN=4$ super Yang-Mills
theory, as described above.
In the opposite limit that $X$ is very small compared to $T^2$, we get a description in terms of a conformal field theory on $T^2$.  We will explore both limits in this paper.

Parallel M5-branes, which we have used in this  explanation, give a particular realization of the $(2,0)$ superconformal field theory in six dimensions.  Instead of talking
about M5-branes wrapped on $T^2 \times X$, we could more generally talk about the $(2,0)$ model on $T^2 \times X$.  This formulation is more general as it encompasses all groups
of $\sf{A-D-E}$ type.

 

Consider in more detail the twist of type (A$'''$). The (uncompactified) 6d theory has $\text{Spin}(5)_R\times \text{Spin}(6)$ global symmetry, where the first factor is the R-symmetry and the second factor describes (local) rotations of the 6d spacetime. When the 6d theory put on a spacetime of the form $X\times \Sigma^2$, where $X$ is an oriented 4-manifold and $\Sigma^2$ is a Riemann surface, the second factor naturally breaks into $\text{Spin}(2)\times \text{Spin}(4)\subset \text{Spin}(6)$. The two factors correspond to local rotations on $\Sigma^2$ and $X$ respectively. The topological twist is then realized by identifying the $SU(2)_\ell$ subgroup of $\text{Spin}(4)\cong SU(2)_\ell\times SU(2)_r$ with $SU(2)_R\cong \text{Spin}(3)_R\subset \text{Spin}(5)_R$ embedded in the standard way. 

In the M-theory setting, the 6d type $A_1$ theory describes the dynamics of a stack of 2 M5 branes, with center of mass degrees removed. Then 6d spacetime rotations and the R-symmetry can be both embedded into the group of 11d rotations: $\text{Spin}(6)\times \text{Spin}(5)_R\subset \text{Spin}(11)$ where $\text{Spin}(5)_R$ correspond to the rotations along the directions orthogonal to the worldvolume of the 5-branes. The topological twist can be then realized by the following geometric background in M-theory:
\begin{equation}
\begin{array}{ccl}
\text{M-theory:} & \Omega_2^+(X) & \times \Sigma^2 \times \mathbb{R}^2 \\
\text{5-branes:} & X & \times \Sigma^2  \\
\end{array}
\end{equation}
where $\Omega_{2}^{+}(X)$ is the total space of the rank 3 vector bundle of the self-dual 2-forms over $X$. This construction follows from the fact that antisymmetric rank 2 tensors of $SO(4)\equiv \text{Spin}(4)/\mathbb{Z}_2$ transforms as a triplet of $SU(2)_r\subset \text{Spin}(4)$. After the topological twist $SU(2)_r$ is identified with the $\text{Spin}(3)_R\subset \text{Spin}(5)_R$ subgroup of the R-symmetry that corresponds to the rotations of the fibers of the normal bundle to the worldvolume of the 5-branes. The total space $\Omega_{2}^{+}(X)$ is a local $G_2$-manifold and $X$ is a coassociative cycle.

When $X$ is K\"ahler, as in the case of $X=\mathbb{CP}^2$, its holonomy is reduced to $U(2)\subset SO(4)\equiv \text{Spin}(4)/\mathbb{Z}_2$. 
In particular, $SU(2)_\ell$ is reduced  to its maximal torus $U(1)_\ell\subset SU(2)_\ell$. After the topological twist, this maximal torus is identified with the 
subgroup $U(1)_R\equiv \text{Spin}(2)_R\subset \text{Spin}(5)_R$ embedded in the standard way (i.e. as a subgroup corresponding to the rotations 
among 2 out of 5 normal directions). The three-dimensional real  representation of $\text{Spin}(3)_R$ decomposes into a complex 1-dimensional 
representation of $U(1)_R$ of charge 2 plus  a trivial 1-dimensional real representation. Geometrically this correponds to the splitting of the rank 3 real vector bundle into a real rank 1 trivial bundle and a rank 1 complex vector bundle: $\Omega_{2}^{+}(X)=\mathbb{R}\times KX$ where $KX:=\Lambda^2T^*_\mathbb{C}X$ is the canonical bundle of $X$, 
considered as a complex manifold. The total space $KX$ of this canonical bundle is a local Calabi-Yau 3-fold.

\subsection{Some Background Concerning the Anomaly}
\label{sec:anomaly-background}

In  cases A and C, one finds that if $S_\text{4d}$ is the action of the theory, then the antiholomorphic dependence of $S_\text{4d}$ on the gauge theory coupling parameter $\tau$ is
$Q$-exact, meaning that
\bea\label{holreason}\frac{\partial S_\text{4d}}{\partial\bar \tau}=\{Q,\Lambda\}, \eea
for some functional $\Lambda$. (The details of case B are more complicated and depend on the choice of the parameter $t$.)
Formally, it follows that as long as we only discuss $Q$-invariant operators and states, all computations in cases A or C will give results holomorphic in $\tau$.  
In fact, as already mentioned, the proof of decoupling of $Q$-exact operators  depends on integration by parts and there is a possibility of an anomaly coming from
a surface term at infinity.
As explained in the introduction, from explicitly known formulas it appears that there is such a holomorphic anomaly in case A provided that $b_2^+(X)=1$.   
In the present paper, we will aim to elucidate this anomaly.  

We will primarily aim to understand the case of  gauge group $SU(2)$ or $SO(3)$,  which can be realized by a system of two D3-branes or two M5-branes after removing
the center of mass degree of freedom.  A possible anomaly
will come from the Coulomb branch, which in the geometric description is the region in which  two branes are widely separated in the {\it untwisted} directions.
For example, for D3-branes on $\Omega_2^+(X)\times \R^3$, $T^*X\times \R^2$, or $S_+(X)\times \R^2$, the Coulomb branch is the region in  which
the D3-branes are widely separated  in $\R^3$, $\R^2$, or $\R^2$.   The overall  center of mass motion of the D3-brane system is described by a free system.  The Coulomb
branch that we are interested in parametrizes the relative motion between the two D3-branes.   So
we can effectively describe the Coulomb branch  asymptotically in terms of the degrees of freedom of a single D3-brane wrapped on $X$
but   near infinity in the second
factor of $\Omega_2^+(X)\times \R^3/\Z_2$, $T^*X\times \R^2/\Z_2$, or $S_+(X)\times \R^2/\Z_2$.   (Here in describing the relative motion of
the two D3-branes, we  divide by $\Z_2$ to account for the Weyl group
that exchanges the two D3-branes.)      In the M-theory description, the story is similar.   The Coulomb  branch for the relative motion of a pair of
M5-branes can be described in terms of a single M5-brane wrapped on $T^2\times X$ times a  point near infinity in the last factor of
$T^2\times \Omega_2^+(X)\times \R^2/\Z_2$, $T^2\times  T^*X\times \R/\Z_2$, or $T^2\times S_+(X)\times \R/\Z_2$.  

We will find the anomaly by a careful study of the effective field theory on the Coulomb branch.
In doing this, as remarked in the introduction, it is necessary to include in the theory on the Coulomb branch
a certain half-BPS interaction that was originally described in  \cite{Dine:1997nq} in the context of supersymmetric Yang-Mills theory, or its M-theory analog, which
was originally described in  \cite{Ganor:1998ve,Intriligator:2000eq}.

Formally,  in any of the three twisted theories under discussion, one can calculate by a procedure of supersymmetric localization.    Formally, one can show
that modulo $Q$-exact terms, the path integral of any of the three twisted theories can be localized on configurations that satisfy $\{Q,\chi\}=0$, where $\chi$
can be any of the fermion fields of the theory.   The equations $\{Q,\chi\}=0$ become a system of elliptic differential equations modulo the gauge group
for bosonic fields in the theory.   In theories A and B, these equations have been discussed in detail in \cite{Vafa:1994tf} and \cite{Kapustin:2006pk},
respectively.   In theory C, the localization equations are similar to the ``monopole'' equations studied in \cite{Witten:1994cg}.   Actually, the details of this localization procedure will not be our focus in the present paper;
what we will be interested in here is precisely how this localization can fail.   Since localization holds modulo $Q$-exact terms, the localization procedure
will give an incomplete result if there is an anomaly at infinity on the Coulomb branch.   The anomaly that we will explore violates the predictions of the formal
localization procedure which implies  holomorphy.


\section{Holomorphic Anomaly in Four Dimensions}
\label{sec:CP2-4d}

We begin in Section \ref{sec:hol-anomaly} by recalling a few facts about the  holomorphic anomaly encountered \cite{Vafa:1994tf} in the computation of  the twisted partition function of supersymmetric Yang-Mills theory with gauge group $SO(3)$ on $\mathbb{CP}^{2}$.  Our goal is to better understand how  the anomaly relates to mock modularity and eventually to noncompactness of the Coulomb branch. In Section \ref{sec:4d-WZ} we review the relevant facts about the effective action of the four-dimensional $\mathcal{N}=4$ theory on the Coulomb branch. In Section \ref{sec:4d-hol-anomaly} we give the derivation of the holomorphic anomaly from the path integral of the effective four-dimensional theory.

\subsection{Mock Modularity of $\mathbb{CP}^2$ Partition Function}

\label{sec:hol-anomaly}

Since $H^2(\mathbb{ CP}^2,\Z_2)\cong \Z_2$, an $SO(3)$ bundle $E\to\mathbb{C}^2$ has two possible values of $v=w_2(E)$: $v=0$ with $v^2=0$ and  $v\not= 0$ with $v^2=-1$ modulo 4.
Accordingly, there are two partition functions, which we denote by $Z_{0}(\t)$ and $Z_{1}(\t)$.  
It was shown in \cite{Vafa:1994tf} using  the work of Klyachko and Yoshioka \cite{Klyachko:1991, Yoshioka:1994} that the partition functions can be expressed in terms of  the 
Hurwitz-Kronecker class numbers denoted by  $H(N)$ for $N \in \bZ$.  These class numbers  are defined for $N>0$ as the number of $PSL(2,\bZ)$-equivalence classes of 
integral binary quadratic forms of discriminant $-N$, weighted by the reciprocal of the number of 
their automorphisms (if $-N$ is the discriminant of an imaginary quadratic field $K$ other than $\bQ(i)$ or 
$\bQ(\sqrt{-3})$, this is just the class number of $K$), and for other values of $N$ by 
$H(0) = -1/12$ and $H(N)=0$ for $N<0$. These numbers vanish unless $N$ is $0$ or $-1$ modulo $4$. 

With these definitions,  the partition functions of the 
topologically twisted supersymmetric $SO(3)$ 
Yang-Mills theory on $\mathbb{CP}{^2}$ \cite{Vafa:1994tf} are given by
\bea\label{Zs}
Z_{0}(\t) &=& \frac{3}{\eta^{3}(\t)} \hh_{0} (\t)  \, , \\
Z_{1}(\t) &=& \frac{3}{\eta^{3}(\t)} \hh_{1} (\t)  \, , 
\label{Z-v-CP2-result}
\eea
where  $\eta(\tau)$ is the Dedekind eta function and  
\bea\label{fs}
\hh_0(\t) &=& \sum_{n\geq 0}H(4n) q^{n}+
2{\tau_2}^{-1/2}\sum_{n\in Z} \beta (4\pi n^2\tau_2 ) q^{-n^2}\,, \nonumber \\
\hh_1(\t) &=&\sum_{n>0} H(4n-1)q^{n-\frac{1}{4}}+
2{\tau_2}^{-1/2}\sum_{n\in Z} \beta (4\pi (n+{1\over 2})^2
\tau_2 ) q^{-(n+{1\over 2})^2},
\eea
with $\tau = \t_{1} + i \t_{2}$ and 
\be 
\beta (t)={1\over 16 \pi}\int_1^\infty u^{-3/2} {\rm exp}(-u t)\ du \, ,
\ee
which equals  the complementary error function up to normalization.

Note that in \cite{Yoshioka:1994,Vafa:1994tf} there is a factor of  $\eta(\tau)^6$ in the denominator instead of $\eta(\tau)^3$ as in \eqref{Zs}. The generating functions considered there are for compactified moduli spaces of anti-self-dual $U(2)$ connection with fixed value of the first Chern class. This is because those formulas were obtained in algebro-geometric setting, where the moduli spaces are realized as the moduli spaces of stable rank two sheaves on $\mathbb{CP}^2$ with fixed first and second Chern classes. The extra $1/\eta(\tau)^3=1/\eta(\tau)^{\chi(\mathbb{CP}^2)}$ compared to the $SU(2)$ case can be understood as the contribution of the abelian point-like instantons from the diagonal $U(1)$ subgroup of $U(2)$. The formulas (\ref{Z-v-CP2-result}) are consistent with the fact that, by lifting the theory to the 6d (2,0) theory on $\mathbb{CP}^2\times T^2$, one can argue that the physically normalized partition functions $Z_v(\tau)$ should transform as a vector valued modular form of weight \textit{zero}, with a multiplier system determined by 't Hooft anomalies. The case of $U(2)$ gauge group will be discussed further in  Appendix \ref{app:U2}. 

The functions $\{\hh_{\ell}(\tau)\}$ are not purely holomorphic because of the second term in \eqref{fs}
and  satisfy the \textit{holomorphic anomaly equation}:
\bea
\tau_2^{3/2} {\partial\over \partial\bar \tau} \hh_0&=&{1\over 16 \pi i}
{\sum_{n\in
		\bZ}{\bar q}^{ n ^2}}\,,
		\label{hol-anomaly-vector}
		\\
\tau_2^{3/2}{\partial\over \partial\bar \tau} \hh_{1}&=&{1\over 16 \pi i}
{\sum_{n\in
		\bZ}{\bar q}^{ (n+{1\over 2})^2}}\,.
\label{hol-anomaly-vector-1}
\eea
A nontrivial fact \cite{Zagier:1975a} is that $\hh(\t)=\begin{pmatrix}\hh_0(\tau)\cr \hh_1(\tau)\end{pmatrix}$  transforms 
as a vector valued modular form with weight $3/2$ under the modular group $\Gamma_0(4)$. In particular, 
\bea
\left(\begin{array}{c}\hh_0(-1/\tau) \\
	\hh_1(-1/\tau)
\end{array}\right)
=\left({\tau\over i}
\right)^{3/2}\cdot {-1\over \sqrt 2}
\left(\begin{array}{cc}
	1 & 1 \\1 &-1\end{array}\right)
\left(\begin{array}{c}\hh_0(\tau) \\ \hh_1(\tau) 
\end{array}\right)      \, .             
\eea
Since $\hh_0$ is invariant under $T$
and $\hh_1$ under $T^4$,  $\hh_0$ has the expected modular transformation law
under the group $\Gamma_0(4)$ generated by $T$ and $ST^4S$,
as expected from  S-duality \cite{Vafa:1994tf}. 

The   holomorphic parts of $\{\, \hh_{\ell}(\t)\, \}$ are
\bea\label{hs}
h_0(\t) &=& \sum_{n=0}^\infty H(4n) q^n\,, \\ 
h_1(\t) &=&  \sum_{n=1}^\infty H(4n-1)q^{n-{1\over 4}}\,.
\eea
In modern terminology  \cite{Zwegers:2008zna,MR2605321,Dabholkar:2012nd},  $h(\t)$ is a \textit{ vector-valued pure  mock modular form}  with  holomorphic \textit{shadow} $g(\t)$ with components
\bea\label{gs}
g_0(\t) &=& c
{\sum_{n\in
		\bZ}{ q}^{ n ^2}}\,,\\
g_{1}(\t) &=& c
{\sum_{n\in
		\bZ}{ q}^{ (n+{1\over 2})^2}}\, , 
\eea
where $c = {1\over 16 \pi i}$ is  the overall normalization for which there is no standard convention. 
The vector  $h(\t) $ is holomorphic but  not modular. Addition of the correction terms in \eqref{fs} constructed from the  shadow vector $g(\t)$  yields its  \textit{modular completion} $\hh (\t)$. 
The completion is modular but not holomorphic. This incompatibility between modularity and holomorphy is the essence of mock modularity. 

The connection to mock modularity can be seen more simply by combining the two components of the vector-valued mock modular form into  a single  mock modular form defined by ${\bf H}(\t)=h_0(4\tau)+h_1(4\tau)$. This gives the Zagier mock modular form  \cite{Zagier:1975a} which  is  the generating  function for  the Hurwitz-Kronecker class numbers:
\be\label{classnum}  
{\bf H}(\t) \;:=\; \sum_{N=0}^{\infty} H(N)\,q^{N} 
\ = -\frac{1}{12} \ + \frac{1}{3} q^3 \ + \frac{1}{2} q^4 \+ q^7 \ + q^8 \ + q^{11} \+ \cdots  
\ee
It   is a `pure mock modular form'  
of weight $3/2$ on $\Gamma_0(4)$ and  shadow the classical theta function $\vartheta (\tau)  = \sum q^{n^2}$.
See  \cite{MR2605321,Dabholkar:2012nd} for the definition and further discussion.
We see from the $q$-expansion of ${\bf H}(\tau)$ that it   has no poles at $q=0$  and hence  is strongly holomorphic.  Consequently,  its Fourier coefficients grow very slowly. This  is  exceptional. In fact, up to minor variations the Zagier mock modular form is essentially the {\it only} known non-trivial example of a strongly holomorphic pure mock modular form. 

The components $\{ h_{\ell}\}$ are most naturally regarded as the vector of theta coefficients of a mock Jacobi form $ \cH(\t,z)$ defined by
\be\label{classH}  
\cH(\t,z) \,  := \, h_0(\t)\vth_{1,0}(\t,z)\+ h_1(\t)\vth_{1,1}(\t,z) 
\, = \,  \sum_{\substack{n,\,r\in{\bZ} \\ 
		4 n - r^2 \ge 0}}  H(4n-r^2) \, q^n\,y^r\,,  
\ee 
where $y=e^{2\pi i z}$ and
\be\label{levelm}
\vth_{m,\ell}(\t,z) :=  \sum_{\substack{{r\inn\Zint} \\ {r\,\equiv\,\ell\; (\textrm{mod}\,2m)}}} q^{r^2/4m} \, y^r \, \qquad \qquad (\ell\  \textrm{mod} \ 2m)
\ee
are the level $m$ theta functions. 
Following the definition in \cite{Dabholkar:2012nd}, one can check that $ \cH(\t,z)$ 
is a mock Jacobi form of weight $2$ and index $1$ with holomorphic anomaly (up to  normalization)
\be
\overline{\vth_{1,0}(\t,0)}\,\vth_{1,0}(\t,z)\,  + \,
\overline{\vth_{1,1}(\t,0)}\,\vth_{1,1}(\t,z) \, .
\ee

Note that a similar relation between components $\{h_\ell\}$ form and a single Jacobi mock modular form appears in the decomposition of the Vafa-Witten $U(2)$ partition functions into the sum of products of $SO(3)$ and $U(1)$ partition functions. However, the latter decomposition is different because the coefficients in that case are \textit{anti-holomorphic} theta functions. We will discuss it in more detail in Appendix \ref{app:U2}.

\subsection{Wess-Zumino Term in Four Dimensions}
\label{sec:4d-WZ}

As explained in the introduction,   the holomorphic anomaly of interest is given by a contribution from the boundary of the space of the bosonic zero-modes. Saturation of  fermionic zero-modes in this region is governed by the two-fermion superpartner of a Wess-Zumino term which we describe below and in Appendix \ref{app:4dWZ-SUSY}. 

Consider a four-dimensional $\mathcal{N}=4$  super Yang-Mills theory with gauge group $G$ spontaneously broken  to $H\times U(1)$ by the vacuum expectation value of the scalar field $\Phi$ valued in $\mathbb{R}^6$. The bosonic part of the effective action, after coupling to background gauge fields of $SO(6)_R$,
 contains the following Wess-Zumino term \cite{Witten:1983tw,Tseytlin:1999tp,Intriligator:2000eq}:
\begin{equation}
S_\text{4d WZ}=2\pi i\, \frac{n_W}{2} \int_{\Xi^5} \eta_5
\label{4d-WZ}
\end{equation}
with
\begin{multline}
\eta_5:=\frac{1}{120\pi^3}\epsilon_{I_1I_2I_3I_4I_5I_6}[
(D_{i_1}\hat{\Phi})^{I_1}(D_{i_2}\hat{\Phi})^{I_2}(D_{i_3}\hat{\Phi})^{I_3}(D_{i_4}\hat{\Phi})^{I_4}(D_{i_5}\hat{\Phi})^{I_5}
\\
+\frac{5}{2}\,F^{I_1I_2}_{i_1i_2}(D_{i_3}\hat{\Phi})^{I_3}(D_{i_4}\hat{\Phi})^{I_4}(D_{i_5}\hat{\Phi})^{I_5}+\frac{15}{4}F^{I_1I_2}_{i_1i_2}F^{I_3I_4}_{i_3i_4}(D_{i_5}\hat{\Phi})^{I_5}]
\hat{\Phi}^{I_6}dx^{i_1}\wedge dx^{i_2}\wedge dx^{i_3}\wedge dx^{i_4}\wedge dx^{i_5},
\label{eta5-form}
\end{multline}
where $\Phi^I,\,I=0,\ldots,5$ are the six scalar fields of the unbroken $U(1)$, $\hat{\Phi}^I:=\Phi^I/\lVert \Phi \rVert$, $\lVert \Phi \rVert^2:=\Phi^I\Phi^I$,  $(D_i\Phi)^I:=\partial_i \Phi^I-A_i^{IJ}\Phi^J$, $A$ is the background $SO(6)_R$ connection and $F$ is its curvature. As usual, the integral is over  a five-dimensional manifold $\Xi^5$ which has $X$ as its boundary. The factor of $i$ is due to the fact that we work in Euclidean spacetime (here and in the rest of the paper we use the convention in which the integrand of the path integral is $e^{-S}$). This term compensates
for  the deficit in the 't Hooft anomaly of the $SU(4)_R$ R-symmetry.\footnote{The anomaly in question corresponds to the term proportional to the third Chern class $\mathrm{Tr}F^3/24\pi^3$ of the corresponding R-symmetry bundle in the degree six anomaly polynomial.}
The number  $n_W=\dim G-\dim H-1$ is the number of `W-bosons.'
In the special case when  $G=SO(3)=SU(2)/\mathbb{Z}_2$ and $H=1$, one obtains $n_W=2$. 

We can label fields such that in the description via M5-branes wrapped on $\R^4\times T^2$, $\Phi^0$ is compact and $\Phi^I$, $1\leq I\leq 5$
are noncompact fields that correspond to  oscillations of the M5-branes in the transverse $\mathbb{R}^5$.  
Only the $Spin(5)_{R}$  symmetry acting on the transverse oscillations
 is manifest in this description; it is enhanced to  $Spin(6)_{R}$ in the limit of small $T^{2}$   as $\Phi^{0}$ decompactifies. The relation between the topological terms in six and four dimensions will be discussed  in more detail in Section \ref{sec:TopSix}. 

Geometrically, $\eta_5=\hat{\Phi}^*(e_5)$  is the pull-back of the global Euler angular form $e_5$ on the total space of an $S^5$  bundle $\mathcal{E}\rightarrow \Xi^5$ to the base space $\Xi^5$ by the section $\hat{\Phi}:\Xi^5\rightarrow \mathcal{E}$. In general, for an $S^{n}$ sphere bundle $\pi:\mathcal{E}\rightarrow\Xi$,  the fiber can be thought of as a sphere in the fiber $\mathbb{R}^{n+1}$ of  a  real  vector bundle $V$.  One can define the global Euler angular form $e_{n}\in \Omega^n(\mathcal{E})$ with the following properties. Its restriction to the fiber gives the volume form $\omega_{n}$ normalized such that $\int_{S^{n}}\omega_{n}=1$. Moreover, $de_{n}=-\pi^*(e(V))$ where $e(V)$ is the standard representative of the Euler class of the bundle $V\rightarrow \Xi$. For odd $n$,  the form $e_n$ is not closed in general when the bundle is non-trivial, as in the case above for $n=5$. For even $n$, the Euler density form $e(V)$ is identically zero and $e_{n}$ is closed; this fact  will be used  in Section \ref{sec:CP2-2d} for $n=4$.  Its de Rham cohomology class satisfies $[e_n]^2=\pi^*(p_{n/2}(V))$, where $p_{n/2}(V)$ is the ${n/2}$-th Pontryagin class  of $V$. See, for example, \cite{Harvey:1998bx} for details and explicit general formulas for $e_n$.  

As shown in \cite{Belyaev:2011dg},  the Wess-Zumino term is  part of the $\mathcal{N}=4$ completion of the Dine-Seiberg term \cite{Dine:1997nq}. Restricted to  the $\mathcal{N}=2$ vector multiplet, the Dine-Seiberg term is given by a logarithmic prepotential.  However, to compute the holomorphic anomaly,  we will need not only the vector multiplet couplings but also the   couplings involving both the $\cN=2$ vector multiplet and the hypermultiplets including the auxiliary fields.  These are  related by supersymmetry to the second term in (\ref{eta5-form}) which is  linear in the R-symmetry curvature $F$.  
The supersymmetrization is therefore more elaborate than what is available in the literature and  will be discussed in Appendix \ref{app:4dWZ-SUSY}. 

\subsection{Holomorphic Anomaly}
\label{sec:4d-hol-anomaly}


To compute the holomorpic anomaly from the gauge theory path integral, we first represent the full four-dimensional  effective action $S_{4d}$ as
\begin{equation}
\frac{\partial{S_\text{4d}}}{\partial{\bar{\tau}}}=\{Q,\Lambda\}.
\label{4d-exact}
\end{equation}
 

A formula like (\ref{4d-exact}) holds both microscopically and (therefore) also  in the Coulomb branch effective field theory.   We want this formula in the Coulomb branch
effective field theory, in which
we will do the localization computation, and in a
formalism in which the scalar supercharges which are used in the localization  are realized off-shell.     An off-shell realization of the scalar supercharges gives a precise
framework for the localization computation.   The off-shell realization of the scalar supercharges in the topologically twisted $\mathcal{N}=4$ theory was considered in \cite{Yamron:1988qc,Vafa:1994tf,Labastida:1997vq}. 




The effective action on the Coulomb branch 
is the sum of a quadratic action, a half-BPS coupling that is the supersymmetric completion of the Wess-Zumino coupling of eqn. (\ref{4d-WZ}),
and various couplings of higher order that are in large supermultiplets.   These higher order couplings have no BPS properties, and we do not expect them to be relevant.
 The Wess-Zumino coupling does not depend on $\tau$ or $\bar\tau$, and, in a formalism in which
the scalar supercharges are realized off-shell, the same is true for its completion that is invariant under those supercharges.
So the half-BPS coupling on the Coulomb branch will not contribute to $\Lambda$.   Thus, we can evaluate $\Lambda$ just using  quadratic the quadratic part 
$S_\text{4d}^\text{free}$
on the Coulomb branch effective action $S_\text{4d}$:
\begin{equation}
\frac{\partial{S_\text{4d}}}{\partial{\bar{\tau}}}=\frac{\partial{S_\text{4d}^\text{free}}}{\partial{\bar{\tau}}}=\{Q,\Lambda\} \, .
\label{4d-exact-free}
\end{equation}

To determine the anomaly, we will be interested in the integral over the zero-modes  of the path integral near the boundary. The zero-modes can be readily determined.
In the twisted theory on $\mathbb{CP}^2$,  the six real scalars of the untwisted theory turn into four real scalars and a complex section of the canonical bundle. Since there are no harmonic sections of the canonical bundle over $\mathbb{CP}^2$,  there are only four real bosonic zero-modes corresponding to the four scalars. Since $b_1=0$, 
the gauge field in the Coulomb branch effective action has no zero-modes.
 Finally,  the auxiliary fields  in the twisted theory are a self-dual 2-form $H^{(2+)}$ and a 1-form $\tilde H^{(1)}$. Since $b_1=0$ and $b_2^+=1$, one obtains a single zero-mode of the auxiliary field, which we discuss in more detail in Appendix \ref{app:4dWZ-SUSY}.
 The fermions in the twisted theory consist of two scalars, two self-dual 2-forms and two vectors. Since $b_1=0$ and $b_2^+=1$ one obtains four fermionic zero-modes.  In summary,  there are four bosonic zero-modes of the four scalars,  a single zero-mode of the bosonic auxiliary field, and four  fermionic zero-modes. It may seem unusual in a supersymmetric
 theory that we have $1$  extra bosonic degree of freedom,  but  we have to divide by the volume of the  gauge group and hence the (compact) zero-mode of the gauge parameter counts as $-1$ bosonic degrees of freedom. 

Since  $ \mathbb{CP}^2$ is K\"ahler, a $Spin(4) = SU(2)\times SU(2)$ subgroup of $SU(4)_R$ R-symmetry remains unbroken after twisting. There are four scalar supercharges $Q_{A}$ and $Q_{\dot{A}}$, transforming as $\mathbf{(2,1)}\oplus \mathbf{(1,2)}$ respectively.
The four fermion zero-modes transform likewise,\footnote{In our conventions, spinor indices are raised and lowered by
 $\chi_{A} = \epsilon_{AB} \chi^{B}$ with $\epsilon_{12} =-1$ and $\epsilon^{12} = +1$ and similarly for the dotted indices.} and we denote them by $\chi^{A}$ and $\bar{\chi}^{\dot{A}}$. The four  bosonic zero-modes  transform as $\mathbf{(2,2)}$ and we denote them
    by $u_{A\dot{A}}$ with the reality conditions $(u^{A\dot{A}})^*=\epsilon_{AB}\epsilon_{\dot{A}\dot{B}}u^{B\dot{B}}$.  The zero mode of the auxiliary field transforms as a scalar 
    and we   denote it  as $\mathcal{H}$. 


 Restricted to the  zero-modes, the four off-shell  supercharges described in Appendix \ref{app:4dWZ-SUSY}, in particular in (\ref{Q-zm-operators}), take the form 
\begin{equation}
\begin{array}{rcl}
Q_A|_\text{zm} & = & \mathcal{H} \frac{\partial}{\partial \chi^A} + \bar{\chi}^{\dot{A}} \frac{\partial}{\partial u^{A\dot A}}
\\
\bar{Q}_{\dot{A}}|_\text{zm} & = & \mathcal{H} \frac{\partial}{\partial \bar{\chi}^{\dot{A}}} - \chi^{{A}} \frac{\partial}{\partial u^{A\dot A}},
\end{array}
\end{equation}
where $\text{zm}$ stands for the zero-modes.

The effective action restricted to the zero-modes can have at most four fermions. The most general action consistent with the unbroken $Spin(4)_R$ symmetry  takes the form
\begin{multline}
S_\text{4d}|_\text{zm}=G(|u|^2) + K_{AB}(u)\chi^A\chi^B
+ K_{A\dot{B}}(u)\chi^A\bar{\chi}^{\dot{B}}
+ K_{\dot{A}\dot{B}}(u)\bar{\chi}^{\dot{A}}\bar{\chi}^{\dot{B}} \\
+R(|u|^2)\epsilon_{AB}\epsilon_{\dot{A}\dot{B}}\chi^A
\chi^B \bar{\chi}^{\dot{A}}\bar{\chi}^{\dot{B}}
\label{action-zm-general}
\end{multline}
where $|u|^2:=u^{A\dot{A}}u_{A\dot{A}}$. The coefficients  depend  also on $\mathcal{H}$ and the flux of the gauge field $n=\int_{\mathbb{CP}^1} F_A/2\pi$ 
(which for the gauge group $SO(3)$
 is valued in
 $\frac{1}{2}\Z$), but we do not show this dependence explicitly.  Demanding  $Q_AS|_\text{zm}=Q_{\dot{A}}S|_\text{zm}=0$, one obtains
\bea
K_{AB}(u) &= 0, \qquad  
K_{A\dot{B}}(u)  &= -\frac{2u_{A\dot{B}}G'(|u|^2)}{\mathcal{H}}, \nonumber \\
K_{\dot{A}\dot{B}}(u)  &= 0, \qquad
R(|u|^2)  &=\frac{2G'(|u|^2)+ |u|^2\,G''(|u|^2)}{2\mathcal{H}^2}. \label{zm-constraint}
\eea
The action is thus completely determined in terms of  a single function $G(|u|^2)$. Since we are interested in the action at the boundary corresponding to $ |u|^{2}$ large, we consider the expansion
\begin{equation}
G(|u|^2)=C_0(\mathcal{H},n)+\frac{C_1(\mathcal{H},n)}{|u|^2}+\frac{C_2(\mathcal{H},n)}{|u|^4}+\ldots
\label{G-zm-expansion}
\end{equation}
The  function $C_0(\mathcal{H},n)$ is determined by the free part of the original action and hence  is a homogeneous polynomial of degree two in $\mathcal{H}$ and $n$.
The higher  $C_k(\mathcal{H},n)$ for $k>0$ are determined by the interacting part of the action related by supersymmetry to the Wess-Zumino term.  The Wess-Zumino term is  scale invariant if all scalar fields scale with weight one. Hence,
the  $C_k(\mathcal{H},n)$ are homogeneous polynomials of degree $2k$ in $\mathcal{H}$ and $n$. 
The contribution to the integral over the zero-modes from the boundary at infinity is determined by only the first two terms in (\ref{G-zm-expansion}) because the subsequent terms fall off   rapidly for large  $|u|$. 


The function $C_0(\mathcal{H},n)$ is determined  in Appendix \ref{app:4dWZ-SUSY} and is given by
\begin{equation}
S_\text{4d}^\text{free}|_\text{zm}=C_0(\mathcal{H},n)=-\frac{\tau_2}{\pi}\,\mathcal{H}(\mathcal{H}-4\pi n)+2\pi i \tau n^2.
\end{equation}
The function  $C_1(\mathcal{H},n)$ is a homogeneous polynomial of degree two and hence there are only three possible terms.   The condition that $K_{A\dot{B}}$ does not have $\mathcal{H}$ in the denominator implies that  $C_1(\mathcal{H},n)$ has no  term constant in $\mathcal{H}$. We note that according to  (\ref{zm-constraint}),
for $G(|u|^2)=1/|u|^2$ we obtain
 $R(|u|^2)= 0$ which puts  no constraint on the term linear in $\mathcal{H}$.  In summary, $C_1(\mathcal{H},n)$ takes the general form
\begin{equation}
C_1(\mathcal{H},n)=i\,a \mathcal{H}(2\pi n+b \,\mathcal{H})
\label{first-term}
\end{equation}
for some numerical constants $a$ and $b$ that need to determined.

The term linear in $\cH$ can be related by supersymmetry to the Wess-Zumino term using the off-shell formalism realizing four scalar supercharges in the twisted theory as described in Appendix \ref{app:4dWZ-SUSY}. One  obtains $a= 3/\pi$ from the relevant bosonic terms. Note that we have introduced the overall factor of $i$ in (\ref{first-term}) for convenience because the Wess-Zumino term is imaginary in Euclidean action.
The term quadratic in $\cH^2$ cannot be related  by supersymmetry to the Wess-Zumino term using only the four  off-shell scalar supercharges   described in the Appendix.  However,  the constant $b$ can be determined by imposing $Spin(6)_R$ R-symmetry and using an off-shell realization of eight supercharges in the $\cN=2$ supergravity formalism   in the untwisted theory.  One obtains  $b = -1$ from the relevant bosonic terms. 

The nonholomorphic variation of the action (\ref{4d-exact-free}) for   $Q=Q_1 + \bar Q_{ 1}$
is given by $S^{\text{free}}_{\text{4d}}|_{\text{zm}}= \{Q|_\text{zm},\Lambda_{\text{zm}}\}$ with
\begin{equation} 
\Lambda|_\text{zm}= \frac{-1}{4\pi i}\,(\mathcal{H}-4\pi n) (\chi^1 + \bar\chi^{ 1}) ,
\label{lambda}
\end{equation}
as explained  in  more detail in Appendix \ref{app:4dWZ-SUSY}. The holomorphic anomaly then takes the form
\begin{equation}
\frac{\partial Z_v}{\partial\bar\tau}=\langle \{Q,\Lambda\}\rangle=  \frac{1}{\eta(\tau)^{3}} \sum_{n\in\mathbb{Z}+v/2} C_\text{zm}(n)
\label{hol-anomaly-from-4d} \, . 
\end{equation}
where the terms  on the right have the following origin. 
\begin{myitemize}
\item The factor $\eta^{-3}=\eta^{-\chi(\mathbb{CP}^2)}$ arises  from $U(1)$ point-like instantons (see details below). 

   \item The sum  is over integral $U(1)$ fluxes  with  $v=w_2(E) \cong \mathbb{Z}_2$ being  the discrete flux. 
\item
The contributions from nonzero modes cancels due to supersymmetry as usual,  and the coefficient $C_\text{zm}(n)$  is  given by a \textit{finite-dimensional} integral over the zero-modes:
\be
C_\text{zm}(n)=
	C \int d^4u \, d^4\chi \,d\mathcal{H} \,
	Q|_\text{zm} \,
	(\Lambda|_\text{zm}\,
	e^{-S_\text{4d}|_\text{zm}})
	\label{C-integral}
\ee
where as determined above
\be
S_\text{4d}|_\text{zm} = - \frac{\tau_2}{\pi}\,\mathcal{H}(\mathcal{H} - 4\pi n)-2\pi i\tau n^2 + 2i\,a (2\pi n+b\mathcal{H})u_{A\dot{B}}\chi^A\bar{\chi}^{\dot{B}}/|u|^4+\ldots 
\ee and
$C$ is a numerical constant that depends on the normalization of the path integral measure. This expressions are of course valid only away from the origin $u=0$, where the description in terms of abelian gauge theory breaks down and extra massless degrees of freedom appear. This does not affect the calculation because the integral over $u$ is eventually reduced to an integral over the boundary at infinity using Stokes's theorem. There is no contribution to the holomorphic anomaly from a vicinity of $u=0$ as this point is away from the boundary of the field space of the original non-abelian gauge theory.
\end{myitemize}


We recall that a single point-like instanton can be formally understood as a singular configurations of the gauge field with the instanton charge (i.e. the second Chern class $c_2$) concentrated at a single point. For a non-abelian gauge field they can arise as limits of smooth field confugurations. It is known that in order to have an agreement with other descriptions of the gauge theory (including string theory), such point-like instantons should also be included in the abelian case. They also arise naturally when one considers a non-commutative deformation of the space-time \cite{Nekrasov:1998ss} and in the algebro-geometric setting, where $U(1)$ instantons are interpreted as semistable rank $1$ sheaves. The moduli space of point-like instantons on $X$ with a total instanton charge $k$ is the Hilbert scheme of $k$ points of $X$ (which is a resolution of a $k$-th symmetric product $\mathrm{Sym}^k\,X$). Their total contribution to the Vafa-Witten partition function is to multiply it by a factor $\eta(\tau)^{-\chi(X)}$ \cite{gottsche1990betti,hirzebruch1990euler,Vafa:1994tf}. 


As was explained in the introduction, in the 4d setup, to determine the absolute normalization of the path integral and therefore the constant $C$ in (\ref{C-integral}), 
one needs to compare the normalization used at short distances to
put  the holomorphic
expansion in the form (\ref{expz}) with the normalization of the path integral measure in the low energy effective field theory on the
Coulomb branch.   This normalization can be affected, among other things, by topological terms 
-- linear combinations of the Euler characteristic and signature of $X$ --  which might appear in the effective
action on the Coulomb branch after integrating out massive modes.  By contrast, in the 2d setup of  Section \ref{sec:CP2-2d}, the relevant path integral can be interpreted as a Hilbert space trace; this provides
a direct way to determine its normalization. Both 4d and 2d descriptions originate from the underlying 6d theory on $X\times T^2$, where the partition function also has interpretation as a Hilbert space trace. However, once the $T^2$ is forgotten, fixing the normalization becomes more involved.





The integrals over two out of four fermionic zero-modes in \eqref{C-integral} are  saturated by $Q|_\text{zm}$ and $\Lambda|_\text{zm}$. The other two should be  saturated by terms in the action  (\ref{action-zm-general}) that are quadratic in fermionic zero-modes. 
Bringing down the fermionic terms from the exponential, performing the Grassmann integrals,  and using
Stokes's theorem,  one obtains
\be
C_\text{zm}(n) = \frac{ a \, C}{4\pi} \int d\mathcal{H}\,(\mathcal{H}-4\pi n)(b\,\mathcal{H}+2\pi n) e^{\frac{\tau_2}{\pi}\,(\mathcal{H}-2\pi n)^2-2\pi i\bar{\tau}n^2} \cdot
\int_{S^3} (\zeta_{3}+\tilde\zeta_3)
\label{gaussian-localized}
\ee
where 
\be
\zeta_{3} := \frac{(u^{11}du^{12}-u^{12}du^{11})du^{22}du^{21}}{|u|^4} \, , 
\ee
\begin{equation}
\tilde\zeta_3 := \frac{(u^{21}du^{11}-u^{11}du^{21})du^{12}du^{22}}{|u|^4}\,,
\end{equation}
and  we have divided   the integral  by two  to  take into account the quotient by the $\mathbb{Z}_2$ Weyl group on $S^{3}$. 
We show in the appendix that the integral over $\zeta_{3} +  \tilde{\zeta}_{3}$ gives $2\pi^{2}$.  
The Gaussian integral over $\mathcal{H}$ can be readily performed to obtain
\begin{eqnarray}
C_\text{zm}(n) & = &
\frac{-i\pi^3 a C }{4}\,
\left(\tau_2^{-3/2}-4i(1+b)\frac{\partial}{\partial\bar{\tau}}\tau_2^{-1/2} \right)\,\bar{q}^{n^2}.
	\label{Czm-evaluation}
\end{eqnarray}
Note that with our choice of normalization of the auxiliary field $\mathcal{H}$ the corresponding quadratic term has a ``wrong'' sign in the exponential. To make it convergent, the integral over $\mathcal{H}$ is performed along the imaginary axis. This is the origin of the factor of $i$ in the result of the integration.
The overall sign is somewhat ambiguous and depends on the choice of orientation in the space of zero modes. We do not address the question of fixing it in this paper. Combining (\ref{hol-anomaly-from-4d}) and (\ref{Czm-evaluation}) and plugging in $a=\frac{3}{\pi} \, , b=-1$,  one obtains
\begin{equation}
\frac{\partial Z_v}{\partial\bar\tau}=\frac{3 \pi C}{4i\,\tau_2^{3/2}\eta(\tau)^3}\,\sum_{n\in\mathbb{Z}}\bar{q}^{(n+v/2)^2}
\label{hol-anomaly-from-4d-1}
\end{equation}
 in agreement with the expected formulas (\ref{hol-anomaly-vector}) and (\ref{hol-anomaly-vector-1}) if $C=(2\pi)^{-2}$ in (\ref{Czm-evaluation}). 


\section{Holomorphic Anomaly in Two Dimensions}
\label{sec:CP2-2d}


The  non-compactness  of the target space of the two-dimensional sigma model
obtained by dimensionally reducing the six-dimensional type $A_1$ theory on $\mathbb{CP}^2$ can lead to a holomorphic anomaly. This anomaly can receive a contribution only from the boundary of field space, so  it suffices to determine the sigma model in this region. 
The noncompact bosonic zero-modes of the $A_1$ theory parametrize the separation between a pair of M5-branes. 
When these fields have large expectation values,  the six-dimensional theory can be approximated by a single $(2,0)$ tensor multiplet valued in the Cartan subalgebra $\mathfrak{u}(1)\subset \mathfrak{su}(2)$. This is the regime in which we work.  


We start by reviewing relevant facts about the effective action of the six-dimensional (2,0) theory on the tensor branch in Section \ref{sec:TopSix}. Then, in Section \ref{sec:2d-fields} we determine the effective two-dimensional theory obtained by compactification of the  six-dimensional theory on $\mathbb{CP}^2$. The  two-dimensional theory is similar to a heterotic sigma-model. The Wess-Zumino-like terms in the 6d action lead to the Wess-Zumino terms in the 2d action. In Section \ref{sec:NLSM} we review relevant  facts about 2d (0,1) supersymmetric nonlinear sigma models. As in four dimensions, the  holomorphic anomaly is determined by the supersymmetrization of the Wess-Zumino term. In Section \ref{sec:2d-anomaly} we derive  the holomorphic anomaly from the path integral of the two-dimensional theory. 

\subsection{Six-dimensional Effective Action\label{sec:TopSix}}

The $(2,0)$ theory in six dimensions is characterized by a choice of a Lie algebra $\mathfrak{g}$, which is assumed to be a direct sum of simply-laced Lie algebras and $\mathfrak{u}(1)$ factors. 
For each $\mathfrak{u}(1)$, the theory contains a  $(2,0)$ abelian tensor multiplet which consists of a 2-form gauge field $B$ with self-dual 3-form field strength ($dB=\ast dB$), five scalar fields $\Phi^a\, (a=1,\ldots,5)$, transforming as a vector of ${Spin}(5)_R$, and fermionic fields in the $(\mathbf{4},\mathbf{4})$ representation of ${Spin}(6)\times {Spin}(5)_{R}$ where ${Spin}(6)$ is the six dimensional rotation symmetry and ${Spin}(5)_{R}$ is the R-symmetry.

It was argued  in \cite{Intriligator:2000eq} that  `higgsing' $\mathfrak{g}\rightarrow \mathfrak{h}\oplus \mathfrak{u}(1)$  of the (2,0) model
in six dimensions produces a  Wess-Zumino-like term in the effective action on a six-dimensional space $M$, of the form
\begin{equation}
S_\text{6d WZ}=\frac{c(\mathfrak{g})-c(\mathfrak{h})}{6}\,2\pi i\int_{\Xi^7}
\Omega_3 \wedge d \Omega_3,
\label{6d-WZ-term}
\end{equation}
where $c(\mathfrak{g})=\dim\mathfrak{g}\cdot h^{\vee}_{\mathfrak{g}}$ and $\partial \Xi^7 =M$. This term compensates for the mismatch of the  't Hooft  anomaly  for the $SO(5)_R$ R-symmetry. The overall factor of $i$ is present because we consider Euclidean action.  con The 3-form $\Omega_3$ is (locally) defined by descent:
\begin{equation}
d\Omega_3:=\eta_4
\end{equation}
with
\begin{multline}
\eta_4:=\frac{1}{64\pi^2}\epsilon_{a_1a_2a_3a_4a_5}[
(D_{i_1}\hat{\Phi})^{a_1}(D_{i_2}\hat{\Phi})^{a_2}(D_{i_3}\hat{\Phi})^{a_3}(D_{i_4}\hat{\Phi})^{a_4}
\\
-2F^{a_1a_2}_{i_1i_2}(D_{i_3}\hat{\Phi})^{a_3}(D_{i_4}\hat{\Phi})^{a_4}+F^{a_1a_2}_{i_1i_2}F^{a_3a_4}_{i_3i_4}]
\hat{\Phi}^{a_5}dx^{i_1}\wedge dx^{i_2}\wedge dx^{i_3}\wedge dx^{i_4}
\label{eta4-form}
\end{multline}
where $\Phi^a,\,a=1,\ldots,5$ are the five scalar fields of the $\mathfrak{u}(1)$ tensor multiplet, $\hat{\Phi}^a:=\Phi^a/\lVert\Phi\rVert$, $\lVert\Phi\rVert^2:=\Phi^a\Phi^a$, $(D_i\Phi)^a:=\partial_i \Phi^a-A_i^{ab}\Phi^b$, $A$ is a background $SO(5)_R$ connection and $F$ is its curvature. For the term (\ref{6d-WZ-term})  to be well defined, it is necessary that $\eta_4$ is  closed.  This is true in general. We check it explicitly in 
 Section \ref{sec:Closed} when only an $Spin(2)$ subgroup of the $Spin(5)_R$ connection is turned on relevant for topological twisting on a K\"ahler 4-manifold. Geometrically,  $\eta_4=\hat{\Phi}^*(e_4)$  is the pull-back of the global Euler angular form $e_4$ on the total space of $S^4$ sphere bundle  $\mathcal{E}\rightarrow M$ to the base space $M$ by the section $\hat{\Phi}:M\rightarrow \mathcal{E}$. See discussion in Section \ref{sec:4d-WZ}. 

In \cite{Ganor:1998ve,Intriligator:2000eq} it was argued that the effective action also contains a topological term that governs the coupling of the Skyrmionic string to the $B$-field:
\begin{equation}
S_\text{6d Sk}=\frac{in_W}{2}\int_{M} B\wedge \eta_4\; = \frac{in_W}{2}\int_{\Xi^{7}} dB\wedge \eta_4\;  ,
\label{6d-sky-term}
\end{equation}
where $n_W=\dim \mathfrak{g}-\dim \mathfrak{h}-1$ is the number of $W$-bosons in the five-dimensional theory obtained by dimensional reduction, the 
same as the $n_W$ that appeared in the Section \ref{sec:4d-WZ}. In the formula above and later, the $B$-field is normalized such that large gauge transformations shift it by an element of $2\pi\,H^2(M,\mathbb{Z})$. By reducing the 6d theory  to 5d, one can relate (\ref{6d-sky-term}) to a term linear in the gauge field found in \cite{Tseytlin:1999tp} by a one-loop calculation, with the coefficient in agreement with the formula above.  By reducing the 6d theory further to 4d, the term (\ref{6d-sky-term}) can be related to the Wess-Zumino term (\ref{4d-WZ}), which was shown  in Section \ref{sec:4d-hol-anomaly} to be responsible for the holomorphic anomaly.

To see the relation between these two terms in more detail, and verify the consistency of the coefficients in front of the integrals, consider $\Xi^{7} = T^{2} \times \Xi ^{5 }$.  
Writing $\Phi^0 = \int_{T^{2}} B$, one obtains a compact boson valued in a circle.  In the 4d limit its radius becomes infinitely large.  In a trivial R-symmetry background, the action $S_\text{6d Sk}$ reduces to          
\be
\frac{in_W}{2} \int_{ \Xi ^{5 }} d \Phi_{0} \wedge  \hat{\Phi}^* (\omega_{4})
\label{WZ-S1-S5}
\ee
which  \textit{a priori} appears quite different from the integral of $\hat{\Phi}^* (\omega_{5})$  in \eqref{4d-WZ}. However, both terms can be interpreted as having $n_W/2$ units of flux at the infinity of the space where the scalar fields $\Phi^I,\,I=0,\ldots,5$ are valued. In (\ref{WZ-S1-S5}) this space is $\mathbb{R}^5\times S^1$ with boundary at infinity $S^4\times S^1$. In the 4d limit the size of the 2-torus $T^2$ is taken to zero, the radius of $S^1$ becomes infinite and the space where the scalar fields are valued becomes $\mathbb{R}^6$ with boundary at infinity $S^5$. This deformation is shown in Figure~\ref{fig:target-cycles}.

\begin{figure}[tbp]
\centering 
\begin{tikzpicture}[scale=0.6]
\draw (12, 0) ellipse (1 and 2) ;
\draw (1,-2) -- (12,-2);
\draw (1,2) -- (12,2);
\draw (1,-2) arc(270:90:1 and 2);
\draw[line width = 3, red] (3,-2) arc(270:90:1 and 2);
\draw[line width = 3, red] (10,-2) arc(270:90:1 and 2);
\draw[line width = 3, blue] (5.5, 0) ellipse (1 and 1) ;
\draw[line width = 3, fill = black] (5.5, 0) ellipse (0.1 and 0.1) ;
\draw[->] (1,-3) -- (13,-3) node[midway, below] {$\Phi^{1,2,\ldots}$};
\draw[->] (-1,-2) -- (-1,2) node[midway, left] {$\Phi^{0}$};
\end{tikzpicture}
\caption{\label{fig:target-cycles} The $5$-cycles $S^5$ (in blue) and  $S^{4}\times S^1$ (in red) are homologous in $\mathbb{R}^5\times S^1$, the space where the scalar fields $\Phi^I,\,I=0\ldots 5$ are valued. This is equivalent to the statement that the flux through the boundary at infinity is preserved when the radius of $S^1$ is taken to be infinitely large.}
\end{figure}


The two six-dimensional terms above can be combined into a compact expression
\begin{equation}
S_\text{6d Sk}+S_\text{6d WZ}=\frac{in_W}{2}\int_{\Xi^7}H_3\wedge d\Omega_3
\end{equation}
where $H_3=dB+\frac{2\pi}{3 n_W}(c(\mathfrak{g})-c(\mathfrak{h}))\,\Omega_3$ is the $\mathfrak{u}(1)$ 3-form flux. 
For the  case of interest, $\mathfrak{g}=\mathfrak{su}(2)$, $\mathfrak{h}=0$ and  hence $c(\mathfrak{g})-c(\mathfrak{h})=6$ and $n_W=2$. 

\subsection{Two-dimensional Effective Action}
\label{sec:2d-fields}

The effective two-dimensional  theory on $T^2$  is obtained by compactifying the   six-dimensional theory on a manifold of the form $M=X\times T^2$ for small $X$.   The field content in two dimensions is  obtained by standard  twisted Kaluza-Klein reduction of a single (2,0) $\mathfrak{u}(1)$ tensor multiplet on $X$,  by counting harmonic sections of certain bundles. Compactification on  a general four-manifold is described, for example,  in \cite{Dedushenko:2017tdw} in Table~1. The choice of the topological twist on the four-manifold $X$ that we are using leads to  supersymmetry in the \textit{right-moving}, or, equivalently, \textit{anti-holomorphic}, sector of the effective 2d theory.  This is correlated with the convention that the contribution from instantons, which preserve supersymmetry in the 4d theory, has  \textit{holomorphic} dependence on the modulus $\tau$ of the $T^2$.

The charge lattice in \cite{Dedushenko:2017tdw}  is the standard charge lattice $\mathbb{Z}$ of a $U(1)$ gauge theory corresponding to the tensor multiplet on the worldvolume of a single M5-brane.  In our application, the tensor multiplet really describes the relative motion of a pair of M5-branes.   As a result, the
 normalization of the charge lattice is modified, as we discuss below and in Section \ref{sec:higher-rank}. 

We review how the various sigma model fields arise from the KK reduction. For simplicity, consider  a simply-connected four-manifold $X$. 
The 6d  scalar fields that transform in the  vector representation of ${Spin}(5)_R$ in the untwisted theory give rise in the twisted theory
 to $b_2^+$ real non-chiral non-compact 2d scalars $\sigma^i$ plus a single complex non-chiral non-compact scalar $\phi_0$. The 6d fermions transforming in the
 $(\mathbf{4},\mathbf{4})$ representation of ${Spin}(5)_R\times {Spin}(6)$ give rise to $b_2^+$ right-moving Weyl fermions $\psi_+^i$ and a single right-moving Weyl fermion $\chi_+$. The  topological twist preserves $\mathcal{N}=(0,2)$ supersymmetry in two dimensions for a generic $X$; this is enhanced to $\mathcal{N}=(0,4)$ for a K\"ahler $X$.

The 2-form gauge field $B$ with self-dual curvature 3-form gives rise to $b_2=b_2^++b_2^-$ compact chiral real bosons $X_{L,R}^i$ valued in $H^2(X,\mathbb{R})/H^2(X,2\pi\mathbb{Z})$. The quotient arises from the large gauge transformations that change the holonomy of the 2-form gauge field along 2-cycles $C_i\subset X$ by an integer: $\int_{C_i}B\rightarrow \int_{C_i}B+2\pi n_i\;,n_i\in \mathbb{Z}$. The bosons valued in the subspace  of self-dual harmonic forms, $H^{2+}(X)\subset H^2(X,\mathbb{R})$,   are right-moving and the bosons valued in $H^{2-}(X)$ are left-moving. In other words, the 2-form field $B$ gives rise to a Narain-like lattice CFT with the lattice  $\Gamma=H_2(X,\mathbb{Z})$ being the second homology lattice equipped with the standard geometric intersection form. 
For a closed four-manifold, $H^2(X,\mathbb{Z})\cong H_2(X,\mathbb{Z})$ by Poincar\'e duality and the lattice is self-dual.

When the tensor multiplet describes the tensor branch of 6d type $A_1$ theory, the lattice should be rescaled by $\sqrt{2}$ compared to the case of a single 5-brane considered above because $\Gamma_{SU(2)}=\sqrt{2}\Gamma_{U(1)}$. One way to see this is that the root lattice of $SU(2)$ is $\Lambda=\sqrt{2}\mathbb{Z}$, instead of just $\mathbb{Z}$ when embedded in $\mathbb{R}$ with the standard metric, while its weight lattice is the dual $\Lambda^*=\frac{1}{\sqrt{2}}\mathbb{Z}$. For a general 6d theory on a tensor branch, with string charges living in the lattice\footnote{Because of the self-duality of the 2-form gauge field, the magnetic string charges are identified with the electric charges and the intersection pairing is the generalization of the Dirac pairing.} $\Lambda^*$, the 2-form fields give rise to 2d lattice CFT for the lattice $\Gamma=\Lambda\otimes H_2(X,\mathbb{Z})$. Note that when $\Lambda$ is not self-dual, $\Gamma$ is not self-dual even for a closed four-manifold. This implies that the effective 2d theory is not \textit{absolute} but \textit{relative}, meaning that instead of a single partition function it has a vector of partition functions labelled by the elements of the coset   \cite{Tachikawa:2013hya,DelZotto:2015isa,Gukov:2018iiq,Eckhard:2019jgg}
\begin{equation}
    \Gamma/\Gamma^*=\Lambda/\Lambda^*\otimes H^2(X,\mathbb{Z}).
    \label{discrete-fluxes}
\end{equation}
This is in agreement with the fact that the 6d theory itself is also in general relative with its relativeness measured by the \textit{defect group} $\Lambda/\Lambda^*$. 

 
Consider now in more detail the case of an $A_1$ theory compactified on $\mathbb{CP}^2$. We have $b_2^-=0$ and $b_2^+=1$. The second homology is generated by the class of $\mathbb{CP}^1\subset \mathbb{CP}^2$, which has self-intersection number $+1$. The self-dual lattice $H_2(\mathbb{CP}^2,\mathbb{Z})$ can then be identified with the standard lattice $\mathbb{Z}$ and therefore $\Gamma=\sqrt{2}\mathbb{Z}$. The 6d 2-form gauge field gives rise to a single right-moving real compact boson $X_R$ valued in $\mathbb{R}/2\pi \sqrt{2}\mathbb{Z}$, that is, on  a circle of radius $\sqrt{2}$. 

The compact boson valued in a circle of radius $\sqrt{2}$ can be equivalently thought of as  a $\widehat{\mathfrak{u}(1)}_2$ chiral WZW theory, which in turn can be conformally embedded into  $\widehat{\mathfrak{su}(2)}_1$.  This is another way to understand the rescaling of the lattice by $\sqrt{2}$.
Both affine Lie algebras have two integrable modules. Equivalently, both WZW models have two conformal blocks on a torus with  characters given by the corresponding lattice theta-functions:
\bea\label{characters}
    \bar\chi^{\widehat{\mathfrak{su}(2)}_1}_0({\t}) &=\bar\chi^{\widehat{\mathfrak{u}(1)}_2}_0({\t})& =
    \frac{1}{\overline{\eta({\t})}} \sum_{n\in\mathbb{Z}}\bar{q}^{n^2}\,,
\nonumber\\
    \bar\chi^{\widehat{\mathfrak{su}(2)}_1}_1({\t}) &=\bar\chi^{\widehat{\mathfrak{u}(1)}_2}_1({\t})& =
    \frac{1}{\overline{\eta({\t})}} \sum_{n\in\mathbb{Z}}\bar{q}^{(n+1/2)^2}\,,
    \label{SU21-chars}
\eea
where one can already recognize the contributions of abelian anti-instantons which  appeared in the holomorphic anomaly equation (\ref{hol-anomaly-vector-1}). As explained above, the choice of the module corresponds to the choice of the discrete magnetic flux on $\mathbb{CP}^1\subset \mathbb{CP}^2$. Note that the lattice point $\frac{m}{\sqrt{2}}$ with $m\in \mathbb{Z}$ corresponds to a vertex operator of the form $e^{\frac{m}{\sqrt{2}}iX_R}$. From the six-dimensional  point of view, this is a local two-dimensional operator obtained by wrapping a codimension four defect in  the 6d theory on $\mathbb{CP}^1\subset \mathbb{CP}^2$. 

From the general analysis above, we also have three non-compact non-chiral real bosons and two right-moving Weyl fermions. Note that if the compact boson were non-chiral the 2d fields would form the fields of the standard (0,4) sigma model with the target space $\mathcal{X}=(S^1\times \mathbb{R}^3)/\mathbb{Z}_2=(\mathbb{C}^*\times \mathbb{C})/\mathbb{Z}_2$  where $\mathbb{Z}_2$ is the $SU(2)$ Weyl symmetry that flips all four directions. There are no left-moving fermions.

The additional data of the sigma-model is the Kalb-Ramond 2-form field\footnote{To be precise, the 2-form description is only local; globally $b$ should be understood as a gerbe connection.} $b$ on the target space (not to be confused with the self-dual 2-form field $B$ in 6d). The $b$-field determines the  2d Wess-Zumino term depending on the bosonic fields.   This term can be obtained by the reduction of the 6d Skyrmionic string coupling term (\ref{6d-sky-term}) as follows.


 The topological twist on a K\"ahler $X$ is realized by turning on a non-trivial background for the subgroup of R-symmetry $U(1)_R\equiv Spin(2)_R\subset Spin(5)_R$. The background corresponds to identification of $U(1)_R$ with the diagonal of $U(2)$ holonomy group of $X$. One can assume that the $Spin(2)_R$ rotates the directions 4-5 so that $F^{a_1a_2}=0$ unless $a_1,a_2$ are permutation of $4,5$ and $[F^{45}/(2\pi)]=-[F^{54}/(2\pi)]=c_1(KX)=-c_1(X)$. The non-trivial contribution to the action of the effective 2d theory is given only by the second term in (\ref{6d-sky-term}). Namely, let $M=\Sigma^2\times \mathbb{CP}^2$, where $\Sigma^2$ is the 2d spacetime. The KK reduction of 6d bosonic fields to massless 2d fields is explicitly realized as follows. For the $B$-field, we have
\begin{equation}
    B=X_R\,\omega/\sqrt{2}
    \label{CP2-B-KK-reduction}
\end{equation}
where $\omega$ is the K\"ahler 2-form (which is harmonic and self-dual) normalized such that $\int_{\mathbb{CP}^1}\omega=1$, and $X_R$ is the right-moving compact boson of the effective 2d theory with the identification $X_R\sim X_R+2\pi\sqrt{2}$. For the scalar fields,  we have:
\begin{equation}
\begin{array}{rll}
    \Phi^{a}& =0,& a=4,5, \\
    \Phi^a & = \phi^a,& a=1,2,3,
    \end{array}
\end{equation}
where the first equation follows from the fact that the canonical bundle of $\mathbb{CP}^2$ has no harmonic sections, and $\phi^a$ are the 2d non-chiral scalar fields valued in $\mathbb{R}^3$. 

Performing the partial integration in (\ref{6d-sky-term}) over the $\mathbb{CP}^2$ yields the bosonic WZ term in 2d:
\begin{eqnarray}S_\text{2d\;WZ} &= & -i\left(\int_{\mathbb{CP}^2}\frac{F^{45}}{2\pi}\wedge \omega\right)\int_{\Sigma^2}\frac{X_R}{\sqrt{2}}\,\frac{1}{8\pi}\epsilon_{abc}\partial_{i}\hat{\phi}^a \partial_{j}\hat{\phi}^b\hat{\phi}^c\,dx^i\wedge dx^j \nonumber \\
   &=& 3i\int_{\Sigma^2} \frac{X_R}{\sqrt{2}}\,\hat{\phi}^*(\omega_{2})
    \label{2d-WZ-term}
\end{eqnarray}
where $\omega_{2}$ is the volume form on $S^2$ normalized such that $\int_{S^2}\omega_{2}=1$  with  $\hat{\phi}^a:=\phi^a/\lVert\phi\rVert$  understood as a map $\Sigma^2\rightarrow S^2$. 
In the second equality in (\ref{2d-WZ-term}) we used the fact that the canonical bundle over $\mathbb{CP}^2$ is $O(-3)\rightarrow \mathbb{CP}^2$, so that $[F^{45}/(2\pi)]=c_1(K\mathbb{CP}^2)=-c_1(\mathbb{CP}^2)=-3[\omega]$. 

Let us denote the coordinate on $S^1$ of the target space\footnote{To avoid confusion, we use different symbols for the coordinates on the target space and the fields on $\Sigma^2$ \textit{valued} in the target space.} of the effective theory by $Y^0$ and the coordinates on $\mathbb{R}^3$ as $Y^a\; (a=1,2,3)$, with  norm $\lVert Y\rVert$.  From (\ref{2d-WZ-term}) we deduce that the Kalb-Ramond field $b$ on target space is  given by (the choice of normalization is
\begin{equation}
    b=4\pi\cdot \frac{3}{\sqrt{2}}Y^0\omega_{2}=\frac{3}{2\sqrt{2}}Y^0\,\epsilon_{abc}\hat{Y}^ad\hat{Y}^b\wedge d\hat{Y}^c
\end{equation}
with corresponding 3-form flux
\begin{equation}
 h=db=4\pi\cdot \frac{3}{\sqrt{2}}dY^0\wedge \omega_{2}=
 \frac{3}{2\sqrt{2}}dY^0\wedge\epsilon_{abc}\hat{Y}^a  d\hat{Y}^b\wedge d\hat{Y}^c
 \label{S2S1-flux}
\end{equation}
where $\hat{Y}^a:=Y^a/ \lVert Y\rVert$. The choice of normalization is such that $\int h\in 8\pi^2\mathbb{Z}$ and will be consistent with the normalization of the action in Section \ref{sec:NLSM}. The compactification of the 6d Wess-Zumino term (\ref{6d-WZ-term}) to 2d is not relevant for our computation of the holomorphic anomaly because it  produces the term
\begin{equation}
   9\cdot 2\pi \int_{\Xi^3} \Omega_1 d\Omega_1,\qquad d\Omega_1=\hat{\phi}^*(\omega_{2})
   \label{2d-HWZ}
\end{equation}
where $\partial \Xi^3=\Sigma^2$. This term is the 2d analog of the 6d Hopf-Wess-Zumino term (\ref{6d-WZ-term}) introduced in \cite{Intriligator:2000eq}. It is well defined since the integral of the form $\Omega_1d\Omega_1$ over a closed 3-manifold is an integer, the Hopf invariant of the map from this 3-manifold to $S^2$. The term (\ref{2d-HWZ}) does not contain the compact boson $X_R$.   The fermionic partner of this term therefore does  not affect the saturation of  zero-modes.

To compute the holomorphic anomaly we need not the bosonic WZ term (\ref{2d-WZ-term}) itself, but rather its fermionic partner. The effective two-dimensional  theory  is a fairly standard heterotic sigma model with target $\mathcal{X}=(S^1\times \mathbb{R}^3)/\mathbb{Z}_2$, except that the bosonic field valued in $S^1$ is only right-moving. This  does not affect supersymmetrization  of the action because the supersymmetry generators  act only on the right-movers.  One can thus use  known results about heterotic sigma models reviewed below to deduce the relevant fermionic terms.

\subsection{Review of (0,1) Nonlinear Sigma Model \label{sec:NLSM}}

The goal of this section is to review basic facts about (0,1) Nonlinear Sigma models and to fix various normalizations that will be relevant for our calculation of the holomorphic anomaly. We can restrict ourselves to the class of theories containing only scalar multiplets $(\phi^i,\psi^i)$ composed of bosonic scalars $\phi^i$ and right-moving Majorana-Weyl spinors $\psi^i$. The scalars play the role of local coordinates in the target space while spinors $\psi^i$ are valued in the tangent bundle. In general the theory can also have left-moving Majorana-Weyl spinors valued in a real vector bundle over the target space; however for our purposes this generalization is not necessary. 

Let $g_{ij}$ and $b=\frac{1}{2}b_{ij}dx^i\wedge dx^j$ be the metric and Kalb-Ramond 2-form on the target space. The theory is anomaly-free and, in particular, invariant under symmetries of the target, provided that $w_1(T\mathcal{X})=w_2(T\mathcal{X})=0$ and $p_1(T\mathcal{X})/2=0$; here  $w_i$ denote Stiefel-Whitney classes and $p_1$ denotes the first integral Pontryagin class. Denote $\partial:=\partial/\partial z,\;\bar\partial:=\partial/\partial \bar{z}$. The action of the theory in Euclidean spacetime with a local complex coordinate $z$ then reads\footnote{Our normalization corresponds to the choice $\alpha'=2$ in the string theory literature \cite{Polchinski:1998rq}.} \cite{Hull:1985jv,Brooks:1986uh}:
\begin{eqnarray}
    S_\text{2d} & = \cfrac{1}{4\pi} \int d^2z\left((g_{ij}(\phi)+b_{ij}(\phi))\partial \phi^i\bar \partial\phi^j +g_{ij}\psi^i\partial\psi^j-(\Gamma_{ijk}+\frac{1}{2}h_{ijk})\psi^k\psi^i\partial\phi^j\right)
    \label{NLSM-action}
\end{eqnarray}
where $d^2z:=idzd\bar{z}$, $\Gamma_{ijk}$ are Christoffel symbols of the Levi-Cevita connection, and
\begin{equation}
    h=db=\frac{1}{3!}h_{ijk}dx^i\wedge dx^j\wedge dx^k,\qquad h_{ijk}=\partial_ib_{jk}+\partial_jb_{ki}+\partial_kb_{ij}
\end{equation}
is the 3-form flux of $b$. The term containing the scalar fields and the Kalb-Ramond field in the target is the Wess-Zumino term, which can be recast as 
\begin{equation}
    S_\text{2d WZ}=\frac{i}{4\pi}\int_{\Sigma^2} \phi^*(b) =\frac{i}{4\pi}\int_{\Xi^3} \phi^*(h)
\end{equation}
where $\partial \Xi^3=\Sigma^2$. We normalize the supercharge so that it acts on the fields as follows:
\begin{equation}
    \begin{array}{rcl}
        [Q,\phi^i] & = & \psi^i,  \\
         \{Q,\psi^i\}& = & -\bar\partial \phi^i .
    \end{array}
    \label{Q-2d}
\end{equation}
The right-moving energy momentum-tensor and the supercurrent are given by (cf. \cite{delaOssa:2018azc}) 
\begin{equation}
    \begin{array}{rcl}
        \bar{T} & = & 
        -\frac{1}{2}\,g_{ij}\bar\partial \phi^i\bar\partial \phi^j
        -\frac{1}{2}\,g_{ij}\psi^i\bar\partial \psi^j
        +\frac{1}{2}\,\partial_kg_{ij}\psi^k\psi^j\bar\partial\phi^i
        +\frac{1}{4}\,h_{ijk}\psi^i\psi^j\bar\partial\phi^k
        ,  \\
         \bar G& = & i\left(g_{ij}\psi^i\bar\partial\phi^j-\frac{1}{3!}\,h_{ijk}\psi^i\psi^j\psi^k\right). 
    \end{array}
\end{equation}
The normalization of the energy-momentum tensor $\bar{T}$ is fixed by the definition $\bar{T}=2\pi \delta S_\text{2d}/\delta h_{\bar z \bar z}$, where $h_{\bar z \bar z}$ is the corresponding component of the metric on the 2d space-time. The normalization of the supercurrent $\bar{G}$ is then fixed by the relation 
\begin{equation}
    \{Q,\bar{G} \} = 2i\,\bar{T}
\end{equation}
with the supercharge defined above. These formulae compactly summarize the supersymmetrization  in two dimensions, which  is much simpler than the supersymmetrization in  four-dimensions described in Appendix \ref{app:4dWZ-SUSY}. In particular, there is no need for auxiliary fields.


The normalization of the path integral for the theory on a torus can now be fixed by requiring that it coincides with the corresponding trace over the Hilbert space on the circle:
\begin{equation}\label{Ztrace}
     Z(\tau)=\text{Tr} (-1)^F q^{L_0}\bar{q}^{\bar{L}_0}
\end{equation}
where we consider periodic-periodic boundary conditions on the fermions, that is, odd spin structure. Consider in particular the theory of $D$ free (0,1) scalar multiplets described by the metric $g_{ij}=\delta_{ij}$ and vanishing $b_{ij}$. The theory then factorizes into the theory of $D$ free bosons and $D$ free Majorana-Weyl fermions. With the choice of normalization of the action above, the bosons and fermions satisfy the following operator product expansions:
\begin{equation}
    \phi^i(z)\phi^j(0)\sim -\delta^{ij}\log |z|^2,
\end{equation}
\begin{equation}
    \psi^i(z)\psi^j(0)\sim \frac{\delta^{ij}}{\bar{z}}.
\end{equation}
The partition function of the bosons on the torus reads
\begin{equation}
    Z_\text{bos}(\tau)=\frac{V_D}{(8\pi^2\tau_2)^{D/2}}\,|\eta(\tau)|^{-2D}
\end{equation}
where $V_D$ is the regularized volume of the target space. The prefactor originates from the trace over the momentum space \cite{Polchinski:1998rq} and is given by
\begin{equation}
   V_D \int \frac{d^D k}{(2\pi)^D}\,e^{-2\pi \tau_2 k^2 }
   = \frac{V_D}{(8\pi^2\tau_2)^{D/2}} \, .
\end{equation}
The partition function of free fermions is zero due to the presence of zero-modes. To get a nonzero answer one can consider instead a one-point function of the product of all spinor fields:
\begin{equation}
    \langle :\psi^1\psi^2\ldots \psi^D :\rangle_\text{fer} =
    \text{Tr} (-1)^F\psi^1_0\psi^2_0\ldots \psi^D_0\,q^{L_0}\bar{q}^{\bar{L}_0}
\end{equation}
where $\psi^i_0$ are zeroth components of the fermionic fields $\psi^i(z)=\sum_n \psi_n^i\,z^{-n-1/2}$ in the Ramond sector. They satisfy the following anti-commutation relation:
\begin{equation}
    \{\psi^i_0,\psi^j_0\}=\delta^{ij}.
\end{equation}
The ground states in the Hilbert space on the circle therefore form the standard spinor representation of the Clifford algebra with identification $\psi^i=2^{-1/2}\gamma^i$, where $\gamma^i$ are the standard Eulidean gamma-matrices satisfying $\{\gamma^i,\gamma^j\}=2\delta^{ij}$. When $D$ is even the fermion parity is non-anomalous and on the ground states can be represented by
\begin{equation}
    (-1)^F=\gamma_5=(-i)^{D/2} \gamma^1\gamma^2\ldots \gamma^D.
\end{equation}
Therefore the trace over the ground states reads
\begin{equation}
    \text{Tr}_\text{ground}(-1)^F\psi^1_0\psi^2_0\ldots \psi^D_0 = i^{D/2}2^{-D/2}\,\text{Tr}_\text{ground} \gamma_5^2 =
    i^{D/2}.
\end{equation}
The full Hilbert space is obtained by action of the creation operators $\psi_{-n}^i,\,n>0$ on the ground states. Therefore, the one-point function on the torus reads
\begin{equation}
    \langle :\psi^1\psi^2\ldots \psi^D :\rangle_\text{fer} =
    i^{D/2}\overline{\eta(\tau)}^D.
\end{equation}
Even though this expression is obatined for even $D$,  it can be used to define the normalization of the torus one-point function for arbitrary $D$. Note that for odd $D$ the sign of $i^{D/2}$ is ambiguous which corresponds to the mod 2 fermion parity anomaly. When an even number of fermions is separated into two groups each containing an odd number of fermions, it is necessary to choose the signs consistently. To be concrete, we choose the convention $i^{D/2}=e^{\pi i D/4}$.

Consider now a more general (0,1) sigma-model, but in a limit when the target space $\mathcal{X}$ has large radius of curvature. There is a standard one-to-one correspondence between local observables of the form ${\mathcal O}=:f_{i_1\ldots i_k}(\phi)\psi^{i_1}\ldots \psi^{i_k}:$ and $k$-forms on the target space $f=f_{i_1\ldots i_k}(\phi)d\phi^{i_1}\ldots d\phi^{i_k}\in \Omega^k(\mathcal{X})$. Using this correpondence and the above results on the free fields, we obtain the following formula for the one-point function in the large radius limit:
\begin{equation}\label{intanorm}
    \langle :f_{i_1\ldots i_k}(\phi)\psi^{i_1}\ldots \psi^{i_k}: \rangle = \frac{i^{D/2}}{(8\pi^2\tau_2)^{D/2}\,\eta(\tau)^D}\,\int_{\mathcal{X}} f.
\end{equation}
This fixes the normalization of the measure for the zero-modes in the path-integral which will be used in the next section. Finally, note that the supercharge $Q$ in (\ref{Q-2d}), when restricted to the zero-modes, acts as the exterior derivative on $\Omega^*(\mathcal{X})$ under this correspondence.

\subsection{Holomorphic Anomaly from the Sigma Model}
\label{sec:2d-anomaly}

The elliptic genus of a compact target 
  $\mathcal{X}$ is given by the  partition function of a $(0,1)$ supersymmetric sigma model 
 with periodic boundary conditions for  fermions in both directions on $T^2$.  
 When $\XX$ is not compact, 
 the partition function  is in general not holomorphic and has a holomorphic anomaly.
 If $\XX$ has a ``boundary''\footnote{We use the term ``boundary'' informally. For example, if $\XX$ is asymptotic to $\Bbb R^N$ at infinity for some $N$,
   then by $\Y$ we mean a large sphere $S^{N-1}$ near infinity in $\XX$.}  $\Y$, then the holomorphic anomaly  is
governed by the one-point function of the supercharge in a sigma model with target $\Y$ \cite{Gaiotto:2019gef}. 
More precisely, let $Z_{\mathcal{X}}$ be the partition function of a heterotic sigma model with target $\mathcal X$ on a torus with complex structure $\tau$. Then\footnote{If the sigma model with target $\XX$ has $(0,k)$
 supersymmetry with $k>1$, then in the following formula, for $Q$, one can use any supersymmetry for which the following derivation applies.}
\begin{equation}
\frac{\partial Z_{\mathcal{X}}}{\partial \bar{\tau}} = \langle -2\pi i \bar{T}(z_0) \rangle_\mathcal{X}=  
\langle -\pi \{Q,\bar{G}(z_0)\} \rangle_\mathcal{X}
 = \frac{-e^{\pi i/4}}{\sqrt{8\,\tau_2}\eta(\tau)} \langle \bar{G}(z_{0}) \rangle_{\mathcal{Y}}
\label{hol-anomaly-boundary-NLSM}
\end{equation}
where  $\langle \mathcal{O}(z_{0} )\rangle$ is a path integral with an insertion of operator $\mathcal O(z_{0})$ at an arbitrary point $z_{0}$. 

 This  formula can be understood as follows. The first equality follows from the trace \eqref{Ztrace} or from the definition of $\bar{T}$ and the fact that the change of a complex structure can be related to the change of metric. The second equality in (\ref{hol-anomaly-boundary-NLSM}) uses the relation $2i\,\bar{T}=\{Q,\bar{G}\}$ between the energy momentum tensor 
 $\bar{T}$ and supercurrent $\bar{G}$ via the supersymmetry transformation $Q$.
 The last equality in  (\ref{hol-anomaly-boundary-NLSM}) is  more  subtle and can be argued as follows. 
 
The partition function $Z_\mathcal{X}$ is obtained by integrating over the space of all maps $\phi:T^2\rightarrow \mathcal{X}$ along with
fermion fields  $\psi\in \Gamma(S_+(T^2)\otimes \phi^*T\mathcal{X})$.   The path integral has zero-modes consisting of a map $\phi:T^2\to {\mathcal X}$ together
with a constant $\psi$ field.   We write $(\phi_0,\psi_0)$ for such a constant pair.   Supersymmetry localizes the path integral
on the space of constant pairs.   This means that the path integral can be evaluated by integrating out other modes to construct a measure $f(\phi_0,\psi_0)$, which
must then be integrated over $\phi_0,\psi_0$.   In an ordinary sigma model, to compute $f$, it suffices to integrate out the other modes in a 1-loop approximation because  $Z_\XX$ does not depend on the metric of $\XX$. Hence,  one can scale up the metric of $\XX$ so that
the 1-loop computation over nonzero modes is exact.   In the present situation, we have to modify this procedure slightly because there is   a right-moving
chiral boson with no tunable parameter such as a variable metric.
 However,  the effects of this mode can be treated exactly,  treating other nonzero modes
in the one-loop approximation.

Now we come to the main point of the argument.  
We have already explained in section \ref{sec:NLSM} that an operator of the form  ${\mathcal O}_f= :f_{i_1\ldots i_k}(\phi)\psi^{i_1}\ldots \psi^{i_k}:$ corresponds
to a differential form $f=f_{i_1\ldots i_k}(\phi)d\phi^{i_1}\ldots d\phi^{i_k}\in \Omega^k(\mathcal{X})$, and that the path integral $\langle {\mathcal O}_f\rangle$
is the integral $\int_X f$ of the differential form $f$, times some additional factors explained in eqn. (\ref{intanorm}).   Moreover, acting on operators
that are related to differential forms in this way, $Q$ corresonds to the exterior derivative $d$.  
   To claim that a $Q$-exact term does not contribute to the path
integral amounts to claiming that $\int_X f$ is invariant under $f\to f+d g$.   But in general  there is the possibility of a surface term, because by
Stokes's theorem $\int_\XX d g(\phi_0,\psi_0)=\int_\Y g(\phi_0,\psi_0)$, where $\Y= \partial \XX$.
The anomaly captures the failure of the naive argument of  vanishing of  $Q$-exact terms, and hence reduces to an integral over $\Y$.    

Since we are interested in the expectation value of $\{Q,\bar{G}\}$, we have $f=d g$ where $g$ is a function of $\phi_0,\psi_0$ that is computed
by integrating out  all modes of a chiral boson and  nonzero modes for all other fields  in the path integral for  $\langle \bar{G}\rangle$.   We are only interested in evaluating
$g$ on $\Y$.  Most of the modes that appear in the evaluation of $g(\phi_0,\psi_0)$ are the modes that would appear in evaluating $\langle \bar{G}\rangle$ in a sigma-model
with target $\Y$, with one important exception.   In the sigma-model with target $\XX$, there is a bosonic field $\phi_\perp$ that describes the motion normal
to $\Y$, and a corresponding fermion partner $\psi_\perp$.    These modes are absent in the sigma-model with target $\Y$, so we have to include them separately.   The partition
function of the  left-moving
modes of $\phi_\perp$ is the factor $1/\eta(\tau)$ in eqn. (\ref{hol-anomaly-boundary-NLSM}).   The right-moving modes of $\phi_\perp$ cancel the nonzero
modes of $\psi_\perp$.   The zero-modes of $\phi_\perp$ and $\psi_\perp$ are eliminated when we use Stoke's theorem and replace $\int_\XX d g$ with
$\int_\Y g$, except for a normalization factor 
\be
\frac{e^{\pi i/4}}{\sqrt{8\pi^2\tau_2}}
\ee
explained in Section \ref{sec:NLSM}. Altogether, one obtains precisely the right hand side of (\ref{hol-anomaly-boundary-NLSM}). 


In our case, $\mathcal{X}=(\mathbb{R}^3\times S^1)/\mathbb{Z}_2$ and
 $\mathcal{Y}=(S_R^2\times S^1)/\mathbb{Z}_2$, where $S^2_R$ is a sphere of very large radius $R$.\footnote{Near the origin of $\mathcal{X}=(\mathbb{R}^3\times S^1)/\mathbb{Z}_2$, a good description is likely to involve additional degrees of freedom.  However, since this region is compact, it does not contribute to the anomaly} 
In the limit $R\rightarrow \infty$, the fermions and bosons  appearing in a sigma model with target $\Y$ can be treated as being free. We thus obtain
\begin{eqnarray}
\langle G_+\rangle_{\mathcal{Y}} & = &
\left\langle -i\frac{1}{3!}h_{ijk}\psi^i\psi^j\psi^k
+ig_{is}\partial_+\phi^i\psi^s \frac{1}{4\pi}\int d^2z\left(\left(\Gamma_{ijk}+\frac{h_{ijk}}{2}\right)\psi^k\psi^j\partial_-\phi^j\right)
\right\rangle_{\mathcal{Y}}
\nonumber
\\
&= &
-\frac{i}{3!}\langle h_{ijk}\psi^i\psi^j\psi^k
\rangle_{\mathcal{Y}}
\label{boundary-one-point}
\end{eqnarray}
where we used the fact that 
\begin{equation}
\int d^2x\langle \partial_+\phi^i(x) \partial_-\phi^j(x')\rangle = 0.
\end{equation}
in free field theory.
When we interpret
the fermion zero-modes as 1-forms on $\Y$, the coupling $h_{ijk}\psi^i\psi^j\psi^k$ just becomes a 3-form $h=\frac{1}{3!}h_{ijk}d \phi^i d\phi^j d \phi^k$ that has to be integrated
over $\Y$. Therefore, the result will only depend on the cohomology class of the Wess-Zumino coupling.
  Using the expression (\ref{S2S1-flux}) for $h$, and taking into account the periodicity $Y^0\sim Y^0+ 2\pi\sqrt{2}$, we obtain
\begin{equation}
\int_\mathcal{Y} h=\frac{1}{2}\cdot 4\pi\cdot  3\int_{S^2}\omega_2\int_{S^1}\frac{dY^0}{\sqrt{2}}={12\pi^2}.
\end{equation}
Here we only need $\int_{S^2}\omega_2=1$ and not the explicit expression for the 2-form $\omega_2$.

The nonzero modes of the fermion contribute $\overline{\eta({\tau})^3}$. It is also necessary to include the normalization phase $e^{3\pi i/4}$ for the fermionic zero-modes explained in Section \ref{sec:NLSM}. The nonzero modes of the bosons valued in $S^2$ contribute $1/(8\pi^2 \tau_2|\eta(\tau)|^4)$ with normalization also explained in Section \ref{sec:NLSM}. The nonzero modes of the chiral boson valued in $S^1$ contribute $\bar\chi^{\widehat{\mathfrak{u}(1)}_2}_v({\tau})/(2\pi \sqrt{2})$, which differs from its partition function (\ref{SU21-chars}) by factoring out the integral over the zero-mode $\int dY^0=2\pi \sqrt{2}$.  Here
$v\in \mathbb{Z}_2$ corresponds to the discrete flux of the $SO(3)$ gauge field on $\mathbb{CP}^1\subset \mathbb{CP}^2$. Combining all the contributions we obtain
\begin{eqnarray}
\langle \bar{G}\rangle_{\mathcal{Y}} & = &-i\left(\int_\mathcal{Y} h \right) \cdot e^{3\pi i/4}\,\overline{\eta(\tau)^3} 
\cdot 
\frac{1}{8\pi^2 \tau_2 \eta(\tau)^2\overline{\eta(\tau)^2}}\cdot \frac{\bar\chi^{\widehat{\mathfrak{u}(1)}_2}_v({\tau})}{2\pi \sqrt{2}}
\nonumber
\\
&=&
\frac{-3i\cdot  e^{3\pi i/4}}{4\pi\sqrt{2}\tau_2\eta(\tau)^2}\cdot \sum_{n\in\mathbb{Z}}\bar{q}^{(n+v/2)^2}
\label{one-point-result}.
\end{eqnarray}
The  anti-holomorphic eta-functions cancel between bosons and fermions due to right-moving supersymmetry. The anti-holomorphic theta function is the contribution of the ``winding modes'' of the compact chiral boson. Note that, as in 4d calculation, the overall sign in (\ref{one-point-result}) is somewhat ambiguous and depends on the choice of orientation in the space of zero-modes. We do not address the question of fixing it in this paper. Nevertheless, combining (\ref{one-point-result}) with (\ref{hol-anomaly-boundary-NLSM}) we obtain
\begin{equation}
\frac{\partial Z_{v}}{\partial \bar{\tau}} = 
\frac{3}{16\pi i \tau_2^{3/2}\eta(\tau)^3}\sum_{n\in\mathbb{Z}}\bar{q}^{(n+v/2)^2},
\end{equation}
which is in agreement with the expected result (\ref{hol-anomaly-vector})-(\ref{hol-anomaly-vector-1}).


\section{Generalizations}
\label{sec:generalizations}

We now turn to possible generalizations.  In   Section \ref{sec:cpx-surfaces} we consider a general K\"ahler manifold with $b_2^+=1$, $b_1=0$ and compute the holomorphic anomaly of the Vafa-Witten partition function.  In  Section \ref{sec:higher-rank} we consider  $SU(N)$ gauge theory realized on   multiple M5-branes.  The holomorphic anomaly can again be traced to the Wess-Zumino term in the  effective action on the Coulomb branch where $SU(N)$ is spontaneously broken  to $SU(N_1)\times SU(N_2)\times U(1)$ with $N=N_1+N_2$. 
Finally, in Section \ref{sec:other-twists} we briefly discuss other twists.

\subsection{Vafa-Witten Theory on K\"ahler Manifolds with $b_2^+=1$, $b_1=0$}
\label{sec:cpx-surfaces}

Consider $SO(3)$ gauge theory on a general K\"ahler manifold  $X$  with $b_2^+=1$ and $b_1=0$ obtained by wrapping two M5-branes on $X$ in M-theory on $KX \times T^{2} \times \mathbb{R}^{3}$, where, as before, $KX$ is the total space of the canonical bundle over $X$. Unlike in the case $X = \mathbb{CP}^2$, we will in general have a nonzero $b_2^-$ with interesting modifications.

Consider first the two-dimensional point of view. The field content of the effective  (0,4) sigma model can be obtained  by Kaluza-Klein reduction of the 6d (2,0) tensor multiplet as in  Section \ref{sec:2d-fields} following \cite{Dedushenko:2017tdw}. The only additional fields are $b_2^-$ left-moving compact bosons because the relation (\ref{CP2-B-KK-reduction}) is replaced by the following decomposition of the six-dimensional  2-form field:
\begin{equation}
 B=\frac{1}{\sqrt{2}}\sum_{i=1}^{b_2^-}X_L^ih^-_i
+ \frac{1}{\sqrt{2}}X_R \omega
\end{equation}
where $h_i^-$ are the generators of $H^{2-}(X,\mathbb{R})$ and $\omega$ is the K\"ahler 2-form, normalized such that
\begin{equation}
  \int_{X} \omega\wedge \omega=1,\qquad \int_{X}h^-_i \wedge h^-_j=-\delta_{ij},\qquad \int_{X}h^-_i \wedge \omega=0 \, .
\end{equation}
The  fields $X_L^i$ and $X_R$ are components of  left-moving and right-moving compact bosons;  $(X_L,X_R)$ is valued in the torus $H^{2-}(X,\mathbb{R})\oplus H^{2+}(X,\mathbb{R})/H^2(X,\Z)$.

 Thus, the compact bosons of the 2d theory form Narain lattice CFT associated to the indefinite lattice $\Lambda \otimes H^2(X,\mathbb{Z})$. As before, $\Lambda\cong \sqrt{2}\Z$ denotes the root lattice of $SU(2)$. What is important is that the intersection form still has a single negative eignvalue. When $b_2^->0$ the theory has non-trivial moduli depending on the conformal class of the metric of $X$. It has special ``walls'' that appear when the intersection $H^{2,+}(X,\mathbb{R}) \cap (H^2(X,\mathbb{Z})\otimes \mathbb{R})$ has nonzero elements, corresponding to abelian instantons. 

The fermionic and non-compact bosonic fields will be the same as in the case $X=\mathbb{CP}^2$. Let us also assume that, as in the  $X=\mathbb{CP}^2$ case, the canonical class lies inside $H^{2,+}(X,\mathbb{R})$. That is $c_1(X)\cdot [h^-_i]=0,\,\forall i$, where $\;\cdot \;$  denotes the intersection pairing $H^2(X,\mathbb{R})\otimes H^2(X,\mathbb{R})\rightarrow \mathbb{R}$. The analysis of the holomorphic anomaly is then analogous to the $\mathbb{CP}^2$ case and the final result is modified to
\begin{equation}
\frac{\partial Z_v}{\partial \bar{\tau}} = 
\frac{(c_1(X)\cdot [\omega])}{16\pi i\,\tau_2^{3/2}\eta(\tau)^{3+b_2^-}}
\sum_{\substack{
n\,\in \,\frac{1}{2}H^2(X,\mathbb{Z})\\
n\,=\,\frac{v}{2} \mod H^2(X,\mathbb{Z}) }}
\bar{q}^{\,n^+\cdot n^+}q^{-n^-\cdot n^-},
\label{hol-anomaly-boundary-NLSM-cpx-surface}
\end{equation}
where
\begin{equation}
 n^+:=(n\cdot [\omega])\,[\omega],\qquad n^-:=\sum_{i=1}^{b_2^-} (n\cdot [h^-_i])\,[h^-_i],
\end{equation}
and 
\begin{equation}
 v  \in H^2(X,\mathbb{Z}_2)
\end{equation}
is the $\mathbb{Z}_2$ magnetic flux of the $SU(2)/\mathbb{Z}_2\cong SO(3)$ gauge field.  This is in agreement with the prediction for the holomorphic anomaly \cite{Minahan:1998vr,Alim:2010cf} obtained from a different perspective. 

There are two modifications in (\ref{hol-anomaly-boundary-NLSM-cpx-surface}) compared to the $\mathbb{CP}^2$ case (\ref{hol-anomaly-boundary-NLSM}). The first is the overall factor, $(c_1(X)\cdot [\omega])$ which is the straightforward generalization of the factor that appears after reduction of 6d Skyrmionic string term to 2d WZ term as in (\ref{2d-WZ-term}). The second is the contribution \begin{equation}
\frac{q^{-n^-\cdot n^-}}{\eta(\tau)^{b_2^-}}
\end{equation}
from left-moving compact bosons $X_L^i$.

Consider for example the case $X=\CP^1\times \CP^1$ with $b_2^+=b_2^-=1$. The $H^2(X,\mathbb{Z})$ lattice has two generators $e_1$ and $e_2$, Poincar\'e dual to 2-cycles $\text{pt}\times \mathbb{CP}^1$ and $ \mathbb{CP}^1\times \text{pt}$. Their intersection numbers are:
\begin{equation}
 e_1\cdot e_1=e_2\cdot e_2=0,\qquad e_1\cdot e_2=1.
\end{equation}
In terms of this basis, the first Cherm class of the tangent bundle reads
\begin{equation}
 c_1(X)=2e_1+2e_2.
\end{equation}
The orthonormal basis in $H^{2,+}(X,\mathbb{R})\oplus H^{2,-}(X,\mathbb{R})$ is given by 
\begin{equation}
 \omega=\frac{e_1}{R}+ \frac{R\,e_2}{2},\qquad h^-=\frac{e_1}{R}- \frac{R\,e_2}{2},
\end{equation}
where $R^2/2$  is the ratio of the areas of two $\mathbb{CP}^1$'s. In this case the effective two-dimensional theory is closely related to a (0,1) sigma model with $S^1\times \mathbb{R}^3$ target, where $R$ is the radius of $S^1$. The difference comes from rescaling of the lattice of winding numbers and momenta along $S^1$ by the overall $\sqrt{2}$ factor. The condition $c_1(X)\cdot [h^-]=0$ is satisfied if $R=\sqrt{2}$. The formula (\ref{hol-anomaly-boundary-NLSM-cpx-surface}) then reads
\begin{equation}
\frac{\partial Z_v}{\partial \bar{\tau}} = 
\frac{1}{4\sqrt{2}\pi i\tau_2^{3/2}\eta(\tau)^{4}}
\sum_{\substack{
n\,\in\, \mathbb{Z}^2\\
n\,=\,v \mod 2 
}}
\bar{q}^{(n_1+n_2)^2/8}q^{(n_1-n_2)^2/8},
\end{equation}
where $v\in \mathbb{Z}_2^2$.

The analysis in  the gauge theory  region is similar.  The overall factor of the 3-form integrated over the boundary $S^3$ in the space of bosonic zero-modes changes from $3$ to $(c_1(X)\cdot [\omega])$. The contribution of the abelian and point-like instantons in (\ref{hol-anomaly-from-4d}) is replaced with
\begin{equation}
\frac{1}{\eta(\tau)^{\chi(X)}}
\sum_{\substack{
	n\,\in\, \frac{1}{2}H^2(X,\mathbb{Z})\\
	n\, =\,\frac{1}{2}v\mod H^2(X,\mathbb{Z})
	}}
\bar{q}^{\,n^+\cdot n^+}q^{-n^-\cdot n^-},
\end{equation}
where $\chi(X)=3+b_2^-$. This  yields the same result (\ref{hol-anomaly-boundary-NLSM-cpx-surface}) obtained in the sigma model region. 

If $c_1(X)\cdot [h^-_i]\neq 0$ the analysis both in four and two dimensions will be slightly modified. In the gauge theory region the supersymmetrization of the Wess-Zumino term (performed in Appendix \ref{app:4dWZ-SUSY} for the case of $\mathbb{CP}^2$) will lead to an extra term in the action of the form
\begin{equation}
    \int_X \frac{F_R\wedge F^-_A H}{2\pi|\Phi|^2}
\end{equation}
where $F_R$ is the background R-symmetry curvature, which satisfies $[F_R/(2\pi)]=-c_1(X)$, $F_A^-$ is the anti-selfdual part of the gauge field strength, and $H$ is the scalar auxiliary field. This in turn will lead to an extra term proportional to $\mathcal{H}\,(c_1(X)\cdot n^-)$ in (\ref{first-term}). The result of the finite-dimensional Gaussian integration in (\ref{gaussian-localized}) will then be modified by an extra term of the form
\begin{equation}
    \tau_2^{-1/2}\,(c_1(X)\cdot n^-) (n\cdot [\omega])\, \bar{q}^{\,n^+\cdot n^+}q^{-n^-\cdot n^-}.
    \label{extra-term}
\end{equation}
Such an extra term in holomorphic anomaly was already observed in \cite{Manschot:2011dj} from a different approach\footnote{We would like to thank J. Manschot and G. Moore for bringing it to our attention.}. Similarly, in the sigma-models region, when $c_1(X)\cdot [h^-_i]\neq 0$, the 3-form $\phi^*(h)$ will have an extra term proportional to $\sum_i (c_1(X)\cdot [h^-_i])\,dX_L^i\,\hat{\phi}^*(\omega_2)$. The contribution (\ref{extra-term}) will then arise from the second term in (\ref{boundary-one-point}) which will be non-vanising, as $\langle \partial X_R \bar\partial X_L^i  \rangle \neq 0$ for compact bosons $X_R$ and $X_L^i$.


\subsection{Holomorphic Anomaly for $SU(N)/\mathbb{Z}_N$ Gauge Theory  \label{sec:higher-rank}}

Another  generalization is to consider Vafa-Witten theory for the gauge group $SU(N)/\mathbb{Z}_N$.  This theory can be obtained by compactifying on $T^2$ the six-dimensional (2,0) model of type $A_{N-1}$, which can be  realized in  M-theory by a stack of $N$ M5-branes with the center of mass degrees of freedom removed. For simplicity, consider  $X=\mathbb{CP}^2$. By arguments similar to the above, we expect that the contributions to the holomorphic anomaly come from the boundary of the non-compact space of bosonic zero-modes. The latter can originate from topologically twisted scalar bosonic fields serving as coordinates on the Coulomb branch, where the gauge group is spontaneously broken to some subgroup. 

Consider breaking $SU(N)$  by a vacuum expectation value of adjoint scalar fields proportional to the traceless matrix
\be
T= \frac{1}{\sqrt{N_{1}N_{2}N}}\left(\begin{array}{c|c}N_{2}  \mathbf{1}_{N_{1} \times N_{1}}& \mathbf{0}_{N_{1} \times N_{2}} \\\hline \mathbf{0}_{N_{2} \times N_{1}}  & -N_{1}  \textbf{1}_{N_{2} \times N_{2}} \end{array}\right) \, . 
\ee
with the standard normalization $\Tr(T^{2}) =1$; here  $N_1+N_2=N$.
An  $SU(N_1)\times SU(N_2)\times U(1)$ subgroup that commutes with $T$ is left unbroken.
Breaking to smaller subgroups can be realized  recursively. 

The analysis  above for $SU(2)/\mathbb{Z}_{2}$  can  be repeated with the  scalar fields $\Phi^i$ in the  vector multiplet  of the unbroken $U(1)$ and their superpartners. The overall coefficients in front of the 6d Skyrmionic string term (\ref{6d-sky-term}) and 4d WZ term (\ref{4d-WZ}) are now given by
\begin{equation}
\frac{n_W}{2}=\frac{(N_1+N_2)^2-1-(N_1^2-1+N_2^2-1+1)}{2}={N_1N_2}.
\label{T}
\end{equation}
This modifies accordingly the overall coefficient on the right hand side of the holomorphic anomaly equation. The integration over the boundary $S^3$ in the space of the bosonic zero-modes of the 4d theory on $\mathbb{CP}^2$ (or boundary $S^2\times S^1$ in the effective 2d theory), together with summation over all possible partitions $N=N_1+N_2$ and discrete fluxes of $SU(N_1)/\mathbb{Z}_{N_1}\times SU(N_2)/\mathbb{Z}_{N_2} \times U(1) $ consistent with a given flux of $SU(N)/\mathbb{Z}_N$, gives
\begin{multline}
 \frac{\partial Z_{v}^{SU(N)/\mathbb{Z}_N}(\mathbb{CP}^2)}{\partial \bar{\tau}} = 
 \frac{3}{16\pi i\tau_2^{3/2}\eta(\tau)^3}\times \\
  \sum_{N_1+N_2=N}N_1N_2
 \sum_{\substack{ v_1 \, \in \, \Z_{N_1} \\
v_2 \,\in \, \Z_{N_2}  }}
 \left(\sum_{\substack{n\,\in\, NN_1N_2\mathbb{Z}+NN_1v_2 \\
 	+NN_2v_1+N_1N_2v }}{\bar{q}^{\frac{n^2}{2NN_1N_2}}}\right)Z^{SU(N_1)/\mathbb{Z}_{N_1}}_{v_1}(\mathbb{CP}^2)Z^{SU(N_2)/\mathbb{Z}_{N_2}}_{v_2}(\mathbb{CP}^2).
 \label{hol-anomaly-boundary-NLSM-SUN}
\end{multline}
The theta function appearing in this formula corresponds to sum over the weight lattice 
\be
\Lambda^{*}_{U(1)} = \frac{\mathbb{Z}}{\sqrt{N_{1 } N_{2} N}}
\ee
 of the unbroken $U(1)$ inside the weight lattice $\Lambda^{*}_{SU(N)} $ of $SU(N)$. 
 The normalization is fixed by the normalization of $T$ in \eqref{T} above. 

This is in agreement with the general prediction in \cite{Minahan:1998vr,Alim:2010cf,Manschot:2017xcr,Alexandrov:2018lgp, Alexandrov:2019rth} (where the gauge group is $U(N)$  instead of $SU(N)$). By applying this formula recursively one can conclude that the holomorphic limit of $Z_{v}^{SU(N)/\mathbb{Z}_N}$ is a depth $N-1$ mock modular form.


\subsection{Other Twists}
\label{sec:other-twists}

For completeness, we include the computation of the holomorphic anomaly in the partition function for the B and the C twist.   The analysis  of the 2d sigma model is very similar for to the one for the A twist and leads to a noncompact theory. The analysis on the Coulomb branch is also similar. However, it turns out that the  holomorphic anomaly  for the partition function actually vanishes for these twists.   It is conceivable that some other observables of the twisted theory have nonvanishing holomorphic anomaly and  exhibit mock modularity. 

\subsubsection*{\it The C Twist}

This twist is only possible on spin manifolds, because the $\mathcal{N}=4$ theory, considered as a $\mathcal{N}=2$ theory, has matter in the adjoint representation. The corresponding  sigma model has $(0,1)$ supersymmetry in two dimensions, which for K\"ahler manifolds is enhanced to $(0,2)$. 

The simplest example is $X=\mathbb{CP}^1\times \mathbb{CP}^1$. Since its signature is zero, for generic metric there will be no harmonic spinors. The effective theory contains a single non-chiral non-compact boson, and also a 
left-moving chiral boson $X_L$ and a right-moving chiral boson $X_R$, as in the example at the end of Section \ref{sec:cpx-surfaces}). The non-compact boson and $X_R$ have super-partners: two right-moving Majorana-Weyl fermions $\psi_1,\psi_2$.  Unlike in the case of the A twist, the Wess-Zumino term does not play a role as the target space is two-dimensional. The boundary theory $\mathcal{Y}$ contains a single fermionic mode that can be saturated by the supercurrent. However, its expectation value turns out to vanish: 
\begin{multline}
\frac{\partial Z_{v}(\mathbb{CP}^1\times \mathbb{CP}^1)}{\partial \bar{\tau}} 
\;\propto\; \langle \bar{G} \rangle_\mathcal{Y} \;\propto \; \langle \psi_2 \,\bar\partial X_R \rangle \\
\propto 
\sum_{\substack{
n\,\in \,H^2(X,\mathbb{Z})\\
n\,=\,v \mod 2 }}
(n_1/R+R\,n_2/2)\,\bar{q}^{(n_1/R+R\,n_2/2)^2/4}q^{(n_1/R-R\,n_2/2)^2/4}=0,
\end{multline}
where, as before, $v\in \mathbb{Z}_2^2$ labels the discrete gauge flux. The vanishing can be attributed to anti-symmetry under the automorphism of the $H^2(X,\mathbb{Z})$ lattice acting as $n\mapsto -n$ on all the elements. For $X=\mathbb{CP}^1\times \mathbb{CP}^1$ this automorphism is induced by the map $X\rightarrow X$ given by complex conjugation on the complex coordinates. Thus it corresponds to a certain global $\mathbb{Z}_2$ symmetry of the theory. Note that for any other spin 
manifold
$X$ with $b_2^+=b_2^-=1$,  the intersection form is the same as for $\mathbb{CP}^1\times \mathbb{CP}^1$, due to the classical result about classification of even self-dual lattices. Therefore the result of the calculation will be the exactly same (namely zero) because the contribution from the boundary at infinity of the target space depends only on the intersection form  and the action of the Hodge star on $H^2(X,\mathbb{R})$. However, the involution of the lattice $n\mapsto -n$ does not necessarily correspond to an orientation-preserving self-diffeomorphism of $X$. 

Consider now a smooth spin 4-manifold $X$ with $b_2^+=1$ and $b_2^->1$. Note that due to Rokhlin's theorem, $b_2^--1=0\mod 16$. If the metric on $X$ is generic, the effective 2d theory will have  $(b_2^--1)/4\geq 4$  extra right-moving Majorana-Weyl fermions in addition to the fields
$\psi_{1,2}$ introduced above. They originate from harmonic spinors on $X$. In this case it is not possible to saturate the corresponding fermionic zero-modes by an insertion of the supercurrent and the anomaly vanishes for a more trivial reason. 

\subsubsection*{\it The B Twist}

The sigma model now has $(1,1)$ supersymmetry, which for K\"ahler manifolds is enhanced to (1,2). As before, the field content can be determined by counting harmonic forms on $X$. In the case $X=\mathbb{CP}^2$ the effective theory contains a single non-chiral non-compact boson, a single right-moving compact boson of radius $\sqrt{2}$, and their super-partners: one left-moving and two right-moving Majorana-Weyl fermions. While it is possible to saturate the zero-modes for the right-moving fermions as in the case of C twist considered above, the zero-mode for the left-moving fermion will remain unpaired, rendering the result to be zero. The same holds for other manifolds with $b_2^+=1$ and $b_1=0$.



\section*{Acknowledgments}
We would like to thank J. Manschot, G. Moore, D. Pei, B. Pioline, C. Vafa for useful discussions.   EW acknowledges partial support from NSF  Grant PHY-1911298.

\appendix

\section{Supersymmetrization of the Four-Dimensional Action }
\label{app:4dWZ-SUSY}

Our goal is to determine the constants $a$ and $b$ introduced in \eqref{first-term}. The constant $b$ will be determined in Appendix \ref{app:restriction}  by comparison with the bosonic part of untwisted action with auxiliary fields put on-shell. The constant $a$ will be determined   by identifying a bosonic term linear in the field $H$ (whose zero mode is $\cH$)  in the supersymmetrization of the bosonic Wess-Zumino term.  It is convenient to work directly in the twisted theory because the superalgebra of the scalar supercharges is particularly simple. 

On a four-manifold of general holonomy,  the $\mathcal{N}=4$ topological twisted theory has two scalar supercharges with an off-shell realization \cite{Yamron:1988qc,Vafa:1994tf,Labastida:1997vq,Hosomichi:2016flq}. For a  K\"ahler manifold $X$,  the holonomy is reduced from $SU(2)_\ell\times SU(2)_r$  to $U(1)_\ell\times SU(2)_r$. Only a $U(1)_{R}$  subgroup of 
 $Spin(6)_R$ is used for twisting  by replacing $U(1)_\ell$ with the diagonal $U(1)_\ell'$ of $U(1)_{R}\times U(1)_\ell$.  
 
 The resulting twisted theory thus has unbroken $Spin(4)_R
\times U(1)_{R}$ global symmetry in addition to the $U(1)_{l '} \times SU(2)_{r}$ holonomy group. Note that since $U(1)_{R}$ is abelian, it remains unbroken even after turning on a non-trivial background.  There are then four scalar supercharges which we denote as $Q_{A}$ ($A = 1, 2$) and $Q_{\dot A}$ ($\dot A = 1, 2$) and which  transform as 
$\mathbf{(1,2,1)_{+1}^{0}}\oplus \mathbf{(1,1,2)^{0}_{-1}}$  respectively under $SU(2)_r\times Spin(4)_R\times U(1)_\ell'\times U(1)_{R}$ where the superscript denotes the $U(1)_\ell'$ charge and the subscript denotes the $U(1)_{R}$ charge. 



\subsection{Off-shell Fields}

The $\mathcal{N}=4$ vector multiplet contains the  gauge field  and six scalar fields in the untwisted theory.
The gauge field  is not affected by twisting, and splits into the following two irreducible representations\footnote{ In the Euclidean theory, they are to be regarded as independent fields not related by complex conjugation.}:
\begin{equation}
A^\pm\ \mathbf{(2,1,1)^{\pm 1}_{0}} \\
\label{twisted-fields-1}
\end{equation}
corresponding to the Hodge decomposition of a 1-form  on a K\"ahler manifold into (1,0) and (0,1) forms. Similarly,  the exterior derivative splits as $d=d^{+}  + d^{-} $ :
\be
d^\pm \ \mathbf{(2,1,1)^\pm_{0}}
\label{twisted-fields}
\ee
where $d^+\equiv \partial$, $d^-\equiv \bar\partial$ are the Dolbeault differentials. 
The six scalars of the untwisted theory split into three irreducible representations:
\bea
& \Phi_{A \dot A} \ \mathbf{(1,2,2)^{0}_{0}}\,,  \nonumber \\
 &B^{++} \ \mathbf{(1,1,1)^{2}_{2}}\,, \qquad B^{--} \ \mathbf{(1,1,1)^{-2}_{-2}}   \, .
\label{twisted-fields-2}
\eea
We have denoted the fields suppressing the $SU(2)_r$ indices to avoid clutter. The $A$ and $\dot A$ indices on the fields transform in the spinor and the conjugate spinor representations of  $Spin(4)_R$, the superscript denotes the $U(1)_{\ell}'$ charge and the subscript denotes the $U(1)_R$ charge. 


There are sixteen fermions which split  into six irreducible representations:
\bea
\tilde\psi_{A} \  \mathbf{(1,2,1)^{0}_{-1}}\,, &\qquad& \tilde\lambda_{\dot A} \
\mathbf{(1,1,2)^{0}_{+1}}\,, \nonumber\\
\tilde\psi^{--}_{A} \ \mathbf{(1,2,1)^{-2}_{-1}}\,, &\qquad& \tilde\lambda^{++}_{\dot A} \
\mathbf{(1,1,2)^{+2}_{+1}}\,, \nonumber \\
\psi^+_{A} \ \mathbf{(2,2,1)^{+1}_{+1}}\,,  &\qquad&  \lambda^-_{\dot A} \ \mathbf{(2,1,2)^{-1}_{-1}}\,. 
\label{twisted-fields-3}
\eea
So far we have ten bosonic and sixteen fermionic fields. Taking into account gauge freedom parametrized by a single scalar bosonic field we then need seven auxiliary fields to obtain an off-shell realization of the four scalar supercharges. We introduce auxiliary fields for each fixed representation of $SU(2)_r\times U(1)_\ell'$  as follows:
\bea
&\tilde{H}^+ \  \mathbf{(2,1,1)^{+1}_{+2}}\,, \qquad \tilde{H}^-  \ \mathbf{(2,1,1)^{-1}_{-2}}\,,  \nonumber \\
&H^{++} \  \mathbf{(1,1,1)^{+2}_{0}}\,,  \qquad H^{--} \  \mathbf{(1,1,1)^{-2}_{0}}\,, \nonumber \\
& H  \; \mathbf{(1,1,1)^{0}_{0}}\,. 
\eea
The  fields $H^{\pm\pm}$ and $H$ can be seen to arise from  a self-dual 2-form, 
\be
H^{(2+)}:=H\omega + H^{++} + H^{--}
\label{Hodge}
\ee
 as  the (1,1), (2,0) and (0,2) components in the Hodge decomposition on a K\"ahler manifold. Here and elsewhere  $\omega$ denotes the K\"ahler form normalized such that $\int_{X}\omega\wedge \omega =1$. Similarly, the fields $\tilde{H}^\pm$ combine into 1-form as its (1,0) and (0,1) components:
 \begin{equation}
  \tilde{H}^{(1)}: = \tilde{H}^+ + \tilde{H}^-.
 \end{equation}
 
\subsection{Off-shell Superalgebra}

The four supercharges are nilpotent up to gauge transformation $\delta_\text{gauge}({\Phi_{A\dot{B}}})$ generated by $\Phi_{A\dot{B}} $:
\bea
&\{Q_A,Q_B\}=0, \qquad \{\bar{Q}_{\dot{A}},\bar{Q}_{\dot{B}}\}=0, \nonumber\\
&\{Q_{A},\bar{Q}_{\dot{B}}\}= \delta_\text{gauge}({\Phi_{A\dot{B}}}) \,  .
\label{super-algebra}
\eea
The off-shell realization of  this algebra  can be determined essentially by inspection and by comparison with the untwisted theory as we describe below. 


The entire vector supermultiplet of $\cN=4$ theory together with the auxiliary fields splits into three multiplets of the algebra \eqref{super-algebra} satisfied by the four scalar supercharges. The  transformations below are strongly constrained  by the $SU(2)_r\times Spin(4)_R\times U(1)_\ell'\times U(1)_{R}$ global symmetry and the algebra \eqref{super-algebra}. Note that the fields can always be rescaled relative to the gauge fields $A^\pm$ so that the coefficients in the supersymmetry transformations are as below. 

Sections of the canonical and anti-canonical bundles belong to two short multiplets:
\begin{equation}
\begin{array}{rclp{3em}rcl}
	[Q_A,B^{--}] & = &\tilde\psi^{--}_A,
	& &
	[\bar{Q}_{\dot{A}},B^{--}] & =  & 0, \\
	\{Q_A,\tilde\psi^{--}_B\}& = & \epsilon_{AB}H^{--},
	& &
		\{\bar{Q}_{\dot{A}},\tilde{\psi}^{--}_B\} & = & 0,
	\\
		{[Q_{A},H^{--}]}& = & 0,
	& &
		[\bar{Q}_{\dot{A}},H^{--}] & = & 0,
\end{array}
\label{Q-tw-1}
\end{equation}
and
\begin{equation}
\begin{array}{rclp{3em}rcl}
	[Q_A,B^{++}] & = & 0,
	& & 
	[\bar{Q}_{\dot{A}},B^{++}] & = & \tilde\lambda^{++}_{\dot{A}},
	\\
	\{Q_A,\tilde\lambda^{++}_{\dot{B}}\}& = & 0,
	& &
		\{\bar{Q}_{\dot{A}},\tilde{\lambda}^{++}_{\dot B}\} & = & 
		\epsilon_{\dot{A}\dot{B}} H^{++},
	\\
		{[Q_{A},H^{++}]}& = & 0,
	& &
		[\bar{Q}_{\dot{A}},H^{++}] & = & 0,
\end{array}
\label{Q-tw-2}
\end{equation}
 The remaining fields including the gauge field  form a long multiplet:
\begin{equation}
\begin{array}{rclp{3em}rcl}
    \{Q_A,\lambda^-_{\dot{B}}\} & = & 
d^-\Phi_{A\dot{B}}    , 
& &
  \{\bar{Q}_{\dot{A}},\psi^+_B\} & = & d^+\Phi_{B\dot{A}},\\
	{[Q_A,\Phi_{B\dot{B}}]} & = & \epsilon_{AB}\tilde{\lambda}_{\dot{B}},
	& &
		{[\bar{Q}_{\dot{A}},\Phi_{B\dot{B}}]} & = & -\epsilon_{\dot{A}\dot{B}}\tilde{\psi}_{{B}},
	\\
			\{Q_A,{\tilde\lambda}^{\dot{B}}\} & = & 0,
	& &
\{\bar{Q}_{\dot{A}},{\tilde\psi}^{B}\} & = & 0,		
	\\
\\
     {[Q_A,\tilde{H}^-]} & = & -d^-\tilde{\psi}_A  ,
& & 
 {[\bar{Q}_{\dot{A}},\tilde{H}^+]} & = & d^+\tilde{\lambda}_{\dot{A}},\\
		\{Q_A,{\tilde\psi}_{B}\} & = & \epsilon_{AB} H,
	& &
	\{\bar{Q}_{\dot{A}},{\tilde\lambda}_{\dot{B}}\} & = & \epsilon_{\dot{A}\dot{B}} H,	
\\
{[Q_A,H]} & = & 0 ,
& &
{[\bar{Q}_{\dot{A}},H]} & = & 0,
 \\
 \\
 {[Q_A,A^+]} & = & \psi_A^+ ,
& &
{[\bar{Q}_{\dot{A}},A^-]} & = & \lambda^-_{\dot{A}}, \\
   \{Q_A,\psi^+_B\} & = & \epsilon_{AB}\tilde{H}^+,
& &
 \{\bar{Q}_{\dot{A}},\lambda^-_{\dot{B}}\} & = & \epsilon_{\dot{A}\dot{B}}\tilde{H}^-, 
 \\
    {[Q_A,\tilde{H}^+]} & = & 
0 , 
& &
 {[\bar{Q}_{\dot{A}},\tilde{H}^-]} & = & 0,
\\
 \\
   {[Q_A,A^-]} & = & 0 ,
& &
 {[\bar{Q}_{\dot{A}},A^+]} & = & 0,
\end{array}
\label{Q-tw-0}
\end{equation}
where we have grouped the fields into shorter multiplets with respect to the $Q_{A}$ or $\bar{Q}_{\dot{A}}$ supercharges separately. The fields $\Phi,\tilde\psi,\tilde\lambda,H$ form a submultiplet of the superalgebra \eqref{super-algebra}. 

The normalization of the gauge field can be fixed by specifying the coefficient for the kinetic term.
The realization of the superalgebra above still leaves the freedom to rescale other fields together with supercharges without changing the supersymmetry transformations: 
\begin{equation}
\begin{array}{c}
 A^\pm \rightarrow A^{\pm},\  Q\rightarrow CQ,\ \bar{Q}\rightarrow C\bar{Q},\ \psi^+ \rightarrow C\psi^+,\ \lambda^- \rightarrow C\psi^-,\  \\
  \tilde{H}^\pm\rightarrow C^2\tilde{H}^\pm,\ \Phi\rightarrow C^2\Phi,\  \tilde\psi\rightarrow C^3\tilde\psi,\ 
  \tilde\lambda\rightarrow C^3\tilde\lambda,\; H\rightarrow C^4H,\  \\
  B^{++}\rightarrow C^2B^{++},\  \tilde\lambda^{++}\rightarrow C^{3}\tilde\lambda^{++},\  H^{++}\rightarrow C^{4}H^{++},\\
    B^{--}\rightarrow C^{2}B^{--},\  \tilde\psi^{--}\rightarrow C^{3}\tilde\psi^{--},\ H^{--}\rightarrow C^{4}H^{--}.\\
     \end{array}
     \label{fields-rescaling}
\end{equation}


\subsection{Supersymmetrization of the  Free Action}

The bosonic part of the free action can be fixed by requiring that  one obtains the standard   kinetic term for the  gauge field for the unbroken $U(1)$ subgroup of $SO(3)$ on the Coulomb branch after eliminating the auxiliary fields:
\begin{equation}
S_\text{4d}^\text{free}=2\pi i \tau \int_{X} \frac{F_A\wedge F_A}{4\pi^2}
- \frac{\tau_2}{\pi}\int_{X}  {H^{(2+)}\wedge(H^{(2+)}-2F_A)}+\ldots
\end{equation}
Using Hodge decomposition \eqref{Hodge} of $H^{(2+)}$, the remaining terms are fixed by supersymmetry:
\begin{multline}
S_\text{4d}^\text{free}=2\pi i \tau \int_{X} \frac{F_A\wedge F_A}{4\pi^2}
+ \frac{2\tau_2}{\pi}\int_{X}  \left( -\frac{\omega\wedge\omega}{2}\,H^2 + d^+\psi^+_A\tilde{\psi}^{--A} \,
+ \, d^-\lambda^-_{\dot{A}}\tilde\lambda^{++\dot{A}}
\, +\right.\\
\omega\wedge[H(d^+A^-+d^-A^+)+\frac{1}{2}d^+\Phi^{A\dot{A}}d^-\Phi_{A\dot{A}}+d^+\tilde\lambda^{\dot{A}}\lambda^-_{\dot{A}}+\psi^+_Ad^-\tilde\psi^A+\tilde{H}^+\tilde{H}^-]\\
\left.
-H^{++}H^{--}+d^+A^+H^{--}+d^-A^-H^{++}
+\tilde{H}^+d^+B^{--}+\tilde{H}^-d^-B^{++}
 \right).
\label{full-action-free}
\end{multline}

One can show that the term in (\ref{full-action-free}) proportional to $\tau_2$ is  $Q$-exact. Using $Spin(4)_R$ R-symmetry,  one can choose  $Q$ to be a linear combination of the form 
\begin{equation}
 Q=\alpha Q_1 +\beta \bar{Q}_{1} \, .
\end{equation}
where $\a$ and $\b$ are constants. Define
\begin{multline}
\Lambda^1:=\frac{i}{\pi}\int_X \left(\frac{\omega\wedge\omega}{2}\,H\tilde\psi_2 +
\omega\wedge[-(d^+A^-+d^-A^+)\tilde\psi_2+\tilde{H}^-\psi^+_2+d^+\Phi^{1\dot{B}}\lambda^-_{\dot{B}}]
\right.
\\
\left. -2d^+A^+\tilde\psi_2^{--}+H^{++}\tilde\psi_2^{--}+2d^+B^{--}\psi_2^+\right)
\end{multline}
and
\begin{multline}
\bar\Lambda^1:=\frac{i}{\pi}\int_X \left(\frac{\omega\wedge\omega}{2}\,H\tilde\lambda_2 +
\omega\wedge[-(d^+A^-+d^-A^+)\tilde\lambda_2-\tilde{H}^+\lambda^-_2-d^-\Phi^{B1}\psi^+_B]
\right.
\\
\left. -2d^-A^-\tilde\lambda_2^{++}+H^{--}\tilde\lambda_2^{++}+2d^-B^{++}\lambda_2^-\right).
\end{multline}
They satisfy
\begin{equation}
\{\bar{Q}_1,\Lambda^1\}=0,\qquad \{Q_1,\bar\Lambda^1\}=0,
\end{equation}
and\footnote{Note that for the action restricted to the supermultiplet (\ref{Q-tw-0}) it is possible to use just $Q_1$ or $\bar{Q}_1$.}
\begin{equation}
S_\text{4d}^\text{free}=2\pi i \tau \int_{X} \frac{F_A\wedge F_A}{4\pi^2}
-{i\tau_2}\,(\{Q_1,\Lambda^1\}+\{\bar{Q}_1,\bar\Lambda^1\}).
\end{equation}
It follows that
\begin{equation}
\frac{\partial S_\text{4d}^\text{free}}{\partial\bar\tau} = \{Q,\Lambda\}
\end{equation}
where 
\begin{equation}
  \Lambda=\frac{1}{2\a}\Lambda^1+\frac{1}{2\b}\bar\Lambda^1.
  \label{gauge-fermion}
\end{equation}
For convenience one can choose $\a=\b=1$ as in Section \ref{sec:4d-hol-anomaly}. 

\subsection{Supersymmetrization of the Wess-Zumino Term}

%Our goal is the determine the constants $a$ and $b$ in the effective action \eqref{first-term} over  the bosonic zero modes. 
To determine the coefficient $a$  of the term linear in $\cH$ in the zero mode action \eqref{first-term}, it is necessary to determine the terms in the full action that are linear in the field $H$.  In this subsection we show  that such a term is indeed present and is necessary to  cancel   supersymmetric variation of  the bosonic Wess Zumino term (\ref{4d-WZ}).  

We start by writing the Wess Zumino term (\ref{4d-WZ}) in the twisted field variables. The topological twist on a K\"ahler $X$ is realized by turning on background field strength for the subgroup of R-symmetry $Spin(2)_{R}\subset Spin(6)_{R}$. One can assume that the $Spin(2)_{R}$ rotates in the 4-5 plane in the $\mathbb{R}^6$ field space of  scalars in the untwisted theory. With this choice, one can relate the fields $\Phi^I,I=0\dots 5$ with the bosonic fields in (\ref{twisted-fields}) as follows:
\bea
\Phi^{11}  &= \Phi^2+i\Phi^3, \qquad
\Phi^{22}  &= \Phi^2-i\Phi^3, \nonumber \\
\Phi^{12}  &= \Phi^0+i\Phi^1, \qquad
\Phi^{21}  &= -\Phi^0+i\Phi^1, \nonumber\\
B^{++}  &= \Phi^4 + i\Phi^5,  \qquad 
B^{--}  &= \Phi^4 - i\Phi^5.
\eea
Only nonzero components of  $F^{I_1I_2}$  in (\ref{4d-WZ}) are  $F^{45}=-F^{54}$,  related to the curvature of the canonical bundle when restricted to $X=\mathbb{CP}^2$. Let $\omega$ be the  K\"ahler form on $\mathbb{CP}^2$ normalized such that 
$\int_{\mathbb{CP}^1}\omega =1$ for a standard embedding of  $\mathbb{CP}^1$  into $\mathbb{CP}^2$.
Since the canonical bundle is $O(-3)$ bundle  one has $c_1(K\mathbb{CP}^2)=-3[\omega]$. Moreover, $F^{45}|_X = 3 \cdot 2\pi \,\omega$ when the connection on $K\mathbb{CP}^2$ is induced by Levi-Civita connection on $T\mathbb{CP}^2$ for the Fubini-Study metric. 

Since $\Phi^{A\dot{A}}$ and $\Phi^4\pm i\Phi^5$ belong to different supermultiplets (\ref{Q-tw-1}) and (\ref{Q-tw-0}) after  twisting, one can restrict $\Phi^4$ and $\Phi^5$ to be zero. With the field redefinitions above the bosonic Wess-Zumino term $ S_\text{4d WZ}$  equals
\be
\frac{i}{\pi}\int_{\Xi^5} \frac{F^{45}}{2\pi} \wedge
 \frac{\Phi^{11}d\Phi^{22}d\Phi^{12}d\Phi^{21}
-\Phi^{22}d\Phi^{12}d\Phi^{21}d\Phi^{11}
+\Phi^{12}d\Phi^{21}d\Phi^{11}d\Phi^{22}
-\Phi^{21}d\Phi^{11}d\Phi^{22}d\Phi^{12}} {|\Phi|^4}
\label{4dWZ-2}
\ee
where\footnote{Note that $|\Phi|^2=2\lVert \Phi \rVert^2|_{\Phi^4=\Phi^5=0}$.} $|\Phi|^2:=\Phi_{A\dot{A}}\Phi^{A\dot{A}}=2(\Phi^{11}\Phi^{22}-\Phi^{12}\Phi^{21})=2((\Phi^0)^2+(\Phi^1)^2+(\Phi^2)^2+(\Phi^3)^2)$. 

It turns out that  \eqref{4dWZ-2} by itself cannot be supersymmetrized. One can consider instead
\begin{equation}
S_\text{WZ}' = S_\text{4d WZ}+S_\text{grav},
\end{equation}
with 
\begin{equation}
 S_\text{grav}=-\frac{3i}{2\pi}\int_{X}\omega\wedge \frac{d^-\Phi_{A\dot{A}}d^+\Phi^{A\dot{A}}}{|\Phi|^2},
 \label{Sgrav}
\end{equation}
which \textit{can} be supersymmetrized to the desired order. 
This term can arise from a term in the effective  action in the untwisted theory of the form
\begin{equation}
	S_\text{grav} = \int d^4x \sqrt{g}  \, (c_1\,R\,g^{\mu\nu}+c_2\,R^{\mu\nu})\, \frac{1}{\lVert\Phi \rVert^2} \sum_{I=1}^6\partial_\mu \Phi^I \partial_\nu \Phi^I
	\label{Sgrav-untwisted}
\end{equation}
for some constants
$c_{1}$ and $c_{2}$, 
and can be thought of as a non-minimal coupling to gravity required by supersymmetry on a curved manifold.
It respects both scaling and $Spin(6)_R$ symmetry and reduces to (\ref{Sgrav}) on $\mathbb{CP}^2$ when $\Phi^4=\Phi^5=0$.
Such a term is indeed known to be present as a four derivative coupling in $\mathcal{N}=2$ supergravity \cite{deWit:2010za}.


Our goal is to determine whether a bosonic term linear in $H$ is required by supersymmetry.  Since we are trying to relate a bosonic term to another bosonic term,  we will have to consider at least two consecutive supersymmetry transformations.
A general variation $S_\text{WZ}'$ is  given by
\begin{equation}
\delta S_\text{WZ}'=    \int_{X}  \frac{3i\omega}{\pi}  \wedge 
\frac{(2\Phi^{A\dot{A}}d^-\Phi_{B\dot{A}}d^+\Phi_{A\dot{B}}-|\Phi|^2d^+d^-\Phi_{B\dot{B}})\delta\Phi^{B\dot{B}}}{|\Phi|^4}.
\label{4dWZ-3}
\end{equation}
Even though the Wess-Zumino action is defined by a 5d integral, its variation must be a local 4d integral. 
The supersymmetry variation can be canceled by adding the term
\begin{equation}
S_1=
 \int_{X}  \frac{3i\omega}{\pi}  \wedge  \left[
\frac{2\,\Phi^{A\dot{A}}d^+\Phi_{A\dot{B}}\lambda^-_{\dot{A}}\tilde\lambda^{\dot{B}}}{|\Phi|^4}+ 
\frac{d^+\lambda_{\dot{A}}^-\tilde\lambda^{\dot{A}}}{|\Phi|^2} + \frac{2\,\Phi^{A\dot{A}}d^-\Phi_{B\dot{A}}\psi^+_{{A}}\tilde\psi^{{B}}}{|\Phi|^4}+
	\frac{d^-\psi_{{A}}^+\tilde\psi^{{A}}}{|\Phi|^2} \right] \, .
\label{4dWZ-4}
\end{equation}
With some algebra, one can verify that the   variation of $S_\text{WZ}'$  with respect to $Q_C$ is  completely canceled by the variation of the first two terms with respect to $Q_C$; and the variation  with respect to $\bar{Q}_{\dot{C}}$ is completely canceled by the variation of the last two terms with respect to $\bar{Q}_{\dot{C}}$.


However the variation of the first two terms (\ref{4dWZ-4}) with respect to $\bar{Q}_{\dot{C}}$ and the last two terms with respect to ${Q}_{{C}}$ is nonzero. Restricting to one fermion terms modulo terms linear in $\tilde{H}^-$, one can verify that this variation can be canceled by the variation of the term
\begin{equation}
S_2=
\int_{X}  \frac{3i\omega}{\pi}  \wedge \left[
\frac{2\,\Phi^{A\dot{A}}\psi^+_A\lambda^-_{\dot{A}}\,H}{|\Phi|^4}
	+  \frac{F_A\,H}{|\Phi|^2} \right] \, .
\label{4dWZ-7}
\end{equation}
We have thus concluded that a term linear in $F_{A}$ and linear in $H$ is necessarily present in the supersymmetrization of the Wess-Zumino action. Therefore, the coefficient  of this term and in turn $a$ is  topological in origin and is  determined by the anomaly matching which fixes the coefficient of the Wess-Zumino term.  

\subsection{Restriction to Zero-Modes \label{app:restriction}}

Given the relevant terms in the four-dimensional action, one can determine the effective action over zero-modes to the desired order by restricting the four-dimensional fields to the zero-modes.
When $X=\mathbb{CP}^2$, the canonical bundle has no harmonic sections and $b_1=0$. The only zero-modes arise from fields in representations of the form $\mathbf{(1,*,*)^{0,*}}$ and hence are given by:
\bea
\Phi^{A\dot{A}}|_\text{zm} & =  u^{A\dot{A}}, \qquad
\tilde{\psi}^A|_\text{zm} & = \chi^{A}, \nonumber \\
\tilde{\lambda}^{\dot{A}}|_\text{zm} & =  \bar{\chi}^{\dot{A}}, \qquad
H|_\text{zm} & =  \mathcal{H}. 
\label{zero-modes-subs}
\eea
The supercharges in (\ref{Q-tw-0}), restricted to the zero-modes, then can be realized as the following linear differential operators:
\begin{equation}
\begin{array}{rcl}
Q_A|_\text{zm} & = & \mathcal{H} \frac{\partial}{\partial \chi^A} + \bar{\chi}^{\dot{A}} \frac{\partial}{\partial u^{A\dot A}},
\\
\bar{Q}_{\dot{A}}|_\text{zm} & = & \mathcal{H} \frac{\partial}{\partial \bar{\chi}^{\dot{A}}} - \chi^{{A}} \frac{\partial}{\partial u^{A\dot A}}.
\end{array}
\label{Q-zm-operators}
\end{equation}
The restriction of (\ref{full-action-free}) to the zero-modes is then given by
\begin{equation}
S_\text{4d}^\text{free}|_\text{zm}=-\frac{\tau_2}{\pi}\,\mathcal{H}(\mathcal{H}-4\pi n)+2\pi i \tau n^2,
\end{equation}
where we have used the fact that
\begin{equation}
\int_{\mathbb{CP}^1}\frac{F_A}{2\pi} = n \in\frac{1}{2}\mathbb{Z} \,.
\end{equation} 
The restriction of (\ref{gauge-fermion}) is then given by
\begin{equation}
 \Lambda|_\text{zm}=-\frac{i}{4\pi}\,(\chi^1+\bar{\chi}^1)(\mathcal{H}-4\pi n).
\end{equation}
The reduction of the term \eqref{4dWZ-7} in the effective action to the zero-modes reads
\begin{equation}
S_2|_{\text{zm}}=
\frac{6i\,n\mathcal{H}}{|u|^2}.
\label{SFH-zm}
\end{equation}
It follows that the constant $a$ defined in \eqref{first-term} is equals $3/\pi$.

The coefficient $b$ in \eqref{first-term}  of the term quadratic in $H$ cannot be fixed  by the supersymmetrization of  the  Wess-Zumino term by the four supercharges considered above.  This can be seen by considering a term in the action of the following form motivated by (\ref{action-zm-general}):
\begin{multline}
\int_{X} \omega\wedge \omega\;\left( 
H^2\;f(|\Phi|^2,H) + 
 2\Phi_{A\dot{A}}Hf'(|\Phi|^2,H)\tilde{\psi}^A\tilde\lambda^{\dot{A}} 
 \right. \\
 \left. 
+(2f'(|\Phi|^2,H)+ |\Phi|^2\,f''(|\Phi|^2,H))\epsilon_{AB}\epsilon_{\dot{A}\dot{B}}
\tilde{\psi}^A\tilde{\psi}^B
\tilde\lambda^{\dot{A}}
\tilde\lambda^{\dot{B}}
\right)
\end{multline}
where $f$ is any function and prime denotes the derivative with respect to the first argument. 
This term is  annihilated by all four superchages and hence is not fixed by the analysis in this appendix. When restricted to zero-modes,  such a term will shift the value of $b$.


To determine $b$,  one can appeal to the  untwisted on-shell action. If  $b\neq -1$,  then after integrating  the auxiliary field $H$, 
there must be a term proportional to 
\begin{equation}
  \int_{X} \frac{F_A^+\, F_A^+\, \omega}{|\Phi|^2}
  \label{badterm}
\end{equation}
on $X=\mathbb{CP}^2$ with a nonzero coefficient.The indices in $F_A^+\,F_A^+ \,\omega$ are contracted appropriately to obtain a 4-form. Such a term can arise from only two possible terms. 
\begin{myitemize}
\item  A  term of the form
\begin{equation}
\int \frac{F_A^+\, F_A^+\, F_R}{\lVert\Phi\rVert^2}
\end{equation}
in the theory in  flat space, where $F_R$ is the background R-symmetry. However, such a term 
can be invariant  only under $Spin(4)_R \times  U(1)_R$ but cannot be made invariant under the full $Spin(6)_R$ R-symmetry of the untwisted theory.  
\item  A  term of the form
\begin{equation}
\int \frac{F_A^+\, F_A^+\, R}{\lVert \Phi \rVert^2}
\end{equation}
where $R$ is the Riemann curvature tensor. The scalar fields $\Phi$ in the term above can be restricted to be purely in the $\mathcal{N}=2$ vector multiplet. However, it is known that there is no such 4-derivative coupling in $\mathcal{N}=2$ supergravity (\cite{deWit:2010za}). 
\end{myitemize}
Since neither term is consistent with superymmetry and R-symmetry, we conclude  $b=-1$.





\section{$SO(3)$ versus $U(2)$}
\label{app:U2}

In this section we comment on the relation between the partition functions for the  $SO(3)$ and $U(2)$ gauge groups. From the point of view of 6d (2,0) theory, the $\mathfrak{u}(2)$ Lie algebra is in a certain sense more natural  because it  describes the stack of two M5-branes without removing  the centre of mass degrees of freedom. Moreover, the six-dimensional $\mathfrak{u}(2)$ (2,0) theory is \textit{absolute} because it has a self-dual lattice of string charges and thus has a single partition function. By contrast, the $\mathfrak{su}(2)$ (2,0) theory is relative and has  a vector of partition functions labeled by discrete fluxes. On $X\times T^2$ partition function should transform to itself under modular transformations, up to a phase related to  't Hooft anomalies. 

Let us consider how the effective two-dimensional theory in the $\mathfrak{u}(2)$ case is modified compared to $\mathfrak{su}(2)$ case. The analysis  in Section \ref{sec:2d-fields} can be repeated  for the 6d tensor multiples valued in the Cartan sub algebra of $\mathfrak{u}(2)$. In particular, the KK reduction of the self-dual 2-form field $B$ now leads to $\widehat{\mathfrak{u}(2)}_1$ right-moving WZW CFT, instead of $\widehat{\mathfrak{su}(2)}_1\cong \widehat{\mathfrak{u}(1)}_2$. This two-dimensional theory is now also absolute\footnote{As a spin-theory, as we will comment on below.} and its character is 
\begin{equation}
       \bar\chi^{\widehat{\mathfrak{u}(2)}_1}_{0,0}({\t};z) =
       \frac{1}{\overline{\eta({\t})}^2} \sum_{n\in\mathbb{Z}^2}\bar{q}^{\frac{n_1^2+n_2^2}{2}+(n_1+n_2)\bar{z}} =
       \left[\frac{
       \overline{\vartheta_3({\tau};z)}
       }{
       \overline{\eta({\tau})}}
       \right]^2
       \label{u2-char}
\end{equation}
which again captures contribution of abelian instantons. We have included the fugacity $e^z$ for the diagonal $\mathfrak{u}(1)$. From the 4d perspective such refinement is realized by adding the topological term $z\int_{\mathbb{CP}^1}c_1$ to the action on $\mathbb{CP}^2$. The decoupling of the diagonal $\mathfrak{u}(1)$, corresponding to the center of mass degrees of freedom, is then done via the following decomposition of characters:
\begin{equation}
  \bar{\chi}^{\widehat{\mathfrak{u}(2)}_1}_{0,0}({\tau};z)=
    \bar{\chi}^{\widehat{\mathfrak{u}(1)}_2}_0({\tau};z)\bar{\chi}^{\widehat{\mathfrak{su}(2)}_1}_0({\tau})
  +\bar{\chi}^{\widehat{\mathfrak{u}(1)}_2}_1({\tau};z)\bar{\chi}^{\widehat{\mathfrak{su}(2)}_1}_1({\tau})
  \label{u2-decomp}
\end{equation}
where 
\begin{equation}
    \bar{\chi}^{\widehat{\mathfrak{u}(1)}_2}_\lambda({\tau};z) :=\frac{1}{\overline{\eta({\tau})}}\sum_{n\in\mathbb{Z}}\bar{q}^{(n+\lambda/2)^2+(2n+\lambda)\bar{z}}.
\end{equation}
The characters (\ref{SU21-chars}) transform as a dimension 2 complex representation of $SL(2,\mathbb{Z})$, up to an overall multiplier system related to the gravitational anomaly. The $S$ and $T$ elements are represented by the following matrices:
\begin{equation}
    S=\left(\begin{array}{cc}
    1 & 1 \\
    1 & -1
    \end{array}\right),\qquad
        T=e^{\frac{\pi i}{12}}\left(\begin{array}{cc}
    1 & 0 \\
    0 & i
    \end{array}\right).
\end{equation}
The left hand side of (\ref{u2-decomp}) is a modular function (again, with a multiplier system) under the index 3  subgroup $\langle S,T^2\rangle\subset SL(2,\mathbb{Z})$ generated by $S$ and $T^2$. This is expected because $U(2)$ is self-dual, and on a non-spin manifold the $U(2)$ theory is only invariant under the shift of the theta-angle by $4\pi$. From the 2d point of view $\langle S,T^2\rangle$ is the subgroup of $SL(2,\mathbb{Z})$ preserving the antiperiodic-antiperiodic spin structure on $T^2$. 
This is the spin structure for which the character (\ref{u2-char}) is the partition function of $\widehat{\mathfrak{u}(2)}_1$ chiral WZW, which should be considered as a spin theory. Note that the matrices $S$ and $T^2$ transforming the characters of $\widehat{\mathfrak{su}(2)}_1$, or equivalently $\widehat{\mathfrak{u}(1)}_2$, happen to be real (up to an overall phase), so the representation is self-conjugate. In particular this means that formally one could also take instead a linear combination
\begin{equation} {\chi}^{\widehat{\mathfrak{u}(1)}_2}_0(\tau;z)\bar\chi^{\widehat{\mathfrak{su}(2)}_1}_0({\tau}) +\chi^{\widehat{\mathfrak{u}(1)}_2}_1(\tau;z)\bar\chi^{\widehat{\mathfrak{su}(2)}_1}_1({\tau})
  \label{u2-decomp-alt}
\end{equation}
to achieve the same effect, that is to produce an $\langle S,T^2\rangle$ Jacobi modular function (with a different multiplier system). Therefore there is no contradiction with the discussion in Section \ref{sec:hol-anomaly}. 

As an aside we note that if one considers periodic-periodic spin structure instead, the partition function of the chiral $\widehat{\mathfrak{u}(2)}_1$ WZW reads
\begin{equation}
   \bar\chi^{\widehat{\mathfrak{u}(2)}_1}_{1,1}({\tau};z) =\frac{1}{\overline{\eta({\tau})}^2}\sum_{n\in\mathbb{Z}^2}(-1)^{n_1+n_2+1}\bar{q}^{\frac{(n_1+1/2)^2+(n_2+1/2)^2}{2}+(n_1+n_2+1)\bar{z}}=\left(\frac{\overline{\vartheta_1(z;{\tau})}}{\overline{\eta({\tau})}}\right)^2.
\end{equation}
It is modular function of the full $SL(2,\mathbb{Z})$ group, since it preserves the unique odd spin structure. From the 4d point of view the diagonal of $U(2)$ gauge group is replaced by a $\text{Spin}^c$ structure, which results in half-integer shifts of the fluxes on the non-spin manifold $\mathbb{CP}^2$. This corresponds to Freed-Witten anomaly in string/M-theory setting. The character decomposition in this case reads
\begin{equation}
  \bar\chi^{\widehat{\mathfrak{u}(2)}_1}_{1,1}({\tau};z)=
    \bar\chi^{\widehat{\mathfrak{u}(1)}_2}_0({\tau};z)\bar\chi^{\widehat{\mathfrak{su}(2)}_1}_1({\tau})
  -\bar\chi^{\widehat{\mathfrak{u}(1)}_2}_1({\tau};z)\bar\chi^{\widehat{\mathfrak{su}(2)}_1}_0({\tau}).
\end{equation}

\section{Closed Forms}

\subsection{Closed 3-forms on $\mathbb{R}^4\setminus \{0\}$}
\label{app:3-forms}
Let $v^i,i=0,\ldots,3$ be the standard coordinates on $\mathbb{R}^4$. It is easy to see that the 3-form
\begin{equation}
\omega_3:=\frac{v^0dv^1dv^2dv^3-v^1dv^2dv^3dv^0+v^2dv^3dv^0dv^1-v^3dv^0dv^1dv^2}{2\pi^2\ \lVert v \rVert^2} \;\in\;\Omega^{3}(\mathbb{R}^4\setminus \{0\})
\end{equation}
is closed, $SO(4)$ invariant and normalized such that
\begin{equation}
\int_{\Sigma^3}\omega_3=1
\end{equation}
for any 3-cycle $\Sigma_3$ which represents the generator of $H_3(\mathbb{R}^4\setminus \{0\},\mathbb{Z})\cong \Z$, in particular for  a round 3-sphere centered at the origin. Thus, $\omega_3$,  can be understood as the pullback of the standard volume form (with unit volume) on $S^3$ with respect to the homotopy equivalence
\begin{equation}
\begin{array}{rcl}
 \mathbb{R}^4\setminus \{0\} & \longrightarrow & S^3, \\
 v & \longmapsto &{v}/{\lVert v \rVert} \, .
 \end{array}
\end{equation}
Under the change of variables
\bea
u^{11} & =  v^2+iv^3 \qquad\qquad 
u^{22} & =  v^2-iv^3 \nonumber\\
u^{12} & =  v^0+iv^1 \qquad\qquad 
u^{21} & =  -v^0+iv^1
\eea
the 3-form above becomes 
\begin{equation}
\omega_3=\frac{u^{11}du^{22}du^{12}du^{21}-u^{22}du^{12}du^{21}du^{11}+u^{12}du^{21}du^{11}du^{22}-u^{21}du^{11}du^{22}du^{12}}{2\pi^2|u|^2} 
\end{equation}
where $|u|^2:=\epsilon_{AB}\epsilon_{\dot{A}\dot{B}}u^{A\dot{A}}u^{B\dot{B}}=2(u^{11}u^{22}-u^{12}u^{21})$. Let
\begin{equation}
\zeta_3 := \frac{(u^{12}du^{11}-u^{11}du^{12})du^{22}du^{21}}{|u|^4}\; \in \Omega^3(\mathbb{R}^4\setminus \{0\}),
\end{equation}
and
\begin{equation}
\tilde\zeta_3 := \frac{(u^{21}du^{11}-u^{11}du^{21})du^{12}du^{22}}{|u|^4}\; \in \Omega^3(\mathbb{R}^4\setminus \{0\}).
\end{equation}
It is easy to see that these 3-forms are also closed and, moreover,
\begin{equation}
\begin{array}{rl}
\zeta_3 & = \pi^2\omega_3 + d(\ldots),\\
\tilde\zeta_3 & = \pi^2 \omega_3 + d(\ldots),
\end{array}
\end{equation}
that is $\int_{\Sigma^3} \zeta_3=\int_{\Sigma^3} \tilde\zeta_3=\pi^2$ any 3-cycle $\Sigma_3$ which generates $H_3(\mathbb{R}^4\setminus \{0\},\mathbb{Z})\cong \Z$. 


\subsection{The Euler Angular Form  $\eta_{4}$ \label{sec:Closed}}


We now verify explicitly that the Euler angular form $\eta_{4}$  is closed  when the background R-symmetry connection is turned on only for a subgroup $Spin(2)\subset Spin(5)$ relevant for the topological twisting on K\"ahler 4-manifolds. 
One can assume that $Spin(2)$ corresponds to rotations in the 4-5 plane and substitute  $A^{45}=-A^{54}$ and $A^{ab}=0$ otherwise in (\ref{eta4-form}) to obtain
\begin{multline}
    \eta_4=\frac{4!}{64\pi^2}\left\{
    Z^1dZ^2dZ^3DZ^4DZ^5+Z^2dZ^3DZ^4DZ^5dZ^1+\ldots+
    Z^5dZ^1dZ^2dZ^3DZ^4
    \right.
    \\
    \left.
    -\frac{1}{3}dA(Z^1dZ^2dZ^3+
    Z^2dZ^3dZ^1+Z^3dZ^2dZ^1)
    \right\}.
\end{multline}
Let
\begin{equation} \omega_{4}:=\frac{1}{64\pi^2}\epsilon_{a_1a_2a_3a_4a_5}Z^{a_1}dZ^{a_2}dZ^{a_3}dZ^{a_4}dZ^{a_5}
\end{equation}
be the pullback of the standard volume form on $S^4$ normalized such that $\int_{S^4}\omega_{4}=1$. Using $DZ^4DZ^5=dZ^4dZ^5-A(Z^4dZ^4+Z^5dZ^5)$ and $\sum_{i=1}^5(Z^i)^2=1$ we have
\begin{multline}
    \eta_4=\omega_{4}+\frac{4!}{64\pi^2}\left\{
    -A(Z^4dZ^4+Z^5dZ^5)(Z^1dZ^2dZ^3+Z^2dZ^3dZ^1+Z^3dZ^1dZ^2)\right.\\
    +A((Z^4)^2+(Z^5)^2)dZ^1dZ^2dZ^3
    \\
    \left.
    -\frac{1}{3}dA(Z^1dZ^2dZ^3
    Z^2dZ^3dZ^1+Z^3dZ^2dZ^1)
    \right\}\\
   = \omega_{4}+\frac{4!}{64\pi^2}\left\{
 A(Z^1dZ^1+Z^2dZ^2+Z^3dZ^3)(Z^1dZ^2dZ^3+Z^2dZ^3dZ^1+Z^3dZ^1dZ^2)\right.\\
   + A(1-(Z^1)^2-(Z^2)^2-(Z^3)^2)dZ^1dZ^2dZ^3
    \\
    \left.
    -\frac{1}{3}dA(Z^1dZ^2dZ^3+
    Z^2dZ^3dZ^1+Z^3dZ^2dZ^1)
    \right\}\\
    =\omega_{4}+\frac{4!}{64\pi^2}\left\{
    AdZ^1dZ^2dZ^3-
    \frac{1}{3}dA(Z^1dZ^2dZ^3+
    Z^2dZ^3dZ^1+Z^3dZ^2dZ^1)\right\}
\\
=\omega_{4}-\frac{1}{8\pi^2}d\left\{
    A\left(Z^1dZ^2dZ^3+
    Z^2dZ^3dZ^1+Z^3dZ^2dZ^1\right)
    \right\}
\end{multline}
from which it follows that $d\eta_4=0$.

\bibliographystyle{JHEP}
\bibliography{cp2}

\end{document}
========================================

\documentclass[11pt,a4paper]{article}
\usepackage{jheppub,amsmath,  amssymb,slashed,url,bm,textgreek,upgreek}
\usepackage{graphicx}
\usepackage{epstopdf}
\def\t{{ \sf t}} 
%% \stackrel{j}{\to}
\def\kk{k}
\def\star{\diamond}
\def\eO{{\eusm O}}
\def\phif{f}
\def\J{\mathcal J}
\def\neg{\negthinspace}
\def\a{a}
\def\dzzt{\D(\t z,z|\theta)}
\def\dzztt{\D(\t z,z|\t\theta,\theta)}
\def\ggamma{\Gamma}
\def\Stt{\h S}
\def\Res{{\mathrm {R}}}
\def\SoS{{\mathrm S}}
\def\ds{{\mathrm{ds}}}
\def\sD{\text{{\sf D}}}
\def\aalpha{\alpha}
\def\FF{{\eusm  F}}
\def\ct{{\cmmib t}}
\def\JJ{{\eusm J}}
\def\s{{s}}
\def\ii{i}
\def\RR{{\mathcal R}}
\def\BB{\bm B}
\def\uu{u}
\def\piGSO{{\Pi_{\mathrm{GSO}}}}
\def\tpiGSO{\t{\Pi}_{\mathrm{GSO}}}
\def\UUU{\varPhi}
\def\SSigma{{\varTheta}}
\def\Stigma{{\varSigma}}
\def\btheta{{\bm \theta}}
\def\mm{{\bm m}}
\def\zzeta{{\bm \zeta}}
\def\zizeta{\zeta}
\def\v{{\eurm v}}
\def\fD{ \eusm D}
\def\udelta{{\underline\delta}}
\def\u{{\eurm u}}
\def\UU{U}
\def\p{{\eurm p}}
\def\sp{{\eurm p}}
\def\SoS{{\eurm S}}
\def\VV{{\eusm V}}
\def\ZoZ{{\eusm Z}}
\def\z{{\mathbf z}}
\def\c{{\eurm c}}
\def\w{{\eurm w}}
\def\Chi{\chi}
\def\g{\text{{\teneurm g}}}
\def\sg{\text{{\eighteurm g}}}
\def\ssg{\text{{\seveneurm g}}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bt{{{t}}}
\def\XX{{\mathcal Y}}
\def\NS{{\mathrm {NS}}}
\def\Ra{{\mathrm R}}
\def\Ber{{\mathrm{Ber}}}
\def\BBer{{\textit{Ber}}}
\def\X{{\eusm X}}
\def\Re{{\mathrm{Re}}}
\def\Im{{\mathrm{Im}}}
\def\hat{\widehat}
\def\eff{{\mathrm{eff}}}
\def\tilde{\widetilde}
\def\fN{{\mathfrak N}}
\def\frak{\mathfrak}
\def\h{\widehat}
\def\n{\text{{\teneurm n}}}
\def\sn{\text{{\eighteurm n}}}
\def\ssn{\text{{\seveneurm n}}}
%\def\n{{\eurm n}}
\def\q{{\mathrm q}}
\def\y{{\mathrm y}}
\def\dd{{\eurm q}}
\def\D{{\mathcal D}}
\def\S{{\mathcal S}}
\def\SIgma{\Sigma}
\def\YY{{\eusm Y}}
\def\V{{\mathcal V}}
\def\O{{\mathcal O}}
\def\k{{\cmmib k}}
\def\Bbb{\mathbb}
\def\gh{{\mathrm{gh}}}
\def\red{{\mathrm{red}}}
\def\A{{\mathcal A}}
\def\d{{\mathrm d}}
\def\tW{{W}}
\def\intt{{\mathrm{int}}}
\def\b{\overline}
\def\R{{\mathbb R}}
\def\C{{\mathbb C}}
\def\U{{\mathcal U}}
\def\D{{\mathcal D}}
\def\[{\bigl [}
\def\]{\bigr ]}
\def\SS{{\mathfrak S}}
\def\CP{{\mathbb{CP}}}
\def\N{{\mathcal N}}
\def\T{{\mathcal T}}
\def\F{{\mathcal F}}
\def\tr{{\mathrm {tr}}}
\def\Z{{\mathbb Z}}
\def\ZZ{{\mathcal Z}}
\def\sQ{{\sf Q}_{\sf B}}
\def\Q{{\mathbb Q}}
\def\QQ{{\mathcal Q}}
\def\CC{{\mathcal C}}
\def\ad{{\mathrm{ad}}}
\def\r{{\mathrm{tr}}}
\def\Btriv{{\mathcal B}_{\mathrm{triv}}}
\def\L{{\mathcal  L}}
\def\t{\widetilde }
\def\h{\widehat}
\def\Bcc{{\mathcal B_{\mathrm{cc}}}}
\def\K{{\mathcal K}}
\def\V{{\mathcal V}}
\def\I{{\mathcal I}}
\def\G{{\mathcal G}}
\def\B{{\mathcal B}}
\def\Boper{{\mathcal B_{\mathrm{oper}}}}
\def\M{{\mathcal M}}
\def\sM{s\mathcal M}
\def\MM{{\mathfrak M}}
\def\eusmm{{\MM_{\sg,\sn_\NS,\sn_\Ra}}}
\def\W{{\mathcal W}}
\def\P{{\mathcal P}}
\def\l{\langle}
\def\Ra{{\mathrm{R}}}
\def\r{\rangle}
\def\lc{{\mathrm{lc}}}
\def\H{{\mathcal H}}
\def\cZ{\mathcal Z}
\def\tphi{\text{\textphi}}
\def\trho{\text{\textmu}}
\def\sW{{ W}}
\def\ca{{\cmmib a}}
\def\ss{{d}}
\def\st{{\mathrm{st}}}
\def\spin{{\mathrm{spin}}}
\def\m{\cmmib m}
\def\tilde{\widetilde}
\def\sing{{\mathrm{sing}}}
\def\bar{\overline}
\def\DD{{\mathfrak D}}
\def\neg{\negthinspace}
\def\gst{g_{\mathrm{st}}}
\def\Ber{{\mathrm {Ber}}}
\def\Diff{{\eusm D}}
\def\Y{{\eusm Y}}
\font\teneurm=eurm10 \font\seveneurm=eurm7 \font\eighteurm=eurm8 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
\font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}
\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}

\title{Superstring Perturbation Theory Via Super Riemann Surfaces: An Overview\footnote{The arXiv version of this article was originally entitled ``More on
Superstring Perturbation Theory.''}}



 \author{Edward Witten}
\affiliation{School of Natural Sciences, Institute for Advanced Study,\\ 1 Einstein Drive, Princeton, NJ 08540 USA}
%\emailAdd{author@inst.edu}
\abstract{  This article is devoted to an overview of superstring perturbation theory from the point of view of super Riemann surfaces. 
We aim to elucidate some of the subtleties of superstring perturbation that caused difficulty in the early literature, 
 focusing on a concrete example -- the $SO(32)$ heterotic string compactified on a  Calabi-Yau
manifold, with the spin connection embedded in the gauge group.  This model is known to be a significant
test case for superstring perturbation theory. Supersymmetry is spontaneously broken at 1-loop order, and to treat correctly the 
supersymmetry-breaking effects that arise at 1- and 2-loop order requires a precise formulation of the procedure for integration
over supermoduli space.  In this paper, we aim as much as possible for an informal explanation, though at some points we provide
more detailed explanations that can be omitted on first reading.}

\begin{document}\maketitle

\section{Introduction}\label{intro} 


String perturbation theory is based on a generalization from point particles and Feynman graphs to strings and Riemann surfaces.  
It has the remarkable property of preserving the general properties of relativistic quantum field theory, while eliminating the ultraviolet
region and forcing the inclusion of gravity.  For historical references, see \cite{Birth}.

The generalization from bosonic string theory to superstrings eliminates  infrared instabilities and leads to a theory with
a well-behaved perturbation theory, describing quantum gravity unified with other fields and forces.   

The basic foundations of superstring
perturbation theory -- including superconformal symmetry, modular invariance, worldsheet anomaly cancellation, and fermion vertex
operators -- were all well established by the mid-1980's.  
Roughly speaking, to complete that story in a natural way only requires a couple of steps:

{\it (A)} One should formulate all essential arguments, and especially those that involve integration by parts, 
on the moduli space of super Riemann surfaces, and not on the moduli space  of ordinary Riemann surfaces.

{\it (B)} One needs a careful treatment of integrals that are only conditionally convergent in the infrared region. 
The supersymmetric version of the Deligne-Mumford compactification of moduli space provides a natural infrared regulator.

To explain these points in the abstract can be rather dry, and, if one chooses to fill in details, also long \cite{Revisited}.
The purpose of this paper\footnote{The article is based on a lecture presented at the conference {\it The Search For 
Fundamental Physics:
Higgs Bosons And Supersymmetry}, in honor of Michael Dine and Howard Haber 
(University of California at Santa Cruz,
January 4-6, 2013).}  is to give a more informal explanation in the context of a model -- or more precisely a class of models --
 that is  known to give a significant test case
for superstring perturbation theory.  In the most basic case, we consider the $SO(32)$ heterotic string 
compactified on a Calabi-Yau
threefold, with the spin connection embedded in the gauge group in the standard fashion; this was first studied in \cite{DIS,ADS},
with subsequent work in \cite{GrSe,AS,DD}, following an earlier analysis of the associated effective field theory \cite{DSW}.  
This example
is a prototype for a large class of heterotic string compactifications to four dimensions that are supersymmetric at tree level but
have an anomalous $U(1)$ gauge field.  
 The loop corrections
that cancel the anomaly also trigger the spontaneous breaking of supersymmetry, giving 
 the only known method of supersymmetry breakdown by loop effects in superstring perturbation theory.
Such models turn out to  provide an important test case for arguments that claim
to show why supersymmetry is valid in loops.  Oversimplified arguments can easily give the wrong answer
when applied to these models. 

In analyzing this class of models, we will treat three topics:
\begin{enumerate}
\item the mass splitting between bosons and fermions that arises at one-loop order;
\item the vacuum energy that arises at two-loop order;
\item
 the mechanism by which a Goldstone fermion appears in supersymmetric Ward identities, signaling the spontaneous
breakdown of supersymmetry.\end{enumerate}

The three points are treated respectively in sections \ref{mass}, \ref{dilaton}, and \ref{supersym}.
In section \ref{mass}, we begin by summarizing the insights of the original papers \cite{DIS,ADS,GrSe,AS,DSW}.
Then we go on and explain how this example illustrates a general procedure
to regularize conditionally convergent integrals in superstring perturbation theory.  
In section \ref{dilaton}, we show that the two-loop vacuum energy in the same model can be understood by the same
methods.  In section \ref{supersym}, we first explain the general formulation of a supersymmetric Ward identity in superstring
perturbation theory, along the lines of section 8 of \cite{Revisited},
 and then implement this in detail at the one-loop level in our illustrative class of models, showing the appearance of a Goldstone
 fermion contribution. 

We aim in this paper for an informal explanation, though sections \ref{dilaton} and \ref{supersym} both have concluding
sections with technical details.  
The reader who works through the present paper -- or even most of it, without the more technical  parts --
should emerge with a fairly clear picture of some of the points that caused difficulty in the literature of the 1980's on superstring
perturbation theory.  
  Among other things, it should become clear  that the  phenomena are best described in 
terms of the full set of
bosonic and fermionic variables. 

The short version of this paper consists of section 2, which suffices for an overview of many of the ideas.
The mid-length version consists of omitting the technical sections \ref{details} and \ref{goldstonefermion}.


The models considered here, since they do have a dilaton tadpole at two-loop order,
are not models in which superstring perturbation theory works to all orders, at least not in its usual form.   But they illustrate some  essential subtleties
of superstring perturbation theory in a particularly simple way.  Once one understands these subtleties,
one is well-placed to demonstrate that superstring
perturbation theory works to all orders in those models in which tadpoles and supersymmetry-breaking effects do not arise.

A procedure to generalize superstring perturbation theory to describe vacuum shifts that are necessary when tadpoles appear has been developed recently
\cite{ASen}.  (This procedure can certainly be restated in terms of super Riemann surfaces, though this has not yet been done.)  We do not consider such issues here.
Our goal is only to explain how ``integration over moduli space'' when implemented in the superworld resolves various issues that caused confusion in the literature of the 1980's.


\section{The Mass Splitting}\label{mass}

\subsection{Review Of Effective Field Theory}\label{effreview}

We begin by reviewing the models of interest in the context of effective field theory \cite{DSW}.
We consider compactification of the heterotic string to four dimensions on a 
Calabi-Yau three-fold
$\XX$, with the $SU(3)$ holonomy group embedded in the gauge group in the usual fashion.    In the case of the 
$E_8\times E_8$ heterotic
string, the embedding identifies the $SU(3)$ holonomy group with the first factor of the subgroup
$SU(3)\times E_6\times E_8\subset E_8\times E_8$.  The unbroken subgroup in four dimensions
is $E_6\times E_8$.  With minor modifications, this construction leads to semirealistic models of
particle physics.

We will consider instead the same construction in the $SO(32)$ (or more precisely $\mathrm{Spin}(32)/\Z_2$)
heterotic string.  In this case, the relevant subgroup is $SU(3)\times U(1)\times SO(26)\subset SO(32)$, and the unbroken
subgroup is $U(1)\times SO(26)$.   Generically, this $U(1)$ is anomalous.  For
example, there is a $U(1)\cdot SO(26)^2$ anomaly with a coefficient that is a multiple of the Euler characteristic of $\XX$.  
The anomaly leads to the issues examined in this paper.  
Such anomalous $U(1)$'s frequently arise in supersymmetric compactifications of the heterotic string, including 
semirealistic ones.  The models that we have described illustrate the relevant issues in a simple context.

In string theory, the anomaly is canceled by the Green-Schwarz mechanism.  This depends upon the fact that
at one-loop order, Green-Schwarz interactions such as $I=\frac{1}{2\cdot 4!(2\pi)^5}\int_{\R^4\times \XX} B\wedge \tr\,F^4$ are generated.
Here $B$ is the usual two-form field of the Neveu-Schwarz sector, $F$ is the $SO(32)$ gauge field strength,
$\R^4\times \XX$ is the ten-dimensional spacetime, and the trace is taken in the fundamental representation of 
$SO(32)$.  Assuming that \begin{equation}\label{volf}p=\frac{1}{48\pi^3}\int_\XX\tr_{SU(3)}\,F^3\end{equation}
 is nonzero (this integral is one-half  the Euler characteristic of
$\XX$), the interaction $I$ reduces in four dimensions to $I_4=(p/(2\pi)^2)\int_{\R^4}B\wedge F$, where
henceforth $F$  is the field strength of the anomalous
$U(1)$.  

The effect of the interaction $I_4$ is to cause the $U(1)$ photon, which we will call
$A$, to become massive.  To understand this mass generation in a possibly more familiar way,
we can dualize the purely four-dimensional part of $B$ to a periodic 
spin-zero field $a$.  The $B\wedge F$ interaction
dualizes to $\partial_\mu a\cdot A^\mu$.  This means that including one- and two-loop effects the kinetic
energy of $a$ is not $\partial_\mu a\partial^\mu a$, but
\begin{equation}\label{zelbo} D_\mu a\cdot D^\mu a =(\partial_\mu a+pA_\mu)(\partial^\mu a+pA^\mu). \end{equation}
Accordingly, the field $a$ is not gauge-invariant; a gauge transformation $A_\mu\to A_\mu-\partial_\mu s$ must be accompanied
by $a\to a+ps$, and the field $e^{ia}$ has charge $p$.



From the standpoint of spacetime supersymmetry, the field $a$ is the imaginary part of a chiral multiplet
\begin{equation}\label{elbo} S(x^\mu|\theta^\alpha)=e^{-2\phi}-ia+\theta^\alpha \kappa_\alpha+\dots,\end{equation}
where the four-dimensional string coupling constant is $g_\st=e^\phi$;  we write 
$x^\mu, \,\mu=0,\dots,3$ and $\theta^\alpha$,
 $\alpha=1,2$ for bose and fermi coordinates
of chiral superspace; and $\kappa_\alpha$ is a fermi field of spin $1/2$.  $Z=e^{-S}$ is a charged chiral multiplet of $U(1)$
charge $p$.   We call $\phi$ and $\kappa$ the dilaton and dilatino.
There is no way to make $S$ or $Z$ vanish in the context of superstring perturbation theory, so inevitably
the $U(1)$ gauge symmetry is spontaneously broken.  
 
This symmetry-breaking mechanism has the important and unusual property
that in perturbation theory, though $U(1)$
is spontaneously broken as a gauge symmetry, it survives as a global symmetry.  The reason  is that
an amplitude that violates the global $U(1)$ conservation law would arise from a term in the effective
action that is proportional to a nonzero power of the charged field $e^{ia}$.  Such terms are not generated
in perturbation theory, because in perturbation theory, $a$ decouples at zero momentum.   At the nonperturbative
level, the global $U(1)$ symmetry is broken (at least down to a subgroup of finite order) by spacetime
instanton effects.  For a recent analysis, see \cite{DiM}.

This mechanism of $U(1)$ gauge symmetry breaking also leads to spontaneous breaking of supersymmetry.
Indeed, the vector multiplet that contains the $U(1)$ gauge field $A$ also
contains an auxiliary field $D$.  The expectation value of $D$ receives a contribution from the
expectation value of $S$ (or $Z$) as well as from the massless charged chiral multiplets 
$\varrho_a=\rho_\a+\theta^\alpha\psi_{a\,\alpha}+\dots$ that
arise in the four-dimensional expansion of the ten-dimensional $SO(32)$ vector multiplet.    The potential
energy of the theory has a contribution  
\begin{equation}\label{imoxip} \frac{D^2}{2g_\st^2},\end{equation}
where
\begin{equation}\label{mimoxip} D= \frac{p}{\mathrm {Re}\, S}+\sum_\a e_\a |\rho_\a|^2=pg_\st^2
+\sum_\a e_\a |\rho_\a|^2.\end{equation}
(Here $e_\a$ is the $U(1)$ charge of the chiral multiplet $\varrho_\a$, which is normalized so that its kinetic energy is canonical.)  As explained in \cite{DSW}, the dependence of $D$ on $S$ follows entirely from the dilaton Kahler
potential $K=-\log (\mathrm{Re}\,S)$ and the fact that a $U(1)$ gauge transformation $A_\mu\to A_\mu+\partial_\mu s$
transforms $S$ to $S-ips$.  Thus, the expectation value of $D$ is of order $g_\st^2$ relative to the classical
contribution $\sum_\a e_\a |\rho_\a|^2$, and this effect must arise at one-loop order. This should come as no 
surprise, since the contribution of the
multiplet $S$ to $D$ is related by supersymmetry to the Green-Schwarz interaction that triggers $U(1)$ breaking.
  Since the expectation value of $D$ is a one-loop effect, the resulting contribution to the vacuum energy (or dilaton tadpole)
 $D^2/2g_\st^2$ will have to arise in two-loop order.    How this happens was investigated in the 1980's
 \cite{DIS,ADS,AS,GrSe} and will be further explored in the rest of this paper.

Models such as we have described  are the only known superstring models in which 
supersymmetry is spontaneously broken in perturbation theory despite being unbroken at tree level. 
That makes them an interesting test
case for superstring perturbation theory.  Oversimplified treatments of superstring perturbation theory
tend to predict that the behavior seen in models of this class is impossible.

\subsubsection{Two Classes Of Vacua}\label{shifting}

The statement that supersymmetry breaks down in perturbation theory in these models refers specifically to
  the vacua with $\rho_\a=0$.  In these vacua, the global $U(1)$ symmetry is 
  conserved in perturbation theory, but supersymmetry is expected
to break down.    Alternatively, we could give expectation values of order $g_\st$ to the 
$\rho_\a$, so as to make $D$ vanish
even though $S\not=0$.   Then the global $U(1)$ symmetry is violated perturbatively,
but supersymmetry is maintained.  One expects that such a vacuum will lead to a stable perturbation theory,
with the 
property -- unusual among supersymmetric models --  that perturbative stability of the vacuum depends on a cancellation between effects of different orders in perturbation theory,
as discussed qualitatively in \cite{FS}.  

Tools to analyze superstring perturbation theory in such a situation have
been developed recently \cite{ASen} (this work was expressed in the language of picture-changing operators, though we anticipate that it can be straightforwardly expressed in terms of super Riemann
surfaces).  The analysis in \cite{Revisited} was limited to more straightforward models
(supersymmetric compactifications above four dimensions and four-dimensional ones
without anomalous $U(1)$'s) in which 
effective field theory predicts that supersymmetry is maintained in perturbation
theory without shifting the values of massless fields.   Even then, superstring perturbation theory involves
subtleties that caused some difficulty in the 1980's.  We will gain experience with those subtleties in the present
paper by studying a class of models in which supersymmetry-breaking effects (requiring a shift in the vacuum to maintain supersymmetry)  {\it do} arise in perturbation theory.  
In these models, the subtleties of superstring perturbation theory arise in low orders in a particularly visible way.

\subsection{A First Look At The Mass Splitting}\label{took}

Following \cite{DIS,ADS}, we will now take a first look at the one-loop mass splittings of charged chiral multiplets.   We write 
$x^\mu$, $\mu=1,\dots,4$ for coordinates on $\R^4$,  and $y^i$, $y^{\bar i}$, $i,\bar i=1,\dots,3$ for local holomorphic and antiholomorphic
coordinates on the Calabi-Yau manifold $\XX$.  Similarly, we denote the right-moving RNS worldsheet fermions as $\psi^\mu$,
$\psi^i$, and $\psi^{\bar i}$.  The $SO(32)$ current algebra of the heterotic string is carried by 32 left-moving fermions in the
vector representation of $SO(32)$.  Upon making the embedding $U(1)\times SU(3)\times SO(26)\subset SO(32)$, 
the left-moving fermions  transform as 
$(\mathbf{3},\mathbf{1})^{\mathbf 1}\oplus (\bar{\mathbf{3}},\mathbf{1})^{\mathbf{-1}}\oplus (\mathbf 1,\mathbf{26})^{\mathbf 0}$, where the exponent
is the $U(1)$ charge.
We denote these components respectively as $\lambda^i$, $\lambda^{\bar i}$, $i=1,\dots,3$, and $\lambda^T$, $T=1,\dots,26$.
Massless  charged chiral multiplets arise in four dimensions from the Kaluza-Klein expansion of the ten-dimensional 
gauge field $A$.  The relevant ansatz, suppressing $SO(32)$ indices, is
\begin{equation}\label{zongo}A_{\bar i}(x;y)=\sum_{a} \rho_a(x) w_{a\, \bar i}(y)+\dots,\end{equation}
where $a$ runs over the set of chiral multiplets,
$w_{a\,\bar i}(y)$ is for each $a$ a harmonic $(0,1)$-form on $\XX$ (valued in the $SO(32)$ bundle),  and $\rho_a(x)$ is a massless scalar field in 
spacetime, part of a chiral supermultiplet $\varrho_a=\rho_a+\theta^\alpha \chi_{a,\alpha}+\dots.$  We
write $\bar\varrho_a=\bar\rho_a+\bar \theta^{\dot\alpha}\bar\chi_{a\,\dot\alpha}+\dots$ for the conjugate antichiral multiplet.

We consider the case that the supermultiplet $\varrho_a$ has a nonzero $U(1)$ charge $e_a$.  In this case, a one-loop
$D$-term will generate a $\bar\rho_a\rho_a$ coupling.  If such a term is generated, it will represent a mass splitting for
bosons and fermions in the $\varrho_a$ multiplet, since no corresponding mass term is possible for the fermions.
(A $\bar\chi_a\chi_a$ term is not Lorentz invariant because $\chi_a$ and $\bar\chi_a$ have opposite chirality,
while $\chi_a\chi_a$ or $\bar\chi_a\bar\chi_a$ terms do not conserve the $U(1)$ charge.)  
Our goal is to understand that the one-loop superstring amplitude does generate the $\bar\rho_a\rho_a$ coupling.  

For brevity, we will do this for chiral superfields transforming as ${\bf {26}}^{\mathbf 1}$ under the unbroken $U(1)\times SO(26)$.
Such modes arise from the part of the adjoint representation of $SO(32)$ that transforms under $U(1)\times SU(3)\times SO(26)$
as $(\bf 3,\bf {26})^1$.  For these modes, with $SO(32)$ indices included, the ansatz (\ref{zongo}) becomes
\begin{equation}\label{longo}A_{\bar i\, iT}(x;y)=\sum_a \rho_{a\,T}(x) w_{a,\,\bar i i}(y),~~ T=1,\dots,26.\end{equation}
Here for each $a$, $w_{a\,\bar i i}$ is a harmonic $(1,1)$-form on $\XX$, and now the four-dimensional wavefunction
$\rho_{a,T}$ carries the $SO(26)$ index $T$.  

In the RNS description of the heterotic string, we describe the string worldsheet by even and odd holomorphic local coordinates
$z|\theta$ and an even antiholomorphic local coordinate\footnote{What we call $\t z$ is commonly called $\bar z$, but we prefer
to avoid this notation because identifying $\t z$ as the complex conjugate of $z$ is not invariant under superconformal
transformations of the pair $z|\theta$. It is best to simply think of $\t z$ as a bosonic coordinate that is close to the
complex conjugate of $z$, and to be more precise only when necessary.  In the derivation
below, this will be near $z=\t z=0$.}
 $\t z$.   The map of the string to spacetime is described by superfields $\X^\mu$, $\Y^i$, $\Y^{\bar i}$ which
 have expansions such as $\X^\mu(\t z;\neg z|\theta)=X^\mu(\t z;\neg z)+\theta\psi^\mu(\t z;\neg z)$.  To construct supersymmetric
 expressions, one uses the superspace derivative $D_\theta=\partial_\theta+\theta\partial_z$, and, for example,
 one has
 \begin{equation}\label{ido}D_\theta \X^\mu=\psi^\mu+\theta\partial X^\mu. \end{equation}
 
 A vertex operator for a Neveu-Schwarz state is a superfield $W(\t z;\neg z|\theta)$.
In the case of a mode  $\rho_T$ of momentum $k$  (for brevity we pick a particular multiplet
and suppress the label $a$), the appropriate superfield is
\begin{equation}\label{urkey}W_{T,k}(\t z;\neg z|\theta)=\exp(ik\cdot \X)\Lambda_T\Lambda^i
w_{i \bar i }(\Y)D_\theta \Y^{\bar i}.\end{equation}
The vertex operator for the conjugate mode $\bar\rho_T$ is similar:
\begin{equation}\label{murkey}\t W_{T,k}(\t z;\neg z|\theta)=\exp(ik\cdot \X)\Lambda_T\Lambda^{\bar i}
w_{\bar i i}(\Y)D_\theta \Y^i.\end{equation}
In these formulas,  $\Lambda_T=\lambda_T+\theta G_T$ is a superfield that reduces to $\lambda_T$ by the equations of motion;
$G_T$ is an auxiliary field that vanishes on-shell.
Similarly 
$\Lambda^i=\lambda^i+\theta G^i$ and $\Lambda^{\bar i}=\lambda^{\bar i}+\theta G^{\bar i}$ are superfields 
that reduce on-shell to $\lambda^i$ and $\lambda^{\bar i}$.

A genus 1 mass shift will be derived from the two-point function 
\begin{equation}\label{kolo} \bigl\langle W_{T,k}(\t z;\neg z|\theta)\t 
W_{T,-k}(\t z';\neg z'|\theta')\bigr\rangle\end{equation}
on a super Riemann surface $\Sigma$ of genus 1.  The effect we are looking for is parity-conserving, so the
relevant case is that $\Sigma$ has an even spin structure.  This means that holomorphically $\Sigma$ can be described, up to isomorphism, by
even and odd coordinates $z|\theta$ with equivalences
\begin{align}\label{mune} z\cong &z+1 \cr
                    \theta  \cong & -\theta\end{align}
and
\begin{align}\label{zune} z\cong & z+\tau \cr
                    \theta\cong & \theta.\end{align}
while antiholomorphically there is a single even coordinate $\t z$ with equivalences                     
\begin{equation}\label{une} \t z\cong \t z+1 \cong \t z+\bar \tau.\end{equation}
Here $\tau$ is a complex modulus. As shown in \cite{DIS,ADS}, this modulus plays no important role in the analysis,
except that one has to integrate over it at the end.  So we can just think of $\tau$ as a complex constant.

A genus 1 super Riemann surface $\Sigma$ with an even spin structure has no odd moduli (until we include punctures).  
So apart from $\tau$, the only parameters in the problem are the positions $\t z;\neg z|\theta$ and $\t z';\neg z'|\theta'$ at which the two
vertex operators are inserted.  Moreover, we can set $z'=\t z'=0$ using the translation symmetry of $\Sigma$.  With an even spin structure,
there is no such translation symmetry for the $\theta$'s.
So finally, the genus 1 mass shift will be derived from the integral
\begin{equation}\label{derfrom}I_{TT'}=\int \d^2z\d\theta\d\theta'\,\langle W_{T,k}(\t z;\neg z|\theta) \,\t W_{T',-k}(0;\neg
0|\theta')\rangle. 
\end{equation}
(Here $\d^2z $ is short for $-i \d\t z\wedge \d z$.)
We can think of this as the integral over the moduli space of super Riemann surfaces of genus 1 with 2 NS punctures
(except that we also need
to integrate over $\tau$ at the end).
It remains just to learn how to perform this integral. 

The traditional approach in superstring perturbation theory is to first integrate over the odd moduli, which in the present
context are $\theta$ and $\theta'$, and then try to perform the bosonic integral. The integral over the odd variables
can be evaluated using 
\begin{equation}\label{izzo}\int \d \theta \,W_{T,k}(\t z;\neg z|\theta)=V_{T,k}(\t z;\neg z),\,\,\int \d\theta\,\t W_{T',-k}(\t z;\neg z|\theta)=
\t V_{T',-k}(\t z;\neg z),\end{equation}
with
\begin{equation}\label{turkey} V_{T,k}=\exp(ik\cdot X) \lambda_T\lambda^i \left(w_{i\bar i }(Y)
\left(\partial_z Y^{\bar i}+i k_\mu\psi^\mu \psi
^{\bar i}\right)+D_j w_{i\bar i}\psi^j\psi^{\bar i}\right)\end{equation} 
and a similar formula for $\t V_{T',-k}$.  (The auxiliary fields have been set to zero by their equations of motion.)
The term proportional to $D_j w_{i\bar i}$ is a sort of $\alpha'$ correction, since the zero-mode wavefunction $w_{i\bar i}$
is nearly constant when $\XX$ is much larger than the string scale.  Our interest here is really in string-loop corrections, not 
$\alpha'$ corrections.  A convenient way to avoid  issues that are not really relevant for our purposes is to consider
the special case that $\XX$ is a Calabi-Yau orbifold\footnote{By such an orbifold, we mean the quotient of a torus $T=\R^6/\Lambda$
(here $\Lambda$ is a lattice in $\R^6$ of maximal rank) by a finite subgroup of $SU(3)\subset SO(6)$, in other words by a finite
group of symmetries of $\Lambda$ that preserves $\N=1$ supersymmetry in four dimensions.} and the chiral multiplet of
interest comes from the untwisted sector, so that $w_{i\bar i}$ is a constant matrix and $D_j w_{i\bar i}=0$.
 This case was analyzed in the present context in \cite{ADS} and suffices to illustrate
the ideas we wish to explore.  We explain in section \ref{alphadetail} why the general case behaves similarly. 


Dropping the $D_jw_{i\bar i}$ term in $V_{T,k}$, the 
integration over the odd moduli  via (\ref{izzo}) leads to the bosonic integral
\begin{align}\label{mizzo}
\int_{\Sigma} \d^2z \left\langle \left. e^{ik\cdot X} \lambda_T\lambda^i w_{i\bar i }(Y)
(\partial_z Y^{\bar i}+i k\cdot\psi \psi
^{\bar i})\right|_{\t z;z} \left. e^{-ik\cdot X} \lambda_{T'}\lambda^{\bar j} w_{\bar jj}(Y)
\left(\partial_zY^{j}-i k\cdot\psi \psi
^j\right)\right|_{0; 0} \right\rangle  . \end{align}
This expression must then be summed over the three even spin structures on 
$\Sigma$ and integrated over $\tau$.

If we drop the terms in the vertex operator that depend explicitly on $\psi$,
the expression (\ref{mizzo}) vanishes after summing over spin structures
(even before integration over $z$).  This is explained in \cite{DIS,ADS}.  If $\psi^i$ and $\psi^{\bar i}$ are treated
as free fields, the claim is true because of the usual GSO cancellation \cite{GOS} 
between spin structures that leads to vanishing of the 1-loop
cosmological constant for superstrings in $\R^{10}$.  If $\XX$ is a Calabi-Yau orbifold, then
its path integral is a sum of contributions 
of different sectors in each of which $\psi^i$ and $\psi^{\bar i}$
are free fields with $SU(3)$-valued twists.  $SU(3)$-valued twists do not disturb the 
GSO cancellation, so the contribution
of each sector to (\ref{mizzo}) vanishes after summing over spin structures if one drops 
the terms that depend explicitly on $\psi$.
In section \ref{alphadetail}, we  explain that the same is true if $\XX$ is a generic Calabi-Yau threefold, rather than an orbifold.

The contribution of the terms in (\ref{mizzo}) that do explicitly depend on the $\psi$'s is proportional to $\langle
k\cdot\psi(\t z;\neg z)k\cdot \psi(0;\neg 0)\rangle$, which in turn is proportional to $k^2$.  Since $k^2$ vanishes on-shell
for the massless scalar fields whose mass renormalization we are exploring, it seems at first sight that these terms are
not relevant.  However, it is shown in \cite{DIS,ADS} that what multiplies $k^2$ is an integral that diverges as $1/k^2$ for $k^2\to 0$,
because of singular behavior near $z=\t z=0$. 
As a result, the $k^2$ factor in the numerator is illusory.

To understand this, we analyze the small $z$ behavior of the integrand in (\ref{mizzo}) using the operator product expansion.  
The worldsheet fields $\psi^\mu$ really are free fields, with leading singularity $\psi^\mu(z)\psi^\nu(0)\sim \eta^{\mu\nu}/z$.  
Other contributions to this OPE are not singular enough to be relevant to what we are about to say.\footnote{Only Lorentz-invariant
operators appearing in the $\psi^\mu(z)\psi^\nu(0)$ OPE can contribute to the integral (\ref{mizzo}).  After the identity operator, the lowest dimension Lorentz-invariant operator
in this channel is $\psi^\lambda\partial_z\psi_\lambda$, of dimension 2.  Its contribution
$\psi^\mu(z)\psi^\nu(0)\sim \dots -(z/4)\eta^{\mu\nu}\psi^\lambda\partial_z\psi_\lambda$ is much too soft near $z=0$ to be relevant
in what follows.  Similar remarks apply for other
OPE's that we consider momentarily.}
Similarly the $SO(26)$ fermions
$\lambda_T$ are free fields with leading singularity $\lambda_T(\t z)\lambda_{T'}(0)\sim \delta_{TT'}/\t z$, and $X^\mu(\t z;\neg z)$
are free fields with leading singularity $\exp(ik\cdot X(\t z;\neg z))\exp(-ik\cdot X(0;\neg 0))\sim |\t z z|^{-k^2}$.  In each of these
cases the less singular terms are not relevant.  The remaining operators whose OPE's we need to understand are
 $\O=w_{i\bar i}\lambda^i\psi^{\bar i}$ and
$\O^*=w_{\bar i i}\lambda^{\bar i}\psi^{ i}$.  These are   primaries of dimension $(1/2,1/2)$ for the left-moving conformal and right-moving superconformal algebras of the sigma-model with target
$\XX$.  To be more precise, $\O$ and $\O^*$ are  respectively chiral and
antichiral  primaries for the $\N=2$ superconformal algebra of this sigma-model.  The $\O\cdot \O^*$ operator 
product expansion is not simple,
since a whole tower of Kaluza-Klein modes on $\XX$ can appear.  However (assuming that $\XX$ is such that compactification on 
$\XX$ preserves
 $\N=1$ supersymmetry and no more), there is just one operator $V_D$ of dimension $(1,1)$  that contributes to this
expansion.
Its contribution is nonsingular:
\begin{equation}\label{inzo}\O(\t z;\neg z)\O^*(0;\neg 0)\sim \dots + V_D(0;\neg 0).\end{equation}
This operator is
\begin{equation}\label{winzo}V_D=J_\ell J_r,\end{equation}
where
\begin{equation}\label{irox} J_\ell =g_{\bar i i}\lambda^{\bar i}\lambda^{ i},~~J_r=g_{\bar i i}\psi^{\bar i}\psi^i,\end{equation}
with $g_{i\bar i}$  the Kahler metric of $\XX$.  $J_\ell$ is the antiholomorphic  current associated to the anomalous
$U(1)$ gauge symmetry whose $D$-term we are investigating, and $J_r$ is the holomorphic current that generates the $U(1)$
subalgebra of the $\N=2$ superconformal algebra.  Because $J_\ell$ and $J_r$ are antiholomorphic and holomorphic conserved
currents, the operator $V_D$ has dimension precisely $(1,1)$, and
the coefficient with which $V_D$ appears in the product (\ref{inzo}) depends only on the $U(1)$ charges of the operator
$\O$ (namely 1 and $-1$).   

The contribution of $V_D$ to our operator product is thus
\begin{equation}\label{zenno}V_{T,k}(\t z;\neg z)\,V_{T',-k}(0;\neg 0)\sim k^2\frac{V_D}{|\t z z|^{1+k^2}}\end{equation}
Since
\begin{equation}\label{enno}\int \d^2z\frac{1}{|\t z z|^{1+k^2}}\sim \frac{2\pi}{k^2}, ~~k^2\to 0,\end{equation}
the explicit factor of $k^2$ in (\ref{zenno}) disappears, and the integrated two-point function comes out to be
\begin{equation}\label{wrenno}2\pi \langle V_D\rangle. \end{equation}  
This gives the expected supersymmetry-violating one-loop mass shift.

Many other operators apart from $V_D$ appear in the $V_{T,k}(\t z;\neg z)\cdot V_{T',-k}(0;\neg 0)$ operator product, but $V_D$ is the
only one whose contribution to the integral has a pole at $k^2=0$.  So it is the only operator that contributes to the mass shift.


It is further shown in \cite{DIS,ADS} that the expectation value $\langle V_D\rangle$ on a torus can be computed 
just in terms of the spectrum of massless  charged chiral multiplets in space-time.  This is analogous to what happens in supersymmetric
field theory, where likewise the one-loop shift in the expectation value of the auxiliary field $D$
comes entirely from the contribution of massless
chiral multiplets.
 In fact, the final integration over $\tau$ that must be performed to complete the computation in string theory
coincides with an analogous Schwinger parameter integration in field theory, with just the one  usual difference.  In string theory,
 modular invariance removes the ultraviolet region of small $\mathrm{Im}\,\tau$, making the effect finite, while the analogous computation in field theory is ultraviolet-divergent.


\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Resonance.pdf}
 \end{center}
\caption{\small The mass shift of a massless particle $\rho$ can be computed slightly off-shell by treating $\rho$ as a resonance
in a scattering amplitude with four external particles. This process is affected by the one-loop mass shift of $\rho$, but now the $\rho$
particle whose mass is shifted is generically off-shell, giving a sound framework for the $k^2/k^2$ computation. }
 \label{resonance}
\end{figure}

One may worry at first whether it is valid to continue away from the mass-shell $k^2=0$
and cancel powers of $k^2$, as assumed in the above calculation. But actually
\cite{DIS,ADS}, one can put all this on a firm foundation by considering a scattering amplitude in which the 
particle $\rho$ appears as  a resonance or
 intermediate state.  Such an amplitude  (fig. \ref{resonance}) is affected by the mass shift of the $\rho$ particle, but now the particle
whose mass is shifted can be slightly off-shell, giving a clear basis for the calculation sketched above.   The
mass shift $\delta m^2$ appears in the perturbative computation of the scattering amplitude as the coefficient of a double pole, because of the usual
expansion
\begin{equation}\label{lummoz}\frac{1}{k^2+\delta m^2}=\frac{1}{k^2}-\frac{1}{k^2}\delta m^2\frac{1}{k^2}+\dots. \end{equation}

In \cite{DIS}, arguments were given for interpreting 
the operator $V_D$ as the vertex operator for the auxiliary field $D$ in the vector multiplet associated
to the anomalous $U(1)$ gauge field.  There is not a systematic theory of correlation functions with insertions of vertex operators
for auxiliary fields (as opposed to vertex operators associated to physical states).  However, $V_D$ does appear in a number of
interesting calculations, including the two-loop vacuum energy, which we explore in section \ref{dilaton}.

.  


\subsection{More On The Mass Splitting}\label{moresplit}

Now we will explain an alternative perspective \cite{GrSe} on the same calculation. In this approach, we set the momentum
$k$ to zero from the beginning.  The vertex operators thus reduce to
\begin{equation}\label{lurkey}W_{T}(\t z;\neg z|\theta)=\Lambda_T\Lambda^i
w_{i \bar i }(\Y)D_\theta \Y^{\bar i}\end{equation}
and
\begin{equation}\label{wurkey}\t W_{T}(\t z;\neg z|\theta)=\Lambda_T\Lambda^{\bar i}
w_{\bar i i}(\Y)D_\theta \Y^i\end{equation}
and the mass shift is supposed to be computed from
\begin{equation}\label{durkey}\int_\SIgma\d^2 z \d\theta\d\theta'\,\langle \W_T(\t z;\neg z|\theta) \t 
W_{T'}(0;\neg 0|\theta')\rangle.\end{equation}


Since we have set $k$ to 0, there will be no $k^2/k^2$ terms.  So
how can we possibly get a nonzero result?

In view of our previous experience, the
 answer must somehow come from the appearance in the $W_T\cdot \t W_{T'}$ operator product of the operator $V_D$.
The relevant operator product coefficient is 
\begin{equation}\label{iodi}W_T(\t z;\neg z|\theta)\cdot \t W_{T'}(0;\neg 0|\theta')\sim 
\frac{\delta_{TT'}V_D(0;\neg 0)}{\t z}+\dots.\end{equation}
Thus we must contemplate the integral
\begin{equation}\label{bodi}\int \d^2z\, \d\theta\,\d\theta'\,\frac{1}{\t z} .\end{equation}
Since we obtained it from the operator product expansion, this is the right form of the integral only near $z=\t z=0$.  When
$\t z$ is not small, the integrand has to be modified to be consistent with the doubly-periodic nature of the torus. See Appendix D
of \cite{Revisited} for more on this, but the details  are not important in what follows.  We need some
sort of cutoff at large $z$ for the following analysis, since otherwise the integral (\ref{bodi}) has a problem at large
$z$ analogous to the problem we will describe at small $z$, but it does not matter if this comes from 
the compactification of the $z$-plane to a torus or from a sharp cutoff $\t z z\leq 1$.  The latter is simpler, so the integral that we will consider 
is\footnote{\label{melbo} Integration
on a supermanifold with boundary is subtle -- see section 3.5 of \cite{Supermanifold} for an introduction.  
To ensure that none of these
subtleties are relevant in what follows, we take the relation between $\t z$ and $z$ to be precisely  
$\t z=\bar z$ near $|z|=1$, and we only
make changes of variables that are trivial near $|z|=1$.  With this procedure, the sharp cutoff at $|z|=1$ produces
equivalent results to compactification of the $z$-plane to a torus. }
\begin{equation}\label{nodi}\J=\int_{\t z z\leq 1}\d^2 z\,\d\theta\,\d\theta'\, \frac{1}{\t z}.\end{equation}

The idea in \cite{GrSe} is that instead of integrating over $\theta$ and $\theta'$ at fixed $\t z $ and $z$, after which we integrate
over $\t z$ and $z$, we should integrate over
$\theta$ and $\theta'$ at fixed values of $\t z$ and $\h z=z-\theta\theta'$, after which we integrate over $\t z$ and $\h z$. 
A heuristic explanation of why this may be the right thing to do is that $\h z$, rather than $z$, is invariant under global supersymmetry
transformations.  In other words, let $z|\theta$ and $z'|\theta'$ be two points on the complex superplane $\C^{1|1}$.  A global
supersymmetry transformation $\delta\theta=\epsilon$, $\delta z=-\epsilon\theta$ (and likewise $\delta\theta'=\epsilon$,
$\delta z'=-\epsilon\theta'$) with constant $\epsilon$ leaves fixed not $z-z'$ but $z-z'-\theta\theta'$.  For $z'=0$,
this reduces to $\h z=z-\theta\theta'$, and this is some indication that $\h z$ may be the right variable to use.
   
The first question that comes to mind concerning this proposal may be 
why it is necessary to specify what is held fixed when we integrate over $\theta$ and $\theta'$.  The reason 
is that the integral in (\ref{nodi})  is a supermanifold analog of what in the bosonic world is a conditionally convergent integral.  
An example of a bosonic integral that is only conditionally convergent is
\begin{equation}\label{tonico} \int_{\bar z z\leq 1} \d^2 z \frac{1}{\bar z^2} .\end{equation}
This integral is not absolutely convergent, since replacing the integrand by its absolute value gives a divergent integral.
However, if we write $z=re^{i\varphi}$ and integrate first over $\varphi$, the integral converges (and in fact vanishes).   
With a different procedure, it may diverge or may converge to a different value.

A corresponding bosonic integral with only a simple pole
\begin{equation}\label{wonico}\int_{\bar z z\leq 1}\d^2z \frac{1}{\bar z}\end{equation}
is absolutely convergent.  This is ensured by the fact that under a scaling $z\to \lambda z$, $\bar
 z\to \bar\lambda \bar z$,
the measure $\d^2z/\bar z$ scales with a positive power of $\lambda$, making the singularity ``soft'' near $z=0$.
An integral -- like that in eqn. (\ref{tonico}) -- that scales as a zero or negative power of $\lambda$ is at most only conditionally convergent.
In a supersymmetric context, the natural scaling of the odd variables is $\theta\to \lambda^{1/2}\theta$, $\theta' \to \lambda^{1/2}\theta'$.
The measures $\d\theta$ and $\d\theta'$ thus scale as $\lambda^{-1/2}$.  
With this scaling, the singularity $\d^2 z\,\d\theta\,\d\theta'/\t z$
is scale-invariant, corresponding to a supersymmetric version of a conditionally convergent integral.  

The following is a  procedure to calculate the integral by keeping fixed $\h z=z-\theta\theta'$, 
rather than $z$, when integrating over the odd variables near $z=0$.
 We define a new coordinate 
\begin{equation}\label{urcott} z^\star=z-h(\t z;\neg z)\theta\theta',\end{equation}
where $h(\t z;\neg z)$ is any smooth function that is 1 in a neighborhood of $z=0$ and 0 in a 
neighborhood of $z=1$.  (The first condition ensures that $z^\star=\h z$ near $z=0$.  The second condition  avoids any subtlety near $|z|=1$, as discussed in footnote \ref{melbo}. 
Alternatively, as explained in Appendix
D of \cite{Revisited} and in section \ref{gluehol} below, if we compactify the $z$-plane to a torus, we need to introduce a function playing the role of $h$ to respect
the double-periodicity of the torus. The fact that the torus has no boundary then ensures that there is no boundary term at large $z$.)  
Our method of defining the conditionally convergent integral is to integrate first over $\theta$ and $\theta'$ keeping fixed
$\t z$ and $z^\star$ rather than $\t z$ and $z$.  

To complete the explanation of how to do the integral, we also need to specify the relationship between the antiholomorphic
variable $\t z$ and the holomorphic variable $z$.  Here instead of the naive relationship $\bar{\t z}=z$, we take
$\bar{\t z}= z^\star$.  With this definition, we will perform our integral by expressing everything in terms of 
$\t z,$ $\bar {\t z}$, $\theta$ and $\theta'$,
after which, following the recipe of \cite{GrSe}, we integrate first over the odd variables $\theta$ and $\theta'$ and only then over
$\t z$ and $\bar{\t z}$.

To explicitly perform the integral, we have to write $\d^2z \,\d\theta\,\d\theta'=-i\d\t z\,\d z\,\d\theta\,\d\theta'$ in terms of
$\t z$, $\bar {\t z}$, $\theta$, and $\theta'$ only.  Eqn. (\ref{urcott}) is equivalent to 
\begin{equation}\label{meogo} z=z^\star+h(\t z;\neg z^\star)\theta\theta'=\bar {\t z}+h(\t z;\neg \bar{\t z})\theta\theta',\end{equation} 
where in the second step we set $z^\star=\bar{\t z}$.  So 
\begin{equation}\label{mulgo} \d z=\d\bar{\t z}\left(1+\theta\theta'\frac{\partial h(\t z;\neg\bar{\t z})}{\partial\bar{\t z}}\right) 
+\dots.\end{equation}
where on the right hand side, we compute the coefficient of $\d\bar{\t z}$  only. This enables us to express the integral
$\J$ in terms of $\t z, \bar{\t z},\theta,\theta'$; in the measure $\d\t z\,\d z\,\d\theta\,\d\theta'$, we simply substitute for $\d z$
using (\ref{mulgo}).   The integral then becomes
\begin{equation}\label{uritz}\J=-i\int_{|\t z|\leq 1}\d\t z\,\d\bar{\t z}\,\d\theta\,\d\theta'\left(1+\theta\theta'\frac{\partial h(\t z;\neg\bar{\t z})}{\partial\bar{\t z}}\right)\frac{1}{\t z} .\end{equation}
Now we integrate over $\theta$ and $\theta'$ with $\int \d\theta\,\d\theta'\,\theta\theta'=1$, 
to get
\begin{equation}\label{wuritz}\J=-i\int_{|\t z|\leq 1}\d\t z\,\d\bar{\t z}\frac{\partial h(\t z;\neg \bar{\t z})}{\partial\bar{\t z}}\frac{1}{\t z}.
\end{equation}
Integration by parts gives
\begin{equation}\label{ritz}\J=i\int_{|\t z|\leq 1}\d\t z\,\d\bar{\t z}\,h(\t z;\neg\bar{\t z})\frac{\partial}{\partial\bar{\t z}}\frac{1}{\t z}.
\end{equation}
There is no surface term at $|\t z|=1$ since $h=0$ there.  With
\begin{equation}\label{mufato}\frac{\partial}{\partial\bar{\t  z}}\frac{1}{\t z}=2\pi \delta^2(\t z) \end{equation}
and also  $\int \d^2\t z\delta^2(\t z)=1$ and $\d\t z\,\d\bar{\t z}=-i\d^2\t z$, we get
\begin{equation}\label{ifato} \J=2\pi h(0;\neg 0)= 2\pi, \end{equation}
where we use the condition
\begin{equation}\label{nifato}h(0;\neg 0)=1. \end{equation}

The moral of the story is that if one first integrates over $\theta$ and $\theta'$ and then tries to decide what to do next,
it is already too late.   A simple statement has to be made in terms of the full set of variables. 


We will explain in section \ref{genless} how what we have just done is a special case of a general procedure.
But here we make
some further remarks on this calculation.
After integration by parts, the result for $\J$ seems to come from a delta function at $z=0$.  But the existence of a natural
integration by parts was special to this particular problem.  To draw a general lesson, it is better
to look at the formulas (\ref{uritz}) or (\ref{wuritz}) before integration by parts, and here we see that  
there actually is no contribution at all near $z=0$ since $h$ is constant near $z=0$. (There should not be a contribution
from $z=0$, since the $D$-auxiliary field vertex operator
$V_D$ that played the starring role is not the vertex operator of a physical field.)
The question of what values of $z$ contribute to the integral
is not well-defined, since it depends on the choice of the arbitrary function $h$, though the value of the integral was independent
of this choice.  We will give a more systematic explanation
of the meaning of the choice of the function $h$ in section \ref{gluehol}.

\subsubsection{A Variant}\label{variant}

A variant of the above procedure to evaluate the integral for $\J$ is to say that, after setting $\bar{\t z}=z^\star,$ 
we pick a lower cutoff $|\t z|\geq \eta$ for some small
positive $\eta$, integrate over all bosonic and fermionic variables, and then take the limit $\eta\to 0$.  
For $\eta>0$, we are evaluating a smooth measure on a compact supermanifold (with boundary) and
there is no need to say anything about the order of integration.
Performing the integral for  $\eta>0$ and then taking $\eta\to 0$ gives
the same result as integrating first over $\theta$ and $\theta'$ and then over $\t z$ and $\bar{\t z}$, since in that latter
procedure, there was no contribution near $\t z=0$.  The formulation
with the lower cutoff $\eta$ is  useful  for the generalization that we discuss in section \ref{genless}.

\subsubsection{Justification}\label{justification}

One justification \cite{GrSe} of the procedure just described  is that
it agrees with the reasoning of \cite{DIS,ADS} that we summarized is section \ref{took}, and in 
particular with the unitarity-based reasoning of fig. \ref{resonance}.

Another justification (also described in \cite{GrSe}) is as follows.   The 1-loop mass renormalization of the field $\rho_T$ arises from  the term of order 
$\langle\rho_T\rangle\langle\bar\rho_T\rangle$ in the expansion of the 1-loop partition function of the sigma-model with target $\XX$.   Let us analyze
how to compute that term. 


At zero momentum, the vertex operator of $\rho_T$ is $W_T=\Lambda_T \Lambda^i w_{i\bar i}(\Y)D_\theta \Y^{\bar i}$. 
We have written this expression in terms of superfields since we want to make worldsheet supersymmetry
manifest.
If we give $\rho_T$ and its complex conjugate $\bar\rho_T$ 
an expectation value, the effect of this, to first order, is to add the appropriate terms to the worldsheet
action:
\begin{equation}\label{mezzo}\langle\rho_T\rangle\int \d^2z\,\d\theta\, W_T(\t z;\neg z|\theta)
+\langle\bar\rho_T\rangle\int\d^2 z\,\d\theta \,\t W_T(\t z;\neg z|\theta). \end{equation}
The vertex operators $W_T $ and $\t W_T$ have terms linear in auxiliary fields 
(see the comment following eqn. (\ref{murkey})).  If we integrate out the auxiliary fields, we get
a four-fermion term in the action that we will schematically denote as\footnote{This term arises by expanding the usual four-fermion coupling $\lambda^2F\psi^2$ of the sigma-model (where $F$ is
the Yang-Mills field strength, which becomes the Riemann tensor if the spin connection is embedded in the gauge group) in powers of $\rho_T$ and $\bar\rho_T$.  We omit an explicit formula as it is not
illuminating.} $\lambda^2(\dots)\psi^2$.  This is the familiar four-fermion
term of the supersymmetric nonlinear sigma-model -- or more exactly, it is the part of that term proportional
to $|\langle\rho_T\rangle|^2$.  So after integrating out the odd coordinate $\theta$ and also the auxiliary fields,
the part of the action that depends on $\langle\rho_T\rangle$ becomes
\begin{equation}\label{yezzo}\langle\rho_T\rangle\int\d^2 z \,V_T +\langle\bar\rho_T\rangle
\int \d^2 z\,\t V_T +|\langle\rho_T\rangle|^2\int\d^2 z \,\lambda^2(\dots)\psi^2. \end{equation}

Now  to study the genus 1
heterotic string path integral in the presence of a background field, we have to expand the integrand
of the worldsheet path integral in powers of this field.  This integrand is the exponential of minus the action or
\begin{equation}\label{doome}\exp\left( -\langle\rho_T\rangle\int\d^2 z \,V_T -\langle\bar\rho_T\rangle
\int \d^2 z\,\t V_T -|\langle\rho_T\rangle|^2\int\d^2 z\, \lambda^2(\dots)\psi^2\right),\end{equation}
where we show  only the terms that depend on  $\langle\rho_T\rangle,$ $\langle\bar\rho_T\rangle$.

In that order, 
there   is a bilinear expression involving the two-point function of
the vertex operators $V_T$ and $\t V_T$:
\begin{equation}\label{zumly} \int \d^2 z\, \bigl\langle V_T(\t z;\neg z)\,\t V_T(0;\neg 0)\bigr\rangle.\end{equation}
(As usual, we factor out the translation symmetry of the torus to set the insertion point of $\t V_T$ to
$\t z=z=0$.) This is the ``obvious'' contribution to the mass shift.
 But there is also a ``contact'' term coming from an insertion of the four-fermi
interaction.  As we know by now, the obvious contribution vanishes, so this contact term must give the full answer.

This gives a straightforward explanation of why the obvious expression (\ref{zumly}) needs to be corrected.
The alternative explanation in which we start with the supersymmetric version of (\ref{zumly}), namely
\begin{equation}\label{umly} \int \d^2 z\,\d\theta\,\d\theta' \,\langle W_T(\t z;\neg z|\theta)
\t W_T(0;\neg 0|\theta') \rangle,\end{equation}
and regularize in an appropriate way the resulting 
conditionally convergent integral, has two advantages.  Technically, it is straightforward to get the right
answer this way; it is clear that only the $(1,1)$ part of the relevant OPE matters.  (The $\lambda^2(\dots)\psi^2$
term in (\ref{yezzo})  is a linear combination of a  $(1,1)$ operator and various irrelevant operators that do not contribute.)
Also this approach generalizes to all of the conditionally convergent integrals of superstring perturbation
theory, as we explain next.


\subsection{General Lessons}\label{genless}


\subsubsection{Preliminaries}\label{preliminaries}
\begin{figure}
 \begin{center}
   \includegraphics[width=4.5in]{Shortdistance.pdf}
 \end{center}
\caption{\small   A process (a) in which two punctures on a Riemann surface $\Sigma$ -- here of genus 1 -- approach
each other is equivalent conformally to a process (b) in which $\Sigma$ splits into two components $\Sigma_\ell$ and $\Sigma_r$,
connected by a narrow neck, with one of them a genus 0 surface that contains the two punctures.}
 \label{Short}
\end{figure}
Now we are going to look in yet another way\footnote{Some of the ideas were known in the early literature \cite{DD}.} at the phenomenon studied in sections \ref{took} and \ref{moresplit}.
This phenomenon involved the behavior as two points $z|\theta$ and $z'|\theta'$ on a genus 1 super Riemann surface
$\Sigma$ approach each other.  However (fig. \ref{Short}), up to a conformal transformation, it is equivalent to say
that $\Sigma$ splits into two components, separated by a narrow neck, of which one is a genus 0 surface
that contains the two points in question, while the other has genus 1.

  This is a special case of a more general type of degeneration
(fig. \ref{Split}) in which a super Riemann surface $\Sigma$ of any genus $g$, containing any number of punctures,
splits into a pair of components $\Sigma_\ell $ and $\Sigma_r$. 
In general, the  punctures are distributed
between the two sides in an almost\footnote{The only restriction is that if $g_\ell$ or 
$g_r$ vanishes, then one requires $\SIgma_\ell$ or $\Sigma_r$
to contain at least two punctures, in addition to the narrow neck.   The moduli space of Riemann
surfaces or super Riemann surfaces
can be compactified without allowing a degeneration in which this is not the case.} 
arbitrary fashion, and the genera $g_\ell$ and $g_r$ are constrained only by
$g_\ell+g_r=g$.   This
 is actually called a separating degeneration (fig. \ref{Narrow}(a)).
There is also an analogous nonseparating degeneration in which $\Sigma$ develops a narrow neck, but the surface
obtained by cutting this neck is still connected (fig. \ref{Narrow}(b)). 
\begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Splitsurface.pdf}
 \end{center}
\caption{\small    A generalization of fig. \ref{Short} in which a surface $\Sigma$ splits into a pair of components $\Sigma_\ell$
   and $\SIgma_r$ of arbitrary genus, 
   joined via a narrow neck. In the example shown, $\Sigma_\ell$ and $\Sigma_r$ are both genus 1
   surfaces with punctures.}
 \label{Split}
\end{figure}

\begin{figure}
 \begin{center}
   \includegraphics[width=5.5in]{Narrow.pdf}
 \end{center}
\caption{\small A Riemann surface or super Riemann surface can undergo either a separating degeneration as in (a)
or a nonseparating one as in (b).  In each case the degeneration involves the collapse of a narrow neck, labeled
by the arrow.  The singular configurations that arise when the neck collapses are sketched in fig. \ref{Limiting}.  }
 \label{Narrow}
\end{figure}




From a conformal point of view, a narrow neck is equivalent to a long tube.  Let us recall how this comes about.
We consider a long tube parametrized
by a complex variable $z$ with an equivalence relation $z\cong z+2\pi i$ and an inequality $0\leq \mathrm{Re}\,z\leq T$,
for some large $T$.  This describes propagation of a closed string of circumference $2\pi$ through an imaginary time $T$.
Now introduce new variables $x=e^{-z}$, $y=e^{-T+z}$, and let $q=e^{-T}$.  The inequalities $0\leq \mathrm{Re}\,
z\leq T$ imply $|x|,|y|\leq 1$.  $x$ and $y$ are related by
\begin{equation}\label{monkey} xy=q.  \end{equation}
One way to describe this gluing is to remove the regions $|x|<|q|^{1/2}$ and $|y|<|q|^{1/2}$ from the unit discs parametrized by $x$ and $y$ and then glue the boundary circles $|x|=|q|^{1/2}$ and
$|y|=|q|^{1/2}$ via $xy=q$.  In this description, for small $q$, the two unit discs have small open balls removed and are glued together along a narrow neck at $|x|,|y|\sim |q|^{1/2}$.

The advantage of the ``long tube'' description is that it makes the physical interpretation clear.  The long tube represents
the propagation of a closed string through a large proper time $T$, so it represents an infrared effect.  
$T$ is analogous to a Schwinger parameter in an ordinary
Feynman diagram.  Integration over $T$
will produce a pole when the closed string propagating down the tube is on-shell. (See section \ref{obso}.) Such a pole is analogous to the pole
in a Feynman propagator $i/(p^2-m^2+i\epsilon)$ in field theory.  

The advantage of the ``narrow neck'' description is that it makes it clear how to compactify the moduli space.  In
terms of the long tube, it is not clear that there is a meaningful limit for $T\to\infty$, but in the narrow neck description
by eqn. (\ref{monkey}), there is no problem in taking the limit $q\to 0$.  The limiting equation
\begin{equation}\label{wonkey} xy=0, \end{equation}
with the restriction $|x|,|y|\leq 1,$
describes two discs, the disc $|x|\leq 1$ and the disc $|y|\leq 1$, glued together at the common point $x=y=0$.

One of the most fundamental facts about superstring perturbation theory is the existence of the Deligne-Mumford
compactification of the moduli space $\MM$ of Riemann surfaces  or super Riemann
surfaces. (When the context is sufficiently clear,
we use the symbol $\MM$ to denote either of these spaces; we also write $\h\MM$ for the Deligne-Mumford compactification.) Moduli space or supermoduli space can be compactified
by adding limiting configurations  (fig. \ref{Limiting}) that correspond to the collapse of a narrow neck.  
Apart from limiting configurations
of this particular kind, possibly with more than one collapsed neck, the compactified moduli space
parametrizes smooth surfaces only.  
\begin{figure}
 \begin{center}
   \includegraphics[width=5.5in]{Limiting.pdf}
 \end{center}
\caption{\small Collapse of the narrow necks in fig. \ref{Narrow} leads to these limiting configurations.  The singularities depicted
here are known as ordinary double points.
The local picture is that two branches meet at a common point.  The fact that the only singularities that occur in the Deligne-Mumford
compactification are ordinary double point singularities (which have a long distance or infrared interpretation in spacetime) is the reason
that there are no ultraviolet divergences in superstring perturbation theory.}
 \label{Limiting}
\end{figure}

This is actually the fundamental reason that there are no ultraviolet divergences in 
superstring perturbation theory.  The measures that have to be integrated are always smooth measures on the appropriate
moduli spaces.  Integration of a smooth measure on a compact space can never pose a problem.  So a difficulty in superstring
perturbation theory can only arise from noncompactness of the relevant moduli spaces.  The existence of the Deligne-Mumford
compactification is a precise statement that the only pertinent noncompactness is associated to the ``narrow neck'' or
``long tube'' limit.  Physically, singularities arising from integration in this region are on-shell or infrared singularities.
Such on-shell and infrared singularities are crucial in the physical interpretation of the theory, just as they are in ordinary
quantum field theory.

\subsubsection{Conditionally Convergent Integrals}\label{condcon}

Although there are no ultraviolet issues in superstring perturbation theory, one often runs into integrals that are
only conditionally convergent in the infrared region, that is, in the region in which a narrow neck is collapsing.
We have already discussed an example at length, and a large class of additional examples is described in section \ref{tadpole}. 
A general method of treating conditionally convergent integrals is needed.

Such integrals can always be treated by a simple generalization of the procedure explained in section \ref{moresplit}.
What one needs to know is that, roughly speaking (see the last paragraph of this section for a clarification),
there is a distinguished parameter controlling the collapse of a narrow neck in a super Riemann surface.  This parameter 
is the superanalog of the parameter $q$ in eqn. (\ref{monkey}).   For the case of a Neveu-Schwarz (NS) 
degeneration -- that is, the case that the closed string state propagating through the narrow neck is in the NS
sector -- the analog of eqn. (\ref{monkey}) is as follows.  A superdisc parametrized by $x|\theta$ can be glued to
a superdisc parametrized by $y|\psi$ via
\begin{align}\label{melk} xy& = -\varepsilon^2\cr
                                             x\psi&=\varepsilon\theta\cr
                                              y\theta&=-\varepsilon \psi\cr
                                               \theta\psi&=0. \end{align}
 This change of coordinates from $x|\theta$ to $y|\psi$ is superconformal.                                              
(This formula and its Ramond sector analog, which is presented in eqn. (\ref{medzo}) below, are originally due to P. Deligne.  For more, see section 6.2 of  \cite{Surfaces}.)  The closest
analog of the gluing parameter $q$ of bosonic string theory is $q_\NS=-\varepsilon^2$.  (For a given value of $q_\NS$,
there are two choices of $\varepsilon$, which correspond to two possible ways of gluing together the spin structures
on the two superdiscs; the sum over the two choices leads to the GSO projection on the string state propagating
through the neck.)   



As an example of this, consider the case that the degeneration arises from two points $z|\theta$ and $z'|\theta'$ approaching
each other on a super Riemann surface $\Sigma$.  In this case, the parameter $q_\NS$ turns out to coincide with the
supersymmetric combination $\h z=z-z'-\theta\theta'$:
\begin{equation}\label{udonk}q_\NS=\h z=z-z'-\theta\theta'. \end{equation}
(This is shown in section 6.3.2 of \cite{Surfaces}.)  The use of this parameter, rather than of the more naive $z-z'$, was
the key insight in \cite{GrSe}, as described in section \ref{moresplit} above.  
With $\h z$ replaced by $q_\NS$, the procedure described
there generalizes almost immediately to treat all of the conditionally convergent integrals of superstring perturbation theory.
We spell this out in section \ref{regu}.

The above explanation has been oversimplified in one important respect.  
The gluing parameters $q$ or $\varepsilon$ are not well-defined as complex numbers, because their definition
depends on local parameters that vanish to first order at the points at which the gluing occurs.
For example, if we glue the point $x=0$ in $\Sigma_\ell$ to the point $y=0$ in $\SIgma_r$ and then deform via
\begin{equation}\label{pelmo} xy = q,\end{equation}
then obviously the definition of $q$ depends on the choice of the functions  $x$ and $y$.  If we rescale $x$ and $y$,
$q$ is also rescaled.  Similarly,
in the example of the last paragraph, a superconformal transformation acting by
$z|\theta\to \lambda z|\lambda^{1/2}\theta$,
$z'|\theta'\to \lambda z'|\lambda^{1/2}\theta'$ (where $\lambda$ is nonzero and independent of $z|\theta$
and $z'|\theta'$, but may depend on other moduli),
will multiply $q_\NS$ by $\lambda$.
But crucially it does not change the relevant coefficient between the $z-z'$ and $\theta\theta'$ terms.
The precise statement here is not that there is a distinguished parameter $q$ or $\varepsilon$ but that compactification of
the moduli space or supermoduli space $\MM$ 
is achieved by adding a divisor $\frak D$, along which $q$ or $\varepsilon$ has
a simple zero.  This condition determines $q$ or $\varepsilon$ only up to multiplication by an invertible function, that is
\begin{equation}\label{mitto} \varepsilon\to e^f \varepsilon\end{equation}
or a similar rescaling of $q$,
and in general there is no way to be more precise.
One may say that (modulo $q^2$ or $\varepsilon^2$)  $q$ or $\varepsilon$ is not a complex number but a linear 
function on the fiber of a complex
line bundle, namely the normal bundle $\frak N$ to the divisor $\frak D\subset\MM$.   See section 6.3 of \cite{Surfaces} for more. 

\subsubsection{Regularization}\label{regu}
Now we will state what we claim is the appropriate  procedure for regularizing conditionally convergent integrals.
For definiteness, let us consider a degeneration of a heterotic string worldsheet $\Sigma$.  The procedure for other
superstring theories is similar.  From a holomorphic point of view, we describe a heterotic string worldsheet near 
the degeneration by local parameters $x|\theta$ and $y|\psi$, glued together as in (\ref{melk}) with a gluing parameter $q_\NS$.  Antiholomorphically, 
we use local parameters $\t x$ and $\t y$, glued by
\begin{equation}\label{zelk} \t x\t y = \t q. \end{equation}
Roughly speaking, $\t x$, $\t y$, and $\t q$ are the complex conjugates of $x,y$, and $q_\NS$.  We will be more precise
about this in section \ref{gluehol}.

We regularize the conditionally convergent integrals of superstring perturbation theory as in section \ref{variant}.
We pick a small positive $\eta$, and restrict the integral to $|\t qq_\NS|^{1/2}\geq \eta$, and then finally take the limit
as $\eta\to 0$.  This generalizes the procedure that we explained in a special case in section \ref{moresplit}.  It is a satisfactory
procedure because it is a conformally- or superconformally-invariant procedure that
makes all conditionally convergent integrals well-defined and is compatible with any further degenerations and thus with unitarity. 

There are two points on which what we have said is incomplete or oversimplified.  First, we  have not explained the
relation between $\t q$ and $q_{\NS}$.  Roughly speaking, one treats $\t q$ as the complex conjugate of $q_{\NS}$.
For a fuller explanation, see section \ref{gluehol}.  Second, the fact that $\t q$ and $q_\NS$ are linear functions on
the appropriate normal bundles  rather than complex numbers means that $\eta$ is really a hermitian metric 
on an appropriate
line bundle (or more accurately, a sesquilinear form)
rather than a positive real number.  This leads to some subtleties, which have nothing
to do with worldsheet or spacetime supersymmetry, and appear already in bosonic string theory.   See \cite{Revisited},
especially sections 7.6 and 7.7.                                  



\subsubsection{Gluing Holomorphic And Antiholomorphic Coordinates}\label{gluehol}

In the language of section 5 of \cite{Supermanifold}, what we will describe next is the integration
cycle $\varGamma$ of superstring perturbation theory.  We aim for an informal explanation.

A point on a heterotic string worldsheet has holomorphic coordinates $z|\theta$ and an antiholomorphic
coordinate $\t z$.  Naively, $\t z$ is the complex conjugate of $z$, but this is oversimplified since a statement
$\bar{\t z}=z$ is not invariant under odd superconformal transformations, which act by
\begin{equation}\label{indu} \delta z=-\alpha(z) \theta,~~\delta\theta=\alpha(z),~~\delta\t z=0. \end{equation}

So what is the relation between $\t z$ and $z$?  For many purposes, one does not need to specify the precise relationship.
The classical action, the vertex operators, and the correlation functions are all real-analytic. So to some
extent one may think of $\t z$ and $z$ as independent complex variables, as long as one does not go too far
away from $\bar{\t z}=z$.  

It is really when one wants to integrate over moduli space that one needs to specify a relationship between holomorphic
and antiholomorphic variables.  For example, in section \ref{moresplit}, to evaluate a 1-loop mass shift, we needed to
compute an integral
\begin{equation}\label{murok}\int\d\t z\,\d z\,\d\theta\,\d\theta' \,F(\t z;\neg z|\theta,\theta'), \end{equation}
where $\t z;\neg z|\theta$ were the coordinates of one puncture and $\theta'$ was the odd coordinate of another puncture.
To evaluate such an integral, one cannot just vaguely treat $\t z $ and $z$ as independent complex variables.
One needs to specify a relationship between them.  What is a natural relationship?  As we have explained,
setting $\bar{\t z}=z$ is not really natural, since it is not consistent with superconformal symmetry.  It is natural, however,
to assert that $\bar{\t z}=z$ modulo nilpotent terms.  In the present example, with only two odd moduli $\theta$ and $\theta'$,
the most general nilpotent term is $h(\t z; \neg z)\theta\theta'$ for some function $h(\t z;\neg z)$, and therefore it is natural
to say that the relationship between ${\t z}$ and $z$ should take the form
\begin{equation}\label{urok}\bar{\t z}=z-h(\t z;\neg z)\theta\theta' \end{equation}
for some $h$.  The procedure of section \ref{moresplit} tells us that we will want $h(0;\neg 0)=1$.  The function $h(\t z;\neg z)$ 
must also obey
\begin{equation}\label{melmo}h(\t z;\neg z) = -h(\t z+1;\neg z+1)=h(\t z+\bar\tau;\neg z+\tau) \end{equation}
to respect the equivalences (\ref{mune}) and (\ref{zune}) (note that $\theta'$ is invariant under those equivalences 
since it
is the odd coordinate of a point whose even coordinates are $\t z'=z'=0$).

We do not try to pick a particular $h$ because no preferred function $h$ obeying $h(0;\neg 0)=1$ and also consistent
with (\ref{melmo}) presents itself.  Instead we proceed by showing that, as long as some general conditions are imposed,
the precise choice of $h$ does not affect the integral.  If the measures that we are integrating extend as
smooth measures over the Deligne-Mumford compactification $\h\MM$ of $\MM$ (so that there is no possible problem in
integration by parts), then the integrals are entirely independent of $h$.  This follows from the supermanifold
version of Stokes's theorem.  In essence, a change in $h$ by $h\to h+\delta h$ can be compensated 
by a change of coordinates on moduli
space
\begin{equation}\label{pumelo} z\to z+\delta h(\t z;\neg z) \theta\theta' \end{equation} 
(with no change in $\theta,\theta',$ or $\t z$).  Integration of a smooth measure
on a compact supermanifold is invariant under any change of
coordinates, so if the integration measure extends smoothly over $\h\MM$, the integral is
completely independent of $h$.   

We are not in the situation assumed in the last paragraph, because the measures we want to integrate do not extend
smoothly over the compactification.  For instance, in section \ref{moresplit}, we wanted to integrate a measure that
behaves near $z=\t z=0$ as
\begin{equation}\label{urwu} \J\sim -i\d\t z\,\d z\,\d\theta\,\d\theta'  \,\frac{1}{\t z}.  \end{equation} 
Such an integral is only conditionally convergent, and its evaluation depends on an infrared regulator.  To preserve the
regularization, which depended on the function $\h z=z-\theta\theta'$ (or more precisely on the divisor in $\h\M$ determined
by vanishing of this function)  we must require $\delta h(0;\neg 0)=0$.
Indeed, we saw in section \ref{moresplit} that the integral depends on $h(\t z;\neg z)$ only via $h(0;\neg 0)$.


Why is $h(0;\neg 0)=1$ the correct condition?  Apart from what was explained in section \ref{moresplit},
one answer is that this is the only condition
that can be stated just in terms of the natural gluing parameters, and which therefore is superconformally-invariant and
capable of generalization.
We recall that holomorphically, the natural gluing parameter in this example is $q_\NS=\h z=z-\theta\theta'$, while
antiholomorphically, the natural gluing parameter is $\t q = \t z$.  So the condition  $h(0;\neg 0)=1$ is equivalent
to the statement that the relation between $\t q$ and $q_\NS$ near $\t q=q_\NS=0$ is
\begin{equation}\label{usfu} \bar{\t q}=q_\NS(1+\dots)\end{equation}
where the ellipses represent nilpotent terms.  (It is not possible to specify the relation between $\t q$
and $q$ more precisely than this, because of facts noted at the end of section \ref{condcon}.)

Now we have all the ingredients to explain the  general relation between holomorphic and antiholomorphic moduli
in the context of heterotic string perturbation theory.  (See section 6.5 of \cite{Revisited} for a fuller explanation
and generalization to the other superstring theories.)  Let us consider a situation in which the moduli space of
bosonic Riemann surfaces has complex dimension $r$ and the moduli space of super Riemann surfaces has
dimension $r|s$.  Thus, antiholomorphically, a heterotic string worldsheet has even moduli $\t m_1,\dots,\t m_r$,
while holomorphically it has even and odd moduli $m_1,\dots,m_r|\eta_1\dots\eta_s$.  What is the relation between
holomorphic and antiholomorphic moduli?  Naively the $\t m_\alpha$ are the complex conjugates of the $m_\alpha$.
But this is too strong a claim because it is not invariant under general reparametrizations of the supermoduli
space.  If one shifts the $m_\alpha$ by functions that depend on the $\eta$'s, for example
\begin{equation}\label{tolfo} m_\alpha\to m_\alpha+\sum_{ij}\eta_i \eta_j f^{ij}_\alpha(m_1,\dots,m_p),\end{equation}
then there is nothing one can do\footnote{We are not allowed to shift the $\t m_\alpha$ by a function antiholomorphic
in the $\eta_i$, since the complex conjugates of the $\eta_i$ are not present in the formalism of the heterotic string.}
 to the $\t m_\alpha$'s to preserve a hypothetical relationship $\bar{\t m_\alpha}=m_\alpha$.
So unless one can identify a distinguished set of even functions that one wants to call the $m_\alpha$ -- in a way compatible
with modular invariance -- one does not want to claim that $\bar{\t m_\alpha}=m_\alpha$.    

In general, we do not have a distinguished set of even coordinates on supermoduli space.  Given one set of local coordinates,
another set differing as in (\ref{tolfo}) is equally natural.   Therefore it is not natural
to pick particular coordinates and impose $\bar{ \t m_\alpha}=m_\alpha$ in that coordinate system.  But it is certainly
natural to insist that this is true modulo nilpotent terms:
\begin{equation}\label{mezmo}\bar{\t m_\alpha}=m_\alpha+\mathrm{nilpotent}\,\,\mathrm{corrections}.\end{equation}
The nilpotent corrections generalize $h(\t z;\neg z)\theta\theta'$ in eqn. (\ref{urok}).  To define the cycle $\varGamma$ over which we will integrate to compute a heterotic string scattering amplitude, we have to make some choice
of the nilpotent terms; as there is no natural choice in general, the goal has to be to show the choice does
not matter.  Now we can repeat everything
that we have said  in our illustrative example.  If the measures we want
to integrate extend smoothly over the compactification $\h\MM$ of the supermoduli space, then by the supermanifold
version of Stokes's theorem, the choice of the nilpotent terms -- or in other words the precise choice of 
the integration cycle $\varGamma$ -- would not matter.  Actually, we
want to integrate measures that are singular along certain divisors $\frak D\subset \h\MM$ along which $\Sigma$ degenerates.
Because of this, we need to impose a condition on how the nilpotent terms in (\ref{mezmo}) behave near $\frak D$.
Along  $\frak D$, one of the ${\t m}_\alpha$ plays a special role, namely the antiholomorphic gluing parameter $\t q$
that has a simple zero along $\frak D$.  Similarly, one of the holomorphic moduli plays a special role near $\frak D$, namely
the holomorphic gluing parameter $q_\NS$.  While placing no condition on the other $\t m_\alpha$'s beyond (\ref{mezmo}),
we need to be more precise about how $\t q$ is related to the holomorphic moduli along $\frak D$.   The condition
we need is that of eqn. (\ref{usfu}):
\begin{equation}\label{busfu} \bar{\t q}=q_\NS(1+\dots), \end{equation}
where again the ellipses represent nilpotent terms.  This is the only general condition that one can formulate in terms
of the available data.    It  suffices (when combined with a condition $|\t q|\geq \eta$, followed by a limit $\eta\to 0$) to regularize all conditionally convergent integrals
of superstring perturbation theory, since the singular behavior of the integration measure near 
$\frak D$ is always controlled by the natural gluing
parameters $\t q$ and $q_\NS$.


We conclude with one further comment that is useful background for section \ref{simplesplit}.  Let us consider
a problem in which the appropriate moduli space $\MM$ has  only one odd modulus.  Then there are no (nonzero) even nilpotent functions on $\MM$, so we cannot
make a change of variables as in (\ref{tolfo}), and there is no way to include nilpotent terms in the relationship (\ref{mezmo}).
Hence none of the characteristic subtleties of superstring perturbation theory
can arise.  Superstring calculations in problems with only one odd modulus (or none at all)
can be subtle, but the subtleties always
involve issues that could arise in bosonic string theory.

\subsection{A Much Simpler 1-Loop Mass Splitting}\label{simplesplit}

Returning to the $SO(32)$ heterotic string on a Calabi-Yau manifold, we are now going to compute a 1-loop mass shift
for a different set of fields.  There actually are three reasons to do this calculation: it is interesting; we will need the result
in section \ref{dilaton}; and it will illustrate our last assertion, namely that superstring perturbation theory is straightforward
when there is only one odd modulus. 

We will consider a genus one Riemann surface $\Sigma$ with two Ramond punctures -- that is, two insertions of Ramond
vertex operators.   For a review of the basics of super Riemann surfaces with punctures, see section 4 of \cite{Surfaces}.
The key point for us is that while 
adding a Neveu-Schwarz puncture increases the odd dimension of supermoduli space by 1 (the extra odd
modulus being the odd coordinate of the puncture), adding a Ramond puncture only increases the dimension of
supermoduli space by 1/2.   So a super Riemann surface of genus 1 with 2 Ramond vertex operators (and none of NS type)
has only 1 odd modulus, ensuring that superstring perturbation theory will be straightforward.  
To calculate, we should use Ramond vertex operators with the canonical picture number\footnote{At tree
level, one can compute with vertex operators of any picture number \cite{FMS}, but in positive genus, the picture-number of the vertex
operators  must be correlated with how the supermoduli space is defined.  See section 4.3 of \cite{Surfaces} and sections
4.1 and 5.1 of \cite{Revisited}.
 There is a systematic procedure to compute with
(unintegrated) NS and Ramond vertex operators with any negative value of the picture number, but the minimal procedure is based on the simplest
definition of the supermoduli space, in conjunction with
NS vertex operators of picture number $-1$ (such as we used in section \ref{took}) and Ramond vertex operators of picture number $-1/2$.
  We will be able in what follows to effectively convert one of the Ramond vertex
operators to picture number $+1/2$ using a picture-changing operator, but the justification for this depends on the fact that in the particular problem we consider,
there is only one odd modulus.} $-1/2$.


Now we will explain the term in the effective action that we aim to compute here.  We let $W_\alpha$
be the chiral superfield on $\R^4$ that contains the field strength $F_{\mu\nu}$ of the anomalous $U(1)$ gauge field.  Its expansion is
\begin{equation}\label{melbot}W_\alpha(x^\mu|\theta^\beta)=\zeta_\alpha+F_{\mu\nu}\sigma^{\mu\nu}_{\alpha\beta}\theta^\beta+
\theta_\alpha D+\dots\end{equation}
where $\zeta_\alpha$ is the fermion field in this multiplet and $D$ 
is the auxiliary field whose expectation value breaks supersymmetry.  The kinetic energy of this multiplet at tree level is
\begin{equation}\label{welbo}\int \d^4 x\,\d^2\theta \,S W_\alpha W^\alpha,\end{equation}
where $S=e^{-2\phi}-ia+\theta^\alpha \kappa_\alpha+\dots$ is the chiral superfield containing the four-dimensional
dilaton; it was introduced
in eqn. (\ref{elbo}).   In view of the $\theta$ expansions of $W_\alpha$ and $S$, the interaction (\ref{welbo}) contains
a term $\kappa_\alpha \zeta^\alpha D$, and at 1-loop order we expect to generate a $\kappa_\alpha\zeta^\alpha$ mass
term that will be proportional to  $\langle V_D\rangle$.  We want to explain here how this comes about. We call $\kappa$
and $\zeta$ the dilatino and gaugino, respectively.

We will do the calculation directly at zero momentum in spacetime. There will be none of the subtleties familiar from
\cite{DIS,ADS} as well as sections \ref{took} and \ref{moresplit} above, because we are now considering a problem with only
one odd modulus.  

Concretely, what we gain from the fact that the worldsheet $\Sigma$ has only two Ramond punctures is the following. 
(Here we are more or less restating in the present context what was already explained in section \ref{gluehol}.)
Topologically, $\Sigma$ is a torus with a 
holomorphic even modulus $\tau$.  With two or more odd moduli, say $\eta_1,\eta_2$, it is subtle to explain what one means
by $\tau$ as opposed to, say,\footnote{An exception, which was important in section \ref{took}, is that if the odd moduli
are positions of NS vertex operators, then this particular difficulty does not arise.  That is because an NS vertex operator
is inserted at a point in a pre-existing super Riemann surface, whose moduli can be defined independently of the position
of the NS puncture.}  $\tau+\eta_1\eta_2$.  There consequently is not a natural operation of integrating over the odd moduli
at fixed $\tau$.  A meaningful answer in general emerges only after integrating over all even and odd variables.  With only one odd modulus,
$\tau$ is uniquely defined and there is a natural notion of integrating first over the odd modulus  and only at the 
end  over $\tau$.  (In this final integration, one takes $\tau$ and the antiholomorphic modulus $\t\tau$ to be 
complex conjugate.)

Similarly, with two or more odd moduli, it is subtle to define what one means by the positions at which vertex operators
are inserted, as $z$ can be confused with $z+\eta_1\eta_2$.  In either of these cases, a BRST transformation that changes
the position at which a picture-changing operator is inserted  can shift $\tau$ to $\tau+\eta_1\eta_2$
or $z$ to $z+\eta_1\eta_2$.  However, with only one odd modulus, such shifts are not possible, and
one can think of the vertex operators as being inserted at
well-defined positions on an underlying bosonic Riemann surface.  Moreover, there is no subtlety in the standard arguments \cite{FMS} stating that the position of a picture-changing insertion
is irrelevant.  

Given this, we can straightforwardly use the familiar formalism of fermion vertex operators and picture-changing
operators.  In this formalism, the basic  fermion emission vertex of picture number $-1/2$ is written as the product of a spin
field of the $\beta\gamma$ ghost system -- which is written as $e^{-\tphi/2}$ in the language of \cite{FMS} --  times
a spin field of the matter system.   In compactification on $\R^4\times \XX$, the matter spin fields we will need are products
\begin{equation}\label{dworf} \Sigma_{\alpha,\pm}=\SIgma_\alpha\cdot \Sigma_\pm,~~~~~\Sigma_{\dot\alpha,\pm}=\Sigma_{\dot\alpha}\cdot\Sigma_\pm,
\end{equation}
where the two factors are as follows.  $\Sigma_\alpha$ and  $\Sigma_{\dot \alpha}$,  $\alpha,\dot\alpha=1,2$, 
are spin fields of positive or negative chirality for the sigma-model with target  $\R^4$.  And  $\Sigma_+ $ and $\Sigma_-$
are spin fields of the sigma-model with target $\XX$ that are associated to a covariantly constant spinor on 
$\XX$ of  positive or negative chirality.
 Of the combined spin fields defined in eqn. (\ref{dworf}), 
 $\Sigma_{\alpha,+}$ and $\Sigma_{\dot\alpha,-}$ are GSO-even and the others are GSO-odd.  

The vertex operator of a zero-momentum gaugino, in the $-1/2$ picture, is
\begin{equation}\label{numbo} V^\zeta_\alpha =J_\ell\cdot e^{-\tphi/2}\Sigma_{\alpha,+}. \end{equation}
The holomorphic factor $e^{-\tphi/2}\Sigma_{\alpha,+}$ was described in the last paragraph, while
the antiholomorphic factor is    the antiholomorphic worldsheet
current
 $J_\ell = g_{\bar i i}\lambda^{\bar i}\lambda^i$,  introduced in eqn. (\ref{irox}), which is associated to the anomalous $U(1)$ gauge symmetry in spacetime.  
Similarly, the vertex operator of the dilatino at zero momentum, again in the $-1/2$ picture, is
\begin{equation}\label{lumbo} V^\kappa_\alpha=\partial_{\t z}X^\mu\gamma_{\mu\alpha\dot\alpha}\epsilon^{\dot\alpha\dot\beta}
  e^{-\tphi/2}\Sigma_{\dot\beta,-}, \end{equation}
  where $\gamma_\mu$ are the four-dimensional Dirac matrices.  
  
  A consequence of setting the spacetime momentum to zero is that the field $X^\mu$ associated to motion of the string
  in $\R^4$ appears in the vertex operators only via the factor $\partial_{\t z}X^\mu$ in $V^\kappa_\alpha$.  Since
  the one-point function of $\partial_{\t z}X^\mu$ certainly vanishes, for instance by Lorentz symmetry, the expectation value of the product
  $V^\zeta_\alpha V^\kappa_\beta$ is trivially zero in the absence of additional insertions.  But one more operator
  must be inserted, namely the picture-changing operator ${\Y}=\{Q,\xi\}=e^\tphi(\psi_\mu\partial X^\mu+\dots),$ where the omitted
  terms are not relevant since they do not depend on $X^\mu$. 
  
 For fixed $\tau$, the integral that we have to evaluate to compute the $\zeta\kappa$ mass term is
 \begin{equation}\label{melfry}\J_{\alpha\beta}=
 -i\int \d\bar z\,\d z\,\bigl\langle V^\kappa_\alpha(\bar z;\neg z) \cdot e^\tphi \psi_\nu \partial_w X^\nu(w)\cdot V^\zeta_\beta(0;\neg 0)   \bigr\rangle ,\end{equation}
where because there is only one odd modulus, there is no need to distinguish $\t z$ from $\bar z$.  We have replaced $\Y$ by its relevant
piece $e^\tphi \psi_\mu\partial X^\mu$, and the point $w$ at which it is inserted is completely arbitrary.    
The $X^\mu$ correlator that we have to evaluate
is $\langle \partial_{\t z}X^\mu(\bar z;\neg z) \partial_w X^\nu(\bar w;\neg w)\rangle$.  This can be evaluated in a simple way because, for the free fields
$X^\mu$, the holomorphic and antiholomorphic operators $\partial_z X^\nu$ and $\partial_{\t z}X^\mu$ decouple except for the
effects of zero-modes.  The result (with $\alpha'=1/2$) is $\langle \partial_{\t z}X^\mu(\bar z;\neg z) \partial_w X^\nu(\bar w;\neg w)\rangle=\eta^{\mu\nu}/2\,\mathrm{Im}\,\tau$, independent of $z$ and $w$.    Moreover, we are free to make a convenient choice of $w$, and we choose
to take the limit that $w$ approaches $z$.  To take this limit, we need the operator product relation
\begin{equation}\label{curmy}e^\tphi \psi^\mu(w)\cdot e^{-\tphi/2}\gamma_{\mu\alpha\dot\alpha}\epsilon^{\dot\alpha\dot\beta}
\Sigma_{\dot\beta,-}( z) \to W^\kappa_\alpha(z), ~~~w\to z,\end{equation}
where 
\begin{equation}\label{urmy}W^\kappa_\alpha=e^{\tphi/2}\Sigma_{\alpha,-}.\end{equation}
All operators appearing in eqn. (\ref{curmy}) are holomorphic, and in particular $W^\kappa_\alpha$ is holomorphic and has dimension 0.

So our integral reduces to 
\begin{equation}\label{medolo}\J_{\alpha\beta}=-\frac{i}{2\,\mathrm{Im}\,\tau}\int \d\bar z\,\d z\bigl\langle W^\kappa_\alpha(z)\, 
V^\zeta_\beta(0;\neg 0)\bigr\rangle.\end{equation}
This integral is easily evaluated because the operator $W_\alpha^\kappa$ is holomorphic.
The correlator $F(z)= \bigl\langle W^\kappa_\alpha(z)\, 
V^\zeta_\beta(0;\neg 0)\bigr\rangle     $ that appears in (\ref{medolo}) is therefore a holomorphic function of $z$, apart from some poles
that can be understood using the operator product expansion.

The function $F(z)$ is not invariant under $z\to z+1$ or $z\to z+\tau$, because in general 
moving a Ramond vertex operator around a noncontractible  loop permutes the generalized spin structures\footnote{
\label{generalized} In the presence of Ramond
punctures, spin structures are replaced by generalized spin structures, defined for instance in section 4.2.4 of \cite{Surfaces}.  The distinction
is not important for what follows.}  on a super Riemann surface $\Sigma$.  We do have  $F(z)=F(z+2)=F(z+2\tau)$, since moving
around the same loop twice returns us to the original generalized spin structure.  We can sum over the generalized spin structures by simply
replacing $F(z)$ with $G(z)=\frac{1}{2}(F(z)+F(z+1)+F(z+\tau)+F(z+1+\tau))$.  (The reason for the factor of $1/2$ is that in genus $g$, the sum over
spin structures is accompanied by a factor of $2^{-g}$.) The fact that there is a meaningful way to sum over generalized spin structures
before integrating over $z$ and $\tau$ is another reflection of the fact that in this problem, because there is only 1 odd modulus, $z$ and $\tau$ are well-defined.

The singularities of $F(z)$ at $z=0$  are determined by the operator product expansion:
\begin{equation}\label{poklo} W_\alpha^\kappa(z)\cdot  V^\zeta_\beta(0;\neg 0)\sim \epsilon_{\alpha\beta}\frac{J_\ell(0)}{z} +\epsilon_{\alpha\beta}V_D(0;\neg 0)+\O(z), \end{equation}
where $V_D=J_\ell J_r$, introduced in eqn. (\ref{winzo}), is the vertex operator of the auxiliary field $D$.  
So $F(z)$ has a pole at $z=0$, and it also has poles at $z=1,\tau,$ and $1+\tau$ that are governed by the same formula with a different
generalized spin structure.  
However, the residue of the poles is given by the one-point function of the operator
$J_\ell$, which does not couple to right-moving RNS fermions.   The insertion of this operator does not disturb the GSO cancellation, and after summing
over spin structures, the contribution to $F(z)$ that is proportional to the one-point function of $J_\ell$ disappears.  After summing
over spin structures, $F(z)$ becomes a constant   $\langle V_D(0;\neg 0)\rangle$.   So 
 the only integral we really have to do is the one that computes the volume of the torus:
$-i\int_\Sigma \d\t z\,\d z=2\,\mathrm{Im}\,\tau$.   This cancels the factor of $\mathrm{Im}\,\tau$ in eqn. (\ref{medolo}), and
the final integral over $\tau$ is the same as it was in sections \ref{took} and \ref{moresplit}.

Thus the supersymmetry-violating  1-loop $\kappa\zeta$ mass term is proportional to $\langle V_D\rangle$ with a universal coefficient, just like the
other supersymmetry-violating 1-loop mass terms that we reviewed in sections \ref{took} and \ref{moresplit}.  The analysis, however, was notably
more straightforward: there were no $k^2/k^2$ terms, and no need to regularize a 
conditionally convergent integral.  The reason for this is that the computation
involved a supermoduli space with only one odd modulus.  

At least one aspect of this calculation  perhaps requires better explanation.  We have followed \cite{FMS} and represented
the $\beta\gamma$ system of the RNS model in terms of ``bosonized'' 
fields $\tphi,\xi,$ and $\eta$.   This is an extremely powerful method to describe the operators of the 
$\beta\gamma$ system, including the spin fields,
 determine their dimensions and operator product expansions, and compute correlation functions in genus 0.
In positive genus, the description of the $\beta\gamma$ system via $\tphi,\xi,$ and $\eta$ is tricky, since  
these fields have zero-modes on a surface
of positive genus whose interpretation and proper treatment
is not very transparent.  For an analysis of the $\tphi\xi\eta$ system in positive genus, see
\cite{VV}.  In the foregoing, we used the fields  $\tphi,\xi,$ and $\eta$ only to construct certain holomorphic operators and 
compute some terms
in their
operator product expansion.  For these purposes there is no problem. The analysis led to a final answer 
$\langle V_D\rangle$ which is most transparently computed using the original
$\beta\gamma$ variables.  (The role that $\beta$ and $\gamma$
 play in the 1-loop evaluation of $\langle V_D\rangle$ is very simple: their determinant cancels the determinant
of two of the RNS fermions $\psi^\mu$.)  Conceptually, one might prefer to perform
the entire computation in terms of the variables $\beta,\gamma$ whose geometrical meaning is clear; for some direct
approaches to the $\beta\gamma$ system on a surface of positive genus, see \cite{Lechtenfeld} or section 10 of \cite{Revisited}.

\subsection{More On The GSO Cancellation}\label{alphadetail}

\def\Spin{{\mathrm{Spin}}}
\def\8{\mathbf{8}}
\def\1{\mathbf{1}}
\def\3{{\mathbf 3}}
At several points in this analysis, starting in the discussion of eqn. (\ref{mizzo}), we invoked the GSO cancellation to claim that certain terms vanish upon
summing over spin structures.  Such claims are straightforward if $\XX$ is a Calabi-Yau orbifold and the vertex operators come from the untwisted sector.
Here we wish to explain why these claims hold in the case that $\XX$ is a general Calabi-Yau manifold.   In this section, $\Sigma$ is always an ordinary
Riemann surface of genus 1.  

First let us recall how one sees spacetime supersymmetry in superstring theory at 1-loop order
in light-cone gauge.  In the RNS description, the fields that are sensitive to the spin structure of $\Sigma$ are
 ten right-moving worldsheet fermions $\psi^I$, $I=0,\dots,9$ and the commuting ghosts $\beta$ and $\gamma$.  In computing
the partition function, the determinant of the $\beta\gamma$ system cancels the determinant of two of the $\psi^I$, say $\psi^0$ and $\psi^1$.
In light-cone gauge, all external string states are represented by vertex operators that do not disturb this cancellation.  Given this, the theory is described by eight RNS fermions
$\psi^I$, $I=2,\dots,9$, along with other fields not sensitive to the spin structure.  The $\psi^I$ transform in the vector representation of $SO(8)$ or $\Spin(8)$.  
We recall that the group $\Spin(8)$ has three representations of dimension eight, namely 
the vector representation, which we denote as $\8$,
and the two spinor representations of definite chirality, which we call $\8'$ and $\8''$.  We now use the following fact about two-dimensional
conformal field theory: in genus 1, eight fermions $\psi^I$ transforming in the representation $\8$ and with a 
sum\footnote{This ``sum'' requires a choice of sign: the path integral measure of the $\psi^I$ has a natural sign
if the spin structure of $\Sigma$ is even, but if it is is odd, the measure has no natural sign and one has to pick one.   
This choice, which determines the sign of parity-violating amplitudes in the string theory,
determines whether the $\Theta^\alpha$ transform in the $\8'$ or $\8''$ representation of $\Spin(8)$.}   over spin structures are equivalent
to eight fermions $\Theta^\alpha$ transforming in the $\8'$ and with an odd spin 
structure.

The $\Theta^\alpha$ are known as light-cone Green-Schwarz fermions.  Since they are coupled to an odd spin
structure on $\Sigma$,  the $\Theta^\alpha$  are completely
periodic, $\Theta^\alpha(z)=\Theta^\alpha(z+1)=\Theta^\alpha(z+\tau)$.  In particular, they have constant zero-modes.  Integration over those zero-modes causes
the partition function to vanish.  In terms of the $\psi^I$, that is the basic GSO cancellation in the sum over spin structures.  

Now let us pick an $SU(3)$ subgroup of $\Spin(8)$ (in our application, this will be the holonomy group of $\XX$) under which the representation $\8$
decomposes as $\1\oplus \1\oplus \3\oplus\bar\3$.  It is likewise true that the representation $\8'$ (or $\8''$) decomposes under the same $SU(3)$ as
$\1\oplus \1\oplus \3\oplus \bar\3$.  So two of the $\Theta^\alpha$, say $\Theta^1$ and $\Theta^2$, are $SU(3)$ singlets.  Consequently, arbitrary insertions of
$SU(3)$ currents do not disturb the fact that $\Theta^1$ and $\Theta^2$ have zero-modes.  These zero-modes ensure the vanishing of the partition function, and thus,
arbitrary insertions of $SU(3)$ currents do not disturb the GSO cancellation.

Next, let us replace $\R^{10}$ by $\R^4\times \XX$ with a general Calabi-Yau manifold $\XX$.   We want to explain why the GSO projection holds for the
one-loop partition function of such a sigma-model.  This will make it clear to what extent it holds for correlation functions.  
We consider the eight RNS fermions $\psi^I$ of the above discussion (after canceling $\psi^0$ and $\psi^1$ against $\beta$ and $\gamma$) to be
modes in a sigma-model with target $\R^2\times \XX$.  Let $\T$ denote the tangent bundle to $\R^2\times \XX$.  Its holonomy group is $SU(3)$, since $\R^2$
has trivial holonomy and $\XX$ has holonomy $SU(3)$. The bosonic fields of the sigma-model comprise a map
 $\Phi:\SIgma\to \R^2\times \XX$, and the $\psi^I$ take values in the pullback $\Phi^*(\T)$.  The $\R^2\times \XX$ partition function in genus 1
 actually vanishes
 for fixed $\Phi$ and fixed values of the left-moving fermions $\lambda$
 after integrating over the $\psi^I$ and summing over spin structures.  As we will see momentarily, that is true because, for fixed 
 $\Phi$ and $\lambda$, the $\psi^I$ are coupled
 only to $SU(3)$ currents, so the reasoning in the last paragraph applies.  The part of the action that involves the $\psi^I$ is
 \begin{equation}\label{melofx} \int_\SIgma\d^2 z\left(\frac{1}{2}\psi^I \frac{D}{D\bar z}\psi^I 
 +\frac{1}{4}\lambda^i\lambda^{\bar i}R_{i\bar i j\bar j}\psi^j\psi^{\bar j}\right).
 \end{equation} Here $R_{i\bar i j \bar j}$ is the Riemann tensor of $\R^2\times \XX$. The connection that is hidden 
 in the kinetic operator $D/D\bar z$ is the pullback by $\Phi$ of the connection on $\T$, so it has structure group $SU(3)$,
 meaning that in the kinetic energy, the $\psi^I$ couple to $\Phi$ only via their $SU(3)$ currents.  To analyze the $\lambda^2 R\psi^2$ term,
 note that the only non-trivial 
 part of the Riemann tensor of $\R^2\times \XX$ is the
 Riemann tensor of $\XX$.   The fact that $\XX$ is Kahler implies that in its last two indices the Riemann tensor of $\XX$ is of  type $(1,1)$ and so transforms
  in general  as 
 $\3\otimes \bar \3=\1\oplus \8$ of $SU(3)$.
 But Ricci-flatness implies that the Riemann tensor  of $\XX$ is traceless in its last two indices (in other words $g^{j\bar j}R_{i\bar i j \bar j}=0$), which precisely 
means that the $\1$ contribution is absent.  So the $\lambda\lambda R\psi\psi$ term in the 
 action couples to a bilinear in $\psi$
 transforming as the $\8$ or adjoint representation of $SU(3)$. In other words,  the $\psi^I$ only couple via 
 $SU(3)$ currents, ensuring the GSO cancellation.
 
Now it is clear what we can do without disturbing the GSO cancellation: we can make arbitrary insertions 
of operators that only couple to the $\psi^I$ through
$SU(3)$ currents.  This statement is enough to justify all uses we have made of the GSO cancellation. 
As an example, consider the discussion following
eqn. (\ref{poklo}) of the poles in the function $F(z)$.  In this case, the operator that is inserted is $J_\ell(0)$, 
which does not couple directly to the $\psi^I$ at all,
so it certainly does not affect the GSO cancellation.   Similarly, insertions of
the $D_j w_{i\bar i}$ term in eqn. (\ref{turkey}) do not disturb the GSO cancellation (in this case, the 
relation $g^{j\bar i}D_j w_{i\bar i}=0$ for a harmonic
form on a manifold of $SU(3)$ holonomy ensures that this term couples to $\psi$ only via $SU(3)$ currents). 
 
The above discussion is oversimplified in one important respect.  In string theory, the statement 
that $\XX$ has $SU(3)$ holonomy is only valid in the large volume limit; in sigma-model perturbation theory, there are $\alpha'$ corrections
to the metric\footnote{For heterotic string models with the spin connection embedded in the gauge group
in the usual way, the leading correction to the metric is of order $\alpha'^3$ (this correction reflects the four-loop beta function
computed in \cite{gvz}) and the leading correction
to the Riemannian connection is of order $\alpha'^4$.  This is actually too high an order to be relevant
to our analysis of the one-loop $D$-term, since that effect is of order $\alpha'^3$ (it involves a topological
invariant $\int_\XX\tr_{SU(3)} F^3$, which is of order $\alpha'^3$ relative to the volume of $\XX$ in
string units).  The argument given in the text applies more broadly to any heterotic string compactification with
$\N=1$ supersymmetry in four dimensions.}
 of $\XX$.  The exact statement is not that $\XX$ has $SU(3)$ holonomy, but that the sigma-model of
$\R^2\times \XX$ has a pair of holomorphic spin fields $\hat\Sigma_\pm$ of dimension $1/2$.   
The triality transformation
to light-cone Green-Schwarz fermions  maps the spin fields
 $\hat\Sigma_\pm$ to two of the Green-Schwarz fermions, which in the above notation are 
 $\Theta^1\pm i\Theta^2$. The
fact that $\hat\Sigma_\pm$ are holomorphic means that $\Theta^1 $ and $\Theta^2$ are free fields; their zero-modes
give the GSO cancellation.   The reasoning of the last paragraph can be restated more accurately 
in this language.
The operator $J_\ell$, being antiholomorphic, certainly does not disturb holomorphy of $\hat\Sigma_\pm$.   
And the
vertex operator $V_{T,k}$ of eqn. (\ref{turkey}) is the vertex operator of a massless chiral superfield.  At $k=0$,
to first order, turning on this field does not disturb spacetime supersymmetry.  Hence this operator, including the
 $D_j w_{i\bar i}$ term as well as $\alpha'$ corrections, commutes with the $\hat\Sigma_\pm$ and its insertion does
not disturb holomorphy of $\hat\Sigma_\pm$ or the GSO cancellation.  
 
 
 
\section{The Two-Loop Vacuum Energy}\label{dilaton}


\subsection{Overview}\label{overview}
If supersymmetry is spontaneously broken at 1-loop order, then at 2-loop order, we expect to generate a non-trivial vacuum energy.   
To understand how
this comes about, we first review the basic framework  for computing the genus 2 vacuum amplitude in the RNS description.   

A super Riemann surface $\Sigma$ of genus 2 without punctures has a moduli space of dimension $3g-3|2g-2=3|2$, with three even moduli
and two odd ones.  The genus 2 vacuum amplitude will come from an integral over this moduli space.
As we explained for instance in discussing eqn. (\ref{tolfo}), two odd moduli is enough to produce the
characteristic subtleties of superstring perturbation theory.  
Experience has shown that it is indeed tricky 
to correctly compute the vacuum amplitude in genus 2.  However, the subtleties have been neatly resolved by D'Hoker and Phong
 in work surveyed in \cite{DPh}.
This work involved very intricate calculations, but the underlying idea was actually very simple.\footnote{As reviewed in \cite{DPh}, D'Hoker and Phong also computed certain genus 2 scattering amplitudes -- parity-conserving amplitudes with all external states
being bosons from the NS sector.  This was a much more difficult computation than the computation of the genus 2 vacuum energy.}   

First of all, let $\Sigma_0$ be an ordinary Riemann surface of genus $g$.  $\SIgma_0$ has a period matrix, whose definition we will
recall in section \ref{details}.  It is a $g\times g$ symmetric complex matrix $\Omega_{ij}$, $i,j=1,\dots,g$, with a positive-definite
imaginary part; it is uniquely determined up to the action of the symplectic group $Sp(2g;\Z)$.  
A $g\times g$ symmetric matrix has $g(g+1)/2$ independent matrix elements.  A Riemann surface of genus $g$
has $3g-3$ complex moduli.  These numbers coincide if $g=2$ or 3, and this suggests that in those two special cases it may
be possible to use the matrix elements of $\Omega$ (modulo the action of $Sp(2g;\Z)$) as moduli for $\Sigma_0$.  This is actually
true in genus 2, and something very similar is true for $g=3$.  (For $g>3$, the matrix elements of $\Omega$ are not independent
but obey the Schottky relations, so they cannot be used to parametrize the moduli space of $\Sigma_0$ in such a simple way.)

A super Riemann surface $\Sigma$ of genus $g$ with an even spin structure has a super period matrix $\hat\Omega_{ij}$ which
is a purely bosonic $g\times g$ complex matrix, again with positive-definite imaginary part.\footnote{\label{zelb}
Actually, $\hat\Omega$ is only
generically defined; it has poles with nilpotent residue along the locus where the reduced space $\Sigma_0$ of $\Sigma$
is such that $H^0(\SIgma_0,K^{1/2})\not=0$, where $K^{1/2}$ is the spin bundle of $\Sigma_0$.  (See footnote \ref{helplater} in section
\ref{splitsuper}.)
This phenomenon never occurs  in genus 2 (or less), and this is one of the simplifications
behind the calculations surveyed in \cite{DPh}.  The procedure used there can possibly be adapted to $g=3$, but one would
have to deal with the fact that for $g\geq 3$, the super period matrix does have poles, and the projection from supermoduli space to the bosonic moduli space introduces further poles. 
For details, see \cite{holomorphy}.}  The basic idea in \cite{DPh} is to use the matrix elements of $\hat\Omega$
as bosonic moduli of $\Sigma$ that are kept fixed while integrating over the fermionic moduli.  


\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Fig5.pdf}
 \end{center}
\caption{\small Splitting of a genus 2 super Riemann surface to a union of two surfaces of genus 1, joined at a point.}
 \label{Question}
\end{figure}
This gives a clear framework for computing the genus 2 vacuum amplitude, though implementing this framework requires some hard work.  However, given what
we have learned in section \ref{mass}, there is a basic question to ask.   A super Riemann surface of genus 2 can split into a union of
two surfaces of genus 1, joined at a point (fig. \ref{Question}).  When this occurs, we are not free to specify arbitrarily what bosonic variable
is kept fixed while integrating over odd moduli.  There is a distinguished parameter $\varepsilon$ that has a simple zero on the compactification
divisor $\frak D$, and this is what should be held fixed when we integrate over the odd moduli.  Is $\varepsilon$ a function of the $\hat\Omega_{ij}$
or does it differ from such a function by a bilinear in the odd moduli?

It turns out that the answer to this question is that $\varepsilon$ cannot be expressed just in terms of the $\hat\Omega_{ij}$, and 
therefore in general the procedure described in \cite{DPh} does require a correction that
is supported on the divisor $\frak D$.  However, the correction vanishes in supersymmetric models above four dimensions or with $\N\geq 2$ supersymmetry in four dimensions.
It is nonvanishing
if there is an operator $V_D$ that is in the bottom component of
a supermultiplet, has dimension $(1,1)$, and has a nonzero expectation value $\langle V_D\rangle$ 
on a super Riemann surface of genus 1 with even spin structure.
In four-dimensional $\N=1$ models that have an anomalous $U(1)$ gauge symmetry at tree level, such an operator $V_D$ exists, and in this case, the correction term
shifts the 2-loop vacuum energy by a universal multiple of $\langle V_D\rangle^2$ (where $\langle V_D\rangle$ 
is computed at 1-loop order).   It turns out that the bulk contribution to the 2-loop
vacuum energy, computed using the procedure of \cite{DPh}, vanishes in all compactifications to four dimensions that have 
spacetime supersymmetry at tree level.  This has been shown in some explicit orbifold computations in \cite{DPhlatest} and proved more generally in \cite{Wittennew}.
Because of this bulk vanishing,  the correction that we will find at infinity gives the full answer.





In section \ref{obso}, we explain how this correction arises when there is an operator with the properties of $V_D$.  (Potential corrections
associated to operators of dimension less than $(1,1)$ are discussed in section \ref{otherbound}.)
In that analysis, we make use of the detailed relationship between $\varepsilon$ and $\hat\Omega$, which is explained in 
section \ref{details}.


\subsection{The Correction At Infinity}\label{obso}

\subsubsection{Separating Degeneration For Bosonic Strings}\label{sepbo}

First let us recall the behavior of the worldsheet path integral near a separating degeneration where a Riemann surface $\Sigma$ of genus $g$
splits into a union of surfaces $\Sigma_\ell$ and $\Sigma_r$ of genera $g_\ell$ and $g_r$, 
joined at a point $p$.  (See for example section 6.4.4 of \cite{Revisited} for more
detail.) We practice first with bosonic strings, and for simplicity
we begin by considering holomorphic degrees of freedom only.  It is more or less equivalent to begin with bosonic open strings.

We use local coordinates $x$ and $y$ on $\Sigma_\ell$ and $\Sigma_r$, and we 
write the gluing formula as
\begin{equation}\label{yuggle} (x-a)(y-b) =q.\end{equation}
Thus for $q=0$, the point $x=a$ on $\SIgma_\ell$ is glued to the point $y=b$ on $\SIgma_r$.  In general, both $\SIgma_\ell$ and $\Sigma_r$ have other
moduli, but they do not play an important role in what follows.  We want to analyze the measure for integrating over $a,b$, and $q$ near $q=0$.
This measure is a sum of contributions from various string states that propagate through the narrow neck between $\Sigma_\ell$ and $\Sigma_r$.
Each such contribution can be evaluated by inserting some vertex operator $V$ on $\Sigma_\ell$ and a conjugate\footnote{The only sense in which $\h V$ is ``conjugate'' to $V$ is that the two-point function $\langle V\h V\rangle$ is nonzero in genus 0; no complex conjugation is implied.} vertex operator $\h V$ on $\Sigma_r$.
(Here and at some later points  in this paper, we use the integrated forms of the vertex operators, though it is more precise to develop analogous formulas
using the unintegrated version.)  The contribution of the string
state in question to the path integral measure is given by the expression 
\begin{equation}\label{umbro} \d a \, V(a) \cdot \d q \,F(q) \cdot\d b \, \h V(b) ,\end{equation}
where $F(q)$ is some function that we have to determine.  Here $\d a\, V(a)$ and $\d b\, \h V(b)$ are the amplitudes for the indicated states to couple
to $\Sigma_\ell$ and $\Sigma_r$, respectively, and $\d q\,F(q)$ is the amplitude for the relevant state to propagate through the narrow neck.
To compute the contribution of the chosen state propagating between $\Sigma_\ell$ and $\SIgma_r$ to the world sheet path integral, one
 has to insert the expression (\ref{umbro}) in the worldsheet path integral on $\Sigma_\ell$ and $\Sigma_r$,
calculate the path integral including any other vertex operators that may be present in addition to the ones associated to the degeneration, and then integrate
over $a$, $b$, $q$, and the other moduli of $\Sigma_\ell$ and $\Sigma_r$. 

The function $F(q)$ can be determined by requiring that the expression (\ref{umbro}) is invariant under a scaling of the coordinates.  
We can work in a basis of operators such that $V$ and its conjugate $\h V$ are eigenstates of $L_0$.
Under the scaling $x\to \lambda x$, $a\to \lambda a$, along with $y\to \h\lambda y$, $b\to \h\lambda b$ (with arbitrary nonzero parameters $\lambda,\h\lambda$), 
we see from eqn. (\ref{yuggle}) that $q$ scales
as $q\to \lambda\h\lambda q$.    On the other hand, the vertex operators $V$ and $\h V$ scale as $\lambda^{-L_0}$ and $\h\lambda^{-L_0}$.   Invariance of
(\ref{umbro}) implies that $F(q)$ is a constant times $q^{L_0-2}$.  If  the operators $V$ and $\h V$ are normalized 
to have a canonical two-point function on a two-sphere, then the coefficient of $q^{L_0-2}$ is precisely $g_\st^2$ ($g_\st$ is the string coupling constant).
Omitting this universal factor, the contribution of a string state of given $L_0$ to the measure comes from insertion of
\begin{equation}\label{zuggle}\d a\, V(a)\cdot {\d q}\,{q^{L_0-2}}\cdot\d b\, \h V(b). \end{equation}


\subsubsection{The Pole And The Tadpole}\label{tadpole}

As a function of $L_0$, the integral $\int_0^\Lambda \d q\, q^{L_0-2}\sim 1/(L_0-1)$ has a pole at $L_0=1$.  (Here $\Lambda$ is an irrelevant upper
cutoff; the pole comes from the contribution near $q=0$.)   In a typical situation (fig. \ref{Split}) with vertex operators on both $\Sigma_\ell$ and $\Sigma_r$,
one has (for open strings) $L_0=(\alpha'/2)P^2+N$, where $P$ is the momentum flowing between $\Sigma_\ell$ and $\Sigma_r$,
and $N$ is constructed from oscillator modes of the string.  The pole occurs when the string state flowing between $\Sigma_\ell$ and $\Sigma_r$ is
on-shell, and plays the same role as the pole $1/(P^2+m^2)$ of the Feynman propagator in field theory.  Thus this pole is essential to the physical
interpretation of string theory.  Similar poles arise in closed string theory (where $\d q\, q^{L_0-2}$ is replaced by $\d^2q\,\bar q^{\t L_0-2} q^{L_0-2}$)
and in superstring theory, where  an analogous pole is exhibited at the end of section \ref{srsan}.
 
One of the greatest delicacies in string perturbation theory
 involves the ``tadpoles'' of massless spin-zero particles.  The tadpole problem arises
if all external vertex operators are inserted on $\Sigma_\ell$ (or $\SIgma_r$), as in fig. \ref{Tadpolefig}, in which case the string state
flowing between the two sides always has $P=0$.  As a result, if this state is a massless spin-zero particle, it is automatically on-shell;
the $q$ integral behaves as $\d q/q$ and is logarithmically divergent at $q=0$.   One has the same logarithmic divergence in closed-string theory
or in superstring theory, for similar reasons.  
From  a field theory point of view, we are sitting on the pole of the propagator $1/(P^2+m^2)$ at $P=m=0$.   

\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Newtry18.pdf}
 \end{center}
\caption{\small A separating degeneration that can lead to trouble.  A Riemann surface $\Sigma $ splits into two components $\SIgma_\ell$ and $\SIgma_r$
with all vertex operators on one side, here $\Sigma_r$.  The string state propagating between the two branches carries zero momentum in spacetime.  Unless the ``tadpole''
-- the amplitude for a zero-momentum massless scalar to disappear into the vacuum -- vanishes, the contribution of such a process is divergent. }
 \label{Tadpolefig}
\end{figure}
After we integrate over the moduli of $\SIgma_r$, the coefficient of the logarithmic divergence is proportional to the ``tadpole'' -- the amplitude
for the massless scalar in question to be absorbed in the vacuum (or more precisely the genus $g_r$ contribution to this tadpole).
In many supersymmetric compactifications, one can use spacetime supersymmetry to show that the integrated tadpoles vanish (in other words,
for all values of $g_r\geq 1$, the one-point function for a massless scalar vertex operator inserted on a surface $\Sigma_r$ of genus $g_r$ vanishes
after integration over the moduli of $\SIgma_r$).  In section \ref{supersym}, we explain how this is proved and also how the proof can fail
when a potential Goldstone fermion is present.

But even when the integrated tadpoles vanish for all massless particles, the integrals defining $g$-loop scattering amplitudes with $g>0$
are at best only conditionally convergent, because in the region in which $\Sigma$ degenerates in the fashion indicated in fig. \ref{Tadpolefig},
one gets one answer (the contribution of any given massless scalar is divergent) by integrating first over $q$, and a different answer (the contribution
of the massless scalar is 0) by integrating first over the moduli of $\Sigma_r$.   In some low order cases, one can find a suitable regularization of
the conditionally convergent integrals by hand, but in general one requires the procedure described in section \ref{regu}.  For analysis of
the tadpole problem using that procedure, see section 7.6 of \cite{Revisited}.

In field theory, to make sense of perturbation theory in a similar situation, one requires either vanishing of the tadpole or else a shift
in the vacuum to cancel it.  The techniques to analyze superstring perturbation theory when a shift in the vacuum is required have been developed
in \cite{ASen}.

\subsubsection{The Analog For Super Riemann Surfaces}\label{srsan}

Now we will explain the analog of equation (\ref{zuggle}) for super Riemann surfaces. We will only consider the case that the string state
propagating between $\Sigma_\ell$ and $\Sigma_r$ is in the NS sector.  (See section \ref{where} for Ramond sector gluing.)
Again we start with a holomorphic sector or with open strings.

We use local superconformal coordinates $x|\theta$ on $\Sigma_\ell$ and $y|\psi$ on $\Sigma_r$.  
We need a slight generalization of eqn. (\ref{melk}) so that at $\varepsilon=0$, the point $x|\theta=a|\alpha$ in $\Sigma_\ell$
is glued to $y|\psi=b|\beta$ in $\Sigma_r$. The resulting formula \begin{align}\label{iblondo} (x-a-\alpha\theta)(y-b-\beta\psi)& =-\varepsilon^2 \cr
                                         (y-b-\beta\psi)(\theta-\alpha) & = \varepsilon(\psi-\beta) \cr
                                          (x-a-\alpha\theta)(\psi-\beta)&= -\varepsilon(\theta-\alpha)\cr
                                                              (\theta-\alpha)(\psi-\beta)& = 0\end{align}
                                                    can be obtained from eqn. (\ref{melk}) by global supersymmetry transformations of $x|\theta$ and $y|\psi$.
                                                    But all we really need to know is the scaling behavior:
\begin{align}\label{ipooz} (x,a,\alpha)\to &(\lambda x,\lambda a,\lambda^{1/2}\alpha) \cr
                                     (y,b,\beta)\to & (\h\lambda y,\h\lambda b,\h\lambda^{1/2}\beta)\cr
                                      \varepsilon\to& (\lambda\h\lambda)^{1/2}\varepsilon. \end{align}
In particular, given the scaling of $\varepsilon$, we can see what must be the analog of eqn. (\ref{zuggle}):
\begin{equation}\label{superzuggle}\d a\,\d\alpha \,\V(a|\alpha)\cdot {\d \varepsilon}\,{\varepsilon^{2L_0-2}}\cdot \d b\,\d\beta\,\h\V(b|\beta).\end{equation} 
Here $\V$ and $\h\V$ are conjugate superfields with given $L_0$.

A physical state  from the NS sector is represented by a superconformal primary field $\V$ of $L_0=1/2$.   The
integral $\int_0^\Lambda \d\varepsilon \,\varepsilon^{2L_0-2}\sim 1/(2L_0-1)$ has a pole at $L_0=1/2$, quite analogous to the pole discussed in
section \ref{tadpole} above.  The residue of the pole comes from the insertion of the integrated vertex operator $\int \d a\,\d\alpha\, \V(a|\alpha)$ on
$\Sigma_\ell$ and of its conjugate on $\Sigma_r$.
In particular, integration over $\alpha$ and $\beta$ projects onto the top components of the vertex operators and in that sense the pole is
associated to propagation of the top component.                                   

\subsubsection{The Boundary Correction}\label{bcor}

We are, however, interested not in the pole associated to a physical state, but in a subtlety associated to the existence of the  operator
$V_D$ that is associated to spontaneous supersymmetry-breaking.  This field
is a conformal primary of dimension $(1,1)$, but not a superconformal primary.  It is the bottom component of a supermultiplet, not the top
component.  Its contribution to the measure near $\varepsilon=0$ is obtained by setting $L_0=1$ in (\ref{superzuggle}):
\begin{equation}\label{specialzuggle}\d a\,\d\alpha \,V_D(a) \cdot \d\varepsilon \cdot \d b\,\d\beta\,V_D(b). \end{equation}

We stress that as $V_D$ is the bottom component of a supermultiplet, it depends only on the bosonic coordinates $a$ and $b$ and not
on the fermionic coordinates $\alpha$ and $\beta$.  For two reasons,   the contribution of $V_D$ looks completely harmless:
the differential form written in (\ref{superzuggle}) has no singularity at all at $\varepsilon=0$, and anyway, this expression looks
like it will vanish after integration over $\alpha$ and $\beta$, since the integrand has no dependence on those odd variables.

Both of these arguments have fallacies that echo what was explained in section \ref{moresplit}.
To explain this, we need a formula more complete than (\ref{specialzuggle}) that includes the antiholomorphic degrees of freedom.
In the case of the heterotic string, the antiholomorphic variables are governed by the bosonic string formula (\ref{zuggle}).  Hence a more complete
analog of (\ref{specialzuggle}) is
\begin{equation}\label{bigzuggle}\d^2a\,\d\alpha\,V_D(\t a;a)\cdot \frac{\d \t q}{\t q}\,\d\varepsilon \cdot\d^2b \,\d\beta\, V_D(\t b; b).\end{equation}
We are in the same situation as in section \ref{moresplit}.  The integral
\begin{equation}\label{factorzuggle} \d\alpha \cdot \frac{\d \t q}{\t q} \d\varepsilon \cdot \d\beta \end{equation}
is scale-invariant, that is, it is invariant both under holomorphic scaling $\alpha\to \lambda^{1/2}\alpha$, $\beta\to \h\lambda^{1/2},$
$\varepsilon\to \lambda^{1/2}\h\lambda^{1/2}\varepsilon$, and antiholomorphic scaling $\t q\to \t\lambda \t q$. (The remaining factors $\d^2a\,V_D(\t a;a)$
and $\d^2b\,V_D(\t b;b)$ in (\ref{bigzuggle}) are also scale-invariant.)  Thus, we are in a situation very close
to that of section \ref{moresplit}.  The integral in (\ref{factorzuggle}) is only conditionally convergent.
It vanishes if we integrate first over $\alpha$ and $\beta$ keeping fixed the bosonic variables, but not if we integrate over $\alpha$ and $\beta$
keeping fixed some other combination such as $\varepsilon+\alpha\beta$.  

The procedure of \cite{DPh} for computing the 2-loop vacuum amplitude amplitude amounts to integrating over the
odd variables while holding fixed not $\t q$ and $\varepsilon$ but $\t q$ and $\varepsilon^*=\varepsilon+\alpha\beta$.   
(The reason for this is that, as we will see in eqn. (\ref{metzo}), it is not $q_\NS=-\varepsilon^2$
but $q_\NS^*=-(\varepsilon^*)^2$ that is a matrix element of the super period matrix $\hat\Omega$.)  
Likewise,  the general procedure explained in section \ref{gluehol} tells us to set $\bar{\t q}=q_\NS(1+\dots)$ near
$\t q=q_\NS=0$ (the ellipses represent arbitrary nilpotent terms), but the procedure of \cite{DPh} is slightly different.
In that formulation, antiholomorphic moduli are taken to be complex conjugates of the matrix elements of $\hat\Omega$, so in particular the relation
between $\t q$ and $q^*_\NS$ is $\bar{\t q}=q_\NS^*$.  

To compare the two approaches, we define
\begin{equation}\label{mytro}\varepsilon^\star = \varepsilon+h(\t q;\neg q_\NS)\alpha\beta,\end{equation}
where $h(\t q;\neg q_\NS)$, which plays essentially the same role\footnote{In the comparison between the two
problems, $\varepsilon$ corresponds to $\h z$ and $\varepsilon^\diamond$ to $z$.  The  function $h$ in (\ref{mytro}) really
corresponds to $1-h$ in (\ref{urok}), because we started the present analysis with the gluing parameter $\varepsilon$,
while in section \ref{moresplit}, we began the analysis with the bosonic variable $z$ rather than the gluing parameter $\h z$. }   
as the function  $h(\t z;\neg z)$ of eqn. (\ref{urok}), is any function that equals 0 for
$\t q q_\NS<\eta^2$ (for some small positive $\eta$) and 1 for, say, $\t q q_\NS>2\eta^2$.   The first condition ensures that
$\varepsilon^\star$ agrees with $\varepsilon$ near $\t q=q_\NS=0$, and the second condition ensures that except very near $\t q=q_\NS=0$,
$\varepsilon^\star$ coincides with $\varepsilon^*$, the variable effectively used in \cite{DPh}.  

Our integration procedure then is to set $\bar{\t q}$ equal to $q_\NS^\star=-(\varepsilon^\star)^2$ and to integrate over $\alpha$ and $\beta$
holding $\t q$ and $\bar{\t q}$ fixed.  This procedure is correct near $\t q=q_\NS=0$.  Away from $\t q=q_\NS=0$, it does not matter exactly what we do.  The procedure of setting $\bar{\t q}$ equal to $q_\NS^\star$
has been chosen to agree away from $\t q =q_\NS=0$  with the procedure used in \cite{DPh}.  

To actually calculate the integral, we proceed as in section \ref{moresplit}.    Eqn. (\ref{mytro})
is equivalent to $\varepsilon=\varepsilon^\star-\alpha\beta h(\t q;\neg -({\varepsilon^\star})^2)$.  (This is because the differences between $\varepsilon$,
$\varepsilon^\diamond$, and $\varepsilon^*$ are of order $\alpha\beta$, and vanish when multiplied by $\alpha\beta$.)  So
\begin{equation}\label{lunky} \d\varepsilon=\d\varepsilon^\star\left(1+2\alpha\beta\varepsilon^\star \frac{\partial}{\partial q^\star_\NS}h(\t q;\neg q_\NS^\star)
\right)+\dots , \end{equation}
where we only indicate the terms proportional to $\d\varepsilon^\star$ on the right hand side.  
Equivalently,
\begin{equation}\label{unky}\d\varepsilon=\d\varepsilon^\star-\alpha\beta \d q_\NS^\star\frac{\partial}{\partial q^\star_\NS}\left(h(\t q;\neg q_\NS^\star)-1\right)+\dots. \end{equation}
We  set $2\d\varepsilon^\star\cdot \varepsilon^\star=-\d q_\NS^\star$, and we used the fact that $h$ and $h-1$ have the same derivative.
We use this expression to substitute for $\d\varepsilon$
in favor of $\d\varepsilon^\star$ or equivalently $\d q_\NS^\star$ in the integral (\ref{factorzuggle}).  Setting also $q_\NS^\star =\bar{\t q}$, the term  in (\ref{lunky})
that will survive when we integrate
over $\alpha$ and $\beta$ at fixed $\t q$ and $\bar {\t q}$ is the term proportional to $\alpha\beta\d q^\star_\NS$.  The contribution of this term in
(\ref{factorzuggle}) is 
\begin{equation}\label{lonely} \d \t q\d \bar{\t q}\d\alpha\d\beta \, \frac{\alpha\beta}{\t q}\frac{\partial }{\partial \bar{\t q}}(h(\t q;\bar{\t q})-1).\end{equation} 
To evaluate this, we simply integrate by parts.  There is no surface term at large $\t q$ (where the approximations used in arriving at (\ref{lonely})
would not be valid) since $h-1=0$ at large $\t q$.  There is a contribution at $\t q=0$ that comes from 
\begin{equation}\label{indox}\frac{\partial}{\partial \bar{\t q}}\, \frac{1}{\t q}=2\pi \delta^2(\t q). \end{equation}  
With the help of this formula, and the fact that $h(0;\neg 0)=0$, the integral over $\t q$, $\bar {\t q}$, $\alpha$, and $\beta$ just gives $2\pi$.

We still have to integrate the remaining factors $\d^2 a V_D(\t a;a) \,\d^2 b V_D(\t b;b)$ in (\ref{bigzuggle}), and integrate over the bosonic
moduli (the $\tau$ parameters) of $\Sigma_\ell$ and $\Sigma_r$.  Since $\Sigma_\ell$ and $\Sigma_r$ each have genus 1, these integrals\footnote{As
$\Sigma_\ell$ and $\SIgma_r$ have genus 1, the $\d^2 a$ and $\d^2 b$ integrals can be factored out using the translation symmetries of $\Sigma_\ell$
and $\Sigma_r$. To this
end, one might prefer to make the whole derivation starting with a variant of  eqn. (\ref{umbro}) expressed in terms of unintegrated vertex operators. See
for instance section 6.4.4 of \cite{Revisited}.}
give two factors of the 1-loop expectation value $\langle V_D\rangle$.  Restoring also the factor of $g_\st^2$ that was suppressed in eqn.
(\ref{zuggle}), the contribution of this calculation to the two-loop vacuum energy is $2\pi g_\st^2\langle V_D\rangle^2$. 

 This correction at infinity to the D'Hoker-Phong procedure \cite{DPh} is the full answer
since, as shown in \cite{DPhlatest,Wittennew},  in a general heterotic string 
compactification to four dimensions that has spacetime supersymmetry at tree level, the D'Hoker-Phong procedure  gives 0 for the bulk contribution to the two-loop
vacuum energy.




\subsubsection{Other Boundary Corrections?}\label{otherbound}

In this derivation, starting in eqn. (\ref{bigzuggle}), we have made a simplified approximation to the measure on supermoduli
space that comes from  the worldsheet
path integral, considering only the contribution of the vertex operator $V_D$.   The full measure is of course far more complicated.
We have chosen
an integration procedure that agrees with that of \cite{DPh} except very near $\t q=q_\NS=0$, but gives a correction there
for the contribution of $V_D$.  Does this procedure lead to any other corrections?


Consider the propagation between $\Sigma_\ell$ and $\Sigma_r$ of an arbitrary NS sector state represented by a superfield
$\O(\t z;\neg z|\theta)$.  Let $\h \O(\t z;\neg z|\theta)$ be the conjugate superfield.  Suppose that the bottom component of $\O$
has holomorphic and antiholomorphic conformal dimensions $(L_0,\t L_0)$.  Then the analog of (\ref{bigzuggle}) for the contribution
of this superfield is
\begin{equation}\label{tolomo}\d^2 a \,\d \alpha\,\O(\t a;\neg a|\alpha)\d\t q\,\t q^{\t L_0-2}\,\d\varepsilon\,\varepsilon^{2L_0-2}
\h \O(\t b;\neg b|\beta)\, \d^2 b \,\d\beta,\end{equation}
with an insertion of $\O$ on one side and of $\h \O$ on the other.

 A preliminary comment is
that only the contribution of the bottom components of the superfields can lead to the sort of subtlety discussed in this paper.   (For example,
$V_D$ is such a bottom component.)  Indeed, if $\O(\t a;\neg a|\alpha)=\O_0(\t a;\neg a)+\alpha \O_1(\t a;\neg a)$,
$\h \O(\t b;\neg b|\beta)=\h \O_0(\t b;\neg b)+\beta\h \O_1(\t b;\neg b)$, then contributions involving $\O_1$ or $\h \O_1$
are unaffected by a change of variables in which a multiple of $\alpha\beta$ is added to $\varepsilon$, simply because
$\alpha^2=\beta^2=0$.
Also, the only potentially dangerous case is $L_0=\t L_0$, since otherwise, after setting $\bar{\t q}=q_\NS$ near $\t q=0$, a possible surface term vanishes upon integration
over $\mathrm{Arg}\,\t q$.  For $L_0=\t L_0\not=1$, a possible boundary contribution is multiplied by $(q_\NS \t q)^{L_0-1}$ relative
to what we had in studying $V_D$, where $q_\NS,\t q\to 0$ at the boundary. For $L_0=1$, the boundary
correction is nonzero and interesting, as we have seen.  For $L_0<1$, it would be divergent (and 
in general this will lead to spurious 
infrared divergences if one uses the wrong integration procedure at infinity).  For $L_0>1$, the boundary correction 
vanishes.
Finally, obviously the splitting of a genus 2 surface to a pair of genus 1 surfaces with insertions of $\O_0$ and $\h\O_0$
on the two branches can only lead to a boundary term if $\O_0$ and $\h\O_0$ have nonvanishing 1-point functions\footnote{With an integration
procedure that preserves all the conformal symmetry, the only operators whose 1-point functions can be defined and can play a role are conformal vertex operators
(see section \ref{cvo}).  With a more general integration procedure, more general 1-point functions can enter.}   in genus 1.

The existence of potentially troublesome operators is model-dependent.  Let us discuss the one such operator
that always exists; 
this is the identity operator, with $L_0=\t L_0=0$. (In many simple models, such as toroidal compactifications, it is the only
operator that satisfies the criteria.)
The corresponding contribution to the measure is
\begin{equation}\label{wolomo}\d^2 a \,\d\alpha \, \frac{\d \t q}{\t q^2}\frac{\d\varepsilon}{\varepsilon^2}\d^2 b\,\d\beta.\end{equation}

The integral over $\t q $ and $\varepsilon$ looks divergent. This apparent divergence
is the contribution of the NS sector tachyon, whose vertex operator at zero momentum is the identity operator.  The NS sector tachyon is not a physical state of superstring theory, so we do not expect a tachyon divergence in the integration over moduli.   It is tempting to argue that the tachyon divergence is eliminated because, as the expression (\ref{wolomo})
does not depend on $\alpha$ and $\beta$, the Berezin integral over those parameters, keeping fixed $\t q $ and with  $\bar {\t q}$ set to $-\varepsilon^2$,
 vanishes.  (The expression explicitly written in eqn. (\ref{wolomo}) should be multiplied by other factors that depend only on the moduli of $\Sigma_\ell$ and $\Sigma_r$ and not on $\alpha$ and $\beta$; this does not affect the suggestion that was just made.)  The trouble with this argument
is that in general, because of the dependence of the gluing operation (\ref{iblondo}) on choices of local parameters $x|\theta$ and $y|\psi$, $\varepsilon$ is 
really  only defined modulo \begin{equation}\label{zinbo}\varepsilon\to 
\varepsilon'=\varepsilon e^w,\end{equation}  where $w$
is a function of the other moduli (in general including $\alpha$ and $\beta$) that is holomorphic at $\varepsilon=0$.  Any function $\varepsilon'=\varepsilon
e^w$ has a simple zero along the divisor at infinity and (if $w$ is constrained by GSO symmetry as in footnote \ref{zone} below) is as natural as any other such function.   Integration over $\alpha$ and $\beta$ keeping fixed $\t q$ and with $\bar{\t q}$
set to $-(\varepsilon')^2$ does not necessarily eliminate the tachyon contribution.


What really does eliminate the tachyon contribution is the GSO projection\footnote{\label{zone} The function $w$ in eqn. (\ref{zinbo}) can be somewhat constrained by GSO symmetry; at $\varepsilon=0$, one can require $w$ to be invariant
under a sign change of all odd moduli of $\SIgma_\ell$, or all odd moduli of $\SIgma_r$.  In general (if $\Sigma_\ell$ and $\Sigma_r$ have additional
odd moduli), this condition allows $w$ to depend nontrivially
on $\alpha$ and $\beta$ and hence does not affect the discussion surrounding eqn. (\ref{zinbo}).  However, for the genus 2 vacuum amplitude, with $\alpha$ and $\beta$
being the only odd moduli, GSO symmetry implies that $w$ is independent of $\alpha$ and $\beta$ at $\varepsilon=0$ and hence does not play any
important role.  So in that particular case, there is a natural sense in which integration over $\alpha$ and $\beta$ kills the tachyon contribution
at a separating degeneration without reference to the GSO projection.  (For a corresponding study of a nonseparating degeneration,
see section 5.3 of \cite{holomorphy}.)} 
 \cite{GOS}, which roughly is the sum over the two possible signs of $\varepsilon$
for given $q_\NS=-\varepsilon^2$.  

 However, let us see what happens if we follow a similar procedure, but after
replacing $\varepsilon$ with $\varepsilon^*=\varepsilon+\alpha\beta$ (which notably  is not of the form $\varepsilon e^w$, so it is not a good parameter
defining the divisor at infinity). In terms of $\varepsilon^*$, (\ref{wolomo}) becomes
\begin{equation}\label{zolomo}\d^2 a \,\d\alpha \frac{\d\t q}{\t q^2}\frac{\d\varepsilon^*}
{(\varepsilon^*-\alpha\beta)^2}\d^2 b\,\d\beta.\end{equation}
After integrating over $\alpha$ and $\beta$ and setting $q=-(\varepsilon^*)^2 =\bar{\t q}$, we get
\begin{equation}\label{polomo} \d^2a \,\frac{\d\t q\cdot \d q}{\t q^2q^2}\,\d^2b. \end{equation}
Comparing to the bosonic string formula (\ref{zuggle}), we see that this is the contribution one would expect from the identity
operator (of $L_0=\t L_0=0$) in bosonic string theory.  It is not a natural behavior in superstring theory.  This singular behavior was found\footnote{See eqn. (10.4) in that paper.
In that equation, $\d^3\tau$ corresponds to, in our notation of section \ref{splitor}, $\d\tau_{\ell\ell}\d\tau_{rr}\d\tau_{\ell r}$;
and $\tau=\tau_{\ell r}=q$.
So $\d^3\tau/\tau^2\sim \d q/q^2$ (times $\d\tau_{\ell\ell}\d\tau_{rr}$), which is the behavior claimed in (\ref{polomo}).} in the work
reviewed in \cite{DPh}.  This caused no difficulty because the unwanted term (\ref{polomo}), with
a natural regularization, canceled upon summing over spin structures on $\SIgma_\ell$ and $\Sigma_r$.

At least near the large volume limit of the sigma-model, similar reasoning applies for all bosonic
operators of $L_0<1$.  Such operators are constructed from
the bosonic fields of the sigma-model only, since a fermion bilinear would contribute 1 to $L_0$.
Insertion on a genus 1 surface of an operator constructed from bosonic fields only does not disturb the GSO cancellation.

 


\subsection{Details Concerning The Super Period Matrix}\label{details}

Let us first recall the definition of the period matrix of an ordinary Riemann surface $\Sigma_0$ of genus $g$.  $\Sigma_0$ has a $g$-dimensional
space of holomorphic 1-forms $\omega_1,\dots,\omega_g$.  We pick a symplectic basis of 1-cycles $A^i$, $B_j$, $i,j=1,\dots ,g$, and normalize
the $\omega_i$ so that
\begin{equation}\label{tendox}\oint_{A^i}\omega_j=\delta^i_j. \end{equation}
Then the period matrix is defined by
\begin{equation}\label{mendox}\Omega_{ij}=\oint_{B_i}\omega_j. \end{equation}
Since the $\omega_i$, being holomorphic, are closed, the condition (\ref{tendox}) and the definition (\ref{mendox}) of $\Omega_{ij}$ depend
only on the homology classes of the cycles $A^i$ and $B_j$.  

Almost the same definition makes sense on a super Riemann surface $\Sigma$, with some qualifications (see \cite{RSV,DPhtwo}, and section 8
of \cite{Surfaces}).  First of all, the closest analog of the
theory of the ordinary period matrix arises if the spin structure of $\Sigma$ is even.  In this case, generically there is a $g$-dimensional space
 of
closed\footnote{On a super Riemann surface, as opposed to an ordinary one, a holomorphic 1-form is not always closed. For
brevity, we omit an alternative description of the super period matrix, explained in the references, in terms of holomorphic sections of the Berezinian of $\Sigma$.} holomorphic one-forms $\h\omega_i$, $i=1,\dots,g$ on $\Sigma$.  (This fails when the reduced space $\SIgma_0$ of $\Sigma$ has $H^0(\SIgma_0,K^{1/2})\not=0$; then the super period
matrix acquires a pole with nilpotent residue, as explained in footnote \ref{helplater}.)  We pick a symplectic basis of cycles $A^i$ and $B_j$ in $\Sigma$ of dimension
$1|0$ (one can take any cycles of dimension $1|0$ that can be deformed to ordinary $A$- and $B$-cycles in the reduced space $\Sigma_0$ of $\Sigma$) and
after normalizing the $\h\omega_i$ so that 
\begin{equation}\label{tendlox}\oint_{A^i}\h\omega_j=\delta^i_j, \end{equation}
we define the super period matrix  by
\begin{equation}\label{endox}\hat\Omega_{ij}=\oint_{B_i}\h\omega_j. \end{equation}
It can be shown to be symmetric, just like the classical period matrix defined in (\ref{mendox}).

Now we consider the case of a Riemann surface or super Riemann surface of genus 2 that is splitting into a union of two components $\Sigma_\ell$
and $\Sigma_r$ of genus 1,
meeting at a point (fig. \ref{Question}).  We want to show that for ordinary Riemann surfaces, the gluing parameter $q$ can be expressed as
a matrix element of the period matrix, while for a super Riemann surface, the gluing parameter $\varepsilon$ cannot be expressed in terms of
the super period matrix.  This is the key point that led to the boundary correction in section \ref{bcor}.

\subsubsection{Period Matrix And Gluing Parameter Of An  Ordinary Riemann Surface}\label{splitor}

For an ordinary Riemann surface $\Sigma_0$ of genus 2 
that has split into two genus 1 components $\Sigma_{0,\ell}$ and $\Sigma_{0,r}$ joined at a point, we can be very explicit
about the period matrix. Let $\tau_\ell$ and $\tau_r$ be the modular parameters of $\SIgma_{0,\ell}$ and $\Sigma_{0,r}$.  We describe
$\Sigma_{0,\ell}$ as  the quotient of the complex $z_\ell$-plane by
\begin{equation}\label{dumbry} z_\ell\cong z_\ell+1\cong z_\ell+\tau_\ell \end{equation}
and similarly $\Sigma_{0.r}$ as the quotient of the complex $z_r$-plane by
\begin{equation}\label{umbry} z_r\cong z_r+1\cong z_r+\tau_r. \end{equation}
We let $A^\ell$ and $B_\ell$ be standard $A$- and $B$-cycles in $\Sigma_{0,\ell}$: $A^\ell$ is the image in $\Sigma_{0,\ell}$ of a straight line
from $z_\ell=0$ to $z_\ell=1$, and $B_\ell$ is the image of a straight line from $z_\ell=0$ to $z_\ell=\tau_\ell$.  We define $A^r$ and $B_r$ in
a completely analogous way as standard $A$- and $B$-cycles in $\Sigma_{0,r}$.    

Suppose that $\Sigma_0$ is built by gluing the point $z_\ell=a$ in $\Sigma_{0,\ell}$ to the point $z_r=b$ in $\Sigma_{0,r}$. 
(We pick $a$ and $b$ to not lie on any of the chosen  $A$- or $B$-cycles or alternatively we deform the cycles to avoid $a$ and $b$. By translation symmetry, the choices of $a$ and $b$ do not matter.)
On $\Sigma_0$, we can take a basis of holomorphic differentials $\omega_\ell=\d z_\ell$ and $\omega_r=\d z_r$.  Thus $\omega_\ell=0$
on $\Sigma_{0,r}$ (since $z_\ell$ is constant there) and likewise $\omega_r=0$ on $\Sigma_{0,\ell}$.
The periods of $\omega_\ell$ are
\begin{align} \oint_{A^\ell}\omega_\ell & = 1, ~~~~                        \oint_{B_\ell}\omega_\ell = \tau_\ell \cr
                         \oint _{A^r}\omega_\ell& =\int_{B_r}\omega_\ell=0. \end{align}
Similarly,
\begin{align} \oint_{A^r}\omega_r & = 1 ,~~~~~
                        \oint_{B_r}\omega_r = \tau_r \cr
                         \oint _{A^\ell}\omega_r& =\int_{B_\ell}\omega_r=0. \end{align}
These formulas show that the period matrix of $\Sigma_0$ in the basis $\begin{pmatrix}A_\ell\cr A_r\end{pmatrix}$ is
\begin{equation}\label{periodmatrix} \Omega=\begin{pmatrix}\tau_\ell & 0 \cr 0 & \tau_r \end{pmatrix}.\end{equation}  
In other words, $\Omega_{\ell\ell}=\tau_\ell$, $\Omega_{rr}=\tau_r$, and $\Omega_{\ell r}=\Omega_{r\ell}=0$. 

Now let us perturb $\Sigma_0$ slightly so that $\Sigma_{0,\ell}$ and $\Sigma_{0,r}$ are joined through a very narrow neck.
Near $z_\ell=a$, $z_r=b$, we glue the two branches  by
\begin{equation}\label{refo} (z_\ell-a)(z_r-b)=q. \end{equation}
When modifying $\Sigma_0$ in this way, we want to modify $\omega_\ell$ and $\omega_r$ so that they continue to have canonical $A$-periods:
\begin{align}\label{nope}\oint_{A^\ell}\omega_\ell & = \oint_{A^r}\omega_r=1\cr
                                           \oint_{A^r}\omega_\ell& = \oint_{A^\ell}\omega_r=0 .\end{align}
Their $B$-periods will then give the deformed period matrix.   We are primarily interested in the off-diagonal component of the deformed
period matrix, which will be non-zero because for $q\not=0$, $\omega_\ell$ is non-zero on $\Sigma_{0,r}$.                                           
From (\ref{refo}), we have 
\begin{equation}\label{momf}\d z_\ell = \d(z_\ell-a)=q\,\d\frac{1}{z_r-b}=-\frac{q \,\d z_r }{(z_r-b)^2}.\end{equation}  
This implies that a form that at $q=0$ is simply $\omega_\ell=\d z_\ell$ and  vanishes on $\Sigma_{0,r}$ will, in linear order in $q$,
become non-zero on $\Sigma_{0,r}$ with the double pole indicated in (\ref{momf}) near $z_r=b$.
The most general 1-form on $\Sigma_{0,r}$ that is holomorphic except for such a double pole is
\begin{equation}\label{delfry}\omega_\ell^{(1)}=  q\cdot     \d z_r\bigl(-\,P(z_r-b;1,\tau_r) + w\bigr) \end{equation}
where $P$ is the Weierstrass $P$-function and $w$ is a constant.   $P(z_r-b;1,\tau)$ is a doubly-periodic
 function that is holomorphic away from $z_r=b$ and behaves for $z_r\to b$ as
\begin{equation}\label{gomely} P(z_r-b;1,\tau)\sim \frac{1}{(z_r-b)^2}+   \O((z_r-b)^2).\end{equation}
These conditions characterize it uniquely.  To compute the correction to the period matrix, we are supposed to adjust the constant
$w$ so that
\begin{equation}\label{omely}\int_{A^r}\omega^{(1)}_\ell=0,\end{equation}
and then  (up to further corrections of higher order in $q$) the off-diagonal matrix element of the period matrix is
\begin{equation}\label{zomely}\Omega_{lr}=\int_{B_r}  \omega^{(1)}_\ell=q\int_{B_r}  \d z_\ell(-P(z_r-b;1,\tau) +w). \end{equation}

This formula shows that to first order in $q$, the off-diagonal matrix element of the period matrix is a multiple of $q$.  We will now determine the precise coefficient in this relation.  We do the following
computations on the unperturbed surface $\Sigma_{0,r}$ defined in eqn. (\ref{umbry}); we have already an explicit factor of $q$
in  $\omega_\ell^{(1)}$, and we can set $q$ to zero elsewhere.

It is not quite true that the form $\omega_\ell^{(1)}$  is closed.  The familiar relation 
\begin{equation}\label{mexico}\frac{\partial}{\partial\bar z_r}\frac{1}{z_r-b}=2\pi \delta^2(z_r-b) \end{equation}
implies by differentiating with respect to $z_r$ that
\begin{equation}\label{exico}\frac{\partial}{\partial\bar z_r}\frac{1}{(z_r-b)^2}=-2\pi\partial_{z_r} \delta^2(z_r-b) \end{equation}
and hence, because of the double pole in $\omega_\ell^{(1)}$,  that 
\begin{equation}\label{flexico}\d \omega_\ell^{(1)}=\d\bar z_r \wedge \d z_r 2\pi q\partial_{z_r}\delta^2(z_r-b)=-\d(\d\bar z_r \cdot 2\pi q\delta^2(z_r-b)). \end{equation}
An ``improved'' version of $\omega_\ell^{(1)}$ which can equally well be used in (\ref{zomely}) and which is closed is
\begin{equation}\label{rexoc}\omega_\ell^{(1*)}= \omega_\ell^{(1)}+\d\bar z_r\cdot 2\pi q\delta^2(z_r-b).\end{equation}
Since $B_r$ does not pass through $b$, the extra term that we have added does not contribute in (\ref{zomely}).

Now if $s$ and $t$ are any two closed one-forms on the two-torus $\Sigma_{0,r}$, we have the topological formula
\begin{equation}\label{motoro}\int_{\Sigma_{0,r}}s\wedge t = \oint_{A^r}s\oint_{B_r}t-\oint_{B_r}s\oint_{A^r}t. \end{equation}
We apply this formula with $s=\d z_r$, $t=\omega_\ell^{(1*)}$.  The left hand side receives a contribution only from the delta function term
in $\omega_\ell^{(1*)}$, and so equals $2\pi q$.   Since the $A^r$ period of $s$ is 1 and the $A^r$ period of $t$ is 0, the right hand side of (\ref{motoro})
is equal to the $B_r$ period of $t$, which by definition is
 $\Omega_{\ell r}$.  So we get the precise relation between the gluing parameter $\Omega_{\ell r}$ and $q$:
\begin{equation}\label{turnkey}\Omega_{\ell r}=2\pi q. \end{equation}

\subsubsection{Period Matrix And Gluing Parameter Of A Super Riemann Surface}\label{splitsuper}

Starting with an ordinary Riemann surface $\Sigma_0$ with a choice of spin structure, one can build a super Riemann surface $\Sigma$
in a natural way.  If $\Sigma_0$ is covered by open sets $U_\alpha$ with local coordinates $z_\alpha$, such that $z_\alpha=u_{\alpha\beta}(z_\beta)$
in intersections $U_\alpha\cap U_\beta$, then $\SIgma$ is covered by the same open sets $U_\alpha$ with local superconformal coordinates
$z_\alpha|\theta_\alpha$, and gluing rules
\begin{align} z_\alpha & = u_{\alpha\beta}(z_\beta)\cr
                    \theta_\alpha & = \left(\frac{\partial u_{\alpha\beta}}{\partial z_\beta}\right)^{1/2}\theta_\beta. \end{align}
(The role of the spin structure on $\Sigma_0$ is to determine the signs of the square roots.)  From this, it is clear that there is a holomorphic
embedding $i:\Sigma_0\to\Sigma$ that maps $z_\alpha$ to $z_\alpha|0$, and a holomorphic projection $\pi:\Sigma\to\Sigma_0$
that maps $z_\alpha|\theta_\alpha$ to $z_\alpha$.  Moreover, $\pi\circ i=1$.   The super Riemann surface $\Sigma$ is said to be ``split'' and
$\Sigma_0$ is called its reduced space.  From a supergravity point of view, the gravitino field vanishes in a split super Riemann surface; its odd moduli are zero.


To develop the theory of super period matrices, we assume that the spin structure of $\Sigma_0$ is
even and that $\Sigma_0$ is sufficiently generic that $H^0(\Sigma_0,K^{1/2})=0$.  These conditions ensure that the space of closed
holomorphic 1-forms on $\SIgma$ has dimension $g|0$.

Given this,   the super period matrix $\hat\Omega$ of a split super Riemann surface $\Sigma$ equals the ordinary period matrix $\Omega$ of $\SIgma_0$.
Indeed, if $\omega_1,\dots,\omega_g$ are a basis of holomorphic 1-forms on $\Sigma_0$, then their pullbacks to $\Sigma$ (via the projection $\pi$) give  a basis
of closed holomorphic 1-forms $\h\omega_1,\dots,\h\omega_g$ on $\Sigma$.  $A$- and $B$-cycles on $\SIgma_0$ can be embedded in $\SIgma$ via
the embedding $i$.  Then the periods of the $\h\omega_i$ coincide with the periods of the $\omega_i$, so  
the definition (\ref{endox}) of the super period matrix reduces to the definition (\ref{mendox}) of the ordinary period
matrix.                 

Once one turns on the odd moduli of $\SIgma$, the $\h\omega_i$ need to be modified and
it is no longer true that $\hat \Omega$ coincides with $\Omega$.  The difference was computed
in \cite{DPhtwo}; see also section 8.3 of \cite{Surfaces}. For us, it will suffice to consider the case of two odd moduli (though the general case
is not much more complicated).  From a supergravity point of view, having two odd moduli means that we take the gravitino field to be
\begin{equation}\label{mexo}\chi_{\t z}^\theta=\sum_{s=1}^2\eta_s f^\theta_{s\,\t z}, \end{equation}
where $\eta_s$, $s=1,2$ are the odd moduli, and the gravitino wavefunctions $f_{s\,\t z}^\theta$, $s=1,2$, are $(0,1)$-forms on $\Sigma_0$ valued in $T^{1/2}$ (the inverse of the line
bundle $K^{1/2}\to\Sigma_0$ that defines the spin structure).   The difference
between $\hat\Omega$ and $\Omega$ is then given by an integral over a product $\SIgma_0\times \Sigma_0'$ of two copies of $\SIgma_0$,
which we parametrize respectively by $\t z,z$ and by $\t z',z'$:
\begin{equation}\label{turnok}\hat\Omega_{ij}-\Omega_{ij}=-\frac{1}{2\pi}\sum_{s,t=1}^2\eta_s\eta_t\int_{\SIgma_0\times \Sigma_0'}
\omega_j(z) f_{s\,\t z}^\theta(\t z;\neg z)\d\t z\, S(z,z') f_{t\,\t z'}^\theta\d\t z'\, \omega_i(z'). \end{equation}
(In this section, the difference between $\t z$ and $\bar z$ is generally not important, because all integrals will be taken
on ordinary Riemann surfaces.)  Here $S(z,z')$ is the Dirac propagator\footnote{\label{helplater}
This  propagator only exists if the Dirac equation has no zero-modes or in other words if $H^0(\Sigma_0,K^{1/2})=0$. As one varies $\Sigma_0$ in its moduli space $\M_g$, there is a divisor  in $\M_g$ along which $H^0(\SIgma_0,K^{1/2})\not=0$.
Along this divisor, $S(z,z')$ has a pole and hence $\hat\Omega_{ij}$ has a pole, with nilpotent residue.}   on $\SIgma_0$ (for the chosen spin structure); it obeys $S(z,z')=-S(z',z)$, and for fixed $z'$, it satisfies the Dirac
equation on $\Sigma_0$ with a simple pole of residue 1 at $z=z'$:
\begin{equation}\label{elbow} S(z,z')\sim \frac{1}{z-z'}\sqrt{\d z}\sqrt{\d z'},~~z\to z'. \end{equation}
The integral in (\ref{turnok}) is well-defined because $\omega_i$ and $\omega_j$ are $(1,0)$-forms, the $f$'s are $(0,1)$-forms valued in $T^{1/2}$, and as a function of either $z$ or $z'$,
$S$ is valued in $K^{1/2}$, which is the dual of $T^{1/2}$.

We want to apply this to the case that $\Sigma_0$ is a surface of genus 2 built by gluing together two genus 1 surfaces $\SIgma_{0,\ell}$
and $\SIgma_{0,r}$, each with an even spin structure.  In this case, the genus 2 super Riemann surface $\SIgma$ is likewise built
by gluing together genus 1 super Riemann surfaces $\Sigma_\ell$ and $\SIgma_r$.  $\Sigma_\ell$ is parametrized by superconformal
coordinates $z_\ell|\theta_\ell$ with equivalences 
\begin{equation}\label{hro}z_\ell|\theta_\ell\cong z_\ell+1|\pm \theta_\ell \cong z_\ell+\tau_\ell|\pm \theta_\ell\end{equation}
(where the signs depend on the spin structure and are not both positive, since the spin structure is even), 
and $\SIgma_r$ is parametrized by $z_r|\theta_r$ with analogous equivalences.
$\SIgma$ is built by gluing a marked
point $z_\ell|\theta_\ell=a|\alpha$ in $\SIgma_\ell$ to a marked point $z_r|\theta_r=b|\beta$ in $\SIgma_r$.  $\Sigma_\ell$ with its marked point has one odd modulus,
namely $\eta_\ell=\alpha$, and likewise $\Sigma_r$ with its marked point has one odd modulus, namely $\eta_r=\beta$.    The odd modulus of $\SIgma_\ell$ is
associated to a gravitino wavefunction $f_{\ell \,\t z_\ell}^{\theta_\ell}$ that is supported on $\SIgma_\ell$,
and the odd modulus of $\SIgma_r$ is associated to a gravitino
wavefunction $f_{r,\,\t z_r}^{\theta_r}$ that is supported on $\SIgma_r$.  These wavefunctions have special properties: the odd moduli
in question are trivial if one forgets about the marked points in $\SIgma_\ell$ and $\SIgma_r$, and this means that $f_{\ell\,\t z_\ell}^{\theta_\ell}$
and $f_{r\,\t z_r}^{\theta_r}$ can be gauged away, but not by gauge parameters that vanish at $z_\ell=a$ or $z_r=b$.   Rather
\begin{align}\label{believe} f_{\ell,\t z_\ell}^{\theta_\ell} & =\frac{\partial}{\partial \t z_\ell}w_\ell,~~~w_\ell(\t a;\neg a)=1 \cr
                    f_{r,\t z_r}^{\theta_r} & =\frac{\partial}{\partial \t z_r}w_r,~~~w_r(\t b;\neg b)=1 .\end{align}
However, we will postpone using this fact.  

We want to use  eqn. (\ref{turnok}) to compute the off-diagonal matrix element $\hat\Omega_{\ell r}$.  If $\SIgma$ is obtained by
gluing together $\SIgma_\ell$ and $\SIgma_r$, then we can take $\omega_\ell=\d z_\ell$, $\omega_r=\d z_r$, as in section \ref{splitor}.
In this case, since $\omega_\ell$ is supported on $\SIgma_\ell$ and $\omega_r$ on $\SIgma_r$, the integral in (\ref{turnok})
over $\Sigma_0\times\Sigma_0'$ becomes an integral over $\SIgma_{0,\ell}\times \SIgma_{0,r}$:
\begin{equation}\label{mizno} \hat\Omega_{\ell r}-\Omega_{\ell r}=-\frac{\alpha\beta}{\pi}  \int_{\Sigma_{0,\ell}\times \Sigma_{0,r}}
\omega_\ell f_{\ell\,\t z_\ell}^{\theta_\ell} (\t z_\ell; z_\ell)\,\d\t z_\ell\, S(z_\ell, z_r)f_{r\,\t z_r}^{\theta_r}(\t z_r;\neg z_r)\,\d \t z_r\, \omega_r. \end{equation}  
This vanishes as long as $\Sigma$ is made by simply gluing together $\Sigma_\ell$ and $\SIgma_r$ at a point, because in this case
the Dirac propagator $S(z,z')$ vanishes for $z\in \Sigma_\ell$, $z'\in \SIgma_r$.  

To get a nonzero result, we have to deform away from the case that $\Sigma_\ell$ and $\Sigma_r$ are simply glued together at a point,
and let the gluing parameter $\varepsilon$ become nonzero. At $\varepsilon=0$, $\SIgma_{0,\ell}$ has a Dirac propagator $S_\ell(z_\ell, z_\ell')$ and $\SIgma_{0,r}$ has a Dirac propagator
$S_r(z_r,z_r')$.    We claim that the small $\varepsilon$ behavior of the full Dirac propagator $S(z,z')$ for $z\in \SIgma_\ell$, $z'\in \SIgma_r$
is 
\begin{equation}\label{enzdob} S(z,z')=\varepsilon S_\ell(z,a)S_r(b,z')+\O(\varepsilon^3). \end{equation}
This formula arises as follows.\footnote{As will be clear from the derivation, the formula is the first term in an expansion in powers of $\varepsilon^2/(z_\ell-a)(z_r-b)$. The
correction to the leading term is of order $\varepsilon^3$, since the operator associated to the next-to-leading contribution is the descendant $\partial\psi$,
of dimension $3/2$.}  We interpret $S(z,z')=\langle\psi(z)\psi(z')\rangle$ as
 a two-point function in the conformal field theory of a free
fermion $\psi$.  In conformal field theory, propagation from $\Sigma_\ell$ to $\SIgma_r$ through the
narrow neck joining them can be expressed as a sum of contributions obtained by inserting an operator $\O$ at the point $a\in \SIgma_\ell$
and a conjugate operator $\h\O$ at the point $b\in \Sigma_r$, and multiplying by an $\varepsilon$-dependent factor that accounts for propagation
through the neck.  The insertion is thus $\O(a)\cdot F(\varepsilon)\cdot \h\O(b)$ for some $F(\varepsilon)$; this
is analogous to eqn. (\ref{umbro}), with the difference that we now considering a correlation function rather than a measure on moduli
space.   Scale-invariance determines that if $\O$ and $\h\O$ have a given value of $L_0$, then $F(\varepsilon)$ is
a multiple of $\varepsilon^{2L_0}$. The multiple is 1 if the genus zero  two-point function  $\langle\O(z) \h\O(z')\rangle$ is canonical.  For
small $\varepsilon$, the dominant contribution comes from the operators of lowest dimension that  contribute.  
In the case of free
fermion conformal field theory, this means that the dominant contribution to $\langle \psi(z)\psi(z')\rangle$, with $z\in \Sigma_\ell$, $z'\in \SIgma_r$, comes from $\O=\h\O=\psi$. This operator 
   has $L_0=1/2$,
so $\varepsilon^{2L_0}=\varepsilon$, accounting for the factor of $\varepsilon$ in (\ref{enzdob}); and $\psi$  has a canonical two-point function,
so the coefficient of $\varepsilon$ is 1. 
The upshot of all this is that the correlation function $\langle \psi(z)\psi(z')\rangle$ is,
to first order in $\varepsilon$, equal to $\varepsilon$ times 
 the correlation function
$\langle\psi(z)\psi(z')\psi(a)\psi(b)\rangle$ computed at $\varepsilon=0$.  That last correlation function
is the product of the relevant matrix elements of $S_\ell$ and $S_r$, and this leads to eqn. (\ref{enzdob}).
  
Now we insert (\ref{believe}) and (\ref{enzdob}) in the formula (\ref{mizno}) for $\h\Omega_{\ell r}-\Omega_{\ell r}$.  We also
set $\omega_\ell=\d z_\ell$, $\omega_r=\d z_r$.  We get
\begin{equation}\label{tenzo}\hat\Omega_{\ell r}-\Omega_{\ell r}=-\frac{\alpha\beta\varepsilon}{\pi} \int_{\SIgma_\ell} \d z_\ell \,\d\t z_\ell
\frac{\partial}{\partial \t z_\ell}w_\ell \cdot S(z_\ell,a)\cdot \int_{\SIgma_r} \d z_r \,\d\t z_r
\frac{\partial}{\partial \t z_r}w_\ell \cdot S(z_r,b) . \end{equation}
Upon integrating by parts in both integrals, using
\begin{equation}\label{wenzo}\frac{\partial}{\partial \t z_\ell} S(z_\ell,a)=2\pi \delta^2(z_\ell-a),~~ 
\frac{\partial}{\partial \t z_r} S(z_r,a)=2\pi \delta^2(z_r-a),\end{equation}
along with $w_\ell(\t a;\neg a)=w_r(\t b;\neg b)=1$, we get finally
\begin{equation}\label{genzo}\h\Omega_{\ell r}-\Omega_{\ell r}=-4\pi\varepsilon\alpha\beta. \end{equation}

To turn this into a formula for $\h\Omega_{\ell r}$, we also need to compute $\Omega_{\ell r}$.  This was evaluated, modulo higher
order corrections, 
 in eqn. (\ref{turnkey}), where we should now interpret $q$ as $q_\NS=-\varepsilon^2$.
 Combining these results, we get a formula for $\h\Omega_{\ell r}$:
\begin{equation}\label{yenzo}\h\Omega_{\ell r} =-2\pi (\varepsilon^2+2 \varepsilon\alpha\beta)=-2\pi(\varepsilon+\alpha\beta)^2.\end{equation}
So it is not $\varepsilon$ that can be expressed in terms of the super period matrix, but $\varepsilon+\alpha\beta$:
\begin{equation}\label{metzo}\varepsilon+\alpha\beta = \left(-\frac{\hat\Omega_{\ell r}}{2\pi}\right)^{1/2}. \end{equation}
This is the reason for the correction at infinity that was analyzed in section \ref{bcor}.  The procedure of \cite{DPh} involves holding
$\Omega_{\ell r}$ fixed when integrating over the odd variables, and therefore it involves holding $\varepsilon+\alpha\beta$ fixed;
but near $\varepsilon=0$, it is important to hold $\varepsilon$ fixed instead. 




          
                    
\section{The Supersymmetric Ward Identity}\label{supersym}

\subsection{Review Of Bosonic Symmetries}\label{bosreview}

Our final goal is to clarify at a fundamental level how it is possible for loop corrections in a given vacuum to spontaneously
break supersymmetry even if supersymmetry is unbroken at tree level in that vacuum.  (As usual, we do not consider the effects
of shifting the vacuum to try to restore supersymmetry.)
  It is essential to understand first why this is actually not possible for bosonic 
symmetries of oriented closed-string theories.\footnote{A rough analog of supersymmetry breaking by loops
does exist in open and/or unoriented
string theories: bosonic symmetries that hold at the closed-string tree level can be broken by open-string
boundary conditions and/or orientifold projections.}
Let us consider two rather different examples: momentum conservation and the anomalous $U(1)$ of the 
$SO(32)$ heterotic string on a
Calabi-Yau manifold.  Like all continuous bosonic symmetries of closed-string theories, these are associated 
to conserved currents on the
string worldsheet.  In bosonic string theory, momentum conservation is associated to the worldsheet current 
$J_\mu^I=\partial X^I/\partial\sigma^\mu$
(where the $\sigma^\mu,\,\mu=1,2$ are worldsheet coordinates and $X^I$ is a free field on the worldsheet 
representing motion of the string in the $x^I$
direction in spacetime).  In superstring theory, there is an analogous formula; the relevant conserved 
current is now part of a superfield on
the worldsheet, but this does not modify what follows in an essential way.  For the anomalous $U(1)$, 
the conserved current is the antiholomorphic
current $J_\ell =g^{i\bar i}\lambda_i\lambda_{\bar i}$ that is familiar from section \ref{mass}.  

\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Newtry29.pdf}
 \end{center}
\caption{\small To derive a Ward identity from a conserved current in closed string theory, we omit a small open ball around each vertex operator
in the string worldsheet $\SIgma$ to make a two-manifold $\Sigma'$ with boundary, over which we then integrate
the divergence of the  current. The
 open balls are bounded by circles $\gamma_1,\dots,\gamma_n$ -- sketched here for $n=4$.}
 \label{omitting}
\end{figure}
Once we have a conserved current $J^\mu$, or equivalently a closed operator-valued
one-form ${\eusm J}=\epsilon_{\mu\nu}J^\mu \d\sigma^\nu$,
we can derive a Ward identity.  Suppose that we are given vertex operators $\V_1,\dots,\V_n$ that
have definite charges $q_1,\dots,q_n$ in the sense that
\begin{equation}\label{monk}\oint_{\gamma_i} {\eusm J}\cdot \V_i=q_i\V_i, \end{equation}
where $\gamma_i$ is a small closed circle  that wraps counterclockwise once around  $\V_i$.   Now consider the correlation function 
$\langle \V_1\V_2\dots\V_n\rangle$ on a string worldsheet $\SIgma$.  Here we make ghost insertions\footnote{When we say that a worldsheet current is ``conserved,'' we mean in 
particular that it is  anomaly-free, and hence truly is conserved even on a curved worldsheet.   We also assume that it remains conserved in the presence of  the ghost insertions that are needed in defining
 superstring scattering amplitudes.  
In particular, the ghost number current does not qualify: it has an anomaly on a curved worldsheet, and does not commute with the usual ghost insertions.}  as necessary so that this correlation function is not trivially
zero, but we do not integrate over any moduli. To prove a Ward identity, we proceed in the standard fashion.  We let
$\Sigma'$ be the complement in  $\SIgma$ of the interiors of the $\gamma_i$ (fig. \ref{omitting}). By integrating the conservation
law $0=\d\eusm J$ over $\Sigma'$ and then integrating by parts to pick up surface terms, which we evaluate using
(\ref{monk}), we deduce the Ward identity:
\begin{equation}\label{zonder}0=\int_{\Sigma'} \left\langle\d{\eusm J}\cdot
\V_1\dots \V_n\right\rangle=\sum_{i=1}^n q_i\cdot \bigl\langle \V_1\dots \V_n\bigl\rangle. \end{equation}
Thus, the correlation function $\langle \V_1\dots\V_n\rangle $ vanishes unless $\sum_iq_i=0$.

This is our Ward identity, and since  it  holds without any integration over moduli, there is no room for any subtlety.  The
contribution to a scattering amplitude with $\sum_iq_i\not=0$ vanishes before any integration over moduli, so it certainly vanishes
after any  such integration. 

We expressed the computation in eqn. (\ref{zonder})
 in terms of a string worldsheet with bosonic coordinates only, but including fermionic
coordinates on the worldsheet changes nothing essential: a conserved current leads to a conservation law
on a fixed worldsheet and this conservation law remains valid after integration over moduli.  In practice, this means that
in closed oriented
superstring theory, all bosonic symmetries that hold at tree level are also valid in perturbation theory. 

This is so  even for the anomalous $U(1)$
symmetries that can arise in heterotic string compactification to four dimensions.  
An anomalous $U(1)$ gauge boson gets mass at 1-loop order via
a Higgs mechanism, but the associated {\it global} conservation law -- which is what we proved using the Ward identity --
remains valid in perturbation theory. This was explained in section \ref{effreview}: the scalar field $a$ that is important in the
Higgs mechanism decouples in perturbation theory.  


\subsection{How Supersymmetry Is Different}\label{susydifferent}

Spacetime supersymmetry is {\it not} associated to a conserved current in this sense.  
The supersymmetry generator is the
fermion vertex operator  of \cite{FMS,K}, taken at zero spacetime momentum.  
Because it is a Ramond vertex operator,
it is not really a conserved worldsheet current in the traditional sense assumed in section \ref{bosreview}.

 For heterotic strings in $\R^{10}$, the fermion vertex operator is customarily written
\begin{equation}\label{yedly}S_A=e^{-\tphi/2}\Sigma_A,\end{equation}
where $\Sigma_A$ is the spin operator of the matter system, which transforms as a positive chirality spinor
of $SO(1,9)$.  We will take the basic object to be not $S_A$ but its unintegrated counterpart 
\begin{equation}\label{medly}\S_A=c S_A,\end{equation}
which we call the spacetime supersymmetry generator.
Importantly, $\S_A$ has a factor of $c$ and no corresponding $\t c$, so its ghost number is less by 1 than
that of the vertex operator for a physical state of the heterotic string.  The reason for emphasizing $\S_A$ rather
than $S_A$ will hopefully become clear.  We sometimes omit the $A$ index and write just $\S$ for a generic
linear combination of the $\S_A$.

The  operator $\S_A$ is holomorphic, in the sense that it varies
holomorphically with the moduli of the superstring worldsheet $\Sigma$,
and is on-shell, in the sense that it obeys the holomorphic part of the physical state conditions
(its antiholomorphic part is the identity operator, which is not an on-shell vertex operator).  
A Neveu-Schwarz vertex operator
with those properties would be associated to a conserved worldsheet current that could be used to generate a Ward
identity along the standard lines that were reviewed in section \ref{bosreview}.  But the fermion
vertex operator  is a Ramond sector vertex operator, and the usual framework for deriving a Ward
identity {\it on a fixed worldsheet}, without integrating over moduli, does not make sense for 
Ramond sector vertex operators.

This is because a Ramond vertex operator is inserted at a singularity in the superconformal structure of
$\Sigma$.  (The usual explanation of this is the assertion that fermi fields have square root branch points
near a Ramond vertex operator insertion.  One can eliminate the branch points in favor of a more subtle
singularity in the superconformal structure; see for example section 4 of \cite{Surfaces} or section 
\ref{where} below.)  It does not make
sense to move this singularity while keeping the other moduli of $\Sigma$
fixed; there is no notion of two super Riemann surfaces being the same
except for the location of a Ramond singularity.  So the usual procedure of deriving
a Ward identity by integration over $\Sigma$ does not apply for spacetime
supersymmetry.  This is true even for superstring theory in $\R^{10}$.

At string tree level, it is possible to put the discussion of spacetime
supersymmetry in the framework of a ``conserved worldsheet  current.''
To do this, one absorbs the odd moduli in the definitions
of the vertex operators by using vertex operators of appropriate picture numbers.
Once the odd moduli are hidden in this way, one can treat $\S_A$ rather like conventional
conserved currents.  In loops, this procedure leads to what technically have been called  ``spurious singularities.''
Trying to express loop amplitudes in a framework that really does not quite apply made the literature of the
1980's cumbersome in places. 


\subsubsection{Closed Form On Supermoduli Space}\label{closedsuper}

If we cannot interpret the supersymmetry generator $\S_A$ as a conserved current on the worldsheet, how can we use it to
derive a Ward identity and why is spacetime supersymmetry ever valid?  What follows is only an overview;
much more can be found in \cite{Revisited}. 
Some of the necessary ideas were  developed in the 1990's
in work that has unfortunately remained little-known \cite{Belopolsky}.  

To derive the Ward identity for an $n$-particle scattering amplitude in the case of a bosonic symmetry, we started
with an $n+1$-point correlation function 
\begin{equation}\label{uggly}\langle J^\mu\,\V_1\dots\V_n\rangle.\end{equation}
The analog for supersymmetry is the correlation function
\begin{equation}\label{juggly}F_{\S_A\V_1\dots\V_n}=\langle \S_A\V_1\dots\V_n\rangle.\end{equation}
But what kind of object is $F_{\S_A\V_1\dots\V_n}$?  In the case of a bosonic conserved current $J^\mu$,
to derive the Ward identity, we varied the insertion point of $J^\mu$ but kept fixed $\Sigma$ and the insertion points
of all other vertex operators.  We cannot do this for the Ramond  vertex operator $\S_A$,
since there is no natural operation of varying the position of a Ramond vertex operator in a super Riemann surface $\Sigma$ without
varying all of the moduli of $\Sigma$.   The only natural operation is to vary all of the moduli of $\Sigma$, and to interpret
$F_{\S_A\V_1\dots\V_n}$ as an object of some kind on $\MM_{g,n+1}$, the moduli space of super Riemann surfaces
of genus $g$ with $n+1$ punctures (here our notation is oversimplified: we should specify the separate numbers
of NS and Ramond punctures, but to keep the notation simple we only indicate the total number of punctures).

What sort of object
on $\MM_{g,n+1}$ is $F_{\S_A\V_1\dots\V_n}$?
 It is not a {\it measure} that can be integrated over $\MM_{g,n+1}$ to get a scattering amplitude
-- since $\S_A$ is not the vertex operator of a physical state.  Indeed, the ghost number of
$\S_A$ is less by 1 than the ghost number of a physical state vertex operator; as
a result, $F_{\S_A\V_1\dots\V_n}$ is a  form of codimension 1 on $\MM_{g,n+1}$. It is a closed form, obeying
$\d F_{\S_A\V_1\dots\V_n}=0$, if the vertex operators $\V_1\dots\V_n$ are all annihilated by the BRST operator $\sQ$.
(In a dual language, one would call this correlation function a conserved current on $\MM_{g,n+1}$ rather than a closed form.)
For background on forms and exterior
derivatives on a supermanifold and the supermanifold version of Stokes's theorem, see for example \cite{Supermanifold}.
For other statements made in this paragraph, see \cite{Revisited}, starting with section 3.

The upshot is that
 we can derive a conservation law, not by integrating the equation $\partial_\mu J^\mu=0$ over $\Sigma$ but by integrating 
the equation   $\d F_{\S_A\V_1\dots\V_n}=0$ over $\MM_{g,n+1}$.  
Upon using the supermanifold version of Stokes's theorem, we get
\begin{equation}\label{reffo} 0=\int_{\MM_{g,n+1}}\d F_{\S_A\V_1\dots\V_n}=\int_{\partial\MM_{g,n+1}}
F_{\S_A\,\V_1\dots\V_n}.  \end{equation}
Here $\partial\MM_{g,n+1}$, the ``boundary'' of $\MM_{g,n+1}$, is a union of components associated to the different ways that
a narrow neck in  $\Sigma$ may collapse.  As we will see, the relation (\ref{reffo}) is the Ward identity of spacetime supersymmetry, including
a possible Goldstone fermion contribution. 
  
\subsubsection{A Bosonic String Analog}\label{bosan}

Before analyzing the Ward identity in detail, we pause to explain that some of the key points we have made actually
have bosonic string analogs.  For brevity, we consider only open strings or a chiral sector of closed strings.

A conformal vertex operator representing a physical state of the bosonic string has the form $\V=c V$, where $c$ is the usual ghost field and 
$V$ is a dimension 1 primary constructed
from matter fields only.  If $\V$ is BRST-trivial, meaning that $\V=\{\sQ,\W\}$ for some $\W$, then the string state corresponding to $\V$ is called
a null state and should decouple from scattering amplitudes.

The decoupling of 
{\it massless} null states can be proved in a particularly elementary way.  If $\V$ is massless and null, then $V=L_{-1} W$ 
for some $W$.  Equivalently, $V=\partial W$, so
 the integrated insertion of $V$ vanishes: $\int V=\int \partial W=0$.  (Here one has to verify that there are no anomalies
coming from boundary terms in this integral, but this is not a serious problem.) 

For massive null states, there is no equally elementary argument.  If $\V=cV$ is massive and null, then $\V=\{\sQ,\W\}$ for some $\W$
and furthermore  \cite{Thorn} one has $V=L_{-1}W_1+(L_{-2}+(3/2) L_{-1}^2)W_2$
for some $W_1$ and $W_2$.  But (because of the $W_2$ term) this does not make $V$ a total derivative on the string worldsheet
and there is no reason for the integral $\int V$ to vanish on a fixed string worldsheet.
Hence the only simplicity comes in the full integral over moduli space: the relation $\V=\{\sQ,\W\}$ implies that the form
on $\M_{g,n}$ that must be integrated to compute a scattering amplitude   with an insertion of $\V$ is exact.  

In other words, the decoupling of
a massive null state in bosonic string theory must be proved by integration by parts on $\M_{g,n+1}$, not on the string worldsheet.
The identity that proves decoupling of a null state has the same form as (\ref{reffo}) except that the left hand side is a scattering amplitude
with a null state included, rather than 0.  If $\V=\{\sQ,\W\}$, then
\begin{equation}\label{mozlo}F_{\V\V_1\dots\V_n}+\d F_{\W\V_1\dots\V_n}=0\end{equation}
so 
\begin{equation}\label{ozlo}-\int_{\M_{g,n+1}}F_{\V\V_1\dots\V_n}=\int_{\M_{g,n+1}}\d F_{\W\V_1\dots\V_n}=\int_{\partial\M_{g,n+1}}F_{\W\V_1\dots
\V_n}. \end{equation}
For a null state of generic momentum, it is not hard to show that the surface terms on the right hand side of eqn. (\ref{ozlo}) vanish, establishing
the decoupling of the null state $\V$.

What we learn here is that the essential subtlety of spacetime supersymmetry in superstring theory has a close analog in the procedure to prove decoupling
of massive null states of the bosonic string (or of superstring theory).
 The analogy becomes even closer if we analyze the decoupling of a longitudinal gravitino state at nonzero (but on-shell) momentum.
 Eqn. (\ref{ozlo}) applies without change for the case that $\V=\{\sQ,e^{ik\cdot\X}\mu^A\S_A\}$ is the vertex operator of a longitudinal gravitino of lightlike
 momentum $k$ (here
 $\mu^A$ is a $c$-number spinor that obeys the Dirac equation $k\cdot \Gamma\,\mu=0$).  What is special about spacetime supersymmetry is merely that in the case of the gravitino, $\V=0$ at $k=0$ (since $\{\sQ,\S_A\}=0$).  As a result, in the case of the gravitino, upon setting $k=0$,
  we get an identity (\ref{reffo})
 with the same
form as (\ref{ozlo}) except that the left hand side vanishes, leading to a conservation law (rather than the decoupling of a null state).
There is no conservation law associated to decoupling of massive null states in bosonic string theory or superstring theory, 
since there is no value of the momentum
at which the vertex operator of a massive null state vanishes.  This is usually described by saying that gauge invariances of massless null states
(including the gravitino if it is massless) lead to conservation laws in spacetime, while the gauge invariances of massive string states are spontaneously broken.




\subsubsection{Contributions To The Ward Identity}\label{wardit}  
  
Now we return to the analysis of the Ward identity (\ref{reffo}).  
In general,  $\partial\MM_{g,n+1}$ has many components -- associated to  various separating and nonseparating degenerations.  But many of these boundary components do not contribute to the Ward identity.  
The only ones that do contribute are   those in which, for kinematic reasons, the spacetime  momentum
flowing through a narrow neck in the string worldsheet is forced to be on-shell.  For example, a nonseparating degeneration does not contribute
to the Ward identity since in this case the momentum flowing through the neck is one of the integration variables in the
path integral and is generically not on-shell.
Likewise a separating degeneration with multiple vertex operators on both sides does not contribute.  

One type of boundary component that always contributes is sketched in fig. \ref{Supersymmetry}.  The string worldsheet 
$\Sigma$, of genus $g$, degenerates
to a union of two components $\Sigma_\ell$ and $\Sigma_r$, of genera $g_\ell$ and $g_r$,
where $\Sigma_\ell$ contains precisely two vertex operators:
the supersymmetry generator $\S_A$ and  one of the others, say $\V_i$.  $\Sigma_r$ contains
the other vertex operators $\V_1\dots \hat \V_i \dots \V_n$.   Since $\S_A$
carries zero momentum in spacetime, the momentum flowing through the neck is equal to the momentum carried by $\V_i$
and in particular is on-shell for some string states.   The contribution of this type of degeneration is as follows.
$\Sigma_\ell$ with the two vertex operators $\S_A$ and $\V_i$ that it contains, and the instruction to extract
a boundary contribution, can be replaced with a physical state vertex operator $\O_{i,A}$ that should be inserted on  $\Sigma_r$.
The contribution of this boundary component to the Ward identity is then given by a path integral on $\Sigma_r$; this
path integral is the genus $g_r$ contribution to a scattering amplitude $\langle \V_1\dots\V_{i-1}\O_{i,A}\V_{i+1}\dots\V_n\rangle$.

The operator $\O_{i,A}$, since it is produced by a path integral on $\Sigma_\ell$ with insertions of $\S_A$ and $\V_i$,
is linear in $\S_A$ and also linear in $\V_i$.  So we can define a linear transformation $Q^{(g_\ell)}_A$ of the space of physical
vertex operators such that $\O_{i,A}=\{Q^{(g_\ell)}_A,\V_i\}$.  This $Q^{(g_\ell)}_A$ is the spacetime supersymmetry charge, or more
precisely it is the genus $g_\ell$ contribution to it.  The full spacetime supersymmetry
charge is $Q_A=\sum_{\ell=0}^\infty g_\st^{2g_\ell}Q_A^{(g_\ell)}$, with $g_\st$ the string coupling.  The $g_\ell=0$ contribution to $Q_A$ coincides with the spacetime supersymmetry charge
as traditionally defined \cite{FMS,K}.  This is so because a degeneration with $g_\ell=0$ simply results from a collision between
two operators, and its effects, in the present context, are captured by the leading behavior in the  $\S_A\cdot \V_i$ operator product.
The operators $Q_A^{(g_\ell)}$, $g_\ell>0$, represent loop corrections to the supersymmetry charges; these have not been investigated,
but 
probably are entirely determined by the loop corrections to particle masses and possible loop corrections to
central charges in the supersymmetry algebra.

\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Supersymmetry.pdf}
 \end{center}
\caption{\small The Ward identity always receives contributions from separating degenerations of this kind in which  one
component $\Sigma_\ell$ contains a supersymmetry generator $\S$ and precisely
one more vertex operator. If these are the only contributions, then the Ward identity expresses the invariance of the $S$-matrix under spacetime supersymmetry.  In the example sketched,
$\Sigma_\ell$ has genus 0.  This leads to the familiar tree-level expressions for the supercharges.  }
 \label{Supersymmetry}
\end{figure}

If  the boundary contributions just analyzed are the only ones, then the Ward identity, after summing
over the choice of the  vertex operator $\V_i$ that is contained in $\Sigma_\ell$ along with the supersymmetry generator, takes a familiar form:
\begin{equation}\label{pokkol} 0=\sum_i\langle \V_1\dots \V_{i-1}\{Q_A,\V_i\}\V_{i+1}\dots\V_n\rangle. \end{equation}
This is the standard form of the identity expressing invariance of the $S$-matrix under a conserved charge.  It says
that the $Q_A$ generate symmetries of the $S$-matrix.  These are the spacetime supersymmetries.

However, as one might surmise based on experience in field theory, there is also a possible  boundary
contribution to the Ward identity associated to spontaneous symmetry breaking. This arises (fig. \ref{Goldstone}) when one component, say $\Sigma_\ell$, contains
the supersymmetry generator $\S_A$ and no other vertex operators.  Since $\S_A$ carries zero momentum,
the momentum flowing between $\Sigma_\ell $ and $\Sigma_r$ is zero, which can be the momentum of an on-shell
string state -- a massless fermion.   The contribution of this kind of boundary component to the $S$-matrix can be evaluated
by inserting on $\Sigma_r$ a physical state vertex operator $\O(\S_A)$ that reproduces the effect of the path integral
on $\Sigma_\ell$.  Thus the boundary contribution to the Ward identity is the genus $g_r$ contribution to an $n+1$-particle
scattering amplitude $\langle  \O(\S_A)\V_1\dots\V_n\rangle$.   Comparing to field theory, the interpretation is clear:
when not zero, $\O(\S_A)$  is the vertex operator of a Goldstone fermion.  

When $\O(\S_A)$ is nonzero,
we no longer get a Ward identity (\ref{pokkol}) for unbroken supersymmetry; there is an additional Goldstone fermion
contribution, just as occurs in a field theory model with spontaneously broken supersymmetry.  The existence in perturbative string theory of a massless dilaton means that once a Goldstone fermion is generated,
one expects to find an instability in higher order, and one does not expect the $S$-matrix to exist to all orders.
Conversely, when supersymmetry is valid to all orders, part of the proof of this involves an inductive argument to show the
vanishing of massless tadpoles.





\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Goldstone.pdf}
 \end{center}
\caption{\small One other degeneration may contribute to the Ward identity.  This is
the Goldstone fermion contribution.  It represents spontaneous breaking of spacetime supersymmetry.
This contribution can exist only when the genus of $\Sigma_\ell$ is positive.}
 \label{Goldstone}
\end{figure}

\subsubsection{The Dilaton Tadpole And The Mass Splitting}\label{tadmass}

To provide a context for the discussion of Goldstone fermion contributions, let us return to the heterotic string on a Calabi-Yau, and 
consider in this light the two supersymmetry-breaking effects that we studied in sections \ref{mass} and \ref{dilaton}
-- the 1-loop mass splittings and the 2-loop vacuum energy.  In this case, only the four-dimensional Lorentz
group $SO(1,3)$ (and not its ten-dimensional cousin $SO(1,9)$) acts on the unbroken supersymmetries.
We write $\S_\alpha$ and $\S_{\dot\alpha}$, $\alpha,\dot\alpha=1,2$ for supersymmetry generators of positive
and negative chirality, and $Q_\alpha$, $Q_{\dot\alpha}$ for the corresponding supercharges.

The usual way to use supersymmetry to analyze the vacuum energy is to observe that the $g$-loop vacuum energy is essentially
equivalent to the $g$-loop tadpole of the dilaton vertex operator $\V_\phi$.  To   analyze
this tadpole using supersymmtry, one considers a Ward identity involving the dilatino
(the massless fermion $\kappa$ that is in the same supersymmetry multiplet with the dilaton). Let $\V_{\kappa,\beta}$ be the
dilatino vertex operator 
or more precisely a particular spinor component of this operator, and let  $\S_\alpha$ be a supersymmetry generator such
that $\epsilon_{\alpha\beta}\V_\phi=\{Q_\alpha,\V_{\kappa,\beta}\}$.  Consider the supersymmetric Ward identity (\ref{reffo})
derived from a two-point function $F_{\S_\alpha \V_{\kappa,\beta}}=\langle \S_\alpha\V_{\kappa,\beta}\rangle$.  
There are only two 
possible boundary
contributions
(fig. \ref{DT}).   One contribution, shown on the left of the figure, is the Goldstone fermion contribution; the other contribution,
shown on the right, is the tadpole of $\V_\phi$.  
The dilaton tadpole vanishes if and only if there is no Goldstone fermion contribution.

It will probably come as no surprise to the reader who has gotten this far that  heterotic string compactifications with
an anomalous $U(1)$ do develop a Goldstone fermion at 1-loop level. Demonstrating this explicitly will be the goal of
section \ref{goldstonefermion}.   The Goldstone fermion is the gaugino $\zeta_\alpha$,
the fermion that is in the vector multiplet that contains the anomalous $U(1)$ gauge field. 
So in fig. \ref{DT}(a), we can replace $\Sigma_\ell$ by an insertion on $\Sigma_r$ of the gaugino vertex operator $\O(\S_\alpha)=\V_{\zeta_\alpha}$.
The resulting path integral on $\Sigma_r$ is then  the two-point function $\langle\V_{\zeta,\alpha}\V_{\kappa,\beta}\rangle$; in
other words, it is the 1-loop contribution to the $\zeta\kappa$ mass term.  In section \ref{simplesplit}, we showed that this quantity
is nonzero, and therefore the vanishing of the sum of the boundary
contributions in fig. \ref{DT} 
implies that there must be a 2-loop dilaton tadpole.  

\begin{figure}
 \begin{center}
   \includegraphics[width=6.5in]{Newtry31.pdf}
 \end{center}
\caption{\small For the case of only two vertex operators, namely a supersymmetry generator $\S$ and the vertex operator
$\V_\kappa$ for the dilatino, there are only two possible contributions
to the Ward identity: a Goldstone fermion contribution (a), and a second contribution (b) that is proportional to the dilaton
tadpole.  The dilaton tadpole vanishes if and only if there is no Goldstone fermion contribution.}
 \label{DT}
\end{figure}

We can proceed in the same way  to analyze the 1-loop mass shift in a charged chiral multiplet.   In this case, suppressing
some indices,
we consider a Ward identity derived from a correlation function 
\begin{equation}\label{boxxo}F_{\S\,\V_\rho \V_{\bar \psi}}=\langle \S\,\V_\rho\,\V_{\bar\psi}\rangle \end{equation}
of three vertex operators (fig. \ref{underwood}), 
 namely a supersymmetry generator $\S$,
the vertex operator $\V_\rho$ for a boson $\rho$ in a chiral multiplet, and the vertex operator 
$\V_{\bar \psi}$ for a fermion $\bar\psi$ in the conjugate
antichiral multiplet.  The Ward identity (\ref{reffo}) now has three terms (fig. \ref{underwood}).  One term is the Goldstone fermion contribution
and the other two involve the 1-loop bose and fermi mass shifts.  The bose and fermi mass shifts fail to be equal
if and only if the Goldstone fermion contribution is nonvanishing.  

\begin{figure}
 \begin{center}
   \includegraphics[width=4.5in]{Fig3.pdf}
 \end{center}
\caption{\small The Ward identity governing the 1-loop mass splittings studied in section \ref{mass}
has these three contributions.  The 1-loop fermion and boson mass splittings appear in (b) and (c),
respectively, while the Goldstone fermion contribution to the Ward identity appears in (a).}
 \label{underwood}
\end{figure}

\subsection{The Goldstone Fermion}\label{goldstonefermion}

It is rather tricky to show explicitly that in heterotic string compactifications with an anomalous $U(1)$ gauge symmetry,
the gaugino becomes a Goldstone fermion at the 1-loop level.  
This amounts, roughly speaking, to evaluating
a two-point function in genus 1, but not quite a standard one. 

To understand exactly what we have to calculate, let us start with a concrete example such
as that of fig. \ref{underwood} and take a close look at the supersymmetry-violating contribution of 
fig. \ref{underwood}(a).  This contribution is associated to the splitting of a super Riemann surface $\Sigma$
into two components $\Sigma_\ell$ and $\Sigma_r$, joined at a Ramond degeneration.  In other words, the string
state propagating between $\Sigma_\ell$ and $\SIgma_r$ is a state in the Ramond sector (namely the Goldstone fermion).
By contrast, previous
degenerations considered  in this paper have always been NS (or bosonic string) degenerations.    

In the analysis of the Goldstone fermion contribution to the Ward identity,
we are supposed to keep $\Sigma_r$ fixed.   The idea of spontaneous supersymmetry breaking is that no matter
what $\Sigma_r$ may be, the contribution of the degeneration of fig. \ref{underwood}(a) to the Ward identity is
an ordinary scattering amplitude evaluated on $\Sigma_r$ with $\Sigma_\ell$ replaced by the vertex operator of
the Goldstone fermion.  Since this statement is supposed to hold for any $\Sigma_r$, we can consider $\Sigma_r$ to be
fixed and arbitrary
in the analysis.

A minor simplification in the example of fig. \ref{underwood} is that, as $\Sigma_r$ is a super Riemann surface
of genus 0 with 1 NS puncture and 2 Ramond punctures, it has no even or odd moduli and its moduli space $\M_r$ is
a point.  That makes it particularly straightforward to keep $\Sigma_r$ fixed in this example.

\subsubsection{Where To Integrate}\label{where}

Near a separating Ramond degeneration, the (holomorphic) moduli of $\Sigma$ can be factored as follows:
\begin{itemize}\item One factor is the moduli space $\MM_\ell$ associated to $\Sigma_\ell$.  Here $\Sigma_\ell$ is
a super Riemann surface of genus $g_\ell$ (for us, $g_\ell=1$) with 2 Ramond punctures.
\item A second factor is the moduli space  $\MM_r$ associated to $\Sigma_r$.  This depends on the specific process considered,
but will play no important role since $\Sigma_r$ is held
fixed in the whole analysis.
\item Finally, there are moduli associated to the gluing.  There is a bosonic gluing parameter 
$q_\Ra$ associated to a Ramond degeneration; it is quite analogous to the bosonic and NS sector
gluing parameters $q$ and $q_\NS$ that are familiar from section \ref{genless}. But there is also
a fermionic gluing parameter $\alpha$ that is special to the Ramond sector.  Its existence is 
related to the fact that, in the Ramond sector,
the worldsheet supercurrent has a zero-mode $G_0$. \end{itemize}

To understand technically why there is a fermionic gluing parameter (see \cite{Surfaces}, especially sections 4
and 6.2, for much more), we must recall that a Ramond vertex
operator is associated to a singularity of the superconformal structure of $\Sigma$.  In general, a super Riemann
surface is a $1|1$ complex supermanifold that is endowed with a superconformal structure.  Such a structure is
a rank $0|1$ subbundle  $\D$ of the tangent bundle $T\Sigma$ of $\Sigma$ that is generated, in local 
superconformal coordinates $x|\theta$, by $D_\theta
=\partial_\theta+\theta\partial_x$.  The key property of this operator is that $D_\theta$ and $D_\theta^2=\partial_x$
are everywhere linearly independent and generate the full tangent bundle $T\Sigma$.  A Ramond
vertex operator is inserted on a divisor (that is, a submanifold of $\Sigma$ of dimension $0|1$) on which this linear
independence fails.  The local structure is that $\D$ is generated in suitable coordinates by $D^*_\theta=\partial_\theta
+\theta x \partial_x$, obeying $(D_\theta^*)^2=x\partial_x$; thus, the linear independence of $D_\theta^*$ and its
square fails on the divisor $\F$ given by $x=0$, which is where a Ramond vertex operator is inserted.  We call $\F$
a Ramond divisor.

Now let us describe the gluing of two super Riemann surfaces $\Sigma_\ell$ and $\Sigma_r$ along Ramond divisors.
We suppose that in local coordinates $x|\theta$, $\Sigma_\ell$ has superconformal structure defined by
$D^*_\theta=\partial_\theta+\theta x\partial_x$, with a Ramond divisor $\F_\ell$ at $x=0$; and similarly that in local
coordinates $y|\psi$, $\Sigma_r$ has superconformal structure defined by $D^*_\psi=\partial_\psi+\psi y\partial_y$, with
a Ramond divisor $\F_R$ at $y=0$.
Then -- ignoring for the moment the fermionic gluing parameter -- $\Sigma_\ell$ and $\SIgma_r$ can be glued by
\begin{align}\label{medzo} xy& = q_\Ra \cr
                                         \theta&=\pm \sqrt{-1}\psi .\end{align}
Here $q_\Ra$ is the analog of the familiar bosonic and NS gluing parameters $q$ and $q_\NS$.  The constant of
proportionality between 
$\theta$ and $\psi$ must be $\pm\sqrt{-1}$  so that the gluing map is superconformal, or in other words
so that  $D^*_\psi$ is proportional to $D^*_\theta$ and generates the same line bundle $\D$.  The sum over the sign
in the gluing map leads to the GSO projection.

The fermionic gluing parameter can be included by generalizing (\ref{medzo}) by first making a superconformal transformation of the local superconformal
coordinates $x|\theta$
of $\Sigma_\ell$ (or a similar transformation of the local superconformal coordinates of $\Sigma_r$) whose restriction to $\F_\ell$ (or $\F_r$) is non-trivial.  Such a transformation is
$\theta\to\theta-\alpha$, $x\to x+\alpha\theta x$, with $\alpha$ an odd parameter.  
All that matters here is how this transformation acts on
  $\F_\ell$.  In particular, for $\alpha\not=0$, the
 gluing of the two Ramond divisors    $\F_\ell$ and $\F_r$ after the change of coordinates takes the form
\begin{equation}\label{edzo}\theta-\alpha=\pm \sqrt{-1}\psi. \end{equation}

At $q_\Ra=0$, keeping fixed $\Sigma_\ell$ and  $\Sigma_r$ and thus the definitions of $\theta$ and $\psi$,
the fermionic gluing parameter $\alpha$ is the choice of a point $\theta=\alpha$ on $\F_\ell$ that must be glued to the
point $\psi=0$ on $\Sigma_r$. (This interpretation of $\alpha$ is only precise at $q_\Ra=0$.)  
For purposes of analyzing the Goldstone fermion contribution to the Ward identity,
it is useful to include $\alpha$ as an extra modulus of $\Sigma_\ell$.  To do this, we define a supermanifold
$\MM_\ell'$ that is fibered over $\MM_\ell$ with fiber $\F_\ell$.  The calculation that we will eventually perform
is best understood in terms of integration  over $\MM_\ell'$ rather than over $\MM_\ell$.   This will gradually become clear. 

To evaluate the boundary contribution in fig. \ref{underwood}(a), in addition to integrating over $\MM'_\ell$, we also
have to treat properly the bosonic gluing parameter $q_\Ra$.  Roughly speaking, this will mean setting $|q_\Ra|=\eta$,
with $\eta$ a small positive constant, and integrating over $\mathrm{Arg}\,q_\Ra$.  The integral over $\mathrm{Arg}\,q_\Ra$
just gives a factor of $2\pi$; however, the operation that naively consists of setting $|q_\Ra|=\eta$ is subtle and will
be analyzed in section \ref{cohoform}.

Returning to the fermionic gluing parameter, it may be most familiar in the following guise.  The bosonic string propagator
is\footnote{See for example section 6 of \cite{Revisited} for the following formulas.
For brevity, we write these propagators for open strings or a chiral sector of closed strings. The symbols
$b_0, \beta_0$, $L_0$, and $G_0$ are the usual zero-modes of antighosts and Virasoro or super Virasoro generators.  }
  $b_0/L_0$, and the superstring propagator in the NS sector is given by the same formula.  The factor of $1/L_0$,
which comes by integration over the bosonic gluing parameter, is the analog of the usual bosonic propagator
$1/(P^2+M^2)$ of field theory, where $P$ is the momentum and $M$ is the mass operator.  In the Ramond sector,
the propagator is instead
\begin{equation}\label{dobzo}b_0\delta(\beta_0) \frac{G_0}{L_0}, \end{equation}
where here the field theory limit of $G_0/L_0=1/G_0$ is the usual Dirac propagator $1/(\Gamma\cdot P+iM)$.                                   
The factor $G_0$ in the numerator in (\ref{dobzo}) comes from integration over the fermionic gluing parameter $\alpha$.
In our problem, the integration over  $\alpha$ cannot be treated as simply as that.   The reason
is that, rather than a pole associated to an on-shell state propagating between $\Sigma_\ell$ and $\Sigma_r$, we are
trying to evaluate a boundary contribution to a Ward identity, which is a more subtle matter.

\subsubsection{Conformal Vertex Operators}\label{cvo}

To proceed, we require a fact about string perturbation theory that is not new though perhaps also not
well-appreciated.\footnote{For original references, see \cite{VafaMany}, eqn. (5.18), and \cite{Nelson}.  For a recent
treatment, see \cite{Revisited}, starting with section 2.4.1.}  Most of the following does not depend on worldsheet or spacetime supersymmetry,
and for brevity, we mostly use the language of bosonic string theory.

To compute scattering amplitudes in a conformally-invariant fashion,
it does not suffice to represent external states by vertex operators that are conformal primaries of the appropriate
dimension, annihilated by the BRST operator $\sQ$.  The vertex operators  must obey an additional condition, which for unintegrated vertex operators of bosonic
string theory\footnote{Using unintegrated vertex operators in the following discussion enables us to treat
bosonic strings and the NS and Ramond sectors of superstrings in the same way.} is that they must be annihilated
by $b_n,$ $n\geq 0$.  In superstring theory, unintegrated vertex operators must also be annihilated by $\beta_n$, $n\geq 0$.  It is convenient
to refer to vertex operators that are conformal or superconformal 
primaries of dimension 0 and obey these conditions as conformal or superconformal vertex operators.


To explain briefly how this condition comes about, recall that in using 
the worldsheet path integral to construct a measure on
the moduli space of Riemann surfaces (which is then integrated to compute a scattering 
amplitude), one makes antighost insertions,
that is insertions of
\begin{equation}\label{microb}w_h=\int_\Sigma \d^2z\,h_{\t z}^z b_{zz}, \end{equation}
where $h_{\t z}^z$ is a $c$-number wavefunction -- often called a Beltrami differential -- 
that represents a deformation of the complex
structure of $\Sigma$.  For diffeomorphism invariance and conformal invariance of the 
formalism, one needs to know that $w_h$ is
unchanged if $h$ is changed in a manner induced by a diffeomorphism.  The change in $h$ 
under an infinitesimal diffeomorphism generated
by a vector field $v^z\partial_z$ is
\begin{equation}\label{icrob} h_{\t z}^z\to h_{\t z}^z+\partial_{\t z}v^z,\end{equation}
and the corresponding change in $w_h$ is
\begin{equation}\label{crob}\delta_v w_h=\int_\Sigma\d^2z \partial_{\t z}v^zb_{zz}=-\int_\Sigma\d^2z v^z\partial_{\t z}b_{zz},\end{equation}
where in the last step we integrate by parts.  We would like to claim that this last expression vanishes using the antighost equation
of motion $\partial_{\t z}b_{zz}=0$, but there is a potential for delta function contributions at positions of vertex operators.  


In fact, if an unintegrated  vertex operator $\V$ is inserted at a point $p\in\Sigma$, we want to constrain the gauge parameter $v$ by
\begin{equation}\label{metto}v^z(p)=0,\end{equation}
since in working with unintegrated vertex operators, we do not regard diffeomorphisms that change $p$ as symmetries.
But we do not want to impose any further conditions on $v^z$.  Given this,
the condition
that $\delta_v w_h$ does not receive a delta function contribution at $p$ is that the $b\cdot \V$ operator product has at most a simple pole at $p$, or in other words that $b_n\V=0$, $n\geq 0$.  

As an example of a consequence of this fact, we consider physical states of the bosonic string.  (For brevity we consider open
strings or a chiral sector of closed strings.)  Every physical state of the bosonic string can be represented by a vertex operator
$\V=cV$, where $V$ is a matter primary of dimension 1.  These are conformal vertex operators, and if we use them, we can compute
scattering amplitudes in a completely conformally-invariant fashion.  The operator $\V'=c\partial c V$ is also a $\sQ$-invariant
primary of dimension 0, just like $\V$, but it is not a conformal vertex operator as it is not annihilated by $b_0$.  For $\delta_v w_h$
to vanish in the presence of an insertion of $\V'$, we would require
\begin{equation}\label{etto}v^z(p)=\partial_z v^z(p)=0. \end{equation}
In other words, the diffeomorphism generated by $v^z$ would have to act trivially not only at the point $p$ but also on the tangent
space to that point in $\Sigma$.  Equivalently, to compute  an amplitude with an insertion of $\V'$ at $p$, we would
have to be given (up to a constant independent of all moduli\footnote{\label{besure}  This constant comes in because
eqn. (\ref{etto}) ensures that we know how to keep a local parameter fixed when we change the moduli, but does not
determine an overall normalization of the local parameter.})
a local parameter $z$ vanishing at $p$, modulo terms of order $z^2$.  A local parameter $z$ that is defined modulo $z^2$ is what
we will call a first-order local parameter.

We do not usually carefully consider the consequences of inserting an operator such as $\V'$ in a scattering amplitude, because there is a more trivial
reason that this will not work.  We will express the following reasoning for bosonic closed strings.  A physical state of bosonic
closed strings at non-zero spacetime momentum can be represented by the conformal vertex operator $\V=\t c c V$, where $V$ is a matter
primary of dimension $(1,1)$.  $\V$ has ghost number 2 (holomorphic and antiholomorphic ghost numbers $(1,1)$).   A correlation
function $\langle \V_1\dots\V_n\rangle$, with all $\V_i$ having ghost number 2, and with the appropriate
antighost insertions so that the correlation function is not trivially zero, leads to 
 a form of top degree on moduli space,
which can be integrated to get a number.  If one of the vertex operators has ghost number greater than 2, for example 
$\V'=\t c c(\partial c+\t\partial\t c) V$, then to get a top-form on moduli space, 
we must  compensate by taking one vertex operator to have ghost number less than 2.  In a scattering
amplitude, we cannot do this, since at nonzero momentum, the
bosonic string has no physical states of ghost number less than 2.

However, when we calculate not a scattering amplitude but a boundary contribution to a Ward identity, one of the
vertex operators that we insert is a symmetry generator at zero momentum -- for example, the supercurrent $\S$.
The ghost number of such a symmetry generator is less by 1 than that of the usual physical state vertex
operators.  So if -- as the reasoning in section \ref{where} suggests -- we are going to get a number by integrating
over $\MM_{\ell}'$ a correlation function with an insertion of $\S$, one operator in this correlation function
will necessarily have a ghost number greater than the standard value.  This operator will be a superstring analog of
$\V'=\t c c (\partial c +\t\partial \t c)V$ -- a $\sQ$-invariant superconformal primary of dimension 0, but not a 
superconformal vertex
operator.  So we will have to understand what role such an operator can play in a superconformally-invariant formalism.



\begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Spole.pdf}
 \end{center}
\caption{\small  This separating degeneration contributes a pole to the indicated scattering amplitude when the string state flowing between
$\Sigma_\ell$ and $\Sigma_r$ is on-shell.}
 \label{simpler}
\end{figure}
\subsubsection{The Boundary Formula}\label{expole}
In this section, we continue to use the language of the bosonic string.
Before explaining the general formula for the boundary contribution in a Ward identity, let
us first recall a simpler problem of  understanding the pole that arises in a scattering amplitude
when an on-shell string state flows between 
the two branches $\Sigma_\ell$ and $\Sigma_r$ of a separating degeneration (fig. \ref{simpler}).
General considerations of conformal field theory tell us that the effect of a 
string state propagating between $\Sigma_\ell$ and $\Sigma_r$
can be expressed via the insertion of a vertex operator $\O$ on $\Sigma_\ell$ and 
a conjugate vertex operator $\h \O$ on
$\SIgma_r$.  In conformal field theory on a fixed string worldsheet, $\O$ and $\h\O$ would be 
conjugate in the sense of having
a nonzero two-point function on a two-sphere $S^2$; a possible example would be 
$\O=\t c c\partial c V$, $\h\O=\t c\t\partial \t c c \h V$, where 
$V$ and $\h V$ are conjugate operators in the matter system.  However,  to extract 
the pole in a string scattering amplitude,
we have to integrate over the gluing parameters\footnote{The considerations in this section apply
for a variety of string theories, so we use generic names $\t q, \,q$ for gluing parameters.  When we specialize
to our problem involving the heterotic string on a Calabi-Yau manifold, the gluing parameters will be $\t q$ and $q_\Ra$.}  $\t q, \, q$ (the form 
which is integrated over these parameters is written below in eqn. (\ref{minco})).  This integration is 
associated with antighost insertions $b_0$ and $\t b_0$ 
in the narrow neck between $\Sigma_\ell$ and $\Sigma_r$.  
These insertions, which are constructed
as in eqn. (\ref{microb}),
reduce the total ghost number of $\O$ and $\h\O$ by 2 and ensure that they 
are annihilated by $b_0$ and $\t b_0$.  As a result,
it is possible for both of these operators to be conformal vertex operators: $\O=\t c c V$ and $\h\O=\t c c \h V$.  

Not only is this possible, but the residue of a pole in a scattering amplitude can be 
computed entirely from contributions of this kind.  Indeed, if we use conformal vertex operators to compute a 
scattering amplitude, then the amplitude is
determined by integrating a completely natural measure on moduli space.  The residue of any pole must
be equally natural, and this means that it must be given by insertions of conformal vertex 
operators $\O$, $\h\O$ on the two
branches.  (Moreover,  the residue of the pole can be computed entirely from a subset of conformal vertex operators
that give a basis for the BRST cohomology;
the contributions of other
operators to the residue  cancel in pairs.)

\begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Zeldo.pdf}
 \end{center}
\caption{\small A typical situation in which one wishes to extract a supersymmetry-violating boundary contribution.}
 \label{bunderwood}
\end{figure}

Now let us see how this changes if instead of a pole in a scattering amplitude, we are 
trying to compute a boundary contribution to a Ward
identity (fig. \ref{bunderwood}).  
In this case, the path integral on $\SIgma_r$ is an ordinary scattering amplitude 
with insertion of $\h\O$, so in a conformally
invariant formalism, $\h\O$ will again be a conformal vertex operator.  But the path 
integral on $\Sigma_\ell$ is something less
familiar, since one of the operator insertions is a supersymmetry generator $\S$ rather 
than the vertex operator of a physical
state.  It turns out that $\O$ will not be a conformal vertex operator.

In fact, to compute the boundary contribution, we want to integrate over the argument of the gluing parameter $q$,
but not over its modulus.  The effect of this is that we still have in the narrow neck an insertion of $b_0-\t b_0$,
so we can assume that the vertex operators $\O$ and $\h\O$ are annihilated by $b_0-\t b_0$.  But we no longer
have an insertion of $b_0+\t b_0$, so we cannot assume that $\O$ and $\h\O$ are annihilated by $b_0+\t b_0$.
On the contrary, if one of them is annihilated by $b_0+\t b_0$, then the other is proportional to 
$\partial c+\t\partial \t c$ and is definitely not annihilated by $b_0+\t b_0$.  

As already explained, the boundary contribution that we want comes entirely from the case that the operator inserted on $\Sigma_r$
is a conformal vertex operator $\h\O=\t c c \h V$ (or the superstring analog of this). The operator
inserted on $\Sigma_\ell$ is then not the conjugate  conformal vertex operator $\O=\t c c V$, but
is $\O'=-(\partial c+\t\partial \t c)\O$.  It therefore seems that the
boundary contribution we want will come from the insertion 
\begin{equation}\label{mezzox}  -(\partial c+\t\partial \t c)\O\cdot \h\O \end{equation}
on the two sides.  Thus in fig. \ref{bunderwood}, the path integral on $\SIgma_r$ will be an ordinary scattering amplitude with insertion of $\h\O$,
and the one on $\Sigma_\ell$  will involve a two-point function 
$\langle \S \cdot \O'\rangle_{\Sigma_\ell}$.  The ghost numbers are such that with the usual antighost
insertions, this correlation function could give a top-form on moduli space (as explained at the end of section \ref{cvo},
$\S$ has ghost number 1 less than the usual value, and $\O'$ has ghost number 1 greater).  But there is a fundamental
problem: the operator $\O'$ is not a conformal vertex operator, and therefore the two-point function
$\langle \S \cdot \O'\rangle_{\Sigma_\ell}$ cannot be the full answer to any question in a conformally-invariant formalism.


The remedy for this was explained in section 7.7 of \cite{Revisited}.  We must study the behavior near $q=\t q=0$ of
form $F_{\S\V_1\dots\V_n}$ that
appears in the supersymmetric Ward identity (\ref{reffo}). 
The most singular contribution to this form  near $q=\t q=0$ is associated to an insertion of
\begin{equation}\label{minco} \O\cdot \frac{-i \d\t q\, \d q}{\t q q}\cdot \h O.\end{equation}
(What we call $-i \d\t q\,\d q$ is usually written $\d^2q$.)  If we were computing a scattering amplitude, we would have to integrate
over $q$ and $\t q$, and since we have taken $\O$ and $\h O$ to be on-shell conformal vertex operators, the integration would diverge
logarithmically near $q=\t q=0$.  This would be the usual singularity associated to an on-shell physical state.  Actually, we are computing 
a boundary contribution in a Ward identity.  This means that we want to integrate over $\mathrm{Arg}\,q$, but not over $|q|$.  We can
factor
\begin{equation}\label{xobbo}\frac{-i \d\t q\, \d q}{\t q q}=\frac{1}{2i}\left(\frac{\d q}{q}-\frac{\d\t q}{\t q}\right) \frac{\d(\t q q)}{\t q q }. \end{equation}
We integrate over $\mathrm{Arg}\,q$ with the aid of the 1-form $(1/2i)(\d q/q-\d{\t q}/\t q)$; this gives a factor of $2\pi$. We suppress
this factor in what follows (the same factor coming from integration over $\mathrm{Arg}\,q$ has been omitted in  (\ref{mezzox})).
After integrating out $\mathrm{Arg}\,q$, we are left with a singular contribution 
\begin{equation}\label{linco}\O \cdot \frac{\d (\t q q)}{\t q q}\cdot \h\O. \end{equation}
To evaluate the contribution of a given degeneration in the fundamental supersymmetric Ward identity (\ref{reffo}), 
we are not interested in integrating over the modulus $\t q q$ of $q$, but rather, roughly speaking, in setting it to a constant 
to define the relevant component of $\partial\MM_{g,n+1}$.  
Naively speaking, since $\t q q$ is supposed to be ``constant'' along $\partial\MM_{g,n+1}$, $\d(\t q q)$ vanishes when restricted to
$\partial\MM_{g,n+1}$, and therefore the term (\ref{linco}) does not contribute.  The trouble with this reasoning is that there is not
a conformally-invariant notion of setting $\t q q$ to a constant.    What it really means to set $\t q q$ to a ``constant'' is that we define
it to be a function of the other moduli, after which $\d(\t q q)/\t q q$ becomes a 1-form on the moduli space\footnote{\label{yrf} We can keep
$\SIgma_r$ fixed in the discussion, so we do not have to think of $\d(\t q q)/\t q q$ as a 1-form on $\MM_r$.  More fundamentally,
the insertion on $\Sigma_r$ of the operator $\h\O$ that appears
in eqn. (\ref{linco}) already leads to a top-form on $\MM_r$, so the part of $\d(\t q q)/\t q q$
that is a 1-form on $\MM_r$ does not contribute.}  $\MM_\ell'$ that parametrizes
$\SIgma_\ell$.  
There is no conformally-invariant way to get rid of this term; rather,  the conformally-invariant extension of the naive formula (\ref{mezzox}) is
obtained by including it:
\begin{equation}\label{ggg}\left(-\O'+\frac{\d(\t q q)}{\t q q} \O\right)\cdot\h\O=\left(-\partial c-\t\partial\t c +\frac{\d(\t q q)}{\t q q}\right) \O\cdot\h\O .\end{equation}

Here is a partial explanation of the conformal invariance of this combined formula.  Let us recall from eqn. (\ref{pelmo})
that to define what we mean by $q$, we need a first-order  holomorphic local parameter at the point  $p\in \Sigma_\ell$ at which
the gluing occurs (we also need such a parameter on $\Sigma_r$, but the dependence on this is irrelevant for the same reason as in
footnote \ref{yrf}).  To define the product $\t q q$, we need a product of holomorphic and antiholomorphic first-order local parameters,
and to define the 1-form $\d(\t q q)/\t q q$, we need such a product up to a multiplicative constant independent of all moduli.  
This is precisely the same data needed to define the insertion of $(\partial c+\t\partial \t c)\O$.
Indeed,   as the operator $\O'=(\partial c+\t\partial\t c)\O$ is annihilated
by $b_0-\t b_0$, and by $b_n,\t b_n$, $n>0$, the analog of eqn. (\ref{etto}) for insertion of $\O'$ at $p$ is 
$v^z(p)=v^{\t z}(p)=\partial_z v^z(p)+\partial_{\t z}v^{\t z}(p)=0$.  These conditions mean that $v$ leaves fixed the product of
holomorphic and antiholomorphic first-order local parameters at $p$; and accordingly, up to a constant independent of all moduli,
there is a well-defined product of local parameters at $p$.  
    So the $\O'$ and $\d(\t q q)/\t q q \cdot \O$ terms in (\ref{ggg}) violate conformal symmetry in the same way.
Hopefully, this makes it plausible that their sum is conformally-invariant.





We can understand a little more as follows. Split $\O'=(\partial c+\t\partial\t c)\O$ as the sum of two contributions
$\partial c \O$ and $\t\partial\t c\O$. The former insertion requires a holomorphic first-order local   parameter and the latter one requires
an antiholomorphic one.  Similarly, split  $\d(\t q q )/\t q q$ as the sum of $\d q/q$ and $\d\t q/\t q$,
where again the first term depends on a holomorphic first-order parameter and the second on an antiholomorphic one.
Let us just look at the terms in (\ref{ggg}) that depend on the holomorphic local parameter, namely
\begin{equation}\label{cormaly} \left(-\partial c+\frac{\d q}{q}\right)\O'. \end{equation}
As explained at the end of section \ref{condcon},  $q$ is not a complex-valued function
but a linear function on a holomorphic line bundle over $\MM_\ell'$ -- the normal bundle $\frak N$.  Thus $q$ is 
a section of the dual $\frak N^\vee$ of the normal bundle (also called the conormal bundle).  In differential geometry in
general, if one is given a section $q$ of a line bundle $\frak N^\vee$, then to define a 1-form $\d q/q$, one needs
a connection on $\frak N^\vee$.  In the present context, we do not have such a connection (until we pick local
parameters), so $\d q/q$ cannot
be defined in a conformally-invariant way.

However, using the complex structure of\footnote{{\it A priori}, this
 computation should really be done not on $\MM_{\ell}'$,
but on the corresponding heterotic string integration cycle $\varGamma_\ell'$, constructed along
lines described in section \ref{gluehol}.  In the present example, as explained in section \ref{cohoform}, 
$\MM_{\ell}'$ is naturally
split and there is no need to make this distinction.}
 $\MM_\ell'$, we can decompose the exterior derivative on $\MM_\ell'$ as a sum of
pieces of type $(1,0)$ and $(0,1)$:  $\d=\partial+\t\partial$.  Though it does not have a connection, $\frak N^\vee$ does
have a holomorphic structure that is perfectly natural and conformally-invariant.  This means that $\t\partial q/q$,
which is the 
$(0,1)$ part of $\d q/q$, is well-defined, independent of any local parameters.  It will turn out that  the 
Goldstone fermion contribution to the Ward identity comes entirely from this.
The $(1,0)$ part of $\d q/q$ is not conformally-invariant by itself, though the combination 
$(-\partial c+ \partial q/q)\O'$ that appears in (\ref{cormaly}) is conformally-invariant.




\subsubsection{The Vertex Operators}\label{operators}

Let us now specialize to the heterotic string with an anomalous $U(1)$ gauge symmetry.  What vertex operators
$\O$ and $\h\O$ shall we use?  We want to test the hypothesis that the gaugino $\zeta$
becomes a Goldstone fermion
at 1-loop order.  So $\h\O$ will be a gaugino vertex operator at zero spacetime momentum.  
For a gaugino with positive chirality in $\R^4$,
the vertex operator at zero momentum was described in eqn. (\ref{numbo}):
\begin{equation}\label{golp}V_\beta^\zeta= J_\ell \cdot e^{-\tphi/2} \Sigma_{\beta,+}. \end{equation}
This is the integrated vertex operator without the usual $\t c c$ factor.
The conjugate operator in the conformal field theory of the matter fields and the $\beta\gamma$ ghosts
(but without the $bc$ ghosts)   is
\begin{equation}\label{golvo} W^{\zeta}_\beta=J_\ell \cdot e^{-3\tphi/2} \Sigma_{\beta,-}.  \end{equation}
These operators are conjugate in the sense that in genus 0, 
they obey $\langle W^{\zeta} _\beta V^\zeta_\gamma \rangle
\sim \epsilon_{\beta\gamma}$, where $\epsilon_{\beta\gamma}$ is the Lorentz-invariant antisymmetric tensor.
In conventional language, the vertex operator $W^{\zeta}_\beta$ 
is a zero momentum gaugino vertex operator at picture
number $-3/2$ (with negative chirality; see the explanation of picture-changing in section \ref{ferglu}).

Let us now include the Virasoro ghosts and put these operators in the framework of section \ref{expole}. 
To compute the matrix element of
 a supercurrent $\S_\alpha$ to create a gaugino of positive chirality with spinor index $\beta$,
 we must take $\h\O=\t c c V_\beta^\zeta$, and then in eqn. (\ref{ggg}), we must take
 $\O=\t c c W^{\zeta;\,\beta}=\epsilon^{\beta\gamma}\t c c W^{\zeta}_\gamma$.  
 Accordingly, we finally get a formula for the matrix element for $\S_\alpha$ to create the gaugino of polarization
 $\beta$ from the vacuum:
 \begin{equation}\label{mellowbook} \I_\alpha^\beta= \int_{\MM_\ell'}\biggl\langle \S_\alpha \cdot \left(-(\partial c+\t\partial
 \t c)+\frac{\d (\t q q_\Ra)}{\t q q_\Ra }\right) \t c c W^{\zeta;\,\beta}\biggr\rangle. \end{equation}
 (By Lorentz invariance, $\I_\alpha^\beta$ is  a multiple of $\delta_\alpha^\beta$.)
 In writing this formula, since we are now considering specifically the case of a Ramond sector degeneration of
 the heterotic string, we denote the holomorphic gluing parameter as $q_\Ra$ rather than $q$.
We aim to convert this formula to something more concrete.
 
\subsubsection{The Role Of The Fermionic Gluing Parameter}\label{ferglu} 

We come next to a crucial part of this problem.  $\MM_{\ell'}$ is fibered over $\MM_\ell$
with a fiber of dimension $0|1$ that is parametrized by the fermionic gluing parameter $\alpha$.   One approach
to integrating over $\MM_{\ell'}$ is to first integrate over $\alpha$, so as to reduce to an integral over $\MM_\ell$.
By thinking about what will happen if we do this, we can learn something essential.

Integration over $\alpha$ kills what one might call the obvious part of  (\ref{mellowbook})
-- the part that involves the insertion of the operator $\O=(\partial c+\t\partial \t c)\t c c W^\zeta$.  The main reason
is that this operator describes a gaugino at zero momentum in spacetime.  

If we were evaluating the gaugino contribution to a pole
in a scattering amplitude rather than a boundary contribution in a Ward identity, the gaugino would
carry a nonzero (but almost lightlike) spacetime momentum $k$.  In this case, as remarked in relation to
eqn. (\ref{dobzo}), integration over the fermionic gluing parameter  converts a boson propagator $1/L_0$ into a Dirac-like propagator $G_0/L_0$.  For massless
fermions, $G_0$ can be replaced by the Dirac operator $\Gamma\cdot k$.  This vanishes for an on-shell
gaugino, but the propagator also has a factor $1/L_0$ that comes from integration over the magnitude $|q|$ of the
bosonic gluing parameter $q$.  Since $G_0/L_0=1/G_0\sim 1/\Gamma\cdot k$, 
the net effect of this is that an
on-shell gaugino propagating between $\Sigma_\ell$ and $\Sigma_r$ produces a Dirac-like pole.

In computing a boundary contribution to a Ward identity, there is no integral over $|q|$, 
so there is no factor $1/L_0$.  Any term with a factor of 
$G_0$ in the numerator will vanish, since $G_0\sim \Gamma\cdot k$ vanishes for massless states at $k=0$.  (Essentially
this observation has been made in the study of supersymmetric Ward identities in the early literature; see eqn. (6.42) of \cite{HVerlinde}.)

Another perspective on what we have just explained is as follows.  As described in \cite{Surfaces}, section 4.3,
a Ramond vertex operator of picture number $-3/2$ is inserted at a point $f$ on a Ramond divisor $\F$,
while a Ramond vertex operator of picture number $-1/2$ is associated to the whole divisor.  The picture-changing
operation from picture number $-3/2$ to picture number $-1/2$ is integration over the point $f\in\F$.  In our
context, we are gluing $\Sigma_\ell$ to $\Sigma_r$ by gluing a Ramond divisor $\F_\ell\subset \Sigma_\ell$
to a Ramond divisor $\F_r\subset\Sigma_r$.  The fermionic gluing parameter is precisely the choice of a point
in $\F_\ell$ that is glued to a given point in $\F_r$, and integration over this gluing parameter is the picture-changing
operation.   This integration actually produces in eqn. (\ref{dobzo}) not just the factor $G_0$ that we discussed above
but the combination $\delta(\beta_0)G_0$.  This combination is the picture-changing operation that at momentum
$k$ maps
a picture number $-3/2$ gaugino vertex operator $W^{\zeta;\,\beta}$ to 
$(\Gamma\cdot k)^{\beta\dot\beta}V^\zeta_{\dot\beta}$, where 
\begin{equation}\label{delft}\V^\zeta_{\dot\beta}=J_\ell e^{-\tphi/2}\Sigma_{\dot\beta,-} \exp(ik\cdot X)\end{equation}
 is a gaugino vertex operator of picture number $-1/2$ and negative chirality.  
 In our problem, the momentum $k$ vanishes, so $\Gamma\cdot k=0$ and picture-changing simply annihilates
$W^{\zeta;\,\beta}$. Hence integration over the fermionic gluing parameter annihilates the operator
$\O=(\partial c+\t\partial \t c)\t c c W^\zeta$.

In view of what will be explained shortly, one should wonder if  $\O$
has a hidden dependence on the fermionic gluing parameter because it is not a conformal vertex operator
and depends on choices of local parameters at its insertion point.  What prevents this is as follows.  One contribution
in $\O$, namely $\partial c \cdot\t c c W^\zeta$, can be dropped for the trivial reason that its holomorphic and
antiholomorphic ghost numbers imply the vanishing of its contribution in (\ref{mellowbook}).  (With $\S=c S$,
this contribution has ghost quantum numbers 
$c^3 \t c$, while a nonzero contribution would come from $c^2\t c^2$.)  The
other contribution, namely $\t\partial\t c\cdot \t c c W^\zeta$, depends on an antiholomorphic local parameter at $p$,
not a holomorphic one.  Roughly speaking, this operator has no hidden dependence on the fermionic
gluing parameter  because the antiholomorphic local parameter can be defined to never depend
on the fermionic moduli, which are holomorphic.  More accurately, this is true if we follow the procedure
explained in section \ref{cohoform} (see especially footnote \ref{alto}), in which a natural projection of $\MM_\ell'$ is used in evaluating the boundary
contribution to the Ward identity.   

So we can drop the more obvious term in (\ref{mellowbook}), and we are left with the slightly exotic-looking 
term involving
$\d(\t q q_\Ra)/\t q q_\Ra$:
\begin{equation}\label{prto} \I_\alpha^\beta=-\int_{\MM_\ell'}\frac{\d(\t q q_\Ra)}{\t q q_\Ra}\biggl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\biggr\rangle
.\end{equation}
Just as before, integration over the fermionic gluing parameter will annihilate the operator $ \t c c W^{\zeta;\,\beta}$,
so to get a nonzero result, the fermionic gluing parameter will have to somehow be hidden in the expression
$\d(\t q q_\Ra)/\t q q_\Ra$. 
We can actually be slightly more precise.  With $\S_\alpha =c S_\alpha$, the ghost quantum numbers
in  $\bigl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\bigr\rangle$ are $c^2\t c$; this
is missing one $\t c$ factor relative to a correlation function that would
give a top-form on moduli space.  Hence it produces a form of codimension $(0,1)$.  This means
that only the part of $\d(\t q q_\Ra)/\t q q_\Ra$ that is of type $(0,1)$ is relevant.  We can thus replace (\ref{prto}) with
\begin{equation}\label{parto} \I_\alpha^\beta=-\int_{\MM_\ell'}\frac{\t\partial(\t q q_\Ra)}{\t q q_\Ra}\biggl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\biggr\rangle, \end{equation}
and we will have to find the fermionic gluing parameter in the $(0,1)$-form $\t\partial(\t q q_\Ra)/\t q q_\Ra$. 

We further have
\begin{equation}\label{minzo} \frac{\t\partial(\t q q_\Ra)}{\t q q _\Ra}
=\frac{\t\partial q_\Ra}{ q _\Ra}+\frac{\t\partial\t q }{\t q}.\end{equation}
As we have explained at the end of  section \ref{expole}, $\t\partial q_\Ra/q_\Ra$ is completely
well-defined and conformally-invariant, for any section $q_\Ra$ of the holomorphic conormal bundle $\frak N^\vee$,
simply because $\frak N^\vee$ is a holomorphic line bundle.  By contrast, $\t q$ is a section of the antiholomorphic
conormal
bundle $\t{\frak N}^\vee$, so $\t\partial\t q/\t q$ cannot be defined in a conformally-invariant way.  But if we follow
the procedure explained in section \ref{cohoform}, using a hermitian metric that does not depend on the odd
moduli to define a connection on $\t\fN^\vee$, then this term does not contibute.  So with this sort of procedure
(which is also the procedure that ensures vanishing of the $\t\partial\t c \cdot \t c c W^\zeta$ contribution to $\I$), (\ref{parto}) really only 
receives a contribution
 $\partial q_\Ra/q_\Ra$.  Still,  it is most convenient to leave the formula for $\I$ in the form given in (\ref{parto}),
without dropping the $\t\partial \t q/\t q$ term.   This will slightly shorten the explanation in section \ref{cohoform}.

We will see next what feature of supergeometry can force  $\t q q_\Ra$ to 
have an unavoidable dependence on the fermionic
gluing parameter.  The non-zero value of the integral $\I$ comes entirely from this, since as we have
seen, integration over the fermionic gluing parameter annihilates everything else.

\subsubsection{The Holomorphic Projection}\label{holproj}

We defined $\MM_\ell'$ as a fiber bundle, with fibers of dimension $0|1$ parametrized by the fermionic gluing
parameter, over $\MM_\ell$.  In particular, there is a natural projection $\MM_\ell'\to \MM_\ell$.  In turn, in our main
example, $\MM_\ell$ is the moduli space of genus 1 super Riemann
surfaces with no NS punctures and 2 Ramond punctures, which we might call $\MM_{1,0,2}$.  The dimension
of $\MM_\ell$ is $2|1$.   (We always intend the Deligne-Mumford compactifications of  these moduli
spaces, though we do not indicate this in the notation.)

Now we require a slight extension of what was explained in section \ref{gluehol}.
A complex supermanifold $M$, say of dimension $p|q$, has a reduced space $M_\red$ of dimension $p|0$, obtained
by reducing modulo the odd variables.
If $M$ has local coordinates $z_1,\dots,z_p|\theta_1\dots\theta_q$, then $M_\red$ has local
coordinates $z_1,\dots,z_p$.
There is always a natural embedding $i:M_\red\to M$, which in local coordinates maps $z_1,\dots ,z_p$
to $z_1,\dots,z_p|0,\dots,0$.  $M$ is said to be holomorphically projected if there is also a holomorphic
projection $\pi:M\to M_\red$, obeying $\pi i=1$; the last condition means that $\pi=1$ when restricted
to $M_\red$. 
For example, if the odd dimension of $M$ is 1, there is always a unique projection $M\to M_\red$.    In local coordinates,
this map takes $z_1,\dots,z_p|\theta$ to $z_1,\dots,z_p$.  
With two or more odd coordinates, a holomorphic projection is not unique locally  (for example, in dimension $1|2$, 
$z|\theta_1,\theta_2$ could be mapped to $z$ or to $z+\theta_1\theta_2$), and
may not exist globally.    An example important for superstring perturbation theory is that
in general the moduli space of super Riemann surfaces
is not holomorphically projected \cite{DW}. Holomorphic projections from supermoduli space to ordinary moduli space,
when they exist, are a powerful tool in superstring perturbation theory, exploited notably in \cite{DPh}.

Returning to $\MM_\ell$, since its odd dimension is 1,  it has
a unique projection to its reduced space $\MM_{\ell,\red}$.
Composing the natural projection $\MM_\ell'\to \MM_\ell$ with the unique projection $\MM_{\ell}\to \MM_{\ell,\red}$,
we get a natural projection $\pi:\MM_\ell'\to \MM_{\ell,\red}$.   Actually, $\MM'_\ell$ and $\MM_\ell$ have the same
reduced space (since the fibers of $\MM'_\ell\to\MM_\ell$ are purely odd), so $\pi$ is a holomorphic projection of
$\MM_\ell'$ to its reduced space $\MM'_{\ell,\red}$.

Thus, the subtleties that were discussed in section \ref{gluehol} have no analog for $\MM_{\ell}'$, even though
its odd dimension is 2, which in general is enough to produce such subtleties.  Local holomorphic coordinates
$m_\alpha$ on $\MM_{\ell,\red}$ can be pulled back in a natural way to bosonic local  coordinates $\pi^*(m_\alpha)$ on $\MM_{\ell}'$. Integration over $\MM_{\ell}'$ can be performed in a natural fashion by first integrating over the fibers of
$\pi:\MM_{\ell}'\to \MM_{\ell,\red}$.

The heterotic string on $\Sigma_\ell$ has antiholomorphic as well as holomorphic moduli.  The antiholomorphic moduli space 
that is ``seen'' by the antiholomorphic variables of the heterotic string is simply
 the complex conjugate of $\MM_{\ell,\red}$.    So once one takes the holomorphic even 
moduli $m_\alpha$ of $\SIgma_\ell$ to be pullbacks from $\MM_{\ell,\red}$, 
one can take the antiholomorphic moduli $\t m_\alpha$ of $\Sigma_{\ell}$ to be simply their complex conjugates
\begin{equation}\label{ozmo} \bar{\t m_\alpha}=m_\alpha,\end{equation}
without the nilpotent terms of eqn. (\ref{mezmo}).  Those terms are inescapable in the absence of a holomorphic
projection, but with such a projection, there is no need for them. 
Accordingly, there is no need to distinguish between $\MM_\ell'$ and a corresponding heterotic string 
integration cycle $\varGamma'_\ell$, and the integral (\ref{parto}) for the Goldstone fermion contribution to the Ward
identity really is properly understood as an integral over $\MM_\ell'$.    

The reduced space $\MM'_{\ell,\red}$ parametrizes an ordinary Riemann surface $\Sigma_0$ of genus 1 with
some additional data (two punctures and a generalized spin structure).  Forgetting the additional data,
we get a holomorphic map from $\MM'_{\ell,\red}$ to $\M_1$, the moduli space 
of ordinary Riemann surfaces of genus 1.  Composing this with $\pi:\MM'_\ell\to \MM'_{\ell,\red}$, we get
a holomorphic fibration of $\MM'_{\ell,\red}$ over $\M_1$.  Let
$\MM'_{\ell,\tau}$ be the fiber of this map lying over the point in $\M_1$ that corresponds to an elliptic curve with
modular parameter $\tau$:
\begin{equation}\label{okely}  \begin{matrix} \MM'_{\ell,\tau}& \to & \MM'_{\ell}\cr
   & & \downarrow \cr
      & & \M_1.\end{matrix}                \end{equation}
  We can integrate over $\MM_{\ell}'$ by  integrating first over $\MM_{\ell,\tau}'$ and
then  over $\tau$.  This is analogous to the procedure followed in section \ref{mass}, and just
as there, the interesting phenomena occur in the integral over $\MM_{\ell,\tau}'$, at fixed $\tau$.


\subsubsection{The Cohomological Formula}\label{cohoform}

In proceeding, it helps slightly to consider the basic case (fig. \ref{bunderwood}) of the supersymmetric
Ward identity  that governs a 1-loop supersymmetry-violating mass shift.  
In this case, $\Sigma$ is a super Riemann surface of genus 1 with 1 NS puncture and 2 Ramond punctures.
$\Sigma$ is parametrized by a  moduli space $\MM_{1,1,2}$ of dimension $3|2$.  $\MM_\ell'$ is a divisor ``at infinity''
in $\MM_{1,1,2}$ describing the splitting of $\Sigma$ to components $\Sigma_\ell$ and $\Sigma_r$ of genera 1 and 0, 
respectively.   $\MM_r$ is a point and plays no role.  In the case of a more general supersymmetric Ward identity,
the discussion would proceed in the same way except that everything would be fibered over $\MM_r$, which would play
no essential role.

To understand the $(0,1)$-form 
$\lambda=(\t q q_\Ra)^{-1}\t\partial (\t q q_\Ra)$ that appears in (\ref{parto}), we need to understand the 
holomorphic and antiholomorphic
normal bundles $\fN$ and $\t{\fN}$ to $\MM_\ell'$ in $\MM_{1,1,2}$.

First of all, let $\fN_0$ be the restriction of $\fN$ to $\MM'_{\ell,\red}\subset \MM'_\ell$.  Using the holomorphic
projection $\pi:\MM'_\ell\to \MM'_{\ell,\red}$, we can pull back $\fN_0\to \MM'_{\ell,\red}$ to $\pi^*(\fN_0)\to \MM'_\ell$.
$\fN$ is not necessarily equivalent to $\pi^*(\fN_0)$.  All that we know {\it a priori} is that they coincide when restricted
to $\MM'_{\ell,\red}$, so if we define another
line bundle $\fN_1\to\MM'_{\ell}$ by
\begin{equation}\label{zembo} \fN=\pi^*(\fN_0)\otimes \fN_1,\end{equation}
then $\fN_1$ is canonically trivial when restricted to $\MM'_{\ell,\red}$.  Since the odd directions in a supermanifold are
infinitesimal, a line bundle over any complex supermanifold $M$ that is trivial when restricted to $M_\red$
is always topologically trivial, but it may be holomorphically non-trivial.  In the present example, it turns out
that $\fN_1$ is holomorphically non-trivial.



Once we restrict to $\MM'_{\ell,\red}$, we can consistently replace a super Riemann surface by its 
reduced space, and the 
Ramond sector gluing law (\ref{medzo}) reduces to the bosonic gluing law $xy=q_\Ra$.  
$\MM'_{\ell,\red}$ is  a divisor in 
 $\MM_{1,1,2,\red}$ (that is, in the reduced space of
$\MM_{1,1,2}$) and $\fN_0$ is its normal bundle.
If we reverse the complex structures of all objects mentioned in the last sentence, 
$\MM_{1,1,2,\red}$ becomes the moduli space appropriate for antiholomorphic degrees of freedom of the heterotic
string; it contains the divisor $\MM'_{\ell,\red}$ with normal bundle $\fN_0$, both with their complex structures reversed.
So the antiholomorphic normal bundle $\t\fN$ to the divisor $\MM'_\ell\subset \MM_{1,1,2}$  is just $\pi^*(\fN_0)$ with its
complex structure reversed.  We write this as $\pi^*(\bar\fN_0)$.    We combine this  result
with (\ref{zembo}):
\begin{equation}\label{wembo}\t\fN\otimes \fN=\pi^*(\bar \fN_0\otimes \fN_0)\otimes \fN_1. \end{equation}

Taking the duals gives an equivalent formula for the tensor product of conormal bundles:
\begin{equation}\label{rembo}\t\fN^\vee\otimes \fN^\vee=\pi^*(\bar\fN_0^\vee\otimes \fN_0^\vee)
\otimes \fN_1^\vee. \end{equation}
For any line bundle $\L$, the tensor product $\bar\L\otimes \L$ is always trivial: it can be trivialized by the choice
of a hermitian metric on $\L$.  (We call a section of $\bar\L\otimes \L$  positive if it is associated to a hermitian metric on $\L$.) And we know already that $\fN_1$, and hence its dual $\fN_1^\vee$, is topologically
trivial.  So $\t\fN^\vee\otimes \fN^\vee$ is topologically trivial.  Therefore, it is possible to pick 
a smooth trivialization of this line bundle -- 
a section of
it  that is everywhere nonzero.   Such a section is what we mean by $\t q q_\Ra$ in the formula (\ref{parto}).  
Locally but not globally, one can assume that the everywhere
nonzero section of 
$\t\fN^\vee\otimes \fN^\vee$ that we call $\t q q_\Ra$ is the product of a section $\t q$ of $\t\fN^\vee$ and
a section $q_\Ra$ of $\fN^\vee$.  (As explained in section \ref{expole},
 our main formulas require only a trivialization of $\t\fN^\vee\otimes \fN^\vee$
and not separate trivializations of the two factors because the operator $\O'$ is annihilated by $b_0-\t b_0$.) 

We can take $\t q q_\Ra = TU$, where $T$ is a trivialization of $\pi^*(\bar\fN_0^\vee\otimes \fN_0^\vee)$
and $U$ is a trivialization of $\fN_1$.  Moreover, since $\pi^*(\bar\fN_0^\vee\otimes \fN_0^\vee)$ is a pullback
from $\MM'_{\ell,\red}$, we can assume that $T$ is also such a pullback.  (More specifically, we can assume that $T$ is positive, and require that $U=1$
when restricted to $\MM'_{\ell,\red}$.)    Then $T$ is independent of
the fermionic gluing parameter, and so does not contribute in the formula (\ref{parto}) for the Goldstone
fermion contribution to the Ward identity.\footnote{\label{alto} We cannot simply argue -- as we do below for $U$ -- that the choice
of $T$ does not affect the integral we are trying to evaluate; the argument does not work since $T$ trivializes a line bundle that does not have a natural
holomorphic structure.  However, defining $T$ as a pullback from $\MM'_{\ell,\red}$ ensures that
$\t q q_\Ra$ is the product of such a pullback with a section of a holomorphic line bundle (namely $\fN^\vee_1$).
This makes it possible to drop the term $(\partial c+\t\partial \t c)\O'$ in the main formula (\ref{mellowbook}), as we did in section \ref{ferglu}, by ensuring that
that operator has 
no hidden dependence on  the fermionic gluing parameter via its dependence on  local
parameters; a pullback from $\MM'_{\ell,\red}$ does not depend on the fermionic gluing parameter, and a section of a holomorphic line
bundle  affects only  $\partial c \O'$, which has the wrong holomorphic and antiholomorphic ghost  numbers to be relevant. 
In other words, taking $T$ to be a pullback from $\MM'_{\ell,\red}$ causes the contribution
of $T$ and that of $(\partial c+\t\partial\t c)\O'$ to vanish separately and justifies our claims in section \ref{ferglu}.}

So (\ref{parto}) can be expressed entirely in terms of the trivialization $U$ of the holomorphic line bundle
$\fN_1^\vee$:
\begin{equation}\label{karto} \I_\alpha^\beta=-\int_{\MM_\ell'}\frac{\t\partial_{\fN_1^\vee} U}{U}\biggl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\biggr\rangle
.\end{equation}
Here $\t\partial_{\fN_1^\vee}$ is the $\t\partial$ operator on the line bundle $\fN_1^\vee$; we usually omit
this subscript (as the line bundle is generally clear from the context) but here we include it for emphasis.

The reason that this is an advance is that a trivialization of a holomorphic line bundle has a cohomological
meaning.  Over any complex manifold or supermanifold $M$, a holomorphic line bundle $\L$ that is topologically
trivial is associated to a natural class  $\Lambda(\L)\in H^1(M,\eO)$, where $\eO$ is the sheaf of 
holomorphic functions on $M$.
Indeed, if $\L$ is topologically trivial, let $U$ be a smooth trivialization of $\L$, and consider
the $(0,1)$-form $\lambda=U^{-1}\t\partial_\L U$, where
$\t\partial_\L$ is the $\t\partial$ operator of $\L$.   The class $\Lambda(\L)$ associated to $\L$ is simply
the cohomology class of $\lambda$ in $H^1(M,\eO)$.
To show that this class does not depend on the choice of $U$, one simply observes that any other trivialization would
be $e^fU$, for some function $f$.  But $(e^fU)^{-1}\t\partial_\L(e^fU)=\lambda+\t\partial_\eO f$, where now $\t\partial_\eO$
is the $\t\partial $-operator on functions (sections of $\eO$).  By the definition of $\t\partial$-cohomology,
the class of a $(0,1)$-form $\lambda$ in $H^1(M,\eO)$ is invariant under $\lambda\to\lambda+\t\partial_\eO f$
for any function $f$.  A standard argument shows that the correspondence between $\L$ and $\Lambda(\L)$ is
a 1-1 correspondence between topologically trivial line bundles and classes in $H^1(M,\eO)$. 

So we  can rewrite our basic formula (\ref{karto}):
\begin{equation}\label{arto} \I_\alpha^\beta=-\int_{\MM_\ell'}\Lambda(\fN_1^\vee)\biggl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\biggr\rangle.\end{equation}
To understand this better, we should give a cohomological interpretation to the correlation function
$F_{\S\cdot \t c c W}=\bigl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\bigr\rangle$. 
From a holomorphic point of view, $F_{\S\cdot \t c c W}$ is a top-form.  On a complex supermanifold $M$, a top-form in the
holomorphic sense is a section of $\BBer(M)$, the Berezinian of $M$ in the holomorphic sense. 
 From an antiholomorphic point of view, 
$\MM'_\ell$ has dimension $2|0$ and $F_{\S\cdot \t c c W}$ is a form of codimension 1, and hence a $(0,1)$-form. 
Combining these facts, $F_{\S\cdot \t c c W}$ is an element of $H^1(\MM'_\ell,\BBer(\MM'_\ell))$.
  The cup product of $\Lambda(\fN_1^\vee)\in H^1(\MM'_\ell,\eO)$
and  $F_{\S\cdot \t c c W}$ gives a class in $H^2(\MM'_\ell,\BBer(\MM'_\ell))$.  Such a class is a top-form 
both holomorphically and antiholomorphically; equivalently, it is a section of $\mathrm{Ber}(\MM'_\ell)$, which is the
Berezinian of  $\MM'_\ell$ in the smooth sense, with $\MM'_\ell$ viewed
as a smooth supermanifold of dimension $4|2$.  So the product $\Lambda(\fN_1^\vee) F_{\S\cdot \t c c W}$
 can be integrated, and this integral
is what appears on the right hand side of eqn. (\ref{arto}).

\subsubsection{Overview Of The Remaining Steps}\label{teldor}

The formula  (\ref{arto}) expresses as the product of two factors the measure that must be integrated over $\MM'_\ell$ to determine
if supersymmetry is spontaneously broken by 1-loop effects.  The first factor $\Lambda(\fN_1^\vee)$ is universal, independent
of the specific string theory compactification.  It purely reflects properties of the moduli space of super Riemann surfaces.  The information
involving the choice of a specific compactification is entirely contained in the correlation function $\bigl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\bigr\rangle$
that comprises the second factor in
eqn. (\ref{arto}). 

If the universal factor  $\Lambda(\fN_1^\vee)$
were zero, 1-loop effects would never trigger the spontaneous breaking of supersymmetry, 
irrespective of the details of a specific
model.   Actually, this cohomology class does not vanish, but to show this 
one must go in somewhat greater depth with super Riemann surfaces
than has been necessary in this paper.
We defer this to elsewhere \cite{DWtwo}, and here we merely explore the consequences of a nonzero $\Lambda(\fN_1^\vee)$.

A simple observation is that $\Lambda(\fN_1^\vee)$ vanishes if restricted to $\MM'_{\ell,\red}$. This is because the line bundle $\fN_1$ is trivial
when restricted to $\MM"_{\ell,\red}$.   Concretely, we can choose $U$ so
that $U=1$ on $\MM'_{\ell,\red}$, in which case the form $\lambda=\t\partial_{\fN_1^\vee} U/U$ is identically zero when restricted to $\MM'_{\ell,\red}$.
(More generally, for any $U$, the cohomology class  of this form is zero when restricted to $\MM'_{\ell,\red}$.)
We recall now that  $\MM'_{\ell,\red}$ has precisely two odd moduli -- the fermionic
gluing parameter $\alpha$, and one more odd modulus, which we will call $\eta$.    With our choice of $U$, since $\lambda$ vanishes when $\alpha$ and $\eta$
are zero (and since it is a $(0,1)$-form  that is valued in even functions), $\lambda$ is proportional
to $\alpha\eta=\delta(\alpha)\delta(\eta)$.  

Now we return to eqn. (\ref{karto}).
The delta functions in  $\lambda$ mean that we can set $\alpha=\eta=0$ when we study the correlation function $F_{\S\cdot \t c c W}=\bigl\langle \S_\alpha
\cdot \t c c W^{\zeta;\,\beta}\bigr\rangle$.   Hence we do not have to worry about changes of variables such as $m\to m+\alpha\eta$
where $m$ is an even modulus.    Accordingly, most of the subtleties of superstring perturbation theory
become irrelevant.
 $\MM'_{\ell,\red}$ has 2 odd moduli, which  is enough to bring into play the subtleties of super Riemann surface theory;
 but they are all contained in the cohomology class $\Lambda(\fN_1^\vee)$.  

In particular, we can use the picture-changing approach of \cite{FMS}, with an important modification coming from the fact
that $\Lambda(\fN_1^\vee)$ is proportional to $\delta(\alpha)\delta(\eta)$.   As explained in
\cite{VV}, the  picture-changing operator $\YY(p)$ reflects the effect of integrating over an odd modulus
$\trho$ that represents the coefficient of a delta-function term in the gravitino field $\chi_{\t z}^\theta=\trho \delta^2(z-p)+\dots$. 
(In our application, the two odd moduli $\alpha$ and $\eta$ can both be represented in terms of such delta function gravitinos.)
The picture-changing operator is $\YY=\delta(\beta)S_{z\theta}$, 
where $S_{z\theta}$ is the worldsheet supercurrent and $\delta(\beta)$  
is usually written as $e^\tphi$ in the bosonized description of the $\beta\gamma$ system.  In 
the approach described in section 3.6 of \cite{Revisited}, the factors
of $S_{z\theta}$ and $\delta(\beta)$ come, respectively, from integration over $\trho$ and $\d\trho$:
\begin{equation}\label{tozzo}\int \D(\trho,\d\trho)  \exp\left(\d\trho \beta(p)+\trho S_{z\theta}(p)\right)=\delta(\beta(p))S_{z\theta}(p).   \end{equation}
However,  in our application, this integral multiplies the factor $\Lambda(\fN_1^\vee)$ that is explicitly proportional to $\delta(\trho)$ (where $\trho$ is
a linear combination of $\alpha$ and $\eta$), so we do not want to integrate
over $\trho$ with the help of the term $\trho S_{z\theta}(p)$ in the exponent; on the contrary, we can drop this term, because
of the delta function $\delta(\trho)$.  The integral over
$\d\trho$ still gives a factor of $\delta(\beta)$.  

The upshot is that we can use the picture-changing formalism, but we must use partial picture-changing operators $\delta(\beta)$
rather than the full picture-changing operator $\YY(p)=\delta(\beta)S_{z\theta}$.  Accordingly, the correlation function that we have
to evaluate is
\begin{equation}\label{irrox} \biggl\langle cS_\alpha(z) \delta(\beta(p))\delta(\beta(p')) \t c c W^{\zeta;\beta} (0)   \biggr\rangle,\end{equation}
with two arbitrary points $p$ and $p'$.  We have made the $c$ ghosts explicit by replacing $\S_\alpha$ with $c S_\alpha$,
but we do not indicate explicitly the corresponding antighost insertions (2 insertions of $b$ and 1 of $\t b$, since 
 the correlation
function is supposed to be a $(2,1)$-form on $\MM'_{\ell,\red}$ from a bosonic point of view).  
This correlation function is independent of $p$ and $p'$ and of the choices of $b$ and $\t b$ insertions
 if properly understood as
a $(0,1)$-form valued in   $\BBer(\MM'_\ell)$ (in particular, its dependence on $p$ and $p'$ comes entirely from the dependence on $p$ and $p'$
of the cohomology classes of the gravitino deformations $\delta^2(z-p)$ and $\delta^2(z-p')$;  the usual complications of the picture-changing formalism are absent, because we  compute the correlation function at $\alpha=\eta=0$).  Rather as in section
\ref{simplesplit}, we can take $p,p'\to 0$ and replace $W^{\zeta;\beta}$ with $W^{'\zeta;\beta}=e^{\tphi/2}J_\ell 
\epsilon^{\beta\gamma}\Sigma_{\gamma,-}$.  After also evaluating the $bc$ and $\t b \t c$ correlation functions, 
and recalling that $S_\alpha=e^{-\tphi/2}\Sigma_{\alpha,+}$, we reduce to a two-point function
\begin{equation}\label{noxo}
\bigl\langle e^{-\tphi/2}\Sigma_{\alpha,+}(z)\cdot e^{\tphi/2}J_\ell \epsilon^{\beta\gamma}\Sigma_{\gamma,-}(0)\bigr\rangle.\end{equation}

This two-point function is very similar to the one that we encountered in eqn. (\ref{medolo}).  It is completely determined
by the operator product expansion, because the operator $e^{-\tphi/2}\Sigma_{\alpha,+}(z)$ varies  holomorphically with $z$.
The salient fact is the appearance in the OPE of the vertex operator $V_D$ of the $D$ auxiliary field:
\begin{equation}\label{oxo}e^{-\tphi/2}\Sigma_{\alpha,+}(z)\cdot e^{\tphi/2}J_\ell \epsilon^{\beta\gamma}\Sigma_{\gamma,-}(0)\sim\delta^\beta_\alpha V_D(0).
\end{equation}
As a result, the correlation function under study and hence also the matrix element for the supercurrent to create the gaugino
from the vacuum is proportional to $\langle V_D\rangle$, with a universal coefficient.



\vskip1cm

 \noindent {\it {Acknowledgements}}  Research supported in part by NSF Grant PHY-0969448. I thank K. Becker, P. Deligne,  R. Donagi, G. Moore,
 N. Seiberg,  and H. Verlinde  for useful advice and comments.


\bibliographystyle{unsrt}
\begin{thebibliography}{99}


\bibitem{Birth}
A. Cappelli, E. Castellani, F. Colomo, and P. DiVecchia, eds., {\it The Birth Of String Theory} (Cambridge University Press, 2012).

\bibitem{Revisited}
E. Witten, ``Superstring Perturbation Theory Revisited,'' arXiv:1209.5461.

\bibitem{DIS}
M. Dine, I. Ichinose, and N. Seiberg, ``$F$ Terms And $D$ Terms In String Theory,''  Nucl. Phys. {\bf B293} (1987) 253.

\bibitem{ADS}
J. J. Atick, L. J. Dixon, and A. Sen, ``String Calculation Of 
Fayet-Iliopoulos $D$-Terms In Arbitrary Supersymmetric Compactifications,''
Nucl. Phys. {\bf B292} (1987) 109-149.

 \bibitem{GrSe}
M. B. Green and N. Seiberg, ``Contact Interactions In Superstring Theory,'' Nucl. Phys. {\bf B299} (1988) 559.

\bibitem{AS}
J. J. Atick and A. Sen, ``Two-Loop Dilaton Tadpole Induced By Fayet-Iliopouplos $D$ Terms In Compactified
Heterotic String Theories,'' Nucl. Phys. {\bf B296} (1988) 157-186.

\bibitem{DD}
J. Distler and M. D. Doyle, ``World-Sheet Supersymmetry Without
Contact Terms,'' hep-th/9203058.

\bibitem{DSW}
M. Dine, N. Seiberg, and E. Witten, ``Fayet-Iliopoulos Terms In String Theory,'' Nucl. Phys. {\bf B278} (1986) 769.

\bibitem{ASen}
A. Sen, ``Supersymmetry Restoration In Superstring Perturbation Theory,'' arXiv:1508.12481.

\bibitem{DiM}
M. Dine and A. Monteux, ``Discrete $R$ Symmetries And Anomalies,'' arXiv:1212.4371.

\bibitem{FS}
W. Fischler and L. Susskind, ``Dilaton Tadpoles, String Condensates, and Scale Invariance,''
Phys. Lett. B171 (1986) 383. 

\bibitem{GOS}
F. Gliozzi, J. Scherk, and D. Olive, ``Supergravity And The Dual Spinor Model,'' Phys. Lett. {\bf B65} (1976) 282.

\bibitem{Supermanifold}
E. Witten, ``Notes On Supermanifolds And Integration,'' arXiv:1209.2199.

\bibitem{Surfaces}
E. Witten, ``Notes On Super Riemann Surfaces And Their Moduli,'' arXiv:1209.2459.

\bibitem{DPh}
E. D'Hoker and D. H. Phong, ``Lectures on Two-Loop Superstrings,'' Adv. Lect. Math. {\bf 1} 85-123, hep-th/021111,
and references therein.




\bibitem{FMS}
D. Friedan, E. Martinec, and S. Shenker, ``Covariant Quantization Of Superstrings,'' Phys. Lett. {\bf B160} (1985) 55,
``Conformal Invariance, Supersymmetry, and String Theory,'' Nucl. Phys. {\bf B271} (1986) 93.

\bibitem{VV}
E. Verlinde and H. Verlinde, ``Multiloop Calculations In Covariant Superstring Theory,'' Phys. Lett. {\bf B192} (1987) 95. 

\bibitem{Lechtenfeld}
O. Lechtenfeld, ``Superconformal Ghost Correlations On Riemann Surfaces,''
Phys. Lett. {\bf B232} (1989) 193.  

\bibitem{gvz}
M. T. Grisaru, A. E. M. van de Ven, and D. Zanon, ``Two-Dimensional Sigma-Models With Ricci-Flat Kahler Manifolds Are
Not Finite,'' Nucl. Phys. {\bf  B277} (1986) 388.

\bibitem{holomorphy}
E. Witten, ``Notes On Holomorphic String And Superstrings Measures Of Low Genus,'' arXiv:1306.3621.

\bibitem{DPhlatest}
E. D'Hoker and D. Phong, ``Two-Loop Vacuum Energy For Calabi-Yau Orbifold Models,'' Nucl. Phys. {\bf B877} (2013) 343-400.


\bibitem{Wittennew}
E. Witten, ``The Super Period Matrix With Ramond Punctures,'' arXiv:1501.02499, J. Geom. Phys. {\bf 92} (2015) 210-239. 


\bibitem{RSV}
A. A. Rosly, A. S. Schwarz, and A. A. Voronov, ``Geometry Of Superconformal Manifolds,''
Comm. Math. Phys. {\bf 119} (1988) 129-152.
   


\bibitem{DPhtwo}
E. D'Hoker and D. H. Phong, ``Conformal Scalar Fields And Chiral Splitting On Super Riemann Surfaces,'' Commun. Math. Phys. {\bf 125} (1989) 469-513.


\bibitem{K}
  V.~G.~Knizhnik,
  ``Covariant Fermionic Vertex in Superstrings,''
  Phys.\ Lett.\ {\bf B160} (1985) 403.

\bibitem{Belopolsky}
A. Belopolsky, ``New Geometrical Approach To Superstrings,'' hep-th/9703183.

\bibitem{Thorn}
C. B. Thorn, ``A Detailed Study Of The Physical State Conditions In Covariantly Quantized
String Theories,'' Nucl. Phys. {\bf B286} (1987) 61.

\bibitem{VafaMany}
L. Alvarez-Gaum\'e, C. Gomez, G. W. Moore, and C. Vafa, ``Strings In The Operator
Formalism,'' Nucl. Phys. 
{\bf B303} (1988) 455.

\bibitem{Nelson}
P. C. Nelson, ``Covariant Insertions Of General Vertex Operators'' Phys. Rev. Lett. {\bf 62}
(1989) 993-6.

\bibitem{HVerlinde}
H. Verlinde,  ``The Path-Integral Formulation Of Supersymmetric String Theory,'' Utrecht University  Ph.D. thesis, unpublished.

\bibitem{DW}
R. Donagi and E. Witten, ``Supermoduli Space Is Not Projected,'' arXiv:1304.7798, in {\it String-Math 2012} (Proc. Symp. Pure Math. {\bf 90}),
eds. R. Donagi et. al., pp. 19-72.

\bibitem{DWtwo}
R. Donagi and E. Witten, to appear.

\end{thebibliography}
\end{document}
========================================

%------------------------------------------------------------------------------
% Beginning of journal.tex
%------------------------------------------------------------------------------
%
% AMS-LaTeX version 2 sample file for journals, based on amsart.cls.
%
%        ***     DO NOT USE THIS FILE AS A STARTER.      ***
%        ***  USE THE JOURNAL-SPECIFIC *.TEMPLATE FILE.  ***
%
% Replace amsart by the documentclass for the target journal, e.g., tran-l.
%
\documentclass{amsart}
\usepackage{amsmath, amsthm, amssymb, graphicx,slashed}
%\usepackage{graphicx}
\def\cal{\mathcal}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\def\hat{\widehat}
\def\tilde{\widetilde}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{xca}[theorem]{Exercise}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\numberwithin{equation}{section} \font\teneurm=eurm10
\font\seveneurm=eurm7 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
 \font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}

\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}


%$\varpi,\vartheta,\varrho,\varsigma,\Xi$
%$$\eusm{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$$
%    Absolute value notation
\newcommand{\abs}[1]{\lvert#1\rvert}
\def\EUN{\eusm N}
%    Blank box placeholder for figures (to avoid requiring any
%    particular graphics capabilities for printing this document).
\newcommand{\blankbox}[2]{%
 \parbox{\columnwidth}{\centering
%    Set \fboxsep to 0 so that the actual size of the box will match the
%    given measurements more closely.
   \setlength{\fboxsep}{0pt}%
   \fbox{\raisebox{0pt}[#2]{\hspace{#1}}}%
 }%
}
\def\R{{\Bbb{R}}}\def\Z{{\Bbb{Z}}}
\def\EUB{\eusm B}
\begin{document}
\def\C{\Bbb{C}}
\def\M{{\cal M}}

\title{The Problem Of Gauge Theory}

%    Information for first author
\author{Edward Witten}
%    Address of record for the research reported here
\address{Theory Group, CERN, Geneva Switzerland. On leave from
School of Natural Sciences, Institute for Advanced Study, Princeton
NJ 08540 USA.}
%    Current address
\email{witten@ias.edu}
%    \thanks will become a 1st page footnote.
\thanks{Supported in part by NSF Grant Phy-0503584.}

%    General info
%\subjclass[2000]{81Q99, 53D45}

\date{November, 2008}


\def\Bbb{\mathbb}
%\keywords{Yang-Mills theory, quantum field theory, mass gap}

\begin{abstract}
I sketch what it is supposed to mean to quantize gauge theory, and
how this can be made more concrete in perturbation theory and also
by starting with a finite-dimensional lattice approximation.  Based
on real experiments and computer simulations, quantum gauge theory
in four dimensions is believed to have a mass gap.  This is one of
the most fundamental facts that makes the Universe the way it is.
This article is the written form of a lecture presented at the
conference ``Geometric Analysis: Past and Future'' (Harvard
University, August 27-September 1, 2008), in honor of the 60th
birthday of S.-T. Yau.
\end{abstract}

\maketitle

\input epsf
\section{Yang-Mills Equations}
\label{intro}

\def\Tr{{\rm Tr}}

The strong, weak, and electromagnetic interactions -- in other
words, more or less everything we know about in nature except
gravity -- are all described by gauge theory.  Mathematically, in a
gauge theory with gauge group $G$, formulated on a spacetime $M$, a
gauge field is a connection on a $G$-bundle $E\to M$.  For our
purposes, $M$ is a four-manifold with a metric of Lorentz signature
$-+++$. In fact, for our purposes there is no essential loss to take
$M$ to be Minkowski spacetime $\Bbb{R}^{3,1}$ (that is, $ \Bbb{R}^4$
with a flat pseudo-Riemannian metric of Lorentz signature).

In addition to gauge fields, in nature there also are matter fields.
The matter fields describe things such as electrons, neutrinos,
quarks, and possibly Higgs particles.  Gauge fields mediate
``forces'' between particles described by matter fields (and between
additional particles described by the gauge fields themselves). For
simplicity, in this talk, I will omit the matter fields and just
describe the gauge fields.

One thing I should say before getting too far is that, for a large
variety of reasons, it is unrealistic, in a talk or a short article,
to expect to fully describe the problem of Yang-Mills theory. To
really appreciate the problem, it is necessary to delve into quantum
field theory in some depth. There is a large physics literature on
quantum field theory, and there is also a large math literature (for
example, see \cite{GJ}).

I felt in preparing the lecture that to make it comprehensible, I
could not simply skip the preliminaries.  One can skip the
preliminaries and make some formal statements, but such statements
are rather opaque.  On the other hand, it is also not possible to
fully explain the preliminaries in a short space or time, so I have
had to seek a middle path.  This inevitably involves some debateable
choices of what to explain.  The main idiosyncracy in my
presentation is that I have decided to rely on a Hamiltonian
approach (including the well-established \cite{Susskind} but
relatively unfamiliar notion of Hamiltonian lattice gauge theory)
rather than converting everything to path integrals. The path
integral approach is very powerful but involves an extra layer of
abstraction.

Classically, there is no problem to explain what is meant by
Yang-Mills gauge theory.  A gauge field, that is a connection $A$ on
a $G$-bundle $E\to M$, has a curvature $F=dA+A\wedge A$. The
curvature is a two-form on $M$ valued in the adjoint bundle ${\rm
ad}(E)$ derived from $E$. The classical Yang-Mills equations are
\begin{equation}\label{zurf} D\star F=0,\end{equation}
where $\star$ is the Hodge star (mapping two-forms to $n-2$-forms,
where $n={\rm dim}\,M$), and $D=d+A$ is the gauge-covariant
extension of the exterior derivative.

The Yang-Mills equations may be most familiar in the abelian case,
that is in the case that $G=U(1)$. Maxwell's equations of
electromagnetism (in vacuum) can be described in terms of a two-form
$F$ that obeys \begin{equation}\label{urf} 0 = d\star F=d
F.\end{equation}  The first of these equations is the Yang-Mills
equation as written in eqn. (\ref{zurf}). (Recall that $D$ reduces
to $d$ when $G$ is abelian.) We can omit the second equation if we
define $F=dA$ as the curvature of a connection $A$, for it is then
an identity -- the Bianchi identity.

For $G=U(1)$, Maxwell's equations describe propagation of light
waves in vacuum. These are linear equations, so, for example, in the
approximation that Maxwell's equations are valid, two beams of light
pass through each other without scattering.  (In a more precise
description of nature, there are all sorts of corrections to
Maxwell's equations, involving things such as quantum mechanics,
electrons, and gravity, so it is not expected that the propagation
of light is precisely linear even in vacuum.  The nonlinearities are
expected to be very small and have not yet been observed, though it
is believed that this may be possible in the near future.)

In the nonabelian case, the Yang-Mills equations $D\star F=0$ are
{\it nonlinear} wave equations.  So classical Yang-Mills waves do
scatter each other, although in the case of weak waves, the
nonlinearities and the scattering effects are small.  In this
respect, the Yang-Mills equations are analogous to the vacuum
Einstein equations $R_{\mu\nu}=0$ (where $R$ is the Ricci tensor).
They are nonlinear hyperbolic wave equations.

\begin{figure}
  \begin{center}
    \includegraphics[width=3in]{Fig1.eps}
  \end{center}
\caption{A spacetime with a global Cauchy hypersurface.}
  \label{Fig1}\end{figure}

Having a hyperbolic wave equation means that, optimistically
speaking, solutions of the equation are in one-to-one correspondence
with initial data, given on a global Cauchy hypersurface (fig.
\ref{Fig1}). However, there is a fundamental difference between
Yang-Mills theory and General Relativity. In General Relativity
there is a phenomenon of gravitational collapse -- the formation of
a black hole.  As a result, a solution on a Cauchy hypersurface
cannot be extended for all times, in general.     In Yang-Mills
theory, instead, there is a global-in-time existence result for
classical solutions (see \cite{Coleman}, \cite{CBS}).  This is
probably one of the reasons that quantum Yang-Mills theory is
simpler than quantum gravity, though it is not one of the reasons
that is easiest to interpret.

For gauge group $G=U(1)$, we observe classical solutions of
Maxwell's equations all the time -- light waves.  For nonabelian
$G$, even though there are beautiful nonlinear classical wave
equations, we do not observe these nonlinear classical waves in
practice.  That is actually because of a phenomenon known as the
mass gap.  The mass gap means that the description in terms of
nonlinear classical waves is only a good approximation above a
certain minimum energy and frequency.  At lower energies and
frequencies, one must use quantum field theory rather than classical
field theory.

According to theory, physical conditions that are well-described by
classical nonlinear wave equations can exist, but because of the
minimum frequency involved, our technology does not enable use to
generate the appropriate initial conditions. In practice, all
manifestations of Yang-Mills theory that we observe, except in the
abelian case, involve quantum behavior -- that is, they involve
phenomena that cannot be described by the classical field equations.
That is why the role of Yang-Mills theory in physics cannot be
described without talking about the quantum theory.

\section{Classical Phase Space}

\def\CW{{W}}
Formally speaking, the starting point in going to the quantum theory
is to observe that what I will call $\CW$, the space of all
solutions of the classical Yang-Mills equations modulo gauge
transformations, is an (infinite-dimensional) symplectic manifold.
The real reason for this is that the Yang-Mills equations are not
just equations.  They are the Euler-Lagrange equations associated
with an action function
\begin{equation}\label{folf} I=\frac{1}{4g^2}\int_M\,\Tr\,F\wedge
\star F. \end{equation} Here $\Tr$ is an invariant quadratic form on
the Lie algebra of $G$, and $g$ is a constant, known as the gauge
coupling constant.

In general, starting with any action, the space of classical
solutions of the Euler-Lagrange equations, modulo the relevant gauge
equivalence, is always a symplectic manifold.  Quantization has to
do with quantizing this symplectic manifold.

Actually, $\CW$ is a cotangent bundle.  This can be established as
follows.  Pick an initial value surface $S\subset M$, and let ${\cal
Y}$ be the space of all gauge fields on $S$ (that is all connections
on a $G$-bundle $E\to S$) modulo gauge equivalence.  Then $\CW$ is
the cotangent bundle of ${\cal Y}$, for any choice of $S$.  In
effect, to specify a classical solution of Yang-Mills theory
corresponding to a point in $\CW$, we must pick an initial value of
the gauge field along $S$ -- that is a point in ${\cal Y}$ -- and
also, as the Yang-Mills equations are of second order, we must
specify the normal derivative to the gauge field along $S$. By
forgetting the normal derivative, we get a map $\CW\to {\cal Y}$,
and $\CW$ is the cotangent bundle to ${\cal Y}$.

In finite dimensions, there is no problem in quantizing a cotangent
bundle.  But $\CW$ is infinite-dimensional, and in infinite
dimensions, we have to be careful.  For an elementary illustration
of the problem, recall that by a well-known theorem of Stone and von
Neumann, the quantization of $\Bbb{R}^{2n}$, with a symplectic
structure that comes from a nondegenerate skew form, is unique
(provided that one requires that this quantization should admit an
action of the Heisenberg group, the central extension of the group
of translations of $\Bbb{R}^{2n}$).  The analog of this for
$n=\infty$ is more subtle.

We need more information about what sort of answer we want to get.
The additional information is that the energy should be bounded
below.  With this information, quantization becomes unique again, at
least in the abelian case, as we will explain.

Instead of just describing the energy in an ad hoc way, let us
provide a framework for this discussion. Our Yang-Mills action
(\ref{folf}) is invariant under the symmetries of the
pseudo-Riemannian manifold $M$. Classically, we need only endow $M$
with a conformal structure (rather than a metric), since the action
is defined using the Hodge star operator $\star$, and in
four-dimensions, this operator is conformally-invariant when acting
on two-forms.  We take $M$ to be Minkowski spacetime $\R^{3,1}$,
with its standard conformal structure (induced from a flat
pseudo-Riemannian metric).  The group of conformal motions of $M$
(or more precisely of its conformal compactification) is $SO(2,4)$,
and this is a group of symmetries of the classical theory.

For $G=U(1)$, $SO(2,4)$ is realized as a group of symmetries of the
quantum theory, but this is actually not true for nonabelian $G$.
The quantum theory is obtained via a kind of limiting procedure,
concerning which I will try to give a few hints.  This limiting
procedure does not preserve the full $SO(2,4)$ symmetry, but only a
subgroup.  The details depend on exactly how one proceeds with
quantization.

\begin{figure}
  \begin{center}
    \includegraphics[width=2in]{Fig2.eps}
  \end{center}
\caption{The future light cone.}
  \label{Fig2}\end{figure}

A maximal subgroup of $SO(2,4)$ that can be preserved in the
quantization, for nonabelian $G$, is the subgroup $P$ -- known as
the Poincar\'e group -- that preserves a flat metric on $\R^{3,1}$.
This group acts on linear coordinates $x$ on $\R^{3,1}$ by $x\to
ax+b$, where $b$ is a constant ``translation,'' and $a$ is a linear
transformation that belongs to the Lorentz group $SO(1,3)$ (the
group of symmetries of a quadratic form of Lorentz signature). We
are supposed to quantize in such a way that we get a unitary
representation of $P$.

Representation theory of $P$ is simple because $P$ is an extension:
\begin{equation}\label{dolf} 0\to \Bbb{R}^{3,1}\to P\to SO(3,1)\to
1.\end{equation}  Here $\Bbb{R}^{3,1}$ is the abelian group of
translations.  Its spectrum defines a point in the dual space to
$\Bbb{R}^{3,1}$.  This dual space, which I will denote
$\tilde\R^{3,1}$, is usually called momentum space.  Of course,
$\tilde\R^{3,1}$ is also endowed with a flat metric.  (We could use
the metrics to identify them, but this would be confusing.)



We write $p$ for a point in $\tilde\R^{3,1}$, usually called the
energy-momentum.  The condition $(p,p)=0$ defines a cone, called the
light cone.  $p$ is said to be lightlike if it lies on this cone. As
is usual in Lorentz signature, the light cone is the union of two
components, the ``past'' and ``future'' parts of the light cone. The
future light cone is sketched in fig. \ref{Fig2}.

We want a quantization such that the spectrum of energy-momentum
lies inside (and on) the future light cone.  This is usually
described by saying that the energy is bounded below by zero.  Here,
energy is a suitable linear function on $\tilde\R^{3,1}$.

Boundary points of the future light cone are allowed, but they play
a very special role.  The Hilbert space $\cal H$ that we get by
quantization is supposed to have a special state, the vacuum state
$|\Omega\rangle$, whose energy-momentum is supported at the apex of
the cone, in other words at the point $p=0$.  This state transforms
in a one-dimensional trivial representation of the Poincar\'e group.

\def\O{{\cal O}}
Apart from this one trivial representation, the other
representations that are relevant are constructed as follows.  Let
${\cal O}$ be a non-trivial $SO(3,1)$ orbit that is inside, or on,
the future light cone.    Let $V\to \O$ be a homogeneous vector
bundle over $\O$.  Then the space of ${\rm L}^2$ sections of $V$ is
a positive energy representation of the Poincar\'e group, and, apart
from the trivial representation that corresponds to the vacuum
state, these are the representations that we allow.

\begin{figure}
  \begin{center}
    \includegraphics[width=3.5in]{Fig3.eps}
  \end{center}
\caption{Sketched here is an example of what the spectrum of $m$
looks like when there is a ``mass gap.'' Apart from the isolated
eigenvalue at $m=0$ corresponding to the vacuum, there is in this
example a single discrete eigenvalue of $m$ at a positive value.
There is also a continuous spectrum (corresponding to multiparticle
states) which begins at twice the value of the smallest positive
eigenvalue.}
  \label{Fig3}\end{figure}

An orbit is characterized by the invariant $m^2=(p,p)$.  This
invariant is non-negative (since we consider only orbits inside or
on the light cone), and $m$, defined by the positive square root, is
called the mass. $m$ can have either a discrete or a continuous
spectrum. More exactly, in quantum field theory, $m$ always has a
continuous spectrum (from what are known as multiparticle states)
above some minimum value $m_*$. There  may also be a discrete
spectrum from single particle states with $m<m_*$. Positive discrete
eigenvalues of $m$ are called masses of particles.

The vacuum state always has $m=0$.  If this is a discrete eigenvalue
of $m$, in other words if there is $\epsilon>0$ such that every
state orthogonal to the vacuum has $m\geq \epsilon$, then we say
that the theory has a mass gap.  In fig. \ref{Fig3}, we sketch a
typical spectrum of a quantum field theory with a mass gap.  The
discrete eigenvalues of $m$ are 0 and one positive value.

Now, let us examine the problem of quantizing gauge theory, armed
with the information that the energy should be non-negative.
Classically, if we write the curvature in non-relativistic terms as
$F=dt\wedge d\vec x \cdot \vec E+\frac{1}{2}d\vec x\cdot d\vec
x\times \vec B$, where $\vec E$ and $\vec B$ are the electric and
magnetic fields, then the energy is the conserved quantity
\begin{equation}\label{zusk}H=\frac{1}{2g^2}\int
d^3x\,\Tr\,\left(\vec E^2+\vec B^2\right).\end{equation}  It is
non-negative, and vanishes precisely for the trivial solution with
$F=0$.

\section{Quantization}

We next discuss the quantization, beginning with the abelian case,
that is $G=U(1)$.  In the abelian case, the curvature $F$ is linear
in the connection $A$, that is $F=dA$, and Maxwell's equations
$d\star F=0$ are also linear.  The space $W$ of solutions modulo
gauge transformations is therefore also a linear space  -- an
infinite-dimensional one.

Now in the case of a {\it finite}-dimensional affine space,
$\Bbb{R}^{2n}$ for some $n$, quantization is unique (once one
requires that it should respect the affine structure, in a suitable
sense) according to a theorem of Stone and von Neumann.

This is far from being true in infinite dimensions.  Quantization of
an infinite-dimensional affine or linear space $W$ is far from
unique. But we do get the uniqueness again if we are given a
positive-definite quadratic function $Q$ on $W$, and we ask for a
quantization in which $Q$ is represented by a hermitian operator
that is bounded below.

In abelian gauge theory, because the curvature is a linear function,
the Hamiltonian or energy function $H$ is a quadratic function,
which moreover is positive-definite.   This puts us in the situation
just described.

\def\W{{\mathcal W}}
\def\H{{\mathcal H}}
The result of quantization can be described as follows.  As the
space of solutions of Maxwell's equations, $W$ has a natural
symplectic structure. This symplectic structure is
translation-invariant -- that is, it comes from a constant two-form
(on the infinite-dimensional linear space $W$). The
positive-definite quadratic function $Q$ on $W$ is equivalent to a
translation-invariant Riemannian metric on $W$. Combining these, $W$
is endowed with a translation-invariant complex structure and
therefore can be regarded as a complex vector space with a hermitian
metric, that is, a Hilbert space. Let us write $\W$ for $W$ regarded
in this way as a Hilbert space.

Quantization of $W$ is supposed to give us a Hilbert space $\H$.
This turns out to be the Hilbert space completion of the ``Fock
space'' constructed from $\W$, which by definition is
\begin{equation}\label{puik}\H_0=\oplus_{n=0}^\infty {\rm
Sym}^n\,\W.\end{equation} Here ${\rm Sym}^n\,W$ is the $n$-fold
symmetric product of $W$, with ${\rm Sym}^0\,W=\Bbb{C}$.

In (\ref{puik}), $\Bbb{C}={\rm Sym}^0\,W$ is the one-dimensional
space of ``vacuum'' states (Poincar\'e-invariant states of zero
energy, as discussed earlier).  $\W={\rm Sym}^1\,W$ is the space of
``single-particle states.''  Concretely, as a representation of the
conformal group, $\W$ is the space of sections of a certain
homogeneous vector bundle over the future light cone.  (In four
dimensions, this bundle is of rank 2, the number of polarization
states of an electromagnetic wave.)  Support on the cone means that
$\W$ is a space of massless states, that is states of $m^2=(p,p)=0$.
These are called the one-photon states.  Similarly, ${\rm Sym}^n\,W$
is the space of $n$-photon states.

This is our answer for quantization of abelian gauge theory, though
we need to say more about the physical interpretation in terms of
photons, and about how various classical expressions are realized as
operators acting on this Hilbert space.


\begin{figure}
  \begin{center}
    \includegraphics[width=2.5in]{Fig4.eps}
  \end{center}
\caption{A space $W$ endowed with a function with a unique isolated
minimum, indicated by the black dot.}
  \label{Fig4}\end{figure}

Now let us discuss the nonabelian case.  The curvature $F$ is no
longer linear, so the space ${ W}$ of classical solutions is no
longer a linear or affine space.  Similarly, the energy function $H$
is not quadratic.  However, it is still true, as suggested in fig.
\ref{Fig4}, that $H$ is positive semidefinite with a unique zero
corresponding to the trivial solution $F=0$.



Like any function with an isolated minimum, $H$ looks quadratic near
its minimum.  One may ask whether this simple fact can be a starting
point for understanding the quantization.

The constant $1/g^2$ in $H$ is very important.  In general, suppose
that we have a not-quadratic function $H$ of variables $x_i$ with a
minimum at the origin:
\begin{equation}\label{luk}H=\frac{1}{g^2}\left(\sum_{i,j}a_{ij}x_ix_j
+\sum_{i,j,k}b_{ijk}x_ix_jx_k+\dots\right).\end{equation} We write
$y_i=x_i/g$, so that
\begin{equation}\label{uluk}H=\left(\sum_{i,j}a_{ij}y_iy_j
+g\sum_{i,j,k}b_{ijk}y_iy_jy_k+\dots\right).\end{equation}

We do not know how to diagonalize $H$ as an operator in a Hilbert
space, but we can diagonalize its quadratic part $H_0$:
\begin{equation}\label{luluk}H_0=\sum_{i,j}a_{ij}y_iy_j.\end{equation}
This means that if $g$ is small, we can approximately diagonalize
$H$.  The first step is to diagonalize $H_0$, and then one makes
successive corrections, treating the higher order terms in $H$ as
perturbations, so as to construct the eigenfunctions of $H$ in an
asymptotic expansion in powers of $g$.

Classically it does not make sense to say that $g$ is large or
small; $g$ is just an uninteresting constant multiplying the action.
But quantum mechanically there is a dimensionless number that in the
usual units is $g^2/\hbar c$.  This is really the small parameter in
the asymptotic expansion that was just suggested.  In this
asymptotic expansion, one diagonalizes $H$ -- and computes all
quantities of physical interest -- in an asymptotic expansion in
powers of $g^2/\hbar c$.

There is really a lot to explain here. There are many important
details and techniques in constructing the formal expansion, and
  there is actually much more to explain about what are the interesting and
  important things to calculate.  The techniques include Feynman
  diagrams, renormalization, path integrals, gauge fixing, and BRST
  symmetry.  What one wants to calculate are masses, other static
  quantities such as magnetic moments and other matrix elements of
  local operators, and especially scattering amplitudes.

  After a lot of work, one does end up with a systematic asymptotic
  expansion.  Moreover, there are many physics problems for which
  the asymptotic expansion is enough, in practice. That is the case
  for the electromagnetic and weak interactions, because $g^2/\hbar
  c$ is small (roughly 1/137 for electromagnetism).

Apart from the fact that the asymptotic expansion -- known as
perturbation theory -- is satisfactory for many questions, it is
important in another way: it is unrealistic to expect to develop an
exact theory without having a thorough understanding of perturbation
theory.  Trying to do this would be somewhat analogous to trying to
study Riemannian geometry without learning linear algebra.

\section{Nonperturbative Approach}

However, to understand the strong interactions, or nuclear force,
the asymptotic expansion is not enough.  We need to understand
something about the exact theory.  I will therefore conclude by
trying to say something about this.

Any known approach to understanding the exact theory requires, one
way or another, modifying it by introducing a ``cut-off'' so as to
make the number of variables effectively finite, and then taking a
limit in which the cutoff is removed. The usual way to do this is
via Euclidean lattice gauge theory, but we will not follow that
route because in this lecture we have avoided introducing path
integrals. (For an introduction to that subject, see for instance
\cite{GJ}.) Instead, I will describe the Hamiltonian version of
lattice gauge theory \cite{Susskind}.  This approach is not widely
used in practice, though possibly it could be useful.  At any rate,
whether or not this approach is useful in practice, it is easily
described and gives a good orientation about what it means to
introduce a cut-off and then remove it.

\def\A{\mathcal A}
\def\G{\mathcal G}
\def\Y{\mathcal Y}
A fact that was mentioned in section 2 is helpful here. This
concerns the space $W$ of solutions of the Yang-Mills equations
modulo gauge transformations. Pick an initial value hypersurface
$S$; we may as well simply take $S$ to be a ``time zero'' subspace
$\R^3\subset \R^4$. Let $\A$ be the space of gauge connections on
$S=\R^3$ and $\G$ the group of gauge transformations on $\R^3$. Thus
the quotient $\Y=\A/\G$ is the space of connections modulo gauge
transformations on $\R^3$. And $W$ can be identified as a cotangent
bundle, $W=T^*(\A/\G)$. The idea behind this identification is that
to determine a classical solution, we must give the initial value of
the connection (a point in $\A/\G$) and its time derivative (a
cotangent vector).   So to get a finite-dimensional approximation to
$W$, it suffices to get finite-dimensional approximations to $\A$
and $\G$.

\begin{figure}
  \begin{center}
    \includegraphics[width=2in]{Fig5.eps}
  \end{center}
\caption{We introduce a cutoff by formulating gauge theory on a
lattice of finite spatial extent (for clarity, what is drawn here is
a two-dimensional rather than three-dimensional lattice). To
describe quantum field theory, we must take the spatial extent of
the lattice to infinity while also shrinking the lattice spacing to
zero.}
  \label{Fig5}\end{figure}

To do this, we approximate $\R^3$ by a finite set $\Gamma$ of points
-- later we will take the number of points to infinity.  In fact, as
in fig. \ref{Fig5}, we arrange the finite set of points in a regular
array, as part of a lattice.\footnote{\label{gong} Actually, it is
better to consider a discrete approximation to a three-torus, rather
than a discrete approximation to a parallelepiped in $\R^3$ as
sketched in the figure.  This avoids edge effects in the spectrum of
the Hamiltonian.  A discrete approximation to a three-torus is made
by taking an array of points that is finite and is periodic in three
directions.  The limit is still taken by letting the number of
points in the array go to infinity (so that it approximates a larger
and larger three-torus) while the distance between nearest neighbor
points goes to zero.} Of course, a finite set of points is not a
very good approximation to $\R^3$. To recover $\R^3$, we increase
the number of points.  In the process, we must improve the
approximation in two directions: we take the spacing between the
lattice points to be smaller and smaller, so as to recover the
continuum, while also taking the spatial extent of our chosen array
of points to be bigger and bigger, so that in the limit the array of
points covers all of $\R^3$.

So now, for each such finite set $\Gamma$, we must give an
approximation to $\A$, the space of all connections, and $\G$, the
group of gauge transformations.  Taking $\Gamma$ to be part of a
rectangular lattice, we connect the nearest neighbor pairs, as is
shown in the figure.  Then we approximate gauge theory by only
allowing parallel transport along lattice paths.  For each oriented
link $\ell$ between nearest neighbors in $\Gamma$, we introduce a
group element $U_\ell\in G$ that describes parallel transport along
$\ell$ (we take $U_{-\ell}=U_\ell^{-1}$).  By a connection on the
finite lattice corresponding to $\Gamma$, we mean a collection of
group elements $U_\ell$ for all $\ell$.  So our finite-dimensional
approximation to $\A$ is $\A_\Gamma=G^{n_1}$, where $n_1$ is the
number of nearest neighbor pairs in $\Gamma$.

Similarly, we permit ourselves to make gauge transformations at all
 points in $\Gamma$.  A gauge transformation is thus specified by
 giving an element $g_p\in G$ for all $p\in \Gamma$.  If $\ell$
 connects points $p$ and $q$, the gauge transformation acts on
 $U_\ell$ by $U_\ell\to g_pU_\ell g_q^{-1}$.  So our
 finite-dimensional approximation to the group $\G$ of gauge
 transformations is $\G_\Gamma=G^{n_0}$, where $n_0$ is the number
 of points in $\Gamma$.

\def\H{\mathcal H}
 The corresponding approximation to the space $W$ of classical
 solutions is $W_\Gamma=T^*(\Y_\Gamma)$, where
 $\Y_\Gamma=\A_\Gamma/\G_\Gamma$ is the space of gauge fields modulo
 gauge transformations.  Since we are in finite dimensions and
 $W_\Gamma$ is a cotangent bundle, quantization is straightforward:
 the Hilbert space associated to $\Gamma$ is just $\H_\Gamma={\rm
 L}^2(\Y_\Gamma)$.   Equivalently, this Hilbert space is the
 $\G_\Gamma$-invariant subspace of $\H^0_\Gamma={\rm L}^2(\A_\Gamma)$.
 Any operator on $\H^0_\Gamma$ that commutes with $\G_\Gamma$
 descends to an operator on $\H_\Gamma$.

 To complete the description of the finite-dimensional approximation, we
 must give a suitable approximation $H_\Gamma$ to the Hamiltonian or
 energy operator $H$.  It is not hard to do this.   It turns out
 that the first term in $H$, namely $H'=(1/2g^2)\int d^3x\,\Tr\,\vec
 E^2$, can be approximated by $(g^2/2)\Delta$, where $\Delta $ is
 the Laplace operator on the Riemannian manifold $\A_\Gamma$.
 ($\Delta$ commutes with $\G_\Gamma$, and so descends to an operator on
 $\H_\Gamma$ by virtue of the comment at the end of the last
 paragraph.)

 The second term in $H$, namely $H''=(1/2g^2)\int
 d^3x\,\Tr\,\vec B^2$, is the ${\rm L}^2$ norm of the curvature of a
 connection on the initial value surface.  To approximate this for
 the lattice $\Gamma$, the main point is to know what we mean by
 curvature in the context of such a finite-dimensional
 approximation.  This can be defined in terms of parallel transport around a small loop;
in the lattice $\Gamma$, the smallest possible nontrivial loops are
the squares of minimal area, which in lattice gauge theory are
usually called plaquettes.
 For any plaquette   $s\in \Gamma$, consisting of four nearest neighbor
 links $\ell_1,\dots,\ell_4$,
 we let $V_s$ be the function on $\A_\Gamma$ that
 associates to a connection $\{U_\ell\}$ the trace of the holonomy
 of that connection around $s$ (thus,
 $V_s=\Tr\,U_{\ell_1}U_{\ell_2}U_{\ell_3}U_{\ell_4}$; the trace is
 taken in the same representation used to define $H''$).
 Then $H''$ can be approximated by a suitable linear
 function of $\hat V=\sum_s V_s$.  (One subtracts a constant from
 $\hat V$ so that it vanishes when
 $U_\ell=1$ for all $\ell$; and one then multiplies by a constant to
 get an approximation to $H''$.)

We also want to define lattice approximations to other expressions
of classical and quantum gauge theory.  But I will not go farther;
the examples that have been given hopefully suffice to illustrate
the idea.

The problem of defining quantum gauge theory is, in this
formulation, to show that when we ``remove the cutoff'' by refining
and enlarging the finite set $\Gamma$, the lattice Hamiltonian
$H_\Gamma$ (and other operators) converge to a limit.\footnote{Here
to avoid edge effects, it is best to take $\Gamma$ to be an array of
points that is periodic in three directions, as mentioned in
footnote \ref{gong}.  Otherwise, there are edge effects at the
boundary of $\Gamma$ and the statement that $H_\Gamma$ converges to
a limit needs to be formulated carefully. } While removing the
cutoff, one must also adjust the coupling constant $g$ in a suitable
fashion.

There is a precise theory of how $g$ must be adjusted; if $a$ is the
lattice spacing (the distance between points in $\Gamma$), then one
requires $g\sim f/|\ln a|$ for $a\to 0$.  Here $f$ is a constant
that depends on $G$; it was computed by Gross, Wilczek, and Politzer
in 1973.  This computation led to the 2004 Nobel Prize for
``asymptotic freedom,'' which is the statement that $g$ must go to
zero as $a$ does.

\section{Breaking Of Conformal Invariance And The Mass Gap}

For  $a,g\to 0$, it is believed that there is a limiting theory that
obeys all of the axioms of quantum field theory, including
invariance under the Poincar\'e group.  However, it is believed that
in the limit one does {\it not} recover the $SO(2,4)$ conformal
symmetry of the classical theory.

A very basic aspect of the violation of the conformal symmetry is
that it is believed that the spectrum has a mass gap, and thus is
qualitatively as depicted in fig. \ref{Fig3}.  We recall that the
mass gap means simply that the mass $m$ of any state (orthogonal to
the vacuum) is bounded strictly above zero.

There is no mass gap in electromagnetism; the photon is massless, so
electromagnetic waves can have any positive frequency.  That is why
we can experience light waves in everyday life.  By contrast, the
mass gap in strong interactions means that the minimum frequency
needed to probe the world of $SU(3)$ gauge theory (which describes
the strong interactions) is $mc^2/\hbar$, where $m$ is the smallest
mass. Taking from experiment the value of the smallest mass, this
frequency is of order $10^{24}\,{\rm sec}^{-1}$, which is high
enough (with room to spare) that this world is way outside of our
ordinary experience.

 While it is very large compared to our ordinary experience,
 the mass gap is in one sense very small: it is zero in the asymptotic expansion
 described in Section 3.   As a result, we do not
 have a really good way to calculate it, though we know it is there
 from real experiments and computer simulations.

So in short, this mass gap is one of the most basic things that
makes the Universe the way it is, with electromagnetism obvious in
everyday life and other forces\footnote{The weak interactions are
also affected by a mass gap, but for very different reasons from the
strong interactions, which have been our subject here.  See \cite{W}
for an introduction.}  only accessible to study with modern
technology.

The mass gap is the reason, if you will, that we do not see
classical nonlinear Yang-Mills waves. They are a good approximation
only under inaccessible conditions.

I have spent most of my career wishing that we had a really good way
to quantitatively understand the mass gap in four-dimensional gauge
theory. I hope that this problem will be solved one day.


\bibliographystyle{amsplain}
\begin{thebibliography}{25}
\bibitem{GJ} J. Glimm and A. Jaffe, {\it Quantum Physics: A Functional
Integral Point Of View} (Springer, 1981).

\bibitem{Susskind} J. Kogut and  L. Susskind, ``Hamiltonian Formulation Of Wilson's Lattice
Gauge Theories,'' Phys. Rev. {
\bf D11} (1975) 395.

\bibitem{Coleman} S. Coleman,  ``There Are No Classical Glueballs,'' Commun. Math. Phys. {
\bf 55} (1977) 113.

\bibitem{CBS} Y. Choquet-Bruhat and I. Segal, ``Solution Globale Des \'Equations de Yang-Mills
sur l'Univers d'Einstein,'' C. R. Acad. Sci. Paris { \bf 294}
(1982) 225.

\bibitem{W}  E. Witten, ``From Superconductors And Four-Manifolds To Weak Interactions,"
Bull. Amer. Math. Soc.
{\bf 44}  (2007) 361.
\end{thebibliography}
\end{document}
========================================

\documentclass[11pt,a4paper]{article}
\usepackage{jheppub,amsmath,  amssymb,slashed,url,bm,textgreek,upgreek}
\usepackage{graphicx}
\usepackage{epstopdf}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\def\t{{ \sf t}} 
%% \stackrel{j}{\to}
\def\KW{\bf{KW}}
\def\kk{k}
\def\Sigmax{{\Sigma^*}}
\def\eO{{\eusm O}} 
\def\phif{f}
\def\epsilon{\varepsilon}
\def\tt{{\frak t}}
\def\J{\mathcal J}
\def\Tr{{\mathrm{Tr}}}
\def\neg{\negthinspace}
\def\a{a}
\def\dzzt{\D(\t z,z|\theta)}
\def\dzztt{\D(\t z,z|\t\theta,\theta)}
\def\ggamma{\Gamma}
\def\Stt{\h S}
\def\Q{{\mathcal Q}}
\def\Res{{\mathrm {R}}}
\def\X{{\mathcal X}}
\def\SoS{{\mathrm S}}
\def\ds{{\mathrm{ds}}}
\def\sD{\text{{\sf D}}}
\def\aalpha{\alpha}
\def\FF{{\eusm  F}}
\def\sPi{\Phi}
\def\ct{{\cmmib t}}
\def\JJ{{\eusm J}}
\def\s{{s}}
\def\ii{i}
\def\RR{{\mathcal R}}
\def\BB{\bm B}
\def\uu{u}
\def\piGSO{{\Pi_{\mathrm{GSO}}}}
\def\tpiGSO{\t{\Pi}_{\mathrm{GSO}}}
\def\UUU{\varPhi}
\def\SSigma{{\varTheta}}
\def\Stigma{{\varSigma}}
\def\btheta{{\bm \theta}}
\def\mm{{\bm m}}
\def\zzeta{{\bm \zeta}}
\def\zizeta{\zeta}
\def\v{{\eurm v}}
\def\fD{ \eusm D}
\def\udelta{{\underline\delta}}
\def\u{{\eurm u}}
\def\UU{U}
\def\p{{\eurm p}}
\def\sp{{\eurm p}}
\def\SoS{{\eurm S}}
\def\VV{{\eusm V}}
\def\ZoZ{{\eusm Z}}
\def\z{{\mathbf z}}
\def\c{{\eurm c}}
\def\w{{\eurm w}}
\def\Chi{\chi}
\def\g{\text{{\teneurm g}}}
\def\sg{\text{{\eighteurm g}}}
\def\ssg{\text{{\seveneurm g}}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bt{{{t}}}
\def\XX{{\mathcal Y}}
\def\NS{{\mathrm {NS}}}
\def\Ra{{\mathrm R}}
\def\Ber{{\mathrm{Ber}}}
\def\BBer{{\textit{Ber}}}
\def\X{{\eusm X}}
\def\Re{{\mathrm{Re}}}
\def\Im{{\mathrm{Im}}}
\def\hat{\widehat}
\def\eff{{\mathrm{eff}}}
\def\tilde{\widetilde}
\def\fN{{\mathfrak N}}
\def\frak{\mathfrak}
\def\h{\widehat}
\def\n{\text{{\teneurm n}}}
\def\sn{\text{{\eighteurm n}}}
\def\ssn{\text{{\seveneurm n}}}
%\def\n{{\eurm n}}
\def\sPhi{\Psi}
\def\RP{{\Bbb{RP}}}
\def\q{{\mathrm q}}
\def\y{{\mathrm y}}
\def\dd{{\eurm q}}
\def\D{{\mathcal D}}
\def\S{{\mathcal S}}
\def\SIgma{\Sigma}
\def\YY{{\eusm Y}}
\def\V{{\mathcal V}}
\def\O{{\mathcal O}}
\def\k{{\cmmib k}}
\def\Bbb{\mathbb}
\def\gh{{\mathrm{gh}}}
\def\red{{\mathrm{red}}}
\def\A{{\mathcal A}}
\def\d{{\mathrm d}}
\def\tW{{W}}
\def\intt{{\matheurm{int}}}
\def\b{\overline}
\def\R{{\mathbb R}}
\def\C{{\mathbb C}}
\def\U{{\mathcal U}}
\def\D{{\mathcal D}}
\def\[{\bigl [}
\def\voli{{\eurm {vol}}^{-1}\cdot}
\def\]{\bigr ]}
\def\SS{{\mathfrak S}}
\def\CP{{\mathbb{CP}}}
\def\N{{\mathcal N}}
\def\T{{\mathcal T}}
\def\F{{\mathcal F}}
\def\tr{{\mathrm {tr}}}
\def\Z{{\mathbb Z}}
\def\ZZ{{\mathcal Z}}
\def\QQ{{\mathcal Q}}
\def\CC{{\mathcal C}}
\def\ad{{\mathrm{ad}}}
\def\r{{\mathrm{tr}}}
\def\Btriv{{\mathcal B}_{\mathrm{triv}}}
\def\L{{\mathcal  L}}
\def\t{\widetilde }
\def\h{\widehat}
\def\Bcc{{\mathcal B_{\mathrm{cc}}}}
\def\K{{\mathcal K}}
\def\V{{\mathcal V}}
\def\I{{\mathcal I}}
\def\G{{\mathcal G}}
\def\B{{\mathcal B}}
\def\Boper{{\mathcal B_{\mathrm{oper}}}}
\def\M{{\mathcal M}}
\def\sM{s\mathcal M}
\def\MM{{\mathfrak M}}
\def\eusmm{{\MM_{\sg,\sn_\NS,\sn_\Ra}}}
\def\W{{\mathcal W}}
\def\P{{\mathcal P}}
\def\l{\langle}
\def\Ra{{\mathrm{R}}}
\def\r{\rangle}
\def\lc{{\mathrm{lc}}}
\def\H{{\mathcal H}}
\def\cZ{\mathcal Z}
\def\tphi{\text{\textphi}}
\def\trho{\text{\textmu}}
\def\sW{{ W}}
\def\vol{{\mathrm{vol}}}
\def\ca{{\cmmib a}}
\def\ss{{d}}
\def\st{{\mathrm{st}}}
\def\spin{{\mathrm{spin}}}
\def\m{\cmmib m}
\def\tilde{\widetilde}
\def\sing{{\mathrm{sing}}}
\def\bar{\overline}
\def\DD{{\mathfrak D}}
\def\neg{\negthinspace}
\def\gst{g_{\mathrm{st}}}
\def\Ber{{\mathrm {Ber}}}
\def\Diff{{\eusm D}}
\def\Y{{\eusm Y}}
\def\dets{\det{}\negthinspace}
\font\teneurm=eurm10 \font\seveneurm=eurm7 \font\eighteurm=eurm8 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
\font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}
\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}
\def\del{\partial}
\def\calO{\mathcal O}
\def\LKW{\mathcal L}


\title{The Nahm Pole Boundary Condition}

\author{Rafe Mazzeo$^a$}
\affiliation{$^a$Department of Mathematics, Stanford University, Stanford, CA 94305} 

\author{and Edward Witten$^{b}$}
\affiliation{$^{b}$School of Natural Sciences, Institute for Advanced Study,\\ 1 Einstein Drive, Princeton, NJ 08540 USA}
\abstract{The Nahm pole boundary condition for certain gauge theory equations in four and five dimensions is defined 
by requiring that a solution should have a specified singularity along the boundary.  In
the present paper, we  show that this boundary condition is elliptic and has regularity 
properties analogous to more standard elliptic boundary conditions.  We also
establish a uniqueness theorem for the solution of the relevant equations on a half-space with 
Nahm pole boundary conditions.  These
results are expected to have a generalization involving knots, with
applications to  the Jones polynomial and Khovanov homology.}

\begin{document}\maketitle

\section{Introduction}\label{intro} 

Nahm's equations are a system of ordinary differential equations for three functions $\vec\phi=(\phi_1,\phi_2,\phi_3)$ of a real variable $y$
that take values in the Lie algebra $\frak g$ of a compact Lie group $G$.  These functions  satisfy
\begin{equation}\label{tofu} \frac{\d \phi_1}{\d y}+[\phi_2,\phi_3] =0,\end{equation}
along with cyclic permutations of these equations.  More succinctly, we write
\begin{equation}\label{ofu}\frac{\d\vec\phi}{\d y}+\vec\phi\times \vec\phi = 0 \end{equation}
or
\begin{equation}\label{zofu}\frac{\d \phi_i}{\d y}+\frac{1}{2}\sum_{j,k}\epsilon_{ijk}[\phi_j,\phi_k]=0,\end{equation}
where $\epsilon_{ijk}$ is the antisymmetric tensor with $\epsilon_{123}=1$. These ways of writing the equation show that if we view $\vec\phi$
as an element of $\frak{g}\otimes \R^3$, then Nahm's equation is invariant under the action of $SO(3)$ on $\R^3$.
  
In Nahm's work on magnetic monopole solutions of gauge theory \cite{Nahm}, a key role was played by a special singular solution of Nahm's
equations on the open half-line $y>0$.  The solution reads 
\begin{equation}\label{dofo} \vec\phi(y)=\frac{\vec\tt}{y},\end{equation}
where $\vec\tt=(\tt_1,\tt_2,\tt_3)$ is a triplet of elements of $\frak g$, obeying
\begin{equation}\label{nofo} [\tt_1,\tt_2]=\tt_3, \end{equation}
and cyclic permutations thereof.  In other words, the $\tt_i$ obey the commutation relations of
the Lie algebra $\frak{su}(2)$; we can think of them as the images of a standard basis  of
$\frak{su}(2)$ under a homomorphism\footnote{We are primarily interested in the case that $\varrho$
is non-zero and hence is an embedding of Lie algebras, but our considerations also apply for $\varrho=0$.
See Appendix \ref{groups} for some background and examples concerning homomorphisms from $\frak{su}(2)$ to
a simple Lie algebra  $\frak g$.} $\varrho:\frak{su}(2)\to\frak{g}$.  
We will call this solution the Nahm pole solution.  The Nahm pole
solution has been important in many applications of Nahm's equations; 
for  example, see \cite{K}, which is also relevant as background for the present paper.

Nahm's work on monopoles was embedded in D-brane physics in \cite{Diaconescu}.  
The Nahm pole therefore plays a role in D-brane physics,
and this was explained conceptually in \cite{fuzzy}.   Results about D-branes often have 
implications for  gauge theory, and in the case at hand,
by translating the D-brane results to gauge theory language, one learns \cite{GW} that the 
Nahm pole should be used to define a natural boundary condition not just for Nahm's
1-dimensional equation but for certain gauge theory equations in higher dimensions.  
The equations in question include second order equations of supersymmetric Yang-Mills
theory, and associated first-order equations that are relevant to  the geometric Langlands correspondence
\cite{KW} and the Jones polynomial and Khovanov homology of knots \cite{WittenK,WittenKtwo}.

Our aim in this paper is to elucidate the Nahm pole boundary condition.  Though we 
will also discuss generalizations (including a five-dimensional
equation \cite{haydys,WittenK} that is important in the application to Khovanov homology), we  
will primarily study a certain system of first-order equations in four
dimensions for a pair $A,\phi$.  Here $A$ is a connection on a $G$-bundle $E\to M$, with 
$M$ an oriented Riemannian four-manifold 
with metric $g$, and $\phi$ is a 1-form on $M$ valued in
$\ad(E)$ (the adjoint bundle associated to $E$).  The equations read 
\begin{align}\label{zobo} F-\phi\wedge\phi+\star\,\d_A\phi &=0 \cr  
 \d_A\star \phi & = 0,\end{align}
 where $\star$ is the Hodge star and $\d_A=\d+[A,\cdot]$ is the gauge-covariant 
 extension of the exterior derivative.  Alternatively, in local coordinates $x^1,\dots,x^4$,
 \begin{align} \label{robo} F_{ij}-[\phi_i,\phi_j]+\epsilon_{ij}{}^{kl}D_k\phi_l &= 0 \cr   D_i\phi^i& = 0, \end{align}
 where $D_i=D/D x^i$ is the covariant derivative (defined using the connection 
 $A$ and the Riemannian connection on the tangent bundle of $M$), $\epsilon_{ijkl}$ is the
 Levi-Civita antisymmetric tensor, and indices are raised and lowered using the metric $g$.   (Summation over repeated indices is understood.)
 These equations (or their generalization to $t\not=1$; see eqn.\ (\ref{noxo}) below) have sometimes been called the KW equations and we will use this name for lack
 of another one.  For recent work on these equations, see \cite{Taubes,Taubestwo,GU}.
  
 To explain the relation to the Nahm pole, take $M$ to be the half-space $x^4\geq 0$ in a copy of $\R^4$ with Euclidean coordinates $x^1,\dots,x^4$ (oriented with
 $\epsilon_{1234}=1$). We denote this half-space as $\R^4_+$ and write $\vec x=(x^1,x^2,x^3)$ and $y=x^4$.  
 The KW equations  have a simple exact solution
 \begin{equation}\label{telmo} A=0,~~ \phi=\frac{\sum_{a=1}^3 \tt_a\,\d x^a}{y}, \end{equation}
 where the $\tt_a$ obey the $\frak{su}(2)$ commutation relations (\ref{nofo}).  
 This  gives an embedding of the basic Nahm pole solution (\ref{zobo}) in four-dimensional gauge theory, for any choice of the homomorphism 
 $\varrho:\frak{su}(2)\to \frak g$.  However, in many applications, the basic case  is that $\varrho$ defines a principal embedding of $\frak{su}(2)$ in $\frak g$,
 in the sense of Kostant.  For $G=SU(N)$, 
 this means that the $N$-dimensional representation of $G$ is an irreducible representation of $\varrho(\frak{su}(2))$; in general, the principal embedding is the closest
 analog of this for any $G$.
  
 If $\varrho $ is a principal embedding, we also say that $\varrho$ is regular or that $\phi$ has a regular Nahm pole.  The motivation for this terminology
is that if $\varrho$ is a principal embedding, then any nonzero complex linear combination of the $\tt_a$ is  a regular element  of the complex 
Lie algebra ${\frak g}_\C=\frak g\otimes _\R\C$; for instance, $\tt_1+i\tt_2$ is a regular nilpotent element.
  
For every $\varrho$, one defines \cite{GW} a natural boundary condition on the KW equations  that we call the Nahm pole boundary condition, but in this introduction,
we consider only the case of a principal embedding. (For more detail and the generalization to any $\varrho$, see section \ref{nonregular}.) 
For $M=\R^4_+$ and $\varrho$ a principal embedding, the Nahm pole boundary condition is defined by saying 
that one only allows solutions that coincide with the Nahm pole solution (\ref{telmo}) modulo terms that are less singular for $y\to 0$; the equation then implies 
that in a suitable gauge these less
singular terms actually vanish for $y\to 0$.
The Nahm pole boundary condition can be generalized, with some care, to a more general four-manifold with boundary. 
See section 3.4 of \cite{WittenK} and also section \ref{fourmanifold} of the present paper.

There are two main results of the present paper.  The first is that the Nahm pole boundary condition is elliptic.  Since the equation and solutions
contain singular terms, this is not the standard notion of ellipticity of boundary problems, formulated for example using the Lopatinski-Schapiro 
conditions, but is the analog of this in the framework of uniformly degenerate operators \cite{M-edge}. In fact, we verify the ellipticity of the 
linearization of this problem. The data prescribing the Nahm pole boundary condition are inherently discrete, so the linearization measures the 
fluctuations of the solution relative to this principal term. The boundary conditions for this linear operator simply require solutions to 
blow up less quickly than the Nahm pole; see section 2.4 for a precise statement.  The steps needed to verify that this linearization with
such boundary conditions is elliptic involve first computing the indicial roots of the problem, and then showing that the linear operator
in the model setting of the upper half-space $\R^4_+$ is invertible on a certain space of pairs $(a,\varphi)$ satisfying these boundary conditions. 
The indicial roots measure the formal rates of growth or decay of solutions as $y \to 0$. One of the key consequences of ellipticity
is that the actual solutions of this linearized problem, and eventually also the nonlinear equations, possess asymptotic expansions
with exponents determined by these initial roots. This is a strong regularity statement which allows us to manipulate solutions
to these equations rather freely.

The second main result here is a uniqueness theorem for the KW equations with Nahm pole boundary condition.  This states that a solution of these
equations on $M=\R^4_+$ which satisfies the Nahm pole condition at $y=0$ and which is also asymptotic at a suitable rate to the Nahm pole 
solution for $(\vec x, y)$ large must actually be the Nahm pole solution. This uniqueness theorem is  important  in the application
to the Jones polynomial \cite{WittenK} and corresponds to the expected  result that the Jones polynomial of the empty link is trivial.  
The proof of the uniqueness theorem involves finding a suitable Weitzenbock formula adapted to the Nahm pole solution, and showing that 
the fluctuations around the Nahm pole solution decay at a rate sufficient to justify that boundary terms in the Weitzenbock formula vanish.
Essentially the same reasoning leads to an analogous uniqueness theorem for the related five-dimensional equation that is expected to give a 
description of Khovanov homology.  In this case, the uniqueness theorem corresponds to the statement that the Khovanov homology of the 
empty link is of rank 1.  This Weitzenbock formula can be linearized, and this version of it is used to establish the second part of the proof
that the linearized boundary problem is elliptic. The uniqueness theorem and the ellipticity both hold for arbitrary $\varrho$. 

The uniqueness theorem means roughly that solutions of the KW equations with Nahm pole boundary condition do not exhibit ``bubbling'' along the boundary.
The basis for this statement is that on $\R_+^4$, the KW equations  and 
also their Nahm pole solution  are scale-invariant, that is invariant under $(\vec x,y)\to (\lambda \vec x,\lambda y)$, $\lambda>0$.  If there were a non-trivial
solution on $\R^4_+$ with the appropriate behavior at infinity, it could be ``scaled down''  by taking $\lambda$ very small and 
glued into any given solution that obeys the Nahm pole boundary conditions.  Ths would give a new approximate
solution that obeys the same boundary conditions and coincides with the given solution except in a very small region near the boundary; the behavior
for $\lambda\to 0$ would be somewhat similar to bubbling of a small Yang-Mills instanton.  

The Nahm pole boundary condition can be naturally generalized to include knots.  
 In the framework of \cite{WittenK}, this is done by modifying the boundary conditions in the equations (\ref{zobo})
along a knot or link $K\subset\partial M$.  The appropriate general procedure for this is only known if $\varrho$ is a principal embedding.
The model case is that $M=\R_+^4$ and $K$ is a straight line $\R\subset \R^3=\partial M$.  To every irreducible
representation $R^\vee$ of the Langlands or GNO dual group $G^\vee$ of $G$, one associates a model solution of eqns. (\ref{zobo}) that coincides with the Nahm pole solution
away from $K$ and has a more complicated singular behavior along $K$.  This more complicated behavior  depends on $R^\vee$.  Solutions for the model case
were found in section 3.6 of \cite{WittenK} for 
$G$ of rank 1 and  in \cite{Mikhaylov} for any  $G$.  A boundary condition on eqns. (\ref{zobo}) is then defined by saying that a 
solution should be asymptotic to this model solution along $K$, and to have a Nahm pole singularity elsewhere along $\partial M$. 

This boundary condition can again be extended naturally, with some care, to 
the case that $M$ has a product structure $W\times \R_+$ near its boundary, with an arbitrary embedded knot or link in
$W=\partial M$.  (In the case of a link with several connected components, each component can be labeled by a different representation of $G^\vee$, corresponding to
a different singular model solution.)  The Nahm pole boundary condition in the presence of a knot is again subject to a uniqueness theorem, which
says that for $M=\R^4_+$, with $K=\R\subset\partial M$, and for any representation $R^\vee$, a solution that agrees with the
model solution near $\partial M$ and has appropriate behavior at infinity must actually coincide with the model solution.  This more general type of uniqueness
theorem and the closely related ellipticity of the boundary condition in the presence of a knot will be described elsewhere.

\section{Uniqueness Theorem For The Nahm Pole Solution}\label{second}
In this section we lay out the strategy for proving uniqueness of the Nahm pole solution. The centerpiece of this is the introduction of
the Nahm pole boundary condition, and the analysis which shows that this is an elliptic boundary condition, so that solutions have well
controlled asymptotics near the boundary.  A proper statement of this boundary condition requires a somewhat elaborate calculation of the
indicial roots of the problem. These are the formal growth rates of solutions, but without further analysis, there is no guarantee
that solutions grow at these precise rates.  This further analysis rests on the verification of the ellipticity of the linearized KW operator acting on 
fields with a certain imposed growth rate at the boundary.   The second main result here is a Weitzenbock formula for these 
equations. There are a number of such formulas, in fact, and the subtlety is to choose one which is well adapted to solutions with
Nahm pole singularities.  A linearization of this formula plays an important role in understanding ellipticity of the Nahm
pole boundary condition.   

These results and ideas are somewhat intertwined, and we present them in a way that is perhaps not the most logical from a strictly
mathematical point of view, but which emphasizes the essential points as quickly as possible. Thus we first explain the Weitzenbock formula,
and then proceed to the calculation of indicial roots. We are then in a position to give a precise definition of the Nahm pole boundary conditions.
At this point, we use the Weitzenbock formula to prove the uniqueness theorem. This is only a formal calculation unless we prove
that solutions do have these asymptotic rates. This is established in the remainder of the paper.

\subsection{Solutions On A Four-Manifold Without Boundary}\label{background}

We first review how to characterize the solutions of  the KW equations when formulated on an oriented four-manifold $M$ without boundary.
(See section 3.3 of \cite{WittenK}.) The details are not needed in the rest of the paper. This material is included only to motivate the way we will search for
a uniqueness theorem in the presence of the Nahm pole.

As a preliminary, we give a brief proof of ellipticity of the KW equations.  By definition, a nonlinear partial differential equation is called elliptic if its linearization
is elliptic.  For a gauge-invariant equation, this means that the linearization is elliptic if supplemented with a suitable gauge-fixing condition.  In the case of the KW
equations  linearized around a solution $A_{(0)},\phi_{(0)}$, a suitable gauge-fixing condition is $\d_{A_{(0)}}\star (A-A_{(0)})=0$, or equivalently
\begin{equation}\label{zelob}\sum_i\frac{D}{D x^i} (A-A_{(0)})^i=0,  \end{equation}
where $D/D x^i =\partial_i +[A_{(0)\,i},\cdot]$ is the covariant derivative defined using the connection $A_{(0)}$.  Any other gauge condition
that differs from this one by lower order terms also gives an elliptic gauge-fixing condition; a convenient choice turns out to be
\begin{equation}\label{elob}\sum_i\frac{D}{ Dx^i}(A-A_{(0)}^i)+\sum_i[\phi_{(0)\,i},\phi^i-\phi_{(0)}^i]=0. \end{equation}
 It is convenient to regard the linearized
KW equations as equations for a pair  $\Phi=(A-A_{(0)},\star(\phi-\phi_{(0)}))$ consisting of a 1-form and 3-form on $M$ both
valued in $\ad(E)$.  With this interpretation, the symbol of
the linearized and gauge-fixed KW equations is the same as the symbol of the operator $\d+\d^*$ mapping odd-degree differential forms on $M$ valued in $\ad(E)$
to even-degree forms valued in $\ad(E)$.  This is a standard example of an elliptic operator, so the KW equations are elliptic. 
For future reference, we observe that  the $\d+\d^*$ operator admits two standard and very simple elliptic boundary conditions, which are much 
 more straightforward than the Nahm pole boundary
condition which is our main interest in the present paper.\footnote{As we explain in section \ref{nonregular}, these
boundary conditions
can be viewed as special cases of the Nahm pole boundary condition with $\varrho=0$.} These conditions are respectively
\begin{equation}\label{tively}i^*(\Lambda)=0 \end{equation}
and 
\begin{equation}\label{sively}i^*(\star\Lambda)=0,\end{equation}
where $i:\partial M\to M$ is the inclusion and, for a differential form $\omega$ on $M$, $i^*(\omega)$ is the pullback of $\omega$ to $\partial M$.


Now  set
\begin{equation}\label{telbo}\V_{ij}=F_{ij}-[\phi_i,\phi_j]+\epsilon_{ij}{}^{kl}D_k\phi_l,~~~~\V^0=D_i\phi^i, \end{equation}
so that the KW equations are
\begin{equation}\label{elboxoc} \V_{ij}=\V^0=0. \end{equation}
These equations arise in a  twisted supersymmetric gauge theory in which the bosonic part of the action is
\begin{equation}\label{baction}I=-\int_M\d^4x \sqrt g\Tr\left(\frac{1}{2}F_{ij}F^{ij}+D_i\phi_j D^i\phi^j+R_{ij}\phi^i\phi^j+\frac{1}{2}[\phi_i,\phi_j][\phi^i,\phi^j]\right), \end{equation}
where sums over repeated indices are understood and $R_{ij}$ is the Ricci tensor.  Also $\Tr$ is an invariant, nondegenerate, negative-definite quadratic form
on the Lie algebra $\frak g$ of $G$.  For example, for $G=SU(N)$, $\Tr$ can be the trace in the $N$-dimensional representation; the precise normalization of the
quadratic form will not be important in this paper.   

The simplest way to find a vanishing theorem for the KW equations is to form a Weitzenbock formula.  We take the sum of the squares of the equations and
integrate over $M$.  After some integration by parts, and without assuming the boundary of $M$ to vanish, we find
\begin{equation}\label{zoffbo} -\int_M\d^4x \sqrt g\Tr\left(\frac{1}{2}\V_{ij}\V^{ij}+(\V^0)^2\right)=I+\int_{\partial M}\d^3x\, \epsilon^{abc}\Tr\left(\frac{1}{3}\phi_a[\phi_b,\phi_c]-\phi_a
F_{bc}\right). \end{equation} (We write $i,j,k=1,\dots,4$ for indices tangent to $M$ and $a,b,c=1,\dots,3$ for indices tangent to $\partial M$.) In evaluating the boundary term, we 
assume that near its boundary, $M$ is a product $\partial M\times [0,1)$.  We also assume that, if $n$ is the normal vector to $\partial M$, then $n\, \llcorner \phi=0$ along 
$\partial M$, or equivalently, that the pullback of the 3-form $\star\phi$ to $\partial M$ vanishes:
\begin{equation}\label{llomigo} i^* (\star\phi) =0. \end{equation}
This condition is needed to get a useful form for the boundary contribution in the Weitzenbock formula (or alternatively because of supersymmetric
considerations explained in \cite{GW}), so it will be part of the Nahm pole boundary condition.  However, for the rest of this introductory discussion, we 
assume that $\partial M$ is empty. 

If the KW equations $\V_{ij}=\V^0=0$ hold and $\partial M$ vanishes, it follows from the formula above that $I=0$.  This immediately leads to a vanishing theorem: 
if the Ricci tensor of $M$ is 
non-negative, then each term in (\ref{baction}) must separately vanish. Thus, the curvature $F$ must vanish; $\phi$ must be covariantly constant and its components
must commute, $[\phi_i,\phi_j]=0$; and finally $\phi$ must be annihilated by the Ricci tensor, $R_{ij}\phi^j=0$.

Still on an oriented four-manifold without boundary, the KW equations  are
actually subject to a stronger vanishing theorem than we have just explained, because of a fact that is related to the underlying supersymmetry:
modulo a topological invariant,
the functional $I$ can be written as a sum of squares in multiple ways.   To explain this, we first generalize the KW equations  to depend on a real parameter $t$.
Given a two-form $\Lambda$ on $M$, we write $\Lambda=\Lambda^++\Lambda^-$, where $\Lambda^+$ and $\Lambda^-$ are 
the selfdual and anti-selfdual projections of $\Lambda$.  Then we define
\begin{align}\V^+_{ij}(t)&=(F_{ij}-[\phi_i,\phi_j]+t(D_i\phi_j-D_j\phi_i))^+ \cr \V^-_{ij}(t)&=(F_{ij}-[\phi_i,\phi_j]-t^{-1}(D_i\phi_j-D_j\phi_i))^-\cr
\V^0&= D_i\phi^i.
\end{align}
The equations \begin{equation}\label{noxo}\V^+_{ij}(t)=\V^-_{ij}(t)=\V^0=0\end{equation}
 are a one-parameter family\footnote{One can naturally
think of $t$ as taking values in $\R\cup\infty=\RP^1$.  For $t\to 0$, one should multiply $\V^-(t)$ by $t$, and for $t\to\infty$, one should multiply $\V^+(t)$ by $t^{-1}$.
The proof of ellipticity given above at $t=1$ can be extended to all $t$.  One approach to this uses the formula  (\ref{zelg}) below, supplemented by some special
arguments at $t=0,\infty$.}
 of elliptic differential equations that reduce to (\ref{robo}) for $t=1$.
All considerations of this paper can be extended to generic\footnote{The Nahm pole boundary condition is defined for generic $t$ starting with a model solution in which
the Nahm pole appears in $A$ as well as $\phi$, with $t$-dependent coefficients.}   $t$, but to keep the formulas simple and because this case has the closest relation to
Khovanov homology, we will generally focus on the case $t=1$.  

The generalization of eqn.\ (\ref{zoffbo}) to generic $t$ reads
\begin{align}\label{zelg}  -\int_M\d^4x \sqrt g&\Tr\left(\frac{t^{-1}}{t+t^{-1}}\V^+_{ij}(t)\V^{+\,ij}(t)+\frac{t}{t+t^{-1}}\V_{ij}^-(t)\V^{-\,ij}(t)+(\V^0)^2\right)\cr &
=I +\frac{t-t^{-1}}{4(t+t^{-1})}\int_M \d^4 x \,\epsilon^{ijkl}\Tr F_{ij}F_{kl}. \end{align}
In writing this formula, we have assumed that the boundary of $M$ vanishes. (For a more general formula for $\partial M$ non-empty, see eqn.\ (2.60) of \cite{WittenK}.)
Notably, the expression $I$ that appears on the right hand side on (\ref{zelg}) is the functional defined in eqn.\ (\ref{baction}), independent of $t$.  This immediately
leads to very strong  results about possible solutions.  

Suppose, for example, that we find $A,\phi$ obeying the original KW equations (\ref{robo})
at $t=1$.  Then setting $t=1$ in  (\ref{zelg}), the left hand side vanishes, and 
\begin{equation}\label{elg}\P= \frac{t-t^{-1}}{4(t+t^{-1})}\int_M \d^4 x \,\epsilon^{ijkl}\Tr F_{ij}F_{kl} \end{equation}
certainly also vanishes at $t=1$, so therefore $I=0$.   Now suppose that the integral 
 $\int_M\d^4 x \epsilon^{ijkl}\Tr\,F_{ij}F_{kl}$  -- a multiple of which is the first Pontryagin class  $p_1(E)$ -- is nonzero.  Then we can choose $t\not=1$
 to make $\P<0$, and we get a contradiction: the left hand side of (\ref{zelg}) is non-negative, and the right hand side is negative. 
 Hence any solution of the original equations at $t=1$ is on a bundle $E$ with $p_1(E)=0$.  The same is actually true for a solution of the more general eqn.\ (\ref{noxo}) at any
 value of $t$ other than 0 or $\infty$.    To show this, starting with a solution of (\ref{noxo}) at, say, $t=t_0$,  one observes that unless $p_1(E)=0$,
 one would reach the same contradiction as before by considering eqn.\ (\ref{zelg}) at a value $t=t_1$ at which $\P$ is more negative than it is at $t=t_0$.
Such a $t_1$ always exists for $t_0\not= 0,\infty$ unless $p_1(E)=\P=0$.
 
 Once we know that $\P=0$, it  follows  that the right hand side of (\ref{zelg}) is independent of $t$, and hence vanishes for all $t$ if it vanishes for any $t$. But the left
 hand side of (\ref{zelg}) vanishes if and only if the eqns. (\ref{noxo}) are satisfied.  So if $A,\phi$
 obey the eqns. (\ref{noxo}) at any $t\not=0,\infty$, they satisfy those equations for all $t$.    This leads to a simple description of all the solutions (away from $t=0,\infty$).
 Combine $A,\phi$ to a complex connection $\A=A+i\phi$.  We view $\A$ as a connection on a $G_\C$-bundle $E_\C\to M$; here $G_\C$ is a complex
 simple Lie group that is the complexification of $G$, and $E_\C\to M$ is the $G_\C$ bundle that is obtained by complexifying the $G$-bundle $E\to M$.  We also
 define the curvature of $\A$ as $\F=\d\A+\A\wedge \A$.
 The condition that eqns. (\ref{noxo}) are satisfied for all $t$ is that $\F=0$ and $\d_A\star \phi=0$.  By a well-known result \cite{corlette}, solutions of these equations are in 1-1 correspondence
 with homomorphisms $\uppsi:\pi_1(M)\to G_\C$ that satisfy a certain condition of semistability.  (This condition says roughly that if the holonomies of $\uppsi$
 are triangular, then they are actually block-diagonal.)
 
 The key to getting these simple  results was the fact that (modulo a multiple of $p_1(E)$) the same functional $I$ can be written as a sum of squares in more than
 one way.  This fact is related to the underlying supersymmetry.
 We will look for something similar to find a uniqueness theorem associated to the Nahm pole.  


\subsection{A Weitzenbock Formula Adapted To The Nahm Pole}\label{beyond}

Now suppose that $M$ has a non-empty boundary, and consider a solution with a Nahm pole along $\partial M$.  The formulas above do not lead to a useful
conclusion directly because the Nahm pole causes the boundary term in (\ref{zoffbo}) to diverge. 

To make this more precise, let us specialize to the case $M=\R_+^4$.  As in the introduction, introduce coordinates  $\vec x=(x^1,x^2,x^3)$ and $y=x^4$ on $\R^4$,
with $M$ the half-space $y\geq 0$.  The familiar Nahm pole solution is given by
\begin{equation}\label{zerr}A=0,~~~\phi=\sum_{a=1}^3\frac{\tt_a\cdot \d x^a}{y}. \end{equation}
(Indices $i,j,k=1,\dots,4$ will refer to all four coordinates $x^1,\dots,x^4$, and indices $a,b,c=1,\dots,3$ will refer to $x^1,x^2,x^3$ only.)
For this solution, the commutators $[\phi_a,\phi_b]$ and covariant derivatives $D_y\phi$ are all of order $1/y^2$, hence not square-integrable 
near $y=0$ (or as $|(\vec x,y)| \to \infty$), and thus the functional $I$ in (\ref{baction}) diverges.  Accordingly, the boundary terms
in the Weitzenbock formula, which we repeat here for convenience (omitting the factor of $\sqrt{g}$ on the left because $M$ is Euclidean),
\begin{equation}\label{zoffboz} -\int_M\d^4x \Tr\left(\frac{1}{2}\V_{ij}\V^{ij}+(\V^0)^2\right)=I+\int_{\partial M}\d^3x \,\epsilon^{abc}\Tr\left(\frac{1}{3}\phi_a[\phi_b,\phi_c]-\phi_a
F_{bc}\right),\end{equation}
are also divergent.   A standard way to regularize such divergences is to replace $M$ by $M_\epsilon = \{ y > \epsilon, \ |(\vec x,y)| < 1/\epsilon\}$,
carry out the integrations by parts, and discard the terms which diverge as $\epsilon \to 0$. For the purposes of the present exposition, let us focus
only on the portion of the boundary where $y = \epsilon$; arguments are given in section \ref{zobot} to show that the contributions from the other part of the boundary 
are negligible. The bulk and boundary terms on the right hand side of (\ref{zoffboz}) are both of order $1/\epsilon^3$ near this lower boundary,
and since the left side vanishes (for the Nahm pole solution), these various diverging contributions on the right must cancel. However, when such a 
cancellation comes into play, it is very difficult to deduce any positivity of the remaining terms on the right, so this formula is not well-suited
to deduce a vanishing theorem.

It is inevitable that the boundary contribution in (\ref{zoffboz}) is at least nonzero for the Nahm pole solution, since otherwise, we could prove
that $I=0$ for this solution, contradicting the fact that $I$ is a sum of squares of quantities (such as $[\phi_a,\phi_b]$) not all of which vanish for the Nahm pole solution.
Observe that once we know that both $I$ and the boundary term are nonvanishing, scale-invariance implies that they must diverge as $\epsilon\to 0$.

To learn something in the presence of the Nahm pole, we need a different way to write the left hand side of (\ref{zoffboz}) as a sum of squares plus a boundary term,
where the boundary term will vanish for any solution that obeys the Nahm pole boundary condition. This will imply a vanishing theorem for such solutions.  
Of course, for this to be possible, the objects whose squares appear on the right hand side of the new formula must vanish in the Nahm pole solution.

So let us write down a set of quantities that vanish in the Nahm pole solution.  It is convenient to expand $\phi=\sum_{a=1}^3 \phi_a\d x ^a+\phi_y \d y$.  
The Nahm pole solution is characterized by $A=\phi_y=0$ and hence trivially
\begin{equation}\label{zon} F= D_i\phi_y =[\phi_i,\phi_y]=0. \end{equation}
Somewhat less trivially, the Nahm pole solution also satisfies
\begin{equation}\label{ozon} W_a = 0 =D_a\phi_b, \end{equation}
where we define
\begin{equation}\label{cozon} W_a=D_y\phi_a+\frac{1}{2}\epsilon_{abc}[\phi_b,\phi_c]. \end{equation}
Conversely, these equations characterize the Nahm pole solution, in the following sense.  The equations (\ref{zon}) and (\ref{ozon}) imply immediately that in a suitable
gauge $A=0$ and $\phi_a$ and $\phi_y$ are functions of $y$ only.  Moreover, $\partial_y\phi_y=0$ (in the gauge with $A=0$), so if $\phi_y$ is required to vanish at  $y=0$ 
(which will be part of the Nahm pole boundary condition) then it vanishes identically.  Finally, the condition $W_a=0$ means that the functions $\phi_a(y)$ obey 
the original 1-dimensional Nahm equation $\d\phi_a/\d y+(1/2)\epsilon_{abc}[\phi_b,\phi_c]=0$.   

This discussion motivates us to replace the functional $I$ of eqn.\ (\ref{baction}) by a new functional $I'$ which is the sum of squares of  objects which vanish for 
the Nahm pole solution: 
\begin{align}\label{longsum}I'=-\int_{\R^3\times \R_+}\d^4x\,\Tr\left(\frac{1}{2}\sum_{i,j}F_{ij}^2+\sum_{a,b}(D_a\phi_b)^2 +\sum_i(D_i\phi_y)^2+\sum_a[\phi_y,\phi_a]^2
+\sum_a W_a^2\right).\end{align}
The only difference between $I$ and $I'$ is that we have replaced $\sum_a(D_y\phi_a)^2+\frac{1}{2}\sum_{a,b}[\phi_a,\phi_b]^2$ by $\sum_aW_a^2$.
Since
\begin{equation}\label{gosum}\Tr\,\left( \sum_a(D_y\phi_a)^2+\frac{1}{2}\sum_{a,b}[\phi_a,\phi_b]^2\right)=\sum_a\Tr \,W_a^2-\frac{1}{3}\partial_y\epsilon^{abc}\Tr \,\phi_a[\phi_b,\phi_c], \end{equation}
the sole effect of this is to change the boundary term in \eqref{zoffbo}, in fact to cancel the cubic terms in $\phi$ that cause the 
divergence as $y\to 0$ in the Nahm pole solution. Eqn.\ (\ref{zoffbo}) is now replaced by the new identity:
\begin{equation}\label{zoffbox}-\int_{\R^3\times \R_+}\d^4x\, \Tr\left(\frac{1}{2}\V_{ij}\V^{ij}+(\V^0)^2\right)=I'-\left(\int_{y=0}-\int_{y=\infty}\right)\d^3x \,\epsilon^{abc}\Tr\,\phi_a F_{bc}+\Delta,
\end{equation}
where
\begin{equation}\label{mofobox}\Delta=\int_{\R^3\times\R_+}\d^4x\,\frac{\partial}{\partial x^i}\Tr\left(\phi_j D^j\phi^i-\phi^iD_j\phi^j\right).  \end{equation}
For the time being, we do not replace $\Delta$ by a boundary integral. If $M$ is a compact manifold with boundary, then $\Delta$ vanishes for a solution 
that is regular along $\partial M$ and satisfies (\ref{llomigo}), which explains why $\Delta$ does not appear in eqn.\ (\ref{zoffbo}).  However, for $M=\R^4_+$, 
the use of (\ref{llomigo}) in eliminating the boundary contribution is less simple in the presence of the Nahm pole, so the term $\Delta$ cannot be dropped trivially
and will be analyzed later.

Now there is a clear strategy for proving a uniqueness theorem for the  Nahm pole solution.  We must show that  any solution that is
asymptotic to the Nahm pole solution for $y\to 0$ and for $|(\vec x,y)| \to \infty$ approaches the Nahm pole solution quickly enough 
that the boundary terms in eqn.\ (\ref{zoffbox}) (including $\Delta$) vanish. It will then follow that $I'=0$ for any such solution. Since $I'$ is a sum of squares 
of quantities that vanish only for a solution derived from the 1-dimensional Nahm solution, the given solution will coincide with the Nahm pole solution everywhere. 


\subsection{The Indicial Equation}\label{smally}
\subsubsection{Overview}\label{overview}

Our next task is to  examine in detail the possible behavior of a solution of the KW equation that is asymptotic to the Nahm pole solution (with some $\varrho$)
as $y\to 0$.  This analysis is necessary before we can properly define the Nahm pole boundary condition, and will also be essential for showing that the boundary 
terms in eqn.\ (\ref{zoffbox}) vanish.

In making this analysis, we need to supplement the KW equation with a gauge condition.  
In the Nahm pole boundary condition, we only allow gauge transformations that are trivial\footnote{At the end of section \ref{nonregular}, we explain that  in the case of a nonregular
Nahm pole, one can define a more general boundary condition in which gauge transformations are not required to be trivial at $y=0$.} 
 at $y=0$, and we are interested in a gauge condition that fixes this gauge invariance.

A gauge transformation that vanishes at $y=0$ can be chosen in a unique fashion to make $A_y=0$, and for understanding the asymptotic behavior of perturbations 
of the Nahm pole solution near $y=0$, this is a natural boundary condition.  However, for other purposes (including proving that the Nahm pole boundary condition 
is well-posed, but also studying the boundary terms at infinity in the Weitzenbock formula), it is necessary to choose an elliptic gauge condition, i.e.\ one which 
augments the KW equations to an elliptic system.  Two examples of elliptic gauge conditions were given in equations  (\ref{zelob}) and (\ref{elob}). The Nahm pole 
solution is $A_{(0)}=0$, $\phi_{(0)}=\tt\cdot \d x/y$, and we consider nearby solutions, which we write as $A=a$, $\phi=\tt\cdot \d x/y+\varphi$, so $a$ and $\varphi$ 
are the fluctuations about the Nahm pole.  The gauge conditions (\ref{zelob}) and (\ref{elob}) are $\partial_i a^i=0$ and
\begin{equation}\label{zurimo}\partial_i a^i+ \frac{1}{y}[\tt_a,\varphi_a]=0,  \end{equation}
respectively. Both of these gauge conditions are elliptic, but we use (\ref{zurimo}) as it simplifies the later analysis considerably.

Technically, we assume that $a$ and $\varphi$ admit asymptotic expansions as $y \to 0$, and consider solutions of the KW equations (with
a gauge condition) such that $a$ and $\varphi$ are less singular than $1/y$ there. 
Writing the putative expansion around the Nahm pole solution as 
\begin{equation}\label{donzo} 
A=y^\lambda a_0(\vec x)+\dots , \qquad  \phi=\frac{\sum_{a=1}^3\tt_a\,\d x^a}{y}+ y^\lambda \varphi_0(\vec x)+\dots, 
\end{equation}
where $a_0(\vec x)$, $\varphi_0(\vec x)$ depend only on $\vec x$, and the ellipses refer to terms that are less singular than $y^\lambda$ for $y\to 0$,
we ask which exponents $\lambda > -1$ are allowed if this expression satisfies the equations formally.  

In greater detail, write the KW equations along with a fixed gauge condition  as 
\begin{equation}
{\KW}(A, \phi) = 0.
\label{nlkw}
\end{equation}
Expanding this about the Nahm pole solution yields
\begin{equation}
{\KW}(a, \phi_{(0)} + \varphi) = \LKW (a,\varphi) + Q(a,\varphi),
\label{texpkw}
\end{equation}
where $\L  $ is the linearization of $\KW$ at $(0, \tt \cdot \d x/y)$ and the remainder term $Q$ vanishes quadratically in a suitable sense.  Assuming that
$a$ and $\varphi$ have expansions as above, and that these expansions may be differentiated, multiplied, etc., we see that the most singular terms in $\L(a,\varphi)$ are of order $y^{\lambda-1}$, while $Q(a,\varphi)$ is no more singular than $y^{2\lambda}$. Since $\lambda>-1$, this is less
singular than $y^{\lambda-1}$. Furthermore, only certain terms in $\L( y^\lambda a_0, y^\lambda \varphi_0)$ are as
singular as $y^{\lambda-1}$. Specifically, the terms which
include a $\del_y$ yield a singular factor $y^{\lambda - 1}$, as do the terms containing a commutator with the unperturbed Nahm pole solution.
On the other hand, terms containing $\del_{x^a}$ are $\calO(y^\lambda)$ and hence may be dropped for these considerations. What remains is 
a linear algebraic equation involving $a_0, \varphi_0$ and the exponent $\lambda$. This is known as the indicial equation for the problem. 

We have been somewhat pedantic about separating the steps of first passing to the linearization and then the indicial operator of this
linearization. The same sets of equations can be obtained by directly inserting the putative expansions for $a$ and $\varphi$ into
the nonlinear equations and retaining only the leading terms. The reason for our emphasis will become clear later. 

At this level, the dependence of these coefficients on $\vec x$ is irrelevant, and because of this, the indicial equation respects the symmetry 
$A_a\to -A_a$, $\phi_y\to -\phi_y$, with $\phi_a$ and $A_y$ left unchanged.  This means that the indicial equation uncouples into a system of equations 
for $\varphi_a, a_y$ and another for $a_a,\varphi_y$. These read
\begin{align}\label{lembo}\lambda a_a+[\tt_a,\varphi_y]-\epsilon_{abc}[\tt_b,a_c]&=0 \cr
   \lambda\varphi_y-[\tt_a,a_a]&=0, \end{align} 
and
\begin{align}\label{wembo}\lambda \varphi_a-[\tt_a,a_y]+\epsilon_{abc}[\tt_b,\varphi_c]&=0 \cr \lambda a_y+[\tt_a,\varphi_a]&=0,
\end{align}
respectively. (Had we used the gauge condition $\partial_i a^i=0$ instead of eqn.\ (\ref{zurimo}), the only difference would be that 
the $[\tt_a,\varphi_a]$ term would be missing in the second line of (\ref{wembo}).)

The determination of the indicial roots of the problem, which are defined as the values of $\lambda$ for which these equations have nontrivial solutions, requires a foray into group theory. 
    
\subsubsection{Some Useful Group Theory}\label{group}

\def\T{{\eusm T}}
\def\S{{\eusm S}}
\def\M{{\eusm M}}
\def\ss{{\frak s}}
\def\ff{{\frak f}}
\def\F{{\eusm F}}
One obvious ingredient in these equations is the $\frak{su}(2)$ subalgebra of $\frak g$ that is generated by the $\tt_a$.  This depends on the choice of
homomorphism $\varrho:\frak{su}(2)\to \frak g$; we call its image $\frak{su}(2)_\tt \subset \frak g$.
From the representation theory of $\frak{su}(2)$, we know that up to isomorphism, $\frak{su}(2)$ has one irreducible complex module of dimension $n$ for
every positive integer $n$.  It is convenient to write $n=2j+1$, where $j$ (which is a non-negative half-integer) is called the spin.
In particular under the action of $\frak{su}(2)_\tt$, the complexification $\frak g_\C=\frak g\otimes_\R\C$ of $\frak g$ decomposes as a direct sum of irreducible 
modules $\frak r_\sigma$, of dimension $n_\sigma=2j_\sigma+1$.\footnote{When the $j_\sigma$ 
are all integers, for example in the case of a principal $\frak{su}(2)$ embedding, this statement is true without having to replace $\frak g$ by its complexification
$\frak g_\C$.  The complexification is needed in case some $j_\sigma$ are half-integers.  It can happen in general that several of the $\frak r_\sigma$'s are isomorphic
and in that case the decomposition of $\frak g_\C$ as a direct sum of irreducible $\frak{su}(2)_\tt$ submodules $\frak r_\sigma$ is not unique.  This  does not affect the following analysis.}  For a principal embedding, the $j_\sigma$ are positive integers of which
precisely one is equal to 1 (the submodule of $\frak g$ of spin $j_\sigma=1$ is precisely $\frak{su}(2)_\tt\subset \frak g$).  For example,  $G=SU(N)$ has rank $N-1$
and the values of the $j_\sigma$ are\footnote{For this and additional group-theoretic background, see
Appendix \ref{groups}.}
 $1,2,3,\dots,N-1$.  At the opposite extreme, if  $\varrho=0$, so that the $\tt_a$ all vanish, then $\frak g$ is the direct sum of trivial 1-dimensional 
 $\frak{su}(2)_\tt$ modules, all of spin 0.
 
The indicial equation does not intertwine the $\frak{su}(2)_\tt$ submodules $\frak r_\sigma\subset \frak g_\C$ since none of the terms in the equation do; 
hence the equation can be restricted to any one of the $\frak r_\sigma$. For example, in \eqref{lembo}, it suffices to consider $\varphi_y$ and all the $a_a$ taking values in the same 
submodule $\frak r_\sigma$.  A general solution of the indicial equation is a sum of $\frak r_\sigma$-valued solutions over all the different $\sigma$. 
This is useful because for solutions taking values in a given $\frak r_\sigma$, the endomorphisms appearing in \eqref{lembo} and \eqref{wembo} 
reduce to diagonal operators, so that the equations then completely decouple. 
The calculation making this explicit occupies the remainder of this subsection. 
 
An important property of the algebra $\frak{su}(2)$ is the existence of a quadratic Casimir operator that commutes with the algebra.  
 In general, given any $\frak{su}(2)$ algebra with a basis $\frak b_a$, $a=1,\dots,3$, obeying the $\frak{su}(2)$ relations
 \begin{equation}\label{tildno}[\frak b_a,\frak b_b]=\epsilon_{abc}\frak b_c, \end{equation}
 we define the Casimir as
 \begin{equation}\label{dinko}\Delta=-\sum_{a=1}^3 \frak b_a^2. \end{equation}  On a module of spin $j$, one has
 \begin{equation}\label{inko}\Delta=j(j+1). \end{equation}
 
 In the case of $\frak{su}(2)_\tt\subset\frak g$, we usually write the action of the generators on $\frak g$ as $w\to [\tt_a,w]$ (rather than $w\to \tt_a(w))$.  So we can write the Casimir $\Delta_\T$ as
 \begin{equation}\label{inco}
 \Delta_\T=-\sum_{a=1}^3[\tt_a,[\tt_a,\cdot]],
\end{equation} 
or more abstractly, 
\begin{equation}\label{pilo}\Delta_\T=-\sum_{a=1}^3\tt_a^2,\end{equation}
as in (\ref{dinko}).
  
  It is often best to think of the triple $\vec a=(a_1,a_2,a_3)$ or similarly the triple $\vec\varphi=(\varphi_1,\varphi_2,\varphi_3)$
  as a single element of $\frak g\otimes N$ where $N\cong \R^3$. 
 Another useful $\frak{su}(2)$ algebra acts on the three-dimensional vector space $N$.  (This is simply inherited from invariance of the original KW equations under
 rotations of $\vec x=(x^1,x^2,x^3)$.) Explicitly, we define $3\times 3$ matrices $\ss_a$, $a=1,\dots,3$
 by
 \begin{equation}\label{donkey} (\ss_a)_{bc}=-\epsilon_{abc}.\end{equation}
 These matrices obey the $\frak{su}(2)$ commutation relations
\begin{equation}\label{monkey} [\ss_a,\ss_b]=\epsilon_{abc}\ss_c, \end{equation} and generate an $\frak{su}(2)$ algebra
that we call $\frak{su}(2)_\ss$.
We define the quadratic Casimir $\Delta_\S=-\sum_{a=1}^3\ss_a^2$ and find that $\Delta_\S=2$.
The value 2 is $j(j+1)$ with $j=1$, and reflects the fact that $N$ is an irreducible $\frak{su}(2)_\ss$ module of spin 1.

Finally, we can define a third $\frak{su}(2)$ algebra that we call $\frak{su}(2)_\ff$, generated by $\ff_a=\tt_a+\ss_a$.  
The importance of $\frak{su}(2)_\ff$ is that, since the Nahm pole solution is invariant under $\frak{su}(2)_\ff$ but not under $\frak{su}(2)_\tt$ or $\frak{su}(2)_\ss$,
it is only $\frak{su}(2)_\ff$ that is a symmetry of the indicial equation.  To be more exact, to make $\frak{su}(2)_\ff$ a symmetry of the indicial equation,
we let $\frak{su}(2)_\ff$ act on $\frak g\otimes N$ as just described, while in acting on $\frak g$ itself, we declare that $\ss_a=0$ and $\ff_a=\tt_a+\ss_a=\tt_a$.
Then interpreting $a_a$ and $\varphi_a$ as elements of $\frak g\otimes N$ and $a_y$ and $\varphi_y$ as elements of $\frak g$, with the $\frak{su}(2)_\ff$
action just described, the indicial equation is invariant under $\frak{su}(2)_\ff$.


To exploit this, it is useful to again define a quadratic Casimir $\Delta_\F=-\sum_{a=1}^3\ff_a^2$. Now we have a very useful formula for the $\frak{su}(2)_\ff$-invariant
operator $\ss\cdot \tt=\sum_a\ss_a\cdot \tt_a$:
\begin{equation}\label{mozzo} \ss\cdot \tt=-\frac{1}{2}\left(\Delta_\F-\Delta_\T-\Delta_\S\right). \end{equation}

To make this formula explicit for the module  $\frak r_\sigma\otimes N$, we need to know how to decompose this module under $\frak{su}(2)_\ff$. The answer is given
by the representation theory of $\frak{su}(2)$.
Provided that $j_\sigma\geq 1$, 
the tensor product $\frak r_\sigma\otimes N$
 decomposes under $\frak{su}(2)_\ff$ as a direct sum of modules $\frak r_{\sigma,\eta}$ of spin  $f_{\sigma,\eta}=j_\sigma+\eta$ where $\eta\in\{1,0,-1\}$.
 For $j_\sigma<1$, the decomposition is the same except that the range of values of $\eta$ is smaller; for $j_\sigma=1/2$, one has only $\eta\in\{1,0\}$, and for $j_\sigma=0$
 one has only $\eta=1$.  
 
 In any event, it follows from (\ref{mozzo}) that in acting on $\frak r_{\sigma,\eta}$, the value of $\ss\cdot\tt$ is 
\begin{equation}\label{mexico}\ss\cdot\tt=\begin{cases}-j_\sigma & {\text{if}}\;\; \eta=1\cr 1 & \text{if}\;\;\eta=0\cr j_\sigma+1 & \text{if}\;\;\eta=-1.\end{cases}\end{equation} 
This result is useful because the object $\ss\cdot\tt$  appears in the indicial equation.  For example, understanding $\vec a=(a_1,a_2,a_3)$ as an element of $\frak g\otimes N$,
so that $\ss\cdot \tt\, (\vec a)$ is also a triple of elements $(\ss\cdot \tt\,(\vec a))_a$, $a=1,2,3$ of $\frak g$,
we have from the definitions
\begin{equation}\label{exico} (\ss\cdot \tt \,(\vec a))_a=\epsilon_{abc} [\tt_b,a_c].\end{equation}
The right hand side appears in (\ref{lembo}), and now we have a convenient way to evaluate it.  Similarly, the analogous object $\epsilon_{abc}  [\tt_b,\varphi_c]$ appears
in (\ref{wembo}).  

When we decompose the $\frak r_\sigma$-valued part of the indicial equation (\ref{lembo}) under the action
of the symmetry group $\frak{su}(2)_\ff$,
modules with spin $j_\sigma\pm 1$ (in other words $\eta=\pm 1$) appear only in the $\frak{su}(2)_\ff$ decomposition of
$a_a$, while
spin $j_\sigma$ (or $\eta=0$) appears both in $a_a$ and in $\varphi_y$.  It follows that the terms in \eqref{lembo} involving 
$\varphi_y$, and likewise, the terms in \eqref{wembo} involving $a_y$, only appear when $\eta=0$. 

\subsubsection{The Indicial Roots}\label{throots}

It is now straightforward to determine the indicial roots.  First we consider the pair $a_a,\varphi_y$ and we restrict to the $\frak r_\sigma$-valued part of the equation.
For $\eta\not=0$, we can set $\varphi_y=0$, as explained at the end of section \ref{group},
and so the equation (\ref{lembo}) reduces to $\lambda a_a=\epsilon_{abc}[\tt_b,a_c]$.  The right hand side was analyzed in eqn.\ (\ref{mexico}) and (\ref{exico}),
and so $\lambda=-j_\sigma$ for $\eta=1$ and $\lambda=j_\sigma+1$ for $\eta=-1$.  For $\eta=0$, we have to work a little harder.   We solve
the second equation in (\ref{lembo}) with\footnote{This solution is not valid if $j_\sigma=0$, because of the factor of $j_\sigma$ in the denominator.
For $j_\sigma=0$, eqns. (\ref{lembo}) and (\ref{wembo}) become trivial, since all commutator terms vanish, and tell us that all modes have $\lambda=0$.
This agrees with the result we find in  eqn.\ (\ref{indroots}) below, except that some modes -- the ones with $\lambda=j_\sigma+1$ -- do not exist
for $j_\sigma=0$.} 
\begin{equation}\label{delf}a_a=-\frac{\lambda}{j_\sigma(j_\sigma+1)}[\tt_a,\varphi_y]\end{equation} 
and then after also using the Jacobi identity and the $\frak{su}(2)$ commutation relations, the first equation in (\ref{lembo}) becomes
\begin{equation}\label{urmo}-\frac{\lambda^2}{j_\sigma(j_\sigma+1)}+1+\frac{\lambda}{j_\sigma(j_\sigma+1)}=0.\end{equation}
So for $\eta=0$,  the possible values of $\lambda$ are $j_\sigma+1$ and $-j_\sigma$.  In sum for $a_a,\varphi_y$, the indicial roots are
\begin{equation}\label{indroots}\lambda=\begin{cases}-j_\sigma & {\text{if}}\;\; \eta=1\cr j_\sigma+1,\,-j _\sigma& \text{if}\;\;\eta=0\cr j_\sigma+1 & \text{if}\;\;\eta=-1.\end{cases}\end{equation} 
These results need correction for $j_\sigma<1$, since some modes are missing.  For $j_\sigma=1/2$, the $\lambda=j_\sigma+1=3/2$ mode 
with $\eta=-1$ should be dropped, and for $j_\sigma=0$, both modes with $\lambda=j_\sigma+1=1$ should be dropped.


Inspection of eqns. (\ref{lembo}) and (\ref{wembo}) shows that the indicial roots for the pair $\varphi_a,a_y$ are obtained
from those for $a_a,\varphi_y$ by just changing the sign of $\lambda$.  
So with no need for additional calculations, the indicial roots for the pair $\varphi_a,a_y$ are as follows:
\begin{equation}\label{indrootstwo}\lambda=\begin{cases}j_\sigma & {\text{if}}\;\; \eta=1\cr j_\sigma,~-j_\sigma-1& \text{if}\;\;\eta=0\cr -j_\sigma-1 & \text{if}\;\;\eta=-1.\end{cases}\end{equation} 
Again, some modes should be omitted for $j_\sigma<1$.

It is notable that all of these modes have $a_y=0$, and therefore make sense in the  gauge $A_y=0$,  
except the $\eta=0$ modes in (\ref{indrootstwo}).  Those particular modes are spurious in the sense that they are pure gauge: they are of the form
$a_y=\partial_y u$, $\varphi_a=[\tt_a/y,u]$ with $u(\vec x,y)=y^{\lambda+1}v(\vec x)$. 
After finding a solution of the KW equations, one can always make a gauge transformation that sets $A_y=0$ and eliminates these modes.
However, this can only be usefully done  after finding a global solution:
to develop a general theory of solutions of the KW equations, which can predict the existence of solutions,
one needs an elliptic gauge condition, and such a gauge condition will always allow
pure gauge modes, such as the ones we have identified.  Unlike the pure gauge modes with $a_y\not=0$, the perturbations we have found with $a_y=0$ have gauge-invariant content; they cannot
 be removed by a gauge transformation that is trivial at $y=0$, since there are no gauge transformations that
are trivial at $y=0$ and preserve the condition $a_y=0$.   So the gauge-invariant content of the possible perturbations of the Nahm pole solution near $y=0$
is precisely contained in the modes in (\ref{indroots}) and those in (\ref{indrootstwo}) with $\eta\not=0$.

One more mode in (\ref{indrootstwo})  has a simple interpretation.  Nahm's equations have the familiar Nahm pole solution $\phi_a=\tt_a/y$,
but since Nahm's equations are invariant under shifting $y$ by a constant, they equally well have a solution $\phi_a=\tt_a/(y-y_0)$ for any constant $y_0$.
Differentiating with respect to $y_0$ and setting $y_0=0$, we find that the linearization of Nahm's equations around the Nahm pole solution can be satisfied
by $\varphi_a=\tt_a/y^2$.  This accounts for the mode in (\ref{indrootstwo}) with $j_\sigma=1$, $\lambda=-2$, and $\eta=-1$.

Each value of $\lambda$ that is indicated in (\ref{indroots}) or (\ref{indrootstwo}) represents a space of fluctuations of dimension $2(j_\sigma+\eta)+1$, 
transforming as an irreducible  $\frak{su}(2)_\tt$ module.  Allowing for these multiplicities, the sum of all indicial roots is 0 for 
$a_a,\varphi_y$ and likewise for $\varphi_a,a_y$.
This is a check on the calculations: the indicial roots are eigenvalues of matrices that appear in (\ref{lembo}) and (\ref{wembo}) and are readily seen to be traceless. 

\subsection{The Nahm Pole Boundary Condition}\label{nonregular}
We are now in a position to give a precise formulation of the Nahm pole boundary condition.  This boundary condition depends on 
 the choice of homomorphism $\varrho:\frak{su}(2)\to \frak g$,   which determines the most singular behavior of the 
solution at $\del M$. As explained below, in favorable cases (for example, when $\varrho$ is a regular embedding), the Nahm pole 
boundary condition simply requires that a solution coincides with the Nahm pole solution modulo less singular terms, but in general 
(when $j_\sigma=0$ appears in the decomposition of $\frak g$) the formulation of the boundary condition involves some further details.

Without exploring any of the questions concerning existence of solutions that obey the Nahm pole boundary condition, the expectation 
is that any such solution has an asymptotic expansion at $\del M$, where the leading term is precisely the Nahm pole singularity, and 
that all fluctuations are well-behaved lower order terms in the expansion with strictly less singular rates of blowup.  As already 
suggested by the discussion in section \ref{overview}, the growth rates of these fluctuation terms are governed by the indicial roots, 
which are themselves determined by the linearization of the KW equations at the Nahm pole solution, as in \eqref{texpkw}.  In fact, 
one might try to construct solutions of ${\KW}(A,\phi) = 0$ by fixing the Nahm pole singularity, then setting the right side of 
\eqref{texpkw} to zero to solve for the fluctuation terms. This would involve inverting the linearized operator $\L  $, and it is thus
important to understand the possible invertibility properties of this operator.  In summary, the actual boundary condition we want 
to discuss is one for the linear operator $\L  $ which requires solutions to blow up at some rate strictly less than $y^{-1}$.  
The indicial root calculation above is what leads us to specify a growth (or decay) rate such that $\L  $ is as close to invertible 
as possible when acting on fields with this growth rate. 

\subsubsection{The Regular Case}\label{simple}
First assume that $\varrho$ is a principal embedding of $\frak{su}(2)$ in $\frak g$, or more generally, that in the decomposition of $\frak g_\C$ under
$\frak{su}(2)_\tt$, the minimum value of $j_\sigma$ is $1$. (The two conditions are equivalent for $G=SU(N)$ but
not in general, as explained in Appendix \ref{groups}.)  In this case there is a simplification stemming from the fact that there are no indicial roots with
$-1<\lambda<1$.  We certainly want to exclude fluctuations around the Nahm pole solution with $\lambda\leq -1$, and allow fluctuations with $\lambda>0$. 

Accordingly, for a principal embedding and more generally whenever $j_\sigma=1$ is the smallest value in the decomposition of $\frak g_\C$, we can state the Nahm pole
boundary condition in either of the following two equivalent ways:
\begin{itemize}\item[(1)] A solution satisfies the Nahm pole boundary condition if in a suitable gauge it has an asymptotic expansion as $y \to 0$
with leading term the Nahm pole solution, and all remaining terms less singular than $1/y$.
\item[(2)] A solution satisfies the Nahm pole boundary condition if in a suitable gauge it has an asymptotic expansion as $y \to 0$ with leading term the Nahm 
pole solution, and with all remaining terms vanishing as $y\to 0$. \end{itemize}
Condition (1) is {\it a priori} weaker than condition (2), but they are equivalent because  under our assumption
on the values of $j_\sigma$, there
are no indicial roots in the range $(-1,0]$.

The full explanation of ellipticity of the Nahm pole boundary condition is in section \ref{analysis}. However,
a preliminary observation that plays an important role 
 is that this boundary condition
allows half of the perturbations near $y=0$:  those with $\eta=1$ in $\varphi_a,a_y$, those with $\eta=-1$ in $a_a,\varphi_y$, and 
half of the $\eta=0$ perturbations in
both sets of fields.  (One of the two pure gauge modes that appear at $\eta=0$ in eqn.\ (\ref{indrootstwo}) vanishes
at $y=0$ and one diverges, so the pure gauge modes
did not affect this counting.)  


\subsubsection{The General Case}\label{gencase}
As explained in Appendix \ref{groups}, if any value $j_\sigma<1$  occurs in the decomposition of $\frak g_\C$
under $\frak{su}(2)$, then in fact $j_\sigma=0$ occurs in this decomposition.  (If $j_\sigma=0$ occurs
in the decomposition, then $j_\sigma=1/2$ may or may not occur.)
So 
 let us consider the case that $j_\sigma=0$ does occur in the decomposition.  This simply means that there is a nonzero subspace $\frak c$ of $\frak g$ that commutes
with the $\tt_a$; $\frak c$ is automatically a Lie subalgebra of $\frak g$, the Lie algebra of a subgroup $C\subset G$.   We write $\varphi^{\frak c}$, $a^{\frak c}$ for the $\frak c$-valued
parts of $\varphi$ and $a$.  The formulas (\ref{indroots}), (\ref{indrootstwo}) for the indicial roots show that all
modes of $j_\sigma=0$ have $\lambda=0$. Actually, this is clear without a detailed calculation; for $j_\sigma=0$, the commutator terms can be dropped
in (\ref{lembo}) and (\ref{wembo}), which just say that $\lambda=0$. 
This also shows that for $j_\sigma=0$, 
the equations for $a_a$ and $\varphi_y$ decouple and the modes with $\eta=1$ or $0$ describe fluctuations of only $a_a$ or
$\varphi_y$, respectively; a similar remark applies, of course, for $\varphi_a$ and $a_y$.  Exactly what one means by the Nahm pole boundary conditions depends on
how one treats these $\lambda=0$ modes; this will be discussed momentarily.

When both $j_\sigma=1/2$ and $j_\sigma=0$ occur in the decomposition of $\frak g_\C$, there is a further subtlety.
In this case, to preserve the counting mentioned at the end of section \ref{simple},
we have to define the Nahm pole boundary condition to not allow the perturbation with an indicial root $\lambda=-1/2$ that appears in (\ref{indroots})
for $j_\sigma=1/2$ and $\eta=0$.  In other words, we have to require that a solution departs from the Nahm pole solution by
a correction that is less singular than $1/y^{1/2}$.

As for the modes with $j_\sigma=0$, 
there are different physically motivated choices  of how to treat them  \cite{GW}, and these correspond to different boundary conditions.
The general possibility 
is explained at the end of this subsection.     However, for every $\varrho$, there is  a natural boundary condition that we call the strict Nahm pole
boundary condition; for $G=SU(N)$, this is the half-BPS boundary condition that can be naturally realized via D-branes.  For this boundary condition,
we want to leave $\phi_a^{\frak c}$ unconstrained at $y=0$ but to constrain $\phi_y^{\frak c}$, $A_a^{\frak c}$ to vanish at $y=0$.  



Thus, we can state the strict Nahm pole
boundary condition for general $\varrho$ in either of the following two equivalent ways:
\begin{itemize}\item[(1)] A solution satisfies the strict Nahm pole boundary condition if in a suitable gauge it has an asymptotic expansion as $y \to 0$ 
with leading term the Nahm pole solution and with remaining terms less singular than $1/y^{1/2}$ (or $1/y$  if $j_\sigma=1/2$ does not occur in the decomposition of $\frak g_\C$), 
with the further restriction that $\phi_y^{\frak c}$ and $A_a^{\frak c}$ vanish at $y=0$.
\item[(2)] A solution satisfies the strict Nahm pole boundary condition if in a suitable gauge it has an asymptotic expansion with leading term the Nahm pole solution 
and with remaining terms vanishing as $y\to 0$, except that $\phi_a^{\frak c}$ is regular at $y=0$ but does not necessarily vanish there.  \end{itemize}

To illustrate the strict Nahm pole boundary condition when $\frak c\not=0$, let us consider the extreme case $\varrho=0$, so that there is no Nahm pole and $\frak c
=\frak g$.  In this case, the strict Nahm pole boundary condition just means that $\phi_a$ is regular at $y=0$ while $\phi_y$ and $A_a$ are constrained to vanish.  This is
an elementary elliptic boundary condition on the KW equation, already formulated in eqn.\ (\ref{tively}) above.  For general $\varrho$, the strict Nahm pole boundary condition
is a sort of hybrid of this case with the opposite case of a principal embedding.  Of course, the well-posedness of the strict Nahm pole boundary
condition is elementary  at $\varrho=0$, while understanding it for $\varrho\not=0$ is the main goal of the present
paper.

Finally, we describe a generalized Nahm pole boundary condition  associated to 
a more general treatment of the $j_\sigma=\lambda=0$ modes.  For this, we pick an arbitrary subalgebra $\frak h\subset \frak c$, corresponding to a subgroup $H\subset C\subset G$, and we denote
as $\frak h^\perp$ the orthocomplement of $\frak h$ in $\frak c$ ($\frak h^\perp$ is a linear subspace of $\frak c$ but generically not a subalgebra).
Then, in addition to allowing only perturbations that are less singular than $1/y^{1/2}$,
 we declare that the $\frak h^\perp$-valued parts of $A_a$ and $\phi_y$ vanish at $y=0$, while the $\frak h$-valued part of these fields is unconstrained; and reciprocally,
we place no constraint on the $\frak h^\perp$-valued part of $\phi_a$, but require the $\frak h$-valued part of $\phi_a$ to vanish at $y=0$. 
  The strict Nahm pole
boundary condition is the case that $\frak h=0$.  To get the generalized Nahm pole boundary condition for 
$\frak h\not=0$, we relax the requirement that a gauge transformation should be trivial at $y=0$; instead, we allow gauge transformations that are $H$-valued at
$y=0$.  
  (For $G=SU(N)$, any $\varrho$, and some specific choices of $\frak h$,
this boundary condition can be realized via a combination of D-branes with an NS5-brane \cite{GW}.)
   For a simple illustration of this more general boundary condition, take $\varrho=0$ and
$\frak h=\frak c=\frak g$. Then the boundary condition is simply that $i^* \phi=0$.
 This is actually a second elementary elliptic boundary condition on the KW equations, which was formulated 
in eqn.\ (\ref{sively}).  We will show in section \ref{genebc} that the boundary condition described in this paragraph is
well-posed for all $\varrho$ and $\frak h$.


\subsection{The Boundary Terms And The Vanishing Theorem}\label{largey}
We can now easily show the vanishing of  the boundary terms at $y=0$ in the Weitzenbock-like formula (\ref{zoffbox}). 
(In doing this, we can ignore the spurious modes that can be removed by a gauge transformation -- the $\eta=0$ modes 
in (\ref{indrootstwo}). Since the boundary terms are gauge-invariant, they do not receive  a contribution from the spurious modes.)   

For example, let us first look at the boundary contribution $\int\d^3 x \,\epsilon_{abc} \Tr\, F_{ab}\phi_c$.  The dominant part of $\phi_c$ 
is the Nahm pole term $\tt_c/y$. To avoid a contribution involving this term, we need the  part of $F_{ab}$ that is valued in 
$\frak{su}(2)_\tt$ (and thus not orthogonal to the coefficient of this Nahm pole)  to vanish faster than $y$ for $y\to 0$.  
The relevant part of $F_{ab}$ is of order $y^2$ for $y\to 0$,  since for example the part of $F$ that is $\frak{su}(2)_\tt$-valued and  
linear in the connection $A$ is a $j_\sigma=1$ mode with an indicial root $j_\sigma+1=2$.  The part of $F$ that is quadratic in $A$ 
vanishes equally fast. (Note that since all of this appears in a boundary integral, we discard the component $F_{ay}$, which only vanishes like $y$.)
 So  the contribution to $\epsilon_{abc}\Tr\,F_{ab}\phi_c$ involving the Nahm pole in $\phi_c$ is of order $y^2\cdot y^{-1}=y$. 
We can also consider contributions to $\epsilon_{abc}\Tr \,F_{ab}\phi_c$ that come from fluctuations in $\phi_c$ around the Nahm 
pole solution (as well as fluctuations in the connection $A_a$).  As long as we do not consider modes with $j_\sigma=0$, all fluctuations 
in either $\phi_c$ or $A_a$ are controlled by strictly positive indicial roots, so the fluctuations vanish at $y=0$ and their contribution 
to $\epsilon_{abc}\Tr \,F_{ab}\phi_c$ vanishes.  The last case to consider is the case of $j_\sigma=0$ fluctuations in both $\phi_c$ 
and $A_a$.  The general boundary condition formulated in the last paragraph of section \ref{nonregular} ensures that the contributions 
of these fluctuations to $\epsilon_{abc}\Tr\,F_{ab}\phi_c$ vanishes, because $F_{ab}$ when restricted to $y=0$ is valued in a subalgebra 
$\frak h\subset\frak c$, while $\phi_c$ is valued in an orthogonal subspace $\frak h^\perp\subset \frak c$.  Thus the general construction 
with arbitrary $\varrho$, $\frak h$ ensures the vanishing of $\epsilon_{abc}\Tr\,F_{ab}\phi_c$ at $y=0$.

The other possible boundary term in the Weitzenbock formula at $y=0$  comes from the expression
 $\Delta$, defined in eqn.\ (\ref{mofobox}).  Here the integral we have to consider at $y=0$ is $\int \d^3x \Tr\, (\phi_a D_a\phi_y-\phi_y D_a\phi_a).$
Again, we first consider the Nahm pole contribution with $\phi_a=\tt_a/y$.  A contribution from this term is avoided for reasons similar to what we found in the
last paragraph.  Indeed, the only contribution to $\Tr\, (\phi_a D_a\phi_y-\phi_y D_a\phi_a)$ that is linear in fluctuations around the Nahm pole solution comes from the $j_\sigma=1$
part of $\phi_y$.  The corresponding indicial root is 2, so the relevant piece of $\phi_y$ vanishes as $y^2$, too quickly to contribute for $y\to 0$ even when multiplied
by the Nahm pole $\tt_a/y$.   Alternatively, we can consider contributions to $\Tr\,(\phi_a D_a\phi_y-\phi_y D_a\phi_a)$ that are bilinear in fluctuations around the
Nahm pole.  Here, for group-theoretic reasons, only modes with $j_\sigma>0$ are relevant.  Modes with $j_\sigma>0$ have indicial roots of at least 
3/2 for $a_a,\varphi_y$
or $1/2$ for $\varphi_a,a_y$, so an expression bilinear in
such  modes and linear in the Nahm pole part of
$\phi_a$ vanishes at least as fast as $y^{3/2}y^{1/2}\cdot y^{-1}\sim y$.  Finally,
we can consider contributions to $\Tr\, (\phi_a D_a\phi_y-\phi_y D_a\phi_a)$ that do not involve the Nahm pole part of $\phi_a$ at all.  Since all relevant indicial
roots are nonnegative, the only possible contribution come from the $j_\sigma=0$ modes for which the indicial root vanishes.  These contributions vanish for
much the same reason as in the last paragraph:  the restriction of $A_a$ and $\phi_y$ to $y=0$ is valued in a subalgebra $\frak h$, while the $j_\sigma=0$ part of
$\phi_a$ is valued in an orthogonal subspace $\frak h^\perp$.

To complete the proof of the uniqueness theorem for the Nahm pole solution,  we need to know that the surface terms in (\ref{zoffbox}) 
also vanish for $\vec x$ and/or $y$ going to $\infty$. Let $r=\sqrt{|\vec x|^2+y^2}$.  To ensure vanishing of the surface terms for 
$\vec x ,y\to\infty$, we need $\epsilon_{abc}\Tr\,F_{ab}\phi_c$ and $\Tr\, (\phi_i D_i\phi_j-\phi_j D_i\phi_i)$ to vanish at infinity 
faster than $1/r^3$.  For example, this is so if the deviation of $A$ and $\phi$ from the Nahm pole
solution $A=0$, $\phi=\tt\cdot \d \vec x/y$ vanishes at infinity faster than $1/r$ and the curvature $F$ and the covariant derivatives 
of $\phi$ vanish faster than $1/r^2$. For a solution of the KW equations with this property, the boundary terms for 
$\vec x,y\to\infty$ vanish, so if such a solution obeys the Nahm pole boundary condition, it actually is the Nahm pole solution.

\subsection{Behavior At Infinity}\label{zobot}

To decide if the uniqueness result stated in section \ref{largey} 
is strong enough to be useful, we need to know if the rate of approach to the Nahm pole solution 
that we had to assume
for $\vec x,y\to\infty$
 is natural.  The goal of the following analysis is to show that it is.  

We start with the same reasoning with which we began the analysis for $y\to 0$.  If a solution of the KW equations does approach
the Nahm pole solution for $r\to\infty$, then its leading deviation from that solution satisfies, at large $r$,
 the linear equation obtained by linearizing  around the Nahm pole solution.  We will show that 
 any solution of that linear equation that vanishes for $r\to\infty$ vanishes at least as fast as $1/r^2$ (and its derivative vanishes at least as
 fast as $1/r^3$).  This holds irrespective of what singularities the solution might have if continued in to small $r$ (where we do not assume
 the linearized KW equations to be valid).  Vanishing of the perturbations as $1/r^2$ for $r\to\infty$
  is more than was needed in section \ref{largey}.  

As before, we will write $a_i$ and $\varphi_i$ for the perturbations of $A_i$ and $\phi_i$ around the Nahm pole solution.
To explain the idea of the analysis, we first describe the simplest case, which is the behavior of $\varphi_y$.  The linearized KW equations
imply a linear equation for $\varphi_y$ independent of all other modes.  This perhaps surprising fact can be proved by taking a certain linear
combination of derivatives of the KW equations.  However, a quicker route is to go back to eqn.\ (\ref{zoffbo}).  At a solution of the KW
equations $\V_{ij}=\V^0=0$, the left hand side of (\ref{zoffbo}) is certainly stationary under variations of $A$ and $\phi$, so the right hand
side is also.  If we consider variations of $A$ and $\phi$ whose support is in the interior of $M$, the boundary term can be ignored
and therefore the functional $I$ is stationary at a solution of the KW equations.  In other words, the KW equations imply the Euler-Lagrange equations
$\delta I/\delta A=\delta I/\delta\phi=0$.  (This statement is part of the relation of the KW equations to
a four-dimensional supersymmetric gauge theory.)

It is straightforward to work out the Euler-Lagrange equation for
$\varphi_y$ from the explicit formula for the action $I$ in eqn.\ (\ref{baction}). A convenient way to do this is to expand the action in powers
of the fluctuations $a$ and $\varphi$, around the Nahm pole solution on $\R^4_+$.  There are no linear terms -- since the Nahm pole solution is a solution -- but there are quadratic terms.
The part of $I$ that is second order in the fluctuations and
has a nontrivial dependence on $\varphi_y$ is
\begin{equation}\label{udz}-\int \d^4x \Tr\left(\sum_i (\partial_i\varphi_y)^2+\sum_a [\phi_a,\varphi_y]^2\right).\end{equation}
Importantly, there are no terms that are bilinear in $\varphi_y$ and the other fluctuations $a$ and $\varphi_a$; that is why at the linearized
level one finds an equation that involves only $\varphi_y$ and not the other fields.  
This equation is just the Euler-Lagrange equation that arises in varying the functional (\ref{udz})
with respect to $\varphi_y$.  We write
\begin{equation}\label{tenso}\Delta=-\sum_{i=1}^4\partial^2_{x^i} \end{equation}
for the Laplacian on $\R_+^4$ (with the gauge connection $A$ taken to vanish, as in
the Nahm pole solution), and of course we set $\phi_a=\tt_a/y$.  The equation for $\varphi_y$ is
\begin{equation}\label{benso}\left(\Delta -\frac{1}{y^2}\sum_a[\tt_a,[\tt_a,\cdot]]\right)\varphi_y=0.   \end{equation}
In four dimensions, 
\begin{equation}\label{lenso}\Delta=-\frac{\partial^2}{\partial r^2}-\frac{3}{r}\frac{\partial}{\partial r}+\frac{\Delta_{S^3}}{r^2},\end{equation}
where $\Delta_{S^3}$ is the Laplacian on the three-sphere $r=1$.  Since we are working on the half-space $\R_+^4$ rather
than all of $\R^4$, we consider $\Delta_{S^3}$ as an operator defined on a hemisphere in $S^3$.  It is convenient
to introduce the polar angle $\psi$ where $y/r=\cos \psi$, so that $\psi=0$ along the positive $y$-axis where $\vec x=0$, and the hemisphere
is defined by $\psi\leq \pi/2$.  One has
\begin{equation}\label{dsthree}\Delta_{S^3}=-\frac{1}{\sin^2\psi}\partial_\psi \sin^2\psi \partial_\psi +\frac{1}{\sin^2\psi}\Delta_{S^2},\end{equation}
where $\Delta_{S^2}$ is the Laplacian on a unit two-sphere.
The boundary condition at $\psi=\pi/2$ is determined by the four-dimensional boundary condition
at $y=0$ and hence
can be read off from section \ref{nonregular}.  In our context, this generally means that $\varphi_y$ vanishes at $\psi=\pi/2$,
except possibly if $j_\sigma=0$, in which case $\varphi_y^{\frak h}$ is not required to vanish at $y=0$ or $\psi=\pi/2$.  (Rather,
the KW equation $D_y\phi_y+D_a\phi_a=0$, where $\phi_a^{\frak h}=0$ at $y=0$, and $A$ is $\frak h$-valued at $y=0$,
implies that $D_y\phi_y^{\frak h}=0$
at $y=0$, so for $\varphi_y^{\frak h}$, eqn.\ (\ref{benso}) should be supplemented with Neumann boundary conditions
at $y=0$.)  Actually, as we will see in a moment, for $j_\sigma>0$, there is a potential that enforces the vanishing of $\varphi_y$ at $\psi=\pi/2$.

To make (\ref{benso}) more explicit, we   replace $-\sum_a[\tt_a,[\tt_a,\cdot]]$ with $j_\sigma(j_\sigma+1)$,
where $j_\sigma$ is defined as in section \ref{group}.    The equation
for $\varphi_y$ becomes
\begin{equation}\label{enso}\left(-\frac{\partial^2}{\partial r^2}-\frac{3}{r}\frac{\partial}{\partial r}+\frac{W}{r^2}\right)\varphi_y=0,
\end{equation}
where 
\begin{equation}\label{tensox} W=\Delta_{S^3} + \frac{j_\sigma(j_\sigma+1)}{\cos^2\psi} = -\frac{1}{\sin^2\psi}\partial_\psi \sin^2\psi \partial_\psi +\frac{1}{\sin^2\psi}\Delta_{S^2}+  \frac{j_\sigma(j_\sigma+1)}{\cos^2\psi} . \end{equation}
$W$ is a self-adjoint operator on the hemisphere with a discrete and non-negative spectrum 
 (strictly positive except for $j_\sigma=0$
and  $\varphi_y\in\frak h$).  
Any solution of (\ref{enso}) is a linear combination of solutions of the form $\varphi_y=r^s f$, where $f$ is an eigenfunction of $W$,
obeying  $Wf=\gamma f$ for some $\gamma\geq0$, and   $s(s+2)-\gamma=0$ or
\begin{equation}\label{zom} s=-1\pm \sqrt{1+\gamma}.\end{equation}
Actually, the spectrum of the operator $W$ can be found in closed form.  In particular, for $j_\sigma>0$, the ground state (which is the unique
everywhere positive
eigenfunction) is $f=\cos^{j_\sigma+1} \psi$,
with eigenvalue $\gamma=(j_\sigma+1)(j_\sigma+3)$.  
So from (\ref{zom}), if  $s$ is negative -- as it must be if $\varphi_y$ is to vanish for $r\to\infty$ --  then $s=-3-j_\sigma$.  The perturbations thus decay for
large $r$ as $r^{-3-j_\sigma}$.   Thus for example
if $\varrho$ is principal so that $j_\sigma\geq 1$ for all modes, then in a solution that is asymptotic to the Nahm pole solution,
$\varphi_y$ vanishes for $r\to\infty$ as $1/r^4$.  

This analysis of the fluctuations is valid at large $r$ even for $y\to 0$, so we can
compare to our study of the indicial roots.  The wavefunction $\varphi_y=\cos^{j_\sigma+1}\psi/r^{j_\sigma+3}$  vanishes for $y\to 0$
as $y^{j_\sigma+1}$, in agreement with (\ref{indroots}), where the positive  indicial roots are $\lambda=j_\sigma+1$.  

As usual, for $j_\sigma=0$, there is more to say as there are actually two types of mode.  For $\varphi_y\in \frak h^\perp$,  $\varphi_y$ obeys Dirichlet boundary
conditions at $y=0$, and all the previous formulas are valid, including the asymptotic behavior $\varphi\sim 1/r^{3+j_\sigma}=1/r^3$.
But for $\varphi_y\in \frak h$, we want Neumann boundary conditions at $\psi=\pi/2$.  The lowest eigenvalue of $W$ is $\gamma=0$,
with eigenfunction 1, leading  to $s=-2$ and $\varphi_y\sim 1/r^2$. 

We have analyzed here a second order equation, not all of whose solutions are necessarily associated to solutions of the linearized KW equation, which is first order.
In practice, we need not explore this issue here in detail since all modes we have found decay more rapidly at infinity than was needed for the vanishing
argument of action \ref{largey}.  The same remarks apply in what follows.

Fluctuations in the other fields can be analyzed along the same lines.  For this, it is convenient to write a general formula for the expansion of the action
$I$ around the Nahm pole solution.  We write $I_2$ for the part of $I$ that is quadratic in the fluctuations $a,\varphi$, and compute that
\begin{equation}\label{monx} I_2=I_{2,0}+I_{2,1}+I_{2,2} \end{equation} with
\begin{align}\label{tonx}  I_{2,0}&=-\int \d^4x\,\Tr\left(\sum_{i,j}\left((\partial_i a_j)^2+(\partial_i\varphi_j )\right)^2+\frac{1}{y^2}\sum_{a,i}\left([\tt_a,a_i]^2+[\tt_a,\varphi_i]^2\right)\right)\cr
 I_{2,1} &=-\int \d^4 x \,\Tr \left(\frac{2}{y^2}\epsilon_{abc} [\tt_a,\varphi_b]\varphi_c]+\frac{4}{y^2}a_y[\tt_a,\varphi_a]
    \right) 
 \cr   I_{2,2}&= ~~\int \d^4x\, \Tr\left(\sum_i\partial_i a^i+\frac{1}{y}[\tt_a,\varphi_a]\right)^2=\int \d^4x\, \Tr\,S^2,  \end{align} 
 where the gauge condition (\ref{zurimo}) was $S=0$.   This illuminates one of the advantages of that gauge condition: because $I_{2,2}$ is
 homogeneous and quadratic in $S$, it is automatically stationary when  $S=0$  and hence
 does not contribute to the Euler-Lagrange equations.  This significantly simplifies the analysis.

Since the spatial part $a_a$ of the connection does not appear in $I_{2,1}$, it obeys an Euler-Lagrange equation that comes entirely from $I_{2,0}$. This
equation coincides with the equation for fluctuations of $\varphi_y$, which we have already analyzed.  This is in keeping with the fact that
$\varphi_y$ and $a_a$ have the same indicial roots, so their fluctuations must have the same behavior for $\psi\to \pi/2$.

The equation for fluctuations of $\varphi_a,a_y$ does receive a contribution from $I_{2,1}$.  This contribution, which only arises for $j_\sigma>0$ (since
$I_{2,1}=0$ for $j_\sigma=0$), slightly modifies
 the behavior of the perturbations for $r\to\infty$.  It can 
 be analyzed using methods similar to those that we used in computing the indicial roots.   
 
 For the same reason as in that analysis, the term in $I_{2,1}$ that involves $a_y$  contributes only for $\eta=0$.  
 For $\eta=\pm 1$, we only have to consider the term involving
$\epsilon_{abc} \Tr\,[\tt_a,\varphi_b]\varphi_c$ which we evaluate  using (\ref{exico}) and (\ref{mexico}), to find that
\begin{equation}\label{pilon}I_{2,1}=-\int \d^4 x \frac{1}{r^2\cos^2\psi}\Tr \,\phi_a \phi_a \cdot \begin{cases} -2j_\sigma & \eta=1\cr
              2(j_\sigma+1) & \eta=-1. \end{cases}\end{equation}
              The equation (\ref{enso}) is modified only by a shift in $W$,
              \begin{equation}\label{dosox}W\to W+\frac{1}{\cos^2\psi}\begin{cases} -2j_\sigma & \eta=1\cr 2(j_\sigma+1) &\eta=-1. \end{cases}\end{equation}
              This is equivalent to replacing $j_\sigma$ by $j_\sigma-\eta$ in the definition (\ref{tensox}) of $W$, so that the perturbations in $\phi_a$ with $\eta=\pm 1$
               vanish
              at infinity as $1/r^{3+j_\sigma-\eta}$.  The modes that decay most slowly              are those with $\eta=1$; they decay for $r\to\infty$
              as  $1/r^{2+j_\sigma}$ and for $\psi\to \pi/2$ as $\cos^{j_\sigma}\psi$.  The last statement is in accord with the value found in (\ref{indrootstwo})
              for the indicial root at $\eta=1$.  

 For $\eta=0$, we can express $\varphi_a$ in terms of a new field $u$ by
 $\varphi_a=[\tt_a,u]/\sqrt{j_\sigma(j_\sigma+1)}$  (recall that
 we can assume that $j_\sigma>0$, since otherwise the perturbation vanishes).  In terms of these variables, the Euler-Lagrange equation turns out to be
 \begin{equation}\label{zongo} \left( -\frac{\partial^2}{\partial r^2}-\frac{3}{r}\frac{\partial}{\partial r}+\frac{W}{r^2}+\frac{2}{r^2\cos^2\psi}M\right)\begin{pmatrix}
 u \cr a_y\end{pmatrix}=0,\end{equation}
 where the contribution of $I_{2,1}$ is the term proportional to 
 \begin{equation}\label{ofty}M =\begin{pmatrix} 1 & \sqrt{j_\sigma(j_\sigma+1) }\cr \sqrt{j_\sigma(j_\sigma+1)}&0\end{pmatrix}.\end{equation}
 The eigenvalues of $M$ are $j_\sigma+1$ and $-j_\sigma$.  Upon substituting one of these eigenvalues for $M$ in (\ref{zongo}), one gets precisely
 the same shifts of $W$ as described in eqn.\ (\ref{dosox}).  So the two modes with $\eta=0$ obey precisely the same equations as the two
 modes with $\eta=\pm 1$.  In particular, the mode that decays most slowly for $r\to\infty$ again decays as $1/r^{2+j_\sigma}$, while vanishing
 as $\cos^{j_\sigma}\psi$ for $\psi\to \pi/2$.  The last statement corresponds to the indicial root
 $\lambda=j_\sigma$ found at $\eta=0$ in (\ref{indrootstwo}).  
 
 
 
 Though we motivated this analysis by asking if the conditions needed to get a uniqueness theorem for the Nahm pole solution are reasonable,
the results are applicable more widely.  For example, we may be interested in a solution of the KW equations in which the Nahm pole
boundary condition is modified by inclusion of knots at $y=0$.  As long as the knots are compact, one can look for solutions of the KW equation
that coincide with the Nahm pole solution for $r\to \infty$.  Their rate of approach to that solution will be as we have just described.

We observed in section \ref{background} that the symbol $\sigma$ of the linearized KW equations is the symbol of the operator $D=\d+\d^*$ mapping odd
degree forms to even degree forms.  Let $D^\dagger$ be the adjoint of $D$ and let $\sigma^{\dagger}$ be the adjoint of $\sigma$.
Since $D^\dagger D$ is the Laplacian on odd degree differential forms, it follows that $\sigma^\dagger\sigma$ is the symbol of
the Laplacian.  This is reflected  in the above formulas: the fluctuations are annihilated by a second order differential operator that is
equal to the Laplacian plus corrections of lower order.

\subsection{Extension To Five Dimensions}\label{exfive} 

The four-dimensional KW equations are closely related to a certain system of elliptic differential equations in five dimensions \cite{haydys}, \cite{WittenK,WittenKtwo}
and this relationship is crucial in the application to Khovanov homology.

To explain the relationship, we first specialize the KW equations to a four-manifold of the form $M=W\times \I$, with $W$ an oriented 
three-manifold,  and
$\I$ an oriented one-manifold, possibly with boundary.  We endow  $M$ with a product metric $g_{ab}(x)\d x^a \d x^b+\d y^2$, where the $x^a$, $a=1,\dots,3$, parametrize $W$ and $y$ parametrizes $\I$, and as usual we expand
$\phi=\sum_a \phi_a \d x^a+\phi_y\d y$.  The KW equations have the property
that $\phi_y$ enters only in commutators -- either covariant derivatives $D_a\phi_y=[D_a,\phi_y]$, or commutators $[\phi_a,\phi_y]$ with other components
of $\phi$.  This enables us to do the following.  We replace the four-manifold $M$ by the five-manifold $Y=\R\times M=\R\times W\times \I$, where 
$\R$ is parametrized by a new
coordinate $x^0$.  Then wherever a commutator with $\phi_y$ appears in the KW equations, we simply replace it by a commutator with $D_0=D/Dx^0$.
So we replace $D_a\phi_y$ with $[D_a,D_0]=F_{a0}$, and $[\phi_a,\phi_y]$ with $[\phi_a,D_0]=-D_0\phi_a$.

In this way, we get some partial differential equations in five dimensions.  Most
of what we have said in this paper about the KW equations carries over to them.  For example,
the five-dimensional equations have  a Weitzenbock formula quite analogous to (\ref{zelg}).  
One simply has to replace $[\phi_y,\cdot]$ with $[D_0,\cdot]$ in the formula
for the action functional $I$ of equation (\ref{baction}).  This Weitzenbock formula can be used to prove that the five-dimensional equations
are elliptic for $t\not=0,\infty$.  (See eqn.\ (5.44) of \cite{WittenK} for the Weitzenbock formula at $t=1$.)  The proof of ellipticity 
in the interior amounts to showing that -- similarly to what 
was explained for the KW equations at the end of section \ref{zobot} --  if $\sigma$ is
the symbol of the five-dimensional equations, then $\sigma^\dagger\sigma$ is the symbol of the Laplacian (times the identity matrix) and in particular is invertible; hence $\sigma$
is invertible and the equations are elliptic.  

Though the equations are elliptic for generic $t$, something nice happens precisely for $t=1$ (or $t=-1$, which is equivalent to $t=1$ modulo $\phi\to -\phi$).   Just in this case,
the equations acquire four-dimensional symmetry.  From the way we described these equations, they are formulated on a five-manifold of the particular
form $Y=\R\times W\times \I$.  However, at $t=1$, there is more symmetry, a fact that is essential in the application to Khovanov homology.
  One can replace $\R\times W$ by a general oriented  Riemannian four-manifold $X$
with no additional structure, and formulate
the equations on\footnote{Still more generally, one can formulate these equations -- and they remain elliptic -- 
 on an arbitrary five-manifold $Y$ with an everywhere
non-zero vector field \cite{haydys}.}
 $Y=X\times \I$. We take on $Y$ a product metric
$\sum_{\mu,\nu=0}^3 g_{\mu\nu}\d x^\mu\d x^\nu+\d y^2$, where $x^\mu$, $\mu=0,\dots,3$ are local coordinates on $X$ and $\I$ is parametrized
by $y$.  The equations on $Y$ can be described
as follows.  Let $\Omega^{2,+}\to X$ be the bundle of self-dual two-forms, and using the natural projection $X\times \I\to X$, pull this bundle
back to a bundle over $Y=X\times \I$ that we also denote as $\Omega^{2,+}$.  
The fields appearing in the five-dimensional equations are a connection
$A$ on a $G$-bundle $E\to Y$, and a section $B$ of $\Omega^{2,+}(\ad(E))=\Omega^{2,+}\otimes \ad(E)$.   (For $X=\R\times W$, the relation between $B$ and the object
$\vec\phi=\sum_a\phi_a\d x^a$ that appears in the KW equations is $B_{0a}=\phi_a$, $B_{ab}=\epsilon_{abc}\phi_c$.)  The five-dimensional equations can be written
\begin{equation}\label{moniko}
\begin{split}F^+-  \frac{1}{4}B\times B-\frac{1}{2}D_y B &=0 \\
   F_{y\mu}+ D^\nu B_{\nu\mu}&=0.  \end{split}\end{equation}
Here $F^+$ is the orthogonal projection of the curvature $F$ onto the part valued in $\Omega^{2,+}(\ad(E))$, and $B\times B$ is defined
as follows.  Since $\Omega^{2,+}$ is a rank 3 real bundle with structure group $SO(3)$, there is a natural isomorphism\footnote{For a vector space $V$,
we denote the symmetric and antisymmetric parts of $V\otimes V$ as $\mathrm{Sym}^2V$ and $\wedge^2V$, respectively.}  $\wedge^2\Omega^{2,+}\cong
\Omega^{2,+}$.  By composing this with the Lie bracket $\wedge^2\frak g\to \frak g$, we get a natural map $\mathrm{Sym}^2\Omega^{2,+}(\ad(E))
\to \Omega^{2,+}(\ad(E))$.  The image of $B\otimes B$ under this map is what we call $B\times B$.  An explicit formula, viewing $B$ as a self-dual
two-form valued in $\ad(E)$, is
\begin{equation}\label{omen}(B\times B)_{\mu\nu}=\sum_{\sigma,\tau=0}^3 g^{\sigma\tau}[B_{\mu\sigma},B_{\nu\tau}]. \end{equation}

In view of all this, any solution of the KW equations on $W\times \R_+$ can be viewed as a ``time''-independent solution of the five-dimensional
equations on $\R\times W\times \R_+$ (where we identify $x^0$ as time, as is natural in the application to Khovanov homology), with 
$\phi_y$ reinterpreted as $A_0$.  In particular, the Nahm pole solution on $\R^3\times \R_+$ can be regarded
as a solution of the five-dimensional equations on $\R^4\times \R_+$.    The solution is simply \begin{equation}\label{ford} A=0,~~~B_{0a}=\tt_a/y,~~~
~B_{ab}=\epsilon_{abc}\tt_c/y.\end{equation}
Given the classical Nahm pole solution, we then ask if we can define a boundary condition on the five-dimensional equations by allowing only solutions
that are asymptotic for $y\to 0$ to the Nahm pole.  The first step is to compute the indicial roots.  These are precisely the same for the five-dimensional
equation as for the four-dimensional KW equations, since the indicial roots are defined in terms of solutions that depend only on $y$ and so in particular
are time-independent.  The only real difference between the computation of indicial roots in five dimensions and the four-dimensional computation described in
section \ref{throots} is that the five-dimensional interpretation, with $\phi_y$ reinterpreted as $A_0$, gives a better explanation of the symmetry of the equations
between $a_a$ and $\varphi_y$.  (This symmetry is visible in the formula (\ref{tonx}) for $I_2$, and accounts for the fact that in eqn.\ (\ref{indroots}), the indicial roots
for different values of $\eta$ are pairwise equal.)   Given the indicial roots, one can imitate the discussion in section \ref{nonregular} to define precisely
the Nahm pole boundary condition, and as in section \ref{largey} it follows that the boundary terms at $y=0$ in the Weitzenbock formula vanish.
The Nahm pole solution on $\R^4\times \R_+$ is therefore unique if one requires sufficiently fast convergence as $r=\sqrt{x^2+y^2}$ becomes large.
The analysis in section \ref{zobot} can be repeated to show that the expected rate of convergence at infinity of a solution that does converge to the Nahm
pole solution is fast enough to make the uniqueness result concerning the Nahm pole solution relevant.   Just a few modifications are needed.  In
equation (\ref{benso}), $\Delta$ should now be the five-dimensional Laplacian on a half-space, 
\begin{equation}\label{umongo}\Delta =-\frac{\partial^2}{\partial r^2}-\frac{4}{r}\frac{\partial}{\partial r}+\frac{\Delta_{S^4}}{r^2}. \end{equation}
We expand the fluctuation in the connection around the Nahm pole as $a=\sum_{s=0}^3 a_s\d x^s +a_y \d y$.  The equation obeyed by $a_s$ is now
\begin{equation}\label{tumongo}\left(-\frac{\partial^2}{\partial r^2}-\frac{4}{r}\frac{\partial}{\partial r}+\frac{W}{r^2}\right)a_s=0,~~s=0,\dots,3\end{equation}
where 
\begin{equation}\label{rumongo}W=\Delta_{S^4}+\frac{j_\sigma(j_\sigma+1)}{\cos^2\psi}=-\frac{1}{\sin^3\psi}\partial_\psi \sin^3\psi\partial_\psi+\frac{1}{\sin^2\psi}\Delta_{S^3}
+\frac{j_\sigma(j_\sigma+1)}{\cos^2\psi}. \end{equation}
The lowest eigenvalue of $W$ is now  $(j_\sigma+1)(j_\sigma+4)$, again with eigenfunction $\cos^{j_\sigma+1}\psi$, and now the fluctuations  decay as 
$r^{-4-j_\sigma}$ for $r\to\infty$, with precisely one extra power of $1/r$ compared to the four-dimensional case.
The corresponding formulas for $B$ and $a_y$ are similar to the analysis of $\varphi_a$ and $a_y$ in the four-dimensional case,
 and again, the fluctuations in five dimensions 
decay  with one extra power of $r$ compared to what we found in four dimensions.

\section{The Linearized Operator On A Half-Space}\label{third}
\subsection{Overview}\label{overview2}
A nonlinear partial differential equation is said to be elliptic if its linearization is elliptic.  An important property of a linear elliptic differential operator on
a closed manifold is that its kernel and cokernel are finite-dimensional.  

If a linear elliptic differential equation is considered on a manifold $M$ with a nonempty boundary, then it is necessary to impose some sort of boundary condition 
to make the problem similarly well posed. A boundary condition such that the accompanying problem has a finite dimensional kernel and cokernel, and so that in addition
solutions enjoy optimal regularity properties, is called an elliptic boundary condition. As before, for a nonlinear elliptic differential equation on a manifold $M$ 
with boundary, a choice of boundary condition is called elliptic if it (or its linearization if the boundary condition is also nonlinear) is an elliptic boundary
condition for the linearized operator. For standard nondegenerate elliptic operators, the theory of elliptic boundary conditions is now classical, and the criterion 
for ellipticity of a boundary condition (which involves both the interior and boundary operators) is called the Lopatinski-Schapiro condition. The linearized operator 
in our setting cannot be treated with this classical theory since its coefficients of order $0$ are singular at $y=0$. It is, however, a uniformly degenerate 
elliptic operator, as introduced in \cite{M-edge}. There is a suitable notion of ellipticity for boundary conditions in this setting as well, to which we shall be appealing here. 

As a way to motivate the definition of ellipticity of a given boundary condition, consider the model case where $M$ is the half-space $\R^n_+ = \{x^n\geq 0\}$.
If a linear differential operator on this half-space and a boundary condition on the boundary $\R^{n-1}$ are both invariant under rotations and translations 
in the boundary variables, then the kernel and cokernel of this boundary problem (amongst tempered solutions on $\R^n_+$) are finite-dimensional if and 
only if they are actually trivial. Conversely, a boundary condition with this property, and so that the  accompanying linear operator
as a map between appropriate Sobolev spaces has closed range, is elliptic.  We have stated  this formulation  for operators and boundary conditions 
with substantial symmetry; more generally, if $\L  $ is a general  linear elliptic operator with variable coefficients  and $B$ a possibly non-constant operator giving the boundary conditions, then we may apply 
this condition to the constant coefficient problem on $\R^n_+$ obtained by freezing the coefficients of $\L  $ and $B$ at $q \in \R^{n-1}$. 

These remarks are relevant to the Nahm pole boundary condition on the KW equations.  Our task now is to show that the linearization $\L  $ of the KW operator 
around a solution with Nahm pole boundary data on a four-manifold $M$ with boundary satisfies this ellipticity condition. By the remarks above, 
this is actually equivalent to proving the corresponding property for the linearization of the KW operator around the actual model Nahm pole solution 
on the half-space $\R^4_+$.  We shall explain in section \ref{analysis} how this fits into the analytic theory which justifies the main consequences 
of this paper, namely the regularity at $y = 0$ of more general solutions satisfying Nahm pole boundary conditions and the uniqueness theorem. 

Thus the aim of this section is to study the linearized KW operator on the half-space, and to show that it is an isomorphism on the space of $L^2$
fields which satisfy the Nahm pole boundary conditions.  As suggested above, this consists of two rather separate parts: one involves showing
that the kernel and cokernel of $\L  $ vanish, while the other requires showing that $\L  $ has closed range as a map between the appropriate
function spaces. We undertake  the first of these in the present section. Section \ref{vanishing} contains a proof that the kernel of $\L  $ vanishes. This turns
out to be a rather direct consequence of the formulas that were used in section \ref{second} to establish the uniqueness theorem. As for vanishing of 
the cokernel, a standard strategy, once the kernel is known to vanish, is to show, after reducing to an ODE via a Fourier transform, that the index of $\L  $ (defined as the difference 
in dimension between the kernel and cokernel) vanishes.   We do this in two essentially separate ways. The first involves some fairly elementary
algebraic considerations; see section \ref{index}.
The second is more direct (and much more useful in generalizations).  It  turns out, see section \ref{pseudo}, that the adjoint of $\L  $ is 
conjugate to $-\L  $, a property that we call pseudo skew-adjointness. This immediately gives an isomorphism between the kernel and 
cokernel of $\L  $, so the cokernel vanishes if the kernel does.  Finally, in section \ref{extension}, we show that these arguments carry over more or 
less immediately to the five-dimensional extension of the KW equations that is relevant to Khovanov homology.

The remaining task, to show that the range of $\L  $ is closed, turns out to follow using general machinery that will be explained in section \ref{analysis}.

\subsection{Vanishing Theorem For The Kernel}\label{vanishing}

The uniqueness theorem for the Nahm pole solution
on a half-space was deduced from an identity (\ref{zoffbox}) which reads schematically
\begin{equation}\label{terrfo}-\int \d^4x \,\Tr\,\sum_\lambda\V_\lambda^2 =-\int \d^4x \,\Tr\,\sum_\sigma \W_\sigma^2 ,\end{equation}
where we omit surface terms  since we have shown them to vanish in a solution of the KW equations that is asymptotic to the Nahm pole solution for $y\to 0$ and at infinity. The $\V_\lambda$ are the $\frak g$-valued quantities $\V_{ij}$ and $\V^0$ that appear on the left hand side
of (\ref{zoffbox}).  The $\W_\sigma$ are the objects  $F_{ij}$, $D_a\phi_b$, $D_i\phi_y$, $[\phi_y,\phi_a]$, and $W_a$ whose squares appear on the right hand
side of the definition (\ref{longsum}).    
If the KW equations $\V_\lambda=0$ are obeyed, then the identity (\ref{terrfo}) shows
that  the $\W_\sigma$ vanish, which implies that the solution is
constructed from a solution of Nahm's equations.

Now let us see what this formula tells us about the linearization of the KW equations about the Nahm pole solution.  Schematically, let us combine
the fields $A,\phi$ to an object $\Phi$ (one can think of $\Phi=A+\star\phi$ as an odd-degree differential form on $\R^4_+$ valued in $\mathrm{ad}(E)$).
We write $\Phi_0$ for the Nahm pole solution, and we consider a family of fields $\Phi_s=\Phi_0+s \Phi_1$, where $s$ is a parameter and $\Phi_1$ is a perturbation.  
Expanding the identity (\ref{terrfo}) in powers of $s$, the linear term vanishes because $\V_\lambda = \W_\sigma=0$ at $s=0$.  Taking the second derivative
with respect to $s$, terms such as $\V_\lambda \partial_s^2 \V_\lambda$ vanish at $s=0$ since $\V_\lambda=0$ at $s=0$.  So we get
\begin{equation}\label{terrf}-\int \d^4x \,\Tr\,\sum_\lambda\left(\frac{\partial\V_\lambda}{\partial s}\right)^2 =-\int \d^4x \,\Tr\,\sum_\sigma\left(\frac{\partial \W_\sigma}{\partial s}
\right)^2.\end{equation}
Hence the equations $\partial \V_\lambda/\partial s=0$ are satisfied if and only if the equations $\partial \W_\sigma/\partial s=0$ are satisfied.

The equations $\partial \V_\lambda/\partial s=0$ are the linearization of the KW equations around the Nahm pole solution.  In other words, these equations
are $\L  \Phi_1=0$, where $\L  $ is the linearization of the KW equations and $\Phi_1$ is the perturbation around the Nahm pole solution.

The equations $\partial \W_\sigma/\partial s=0$ imply that $\Phi_1$ actually vanishes if it vanishes at infinity.  For example, the equation $\partial_s F_{ij}=0$
implies that the fluctuation in the connection $A$ can be gauged away, and upon doing so, the equations $\partial_s(D_a\phi_b)=\partial_s(D_a\phi_y)=0$ imply
that the perturbation in $\phi$ is independent of $\vec x$ and so vanishes if it vanishes at infinity.  The other conditions $\partial_s\W_\sigma=0$ imply
that $\Phi_1$ actually comes from a solution of the linearization of Nahm's equation.  Of course, such a perturbation (or any perturbation that is independent of $\vec x$)
is not square-integrable in four dimensions.

Hence if the linearization $\L  $ of Nahm's equations is understood as an operator acting on a Hilbert space of square-integrable wavefunctions, its kernel vanishes.

\subsection{Index}\label{index}

Here we will sketch a standard strategy to prove that the cokernel of $\L  $ vanishes once one knows that the kernel vanishes.  We only provide a sketch
since in the particular case of the KW equations, there is a more powerful and direct  method that we explain in section \ref{pseudo}.  

First of all, using the translation symmetries of $\R^3=\partial(\R^4_+)$, we can look for a momentum eigenstate, that is a 
perturbation of the form $\Phi_1(\vec x,y)=e^{i\vec k \cdot \vec x}F(y)$
where $F$ depends on $y$ only and $\vec k$ is a real ``momentum'' vector.  $F(y)$ is a function on $\R_+$ with values in a finite-dimensional complex vector space $Y$.  Let $d=\dim\,Y$;
for the KW equations, 
$d=8\dim \frak g$.  To show that the cokernel of $\L  $ is trivial for square-integrable wavefunctions, it suffices to show that it vanishes for  momentum eigenstates with
$\vec k\not=0$.

On momentum eigenstates, the linearized KW equation $\LKW \Phi_1=0$ reduces to an equation $\L  _1(\vec k)F(y)=0$,  with
\begin{equation}\label{redy}\L  _1(\vec k)=\frac{d}{d y} + B(y,\vec k), \end{equation}
where $B(y,\vec k)$ is a self-adjoint matrix-valued function of $y$ and $\vec k$. In fact,
\begin{equation}\label{edy} B(y,\vec k)=\frac{B_0}{y}+B_1(\vec k), \end{equation}
where $B_0$ is a constant matrix (independent of $y$ and $\vec k$) and $B_1$ is independent of $y$ and homogeneous and linear in $\vec k$.  Actually, $B_0$
is the matrix whose eigenvalues are the indicial roots, which we computed in section \ref{throots}.  $B_1(\vec k)$ is the symbol of the operator $\d+\d^*$ on 
$\mathrm{ad}(E)$-valued
dfferential forms on $\R^3$ of all possible degrees; in other words, $B_1(\vec k)$ is the momentum space version of the $\d+\d^*$ operator. 

Let $\Y$ be the space of all solutions of the linear equation $\L  _1F(y)=0$ on $\R_+$, with no condition on the behavior near $y=0$ or $\infty$.  
We can identify $\Y$ with $Y$ by, for example, mapping a solution $F(y)\in \Y$ to its
value $F(1)\in Y$, so $\Y$ has dimension $d$.  Let $\Y_0$ be the subspace of $\Y$ consisting of solutions  that obey the Nahm pole boundary condition at $y=0$ (and
in particular are square-integrable near $y=0$),
and let $\Y_\infty$ be the subspace consisting of solutions that are square-integrable at infinity.  Also, let $d_0=\dim\,\Y_0$, $d_1=\dim\,\Y_1$.  
Finally, let $\Y^*$ be the space of solutions of (\ref{redy}) that obey the Nahm pole boundary condition at $y=0$, and in addition are square-integrable,
and set $d^*=\dim \,\Y^*$.  

$\Y^*$ is simply the intersection $\Y_0\cap\Y_\infty$ of the spaces of solutions that are well-behaved at 0 and at $\infty$.  So 
if $d_0+d_\infty-d\geq 0$ and the subspaces $\Y_0,\Y_\infty\subset \Y$ are generic, then the dimension of $\Y^*$ is $d^*=d_0+d_\infty-d$.  Even if these conditions
do not hold, the index of the operator $\L  _1$ is $d_0+d_\infty-d$.

In the case of the KW equations with Nahm pole boundary conditions, $d_0=d_\infty=d/2$ and therefore the index of $\L  _1$ is 0.  Hence if the kernel of $\L  _1$
vanishes -- as shown in section \ref{vanishing} -- then the cokernel also vanishes.   The fact that $d_0=d/2$ was explained in section \ref{nonregular}, basically as
a consequence of the fact that the indicial roots of $\varphi_a,a_y$ are the negatives of those of $a_a,\varphi_y$ (with some care when some roots vanish).
  Since $B(y,\vec k)$ can be approximated by $B_1(\vec k)$ for $y\to\infty$, solutions of $\L  _1F(y)=0$ that are square-integrable for $y\to \infty$ correspond
  to positive eigenvalues of $B_1(\vec k)$.  So to show that $d_\infty=d/2$, we must
show that $B_1(\vec k)$ has equal numbers of positive and negative eigenvalues.  This follows from the fact that $B_1(\vec k)$ is the symbol of the $\d+\d^*$ operator; its
square is $|\vec k|^2$, so its eigenvalues are $\pm |\vec k|$, and as it is traceless, precisely half of the eigenvalues are positive.
Alternatively, by rotation symmetry, the number of positive eigenvalues of $B_1(\vec k)$ is invariant under $\vec k\to -\vec k$; but since $B_1(-\vec k)=-B_1(\vec k)$,
it has equally many positive and negative eigenvalues.

We have omitted various details here, 
since we turn next to a more direct (and much more widely applicable) proof of the vanishing of the cokernel of the linearized KW operator $\LKW$.  
There are two specific reasons to have included the above material.
First, this explains why the counting of positive 
indicial roots in section \ref{nonregular} is important.  Second, even without a direct calculation of the index of the operator $\L  _1$,
the fact that the problem can be formulated in terms of the vanishing of
the cokernel of this 1-dimensional operator will make it easy to go from 4 to 5 dimensions in section \ref{extension}.

\subsection{Pseudo Skew-Adjointness}\label{pseudo}

Inspection of the equations (\ref{lembo}) and (\ref{wembo}) that determine the indicial roots shows that these roots (in the gauge (\ref{zurimo}), which we assume in what
follows) are odd under exchange of $a_a,\varphi_y$ with $\varphi_a,a_y$.  We make this exchange via the linear transformation
\begin{align}\label{roggo}N\begin{pmatrix}a_a \cr \varphi_y\end{pmatrix}&=\begin{pmatrix} \varphi_a \cr a_y \end{pmatrix} \cr
   N\begin{pmatrix}  \varphi_a \cr a_y\end{pmatrix}&=-\begin{pmatrix} a_a \cr \varphi_y \end{pmatrix}.\end{align}
   The minus sign in the second line does not affect what we have said so far, but will be important shortly.  Taking this minus sign into account, we have
   \begin{equation}\label{donzott}N^2=-1,~~~~N^\dagger=-N ,\end{equation}
   where $N^\dagger$ is the transpose of $N$ in the usual basis given by $a_i$ and $\varphi_i$, or more invariantly the 
   adjoint of $N$ with respect to the quadratic form
   \begin{equation}\label{elbo} -\Tr\,\sum_{i=1}^4\left( a_i^2+\varphi_i^2\right).\end{equation}
      
   Perturbations of the Nahm pole solution that depend only on $y$ are governed by an equation that we schematically write
   $\L  _1(0)\Phi=0$, where $\Phi$ combines all the fields and
   \begin{equation}\label{zorbo}\L  _1(0)=\frac{\d}{\d y}+\frac{B_0}{y} \end{equation}
   is obtained from $\L  _1(\vec k)$ (eqn.\ (\ref{redy})) by setting $\vec k=0$.  The matrix $B_0$ can be read off from (\ref{lembo}) and (\ref{wembo}) (which are derived from the equation $\L  _1(0)\Phi=0$
   by replacing $\d/\d y$ with $\lambda/y$), and by inspection we see that $B_0$ is a  real symmetric matrix in the usual basis, or in other words is real and self-adjoint
   for the quadratic form (\ref{elbo}).  On the other hand, $\d/\d y$ is skew-adjoint.  The adjoint of $\L  _1(0)$ is thus
   \begin{equation}\label{morbo} \L  _1(0)^\dagger=-\frac{\d}{\d y} +\frac{B_0}{y}.\end{equation}  Since the indicial roots are the eigenvalues of $-B_0$,
   the statement that the matrix $N$ reverses the sign of the indicial roots is equivalent to $N B_0=-B_0N$.  We can combine this with
   (\ref{morbo}) as the statement that
   \begin{equation}\label{orbo} \L  _1(0)^\dagger=- N \L  _1(0)N^{-1}. \end{equation}
    
    So far we have just reformulated the symmetry that changes the sign of the indicial roots.  It turns out, however, that (\ref{orbo}) holds without change
    for $\vec k\not=0$:
    \begin{equation}\label{porbo}\L  _1(\vec k)^\dagger = -N\L  _1(\vec k)N^{-1}. \end{equation}
    Once one knows that the kernel of $\L  _1(\vec k)$ is trivial, it immediately follows from (\ref{porbo}) that the cokernel of this operator is also trivial.
    Indeed, the cokernel of $\L  _1(\vec k)$ is the kernel of $\L  _1(\vec k)^\dagger$, but (\ref{porbo}) implies that the kernel of $\L  _1(\vec k)^\dagger$ is obtained
    by acting with $N$ on the kernel of $\L  _1(\vec k)$.
    
    Since eqn.\ (\ref{porbo}) holds for any $\vec k$, this statement can be formulated without introducing momentum eigenstates.  If $\L  $ is the linearization of the KW equations
    around the Nahm pole solution, then
    \begin{equation}\label{homebo}\L  ^\dagger =-N \L   N^{-1}, \end{equation}
    a property that we describe by saying that $\L  $ is pseudo skew-adjoint. 
    We can write $\L  =\partial_y +B$, where $B$ is a self-adjoint\footnote{Self-adjointness of $B$ is not hard to verify by inspection, and is clear in the relation \cite{WittenKtwo} 
    of the KW equations on $W\times \I$, for a one-manifold $\I$, to gradient
    flow equations for the complex Chern-Simons functional on $W$.  Linearization of the gradient flow equation for any Morse function $h$ on a Riemannian manifold $X$
    always produces
    a differential operator $\d/\d y+B$, where $B$ (which is derived from the matrix of second derivatives of the function $h$ and the metric of $X$) is self-adjoint.  In the present example, $X$ is
    essentially the space of complex-valued connections on the bundle $E_\C\to W$, where $E_\C$ is the complexification of $E$, and $h$ is the imaginary 
    part of the Chern-Simons
    functional of such a connection.} first-order differential operator that contains derivatives only along $W$. Then $\L  ^\dagger=-\partial_y+B$
    and (\ref{homebo}) amounts to the statement that
    \begin{equation}\label{zomebo} N BN^{-1}=-B. \end{equation}
   Another equivalent statement is that $\t \L  =N\L  $ is actually self-adjoint.
   
    These assertions hold in much greater generality than perturbing around the Nahm pole solution on $\R^3\times \R_+$.  They hold, as we will see, in perturbing
    around any solution of the KW equations on $W\times \I$ for any oriented three-manifold $W$ and one-manifold $\I$ (endowed with a product metric
    $g_{ab}\d x^a \d x^b+\d y^2$), provided only that $\phi_y$ (which as usual is the component of $\phi$ in the $\I$ direction) vanishes.     
      
    This claim can be verified by inspection of the linearized KW equations.  In doing this, to minimize clutter,
    we write simply $A, \phi$ (rather than $A_{(0)}, \phi_{(0)}$ as in section
    \ref{background}) for a solution of the KW equations about which we wish to perturb.  As usual, we  denote the perturbations about this solution
     as $a,\varphi$, so we consider the condition that $A+s a, \phi+s\varphi$ obeys the KW equations to first order in the small parameter $s$.  The symbol $D_i$ will
    denote a covariant derivative defined using the unperturbed connection $A$ (and the Levi-Civita connection of $W$ if $W$ is not flat).  As already explained,
    we assume that the solution about which we expand obeys $\phi_y=0$, and we describe the background in the gauge $A_y=0$.  However, the gauge condition
    that we impose on the fluctuations is that of eqn.\ (\ref{zurimo}):
    \begin{equation}\label{consoo} D_i a^i+[\phi_a,\varphi^a]=0. \end{equation}
    Given that $A_y=0$, this is equivalent to
    \begin{equation}\label{bonso} \frac{\partial a_y}{\partial y} + D_a a^a+[\phi_a,\varphi^a]=0. \end{equation}
    Now let us compare this gauge condition to the linearization of one of the KW equations, namely the condition $D_i\phi^i=0$.  With $A_y=\phi_y=0$, the linearization
    of this equation gives
    \begin{equation}\label{conso}\frac{\partial \varphi_y}{\partial y} + D_a\varphi^a -[\phi_a,a^a]=0. \end{equation}
    When we transform $a$ and $\varphi$ via (\ref{roggo}), these two equations are exchanged except that the signs are reversed
    for all terms not proportional to $\partial_y$, as predicted in eqn.\ (\ref{zomebo}).
    
     
 The other KW equations $F_{ij}-[\phi_i,\phi_j]+\epsilon_{ijkl}D^k\phi^l=0$ behave similarly.  We  write the linearization of 
 these equations in detail\footnote{Our orientation convention
 is such that the antisymmetric
 tensors $\epsilon_{ijkl}$ and $\epsilon_{abc}$ obey $\epsilon_{abcy}=\epsilon_{abc}=-\epsilon_{yabc}$. }  in a way adapted to the split $M=W\times \I$:
 \begin{align}\label{tellme}\partial_y a_a-D_a a_y-[\varphi_y,\phi_a]-\epsilon_{abc}D^b\varphi^c-\epsilon_{abc}[a^b,\phi^c] & = 0 \cr
 \partial_y\varphi_a+[a_y,\phi_a]-D_a\varphi_y-\epsilon_{abc}D^b a^c+\epsilon_{abc}[\phi^b,\varphi^c] &=0. \end{align}
   Again  when we transform $a$ and $\varphi$ via (\ref{roggo}), these two equations are exchanged except that the signs are reversed
    for all terms not proportional to $\partial_y$.                                      

\subsection{Extension To Five Dimensions}\label{extension}

As explained in section \ref{exfive}, the Nahm pole solution can also be used to define a boundary condition on certain elliptic differential equations in five
dimensions that are expected to be relevant to Khovanov homology.  We simply replace $\R^3\times \R_+$ by $\R\times \R^3\times\R_+$, where the first
factor is parametrized by a new ``time'' coordinate $x^0$.  We
reinterpret $\phi_y$ as the component $A_0$ of the connection in the $x^0$ direction, and replace $[\phi_y,\,\cdot\,]$ with $D/D x^0$.  
The equations acquire a rotation symmetry
in $\R^4=\R\times \R^3$.

For the Nahm pole boundary condition in five dimensions to be elliptic,  the linearization $\h \L  $ of the five-dimensional equations
around the Nahm pole solution must have trivial kernel and cokernel.  Using the translation symmetries of $\R^4$, we can consider momentum eigenstates,
proportional to $\exp\left(i\sum_{j=0}^3 k_jx^j\right)$ with a real four-vector $k=(k_0,\dots,k_3)$.  Acting on wavefunctions of this kind, $\h \L  $ becomes a 1-dimensional operator
$\h \L  _1(k)$, acting on functions that depend only on $y$, and it suffices to show that for $k\not=0$, $\h \L  _1(k)$ has trivial kernel and cokernel.  

Using the rotation symmetries of $\R^4$, we can assume that the ``time'' component $k_0$ of $k$ vanishes.  In that case, we are dealing with a time-independent perturbation.
By definition, the five-dimensional equations reduce to the KW equations in the time-independent case (with $A_0$ interpreted as $\phi_y$), so for $k_0=0$,
$\h \L  _1(k)$ coincides precisely with the
corresponding operator $\L  _1(\vec k)$ of the four-dimensional poblem.  
But we already know that the kernel and cokernel of $\L  _1(\vec k)$ vanish;
the kernel vanishes by the vanishing result of section \ref{vanishing}, and the cokernel vanishes because of pseudo skew-adjointness.  So in expanding around the
Nahm pole solution in five dimensions, the kernel and cokernel of $\hat \L  $ vanish, as we aimed to show.





\section{The Nahm Pole Boundary Condition On A Four-Manifold}\label{fourmanifold}

So far, we have described the Nahm pole boundary condition for certain four-  or five-dimensional equations 
on a half-space $\R^4_+$ or $\R^5_+$.  The purpose of the present
section is to explore the Nahm pole boundary condition on a general manifold with boundary.  
In section \ref{induced}, we formulate the Nahm pole boundary condition for the KW equation on an oriented
 four-manifold $M$ with boundary $W$.
 The five-dimensional case is similar but will not be described
here.  


Once the KW equation with
Nahm pole boundary condition is defined on a four-manifold with boundary, one can inquire about the index of the linearization $\L$
of this equation. Assuming certain foundational results that we postpone to section \ref{analysis} (such as the fact that $\L$ is Fredholm),
 a simple formal computation that we present in section \ref{indexcalc} determines this index.
The analogous index problem on a five-manifold with boundary will not be treated in the present paper.
The index of an elliptic operator on a five-manifold without boundary is always 0, but this is not necessarily the case on a five-manifold with boundary.  

\subsection{Boundary Conditions on the Connection}\label{induced}

For a homomorphism $\varrho:\frak{su}(2)\to \frak g$, let us say that $\varrho$ is quasiregular if $j_\sigma=0$ does
 not occur in the decomposition of $\frak g$  or equivalently if the commutant $C$ is a finite group.  (This is so if $\varrho$ is principal; for additional examples see Appendix \ref{groups}.)
 On a half-space, for quasiregular $\varrho$,
 the Nahm pole boundary condition on the KW equations implies  that the connection $A$ vanishes along the boundary, since
 the relevant indicial roots are strictly positive.



More generally, on any four-manifold $M$ with boundary $W=\del M$, 
the leading order behavior of the connection $A$ along $W$ is
coupled by the KW equations to the leading order behavior of $\phi$. In particular, if ${\KW}(A,\phi) = 0$ and
$\phi$ and $A$ have expansions 
$\phi = y^{-1}(\sum \frak t_a \d x^a) + \dots$, $A = A_{(0)} + \dots$ near the boundary, then for quasiregular
$\varrho$,  the restriction $A_{(0)}$ of the connection  to 
$W$ is uniquely determined, as we will explain. In expanding the solution near $y=0$ and analyzing $A_{(0)}$, we 
 implicitly use the regularity theorem of section \ref{nonlinreg}, that solutions $(A,\phi)$ have asymptotic
expansions as $y \to 0$. In the calculations below we only use the first few terms of this expansion.
The KW equations determine an entire sequence of relationships between the higher coefficients in the expansion of $\phi$ and $A$, with a certain 
number of these left undetermined because of the gauge freedom. However, we focus
here on the leading order relationships, which signify the rigidity of the Nahm pole boundary condition. 

The main subtlety is to understand the generalization of the formula $\phi=\sum_a\frak t_a\d x^a/y+\dots$ to the case that
the boundary manifold $W$ is not flat.  For this, 
we view $\phi$ as a section of the bundle $\mathrm{Hom}(TW, \ad(E))$.  For a point $\vec x\in W$, 
let $\{e_a\}$ be any orthonormal basis of $T_{\vec x}W$.
Suppose that the leading term in the expansion of $\phi$ is  of order $y^{-1}$.  This leading term must be $\sum_a \frak t_a e_a^*/y$
for some $\frak t_a\in {\mathrm{ad}}(E)_{\vec x}$, and the $y^{-2}$ term in the first of eqns. (\ref{kwe}) below implies that the $\frak t_a$
satisfy the commutation relations of $\frak {su}(2)$.  The classification of $\frak{su}(2)$ subalgebras of $\frak g$ up to conjugacy is discrete
and hence the conjugacy class of $\frak t_a$ is independent of $\vec x$; this is the conjugacy class of some homomorphism $\varrho:\frak{su}(2)\to
\frak g$.  It also follows from the theory of $\frak{su}(2)$ that $\phi_{\varrho}=\sum_a \frak t_a e_a^*$, viewed as a homomorphism from $T_{\vec x}W$ to
the subspace of $\mathrm{ad}(E)_{\vec x}$ spanned by the $\frak t_a$, is an isometry.  
 For $G ={SO}(3)$ or ${SU}(2)$, assuming that $\varrho\not=0$,
 the $\frak t_a$ span all of $\mathrm{ad}(E)$ and we have learned that the polar
 part of $\phi$ determines an isomorphism between $\mathrm{ad}(E)$ and $TW$.  (We assume that $\varrho\not=0$ to avoid many
 exceptions in the following remarks, but the discussion below of the non-quasiregular case applies in particular to $\varrho=0$.)
 
  For $G={SO}(3)$, a knowledge of
 $\mathrm{ad}(E)$ is equivalent to a knowledge of the principal bundle $E$.  For $G=SU(2)$, this is not quite true; the possible
 choices of $E$ -- once the identification of $\mathrm{ad}(E)$ with $TW$ is known -- correspond to spin structures on $W$.
 For $G$ of higher rank, the full story is more complicated, and includes the possibility of twisting by a $C$-bundle,
 where $C$ is the commutant of $\varrho(\frak{su}(2))$ in $G$.  The possibility of this twisting will be reflected in eqn.\ (\ref{zub}) below.
 
We henceforth fix $\phi_{\varrho}$ and consider any solution pair $(A,\phi)$ with Nahm pole given by $\phi_\varrho=\sum_a \frak t_a e_a^*$. 
We assume that both $\phi$ and $A$ are  polyhomogeneous (this will be proved in section \ref{nonlinreg}),
where $\phi$ has leading term $\phi_{(0)} = y^{-1} \phi_{\varrho}$ and $A$ has leading term $A_{(0)}$. 
Insert the expansions for $A$ and $\phi$ into the two equations in \eqref{zobo} and collect the terms with like powers. 
We discuss the coefficients of the powers $y^{-2}$ and $y^{-1}$ in turn.
We first discuss the quasiregular case, which means that 
\begin{equation}
\phi \sim y^{-1}\phi_{\varrho} + y\varphi_1 + \ldots, \qquad A \sim A_{(0)} + y a_1 + \ldots.
\end{equation}
We compute
\begin{equation}
\begin{split}
F_A &= \mathcal O(1), \\ 
\phi \wedge \phi & = y^{-2} \phi_{\varrho} \wedge \phi_{\varrho} + \mathcal O(1), \\ 
\star \d_A \phi & = - y^{-2} \star (\d y \wedge \phi_{\varrho}) + y^{-1} \star \d_{A_{(0)}} \phi_{\varrho} + \mathcal O(1),  \\
\d_A \star \phi & = - y^{-2} \d y \wedge \star \phi_{\varrho} + y^{-1} \d_{A_{(0)}}(\star \phi_\varrho)+ \mathcal O(1), 
\end{split}
\end{equation}
so the KW equations become 
\begin{equation}\label{kwe}
\begin{split}
- y^{-2}( \star \d y \wedge \phi_\varrho + \phi_\varrho \wedge \phi_\varrho) + y^{-1} (\star \d_{A_{(0)}} \phi_\varrho) 
+ \ldots & = 0 \\ - y^{-2} \d y \wedge \star \phi_{\varrho} + y^{-1} \d_{A_{(0)}}(\star \phi_\varrho) + \ldots & = 0.
\end{split} 
\end{equation}
The gauge condition \eqref{elob} does not include any terms with $y^{-2}$ or $y^{-1}$. The coefficient of $y^{-2}$ in the 
first of eqns. (\ref{kwe}) is just Nahm's equation, forcing the $\frak t_a$ to generate an $\frak{su}(2)$ subalgebra of $\mathrm{ad}(E)$,
 while in the second, $\star \phi_{\varrho}$ already contains a $\d y$,
so both terms vanish. 

The coefficients of $y^{-1}$ reduce to
\begin{equation}
i)\ \d_{A_{(0)}} \phi_\varrho = 0, \qquad \mbox{and}\quad ii)\ \d_{A_{(0)}} \star \phi_{\varrho} = 0 
\label{harmonicphi}
\end{equation}
Since  $\star \phi_\varrho$ along $W$ is proportional to $\d y$,  eqn.\ $ii)$ involves only tangential derivatives and does not
involve the $ y$ component $A_{(0)}$. Equation $i)$, on the other hand, may have a $\d y$ term, but let us first 
examine its pullback to $W$.  This restricted equation implies that $\phi_\varrho$ 
intertwines the Levi-Civita connection on $TW$ and the connection $A_{(0)}$ on $\ad(E)$. Indeed, this equation shows
that the part of this connection induced on the image of $\phi_\varrho$ is torsion-free, and since it is a $\frak g$ connection, 
it is also compatible with the Killing metric on $\ad(E)$. Hence its pullback to $TW$ must be the Levi-Civita connection:  
i.e.\ in terms of the orthonormal frame $e_a$, 
\begin{equation*}
\phi_{\varrho}\left( \nabla_{e_a} e_b \right) = \nabla_{e_a} \left(\phi_\varrho(e_b)\right)
\end{equation*}
for all $a, b$. Equivalently, with respect to the product connection on $T^*W \times \ad(E)$, $\nabla \phi_{\varrho} = 0$. 
The second equation in \eqref{harmonicphi} is then automatically satisfied.   eqn.\ $i)$ further implies that $A_{(0)}$ is 
valued in $\varrho(TW)\subset \mathrm{ad}(E)$; its projection onto the orthocomplement of this space vanishes.  Thus,
if $\varrho$ is quasiregular or equivalently if the commutant $C$ is a finite group, the restriction of
 $\mathrm{ad}(E)$ to $W$ and its connection $A_{(0)}$    are uniquely determined  locally in terms of $TW$ with its Levi-Civita connection.
(Globally, depending on $C$,  there may be some discrete choices that generalize
the choice of a spin structure for $G=SU(2)$.)

The discussion up to this point is independent of how $\phi_\varrho$ or $A_{(0)}$ is extended into $M$. The $\d y$ component 
of eqn.\ $i)$ in \eqref{harmonicphi} states that $\nabla^{A_{(0)}}_{\del_y} \phi_\varrho = 0$ at $y=0$.  This is not only a gauge-invariant
condition, but it is also independent of the extension of $A_{(0)}$ into the interior.  In particular, if we choose the gauge so that $(A_{(0)})_y = 0$,
then $\del_y \phi_\varrho = 0$ (which vindicates the fact that we have omitted the $y^0$ term in the expansion for $\phi$). 
In any case, the normal derivative of $\phi_\varrho$ at $W$ is pure gauge. The remaining coefficients in the expansions of $A$ 
and $\phi$ are then determined by these leading coefficients 
and the successive equalities determined by the vanishing of the coefficients of each $y^\lambda$. However, it is increasingly hard 
to extract information from the higher terms; even the coefficients of $y^0$ are not so easy to interpret. 

Finally, consider the non-quasiregular case.  Let $C$, with Lie algebra $\frak c$,  be the
commutant in $G$ of $\varrho(\frak{su}(2))$. The KW equations
would allow the above description of $\phi$ and $A$ to be modified by $\frak c$-valued terms that would be $\O(1)$ for $y\to 0$.
However, as in section \ref{gencase}, we pick an arbitrary subgroup $H\subset C$, with Lie algebra $\frak h$, and we write $\frak h^\perp$
for the orthocomplement of $\frak h$ in $\frak c$.  Then 
we restrict the expansion to take the form
\begin{equation}\label{zub}
\phi \sim y^{-1}\phi_{\varrho} +  \varphi_0 + \ldots, \qquad A \sim A_{(0)} + a_0 + \ldots,
\end{equation}
where $(\varphi_0)_a \in \frak h^\perp$ and $(\varphi_0)_y, a_a \in \frak h$, and $\phi_{\varrho}$, $A_{(0)}$ are as above.
(In general, in the non-quasiregular case, the next term in the expansion is of order $y^{1/2}$.)  In this expansion, we have set to
0  the $\frak h^\perp$-valued part of $a_a, \,(\varphi_0)_y$ and the $\frak h$-valued part of $(\varphi_0)_a$,  and
then, in an appropriate global setting, the KW equations will determine globally the $\frak h$-valued part of $a_a,\,(\varphi_0)_a$
and the $\frak h^\perp$-valued part of $(\varphi_0)_a$.  The justification for this assertion is provided in section \ref{analysis}, where we show that the boundary problem just stated
is well-posed.


Calculating the first few terms in the expansions of $F_A$, $\phi \wedge \phi$, $\star \d_A \phi$ and $\d_A \star \phi$ as before,
we see that the coefficient of $1/y^2$ in ${\KW}(A,\phi)$ vanishes just as before. The $y^{-1}$ coefficient in the term $\phi \wedge \phi$ now
equals $\phi_\varrho \wedge \varphi_0$. This involves terms of the form 
$[\frak t_a, (\varphi_0)_b]$ or $[\frak t_a, (\varphi_0)_y]$, and these vanish since 
$\varphi_0$ is valued in the commutant $ \frak c$ of $\varrho(\frak s \frak u(2))$. Similarly, $A_{(0)}$ must be replaced by $A_{(0)} + a_0$
in each of the two equations in \eqref{harmonicphi}, but 
again this does not modify the above considerations, since $a_0$ is valued in $\frak c$.  



\subsection{The Index}\label{indexcalc}
Here, assuming foundational results proved in section \ref{analysis}, we calculate the index of the linearization $\LKW$ of the KW equations.
We do this first on a closed four-manifold, and then on a compact
four-manifold with boundary, with arbitrary Nahm pole boundary conditions. The first case is included 
simply to isolate the contribution from the interior topology of $M$. The computation in the second
case relies on a short argument to show that the index is actually independent of the choice of Nahm pole
boundary condition, or in other words, of the representation $\varrho$. This reduces the computation
to one for the special case $\varrho = 0$, where the computation reduces to a well-known one.

\begin{prop}
Let $(M^4,g)$ be closed, and suppose that ${\KW}(A_{(0)} ,\phi_{(0)}) = 0$. Writing ${\LKW}$ for the linearization of $\KW$ at 
this solution, then 
\begin{equation*}
\mathrm{ind} ({\LKW}) = - (\dim \frak g ) \, \chi(M).
\end{equation*}
\label{index1}
\end{prop}
We have already remarked in section \ref{background} that the symbol of $\LKW$ is the same as that of the twisted 
Gauss-Bonnet operator $(\d + \d^*) \otimes \mathrm{Id}_{\ad(E)} : \wedge^{\mathrm{odd}}M \otimes \ad(E) \to 
\wedge^{\mathrm{even}}M \otimes \ad(E)$. The formula here follows directly from the fact that the 
index of $\d + \d^*$, acting from even forms to odd forms, equals $\chi(M)$, the Euler characteristic of $M$. (Twisting by $E$ does
not affact the index of the twisted Gauss-Bonnet operator even
if $E$ is topologically non-trivial.)

\begin{prop}
Let $(M^4,g)$ be a manifold with boundary, with $g$ cylindrical near $\del M$. 
Then fixing the Nahm pole boundary conditions at $\del M$
with $\varrho = 0$ and $\frak h = \{0\}$, the index of the linearization about any solution is given by
\begin{equation*}
\mathrm{ind}({\LKW}) = - (\dim \frak g) \, \chi(M). 
\end{equation*}
\label{index2}
\end{prop}
This choice of Nahm pole condition is the same as the absolute boundary condition for $\d + \d^*$.
This is again a classical formula.  We could equally well have chosen $\frak h = \frak g$, corresponding
to relative boundary conditions for the Gauss-Bonnet operator, in which case the index equals $- (\dim \frak g) \, \chi(M, \del M)$,
but by Poincar\'e duality, $\chi(M, \del M) = \chi(M)$. This is a special case of the next result, 
which is the main one of this section.

\begin{prop}
Let $(M^4,g)$ be an arbitrary compact manifold with boundary, with $g$ cylindrical near $\del M$, and fix any choice of Nahm pole boundary
condition $\varrho$ at $W = \del M$. Then once again
\begin{equation*}
\mathrm{ind}({\LKW}) = - (\dim \frak g) \, \chi(M). 
\end{equation*}
\label{index3}
\end{prop}
We prove this in two steps. First consider the special case where $M = W \times I$ with a product metric, and with Nahm pole 
boundary condition given by any $\varrho$ at $y = 0$ and with trivial Nahm pole boundary condition ($\varrho = 0$, 
$\frak h = 0$) at $y = 1$. We see immediately, using the pseudo skew-hermitian property of $\LKW$ in this product setting,
that the index vanishes. 

Now let $M$ and $\varrho$ be arbitrary and denote by ${\LKW}_\varrho$ the linearized KW operator
about any solution satisfying the Nahm pole boundary condition associated to $\varrho$, and similarly let
${\LKW}_{\mathrm{rel}}$ denote the linearized KW operator relative to $\varrho = 0$ and $\frak h = \frak g$,
i.e.\ with relative boundary conditions. We apply a standard excision theorem for the index, for example \cite[Prop 10.4]{BBW}, 
which shows that 
\begin{equation*}
\mathrm{ind}({\LKW}_\varrho) - \mathrm{ind}({\LKW}_{\mathrm{rel}}) = \mathrm{ind}({\LKW}_{\varrho, \mathrm{rel}}),
\end{equation*} 
where the operator on the right is the linearized KW operator on the cylinder $\del M \times I$ with Nahm 
pole boundary condition $\varrho$ at one end and with relative boundary condtions on the right. 
We have already shown that the index on the right vanishes, whence the claim. 



\section{Analytic theory}\label{analysis}
We now turn to a more careful description of the analytic theory which underpins many of the preceding
considerations. More specifically, we briefly describe some aspects of the theory of linear elliptic uniformly degenerate
equations, all taken from \cite{M-edge} and \cite{MVer}, explain how the results and calculations obtained above 
fit into this theory, and then prove a regularity theorem for solutions of the nonlinear KW equations which 
justifies the calculations in the uniqueness theorem. 

Let us make two comments before proceeding.  The first is that in the special case where $\varrho = 0$, the
Nahm pole boundary condition reduces to a classical elliptic boundary problem, and it is well-known that 
solutions are then smooth up to $W$. The theory described below is the natural extension of those ideas 
which allows us to handle the case where $\varrho \neq 0$ and ${\LKW}$ is no longer a uniformly elliptic operator. 
The second is that to keep the exposition simpler, we focus on the problem in four dimensions.
All of the theory below generalizes immediately to the linearized problem in five dimensions, as does the
application of these results to the regularity of solutions of the nonlinear equations as in section \ref{nonlinreg}. 
The changes required are strictly notational. 

\subsection{Uniformly Degenerate Operators}\label{unifdegg}
Let $M$ be a manifold with boundary, and choose coordinates $(\vec x, y)$ near a boundary point, where 
$\vec x \in U \subset \R^{n-1}$ and $y \geq 0$. A differential operator ${\LKW}_0$ is called uniformly degenerate if in any
such coordinate chart near the boundary it takes the form 
\begin{equation}\label{unifdeg} 
{\LKW}_0 = \sum_{j + |\alpha| \leq m} A_{j \alpha}(\vec x, y) (y\del_y)^j (y\del_x)^{\alpha}; 
\end{equation}
here $(y\del_x)^\alpha = (y\del_{x^1})^{\alpha_1} \ldots (y\del_{x^{n-1}})^{\alpha_{n-1}}$. Such operators are also 
called $0$-differential operators. The key point in this definition is that every derivative is accompanied by a factor 
of $y$. In our setting,  the order $m$ equals $1$ and the coefficients $A_{j \alpha}$ are matrices. Observe that a 
uniformly degenerate can never be uniformly elliptic in the standard sense at $\partial M$
because all the coefficients of the highest order terms vanish when $y=0$.  However, there is an extended notion of ellipticity 
for such operators: ${\LKW}_0$ is said to be an elliptic uniformly degenerate operator if it is elliptic in the standard sense at 
interior points, where $y > 0$, and if in addition, near points of the  boundary, the matrix-valued polynomial obtained by replacing 
each $y\del_{x^a}$ and $y\del_y$ with multiplication by the linear variables $-i k_a$ and $-i k_n$ is invertible when 
$(k_1, \ldots, k_n) \neq 0$. (This formal replacement actually has an invariant meaning; see \cite{M-edge}.) 

The linearized KW operator $\LKW$ is not quite of the form \eqref{unifdeg}; instead, $y\LKW  = \LKW_0$ is an elliptic 
uniformly degenerate operator. This is close enough so that the methods described here can be applied to its analysis equally well. 
To put this into perspective, note that if $\Delta$ is the standard Laplacian on a half-space, then $y^2 \Delta$ is elliptic 
uniformly degenerate, which indicates that the uniformly degenerate theory for the latter operator must therefore reflect the 
well-known properties of the former. In other words, the theory described below subsumes and generalizes the classical 
theory of boundary problems for nondegenerate elliptic operators.  Unlike $\Delta = y^{-2}( y^2 \Delta)$, however,
the operator $\LKW = y^{-1}\LKW_0$ is still degenerate because of the presence of terms involving $1/y$; hence (contrary
to the study of $\Delta$), it is necessary to draw on this uniformly degenerate theory. 

The mapping and regularity properties of solutions of an elliptic uniformly degenerate operator ${\LKW}_0$ hinge on the study of 
two simpler model operators. The first of these: 
\begin{equation}\label{normalop}
N({\LKW}_0) = \sum_{j + |\alpha| \leq m} A_{j \alpha}( \vec x, 0) (s \del_s)^j (s\del_{\vec w})^\alpha, 
\end{equation}
is called the normal operator. This is invariantly defined (up to a linear change of variables) as an operator on the half-space $\R^n_+$, 
naturally identified with the inward-pointing tangent space at the boundary point $(\vec x, 0) \in \partial M$.
To emphasize that it acts on functions defined on this entire half-space, rather than just on a coordinate chart, we write it 
using the linear variables $s \geq 0$, $\vec w \in \R^{n-1}$, which are globally defined on this half-space. The global 
behavior of $N({\LKW}_0)$ on $\R^n_+$ plays a central role in the analysis below.  As a matter of notation, we 
define the normal operator of the linearized KW operator as
\begin{equation}
\label{normalopL}
N({\LKW}) = s^{-1} N({\LKW}_0). 
\end{equation}

Notice that $N({\LKW}_0)$ only depends on $\vec x \in \del M$ as a parameter; there is a different normal operator 
at each point of the boundary, each of which is again uniformly degenerate and elliptic in this sense.  This whole collection of 
operators is called the normal family of $\LKW_0$. In some 
cases, certain crucial features of each $N_{\vec x}(\LKW_0)$ vary with the parameter $\vec x$. Fortunately this does not
happen in our setting; the normal operators at different boundary points all `look the same', and so we shall usually
omit the dependence on $\vec x$.  The normal operator $N({\LKW}_0)$ enjoys considerably more symmetries than 
${\LKW}_0$ itself; namely, it is translation invariant in $w \in \R^{n-1}$ and invariant under dilations $(s,w) \mapsto (\lambda s, 
\lambda w)$, $\lambda > 0$.  Because of these symmetries, it is relatively elementary to study directly, and the goal of 
this entire theory is to show that key properties of these normal operators carry over to ${\LKW}_0$ itself. 

The second model operator is a further reduction, called the indicial operator
\begin{equation}\label{indicialop}
I({\LKW}_0) = \sum_{j \leq m} A_{j 0} (\vec x, 0) (s\del_s)^j,
\end{equation} 
obtained from $N({\LKW}_0)$ by dropping all of the terms $(s\del_{w_j})^{\alpha_j}$ with $\alpha_j > 0$.  Following
the convention above, we also write $I({\LKW}) = s^{-1}I({\LKW}_0)$, when $\LKW$ is the KW operator. 

There is a further, purely algebraic, reduction of the indicial operator obtained by letting $I({\LKW}_0)$ act on the 
elementary functions $s^\lambda$. This yields the indicial family: 
\begin{equation}\label{indfam}
I({\LKW}_0, \lambda) = \sum_{j \leq m} A_{j0}(\vec x, 0) \lambda^j = s^{-\lambda} I({\LKW}_0) s^\lambda,
\end{equation}
where each $s\del_s$ has been replaced by a factor of $\lambda$. 

The reader will notice that the normal operator $N({\LKW})$ was effectively already introduced in section \ref{third}
when we considered the linearized KW operator at the special Nahm pole solution on $\R^4_+$. Moreover, 
we also encountered the indicial family of the linearized KW operator in the matrices on the left hand side of \eqref{lembo} 
and \eqref{wembo}. The indicial roots of ${\LKW}_0$ (or equivalently, of ${\LKW} = s^{-1}{\LKW}_0$) are the finite set of 
values of $\lambda$ for which $I({\LKW}_0, \lambda)$ is not invertible. As we have seen, their computation
in our setting involves nontrivial algebraic subtleties. 

For the rest of this discussion, let us consider only the case where ${\LKW}$ is the linearized KW operator.
Everything we say here has analogues for operators of higher order. With this assumption, one obvious 
simplification is that the equation characterizing the indicial roots
is a simple (generalized) eigenvalue problem, namely that the matrix
\begin{equation}\label{indrts}
A_{10} \lambda + A_{00}
\end{equation}
has nontrivial kernel. Writing the fields on which ${\LKW}_0$ acts as $\Psi$, then corresponding to each
indicial root $\lambda$ there is an eigenvector $\Psi_\lambda$. Equivalently, there is a solution of
the indicial operator of the form $\Psi_\lambda s^\lambda$.   In general the indicial roots
may depend on the basepoint $\vec x \in \partial M$, and this introduces substantial analytic
complications. Fortunately, in our case, this does not occur and we assume henceforth that
the indicial roots are constant in $\vec x$. 

The importance of these indicial roots can be explained at various levels.  At the simplest level,
they provide the expected growth or decay rates of solutions to the equation ${\LKW}_0 \Psi = 0$. 
There is no a priori guarantee that actual solutions to this linear PDE actually do grow or
decay at these precise rates, and the fact that they do in some cases is a regularity theorem.
The discussion in the earlier part of this paper assumes that these growth rates
are legitimate, and we are now in the process of showing that this is so for the linearized KW equation
with the Nahm pole boundary condition. 

To proceed further, we pass from the normal operator $N({\LKW})$ to the same operator conjugated
by the Fourier transform in $\vec w$, just as in section \ref{index}. This leads to the matrix-valued
ordinary differential operator 
\begin{equation}\label{ftnormal}
\widehat{N}({\LKW}) = A_{10} \del_s - i A_{0a} k^a + \frac{1}{s}A_{00}
\end{equation}
The factor of $i$ appears since $e^{i \vec k \cdot \vec w} (s\partial_{\vec w}) e^{-i \vec k\cdot \vec w} = -ik^a$. There are two key 
facts about solutions of this operator, each following from elementary considerations:
\begin{itemize}
\item[i)] Any solution $\hat \Psi(s,\vec k)$ to $\widehat{N}({\LKW}) \hat \Psi = 0$ either 
decays exponentially or else grows exponentially as $s \nearrow \infty$;
\item[ii)] Any solution of this equation near $s = 0$ has a complete (and in fact convergent) asymptotic  
expansion 
\begin{equation}\label{expnorsoln}
\hat \Psi(s,\vec k) = \sum_\lambda \sum_{j=0}^\infty \hat \Psi_{\lambda j} s^{\lambda + j},
\end{equation}
where the first sum is over indicial roots of ${\LKW}$. (In exceptional cases, where the difference between different indicial
roots is an integer, this sum may include extra logarithmic factors. This actually happens in the case of the KW equations.) 
\end{itemize}

The second of these assertions is an immediate consequence of the classical theory of Frobenius series of
solutions of equations with analytic coefficients near regular singular points. The first assertion is slightly more subtle
in that it depends on the ellipticity of the normal operator $N({\LKW})$.  The dominant terms in \eqref{ftnormal} as $s \to \infty$ 
are the first two on the right. Dropping the third term $A_{00}$, we obtain the constant coefficient operator 
$A_{10} \del_s - i A_{0a}k^a$, which has solutions of the form $\tilde \Psi_\lambda e^{\lambda s}$ where $\lambda$ and $\tilde \Psi_\lambda$ 
satisfy the algebraic eigenvalue equation $(A_{10} \lambda - i A_{0a}k^a )\tilde \Psi_\lambda = 0$. The fact that there are no solutions
of this equation with 
purely imaginary $\lambda$ (or with $\lambda=0$, $\vec k\not=0$)  is a restatement of the ellipticity, in the
ordinary sense, of the operator $A_{10} \del_s + A_{0a} \del_{w^a}$. 

Before proceeding with the formulation of boundary conditions, we recall the general notions of conormality and polyhomogeneity
of a field $\Psi$ near $\partial M$; these are simple and useful extensions of the notion of smoothness up to the
boundary of $\Psi$.   We say that $\Psi$ is conormal of order $\lambda_0$, and write $\Psi \in \mathcal A^{\lambda_0}$,  
if $y^{-\lambda_0}|\Psi| \leq C$ with a similar estimate for all its derivatives, i.e.\ $y^{-\lambda_0}| (y\del_y)^j (\del_{\vec x})^\alpha 
\Psi| \leq C_{j \alpha}$ for all $j, \alpha$.  Any such field is smooth in the interior of $M$, 
but these estimates give only a very limited sort of smoothness near the boundary: for example, both $y^{\sqrt{-1}}$ and 
$1/\log y$ lie in $\mathcal A^0$. A more tractable subclass consists of the space of polyhomogeneous fields $\Psi$. 
Here $\Psi$ is said to be polyhomogeneous at $y=0$ if it is conormal and in addition has an asymptotic expansion 
\begin{equation}
\Psi \sim \sum y^{\gamma_j} (\log y)^p \Psi_{jp}(\vec x).
\label{phg}
\end{equation}
The exponents $\gamma_j$ on the right lie in some discrete set $E \subset \mathbb C$, called the index set of $\Psi$, 
which has the following properties: $\mathrm{Re}\, \gamma_j \to \infty$ as $j \to \infty$, the powers $p$ of
$\log y$ are all nonnegative integers, and there are only finitely many such log terms accompanying any $y^{\gamma_j}$.  
Notice that the conormality of $\Psi$ implies that each 
$\Psi_{jp}(\vec x) \in \mathcal C^\infty(\del M)$. The meaning of $\sim$ is the classical one for an asymptotic
expansion: namely, 
\begin{equation*}
| \Psi - \sum_{j \leq N} y^{\gamma_{j}} (\log y)^p \Psi_{jp} | \leq C y^{\mathrm{Re} \gamma_{N+1}}(\log y)^q,
\end{equation*}
where the term on the right is the next most singular term in the expansion.  The corresponding statement must
hold for the series obtained by differentiating any finite number of times.  If the $\gamma_j$ are all nonnegative integers 
and the log terms are absent, this is just the standard notion of smoothness up to $y = 0$. 
Solutions of uniformly degenerate equations ${\LKW}_0 \Psi = 0$ are typically polyhomogeneous (at least in favorable 
circumstances), but essentially never smooth in the classical sense. In our specific problem, the exponents
$\gamma_j$ are of the form $\gamma_j = j/2$, $j = 0, 1, 2, \ldots$; 
log  terms, if they appear at all, do not occur in the leading terms. 

\subsection{Elliptic Weights}\label{ellweights}
We now turn to the various sorts of boundary conditions that can be imposed on the operator ${\LKW}$ and a description of what 
makes a boundary condition elliptic (relative to ${\LKW}$).  General types of boundary conditions can be local and of `mixed' Robin 
type, or nonlocal, such as an Atiyah-Patodi-Singer type boundary condition. We shall focus, however, on the particular
local algebraic boundary conditions which arise in the Nahm pole setting. In this section we describe the simplest of these
boundary conditions, where ${\LKW}$ acts on fields with a prescribed rate of vanishing or blowup at $y = 0$. This is 
analogous to a homogeneous Dirichlet condition (which is tantamount to considering solutions 
which vanish like $y^\epsilon$ at the boundary for any $0 < \epsilon < 1$).  This type of boundary condition is relevant in our 
setting only when none of the $j_\sigma = 0$; in particular, this is the correct type of boundary condition when $\varrho$ is a 
regular representation.  This case is simpler to state, and considerably simpler to analyze, than the more general one when 
some of the $j_\sigma=0$, which we come to only in  section \ref{genebc}.  As before, we continue to focus exclusively on the 
linearized KW operator ${\LKW}$, or its uniformly degenerate associate ${\LKW}_0 = y{\LKW}$, although all the results below 
have analogs for more general elliptic uniformly degenerate operators. 

We shall study the action of $\LKW$ on weighted $0$-Sobolev spaces $y^{\lambda_0 + 1/2}H^k_0(M)$, and so we 
start by defining these. First consider $y^{\lambda_0 + 1/2}L^2(M)$, which consists of all fields $\Psi = y^{\lambda_0 + 1/2} \Psi_1$ 
where $\Psi_1 \in L^2(M)$. The measure is always assumed to equal $\d\vec x \,\d y$ up to a smooth nonvanishing multiple. 
Next, for $k \in \mathbb N$, let
\begin{equation*}
H^k_0(M) = \{ \Psi \in L^2(M): (y \del_{\vec x})^\alpha (y\del_y)^j \Psi \in L^2(M),\ \forall\ j + |\alpha| \leq k\},
\end{equation*}
and finally, define $y^{\lambda_0 + 1/2} H^k_0 = \{\Psi = y^{\lambda_0 + 1/2}\Psi_1: \Psi_1 \in H^k_0\}$. The spaces $s^{\lambda_0 + 1/2} H^k_0(\R^n_+)$ 
are defined similarly. The subscript $0$ on these Sobolev spaces indicates that they are defined relative to the $0$-vector fields
$y\del_y$ and $y\del_{x^a}$; it does not connote that the fields have compact support. A key feature of these spaces is that their norms have 
a scale invariance coming from the  invariance of $y\partial_y$ and $y\partial_{x^a}$ under dilations $(y,\vec x) \mapsto
(cy, c\vec x)$, $c > 0$.  In fact, $N({\LKW}_0)$ does not act naturally on the more standard Sobolev spaces defined
using the vector fields $\partial_y$, $\partial_{x^a}$. The shift by $1/2$ in these weight factors is for notational convenience only and
corresponds to the fact that the function $y^{\lambda_0}$ lies in $y^{\lambda_0 + 1/2 + \epsilon}L^2$ locally near $y = 0$ 
when $\epsilon < 0$ but not when $\epsilon \geq 0$. In other words, $y^{\lambda_0}$ just marginally fails to lie 
in $y^{\lambda_0+1/2}L^2$ (near $y=0$).  

It is evident that 
\begin{equation}
{\LKW}: y^{\lambda_0 + 1/2}H^1_0(M) \longrightarrow y^{\lambda_0 - 1/2} L^2(M)
\label{map11}
\end{equation}
is a bounded mapping for any $\lambda_0 \in \R$. Notice that the weight on the right has dropped by $1$, reflecting that the operator
${\LKW}$ involves the  terms $\del_y$ and $1/y$; if we were formulating this using ${\LKW}_0$, then it would be appropriate to
use the same weight on the left and the right.  Our main concern is whether this mapping is Fredholm, i.e.\ has closed
range and a finite dimensional kernel and cokernel, and to describe the regularity of solutions of ${\LKW} \Psi = 0$ (or ${\LKW} \Psi = f$ 
for fields $f$ which have better regularity and decay as compared to $y^{\lambda_0 - 1/2}L^2$).  It is not hard to show that \eqref{map11} does 
not have closed range when $\lambda_0$ is an indicial root of $\LKW$. Indeed, in this case, an appropriate sequence of compactly
supported cutoffs of the function $y^{\lambda_0}$ can be used to create a Weyl sequence $\Psi_j$, i.e.\ an orthonormal sequence of fields 
such that 
\begin{equation*}
||\Psi_j||_{y^{\lambda_0+1/2}H^1_0} =1, \qquad || {\LKW} \Psi_j||_{y^{\lambda_0 - 1/2}L^2} \to 0.
\end{equation*}
Hence \eqref{map11} is certainly not Fredholm then. When $\lambda_0 \ll 0$, then \eqref{map11} has
an infinite dimensional kernel, while if $\lambda_0 \gg 0$, its cokernel is infinite dimensional. Thus the only chance for \eqref{map11}
to be Fredholm is when $\lambda_0$ is nonindicial and lies in some intermediate range. In some cases (as described in 
section \ref{genebc}), it is not Fredholm for any weight $\lambda_0$. Closely related is the fact that fields in the kernel of \eqref{map11} 
when $\lambda_0 \ll 0$ are, in general, not regular, i.e.\ polyhomogeneous; indeed, for such $\lambda_0$, most solutions are quite 
rough at $\del M$. All of this motivates the following definition.

\begin{definition}\label{ellbc}
The weight $\lambda_0$ is called elliptic for the linearized KW operator ${\LKW}$ if its normal operator defines an invertible mapping:
\begin{equation}\label{noropmap}
N({\LKW}): s^{\lambda_0 + 1/2} H^1_0( \R^n_+; \d\vec w \,\d s) \longrightarrow s^{\lambda_0 - 1/2} L^2(\R^n_+; \d\vec w\, \d s). 
\end{equation}
\end{definition}

The two main consequences of the ellipticity of a weight are stated in the following propositions.
\begin{prop}\label{fred1}
Let ${\LKW}$ be the linearized KW operator on a compact manifold with boundary $M$, and suppose that $\lambda_0$ 
is an elliptic weight. Then the mapping  \eqref{map11} is Fredholm. 
\end{prop}

Recalling that we are in the case where no $j_\sigma = 0$, let $\underline{\lambda}$ and $\overline{\lambda}$ be the 
largest negative and smallest positive indicial roots of $\LKW$, respectively. Thus (see Appendix \ref{groups}) $\underline{\lambda} = -1$ 
and $\overline{\lambda} =1$. We assert that any $\lambda_0 \in (\underline{\lambda}, \overline{\lambda})$ 
is an elliptic weight. We shall prove this later; in fact, all of the necessary facts for the proof come from the 
considerations in sections \ref{second} and \ref{third}.  It will follow from this proof that if some $\lambda_0$ is an elliptic
weight, then so is any other $\lambda_0'$ which lies in a maximal interval around $\lambda_0$ containing
no indicial roots. 

\begin{prop}\label{regularity1}
With all notation as above, let $\lambda_0$ be an elliptic weight for ${\LKW}$, and suppose that ${\LKW}\Psi = f \in y^{\lambda_0 - 1/2}L^2$ 
where $\Psi \in y^{\lambda_0 + 1/2} L^2$. If $f$ is smooth in a neighborhood of some point $q \in \del M$, or slightly more generally, 
if it has a polyhomogeneous asymptotic expansion as $y \to 0$, then in that neighborhood, $\Psi$ admits a polyhomogeneous expansion 
\begin{equation}
\Psi \sim \sum y^{\gamma_j} \Psi_j,
\label{expansion}
\end{equation}
where the exponents $\gamma_j$ are of the form $\lambda + \ell$, $ \ell \in \mathbb N$, where either $\lambda$ 
is an indicial root of ${\LKW}$ or else is an exponent occurring in the expansion of $f$. 
\end{prop}
The expansion \eqref{expansion} may contain terms of the form $y^{\gamma_j} (\log y)^p$, $p > 0$. These can only appear when 
the differences between indicial roots are integers (as happens in our setting), or when there is a coincidence between the 
indicial roots of ${\LKW}$ and the terms in the expansion of the inhomogeneous term $f$.  However, the key fact is simply 
that $\Psi$ has an expansion at all; once we know this, then the precise terms in its expansion can be determined by matching 
like terms on both sides of the equation ${\LKW} \Psi = f$.

The existence of such an asymptotic expansion for solutions should be regarded as a satisfactory replacement for smoothness
up to the boundary. For an ordinary (nondegenerate) elliptic operator ${\LKW}_0$, if the standard Dirichlet condition (requiring 
solutions to vanish at $y=0$) is an elliptic boundary condition in the classical sense, then solutions of ${\LKW}_0 \Psi = 0$ with
$\Psi(0,\vec x) = 0$ are necessarily smooth and vanish to order $1$ at the boundary. Proposition \ref{regularity1} is the exact 
analogue of this. For the linearized KW operator, the nonnegative indicial roots lie in the set $\{j/2: j = 0, 1, 2, \ldots\}$,
so if ${\LKW} \Psi = 0$ in some neighborhood of a boundary point, then 
\begin{equation*}
\Psi \sim  \sum y^{j/2} \Psi_j,
\end{equation*}
(we are neglecting log terms which might appear); in general, there are half-integral exponents, so $\Psi$ is genuinely not smooth at $y=0$. 

We now verify the invertibility of \eqref{noropmap} for every $\lambda_0 \in (\underline{\lambda}, \overline{\lambda})$ 
in our particular example, which proves the assertion that every such $\lambda_0$ is an elliptic weight. First 
conjugate $N({\LKW})$ with the Fourier transform in $\vec w$, thus passing to the simpler ordinary differential operator 
$\widehat{N}({\LKW})$ as in \eqref{ftnormal}.  We must show that
\begin{equation}
\widehat{N}({\LKW}): s^{\lambda_0+1/2} H^1_0(\R^+; \d s) \longrightarrow s^{\lambda_0 - 1/2} L^2( \R^+; \d s),
\label{noropmapft}
\end{equation}
is invertible for each $\vec k$, and that the norm of its inverse is bounded independently of $\vec k$.

The first step is to use the scaling properties of $\widehat{N}({\LKW})$ to reduce to the case $|\vec k| = 1$. Indeed, 
set $t = s|\vec k|$ and write $B({\LKW}) = A_{10} \partial_t - it A_{0a} k^a/|\vec k| + A_{00}$. (The ``$B$'' refers to the
fact that this operator which has many features in common with the Bessel equation, and so we call $B({\LKW})$ 
the model Bessel operator of $\LKW$.)  Applying this change of variables replaces $B({\LKW})$ by $|\vec k|^{-1} \widehat{N}({\LKW})$.

Suppose that we have already shown that the version of \eqref{noropmapft} with $B({\LKW})$ replacing $\widehat{N}({\LKW})$ 
is invertible for every $\vec k$ with $|\vec k| = 1$, and let $B(G)(t, t', \vec k)$ denote the Schwartz kernel of this inverse. 
We then recover the Schwartz kernel $G(s,s', \vec k)$ of the inverse of \eqref{noropmapft} for any $\vec k \neq 0$ as  
\begin{equation*}
\widehat{N}(G)(s, s', \vec k) = B(G)(s|\vec k|, s' |\vec k|, \vec k/|\vec k|). 
\end{equation*}
To see that this is the case, we first compute that 
\begin{equation*}
\begin{split}
\widehat{N}({\LKW}) \int & B(G)(s|\vec k|, s'|\vec k|, \vec k/|\vec k|) f(s', \vec k)\, \d s' = 
\int (B({\LKW}) B(G)) (s|\vec k|, s'|\vec k|, \vec k/|\vec k|) |\vec k| f(s', \vec k) \, \d s' \\
& = \int \delta(s|\vec k| - s' |\vec k|) |\vec k| f(s', \vec k)\, \d s' = f(s, \vec k),
\end{split}
\end{equation*}
since the $\delta$ function in one dimension is homogeneous of degree $-1$. This result may seem counterintuitive 
since one expects that $||\widehat{N}({\LKW})^{-1}|| \sim 1/|\vec k|$, but that expectation is false because we are
letting $\widehat{N}({\LKW})$ act between spaces with different weight factors. In fact, the norm of 
$\widehat{N}(G)$ is bounded uniformly in $\vec k$, but does not decay as $|\vec k| \to \infty$. To this end,
observe that we must estimate the norm of 
\begin{equation*}
H(s, s', \vec k) := s^{-\lambda_0 - 1/2} \widehat{N}(G)(s,s', \vec k) (s')^{\lambda_0 - 1/2}: L^2 \to L^2.
\end{equation*}
This is done by calculating
\begin{multline*}
\int \left| \int H(s, s', \vec k) f(s', k)\, \d s' \right| ^2 \, \d s  \\
= \int \left| \int B(G)(s|\vec k|, s'|\vec k|, \vec k/|\vec k|) (s|\vec k|)^{-\lambda_0 - 1/2} (s' |\vec k|)^{\lambda_0 - 1/2} 
|\vec k| f(s', \vec k)\, \d s'\right|^2 \, \d s \\ = \int \left| \int B(G)(t, t', \vec k/|\vec k|) 
t^{-\lambda_0 - 1/2}(t')^{\lambda_0 - 1/2} |\vec k|^{-1/2} f(t'/|\vec k|, \vec k)\, \d t' \right|^2 \\
\leq C || |\vec k|^{-1/2} f( t/|\vec k|, \vec k) || = C ||f (\cdot, \vec k)||.
\end{multline*}
The inequality in the fourth line reflects the boundedness of $B(G): t^{\lambda_0 - 1/2} L^2 \to t^{\lambda_0 + 1/2}L^2$. 

Beyond all this, compactness of the unit sphere in $\vec k$ shows that the norm of $B(G)$ can be bounded
independently of $\vec k$. 

As for showing that \eqref{noropmapft} is invertible for each $\vec k$, we first show that it is Fredholm. This can be
done by a standard ODE analysis of the operator.  First construct approximate local inverses near $s=0$ and $s=\infty$;
the existence of these shows that \eqref{noropmapft} is Fredholm precisely when $\lambda_0$ is {\it not} 
an indicial root of ${\LKW}_0$. (As noted earlier, when $\lambda_0$ is an indicial root, this mapping does not have closed range.)  
Now fix $\lambda_0$ to be any nonindicial value and recall the fact i) that any element of the kernel either grows or decays exponentially 
as $s \to \infty$. Then injectivity of this map means precisely that the solutions which decay exponentially as $s \to \infty$ 
must blow up faster than $s^{\lambda_0}$ as $s \to 0$.  One can perform a similar analysis for the adjoint operator,
or by showing  by other methods that the index vanishes, to show that \eqref{noropmapft} is surjective too.

For the linearized KW operator ${\LKW}$, the discussion in section \ref{nonregular} implies directly that the kernel of 
$\widehat{N}({\LKW})$ has only trivial kernel on $s^{\lambda_0 + 1/2}L^2$  when $\lambda_0 > 0$.  Indeed, 
perform the integrations by parts (which are now only in the $s$ variables), using the decay of solutions both 
as $s \to 0$ and as $s \to \infty$ to rule out contributions from the boundary terms. We can extend this to allow
any $\lambda_0 > \underline{\lambda}$ simply by observing using the fact ii) about solutions that if $\widehat{N}({\LKW}) 
\hat\Psi = 0$ and $\hat \psi \in s^{\lambda_0 + 1/2}L^2$, then $\hat\Psi$ vanishes like $s^{\overline{\lambda}}$, so we may
integrate by parts as before. The fact that the index vanishes when $\lambda \in (\underline{\lambda}, \overline{\lambda})$
follows by using the pseudo skew-adjointness established in section \ref{pseudo}. Note that those arguments are for ${\LKW}$ on the model 
space $\R^4_+$, which is canonically identified with the normal operator $N({\LKW})$ of the linearized KW equations on 
any manifold with boundary, and the pseudo skew-adjointness passes directly to $\widehat{N}({\LKW})$ as well.

We have now proved that in the quasiregular case, when no $j_\sigma  = 0$, any $\lambda_0 \in (\underline{\lambda}, \overline{\lambda})$ 
is an elliptic weight for $\LKW$. 

The results just stated are not well suited for our nonlinear problem simply because these weighted $L^2$ spaces do not behave 
well under nonlinear operations. One hope might be to use $L^2$- (or $L^p$-) based scale-invariant Sobolev spaces with 
sufficiently high regularity. These do have good multiplicative properties locally in the interior, but not near the boundary. 
This leads us to introduce several related H\"older-type spaces, and then describe the mapping properties of ${\LKW}$ acting on them. 

We start with the spaces $\mathcal C^k_0$, which consist of all fields $\Psi$ such that
$(y\partial_y)^j (y\partial_{\vec x})^\alpha \Psi$ is bounded on $M$ and continuously differentiable in
the interior of $M$ for all $j + |\alpha| \leq k$. The H\"older seminorm is defined by
\begin{equation*}
[ \Psi]_{0; 0,\gamma} = \sup_{(y,\vec x) \neq (y', \vec x\, ')} \frac{ |\Psi(y, \vec x) - \Psi(y', \vec x\, ')|(y+y')^\gamma}{
|y-y'|^\gamma + |\vec x - \vec x\, '|^\gamma} 
\end{equation*}
Then $\mathcal C^{k,\gamma}_0$ consists of all $\Psi \in \mathcal C^k_0$ such that 
$ [ (y\partial_y)^j (y\partial_{\vec x})^\alpha \Psi]_{0; 0,\gamma} < \infty$. Finally, $y^{\lambda_0} \mathcal C^{k,\gamma}_0$ 
consists of all $\Psi = y^{\lambda_0}\Psi_1$ with $\Psi_1 \in \mathcal C^{k,\gamma}_0$. 

These spaces capture no information about regularity in the $\vec x$ directions at $y=0$, so we also introduce hybrid spaces
\begin{equation*}
\mathcal C^{k,\ell, \gamma}_0 = \{ \Psi \in \mathcal C^{k,\gamma}_0: (\partial_{\vec x})^\alpha \Psi \in 
\mathcal C^{k-|\alpha|,\gamma}_0,\ \mbox{for all}\ |\alpha| \leq \ell\}.
\end{equation*}
Note that all of these spaces contain elements like $y^\lambda$ or $y^\lambda (\log y)^p$, provided
$\lambda > \lambda_0$ (or $\lambda = \lambda_0$ if $p = 0$). 

The mapping property of $\LKW$ on these spaces is much the same as in Proposition \ref{fred1}.
\begin{prop}
Let ${\LKW}$ be the linearized KW operator. Suppose that no $j_\sigma = 0$ and let $\lambda_0 \in (\underline{\lambda},
\overline{\lambda})$ be an elliptic weight. Then the mapping 
\begin{equation}
{\LKW}: y^{\lambda_0} \mathcal C^{k,\ell, \gamma}_0 \longrightarrow y^{\lambda_0 - 1} \mathcal C^{k-1, \ell, \gamma}_0
\label{Fredholder}
\end{equation}
is Fredholm for $0 \leq \ell \leq k-1$ and $k \geq 1$. 
\label{maphold}
\end{prop}
We explain in the next section how this result is essentially a corollary of Proposition~\ref{fred1}. More specifically, 
both results are proved by parametrix methods; this parametrix is constructed using $L^2$ methods and it is initially
proved to be bounded between weighted Sobolev spaces, but it is also bounded between certain of these weighted 
H\"older spaces, which leads directly to the proof of Proposition \ref{maphold}.

\subsection{Structure of the Generalized Inverse}\label{strgeninv}
We now briefly describe the technique behind the proofs of these results. The main step in each is the 
construction and use of the generalized inverse $G$ for \eqref{map11}. The ellipticity of the weight enters
directly into this construction.  By definition, a generalized inverse for \eqref{map11} is a bounded operator 
$G: y^{\lambda_0 - 1/2}L^2 \to y^{\lambda_0 + 1/2}H^1_0$ which satisfies
\begin{equation}
G {\LKW} = \mbox{Id} - R_1, \qquad {\LKW} G = \mbox{Id} - R_2,
\label{geninv}
\end{equation}
where $R_1$ and $R_2$ are finite rank projections onto the kernel and cokernel of $\LKW$, respectively. 
The nonuniqueness here is mild and results only from the different possible choices of projectors. Since
we are working on a specific weighted $L^2$ space, it is natural to demand that $R_1$ and $R_2$ 
be the orthogonal projectors onto the kernel and cokernel with respect to that inner product, and
we make this choice henceforth. 

If we already know that \eqref{map11} is Fredholm, then general functional analysis tells us that a generalized
inverse exists. Conversely, the existence of an operator $G$ with these properties (the boundedness of 
$G$ is particularly important) implies that \eqref{map11} is Fredholm. In fact, it is only necessary to find a 
bounded operator $\tilde{G}$ such that the `error terms' $R_1$ and $R_2$ defined as in \eqref{geninv} are 
compact operators, for then standard abstract arguments imply that \eqref{map11} is Fredholm and show that $\tilde{G}$ 
can be corrected to an operator such that \eqref{geninv} holds, with $R_1$ and $R_2$ the actual projectors.  
This observation is important because it is certainly easier to construct an intelligently designed approximation 
to the generalized inverse than to construct the precise generalized inverse directly.  The criterion by which
one judges the approximation to be good enough is simply that the remainder terms $R_1$ and $R_2$ are compact.
An approximation of this type is called a parametrix for $\LKW$. 

A parametrix can be constructed within the framework of geometric microlocal analysis, as carried out in full
detail in \cite{M-edge}. The key point is to work within a class of pseudodifferential operators on $M$ 
adapted to the particular type of singularity exhibited by $\LKW$. This is the class of $0$- (or uniformly degenerate) 
pseudodifferential operators, $\Psi_0^*(M)$. We wish that $\Psi^*_0(M)$ is sufficiently large to contain parametrices 
of elliptic uniformly degenerate differential operators, but not so large that the individual operators in $\Psi^*_0(M)$ 
are too unwieldy to analyze.  We describe these operators in sufficient 
detail for the present purposes, but refer to \cite{M-edge} for further details.

The elements of $\Psi^*_0(M)$ are characterized by the singularity structure of their Schwartz kernels. Thus, an operator 
$A \in \Psi^*_0(M)$ has a Schwartz kernel $\kappa_A(y, \vec x, y', \vec x\,')$, which is a distribution on $M^2$. 
We expect it to have a a standard pseudodifferential singularity (generalizing that of the Newtonian potential,
for example) along the diagonal $\{y = y', \vec x = \vec x\,'\}$, but we also require a very precise regularity along 
the boundaries of $M^2$, $\{y = 0,\ \mbox{or}\ y' = 0\}$, and at the intersection of the diagonal with the boundary. 
To formalize this, introduce the space $M^2_0$ obtained by taking the real blowup of the product $M^2$ 
at the boundary of the diagonal. In local coordinates this means that we replace each point $(0, \vec x, 0, \vec x)$
in the boundary of the diagonal with its inward-pointing normal sphere-bundle. Alternatively, in polar coordinates
\begin{equation*}
R = (y^2 + (y')^2 + |\vec x - \vec x\,'|^2)^{1/2}, \ \omega = (\omega_0, \omega_0', \hat\omega) = 
(y, y', \vec x - \vec x\,')/R \in S^4_+,
\end{equation*}
where $S^4_+$ consists of the unit vectors in $\R^5$ with $\omega_0, \omega_0' \geq 0$, we replace each point 
$(0,\vec x, 0, \vec x)$ by the quarter-sphere at $R = 0$. We can then use $(R, \omega, \vec x\,')$ as a full set of coordinates. 
This new space is a manifold with corners up to codimension three, and has a new hypersurface boundary at $R=0$, 
which is called the front face. Its two other codimension one boundaries
$\omega_0 = 0$ and $\omega_0' = 0$ are called its left and right faces.  There is an obvious blowdown map $M^2_0 \to M^2$.
We now say that $A$ is a $0$-pseudodifferential operator if $\kappa_A$ is the pushforward under blowdown of a distribution
on $M^2_0$ (which we denote by the same symbol) which decomposes in the following fashion
as a sum $\kappa_A(R,\omega,\vec x\,') = \kappa_A' + \kappa_A''$.
Here $\kappa_A'$ is supported away from the left and right faces and has a pseudodifferential singularity of some order $m$ 
along the lifted diagonal $\{\omega_0 = \omega_0', \hat \omega = 0\}$, and if we factor $\kappa_A' = R^{-4} \hat\kappa_A'$,
then $\hat\kappa_A'$ (along with its conormal diagonal singularity) extends smoothly across the front face of $M^2_0$.
This exponent $-4$ is dimensional; in general it should be replaced by the dimension of $M$. On the other hand $\kappa_A''$ is
smooth in the interior of $M^2_0$ and has polyhomogeneous expansions at the left, right and front faces of this space,
with product type expansions at the corners. Altogether, if the expansions at these faces commence with the terms
$\omega_0^a$ (at the left face), $(\omega_0')^b$ (at the right face) and $R^{-4 + s}$ (at the front face), then we write
\begin{equation*}
A \in \Psi_0^{m, s, a, b}(M).
\end{equation*}
Slightly more generally we could replace the superscripts $a$, $b$, denoting the leading exponents of the polyhomogeneous 
expansions at the left and right faces, by index sets, but we do not need this more refined notation here.  

This elaborate notation simply specifies the precise vanishing or blowup properties of $\kappa_A$ in each of these regimes.
We have introduced it out of some necessity since at least some features of this precise structure will be used in an
important way below.  Before proceeding, note one very special case: the identity operator $\mbox{Id}$
is an element in this class, and lies in $\Psi_0^{0, 0, \emptyset, \emptyset}$.  The fact that it has order $0$ along
the diagonal is expected, and since its Schwartz kernel $\delta(y-y') \delta(\vec x - \vec x\,')$ is supported
on the diagonal, its expansion is trivial at the left and right faces, which explains the third and fourth
superscripts. Finally, the second superscript is explained by noting that in polar coordinates
\begin{equation*}
\delta(y-y') \delta(\vec x - \vec x\,') = R^{-4} \delta(\omega_0 - \omega_0')\delta(\hat\omega)
\end{equation*}

Having introduced this general class of pseudodifferential operators, we now explain the parametrix construction.
We aim to find an operator $\tilde{G} \in \Psi_0^*(M)$ such that $\LKW \tilde{G}$ is equal to the identity
up to some compact remainder terms. Rewriting this as the distributional equation 
\begin{equation*}
{\LKW} \kappa_{\tilde G} = R^{-4} \delta(\omega_0 - \omega_0') \delta(\hat\omega)
\end{equation*}
we see that the singularity of $\kappa_{\tilde{G}}$ along the diagonal can be obtained by classical methods
(the symbol calculus), and this construction is uniform as $R \to 0$ once we have removed the appropriate
factors of $R$. In fact, writing $\LKW$ in these same polar coordinates and noting that it lowers homogeneity
in $R$ by $1$, we expect $\kappa_{\tilde{G}}$ to only blow up like $R^{-3}$ at the front face.  In addition,
$\LKW$ must kill the terms in the expansion of $\kappa_{\tilde{G}}$ at the left face, which means that
the terms in the expansion in this face should involve the indicial roots; in particular, the leading exponent at 
this face must equal $\overline{\lambda}$. 

It is not apparent here where the ellipticity of the weight $\lambda_0$ enters. The answer is as follows. After
first solving away the diagonal singularity using the symbol calculus, we must then improve the initial
guess for the parametrix to another one for which ${\LKW} \kappa_{\tilde{G}} - \delta_{\mathrm{Id}}$ vanishes at the front 
face as well. Because the lift of $\LKW$ to $M^2_0$ acts tangentially to the boundary faces of that space,
this equation restricts to an elliptic equation on the front face. Using a natural identification of each quarter-sphere
fiber of the front face with a half-Euclidean space, and a few other steps which we omit, we are led to having to find 
the {\it exact} solution to $N({\LKW}) \Psi = f$ where $f$ is some smooth compactly supported function on $\R^4_+$. 
If we are able to do this, we can then correct the parametrix to all orders so that the remainder terms are clearly compact. 
The natural identification used here is that the quarter-sphere $S^4_+$ fiber in the front face over each point $(0,\vec x, 0, \vec x)$
of the boundary of the diagonal can be identified with the half-space $\R^4_+$, where this identification is unique
up to a projective map, and the restriction to the front face of the lift of $\LKW$ to $M^2_0$ is transformed to 
$N({\LKW})$ in this identification. Section 2 of \cite{M-edge} (especially around eqn.\ (2.10)) explains more about
these identifications. This explains why the exact invertibility of the normal operator plays a crucial role.  

The vindication that this all works is that by carrying out this parametrix construction, one proves that the generalized 
inverse $G$ for $\LKW$ is an element of $\Psi^{-1,1, \overline{\lambda}, b}_0(M)$, where the final index $b$ is some positive 
number related to the indicial roots of the adjoint of $\LKW$, and that the remainder terms in \eqref{geninv} satisfy 
$R_1 \in \Psi^{-\infty, \overline{\lambda},  b}(M)$, $R_2 \in \Psi^{-\infty, b, \overline{\lambda}}(M)$, where this notation (note the 
absence of the subscript $0$) means that their Schwartz kernels are smooth in the interior and polyhomogeneous at 
the two boundary hypersurfaces of $M^2$, rather than being polyhomogeneous on the blown up space $M^2_0$. 

We now explain how to use all of this for our purposes.  Granting this structure of the Schwartz kernel of the
generalized inverse $G$, the boundedness of the map 
\begin{equation}
G: y^{\lambda_0 - 1/2} L^2 \longrightarrow y^{\lambda_0 + 1/2} H^1_0
\label{GL2}
\end{equation}
can be deduced from the standard local boundedness of pseudodifferential operators of order $-1$ between
$L^2$ and $H^1$, and the following inequalities for the orders of vanishing of $\kappa_G$ at the 
various boundary faces. The fact that $\kappa_G$ blows up like $R^{-3}$ at the front face, one order 
better than the Schwartz kernel of the identity, partly explains why $G$ raises the exponent in the weight factor by $1$.
The other aspect which affects the weight on the right in \eqref{GL2} is the leading exponent $\overline{\lambda}$
at the left face, since it is clear that the decay profile of 
\begin{equation}
\int_M \kappa_G( y, \vec x, y', \vec x\,') f(y', \vec x\,') \, \d y' \d\vec x\,'
\label{intexp}
\end{equation}
as $y \to 0$ must incorporate that exponent. Recalling the earlier discussion that $\kappa_G$ decomposes
into the near-diagonal and off-diagonal parts, $\kappa_G'$ and $\kappa_G''$, a close analysis of the
integrals from each of these terms proves that
\begin{equation}
G: y^{\lambda_0 - 1/2}L^2 \longrightarrow y^{\lambda_0 + 1/2} H^1_0 + \bigcap_{\epsilon > 0 \atop k \geq 0 } y^{\overline{\lambda}+1/2 - \epsilon} H^k_0.
\label{refregsob}
\end{equation}
In other words, the near-diagonal part raises regularity and the weight parameter by exactly $1$, while
the off-diagonal part improves the $0$-regularity to an arbitrarily large amount, and has growth/decay
rate of the outcome dictated by the leading term of $\kappa_G$ on the left face. We must intersect
over all $\epsilon>0$ here simply because $y^{\overline{\lambda}} \in y^{\overline{\lambda} + 1/2-\epsilon}L^2$ when $\epsilon > 0$,
but not otherwise. 

From all of this, and observing that when $\overline{\lambda} > \lambda_0$, the range of \eqref{refregsob} is contained 
in $y^{\lambda_0 + 1/2}H^1_0$, we see that \eqref{map11} is Fredholm, 
which is Proposition \ref{fred1}. The proof of Proposition \ref{regularity1} is obtained by a more refined examination of the 
mapping properties of $G$, in particular the fact that if $f$ is polyhomogeneous, then so is the outcome of the integral \eqref{intexp}.
Finally, the proof of Proposition \ref{maphold} can be explained as follows.  The preceding discussion has been 
based on $L^2$ considerations, which is natural since, for example, Fourier analysis has been used
at several points. However, the precise pointwise behavior of the Schwartz kernel of $G$ makes it possible to 
read off its mapping properties on other function spaces.  In particular, we obtain the analog of \eqref{refregsob}
on weighted H\"older spaces: 
\begin{equation}
G: y^{\lambda_0-1} \mathcal C^{k,\gamma}_0  \longrightarrow y^{\lambda_0}\mathcal C^{k+1,\gamma}_0 + 
\bigcap_m y^{\overline{\lambda}} \mathcal C^{m,\gamma}_0.
\label{refreghold}
\end{equation}
As before, this range lies in $y^{\lambda_0} \mathcal C^{k+1,\gamma}_0$ when $\lambda_0 < \overline{\lambda}$.
There is a slight refinement of this which we shall need later, namely that
\begin{equation}
G: y^{\mu-1} \mathcal C^{k,\gamma}_0  \longrightarrow y^{\mu}\mathcal C^{k+1,\gamma}_0 + 
\bigcap_m y^{\overline{\lambda}} \mathcal C^{m,\gamma}_0
\label{refreghold2}
\end{equation}
for any $\mu > \lambda_0$ (and for simplicity of the statement, $\mu$ not an indicial root). 
Since the equations \eqref{geninv} are satisfied as distributions, and every operator in them is bounded between 
the appropriate H\"older spaces, we see that \eqref{Fredholder} is in fact Fredholm, at least for $\ell = 0$.   
To prove that \eqref{Fredholder} is Fredholm for $\ell \geq 0$, we need one extra fact, which is that each of 
the commutators $[ G, \del_{x^a}]$ lies in $\Psi^{-1, 1, \overline{\lambda}, b}_0$, i.e.\ is a $0$-pseudodifferential operator 
with the {\it same} indices, hence has the same mapping properties as $G$ itself. 

This simple transition from Sobolev  to H\"older spaces is a good exemplar of the parametrix method; if we were working 
solely with a priori estimates, then it is no simple matter to deduce Fredholmness on one type of function space from 
the corresponding property on another type of function space.  

%For more on all of these results and methods, and in particular the proofs of Propositions \ref{fred1} and \ref{regularity1},
%see \cite{M-edge}. 

\subsection{Algebraic Boundary Conditions and Ellipticity}\label{genebc}
There are many natural operators, however, for which there are no ellliptic weights, i.e.\ so that for any nonindicial $\lambda_0$, 
the map \eqref{noropmapft} has either nontrivial kernel or cokernel, or both. This is the case for the linearized KW operator ${\LKW}$
when some of the $j_\sigma = 0$. We now describe the somewhat more complicated formulation of the ellipticity criterion
for boundary conditions in these cases. As before, we consider only the parts of this story relevant to the Nahm pole  boundary 
conditions for ${\LKW}_0$.  

The argument in the last section (slightly after \eqref{noropmapft}) shows that even when the lowest nonnegative indicial 
root $\lambda$ is $0$, then $\hat{N}({\LKW}) : s^{\lambda_0 + 1/2}L^2 \to s^{\lambda_0-1/2}L^2$ has no kernel if $\lambda_0 > 0$,
although the cokernel of this mapping is nontrivial. On the other hand, when $\lambda_0 < 0$, the nullspace has positive dimension,
though the map is surjective. To be definite, suppose that $-1/2 < \lambda_0 < 0$, which rules out solutions which blow up like 
$s^\lambda$ where $\lambda$ is any one of the strictly negative indicial 
roots of ${\LKW}_0$. Using the fact ii) that solutions of $\widehat{N}({\LKW}) \hat{\Psi} = 0$ have (convergent) 
expansions at $s = 0$, the leading coefficient $\hat\Psi_0 = (\hat{a}_a, \hat{\varphi}_y, \hat{a}_y, \hat{\varphi}_a)$, 
i.e.\ the coefficient of $s^0$, is well-defined. This coefficient lies in the eigenspace corresponding to the indicial root 
$\lambda = 0$, and hence, following the language at the end of section \ref{nonregular}, is an element of 
$\frak c^{8}$. We call this the Cauchy data of $\hat{\Psi}$ and write it as $\mathcal C(\hat{\Psi})$. 

At this ODE level, the Nahm pole boundary condition intermediates between the spaces $y^{\lambda_0 + 1/2}L^2$
when $-1/2 < \lambda_0 < 0$ and $0 < \lambda_0 < 1/2$. Recall that for this boundary condition, we
fix a subalgebra $\frak h \subset \frak c$ and its orthogonal complement $\frak h^\perp$ in $\frak c$, and
then consider the linear map 
\begin{equation} 
\mathcal B_{\frak h} (\hat{a}_a, \hat{\varphi}_y, \hat{a}_y, \hat{\varphi}_a) = (\hat{a}_a^{\, \frak h^\perp}, \hat{\varphi}_y^{\, \frak h^\perp} , 
\hat{a}_y^{\, \frak h} , \hat{\varphi}_a^{\,\frak h}) \in (\frak h^\perp)^3 \oplus \frak h^\perp \oplus \frak h \oplus \frak h^3. 
\label{bcs0}
\end{equation}
This determines a boundary condition for $\hat{N}(\LKW)$ and we shall study the problem
\begin{equation}
\hat{N}(\LKW) \hat \Psi = f, \qquad \hat\Psi \in s^{\lambda_0 + 1/2}H^1_0,\ \ \mathcal B_{\frak h}(\mathcal C(\hat \Psi)) = 0. 
\label{bcs}
\end{equation}

As a first observation, following the same integrations by parts as above, there are no nontrivial fields $\hat{\Psi}$ which decay 
at infinity and satisfy \eqref{bcs} with $f = 0$; indeed, the conditions $a_a^{\frak h^\perp} = 0$, $\varphi_y^{\frak h^\perp} = 0$, 
$a_y^{\frak h} = 0$, $\varphi_a^{\frak h} = 0$ make all boundary terms at $s=0$ in this integration by parts vanish. 
On the other hand, if we only assume that $f \in s^{\lambda_0 - 1/2}L^2$ for some $-1/2 < \lambda_0 < 0$, then this problem is 
not well posed. Indeed, although there is a solution to the first equation in \eqref{bcs}, there is no reason for the 
leading coefficient $\mathcal C(\hat \Psi)$ to have any meaning, so the boundary condition may not have any sense.
Thus it is necessary to suppose that $f$ lies in a slightly better space, as we now describe. 

With $\lambda_0 \in (-1/2,0)$ as before, define
\begin{equation}
\hat{\mathcal H}_{\lambda_0} = \{\hat \Psi \in s^{\lambda_0 + 1/2}L^2(\R^+): \hat{N}(\LKW) \hat \Psi \in s^{\lambda_0 + 1/2}L^2(\R^+)\}.
\label{Hnor}
\end{equation}
The right hand side is one order less singular than might be expected, and using standard ODE techniques, one sees
that $\hat \Psi = s^0 \hat \Psi_0 + \mathcal O(s^{\lambda_0 + 3/2})$, and hence the leading coefficient $\hat \Psi_0$ is 
well defined. We may now legitimately consider the mapping
\begin{equation}
\hat{N}(\LKW): \hat{\mathcal H}_{\lambda_0} \cap \{\hat \Psi: \mathcal B_{\frak h} (\mathcal C(\hat \Psi)) = 0\} 
\longrightarrow s^{\lambda_0 + 1/2} L^2. 
\end{equation}
Note that the weighted $L^2$ restriction on $\hat \Psi$ when $s$ is large precludes the exponentially growing solutions of 
$N(\LKW) \hat\Psi = 0$.

We have so far suppressed the dependence of $\hat{N}({\LKW})$, and hence also of the map $\mathcal B_{\frak h}$, on
the parameters $\vec x \in \partial M$ and $\vec k \neq 0$. As observed earlier, the only essential part of the dependence on
$\vec k$ is on the direction $\vec k/|\vec k|$, and hence we assume for the remainder of this discussion
that $|\vec k| = 1$, i.e.\ $\vec k \in S^2$. For this particular operator, the dependence on $\vec x$ is not 
very serious in that the operator `looks the same' in appropriate local coordinates at any point of $\del M$. 
However, formally we should be considering $(\vec x, \vec k)$ as a point
in $S^* \partial M$, the cosphere bundle of $\del M$. If $\pi: S^* \partial M \to \partial M$
is the natural projection, then $\mathcal B_{\frak h}$ is a bundle map between 
$\pi^* \frak c^{8}$ and $\pi^* \left((\frak h^\perp)^3 \oplus \frak h^\perp \oplus \frak h \oplus (\frak h)^3\right)$.
The fact that $\mathcal B_{\frak h}$ is independent of $\vec k$ allows us to call this an algebraic boundary condition. 

The additional ingredient we need in this discussion is the space 
\begin{equation}
V = V_{\vec x, \vec k} = \{ \hat\Psi \in \hat{\mathcal H}_{\lambda_0}:\hat N(\LKW)(\hat\Psi) = 0\}
\label{defV}
\end{equation}
of homogeneous solutions in $s^{\lambda_0 + 1/2}L^2$ which do not necessarily 
satisfy the boundary condition. The dependence
of $V$ on $\vec x$ is again negligible, but its dependence on $\vec k$ is genuine since $\vec k$ appears in the 
coefficients of $N(\LKW)$ and these kernel elements do vary nontrivially with $\vec k$.  However, the dimension
of $V_{\vec x, \vec k}$ does not depend on $\vec k$, and in fact $V$ varies smoothly with $\vec k$ (and $\vec x$).
This means that we can regard $V$ as a vector bundle over $S^* \partial M$. The injectivity of $\hat N({\LKW})$
on $y^{\lambda_0 + 1/2}L^2$ when $\lambda_0 > 0$ shows that the restriction of the Cauchy data map $\mathcal C$
to $V$ is injective. This means that $\mathcal C(V)$ is a subbundle of $\frak c^{8}$; this is sometimes
called the Calderon subbundle. 

We can now finally state the property which makes $\mathcal B_{\frak h}$ an elliptic boundary condition. 
\begin{definition}
Let $\mathcal B$ be any bundle map from $\pi^* \frak c^{8}$ to another vector bundle $W$ over $S^* \partial M$. 
Then $\mathcal B$ is said to be an elliptic boundary condition for $\hat{N}(\LKW)$ (and hence ultimately for $\LKW$) if
the restriction of $\mathcal B$ to the subbundle $V$ is bijective onto $W$, i.e.\ so that 
\begin{equation*}
\left. \mathcal B \right|_V: V  \longrightarrow W
\end{equation*} 
is a bundle isomorphism. 
\label{bcs1}
\end{definition}
This condition can be phrased in various obviously equivalent ways; the one we use below is to require 
that $\mathcal B$ is injective and that the ranks of $V$ and $W$ are the same. However, in the end, this
condition is precisely what is 
needed to construct a good parametrix for the actual boundary problem on $M$.  We can see this rather
easily at the level of this ODE.  If $f \in s^{\lambda_0 + 1/2}L^2 \subset s^{\lambda_0 - 1/2}L^2$, then there is
a solution $\hat \Psi \in s^{\lambda_0 + 1/2}H^1_0$ to $\hat{N}({\LKW})\hat\Psi = f$. This is not unique,
since there is a nullspace. In any case, this solution has a leading coefficient $\hat \Psi_0$, which
is however unlikely to satisfy $\mathcal B_{\frak h}(\hat \Psi_0 ) = 0$. Now modify $\hat\Psi$ by subtracting 
an element $\hat\Phi \in V$. By definition, $\hat{N}({\LKW})(\hat\Psi - \hat \Phi) = f$, and provided we choose 
$\hat \Phi$ so that $\mathcal B_{\frak h}(\hat\Phi_0) = \mathcal B_{\frak h}(\hat\Psi_0)$, 
then $\hat \Psi - \hat \Phi$ satisfies the boundary condition too. The fact that there is a unique 
such choice of $\hat \Phi$ is precisely the content of Definition~\ref{bcs1}.  

Let us now check that this condition holds for the map $\mathcal B_{\frak h}$ which appears in the general Nahm
pole boundary condition.  We have proved above that $\mathcal B_{\frak h}$ is injective on $V$.  Furthermore,
it follows from the results of section \ref{third} that the rank of $V$ is half the rank of $\frak c^{8}$, i.e.\ 
$\mathrm{rk}(V) = 4\dim \frak c$. Since this is the same as $\dim ( (\frak h^\perp)^3 \oplus \frak h^\perp \oplus 
\frak h \oplus \frak h^3)$, we see that $\left. \mathcal B_{\frak h}\right|_V$ is also surjective, and hence an isomorphism.

As noted earlier, $\mathcal B$ is called an algebraic boundary condition if $W = \pi^* W'$ where $W'$ is a bundle over 
$\del M$. If this is the case, then the analytic theory of the boundary problem for the actual operator $\LKW$ is simpler 
because the boundary conditions are local (of mixed Dirichlet-Neumann type), rather than nonlocal (pseudodifferential). 
It is clear that $\mathcal B_{\frak h}$ is an algebraic boundary condition. 

Return now to the linearized KW operator, and assume that some $j_\sigma = 0$, so that we can augment
the operator $\LKW$ with the boundary condition $\mathcal B_{\frak h}$. Fix $\lambda_0 \in (-1/2, 0)$ and consider 
\begin{equation}
\mathcal H_{\lambda_0} = \{\Psi \in y^{\lambda_0 + 1/2} H^1_0( \d\vec x \d y): {\LKW} \Psi \in y^{\lambda_0 + 1/2} L^2\}.
\end{equation} 
As before, the expected behavior for $\Psi \in y^{\lambda_0 + 1/2}L^2$ is that ${\LKW} \Psi \in y^{\lambda_0 - 1/2}L^2$.
This means that fields in $\mathcal H_{\lambda_0}$ must possess some special properties to ensure that ${\LKW}\Psi$ 
is one order less singular than $y^{\lambda_0 - 1/2}L^2$.  Although we no longer have ODE arguments to fall
back upon, it is still possible to show that any $\Psi \in \mathcal H_{\lambda_0}$ has a {\it weak} partial expansion
\begin{equation*}
\Psi \underset{w}{\sim} \Psi_0 \, y^0 + \tilde{\Psi},
\end{equation*}
where $\Psi_0$ is a distribution of negative order which lies in the Sobolev space $H^{\lambda_0}(\partial M)$. 
The remainder term $\tilde{\Psi}$ vanishes like $y^{\lambda_0 + 1}$ in a similar distributional sense. We do not 
pause to make this more precise (see section 7 of \cite{M-edge}), but note only that the actual meaning of the 
weak expansion above is that if we `test' $\Psi$ against some $\chi \in \mathcal C^\infty(\del M)$, then 
\begin{equation*}
\int \Psi(y,\vec x) \chi(\vec x) \, \d \vec x = \langle \Psi_0, \chi \rangle y^0 + \langle \tilde{\Psi}, \chi \rangle,
\end{equation*}
where the second term on the right vanishes like $y^{\lambda_0 + 3/2}$.  

The point of belaboring all of this is that it is possible to make sense of the leading coefficient $\Psi_0$ of 
a general element $\Psi \in \mathcal H$ as a $\frak c^{\oplus 8}$-valued distribution of negative
order on $\del M$.  Because the boundary condition is algebraic, we can then make sense of the projection 
$\mathcal B_{\frak h}(\Psi_0)$, again as a distribution. In particular, when $\Psi \in \mathcal H$, 
there is now a good meaning of the condition $\mathcal B_{\frak h}(\mathcal C(\Psi)) = 0$.

We can now state analogs of all the main results.
\begin{prop}\label{fred2}
Let ${\LKW}$ be the linearized KW operator on a compact manifold $M$ with boundary and suppose that $\rho$ is
not quasiregular, so that some $j_\sigma = 0$. Using the elliptic boundary condition given by the bundle map $\mathcal B_{\frak h}$,
then for $-1/2 < \lambda_0 < 0$, the mapping 
\begin{equation}
{\LKW}: \{\Psi \in \mathcal H_{\lambda_0}: \mathcal B_{\frak h}(\Psi_0) = 0\} \longrightarrow s^{\lambda_0 + 1/2} L^2(M)
\label{map12}
\end{equation}
is Fredholm. 
\end{prop}
\begin{prop}\label{regularity2}
With all notation as above, suppose that ${\LKW}\Psi = f$ where $f$ is smooth in a neighborhood of some point $q \in \del M$, 
or slightly more generally, where $f$ has an asymptotic expansion as $y \to 0$, and in addition $\mathcal B_{\frak h}(\Psi_0) = 0$
near $q$. Then in that neighborhood, $\Psi$ has a polyhomogeneous expansion 
\begin{equation}
\Psi \sim \sum y^{\gamma_j} \Psi_j,
\end{equation}
where the exponents $\gamma_j$ are of the form $\lambda + \ell$, $\ell \in \mathbb N$, where either $\lambda$ 
is an indicial root of ${\LKW}$ or else is an exponent occurring in the expansion of $f$. As before, this expansion may include log terms. 
\end{prop}
\begin{prop}
Let ${\LKW}$ be the linearized KW operator. If some $j_\sigma = 0$, then for $-1/2 < \lambda_0 < 0$ and relative 
to any choice of subalgebra $\frak h$, the mapping 
\begin{equation}
{\LKW}: y^{\lambda_0} \mathcal C^{k,\ell, \gamma}_0 \longrightarrow y^{\lambda_0 - 1} \mathcal C^{k-1, \ell, \gamma}_0
\label{Fredholder2}
\end{equation}
is Fredholm when $0 \leq \ell \leq k-1$ and $k \geq 1$. 
\label{maphold2}
\end{prop}

These results are proved, as before, using parametrix methods. Unlike the earlier case, this is a slightly
more involved process which requires the introduction of generalized Poisson and boundary trace operators;
see \cite{MVer}.   We find along the way that the analog of the refined mapping property of the generalized
inverse \eqref{refreghold2} still holds. 

\subsection{Regularity of Solutions of the KW Equations}\label{nonlinreg}

We have now described enough of the linear theory that we can formulate and prove the main result
needed earlier in the paper, that solutions of the full nonlinear gauge-fixed KW equations ${\KW}(A,\phi) = 0$
are also polyhomogeneous at $\partial M$. The implication of this regularity is that all the calculations
in section 2 which led to the uniqueness theorem when $M = \R^4_+$ are fully justified. (Of course,
this polyhomogeneity is far more than is really needed to carry out those calculations, but it is very
useful to have this sharp regularity for other purposes too.) 

\begin{prop} \label{propnlreg}
Let ${\KW}(A,\phi) = 0$, and suppose that near $y = 0$, $A = A_{(0)} + a$, $\phi = \phi_{(0)} + \varphi$,
where $(a,\varphi)$ satisfy the Nahm pole boundary conditions. Then $(a,\varphi)$ is polyhomogeneous.
\end{prop}

The proof begins by using \eqref{texpkw} to write ${\KW}(A, \phi) = 0$ as ${\LKW}(a,\varphi) = -Q(a,\varphi)$. 
Observe that since the terms in $\KW$ are at most quadratic, $Q$ is a bilinear form in $(a,\varphi)$.  We 
suppose from the beginning that $a$ and $\varphi$ lie in $y^{\lambda_0} \mathcal C^{1,\gamma}_0$, where the rate
of blowup (or decay) $\lambda_0$ is as dictated by the Nahm pole boundary condition.   The details 
of the proof are essentially the same in the simpler quasiregular case and in the more general 
case where some $j_\sigma = 0$. In  the former, $\overline{\lambda} =1$, $\underline \lambda=-1$, and we take
any elliptic weight $\lambda_0 \in 
(\underline{\lambda}, \overline{\lambda})$, while in the latter, generically we take $\lambda_0 \in (-1/2, 0)$ (if
$j_\sigma=1/2$ does not occur in the decomposition of $\frak g_\C$,  we can take $\lambda_0\in (-1,0)$),
and the generalized inverse is constructed using the more elaborate considerations of section \ref{genebc}.
The key facts that we use below, however, are the existence of a generalized inverse satisfying \eqref{geninv},
in particular so that the remainder term $R_1$ maps into a finite dimensional space of polyhomogeneous
fields and the fact that $G$ satisfies \eqref{refreghold2}. Although the construction of $G$ is more
complicated in the second case, we still end up with the result that both these properties hold then too.

There are two main steps. The first is to prove that $(a,\varphi)$ is conormal of order $\overline{\lambda}$, i.e. 
$(a,\varphi) \in \mathcal A^{\overline{\lambda}}$, which we recall means that 
\begin{equation}
(y\partial_y)^j \partial_{\vec x}^\alpha (a,\varphi) \in \bigcap_k y^{\overline{\lambda_0}} \mathcal C^{k,\gamma}_0
\label{conormal}
\end{equation}
for all $j$ and all multi-indices $\alpha$. In the second step we improve this to the existence of a polyhomogeneous expansion. 

Since $\lambda_0$ is an elliptic weight, there exists a generalized inverse $G$ for ${\LKW}$ which provides an 
inverse to \eqref{Fredholder} up to finite rank errors. Applying $G$ to ${\KW}(A,\phi) = 0$ gives
\begin{equation}
(a,\varphi) = - G Q(a, \varphi) + R_1 (a,\varphi).
\label{inteqn}
\end{equation}
The finite rank operator $R_1$ has range in the space of polyhomogeneous functions (with leading
term $y^{\overline{\lambda}}$), 
%\begin{equation*}
%\kappa_{R_1}( y, \vec x, y', \vec x\, ') = \sum_{\ell=1}^N  A_{j,\ell}(y, \vec x) B_{j,\ell} (y', \vec x\, '),
%\end{equation*}
%where both $A_\ell$ and $B_\ell$ are polyhomogeneous at $y=0$ and $N = \dim \ker {\LKW}$.  Thus $R_1$
maps into a finite dimensional space of polyhomogeneous functions, so the second term on the right is 
polyhomogeneous and hence negligible. We are thus free to concentrate on proving the regularity of the first term
on the right in \eqref{inteqn}.

We first assert that $(a,\varphi) \in y^{\overline{\lambda}} \mathcal C^{k,\gamma}_0$ for all $k \geq 0$. (Note that
this is not conormality since we are not yet applying the tangential vector fields $\del_{x^a}$ without the
extra factor of $y$.)   Since $Q$ is bilinear, we see first that $Q(a,\varphi) \in y^{2\lambda_0} \mathcal C^{1,\gamma}_0$.
so that from \eqref{refreghold2} with $k = 1$, and since $2\lambda_0 > \lambda_0 - 1$, we obtain
$(a,\varphi) \in y^{2\lambda_0 + 1} \mathcal C^{2,\gamma}_0 + y^{\overline{\lambda}}\mathcal C^{m,\gamma}_0$ for all $m$. 
After a finite number of iterations, the right hand side is contained in $y^{\overline{\lambda}}\mathcal C^{m,\gamma}_0$
for some $m$, and bootstrapping further shows that it lies in this space for all $m$. 

Revisiting this iteration, we can improve the regularity with respect to the vector fields $\partial_{x^a}$ as well. 
This relies on a structural fact about $0$-pseudodifferential operators already quoted at the end of section \ref{strgeninv},
nmely that 
\begin{equation*}
[ \partial_{x^a} , G] \in \Psi^{-1, 1, \overline{\lambda}, b}_0,
\end{equation*}
and hence this commutator satisfies the same mapping properties as $G$ itself. We apply this as follows. Write
\begin{equation*}
\partial_{x^a} (a,\varphi) = - G( \partial_{x^a} Q(a,\varphi) ) - [ \partial_{x^\alpha} , G] Q(a,\varphi).
\end{equation*}
We are discarding the term $R_1(a,\varphi)$ since it is already fully regular. It is convenient now to
regard $(a,\varphi)$ as lying in $y^{\lambda_0}\mathcal C^{m,\gamma}_0$ for $\lambda_0 = \overline{\lambda} - \epsilon$,
since we want to use the mapping properties of $G$ at a nonindicial weight. By the mapping properties 
of the commutator, the second term on the right lies in $\cap_m y^{\lambda_0} \mathcal C^{m,\gamma}_0$.
On the other hand, we write $\partial_{x^a} Q(a,\varphi) = y\partial_{x^a} (y^{-1} Q(a,\varphi))$. This lies
in $\cap_m y^{2\lambda_0 - 1} \mathcal C^{m,\gamma}_0$, since $y^{-1}Q(a,\varphi) \in \cap_m y^{2\lambda_0 - 1} \mathcal C^{m,\gamma}_0$
and $y\del_{x^a}$ preserves this property.  Since $G$ acts on this space, the entire first term lies in $\cap_m y^{\lambda_0} 
\mathcal C^{m,\gamma}_0$. This proves that $(a,\varphi) \in \cap_m \mathcal C^{m,1, \gamma}_0$. The same argument improves the tangential 
regularity incrementally, so $(a,\varphi) \in y^{\lambda_0} \mathcal C^{k,\ell,\gamma}_0$ for all $0 \leq \ell \leq k < \infty$.
Recalling \eqref{refreghold2} again, we can now replace $\lambda_0$ by $\overline{\lambda}$. This proves that
$(a,\varphi) \in \mathcal A^{\overline{\lambda}}$. 

The second main step of the proof is easier. We wish to prove that $(a,\varphi)$ has an expansion. This relies on
the observation that we can treat the nonlinear equation ${\KW}(A_{(0)}+a, \phi_{(0)}+\varphi) = 0$ as a nonlinear 
ODE in $y$, regarding the dependence on $\vec x$ as parametric. This is reasonable since $(a,\varphi)$ 
is completely smooth in this tangential variable. Thus we can decompose the linear term in \eqref{texpkw} 
further using the indicial operator $I({\LKW})$ (introduced in eqn.\ (\ref{indicialop})) at any given boundary point to get
\begin{equation}
I({\LKW}) (a, \varphi) = (I({\LKW})-\LKW) (a,\varphi) - Q(a,\varphi).
\label{iter}
\end{equation}
The two terms on the right lie in $y^{\lambda_0 } \mathcal A$ and $y^{2\lambda_0} \mathcal A$, respectively. 
(We recall that $I({\LKW}) - {\LKW}$ has no $\partial_y$ or $1/y$ terms; the coefficients of this
difference are smooth to $y=0$.)  Integrating this ODE shows that $(a,\varphi)$ is a finite sum of terms 
$(a_j, \varphi_j) y^{\lambda_j}$, where the $\lambda_j$ are the indicial roots of ${\LKW}$ which lie between $\lambda_0$ 
and $\mu = \min\{2\lambda_0+1, \lambda_0 + 1\}$, and an error term vanishing at this faster rate $y^\mu$. 
At the next step, inserting this new information into \eqref{iter} shows that this is now an ODE where the right 
side has a partial expansion up to order $\min\{\mu, 2\mu\}$ plus an error term vanishing at that rate,
and so $(a,\varphi)$ has a partial expansion up to order $\mu_2 = \min \{\mu + 1, 2\mu + 1\}$. 
This completes the proof of the existence of the expansion of $(a,\varphi)$ in the case
where $\lambda_0 \in (0, \overline{\lambda})$ is an elliptic weight. 

\appendix
\section{Some Group Theory}\label{groups}
\def\frak{\mathfrak}


The purpose of this appendix is to describe some basic facts and examples in group theory as background to the paper.  

First of all, up to isomorphism, the group $SU(2)$ or equivalently the Lie algebra $\frak{su}(2)$ has precisely
one irreducible representation of dimension $n$, for each positive integer $n$.  
It is convenient to write $n=2j+1$ where $j$ is a non-negative integer or half-integer called the spin.
If $v_j$ denotes an irreducible $\frak{su}(2)$ representation of spin $j$, then for $j\geq j'$, we have
\begin{equation}\label{decomp}v_j\otimes v_{j'}\cong \oplus_{j''=j-j'}^{j+j'}v_{j''}. \end{equation}

Now, for $N\geq 2$,  we will describe group 
homomorphisms $\varrho:SU(2)\to G=SU(N)$, or equivalently Lie algebra homomorphisms $\varrho:\frak{su}(2)\to \frak \frak{su}(N)$.
To describe such a homomorphism amounts to describing how the fundamental $N$-dimensional representation of $SU(N)$,
which we denote $V$, transforms under $\varrho(SU(2))$.  As an $SU(2)$-module, $V$ 
will have to be the direct sum of a number of irreducible $SU(2)$ modules $v_{j_i}$ of dimension $n_i=2j_i+1$, for some $j_i$.
The possibilities simply correspond to partitions of $N$, that is to ways of writing
$N$ as an (unordered) sum of positive integers,
\begin{equation}\label{ecomp}N=n_1+n_2+\dots+n_s. \end{equation}
For example, the trivial homomorphism $\varrho:\frak{su}(2)\to\frak{su}(N)$, which maps $\frak{su}(2)$ to 0,
 corresponds to the partition $N=1+1+\dots+1$ with $N$ terms. 
 At the other extreme, a principal embedding of $\frak{su}(2) $ in $\frak{su}(N)$
(which is the most important example for the present paper) corresponds to the partition with only one term, the integer $N$.

In general, we define the commutant $C$ of $\varrho$ as the subgroup of $SU(N)$ that commutes with $\varrho(SU(2))$;
its Lie algebra $\frak c$ is the subalgebra of $\frak{su}(n)$ that commutes with $\varrho(\frak{su}(2))$.  
If $\varrho$ corresponds as in eqn.\ (\ref{ecomp}) to a partition with $s$ terms, then $C$ is a Lie group of rank $s-1$.
(It is abelian if and only if the $n_i$ are all distinct.)  In particular, for $G=SU(N)$, the only case that $C$ is a finite group (or equivalently
a group of rank 0) is
that $s=1$, meaning that $\varrho$ is a principal embedding.  In this case, $C$ is simply the center of $G$.  Whenever $s>1$,
$C$ has a non-trivial Lie algebra, and this means, in the language of section \ref{second}, that $j_\sigma=0$ occurs
in the decomposition of $\frak g_\C$ under $\frak{su}(2)$.  Thus, for $G=SU(N)$, the only case that $j_\sigma=0$ does
not occur in this decomposition is the  case that $\varrho$ is a principal embedding. 

To explicitly decompose $\frak{su}(N)$ under $\varrho(\frak{su}(2))$, we use the fact that $\frak{su}(N)$ is the traceless
part of $\mathrm{Hom}(V,V)$; equivalently it can be obtained from $V\otimes V^\vee$ by omitting a 1-dimensional
trivial representation.  (Here $V^\vee$ is the dual of $V$.)  Any $\frak{su}(2)$-module is isomorphic to its own dual,
so as a $\frak{su}(2)$ module, $\frak{su}(N)$ is $V\otimes V$ with a copy of the trivial module $v_0$ removed.  
For example, if $\varrho$ is a principal embedding, so that $V$ is an irreducible $\varrho(\frak{su}(2))$ 
module $v_j$ with $N=2j+1$, then we use (\ref{decomp}) to learn that $\frak{su}(N)$ is the direct sum of
$\frak{su}(2)$-modules of spins $j_\sigma=1,2,\dots, N-1$.  

As a corollary, we note that if $j_\sigma=0$ does not occur in the decomposition of $\frak{su}(n)$ (which happens only
if $\varrho$ is principal), then the $j_\sigma$'s are integers and in particular $j_\sigma=1/2$ does not occur in the decomposition
of $\frak{su}(n)$.  As explained below, this statement has an analog for any simple Lie group $G$.
A few additional facts that follow from the above discussion of $SU(N)$ hold for all $G$.
The number of summands in the decomposition of $\frak g$ under a principal $\frak{su}(2)$ subalgebra 
 is always the rank of $G$ (this rank is $N-1$ for $G=SU(N)$).  Also, the minimum
value of $j_\sigma$ for a principal embedding is always
 $j_\sigma=1$, and this value occurs with multiplicity 1,  corresponding to the $\frak{su}(2)$ submodule
$\varrho(\frak{su}(2))\subset \frak g$.   
 

With similar elementary methods, we can analyze the other classical groups $SO(N)$ and $Sp(2k)$. 
Here the following is useful.  An $SU(2)$ module $v$ is said to be real, or to admit a real structure, if there
is a symmetric, non-degenerate, and $SU(2)$-invariant map $v\otimes v\to \C$; it is said to be pseudoreal, or to admit
a pseudoreal structure, if there is an antisymmetric, non-degenerate, and $SU(2)$-invariant map $v\otimes v\to \C$.
The representation $v_j$ is real (but not pseudoreal) if $j$ is an integer, or equivalently the dimension
 $n=2j+1$ is odd, and pseudoreal  (but not real) if $j$ is a half-integer, or equivalently the dimension $n=2j+1$ is even. 
 If $w$ is a 2-dimensional complex vector space (with trivial $SU(2)$ action), then $w$ admits both a symmetric nondegenerate
map $w\otimes w\to \C$ and an antisymmetric one.  So if $v$ is either real or pseudoreal, then $v\oplus v\cong v\otimes w$
admits both a real structure and a pseudreal one.
Suppose that
\begin{equation}\label{morex}v=\oplus_{j\geq 0}a_j v_j,~~~   a_j\in \Bbb Z\end{equation}
is an $SU(2)$ module that is the direct sum of $a_j$ copies of $v_j$ (with almost all $a_j$ vanishing).  
The criterion
for $v$ to be real or pseudoreal reduces to separate conditions on each $a_j$:
$v$ is real precisely if $a_j$ is even for half-integer $j$ (with no restriction for integer $j$), and $v$ is pseudoreal precisely if
$a_j$ is even for integer $j$ (with no restriction for half-integer $j$).  

Now let us consider homomorphisms $\varrho:SU(2)\to G$ for $G=SO(N)$.
Such a homomorphism can be described by giving the decomposition of the fundamental
$N$-dimensional representation $V$ of $SO(N)$ as an $SU(2)$-module.  Thus, such a homomorphism
again determines a partition of the integer $N$, as in (\ref{ecomp}).  However, now we must impose the condition that
the representation $V$ of $SO(N)$ is real.  In view of the statements in the last paragraph,
the condition that this imposes on the partition is simply that even integers $n_i$ in (\ref{ecomp}) must occur with even
multiplicity.

The condition that the commutant $C$ of $SU(2)$ -- or more precisely of $\varrho(SU(2))$ --
is a finite group, and hence that $j_\sigma=0$ does not
occur in the decomposition of the Lie algebra $\frak{so}(N)$, is\footnote{If an  integer $n_i$ appears with multiplicity $d_i$ in the partition of $N$,
then the commutant of $\frak{su}(2)$ in $SO(N)$ contains a factor of $SO(d_i)$ if $n_i$ is odd or $Sp(d_i)$ if $n_i$ is even.  (The last statement
makes sense because $d_i$ is always even when $n_i$ is even.)  
Hence the group $C$ is finite if and only if the $n_i$ are all distinct, so that the $d_i$ are 0 or 1.
The last statement is true for $G=Sp(2k)$ for similar reasons: if an integer $n_i$ appears with multiplicity $d_i$ in the partition of $2k$, then the commutant contains a factor of
$SO(d_i)$ if $n_i$ is even and of $Sp(d_i)$ if $n_i$ is odd.  (For $G=Sp(2k)$,  $d_i$ is even when $n_i$ is odd.)}  that the integers $n_i$ in the partition must be all distinct.
But since even integers must occur with even multiplicity, this   implies that the $n_i$ must be odd.  For example, if $N$ is odd,
a principal embedding of $\frak{su}(2)$ in $\frak{so}(N)$ corresponds to a partition with only one term, the integer $N$.
But if $N$ is even, a principal embedding corresponds to the two-term partition $N=1+(N-1)$.  For $SO(N)$, in contrast to $SU(N)$,
 an embedding that is not principal can still have a trivial commutant.  For example, for $N=9$,
the partition $9=1+3+5$ represents 9 as the sum of distinct odd integers; this embedding is not principal, but its commutant
 is a finite group.  When the commutant is not a finite group,  it has a Lie algebra of positive dimension and hence $j_\sigma=0$ occurs in the
decomposition of $\frak{so}(n)$ under $\frak{su}(2)$.

For $G=SO(N)$, rather as we found for $SU(N)$,
 there is also a useful elementary criterion that ensures that $j_\sigma=1/2$ does not appear in the decomposition
of $\frak{so}(n)$. In fact, there is a useful criterion that ensures that no half-integer value of $j_\sigma$ occurs
in this decomposition.  For this, we first recall that $\frak{so}(N)\cong \wedge^2 V\subset V\otimes V$.  
For a given $\frak{su}(2)$ embedding, the decomposition of $V\otimes V$ under $\frak{su}(2)$ can be worked out using (\ref{decomp}).
One finds that half-integer values of $j$ occur in $V\otimes V$ (and also in $\wedge^2V$) if and only if both
odd and even integers $n_i$ occur in the chosen partition  of $N$.  But we have already observed that if even integers
appear in this partition, then $j_\sigma=0$ occurs in the decomposition of $\frak{so}(n)$ under $\frak{su}(2)$.
So if $j_\sigma=0$ does not occur in the decomposition of $\frak{so}(n)$, then $j_\sigma=1/2$ also does not occur.

The case that $G=Sp(2k)$ for some $k$ can be analyzed similarly, with the words ``even'' and ``odd'' exchanged in some statements.
A homomorphism from $SU(2)$ to $Sp(2k)$ can be described by giving the decomposition of the $2k$-dimensional representation
$V$ of $Sp(2k)$ as a direct sum of $SU(2)$ modules.  Thus, such a homomorphism determines a partition $2k=n_1+n_2+\dots+n_s$.
Now the fact the representation $V$ of $Sp(2k)$ is pseudoreal implies that odd integers occur in this partition with even multiplicity.
The condition that the commutant $C$ is a finite group, so that $j_\sigma=0$ does not occur in the decomposition
of $\frak{sp}(2k)$ under $\frak{su}(2)$,  is again that the integers appearing in the partition should be distinct.
But now this implies that these integers are all even.  A principal embedding is the case that the partition consists of only of a single
integer $2k$.   Just as for $SO(N)$, there are non-principal embeddings with the property that $j_\sigma=0$ does not occur
in the decomposition of $\frak{sp}(2n)$; these correspond to partitions of $2k$ as the sum of distinct even integers, for example
$6=2+4$.

By the same argument as for $SO(N)$, one can show that if $j_\sigma=0$ does not occur in the decomposition of $\frak{sp}(2k)$,
then half-integer values of $j_\sigma$ do not occur and in particular $j_\sigma=1/2$ does not occur.  For this, one uses
the fact that $\frak{sp}(2k)\cong {\mathrm{Sym}}^2V\subset V\otimes V$, along with the rule (\ref{decomp}) for decomposition of tensor
products.

To understand homomorphisms from $SU(2)$ to an exceptional Lie group $G$, it is probably best to use less elementary
methods, and we will not explore this here.  We remark, however,  that the following feature of the above examples
is actually true for any simple Lie group $G$:  if $j_\sigma=0$ does not occur in the decomposition of $\frak g_\C$ under $\frak{su}(2)$,
then only integer values of $j_\sigma$ occur in this decomposition and in particular $j_\sigma=1/2$ does not occur.  (For a proof,
see the next paragraph.)
Given this, it follows from the formulas of section \ref{throots} that if $j_\sigma=0$ does not occur in the decomposition
of  $\frak g_\C$, then there are no indicial roots in the gap between $\underline\lambda=-1$ and $\overline\lambda=1$.
Both $-1$ and $1$ always are indicial roots in this situation, 
since $j_\sigma=1$ always occurs in the decomposition of $\frak g_\C$, the corresponding subspace of $\frak g_\C$ being
$\varrho(\frak{su}(2))$.

A proof of a claim in the last paragraph was sketched for us by B. Kostant.  The complexification of  $\varrho$ is a homomorphism
of complex Lie algebras $\varrho:\frak{sl}_2(\C)\to \frak g_\C$.  We take a standard basis $(h,e,f)$ of $\frak{sl}_2(\C)$ and
write simply $(h,e,f)$ for their images in $\frak g_\C$.    The hypothesis that half-integer values of $j_\sigma$ occur in the decomposition
of $\frak g_\C$ means, in the terminology of \cite{Carter}, p. 165, that $e$ is not even.
 In this case, according to Proposition 5.7.6 of that
reference, $e$ is not distinguished, and therefore, according to Proposition 5.7.4 of the same reference, the homomorphism $\mathrm{ad}(e):
\frak g(0)\to \frak g(2)$ has a non-trivial kernel.  This kernel is the commutant $\frak c$ of $\varrho(\frak{sl}_2(\C))$.
\vskip1cm
 \noindent {\it {Acknowledgements}}  Research of RM supported in part by NSF Grant DMS-1105050.
 Research of EW supported in part by NSF Grant PHY-1314311.
 
  \bibliographystyle{unsrt}
\begin{thebibliography}{99}

\bibitem{Nahm}
W. Nahm, ``A Simple Formalism For The BPS Monopole,'' Phys. Lett. {\bf B90} (1980) 413.

\bibitem{K}
P. Kronheimer, ``Instantons And The Geometry Of The Nilpotent Variety,'' J. Diff. Geom.
{\bf 32} (1990) 473-90.

\bibitem{Diaconescu}
D.-E. Diaconescu, ``D-Branes, Monopoles, and Nahm Equations,'' Nucl. Phys. {\bf B503}
(1997) 220238, hep-th/9608163.

\bibitem{fuzzy}
N. R. Constable, R. C. Myers, and O. Tafjord, ``The Noncommutative BIon Core,'' Phys. Rev.
{\bf D61} (2000) 106009, arXiv:9911136. 

\bibitem{GW}
D. Gaiotto and E. Witten, ``Supersymmetric Boundary Conditions In $\N=4$ Super Yang-Mills Theory,'' J. Stat. Phys. {\bf 135} (2009) 789-855,
 arXiv:0804.2902.
 
 \bibitem{KW}
 A. Kapustin and E. Witten,  ``Electric-Magnetic Duality And The Geometric Langlands Program,'' Commun. Numb. Th. Phys. {\bf 1} (2007) 
1-236,  hep-th/0604151.

\bibitem{WittenK}
E. Witten, ``Fivebranes And Knots,'' Quantum Topology {\bf 3} (2012) 1-137, arXiv:1101.3216.

\bibitem{WittenKtwo}
E. Witten, ``Khovanov Homology And Gauge Theory,'' in  R. Kirby, V. Krushkal, and Z. Wang, eds.,
{\it Proceedings Of The FreedmanFest} (Mathematical Sciences Publishers, 2012) 291-308,
arXiv:1108.3103.

\bibitem{haydys}
A. Haydys, ``Fukaya-Seidel Category And Gauge Theory,'' J. Symplectic Topology, to appear,
arXiv:1010.2353.
\bibitem{Taubes}
C. H. Taubes,  ``Compactness Theorems For $SL(2;\C)$ Generalizations Of The Anti-Self Dual Equations, Part I,''
arXiv:1307.6447.

\bibitem{Taubestwo}
C. H. Taubes,  ``Compactness Theorems For $SL(2;\C)$ Generalizations Of The Anti-Self Dual Equations, Part II,''
arXiv:1307.6451.


\bibitem{GU}
M. Gagliardo and K. Uhlenbeck, ``The Geometry Of The Kapustin-Witten Equations,'' J. Fixed Point Theory Appl. {\bf 11} (2012) 185-198.

\bibitem{M-edge} R. Mazzeo ``Elliptic Theory of Differential Edge Operators, I'' Comm. P.D.E. {\bf 16} No. 10 (1991) 1616-1664.

\bibitem{Mikhaylov}
V. Mikhaylov, ``On The Solutions Of Generalized Bogomolny Equations,'' arXiv:1202.4848.

\bibitem{GWtwo}
D. Gaiotto and E. Witten, ``Knot Invariants From Four-Dimensional Gauge Theory,''
Adv. Theor. Math. Phys. {\bf 16} (2012) 3, 935-1086, 
 arXiv:1106.4789.

\bibitem{corlette}
K. Corlette, ``Flat $G$-Bundles With Canonical Metrics,'' J. Diff. Geom. {\bf 28} (1988) 361-82.

\bibitem{BBW} B. Booss-Bavnbek and K. Wojciechowski, ``Elliptic Boundary Problems for Dirac Operators''  Birkh\"auser (1993).

\bibitem{MVer} R. Mazzeo and B. Vertman ``Elliptic theory of Differential Edge Operators, II: Boundary Value Problems''.  arXiv:1307.2266.

\bibitem{Carter}
R. W. Carter, {\it Finite Groups Of Lie Type} (Wiley-Interscience, 1985). 

\end{thebibliography}
\end{document}
========================================

\documentclass[11pt,a4paper]{article}

\usepackage{cite}

\usepackage{amsmath, amsthm,mathtools,setspace, url,amssymb,upgreek,textgreek,slashed,hyperref}

%%%
 \usepackage[mathscr]{eucal}
\usepackage{ifpdf}
%\usepackage[tocskip=-10pt]{parskip2}
\ifpdf
  \usepackage[pdftex]{graphicx}
  \usepackage{epstopdf}
\else
  \usepackage[dvips]{graphicx}
\fi
%%%
\textheight 8.5in \textwidth 6.5in \oddsidemargin 0in \topmargin-.35in
\parskip=\baselineskip

\def\TFD{{\mathrm{TFD}}}

\begin{document}
\begin{titlepage}
\begin{flushright}

\end{flushright}

\vskip 1.5in
\begin{center}
{\bf{Why Does Quantum Field Theory In Curved Spacetime Make Sense? }}\\ \vskip.5cm
{\bf {And What Happens To The Algebra of Observables In The Thermodynamic Limit?}
}

\vskip
0.5cm  { Edward Witten} \vskip 0.05in {\small{ \textit{Institute for Advanced Study}\vskip -.4cm
{\textit{Einstein Drive, Princeton, NJ 08540 USA}}}
}
\end{center}
\vskip 0.5in
\baselineskip 16pt
\begin{abstract}  This article aims to explain some of the basic facts about the questions
raised in the title, without  the technical details that are available in the literature.   We provide a gentle introduction
to some rather classical results about quantum field theory in curved spacetime and about the thermodynamic limit of quantum statistical
mechanics.   We also briefly explain that  these results have an analog in  the large $N$ limit of gauge theory.      \end{abstract}
%
\date{December, 2021}
\end{titlepage}
\def\SO{{\mathrm{SO}}}
\def\G{{\text{\sf G}}}
\def\frak{\mathfrak}
\def\la{\langle}
\def\ra{\rangle}
\def\Spinc{{\mathrm{Spin}}_c}
\def\g{{\mathfrak g}}
\def\cl{{\mathrm{cl}}}
\def\m{{\sf m}}
\def\veps{\varepsilon}
\def\Re{{\mathrm{Re}}}
\def\Im{{\mathrm{Im}}}
\def\SU{{\mathrm{SU}}}
\def\SL{{\mathrm{SL}}}
\def\a{{\sf a}}
\def\b{{\sf b}}

\def\M{{\mathcal M}}
\def\d{{\mathrm d}}
\def\g{{\mathfrak g}}
\def\su{{\mathfrak {su}}}
\def\CS{{\mathrm{CS}}}
\def\Z{{\Bbb Z}}
\def\cB{{\mathcal B}}
\def\zZ{{\mathcal Z}}
\def\DD{{\mathscr D}}
\def\R{{\Bbb R}}
\def\sF{{\sf F}}
\def\cS{{\mathcal S}}
\def\sB{{\sf B}}
\def\sA{{\sf A}}
\def\sD{{\mathcal D}}
\def\dD{{\mathrm D}}
\def\F{{ \mathscr F}}
\def\cF{{\mathcal F}}
\def\J{{\mathcal J}}
\def\Bbb{\mathbb}
\def\Tr{{\rm Tr}}
\def\ad{{\mathrm{ad}}}
\def\j{{\sf j}}
\def\16{{\bf 16}}
\def\1{{(1)}}
\def\bCP{{\Bbb{CP}}}
\def\2{{(2)}}
\def\3{{\bf 3}}
\def\4{{\bf 4}}
\def\free{{\mathrm{free}}}
\def\sg{{\mathrm g}}
\def\J{{\mathcal J}}
\def\i{{\mathrm i}}
\def\h{\widehat}
\def\HP{{{H\negthinspace P}}}
\def\u{u}
\def\D{D}
\def\Rf{{\eurm{R}}}
\def\sp{{\sigma}}
\def\E{{\mathcal E}}
\def\O{{\mathcal O}}
\def\OO{{\mathrm O}}
\def\PF{{\mathit{P}\negthinspace\mathit{F}}}
\def\tr{{\mathrm{tr}}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
 \def\Sp{{\mathrm{Sp}}}
  \def\PSp{{\mathrm{PSp}}}
 \def\Spin{{\mathrm{Spin}}}
 \def\SL{{\mathrm{SL}}}
 \def\SU{{\mathrm{SU}}}
 \def\SO{{\mathrm{SO}}}
 \def\PGL{{\mathrm{PGL}}}
 \def\ll{\langle\langle}
 \def\frL{{{\mathfrak L}}}
 \def\RR{{\mathcal R}}
\def\rr{\rangle\rangle}
\def\la{\langle}
\def\CP{{C\negthinspace P}}
\def\sCP{{\sf{CP}}}
\def\I{{\mathcal I}}
\def\ra{\rangle}
\def\T{{\mathcal T}}
\def\V{{\mathcal V}}
\def\bar{\overline}
\def\spinc{{\mathrm{spin}_c}}
\def\dim{{\mathrm{dim}}}
\def\v{v}
\def\Pic{{\mathrm{Pic}}}

\def\RP{{\Bbb{RP}}}
\def\C{{\mathbb C}}
\def\tilde{\widetilde}
\def\t{\widetilde}
\def\R{{\Bbb{R}}}
\def\N{{\mathcal N}}
\def\B{{\mathcal B}}
\def\H{{\mathcal H}}
\def\hat{\widehat}
\def\Pf{{\mathrm{Pf}}}
\def\bM{{\overline\M}}
\def\PSL{{\mathrm{PSL}}}
\def\PSU{{\mathrm{PSU}}}
\def\Im{{\mathrm{Im}}}
\def\Gr{{\mathrm{Gr}}}
\def\sign{{\mathrm{sign}}}

\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}
\numberwithin{equation}{section}
%\newcommand{\lmark}{{\usefont{U}{eur}{m}{n}\symbol{"4C}}}
\def\lmark{{\mathrm L}}
\def\neg{\negthinspace}

\def\C{{\Bbb C}}
\def\K{{\mathcal K}}
\def\cc{{\mathrm{cc}}}
\def\bB{{\bar {\mathscr B}}}
\def\HH{{\mathbb H}}
\def\P{{\mathcal P}}
\def\Q{{\mathcal Q}}
\def\NS{{\sf{NS}}}
\def\Ra{{\sf{R}}}
\def\sV{{\sf V}}
%\def\CP{{C\negthinspace P}}
\def\CP{{\mathrm{CP}}}
\def\Hom{{\mathrm{Hom}}}
\def\Z{{\Bbb Z}}
\def\op{{\mathrm{op}}}
\def\bop{{\overline{\mathrm{op}}}}
\def\bA{\bar{\mathscr A}}
\def\A{{\mathscr A}}
\def\cA{{\mathcal A}}
\def\B{{\mathscr B}}
\def\S{{\sf S}}
\def\bar{\overline}
\def\sc{{\mathrm{sc}}}
\def\Max{{\mathrm{Max}}}
\def\CS{{\mathrm{CS}}}
\def\ga{\gamma}
\def\bg{\bar\ga}
\def\Arg{{\mathrm{Arg}}}
\def\W{{\mathcal W}}
\def\M{{\mathcal M}}
\def\bM{{\overline \M}}
\def\L{{\mathcal L}}
\def\sM{{\sf M}}
\def\gst{\mathrm{g}_{\mathrm{st}}}
\def\gstt{\widetilde{\mathrm{g}}_{\mathrm{st}}}
\def\hbbar{\pmb{\hbar}}
\def\G{{\mathcal G}}
\def\Sym{{\mathrm{Sym}}}
\def\U{{\mathcal U}}
\def\Bun{{\mathcal M}(G,C)}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\Diff{{\mathrm{Diff}}}
\def\diff{{\mathrm{diff}}}

\tableofcontents


\section{Introduction}\label{intro}


The first goal of the present article is to provide some intuition about a basic question: Why does quantum
field theory in a curved spacetime of Lorentz signature make sense?   
 Here we will give an informal introduction, referring the reader  to the literature for more detail.
An inevitably partial list of references on the general topic of quantum field theory in curved spacetime is
   \cite{DeWitt, FSW,FNW, BD,Fulling, Kay,BOS,WaldBook,BFV,F, HW,BF,PT,Fewster}.  For some technical detail on the specific topics that will be described   rather heuristically here, the reader  might
    start with the   book  \cite{WaldBook}.   Another useful reference is the collection of articles \cite{BF}.
 
 
 
We consider  always  a globally hyperbolic spacetime, which means a spacetime $M$
with a complete Cauchy hypersurface $S$ on which  initial conditions for classical or quantum fields can be formulated.   The sense in which quantum field
theory can be formulated on $M$ depends very much on whether $S$ is compact.   In a 
 closed universe, in other words if $S$ is compact,
the usual Hilbert space  formulation of quantum field theory is valid: to a quantum field theory on $M$, we can associate in a natural way a Hilbert space 
$\H$, such that the quantum dynamics of the given theory 
can be described  in the usual way in terms of operators acting on $\H$.    However, in contrast to the possibly more familiar case of
quantum field theory in Minkowski spacetime, there is generically no distinguished ground state or vacuum vector in $\H$, since there is no natural ``energy''
that we should try to minimize.   Thus, in formulating quantum field theory in curved spacetime, one should become accustomed to the idea of a naturally
defined Hilbert space that does not contain any distinguished vector.\footnote{A corollary is that in a general spacetime, there is no useful
notion of a particle: particles in quantum field theory (or quasiparticles in condensed matter physics) are defined  as
excitations of a distinguished ground state with certain asymptotic properties, so in the absence of any preferred state, and in the absence, for a general $M$, of any asymptotic region where asymptotic
properties could be defined, there is no notion of a ``particle.''}

The case that $S$ is not compact, and with no simplifying assumptions about the behavior at infinity along $S$, is quite different.   In this case, a natural
construction of a Hilbert space does not exist.   Instead, roughly speaking, one has to work with density matrices for local algebras of observables, more precisely
an algebra $\A_U$ for each bounded open set $U\subset M$. And roughly speaking, quantum field theory on $M$ describes the evolution not of a quantum state but of a density matrix.  Actually a slight generalization of the notion of a density matrix is needed, 
because in quantum field theory the algebras $\A_U$ are von Neumann algebras of Type III, not of Type I
\cite{ArakiQFT,Fred,HaagBook,Yng,WittenNotes}, as  will be explained in due course.

To be more precise,
 the statement that there is no natural Hilbert space to describe quantum field theory in an open universe holds
generically, that is in the absence of any special assumptions about what is happening at spatial infinity.   With suitable conditions at infinity (such as asymptotic
flatness), a natural Hilbert space is sometimes available.
A typical example in which a natural Hilbert space does not exist is an open Big Bang cosmology -- for
example an expanding universe with spatial sections of zero or negative curvature.   In such a case, quantum dynamics must be described by evolution of density matrices
(or more precisely of the Type III generalization of density matrices), not by operators on a Hilbert space.  

This difference between  a closed universe and  a generic open one might come as a surprise, but  actually has little
to do with any details of quantum field theory.   The phenomenon results purely from the fact that, even with an ultraviolet cutoff in place, the number of
degrees of freedom  in an open universe is infinite.   Thus a rather similar phenomenon occurs in the thermodynamic limit of quantum statistical mechanics.
In finite volume, a quantum field theory has a Hilbert space $\H$, and thermodynamic functions such as entropy, energy density, etc., can be computed
by studying a density matrix  $\rho=\frac{1}{Z}e^{-\beta  H}$ on $\H$ (as usual, $H, \beta,$ and $Z$ are the Hamiltonian, inverse temperature, and
partition function).    Thermodynamic functions and correlation functions can be computed in finite volume and they have a large volume limit.  However, if one aims
to describe statistical mechanics directly in the large volume limit, one runs into the fact that at nonzero temperature, the Hilbert space $\H$ does not
have a large volume limit, for reasons similar to what happens in quantum field theory
in an open universe.   There is a cure for this problem  \cite{HHW}, which is to use the thermofield double, namely $\rho^{1/2}=\frac{1}{\sqrt Z}e^{-\beta H/2}$, regarded not as an operator on $\H$
but as a vector in the tensor product of two copies of $\H$.   Starting with the thermofield double state $\Psi_\TFD=\rho^{1/2}$, one can build a Hilbert space 
$\H_\TFD$ that
has an infinite volume limit, and such that thermodynamic functions and expectation values in the infinite volume thermal ensemble can be computed
as correlation functions of  operators acting in $\H_\TFD$.   A price one pays is that the operators of the original system, when interpreted
as operators on $\H_\TFD$, naturally generate a von Neumann algebra $\A_\TFD$ of Type III, not a more familiar algebra of Type I.   
The Hamiltonian operator acting on just one of the two copies in the thermofield double is {\it not} well-defined and in particular
is not part of $\A_\TFD$.  Rather, the generator of time translations acts on both copies in the thermofield double and generates an outer automorphism of $\A_\TFD$.

The need to go to the thermofield double in the thermodynamic limit of quantum statistical mechanics is quite analogous to the need to use density matrices
(or their Type III analog) 
 for quantum fields in a generic open universe.   There is also a close analogy between the reasons for the occurrence of Type III algebras.  In each of the
 two cases, the Type III nature of the algebra results from   a divergent amount of entanglement.  
In statistical mechanics, there is divergent entanglement between the two copies of the original system that make up the 
thermofield double, and in quantum field theory in curved spacetime,
there is divergent entanglement between modes inside and outside a given bounded region of space.   One divergence is an infrared divergence and one is an ultraviolet
divergence, but nonetheless they are quite similar.    Indeed  in the case of a conformal field theory, one can make a direct conformal 
mapping between the two types of divergence.

In the course of our study of the thermofield double, we will become familiar with the basic facts about (hyperfinite) von Neumann algebras, which come in three types,
Type I, Type II, and Type III. All of these algebras can be constructed from simple qubit systems.  The familiar algebras are of Type I.   As already mentioned, 
the local algebras of quantum field theory, and likewise  the algebras of observables in the infinite volume limit of quantum statistical mechanics, are of Type III.  

 In section \ref{QFT}, we provide a gentle introduction to the facts about quantum field theory in curved spacetime that were summarized earlier.
 The aim is to motivate the statements and help the reader gain an intuition.   In section \ref{Thermo}, we discuss in a similar spirit the 
 thermodynamic limit of quantum statistical  mechanics and the thermofield double.
This article was originally planned as an exposition of those matters, along the lines of 
a lecture at the 2021 Bootstrap Summer School, where the most important points are outlined  \cite{Lecture}.
  However, a recent article by  Leutheusser and Liu \cite{LL}, with some novel observations about quantum black holes,  suggested
that it would be worth while to discuss  from a similar point of view the large $N$ limit of gauge theory.  These issues are briefly discussed
in section \ref{large}.   More detail on some aspects, including a role for algebras of Type II in the presence of gravity,  will appear elsewhere \cite{WittenNew}.

In analyzing  quantum field theory in Lorentz signature, we will not make use of knowledge about what happens in Euclidean signature.   This
is in common with the existing literature, and there is a simple reason for it:  a generic Lorentz signature spacetime does not have any useful Euclidean continuation.
However, Euclidean field theory is powerful, and it is a pity not to  be able to apply this power to the Lorentz signature case.   A recent analysis of
quantum field theory on a spacetime with a complex metric \cite{KS} offers hope that it will be possible to bridge the gap and apply Euclidean-style reasoning
to the Lorentz signature case.
 
 \section{Quantum Field Theory in Curved Spacetime}\label{QFT}
 
 \subsection{The Problem}\label{problem}
 
 As a motivating example of the problem of quantum field theory in curved spacetime, 
 consider a free field theory coupled to a background metric $g$ of Lorentz signature $-++\cdots+$ on a $D$-manifold $M$.
 For example, a real scalar of mass $m$ is defined by an action 
 \be\label{scaction} I=-\frac{1}{2}\int\d^D x \sqrt g \left(g^{\mu\nu}\partial_\mu\phi\partial_\nu\phi +m^2\phi^2\right). \ee
 
 We assume that $M$ is a globally hyperbolic manifold with complete Cauchy hypersurface $S$.   The field $\phi$ obeys a second order wave equation
 \be\label{secondorder}(D^\mu D_\mu+m^2)\phi(\vec x,t)=0,\ee
 and initial data consist of the field $\phi$ and its normal derivative $\dot\phi$ along $S$.   These initial data are supposed to satisfy the usual canonical
 commutation relations $[\dot\phi(x),\phi(y)]=-\i \delta(x,y)$, with other commutators vanishing.    
 
 One of the most important facts about quantum mechanics is that given 
 any {\it finite} set of canonical variables $p_i,x^j, ~i,j=1,\cdots,d$ with the usual commutation relations
 $[p_i,x^j]=-\i \delta_i^j$, $[p_i,p_j]=[x^i,x^j]=0$, the Hilbert space $\H$ that provides an irreducible representation of this algebra exists and is unique up to isomorphism.
 $\H$ can be realized as a space of square-integrable functions (more canonically, half-densities) of $\vec x$, or as a space of square-integrable functions of $\vec p$.
 One can also work with holomorphic functions of $z_i=x^i+\i p_i$.  Many slight generalizations and combinations of these constructions are also possible.
These constructions can all be shown to be equivalent by Fourier transformations and more general unitary transformations. More generally, 
according to a theorem of  von Neumann \cite{vNe}, the quantization of $\R^{2d}$  is unique, up to isomorphism, as long as one requires 
that $\vec x$ and $\vec p$ satisfy the usual commutation relations.\footnote{It is essential here that $\R^{2d}$ is not considered as an abstract symplectic manifold,
but rather we are given a preferred set of linear functions $\vec x,$ $\vec p$ on $\R^{2d}$  (unique up to linear symplectic transformations and additive constants) whose commutators are specified.
The problem of quantizing $\R^{2d}$ as an abstract symplectic manifold with no additional structure is completely different, and has no natural solution, because
of the operator ordering problem of quantum mechanics.   In our field theory problem, the phase space comes with a distinguished set of linear functions,
namely the field variables $\phi(x)$ and $\dot\phi(x)$.}
All of these constructions produce a distinguished Hilbert space $\H$.   There is no distinguished 
vector in $\H$ unless more structure is present, for example, a Hamiltonian whose ground state would be such a distinguished vector.

In infinite dimensions,  this uniqueness of the irreducible representation of the canonical commutators is completely false \cite{GW}.  We will see that presently
 with  examples.   Though we primarily discuss bosons in this article, the same statements hold for fermions:   the canonical anticommutators have an
 essentially unique representation in the case of finitely many fermionic variables, but not in the case of an infinite set of fermionic variables.
 
Once one picks a  representation of the field variables on  $S$, satisfying the canonical commutation relations, 
 in a Hilbert space $\H$, the rest of the construction of the theory is straightforward.   
The field $\phi$ obeys the second order wave equation $(D_\mu D^\mu+m^2)\phi=0$, by virtue of which $\phi(\vec x,t)$ can be expressed for
all $\vec x,t$  in terms of $\phi,\dot\phi$
on $S$.   Such an expression exhibits $\phi(\vec x,t)$ as an operator acting on $\H$, and therefore matrix elements $\la\Psi|\phi(\vec x_1,t_1)\phi(\vec x_2,t_2)
\cdots \phi(\vec x_n,t_n)|\chi\ra$, for states $\Psi,\chi\in\H$, are uniquely determined, in principle.     However, if one starts this construction with the ``wrong''
representation of the canonical commutation relations, then the resulting matrix elements $\la\Psi|\phi(\vec x_1,t_1)\phi(\vec x_2,t_2)
\cdots \phi(\vec x_n,t_n)|\chi\ra$ are not physically sensible: they do not have the expected short distance singularities.   From this point of view, the problem
of quantization is to find the right representation of the canonical commutators such that the resulting correlation functions are physically sensible.

 One simple case in which it is obvious on physical grounds how to construct the appropriate representation of the canonical commutation relations
 is a spacetime with a Killing vector field that is everywhere timelike.   In a suitable coordinate system $t, \vec x$, the metric of such a spacetime
 is independent of the time $t$.     In this case, we expect the quantum theory to have a self-adjoint Hamiltonian operator $H$
that generates time translations. In particular, such an $H$ is diagonalizable.  Because the Killing vector field is everywhere timelike, we expect $H$ to be bounded below.
A representation of the canonical commutation relations that admits such an $H$ is  unique up to isomorphism.
   To construct this representation, 
  we simply expand the field in $c$-number modes $f_k(\vec x)$, $\bar f_k(\vec x)$ 
 of positive and negative frequency\footnote{The sum here is a discrete sum in a closed universe, and becomes a continuous
 integral in an open universe.  We assume for the moment that all modes of $\phi$ have positive or negative frequency; zero-modes will be incorporated presently.}
 \be\label{expfields}\phi(\vec x,t)=\sum_k \left( a_k \,f_k(\vec x)
 e^{-\i\omega_k t} +a^\dagger_k \bar f_k(\vec x) e^{\i\omega_k t}\right),~~~\omega_k>0.\ee
 The modes can be normalized so that the operators $a_k$, $a_k^\dagger$ obey the canonical
 relations $[a_k,a_l]=[a^\dagger_k,a^\dagger_l]=0$, $[a_k,a^\dagger_l]=\delta_{kl}$.  
 Acting with $a^\dagger_k$ increases the energy (the eigenvalue of $H$) by $\omega_k$, and acting with $a_k$ reduces the energy
 by the same amount.
  We introduce a ``ground state'' $\Omega$
 of lowest energy, annihilated by the $a_k$.      Then we define a pre-Hilbert space $\H_0$ of all states that can be created by acting on 
 $\Omega$ with finitely many $a^\dagger$'s.   To be more precise, we define $\H_0$ to have a basis of states that we denote as
 \be\label{basiss} a_{k_1}^\dagger a_{k_2}^\dagger \cdots a_{k_n}^\dagger|\Omega\rangle,~~~n=0,1,2\cdots.\ee
 The $a$'s and $a^\dagger$'s are defined to act on these states in the familiar way, satisfying the commutation relations.   
 $\H_0$ has all the properties of a Hilbert space except
 completeness; that is why we call it a pre-Hilbert space.   We take the Hilbert space closure of $\H_0$ and this gives us the
 desired Hilbert space $\H$ for the free field $\phi$ in a time-independent curved spacetime.  Clearly, $\H$ contains a distinguished vector of minimum energy,
 namely $\Omega$, which is annihilated by all the $a_k$.  Conversely, any Hilbert space $\H$ that represents the canonical commutators and in which $H$ is
 self-adjoint and bounded below must contain a vector $\Omega$ annihilated by all the $a_k$ (otherwise acting repeatedly with the $a_k$ on an eigenvector
 of $H$ would lower the energy indefinitely), and therefore is equivalent to the Hilbert space that was just constructed.
 
 
 This discussion must be slightly modified if there are zero-modes.    For a simple example with zero-modes, simply set $m=0$ in the model we have been discussing.   Then the field $\phi$ does have a zero-mode, namely the constant mode $\phi_0$.  The canonical conjugate to $\phi_0$
 is the constant mode $\pi_0$ of $\dot\phi$.   If $\pi_0$ is suitably normalized, the commutation relations of these modes are the usual canonical commutators
 $[\pi_0,\phi_0]=-\i$.  This is a finite set of canonical variables, so the Hilbert space $\H'$ obtained by quantizing
 these modes is unique, up to isomorphism.  It can be defined, for example, as the space of $L^2$ functions of $\phi_0$, with $\pi_0$ acting by
 $-\i\partial/\partial\phi_0$.     The unique representation of the canonical commutators of the full system in which $H$ is self-adjoint and bounded below is then given by the
 Hilbert space $\H\otimes\H'$, where $\H$ is obtained by quantizing the nonzero modes as in the last paragraph and $\H'$ is obtained by quantizing the zero-modes.
 More generally, in a time-independent closed universe, the number of zero-modes, in a free field theory with fields of any spin, is always finite,\footnote{For example,
 in $U(1)$ gauge theory with gauge field $A$, zero-modes correspond to harmonic 1-forms on $S$, and the number of such modes is the first Betti number of $S$,
 which is always finite for compact $S$. In this example, the Hilbert space has different components labeled by the first Chern class of the line bundle
 on which $A$ is a connection.   Each component can be analyzed as we have done in the text for the massless scalar.}   so the possible existence
 of zero-modes never  presents any problem in quantization.
 
 Note, however, that in the example with the massless scalar field, the Hilbert space $\H'$ that is obtained by quantizing the zero-modes does not have any distinguished
 vector.   The Hamiltonian $H$ acts in $\H'$ as a multiple of $\pi_0^2=-\partial^2/\partial\phi_0^2$.   This operator does not have a normalizable ground state
 that would provide a distinguished vector in $\H$.   So this is a simple example of successfully quantizing a theory in curved spacetime and not finding any
 distinguished vector in the resulting Hilbert space.   That is somewhat exceptional in a time-independent spacetime, since it only happens in the presence
 of zero-modes (and not always then).   But when one relaxes the assumption of time-independence, it is the typical state of affairs.
 
 
In a time-dependent situation, it is less obvious how to select an appropriate representation of the canonical commutation relations.
Before discussing this question, we will practice with the simpler case  of a spin system.  This will also provide useful background
when we come to statistical mechanics in section \ref{Thermo}.
 


 \subsection{Practicing With A Spin System}\label{spins}
 
 A qubit is a two-state quantum system, comprising, possibly, the two states of a spin 1/2 particle.  A single qubit realizes the algebra of Pauli matrices
 $\sigma_x, \sigma_y, \sigma_z$. So a system of $n$ qubits realizes the corresponding algebra of operators $\sigma_{a,k}$ where $a=x,y$ or $z$ and $k\in\{1,\cdots,n\}$
 labels the choice of qubit:
 \be\label{toffox}\sigma_{a,k}\sigma_{b,k}=\delta_{ab}+\i\epsilon_{abc}\sigma_{c,k},~~~~ [\sigma_{a,k},\sigma_{b,k'}]=0,~~k\not=k'.\ee
 For finite $n$, this algebra has, up to isomorphism, a unique irreducible representation, of dimension $2^n$.   But for an infinite set of qubits, the representation
 of the algebra becomes highly non-unique.  That is the point that we will explore here.\footnote{The following matters are discussed, for example,
 in section 2.3 of \cite{Sewell2}. That book is also a useful reference for other topics relevant to the present article.}

 
As a preliminary, consider this  question.   Consider a countably infinite set of qubits (with no additional structure).
Does the Hilbert space of
 such a system have a countable or uncountable dimension?
 
 A Hilbert space $\H^*$ that literally describes {\it all} states of a countably infinite collection of qubits definitely has an uncountable
 dimension.   But it is normally not useful to do physics in a Hilbert space as big as that.   Infinite
 constructions in physics are normally limits of finite constructions, and it is generally  possible to take the limit in such a way
 that all questions of interest can be answered in a Hilbert space of countably infinite dimension.   Such a Hilbert space is said to be ``separable.''
 What we should do to get a separable subspace of $\H^*$ depends on what we are interested in.   To get anywhere,
 we should have a class of operators on $\H^*$ that we regard as sensible physical observables.  Then we can look
 for a separable subspace $\H$ of the ridiculously big Hilbert space $\H^*$ that is big enough to realize the algebra of
 physical observables and to describe the states that we care about.  There are two ingredients here: what class of observables
 do we care about and what class of states do we care about?   The two cannot be specified independently since the observables
 we care about have to be able to act on the states that we care about. 

 
 In the case of the qubits, we might decide that we want a class of observables that contains
 all the single qubit operators.   A basis of operators on the $k^{th}$ qubit (apart from the
 identity) are the Pauli spin operators $\sigma_{a,k}$.  We define an algebra $\A_0$ that consists of all polynomials in these operators.
 Thus $\A_0$ consists of finite linear combinations of products of the form
 $\sigma_{a_1,k_1}\sigma_{a_2 ,k_2}\cdots \sigma_{a_r,k_r}$, satisfying the relations (\ref{toffox}).    The reason to call this $\A_0$ is that
 usually one wants some kind of completion of $\A_0$ to get the algebra $\A$ of physical
 observables.  But we cannot discuss the completion without deciding what kind of states we are
 interested in.
 
 For example, we might be interested in states in which the qubits almost all have ``spin up'' along the
 $z$-axis, or in other words in which they are almost all in the state $\left|\uparrow\right\rangle= \left| \begin{matrix} 1\cr 0\end{matrix}\right\rangle$. 
 Then we might decide that the physical Hilbert space $\H$ should at least contain the vector
 \be\label{thevector}\Omega_\uparrow=\otimes_n \left|\uparrow\right\rangle_n. \ee
 If we want to have $\A_0$ as an algebra of observables, we have to include all states obtained by
 acting with $\A_0$ on $\Omega_\uparrow$.   When we act with $\A_0$ on $\Omega_\uparrow$,
 since $\A_0$ consists of all the operators that act on a finite set of qubits, we get all states in which all
 but finitely many qubits are in the state $\left|\uparrow\right\rangle$.  States of this kind make
 a pre-Hilbert space $\H_0$ with a countable basis.   Its Hilbert space completion $\H$ is separable.
 Moreover, we can now actually take a completion of $\A_0$ by adding convergent limits of sequences
 of operators in $\A_0$.  (The relevant notion of convergence is discussed momentarily.)
  This will give the algebra $\A$ of all bounded operators on $\H$.    
 By definition, the algebra of all bounded operators on a Hilbert space $\H$ is called a von Neumann algebra
 of Type I.   Von Neumann algebras of Type I
 are the familiar ones, but we will meet the other types. 
 
Obviously, instead of the state $\Omega_\uparrow$, we could have started with another state in the very
large Hilbert space $\H^*$.  For example, setting $\left|\downarrow\right\rangle= \left| \begin{matrix} 0\cr 1\end{matrix}\right\rangle$,
we could have started with the state $\Omega_\downarrow = \otimes_n \left|\downarrow\right\rangle_n$ in which the spins
are all down.   Then we would define a pre-Hilbert space $\H_0'$ in which all but finitely many spins are down; it has a  Hilbert space
completion $\H'$.   The algebra $\A_0$ acts on $\H'$, and by including convergent limits of operators,
it  can again be completed to a von Neumann algebra $\A'$ that in this example will be the Type I algebra of all bounded
operators on $\H'$.

The algebras $\A$ and $\A'$ are actually different, but to understand why we need to explain what we mean by saying that
a sequence $\a_1,\a_2,\cdots\in \A_0$ converges.   If $\A_0$ is understood as an algebra of bounded operators on a Hilbert space $\H$,
the relevant notion of convergence (which mathematically is called a weak limit) is to say that the sequence $\a_1,\a_2,\cdots \in \A_0$ converges
if the limit
 $\lim_{n\to\infty}\langle\psi|\a_n|\chi\rangle$ exists, for all $\psi,\chi\in\H$.   In that case, one defines
 an operator $\a$ whose matrix elements are $\langle\psi|\a|\chi\rangle=\lim_{n\to\infty}\langle\psi|\a_n|\chi\rangle$,
 and one says that $\lim_{n\to\infty}\a_n=\a$. 
 The explanation given by Haag \cite{HaagBook} for why this is the appropriate notion of convergence for physics
  is that any given experiment measures finitely many matrix elements to finite precision, and therefore,
if $\a$ is the weak limit of a sequence $\a_1,\a_2,\cdots,$ then any given experiment cannot distinguish $\a_n$ from $\a$ if $n$ is sufficiently
 large.   The definition of a weak limit, however, makes it clear that to determine the limit of a sequence of elements in $\A_0$, we need to know
 the Hilbert space $\H$ on which $\A_0$ is acting.   For a concrete example, let $\sigma_{+,n}=\frac{1}{2}\left(\sigma_{x,n}+\i \sigma_{y,n}\right)$ be the spin raising operator
 for the $n^{th}$ qubit.    Then $\lim_{n\to\infty}\sigma_{+,n}^\dagger\sigma_{+,n}=0$  if the operators are considered to act on $\H$, but
 $\lim_{n\to\infty}\sigma_{+,n}^\dagger\sigma_{+,n}=1$ if the operators are consisted to act on $\H'$.  These statements reflect the fact for any state in $\H$, the
 $n^{th}$ spin is almost certainly up (and annihilated by $\sigma_{+,n}$) for sufficiently large $n$, while for any state in $\H'$, it is almost certainly down.     As a matter of terminology, an algebra of operators that is closed under weak limits is called a von Neumann algebra.
 
 Instead of considering an abstract collection of qubits with no structure, we could arrange the qubits on a lattice of some dimension
 and consider a lattice Hamiltonian $H$, for instance a Heisenberg spin Hamiltonian.   Then it would be natural
  to take $\Psi$ to be the ground state of this Hamiltonian, assuming it is unique.  Starting with this
 $\Psi$, we would then construct a separable Hilbert space $\H$ on which all of the elementary spin operators
 act.   In this Hilbert space, we would complete the algebra $\A_0$ to a von Neumann algebra $\A$ acting on $\H$. 
 This algebra will be of Type I.  Our previous discussion amounted
 to the special case that $H=-\sum_n \sigma_{z,n}$, leading to the ground state
 $\Psi=\Omega_{\uparrow}$, or $H=+\sum_n\sigma_{z,n}$,
 leading to $\Psi=\Omega_{\downarrow}$.
  If $H$ has degenerate ground states,
 then one would want to pick a basis of ground  states consisting of states that satisfy cluster decomposition, and proceed as before,
 starting with any one of those states.  In a moment, we will explain what is special about the states that satisfy cluster decomposition.
 
We can similarly construct a separable Hilbert space with an action of a completion of the algebra $\A_0$ starting with any vector  $\Psi\in\H^*$.
There is a certain sense, however, in which it is not true that every $\Psi$ is an equally good starting point.   To see this,
consider the vector $\Psi=\frac{1}{\sqrt 2}\Omega_\uparrow +\frac{1}{\sqrt 2}\Omega_\downarrow.$
Let $\pi_\uparrow$ and $\pi_\downarrow$ be the operators that project the first qubit onto the states $|\negthinspace\uparrow\ra$ and $|\negthinspace\downarrow\ra$,
respectively.   Then $\pi_\uparrow \Psi=\frac{1}{\sqrt 2}\Omega_\uparrow$ and $\pi_\downarrow\Psi = \frac{1}{\sqrt 2}\Omega_\downarrow$.
Further acting with arbitrary elements of $\A_0$, we see that any state in either $\H_\uparrow$ or $\H_\downarrow$ can be approximated
by states  $\a\Psi$, $\a\in\A_0$,
and therefore $\H_\Psi=\H_\uparrow\oplus \H_\downarrow$.   Thus, while  it is true that 
by acting with $\A_0$  on the state $\Psi$, we can build a separable Hilbert
space $\H_\Psi$ that admits an action of a completion $\A$ of  $\A_0$, we see that $\A$ does not act irreducibly on $\H_\Psi$,
since $\H_\Psi$ has the $\A$-invariant decomposition $\H_\uparrow\oplus \H_\downarrow$.     If $\Psi$ is such that a completion of
$\A_0$ does act irreducibly on $\H_\Psi$, we say that $\Psi$ is a pure state\footnote{There is some tension here
with the usual terminology in quantum mechanics, where the phrase ``pure state'' usually refers to any Hilbert space state,
without such a restriction.  The point is that if $\A$ is a Type I algebra, consisting of all bounded operators on a Hilbert space $\H$,
then every $\Psi\in\H$ is a pure state in the algebraic sense (the action of $\A$ on $\Psi$ generates the whole Hilbert space $\H$,
on which $\A$ acts irreducibly).   Thus for the case that $\A$ is of Type I, the two notions of ``pure state'' are compatible.}
 for the algebra $\A_0$.   The pure states are the most interesting ones since they correspond to the irreducible representations of the 
 relevant algebras of observables.   In the example of a lattice spin Hamiltonian with multiple 
ground states, the pure states are the ones that satisfy cluster decomposition.


This description of what is meant by a pure state for the algebra $\A_0$ is not the most common one.   Usually, one considers the function 
$F_\Psi(\a)=\la\Psi|\a|\Psi\ra$, which obeys the following properties: 
\begin{itemize}\item{  it is linear in $\a$, namely $F(\lambda \a+\mu \b)=\lambda F(\a)+\mu F(\b)$, for $\a,\b\in\A_0$, $\lambda,\mu\in \C$,} \item{ it is normalized
to $F(1)=1$,} \item{  it is positive, in the sense that  $F(\a^\dagger \a)\geq 0$ for all $\a\in\A$.} \end{itemize}
A function on an algebra, in the present example $\A_0$, that satisfies these properties is called a state on the algebra.      Clearly then for any $\Psi\in\H^*$, the function
$F_\Psi(\a)=\la\Psi|\a|\Psi\ra$ is a state on the algebra $\A_0$.   A  
state on an algebra is called ``pure'' if it is not a convex linear combination of
other states, or in other words if it is not possible to write $F(\a)= p_1 F_1(\a)+p_2 F_2(\a)$ with $p_1,p_2>0$ and states $F_1$, $F_2$.
In the present example,  one readily sees that
\be\label{knicky} F_\Psi(\a)=\frac{1}{2} \la\Omega_\uparrow|\a|\Omega_\uparrow\ra+\frac{1}{2} \la\Omega_\downarrow|\a|\Omega_\downarrow\ra,
~~\a\in \A_0.\ee
So the state $F_\Psi$ is not pure.   The two notions of a pure state that we have described are 
equivalent: $\H_\Psi$ is irreducible for a completion of $\A_0$ if and only if the state $F_\Psi(\a)$ is pure.   The interested reader
can verify this, possibly after reading about the GNS construction in section \ref{td}. 

 
 Suppose  that we construct a separable Hilbert space $\H_\Psi$  as before from some
 input state $\Psi\in\H^*$, and another Hilbert space $\H_{\Psi'}$ starting with a different input state $\Psi'$.
 $\H_\Psi$ and $\H_{\Psi'}$ are both subspaces of the very big Hilbert space $\H^*$.   Are they the same
 subspaces?   A necessary condition is clear: $\Psi'$ should be in $\H_\Psi$.   If so, then  $\Psi'$
 can be approximated by states  $\a\Psi$, with $\a\in \A_0$.    But in that case, any vector in $\H_{\Psi'}$,
 which by definition can be approximated by $\a'\Psi'$ with $\a'\in\A_0$, can in fact be approximated by $\a'\a\Psi$ and hence is
 in $\H_\Psi$.   In other words, if $\Psi'\subset\H_\Psi$ then $\H_{\Psi'}\subset \H_\Psi$.     If $\Psi$ is pure, it actually
 follows that $\H_{\Psi'}=\H_\Psi$.   That is because if $\H_{\Psi'}\subset\H_\Psi$, then $\H_\Psi$ 
  has an $\A_0$-invariant decomposition $\H_\Psi=\H_{\Psi'}\oplus \H_{\Psi'}^\perp$.   If $\Psi$ is a pure state
 for the algebra $\A_0$, then one of the summands here must be trivial and so in this case $\H_\Psi=\H_{\Psi'}$.   
 
 
 \subsection{A System Of Harmonic Oscillators}\label{harmo}
 
 Now let us discuss something that is a little closer to field theory.    We will consider an infinite sequence
 of pairs of canonical variables, $(x_1,p_1),$ $(x_2,p_2)$, $\cdots$.    The $k^{th}$ pair can be quantized to give
 a Hilbert space $\H_k$, and for this, there is no need to know anything about a preferred vector.   If we want to describe
 all of the states in all of the $\H_k$, we have to define a Hilbert space
 \be\label{bigone}\H^*=\otimes_k \H_k\ee
 of uncountably infinite dimension.   But if we are given a state $\Psi$ that for some reason we like, we can proceed
 as we did with the qubits.   We define an algebra $\A_0$ consisting of all polynomials in the $x$'s and $p$'s.  Then we define
 a pre-Hilbert space $\H_0$ consisting of all states that can be made from $\Psi$ by acting with $\A_0$,
 and as usual we complete this to a Hilbert space $\H$.  We can then also complete $\A_0$ to an algebra $\A$.
 
 A simple example of this would be that $\Psi$ is a tensor product of states $\psi_k\in \H_k$:
 \be\label{welfo}\Psi=\otimes_k\psi_k. \ee
 We can assume that the $\psi_k$ and therefore also $\Psi$ are normalized, $(\psi_k,\psi_k)=(\Psi,\Psi)=1$.
 We construct a Hilbert space $\H_\Psi$ by acting with $\A_0$ on  $\Psi$.   On the other hand, consider another
 state of the same kind, $\Psi'=\otimes_k\psi'_k$, where again we assume the $\psi'_k$ and $\Psi'$ to be normalized.
 Is the Hilbert space $\H_{\Psi'}$ the same as $\H_\Psi$?  
 
 Let $c_k=(\psi'_k,\psi_k)$.  After possibly changing the phases of the $\psi'_k$, we can assume that $c_k\geq 0$;
 clearly $c_k\leq 1$.   We have
 \be\label{dotto} |\langle\Psi',\Psi\rangle|=\prod_{k=1}^\infty c_k. \ee
 We consider separately two cases: (1) $\langle\Psi',\Psi\rangle\not=0$; (2) $\langle\Psi',\Psi\rangle=0$.
 In case (1), the $c_k$ rapidly converge to 1.   By acting with the algebra $\A_0$ on $\Psi$, we can
 change any finite set of $c_k$'s at will, subject to the condition $c_k\leq 1$, without changing the normalization condition
 $(\psi_k,\psi_k)=1$.  In particular, we can find a sequence $\a_1,\a_2,\cdots\in\A_0$ such that the states $\a_k\Psi$ are
 all normalized and
 $\lim_{n\to\infty}\la\Psi',\a_k\Psi\ra=1$.   In other words, $\Psi'$ can be approximated by vectors $\a_k\Psi$; hence $\Psi'\in\H_\Psi$.
 The relation between $\Psi$ and $\Psi'$ was symmetrical, so likewise $\Psi\in\H_{\Psi'}$.
 As in section \ref{spins}, it follows that $\H_\Psi=\H_{\Psi'}$.
 
 In case (2), where $\prod_{k=1}^\infty c_k$ vanishes, the interesting case is that the $c_k$ are not individually 0 and
 $\prod_{k=1}^\infty c_k=0$ because the $c_k$ do not approach 1 fast enough to make this product nonzero.   
 Then this vanishing cannot be changed by changing finitely many of the $c_k$.   So in such a case, $\Psi'$ is
 orthogonal not just to $\Psi$ but to $\a\Psi$ for all $\a\in \A_0$.   It follows then that $\a'\Psi'$ is orthogonal to $\a\Psi$
 for all $\a,\a'\in\A_0$, since $\la \a'\Psi'|\a\Psi\ra=\la\Psi'|\a'{}^\dagger \a\Psi\ra=0$.   So $\H_{\Psi'}$ and $\H_\Psi$ 
 are orthogonal.   
 
If finitely many of the $c_k$ vanish, those $c_k$'s should just be disregarded since they could be set to 1 by
replacing $\Psi$ with some $\t\Psi=\a\Psi$, $\a\in\A_0$, without changing the other $c_k$'s.    So in case
finitely many of the $c_k$ vanish, we look at the restricted product $\prod'_k c_k$ over the nonzero $c_k$;
we will get $\H_{\Psi'}=\H_\Psi$ if this restricted product is positive, and otherwise $\H_{\Psi'}$ is orthogonal to $\H_\Psi$.
If infinitely many $c_k$ vanish, we cannot change this by acting with an element of $\A_0$, so $\H_{\Psi'}$ and $\H_\Psi$
are orthogonal.

It is noteworthy that there are only two outcomes here: $\H_\Psi$ and $\H_{\Psi'}$ are the same, or they are orthogonal.\footnote{We did not
run into other possibilities encountered in section \ref{spins}, because the states $\Psi$ and $\Psi'$ are pure for the algebra $\A_0$. This resulted from their product structure.}
For $\H_\Psi$ and $\H_{\Psi'}$ to be the same, we require no relation at all between $\psi_k$ and $\psi'_k$ for all but finitely
many modes, but for large $k$, $\psi_k$ and $\psi'_k$ must coincide asymptotically at a sufficiently fast rate.

Now we will consider a special case of this that is useful background for field theory.   For each $k$, pick a complex number $\tau_k$
in the upper half plane, and define
\be\label{bicy} a_k^\dagger=\frac{1}{2\sqrt{\Im\,\tau_k}}\left(x_k+\tau_k p_k\right),~~ a_k=\frac{1}{\sqrt{2\Im\,\tau_k}}\left(x_k+\bar\tau_k p_k\right). \ee
This has been chosen to ensure that $[a_k^\dagger, a_{k'}]=\delta_{kk'}$, with other commutators vanishing.    We can  choose
$\psi_k$ so that $a_k \psi_k=0$, whereupon if $\Psi=\otimes_k\psi_k$, we have $a_k\Psi=0$ for all $k$.   We can view $\Psi$
as the ground state of a harmonic oscillator Hamiltonian $H=\sum_k \epsilon_k a_k^\dagger a_k$, for arbitrary $\epsilon_k>0$.

On the other hand, we could make the same construction with a different set of parameters $\tau'_k$, leading to a different set of creation
and annihilation operators $a'_k{}^\dagger,$ $a'_k$ and a different vector $\Psi'=\otimes_k \psi'_k$ that is annihilated by the new
annihilation operations.  Now we can ask if the Hilbert spaces $\H_\Psi$ and $\H_{\Psi'}$ are the same.   From the above analysis,
the condition for this is $\prod_{k=1}^\infty c_k>0$, with $c_k=\la\psi'_k,\psi_k\ra$.   This is equivalent to a condition that $\tau'_k$ is sufficiently close to $\tau_k$
for large $k$, with no condition at all on $\tau'_k$ for any finite set of values of $k$.   

For any given $k$, at the classical level, a group $SL(2,\R)\cong Sp(2,\R)$ of linear canonical transformations acts on the pair $x_k,p_k$,
preserving the commutation relations. The group that acts on the quantum Hilbert space is a double cover of $Sp(2,\R)$,
called the metaplectic double cover.\footnote{One way to see the occurrence of this double cover is the following.   For a pair of canonical
variables $x,p$, let $H$ be the harmonic oscillator Hamiltonian $H=\frac{1}{2}(p^2+x^2)$.  As a canonical transformation of $x$ and $p$, $\exp(2\pi\i H)=1$.
But quantum mechanically, as the eigenvalues of $H$ are all half-integers, one has $\exp(2\pi\i H)=-1$.} We denote the double cover
as $\widehat{Sp}(2,\R)$.  It is possible to choose for each $k$ an element
$g_k\in \widehat{Sp}(2,\R)$ that conjugates $a_k^\dagger$ and $a_k$ to $a'{}^\dagger_k$ and $a'_k$, and maps $\psi_k$ to $\psi'_k$.   
Clearly, any finite product of the $g_k$'s acts on the Hilbert space $\H_\Psi$ (and likewise on $\H_{\Psi'}$).   But the infinite
tensor product $\otimes_{k=1}^\infty g_k$ maps $\Psi$ to $\Psi'$, so it maps $\H_\Psi$ to $\H_{\Psi'}$.   It only acts within $\H_\Psi$
if $\prod_{k=1}^\infty c_k>0$, which is equivalent to saying that $g_k$ approaches 1 sufficiently rapidly for $k\to\infty$.

The moral of the story is that in the case of an infinite set of canonical variables, a linear canonical transformation is realized in
a given representation of the canonical commutation relations if and only if it is sufficiently close to the identity on all but finitely
many of the  variables.   To motivate this statement, we have considered the simple case of a canonical transformation that,
in a suitable basis, acts separately on each pair of variables $x_k,p_k$.   However, the conclusion is general and is explained in generality,
 for example, in \cite{WaldBook}.

Another way to state the conclusion is that for an infinite set of canonical variables, to determine a specific representation of the canonical
commutators in a separable Hilbert space $\H$, one needs to  describe the desired representation to sufficient precision for all but finitely many variables.  This may be done by decomposing the field variables in creation and annihilation operators, where $\H$ is supposed
to contain a vector annihilated by the annihilation operators.  To specify a particular $\H$ in this way, one must specify the decomposition
in creation and annihilation operators in an asymptotically precise way. 


 
 \subsection{Back To Field Theory}\label{fff}
 
 Now we go back to quantum field theory in curved spacetime.   First we consider a closed universe, that is a globally
 hyperbolic spacetime $M$ with compact Cauchy hypersurface $S$.     Modes along $S$
 of very short wavelength compared to the radius of curvature of
 $S$  can be separated to positive and negative
 frequency, with an uncertainty that rapidly vanishes in the limit of short wavelengths.  
So for very short wavelength modes, there is a natural decomposition in creation and annihilation operators to good approximation, and this approximation becomes asymptotically precise
in the limit of short wavelengths.    For low energy modes, we have no notion
 at all of how to make a decomposition in creation and annihilation operators, or how to pick a preferred state in any other way.   But in a closed
 universe, there are only finitely many low energy modes.   
 
Therefore, we are in a good situation.   For all but finitely many low energy modes, we have a good approximate notion of how to make
a separation in creation and annihilation operators.  Moreover this notion is asymptotically precise for the infinitely many modes of asymptotically
short wavelength.  Such an asymptotic separation in creation and annihilation operators is precisely sufficient to define a distinguished Hilbert
space $\H$ with an action of the canonical commutation relations.  The Hilbert space $\H$ constructed this way does not really depend on the
choice of $S$, because at asymptotically small wavelengths, evolution of the field $\phi$ via its equations 
of motion preserves the separation in positive and negative frequencies. So the asymptotic separation in positive and negative
frequencies made on one surface $S$ agrees with the asymptotic separation that one would make on another surface $S'$.
 Moreover,  matrix elements of products of field operators
between vectors in $\H$ have the standard short distance singularities, because $\H$ was defined using the standard separation in 
positive and negative frequencies at short distances.   

A  rigorous version of this  argument is described on pp. 96-7 of \cite{WaldBook}, roughly as follows.   Without changing the metric
of $M$ near $S$, we can modify it to be time-independent sufficiently far to the past of $M$ and sufficiently far to the future of $M$.
Let $g_-$ be the time-independent metric in the past and $g_+$ the time-independent metric in the future.
 As explained in section \ref{problem}, using the time-independent metric $g_-$ in the past, we can straightforwardly
 construct a representation of the canonical commutation relations based on a decomposition in positive and negative frequencies.  We call the
 resulting Hilbert  space $\H_{g_-}$.  Following the same procedure in the future, we construct  a representation of the canonical commutation relations, and a Hilbert space that we  call $\H_{g_+}$.   Either choice, together with the equations of motion, determines
a representation of the canonical commutators throughout all of $M$.   
However, the two representations and the two Hilbert spaces $\H_{g_-}$ and $\H_{g_+}$ are canonically the same.
This is so because in a spacetime that is time-independent in both the past and the future, at asymptotically high energies, 
propagation from the past to the future preserves the separation in positive and negative frequencies.
The error in this statement is exponentially small at high energies, so the criterion discussed in section \ref{harmo} for two representations of
the canonical commutation relations to be the same is satisfied.  
Saying that $\H_{g_-}$ and $\H_{g_+}$ are canonically the same means that one can define transition amplitudes from a state in $\H_{g_-}$ in the past
to a state in $\H_{g_+}$ in the future, and it also means that if we restrict to a neighborhood of $S$, we get the same representation of the canonical
commutation relations and the same Hilbert space whether we use $\H_{g_-}$ or $\H_{g_+}$.  
 But as $g_-$ and $g_+$  can be varied independently, the fact that the representation of the commutation relations that we get in a neighborhood of 
 $S$ can be determined
 just from $g_-$ and can also be determined just from $g_+$ means that actually this representation does not depend on $g_-$ or $g_+$ at all.
 In other words, this construction produces a distinguished representation of the canonical commutators on $S$.
     Now we return to the original
metric on $M$, whatever it was, with no assumption of time-independence anywhere, and we use the representation of the
canonical commutation relations in a neighborhood of $S$ that was just determined.     As explained in section \ref{problem}, a choice of a representation of the
canonical commutation relations near $S$, when combined with the equations of motion, is sufficient to completely determine the theory.   This concludes the argument.


This discussion may make it clear why (as also discussed in \cite{WaldBook}) 
there is not a natural Hilbert space for a quantum field in a generic open universe, for example in a Big Bang cosmology.
In a generic open universe, there are infinitely many modes of  moderate wavelength for which we have no candidate for a preferred state
or for a separation in creation and annihilation operators.
Hence there is no natural construction of a Hilbert space.   
To construct a Hilbert space, either 
by picking  a separation in creation and annihilation operators for all the modes of moderate wavelength,
or by otherwise specifying a  seed vector $\Psi$ that could be the starting point
of the construction,  one has to supply  
a great deal of detailed information about what is happening at spatial infinity.     It is possible to define a Hilbert space that
describes a quantum field in an open universe, but there are many inequivalent constructions of such a Hilbert space and there is no natural choice.

 \begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Bounded2.png}
 \end{center}
\caption{\small  (a)  A Cauchy hypersurface $S$, drawn as a two-sphere, is divided by the equator $B$ into an upper
hemisphere $V$ and a lower hemisphere $V'$.   (b)  In this view, $S$ is drawn as a one-dimensional curve
and $B$ is depicted as a point that divides $S$ into the two open sets $V$ and $V'$.   $\U$ and $\U'$ are open sets in spacetime
that are the domains of dependence of $V$ and $V'$. It is apparent from this picture that near $B$, $\U$ and $\U'$ can be modeled by opposite Rindler wedges in Minkowski space. \label{Bounded}}
\end{figure} 

\subsection{What is Quantum Field Theory In An Open Universe?}\label{whatis}

If there is no natural Hilbert space in an open universe, what can it mean to do quantum field theory in one?   
Before answering this question, let us first discuss closed universes a little more. 
Consider an observer who has access only to 
a portion of a closed universe, or who wants to develop a formalism suitable to describe experiments in just a portion of the universe.   
We will be particularly  interested in a  region of spacetime of the following sort (fig. \ref{Bounded}).   Let $B$ be a closed, codimension
1 submanifold of a Cauchy hypersurface $S$, such that the complement of $B$ is the union of two disjoint open sets $V$ and $V'$.
Let $\U$ and $\U'$  be the domains of dependence of $V$ and $V'$, respectively.   We call an open set of the form $\U$ or $\U'$
a ``local region,'' and we want to know what quantum field theory says for an observer who makes observations only in such a local region. 

Classically, in a relativistic field theory, fields in $\U$ are determined by initial data on $V$.   Quantum mechanically, this is also true
in free field theory; we exploited this fact in section \ref{problem}.  In a generic  non-free quantum field theory, it is in general not possible
to define observables on a spacelike surface such as $V$, and instead we thicken $V$ slightly to an open set $\V$, satisfying
$V\subset \V\subset \U$.   Roughly, we will describe the sense in which initial data for observations in $\U$ can be formulated in $\V$.  
Note that $\U$ and $\V$ are both globally hyperbolic spacetimes in their own right, with a Cauchy hyperurface -- namely $V$ -- which
is a portion of the Cauchy hypersurface $S$ of the full spacetime $M$.    
 

An analog in ordinary quantum mechanics of restricting from a spacetime $M$ to a local region $\U$ is to consider only a subsystem
$X$ of a larger bipartite system $XY$.  In ordinary quantum mechanics, the subsystems $X$ and $Y$ are described by Hilbert spaces $\H_X$
and $\H_Y$, and the composite system $XY$  is described by the tensor product $\H_{XY}=\H_X\otimes\H_Y$.   
A general state of the full system $XY$, possibly a pure state, when restricted to the subsystem $X$, is described by a density matrix
$\rho_X$.   Here $\rho_X$  is a self-adjoint operator, positive and of trace 1, acting on the Hilbert space $\H_X$ of the subsystem.  
 Let $\A_X$ be the algebra of all operators of  subsystem $X$; this is the same as the algebra of all operators on $\H_X$. 
For $\a\in \A_X$,  its expectation value in a state characterized by the density matrix $\rho_X$  is defined as $F(\a)=\Tr\,\rho_X \a$.      
The function $F(\a)$ has three key properties, already introduced in section \ref{spins},  which characterize what is known as a ``state''
on an algebra:
\begin{itemize}\item{  it is linear in $\a$, namely $F(\lambda \a+\mu \b)=\lambda F(\a)+\mu F(\b)$, for $\a,\b\in\A_X$, $\lambda,\mu\in \C$,} \item{ it is normalized
to $F(1)=1$,} \item{  it is positive, in the sense that  $F(\a^\dagger \a)\geq 0$ for all $\a\in\A_X$.} \end{itemize} 
So a density matrix $\rho_X$ for the subsystem $X$ is a state on the algebra $\A_X$ consisting of all operators on the Hilbert space $\H_X$ of
subsystem $X$.



In quantum field theory, there is no way to associate a Hilbert space to a local region in spacetime.   The best one can do is to associate to an  open set $\W\subset M$  a corresponding algebra of operators $\A_\W$.
The algebras $\A_\W$ obey physically motivated axioms, such as a condition associated to causality: 
$\A_\W$ and $\A_{\W'}$ commute (in the $\Z_2$-graded sense if fermions are present) if the regions $\W$ and $\W'$ are spacelike separated.\footnote{See for example
section 5.3.1 of the article by Brunetti and Fredenhagen in \cite{BF} for a useful statement of axioms in the context of curved spacetime.  In
Minkowski space, a standard reference is \cite{HaagBook}.} 
We will discuss in more detail presently the construction of $\A_\W$.   For now, we just  note  a difference
between a local region in quantum field theory and 
 a subsystem in ordinary quantum mechanics:  the algebra $\A_\W$ is,
 in the von Neumann
algebra language,  of Type III, not Type I \cite{ArakiQFT,Fred,HaagBook,Yng,WittenNotes}.   This will be explained in section \ref{Thermo},
in the analogous setting of quantum statistical mechanics.    The Type III nature of the algebras is actually the reason that there is no way to associate a Hilbert space
to a local region.  
If the algebra $\A_\W$ were of Type I, it would have an irreducible representation in a Hilbert space, and this Hilbert space would be
naturally associated to the open set $\W$ in spacetime.   However, 
a Type III algebra does not have an irreducible representation in a Hilbert space. Accordingly in quantum field theory,
there is no natural way to associate a Hilbert space $\H_\W$ to an open set $\W$.
All that we can really associate to the region $\W$  is the algebra $\A_\W$, not a preferred Hilbert space that it acts on.

There is also no good notion of a density matrix for the region $\W$, since this notion is not applicable for a Type III algebra.
But the notion of a state of the algebra
 $\A_\W$ -- a linear function obeying conditions that were stated previously -- does make sense.  This is the appropriate analog
 in quantum field theory of the notion of the density matrix of a subsystem in ordinary quantum mechanics.

With this in mind, what should quantum dynamics mean for a local region $\U\subset M$?   We assume as described earlier that $\U$
is the domain of dependence of some set $V$, which has a slight thickening to an open set $\V\subset \U$.   If we could associate a Hilbert space
to quantum fields on  $V$ or in $\V$, we could describe quantum dynamics in terms of state vectors.  
We would say that a quantum state that defines initial conditions on $V$ or in $\V$ actually determines the probabilities for measurement outcomes in the larger region $\U$.
 Since instead we only have
algebras of operators associated to $\V$ and $\U$, we have to say something similar in terms of algebras.
The necessary statement is just that in a quantum field theory, in this situation $\A_\U=\A_\V$, meaning that operators in region
$\U$ are actually equivalent to operators in region $\V$ (although simple operators in region $\U$ might correspond to rather complicated
operators in the smaller region $\V$).   Since $\A_\U=\A_\V$, a state of $\A_\V$ is automatically a state of $\A_\U$: in other words,
the data needed to predict  measurements  outcomes in region $\V$ (to the extent that such outcomes are predictable in quantum
mechanics) also suffice to predict measurement outcomes in the larger region $\U$.   The statement that $\A_\U=\A_\V$, together
with general axioms about the local algebras, such as those described in \cite{BF,HaagBook}, is the content of quantum dynamics
for a local region.   

Now let us discuss in more detail the definition of the algebra $\A_\W$ associated to an open set $\W$.    We assume to begin with
that $\W$ is contained in a closed universe $M$, or at least in some spacetime (such as Minkowski space) to which the quantum field
theory of interest associates a  Hilbert space $\H$. 
A standard approach to defining $\A_\W$  is as follows.  Let $\O(x)$ be a local operator of the 
quantum field theory in question, and $f$ a smooth function with compact support in $\W$.    Then $K_f=\exp(\i\int_\W\d^Dx \sqrt g f(x) \O(x))$
is  a bounded operator on $\H$.   $\A_\W$ is then defined as the von Neumann algebra generated by such operators on $\H$.   

The purpose
of introducing the global Hilbert space $\H$ was to make sure that expressions such as $K_f$ can be interpreted as Hilbert space operators
so that it is possible to take weak limits and define a von Neumann algebra.   
The von Neumann algebra language is useful because it makes possible simple statements such as $\A_\U=\A_\V$ (which would not hold
if we do not complete the algebras by taking weak limits).   However, this language has the drawback of not directly incorporating the operator
product expansion (OPE), which is an important statement of the locality of quantum field theory.  One approach to incorporating the OPE is to enrich the von Neumann algebra language with a further axiom which would imply the existence of an OPE \cite{Bost}.   Another approach is to
state axioms for quantum field theory in curved spacetime that directly incorporate the OPE \cite{HW}.   In some approaches, the notion of a 
state has to be refined to incorporate the expected short distance singularities of the quantum field theory under study, but it is preferable if
(as in \cite{HW}) the expected short distance behavior can be built into the structure of the algebra.   The best treatment of such questions is not entirely clear in the author's opinion, and in this article we will not adopt any particular point of view.


Before discussing an open universe, we need a few more facts about local regions in a closed universe $M$.
Let us specialize to the case of an open set that is a local region $\U\subset M$, or a smaller open set $\V\subset\U$, as described earlier.
Thus $\U$ or $\V$ is globally hyperbolic, with a Cauchy hypersurface $V$ that is an open subset of a Cauchy hypersurface $S$ of $M$.
There are many ways to embed $\U$ or $\V$ in some other closed universe $M'$, such that $V$ is an open subset of a Cauchy hypersurface
$S'$ of $M'$.   For this, we simply modify $S$ outside of $V$, or $M$ outside of $\U$ or $\V$.     
However, $\A_\U$ and $\A_\V$ depend only on $\U$ and $\V$, and not on how $\U$ and $\V$ have been embedded in $M$.
This has been called ``the principle of locality'' \cite{Kay}.  For free field theory, the statement is a theorem.
In general, it is expected to hold because the algebras $\A_\U$ and $\A_\V$ are ultimately determined by operator product relations
in the regions $\U$ and $\V$, and these relations are entirely local in nature.   The principle of locality is analogous to what we learned about spin
systems in section \ref{spins}: there are many inequivalent representations of the algebra of an infinite collection of spins, but they are all equivalent
for any finite set of spins.


Given the principle of locality, we can  explain the meaning of quantum field theory in an open universe $M'$, now with a noncompact
initial value surface $S'$.   Let $V\subset S'$ be an open set that is small enough that it can be embedded in a closed
manifold $\t V$. Let $\U$ be the domain of dependence of $V$ in $M'$, and $\V\subset \U$ a small thickening of $V$.
Because $V$ can be embedded in the compact manifold $\t V$, $\U$ and $\V$ can be embedded in a closed universe $\t M$,
with $\t V$ as Cauchy hypersurface.  Then we can define algebras $\A_\U$ and $\A_\V$ associated to $\U$ and $\V$, and the
principle of locality says that these local algebras depend only on $\U$ and $\V$ and not on the embedding in $M'$.
The dynamical principle of a quantum field theory is now again $\A_\U=\A_\V$.   This, along with general axioms about the algebras
associated to open sets, is the content of quantum field theory in an open universe.


The principle of locality sheds light on what happens if we prefer to describe physics in an open universe using a Hilbert space.  The only problem with
doing so is that in an open universe there are many inequivalent choices of a Hilbert space
and generically there is no preferred way to choose one.   However, the principle of locality says that the  algebra $\A_\U$ of a local
region and the dynamical principle $\A_\U=\A_\V$ do not depend on the choice of a Hilbert space.      Because of the principle of locality, an observer interested in physics in a bounded portion of the universe may decide
that the choice of a global Hilbert space from among the myriad possibilities is irrelevant.   But one can pick whichever Hilbert space one wishes without
changing the predictions of a theory for local dynamics.



  


In an open universe that obeys special asymptotic conditions at spatial infinity, one can say more.    One particularly important case is an asymptotically
flat universe, that is a universe that is asymptotic at spatial infinity to Minkowski space. 
In the asymptotically flat case, we will assume that the theory of interest has a mass gap, for a reason explained in the next paragraph.
  Another important case is an asymptotically Anti de Sitter
(AAdS) universe, that is, a universe that is asymptotic at spatial infinity to Anti de Sitter space.  In the AAdS case, one assumes a boundary condition at
spatial infinity of the sort usually considered in the AdS/CFT correspondence.   An asymptotically flat or AAdS spacetime is time-independent
for modes near spatial infinity, so one has a natural separation
in positive and negative frequencies for modes near spatial infinity.   For any mode of sufficiently short wavelength, there is a natural separation
in positive and negative frequencies.  In short, for the modes that either have short wavelength or are located near spatial infinity -- which
means for all but finitely many modes -- there is a natural asymptotic separation in positive and negative frequencies.  Hence, an asymptotically flat or AAdS spacetime (with a mass gap in the asymptotically flat case) 
is similar to a closed universe:  there is a natural treatment asymptotically for all but finitely many
modes, and therefore we should expect that a natural Hilbert space will exist.   

Clearly, the argument as stated in the last paragraph is only heuristic, and I am not aware of precise theorems in the literature.   For a quantum field theory
with a mass gap $m$, the effects of spacetime curvature on the ground state are exponentially small in the limit that the radius of curvature is large compared to
$1/m$.  In such a case, in an asymptotically flat spacetime,
the separation in positive and negative frequencies becomes exponentially  precise  near spatial infinity, where the radius of curvature  diverges,
so there should be no difficulty.  In AAdS space with the usual sort of boundary conditions, there are no infrared issues and this case should also be safe.
The delicate case is a massless theory in an asymptotically flat spacetime.\footnote{The following was explained to me in this context by R. Wald.}   
For a free Maxwell field in Minkowski space, there is a natural quantization
that leads to a Hilbert space with a Poincar\'e invariant vacuum, but this quantization is not truly unique because of the possibility of ``soft hair'' \cite{Ashtekar};
after coupling to charged fields, usually assumed to be massive, the soft hair plays an important role in understanding infrared divergences, soft theorems,
and the memory effect \cite{Strominger}.   With massless charged fields, the non-uniqueness of quantization becomes truly essential; moreover
this has a very interesting analog for
General Relativity in an asymptotically flat spacetime \cite{SWa}.   One cannot expect quantum field theory in an asymptotically flat spacetime to be simpler
than quantum field theory in Minkowski space.   So in general, a straightforward Hilbert space  description of quantum field theory in asymptotically flat
spacetime is only available for massive theories or possibly for massless theories whose infrared behavior is such
that the $S$-matrix can be defined in a conventional Fock space.

\subsection{Non-Free Theories}\label{nonfree}

So far we have discussed  free theories.   We will add a few words on non-free theories.

One of the main criteria for successful quantization of a free theory is that correlation functions such as the two-point function
$\la\Psi|\phi(\vec x,t)\phi(\vec x',t')|\chi\ra$ should have standard short distance singularities.   A two-point function with  that property 
 is the essential input to perturbation theory.   So one would expect, modulo some well-understood issues of anomaly cancellation,\footnote{A theory which is well-defined in Minkowski space might have a gravitational anomaly which would cause perturbation theory in curved spacetime to fail.}
that weakly coupled theories make sense in perturbation theory when free theories do.    See \cite{Fre,Wal} for some rigorous results.

One would anticipate that the same is true nonperturbatively, for theories such as QCD.  If a theory exists perturbatively in curved spacetime, and nonperturbatively
in flat spacetime, one would expect that it works nonperturbatively in curved spacetime.   Unfortunately, not much is available in terms of rigorous
theorems, except for special models like two-dimensional conformal field theories.   That reflects the general mathematical difficulty of understanding
quantum field theory rigorously.  One would think that rigorous results for a superrenormalizable theory in curved spacetime might be relatively accessible,
but such results are not available.




 
\section{Quantum Statistical Mechanics and the Thermodynamic Limit}\label{Thermo}

\subsection{The Thermofield Double}\label{td}

In this section, we will consider a simpler problem that is actually somewhat analogous to quantum field theory in an open universe.
Instead of quantum field theory in curved spacetime, we consider quantum statistical mechanics at positive temperature $T=1/\beta$.   In finite
volume, there is no problem.   We just consider the density matrix $\rho=\frac{1}{Z}e^{-\beta H}$ acting on the Hilbert space
$\H$ of the system, where $Z=\Tr\,e^{-\beta H}$ is the partition function.   Importantly, for any conventional statistical
system (possibly a relativistic quantum field
theory, possibly a nonrelativistic system of some kind), the partition function converges in  finite volume.  Thermodynamic functions and 
thermal correlation functions can all be computed in finite volume, and they have a thermodynamic or large volume limit.   

What happens if one wants to describe the thermodynamic limit of a system directly in terms of operators acting on
a Hilbert space appropriate for an infinite volume system?    Here we run into a difficulty: there is no  separable Hilbert space
that contains all the typical states of a system at $T\not=0$, since fluctuations can occur throughout the whole infinite space.  
  For example, for a spin system on an infinite lattice, since each spin has a nonzero probability to fluctuate,
it takes uncountably many states to describe all the typical states at $T\not=0$. (We discuss some examples based on lattice spin systems
in section \ref{lss}.)    In a continuum field theory, there is actually no reasonable
definition of a nonseparable Hilbert space that contains all the typical thermal excitations in infinite volume.

There is a simple device that enables one to describe the thermodynamic limit of any quantum system  in a separable Hilbert space \cite{HHW}.   This is the
``thermofield double.''   Consider an ordinary quantum system $\T$ (possibly a relativistic field theory, possibly a lattice theory or something else) 
with Hilbert space $\H$  and Hamiltonian $H$.
In finite volume, the thermofield double is defined by introducing, roughly speaking,  two copies of the original
system,  
 which we will call the ``right'' and ``left'' copies, with Hilbert spaces $\H_r$ and $\H_\ell$, and Hamiltonians $H_r$ and $H_\ell$.
We think of $\H_r$ as the Hilbert space of the system $\T$ and $\H_\ell$ as an auxiliary second copy.
Actually, rather than being a second copy of $\H_r$, it is more canonical to define $\H_\ell$ to be the complex conjugate Hilbert space of $\H_r$.   That amounts
physically to saying that the left system is a time-reversal conjugate of the right system (rather than being an identical second copy).  The fact
that $\H_\ell$ is the complex conjugate of $\H_r$ ensures that the combined Hilbert space  $\H_\TFD=\H_\ell\otimes \H_r$ of the two systems can  be viewed canonically
as the space of linear operators acting on $\H_r$ (or $\H_\ell$).  In expositions of the thermofield double,  time-reversal symmetry is often assumed,
in which case the left and right systems are equivalent.


In finite volume, the thermofield double $\Psi_\TFD$ is simply a vector in $\H_\ell\otimes \H_r$, defined as follows.  Suppose that the Hamiltonian
acting on the original system has eigenstates $\psi_i$ with energies $E_i$.  Then in finite volume, $\Psi_\TFD$ is defined as
\be\label{tomigo} \Psi_\TFD =\frac{1}{\sqrt Z} \sum_i \exp(-\beta E_i/2) |\bar i\ra_\ell\otimes |i\ra_r,\ee
Here $|i\ra_r$ is the $i^{th}$ energy level of the right system, with energy $E_i$; $|\bar i\ra_\ell$ is its time-reversal conjugate in the left system; and 
 $Z$ is the partition function  of the right or left system at temperature $1/\beta$.
 The point of this formula is that the density matrix of the right or left system is the usual thermal density matrix of that system:
\be\label{rumo}\rho_r=\Tr_{\H_\ell}|\Psi_\TFD\ra\la\Psi_\TFD| =\frac{1}{Z} \sum_i e^{-\beta E_i}|i\ra_r\la i|_r=\frac{1}{Z}e^{-\beta H_r}.\ee
So the thermofield double is a ``purification'' of a thermal density matrix.  

An equivalent statement is the following.  If we view $\H_\ell\otimes \H_r$ as the space of linear operators acting on $\H_r$, then $\Psi_\TFD=\rho_r^{1/2}$.  
To exploit this fact, let  $\A_{r,V}$ and $\A_{\ell,V}$  be the algebras of all operators acting on $\H_r$ or $\H_\ell$, respectively, in finite volume $V$. Viewing a state
vector $\Psi\in \H_\ell\otimes \H_r$ as a matrix acting on $\H_r$,  an element $\a_r\in\A_{r,V}$ acts on $\Psi$ by $\Psi\to \a_r\Psi$, and an element $\a_\ell\in\A_{\ell,V}$ 
acts on $\Psi$ by $\Psi\to\Psi\a_\ell^\tr$ (where $\a_\ell^\tr$ is the transpose of $\a_\ell$).     If $\Psi$, viewed as a matrix acting on $\H_r$, is invertible,
then every matrix acting on $\H_r$ is of the 
form   $\a_r\Psi$ and of the form  $\Psi\a_\ell^\tr$ 
for some unique
$\a_r\in \A_{r,V}$ and for some unique $\a_\ell\in\A_{\ell,V}$.   In particular, $\Psi_\TFD=\rho_r^{1/2}$ is
invertible, and therefore every vector in $\H_\TFD$ can be obtained from $\Psi_\TFD$ by acting with $\A_{r,V}$, or by acting with $\A_{\ell,V}$.  
The fancy way to say this is that if $\Psi$ is invertible, then it corresponds to a cyclic separating vector\footnote{ \label{cc}  In general, if an algebra $\A$ acts on a Hilbert space $\H$, then a vector $\Psi\in\H$ is said to be separating for $\A$ if
the condition $\a\Psi=0$, $\a\in\A$ implies that $\a=0$, and it is said to be cyclic for $\A$ if vectors $\a\Psi$, $\a\in \A$ are dense in $\H$.} for the
algebras $\A_{r,V}$ and $\A_{\ell,V}$.

 \begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{TFD.png}
 \end{center}
\caption{\small  (a) A thermal density matrix $\rho=\frac{1}{Z}e^{-\beta H}$ can be computed by a path integral on the strip
$0\leq \tau\leq \beta$.  The horizontal direction in the picture represents the ``spatial''  manifold (or lattice) $W$.  (b) The thermofield double state $\Psi_\TFD=\rho^{1/2}$ can be computed by a path integral on a strip
of half the width, $0\leq \tau\leq \beta/2$.   Operators of the ``right'' or ``left'' copy are inserted, respectively, on the boundaries at $\tau=0$ and $\tau=\beta/2$. .  \label{TFDpicture}}
\end{figure} 

We want to take the infinite volume limit of this construction.  As already noted, the left and right Hilbert spaces $\H_r$ and $\H_\ell$
do not have large volume limits, and the formula (\ref{tomigo}) is not meaningful in the thermodynamic limit, because $Z=\infty$ in this limit and
the sum would contain uncountably many terms.
 But it is possible to define a Hilbert space $\H_\TFD$ that contains $\Psi_\TFD$ and
does have a large volume limit.   To explain this, we first review
a few standard facts about finite volume.  We describe these facts in the familiar language of path integrals, though this is not strictly necessary.
 Let $W$ be the spatial manifold (or lattice) on which we want
to formulate theory $\T$. In the thermodynamic limit, $W$ will be $\R^{D-1}$ for a continuum field theory or an infinite lattice   $\Z^{D-1}$ for
a lattice system.    The thermal density matrix $\rho_r=\frac{1}{Z}e^{-\beta H}$ can be computed in finite volume by a path integral on $W\times I$,
where $I$ is the interval $0\leq \tau\leq \beta$ (fig. \ref{TFDpicture})
 The factor of $1/Z$ means that from the energy density $T_{00}$, whose integral is the Hamiltonian $H_r=\int\d^{D-1}x \sqrt g T_{00}$, we should
 subtract a constant, the free energy density at temperature $1/\beta$.     With this subtraction, the path integral, in finite volume, computes a normalized density matrix
 $\rho_r$, satisfying
 $\Tr\,\rho_r=1$.   To construct the thermofield double state $\Psi_\TFD=\rho_r^{1/2}$, we simply do the same path integral (with the same subtraction)
 on a strip of half the width, $0\leq \tau\leq \beta/2$.   Given an operator $\a_r\in \A_{r,V}$, to construct a state obtained
 by acting with $\a_r$ on $\Psi_\TFD$, we just insert $\a_r$ in the path integral at $\tau=0$; similarly, to act with $\a_\ell\in \A_{\ell,V}$ on $\Psi_\TFD$,
 we insert $\a_\ell^\tr$ at $\tau=\beta/2$.   Inner products between these states are computed by gluing together two path integrals on the strip of
 width $\beta/2 $ to make a cylinder of circumference $\beta$.    For example,
 an inner product $\la\b_r\Psi_\TFD|\a_r\Psi_\TFD\ra=\la\Psi_\TFD|\b_r^\dagger\a_r \Psi_\TFD\ra$ is computed by a path integral on the cylinder with insertion
 of $\b_r^\dagger \a_r$ at $\tau=0$.   This quantity is just the expectation value of $\b_r^\dagger \a_r$ in the thermal ensemble:
 \be\label{waggo}\la\b_r\Psi_\TFD|\a_r\Psi_\TFD\ra=\la\Psi_\TFD|\b_r^\dagger\a_r     |   \Psi_\TFD\ra=\Tr\,\rho_r \b_r^\dagger\a_r
 =\frac{1}{Z}\Tr_{\H_r }\exp(-\beta H_r) \b_r^\dagger \a_r.\ee Such  thermal expectation values have a thermodynamic
 limit.\footnote{In taking the thermodynamic limit, we keep the operators fixed, and hence acting on degrees of freedom in a bounded region, while
 the volume goes to infinity.}   Since the density operator $\rho_r$ is strictly positive, one has
 \be\label{toldo}\la\a_r\Psi_\TFD|\a_r\Psi_\TFD\ra= \Tr_{\H_r}\rho_r \a_r^\dagger \a_r>0\ee
 for all $\a_r\not=0$.
  Likewise, for $\a_\ell\not=0$, we can construct states $\a_\ell\Psi_\TFD$ by acting with $\a_\ell^\tr$ at $\tau=\beta/2$.  
  Inner products between these states are obviously given by a formula like eqn. (\ref{waggo}) which again has a thermodynamic limit:
  \be\label{napgo} \la\b_\ell\Psi_\TFD|\a_\ell\Psi_\TFD\ra=\frac{1}{Z}\Tr_{\H_\ell }\exp(-\beta H_\ell) \b_\ell^\dagger \a_\ell.\ee
   Inner products
  $\la\a_\ell\Psi_\TFD|\a_r\Psi_\TFD\ra$ are defined by inserting the operators $\a_r$ and $(\a_\ell^\tr)^\dagger=\a_\ell^*$ (here $\a_\ell^*$ is the complex conjugate of $\a_\ell$; note that because of the complex conjugation, it is naturally an operator on $\H_r$)
  at $\beta=0$ and $\beta=\tau/2$, respectively.  In operator terms, such an inner product is 
  \be\label{moldo} \la\a_\ell\Psi_\TFD|\a_r\Psi_\TFD\ra=\frac{1}{Z}\Tr_{\H_r}\, \a_r e^{-\beta H_r/2} \a_\ell^* e^{-\beta H_r/2}. \ee
Such an inner product also has a thermodynamic limit.   Reflection positivity says that for any $\a_\ell$, there is an $\a_r$ that makes this inner product
nonzero.  We simply choose $\a_r$ to be obtained from $\a_\ell$ by a reflection of the thermal circle.  

In finite volume, the states that appeared in this construction are simply states in $\H_\ell\otimes \H_r$.   In the infinite volume limit,
this is no longer true.  But now we can describe a Hilbert space $\H_\TFD$ that does have a thermodynamic limit.
First we need to pick an algebra of operators that is supposed to act on $\H_\TFD$.   As in section \ref{spins}, we at least want to include
all operators that act on a bounded region of space.  Ultimately we can take limits and include operators whose action is not restricted to a bounded region, but
to know what limits to allow, we first have to know what Hilbert space the operators are supposed to act on.   So we define algebras
$\A_{r,0}$ and $\A_{\ell,0}$ consisting of bounded operators acting on a bounded region in the right system or the left system, respectively.  Now at a minimum we want
$\H_\TFD$ to contain a vector that we call $\Psi_\TFD$ which will be an infinite volume limit of the finite volume thermofield double state.   In addition, we want the algebras $\A_{r,0}$ and $\A_{\ell,0}$ to act on
$\H_\TFD$.   So we say that  for every $\a_r\in\A_{r,0}$, $\H_\TFD$ contains a vector that we call $\a_r\Psi_\TFD$.  $\A_{r,0}$ acts on these
states in an obvious way: $\a_r(\b_r\Psi_\TFD)=(\a_r\b_r)\Psi_\TFD$. We postulate that the inner products
between these states are given by the thermodynamic limit of the thermal correlation functions in eqn. (\ref{waggo}).     Because of eqn. (\ref{toldo}), this
set of states makes up a pre-Hilbert space $\H_{\TFD,0}$, satisfying all conditions of a Hilbert space except completeness.   We take the Hilbert space
completion and get the thermofield double Hilbert space $\H_\TFD$.   We can now also complete $\A_{r,0}$ to a von Neumann algebra $\A_r$ 
that acts on $\H_\TFD$ by including
weak limits, as in section \ref{spins}.

Obviously, we could have carried out this process starting with $\A_{\ell,0}$ instead of $\A_{r,0}$.    One might worry that this would lead to a different
thermofield double Hilbert space $\widetilde\H_\TFD$, with an action of a left algebra $\A_\ell$ instead of $\A_r$.   The reason that this does not happen
is that the formula eqn. (\ref{moldo}) for inner products between states $\a_\ell\Psi_\TFD$ and states $\a_r\Psi_\TFD$ also has a thermodynamic
limit and  implies that $\a_\ell\Psi_\TFD$ can be viewed as a vector in the same Hilbert space $\H_\TFD$ that we defined starting with states $\a_r\Psi_\TFD$.

The upshot is to define a Hilbert space $\H_\TFD$ with an action of completions $\A_\ell$ and $\A_r$ of $\A_{\ell,0}$ and $\A_{r,0}$.   
Inner products between vectors of the form $\a_\ell\Psi_\TFD$ and/or $\a_r\Psi_\TFD$ are defined via the thermodynamic limits of eqns.
(\ref{waggo}), (\ref{napgo}), and (\ref{moldo}).  All expected relations among inner products between Hilbert space vectors are satisfied, because
we are simply taking the thermodynamic limits of formulas that in finite volume do represent inner products between Hilbert space vectors.  
Moreover, in terminology that was defined in footnote \ref{cc}, $\Psi_\TFD\in\H_{\TFD}$ is always a cyclic separating vector for the algebra $\A_r$ (or $\A_\ell$).
     
     The procedure by which we constructed the thermodynamic limit of $\H_\TFD$ is a special case of the Gelfand-Naimark-Segal (GNS) construction
     in which the input is an algebra $\A$ and a state on the algebra, that is a complex-valued linear function $\a\to F(\a)$ such that  $F(1)=1$ and $F(\a^\dagger\a)>0$ for all $\a\not=0$,
     and the output is a Hilbert space $\H$ with an action of $\A$ and a cyclic separating vector $\Psi$.   (Closely related  is the Wightman
     Reconstruction Theorem of axiomatic field theory, in which a Hilbert space is reconstructed from the correlation functions of a local field.)
     The GNS construction proceeds as follows.  One formally associates a vector $\Psi$ to the identity element $1\in \A$, and to every $\a\in \A$
     one associates a vector $\a\Psi$.  
     The action of $\A$ on this set of states
     is defined in the obvious way by $\a(\b\Psi)=(\a\b)\Psi$, and inner products are defined by $\la\a\Psi|\b\Psi\ra=F(\a^\dagger \b)$.  This gives a pre-Hilbert space $\H_0$ with an action of $\A$, and one completes it to a Hilbert space
     $\H$.  From the definitions, it is immediate that $\A$ acts on $\H$ with $\Psi$ as a cyclic separating vector.  Clearly the definition of $\H_\TFD$ is
     the GNS construction applied to the case that $F(\a)$ is the expectation value of $\a$ in the thermodynamic limit.     

\subsection{Surprises In The Thermodynamic Limit}\label{surprises}

So by going to the thermofield double, we can describe the infinite volume limit of quantum statistical mechanics in a separable Hilbert space $\H_\TFD$.
But there are a few surprises.

First of all, evidently $\A_r$ does not act irreducibly on $\H_\TFD$, since it commutes with $\A_\ell$, and
vice-versa. In fact  $\A_\ell$ and $\A_r$ are algebras of a possibly unfamiliar kind: they are generically von Neumann algebras of Type III.
What characterizes algebras of Type II or Type III, as opposed to the more familiar algebras of Type I, is roughly that entanglement is not just a property of the states
that the algebra acts on but is built into the structure of the algebra.
In finite volume $V$, the entanglement entropy of the state $\Psi_\TFD\in\H_\ell\otimes \H_r$ is the same as the thermodynamic entropy of the thermal
density matrix $\rho_r$ or $\rho_\ell$ on one factor.  In particular, it is proportional to $V$ and diverges  in the thermodynamic limit.   Thus in effect $\Psi_{\TFD}$ in the thermodynamic
limit describes a state with an infinite entanglement between the two systems.     But every state in $\H_\TFD$ looks at spatial infinity like $\Psi_\TFD$ and so every state
has the same divergent entanglement entropy.   This is different from the usual situation for a bipartite quantum system $XY$ with  Hilbert space $\H_{XY}=\H_X
\otimes \H_Y$  where $\H_X$
and $\H_Y$ are of infinite dimension.   In such a case, a vector $\Psi_{XY}\in \H_{XY}$ {\it could} have infinite entanglement entropy,
but there are also vectors in $\H_{XY}$ with finite or zero entanglement entropy.  By contrast, in the infinite volume limit, $\H_\TFD$ is not a tensor product  
and no vector in it can be interpreted to have finite entanglement entropy; rather,
the infinite entanglement
entropy between the left and right systems is encoded in the structure of the algebras $\A_\ell$ and $\A_r$.
We will discuss this more thoroughly in section \ref{lss} with simple examples.

A second unusual property of the infinite volume thermofield double comes to light if we think about real time thermal physics.
In finite volume, to study real time thermal physics, we define  the time-dependence of operators in a familiar way: 
\begin{align}\label{standef}  \a_r(t)&=\exp(\i H_r t)\a_r \exp(-\i H_r t)\cr
\a_\ell(t)&=\exp(\i H_\ell t)\a_\ell \exp(-\i H_\ell t).\end{align}
 Then we define real time correlation functions such as
\be\label{toffo} \la \a_r(t_1)\b_r(t_2)\ra =\Tr\,\rho_r  \a_r(t_1)\b_r(t_2). \ee
These functions have a thermodynamic limit.    How do we describe them using the thermofield double?   A subtlety arises here: the Hamiltonians $H_\ell$
and $H_r$ of the left and right system do not make sense as operators on the infinite volume $\H_\TFD$.   This is so because of thermal fluctuations.
In volume $V$, the typical energy in the thermal ensemble is of course proportional to $V$, so the Hamiltonian diverges for $V\to \infty$.   
That in itself is not a problem, because we can ``renormalize'' $H_\ell$ and $H_r$ by subtracting a multiple of $V$ to get an operator whose expectation value
vanishes for $V\to\infty$.   The problem comes from the thermal fluctuations.   
    The typical fluctuations in $H_\ell$ and $H_r$ in volume $V$ are of order $V^{1/2}$, which also diverges for $V\to\infty$.  Even after subtracting constants
    from $H_\ell$ and $H_r$ to set their expectations values in the thermal ensemble to zero, the divergent fluctuations remain, and imply that $H_\ell$ and $H_r$
    do not have limits as operators on $\H_\TFD$.
    
    So how are we going to define real time correlation functions?   The answer is that the operator $\h H=H_r-H_\ell$ does have a thermodynamic limit as an
    operator on $\H_\TFD$.    This results from the fact that in finite volume $\h H$ annihilates $\Psi_\TFD$, as is evident from the definition (\ref{tomigo}).
    With the aid of $\h H$, we can describe real time thermal physics.   We define
    \begin{align}\a_r(t)&=\exp(\i \h H t)\a_r \exp(-\i \h H t) \cr
                        \a_\ell(t)&=\exp(-\i \h H t)\a_\ell \exp(\i\h H t). \end{align}
     The motivation for these definitions is that in finite volume they agree with the standard definitions  (\ref{standef}), since $[H_\ell,\a_r]=[H_r,\a_\ell]=0$.
 In terms of these definitions, the thermodynamic limit of real time correlation functions is given by formulas such as
 \be\label{omgon}\la\a_{\ell,r}(t_1)\b_{\ell,r}(t_2)\ra=\la\Psi_\TFD|a_{\ell,r}(t_1)b_{\ell,r}(t_2)|\Psi_\TFD\ra,\ee where the subscripts $\ell,r$ mean that the operators can
belong to  either $\A_\ell$ or $\A_r$.
     
     Since the operator $\exp(\i \h H t)$ is not   contained in either $\A_\ell$ or $\A_r$, it follows that time translations are a group of outer automorphisms of
     $\A_\ell$ and of $\A_r$.   Now consider the following question.   Suppose that one has access to the Hilbert space $\H_\TFD$, the state $\Psi_\TFD$,
     and the algebra $\A_r$, but one does not know how this data arose by taking a thermodynamic limit.
     Just from $\H_\TFD$, $\Psi_\TFD$, and $\A_r$, 
       how would one identify which outer automorphism group of $\A_r$ corresponds to time translations?   The answer to this
     question is given by Tomita-Takesaki theory.   Here we will just state a few facts, leaving the reader to look elsewhere (for example, sections 3 and 4 of
     \cite{WittenNotes}) for
     a detailed explanation.  
      In Tomita-Takesaki theory, to a Hilbert space $\H$, an algebra $\A$ of operators on $\H$ and a state
     $\Psi\in\H$ that is cyclic and separating\footnote{See footnote \ref{cc} for the meaning of ``cyclic and separating.''}  for $\A$, one associates 
  a modular operator $\Delta_\Psi$.      For example, if $\H=\H_{XY}=\H_X\otimes\H_Y$ 
  is the Hilbert space
  of a bipartite system $XY$, $\A=\A_X$ is the algebra of operators on $\H_X$, and $\Psi=\Psi_{XY}$ is a vector in $\H_{XY}$,  then the cyclic separating
condition is that the reduced density matrices $\rho_X$ and $\rho_Y$ of $\Psi_{XY}$ are invertible, and in this case the modular operator is $\Delta_\Psi=\rho_X\otimes \rho_Y^{-1}$.
(See eqn. (4.26) in \cite{WittenNotes}, for example.)   In finite volume,  these conditions are satisfied by
$\H=\H_\TFD=\H_\ell\otimes \H_r$, $\Psi=\Psi_\TFD$, $\A=\A_r$, $\rho_r=\frac{1}{Z}e^{-\beta H_r}$, $\rho_\ell=\frac{1}{Z}e^{-\beta H_\ell}$.    So
$\Delta_{\Psi_\TFD}=\rho_r\otimes \rho_\ell^{-1}=\exp(-\beta \h H)$.   Though $\rho_\ell$ and $\rho_r$ do not have a thermodynamic
limit, $\Delta_{\Psi_\TFD}$ and $\h H$ do have such a limit and 
the formula $\Delta_{\Psi_\TFD} =\exp(-\beta \h H)$ is valid in the thermodynamic limit.
 So we can express $\h H$ in terms of the modular operator: $\h H=-\frac{1}{\beta }\log \Delta_{\Psi_\TFD}$.


\subsection{Examples From  Spin Systems}\label{lss}

Here we will consider some concrete examples of the thermofield double construction  for a system with an infinite
number of degrees of freedom.\footnote{Some of the following was described from a different point of view in section 6 of \cite{WittenNotes}.}   
As in section \ref{spins}, we consider a countably infinite set of qubits, which we label by a positive integer $n$, making the ``right'' system.   
To study this system via the thermofield
double, we introduce another infinite collection of qubits, the ``left'' system.  We write $\H_{r,N}$ for the Hilbert space of the first $N$ qubits
of the right system, and $\H_{\ell,N}$ for the analog for the left system.

We will consider extremely simple Hamiltonians of the form $H=\sum_{n=1}^\infty  H_n$, where $H_n$ is a single-qubit Hamiltonian.    One may be surprised
that this case is rich enough to be interesting.   In fact the various von Neumann algebras\footnote{To be more precise, the  ``hyperfinite'' von Neuman
algebras all arise this way.   A hyperfinite algebra is one that can be approximated by a finite-dimensional matrix algebra.  Hyperfinite algebras are usually the
ones that arise in physics, because infinite constructions in physics are usually limits of finite constructions.   The classification of von Neumann algebras is much more
complicated in the non-hyperfinite case.}
can all arise from such a construction and some
of them were first discovered in this way \cite{VN,Powers,ArakiWoods}.

The simplest Hamiltonian of all is $H=0$, so we will start with that case.   Let us write $|i\ra_{n,r}$, $i=1,2$ 
for the two states of the $n^{th}$ qubit of the  ``right'' system, 
and $|\bar i\ra_{n,\ell}$, $i=1,2$ for the time-reversed states of the $n^{th}$ qubit of the ``left'' system.   The analog of defining the thermofield double
state first in finite volume, as in eqn. (\ref{tomigo}), is to define the thermofield double state first for the first $N$ qubits of the right system, together with their
partners in the left system.   With $H=0$, the thermofield double state $\Psi_\TFD\in \H_{r,N}\otimes \H_{\ell,N}$  is just a completely entangled state of $N$ pairs of qubits:
\be\label{wacko}\Psi_{\TFD}=\frac{1}{\sqrt{Z_N}}\bigotimes_{n=1}^N \sum_{i=1,2}|i\ra_{n,r}\otimes |\bar i\ra_{n,\ell},~~~Z_N=2^{N}. \ee
Arranging the four states $|i\ra_{n,r}\otimes |j,\ra_{n,\ell}$, $i,j=1,2$  in a $2\times 2$ matrix in a fairly obvious way, we can write
\be\label{zacko} \Psi_\TFD=\frac{1}{\sqrt {Z_N}}\bigotimes_{n=1}^N\begin{pmatrix}1& 0\cr 0& 1\end{pmatrix}.\ee

Now let $\A_{r,0}$ be the algebra of all operators on the right system that act nontrivially on only finitely many qubits.     If $\a_r\in \A_{r,0}$, then for sufficiently large $N$,
 we can view $\a_r$ as an operator on $\H_{r,N}\otimes \H_{\ell,N}$ and define
$F(\a_r)=\la\Psi_\TFD|\a_r|\Psi_\TFD\ra$.   For given $\a_r$, this definition does not depend on $N$, once $N$ is large enough 
so that $F(\a_r)$ is defined.   So  $F(\a_r)$ is well-defined for all $\a_r\in \A_{r,0}$.
It clearly  is linear in $\a_r$ and satisfies $F(\a_r^\dagger\a_r)>0$ for $\a_r\not=0$, so it defines a state on the algebra $\A_{r,0}$.  
So we can invoke the GNS construction, as described in section \ref{td}, and construct the thermofield double Hilbert space $\H_\TFD$, with an action of
$\A_{r,0}$,  and  containing the distinguished  thermofield double state $\Psi_\TFD\in\H_\TFD$. 

By including weak limits, we can take the closure of $\A_{r,0}$ to get an algebrs $\A_r$ of bounded operators that acts on $\H_\TFD$.   This is an algebra of
an unfamiliar kind -- a Type II von Neumann algebra.   In fact, it is a Murray-von Neumann factor\footnote{A factor is a von Neumann
algebra whose center consists only of the complex scalars. }  of Type II$_1$ \cite{MvN}. 
To see that the algebra $\A_r$ is of an unfamiliar type, note that the function $F(\a_r)$ satisfies
\be\label{zombo} F(\a_r \b_r)=F(\b_r\a_r).  \ee
Thus, this function has the algebraic properties of a trace, so we will denote it as one: $F(\a_r)=\Tr\,\a_r$.   Moreover, this trace is defined (and  finite) for all elements of the algebra;
in particular, $\Tr\,1=1$.    By contrast, the obvious example of an infinite dimensional von Neumann algebra is the algebra $\A$ of all bounded operators on a
separable Hilbert space $\H$.   This algebra, which is said to be of Type I$_\infty$,
 does have a trace $\Tr$, but the trace is not defined for all elements of $\A$ (only for those that are ``trace class'') and
in particular  in a Type I$_\infty$ factor, $\Tr\,1=+\infty$.   So the algebra $\A_r$ is something new.


Intuitively, since the Type II$_1$ factor $\A_r$ was constructed by considering an infinite collection of maximally entangled qubit pairs,
an infinite amount of entanglement is built into the structure of this algebra.
A  Type II$_1$ algebra  does not have an irreducible representation in a Hilbert space.    
We constructed a  representation of the Type II$_1$ algebra
 $\A_r$  on the Hilbert space $\H_\TFD$, but this representation is far from irreducible, since the action of $\A_r$ on $\H_\TFD$ commutes with the action of another Type II$_1$ algebra $\A_\ell$
that is  defined similarly, starting with operators that act only on finitely many qubits of the left system and taking limits.    The algebras $\A_r$ and $\A_\ell$
commute and in fact they are each other's commutants.\footnote{The commutant of a von Neumann algebra $\A$ acting on a Hilbert space $\H$ is the algebra $\A'$
that consists of all bounded operators on $\H$ that commute with $\A$.}   As this example illustrates, when  a Type II$_1$ algebra acts on a Hilbert space, its commutant is   another
Type II algebra.


Murray and von Neumann classified the Hilbert space representations of a hyperfinite Type II$_1$ algebra.  They are labeled up to isomorphism by a regularized ``dimension'' $x$, which is a non-negative real number or $\infty$.   $\H_\TFD$ corresponds to the case $x=1$.   To construct representations with $x<1$, we use projection operators in $\A_\ell$.    For example, for $1\leq k\leq 2^N$, 
pick a $k$-dimensional subspace $W\subset \H_{\ell,N}$, and let $\Pi:\H_{\ell,N}\to W$ be the orthogonal projection operator of $\H_{\ell,N}$ onto $W$ (tensored with the identity operator on all other qubits).   The image of $\Pi$ in
$\H_\TFD$ is a representation of $\A_r$ with  $x=k/2^N$.  All values $x<1$ are limits of this with $k,N\to\infty$.   Since $x$ is additive when one takes the
direct sum of two representations, any representation is the direct sum of a representation with $x<1$ and a number of copies of $\H_\TFD$.   
Roughly, the value of $x$ for a Hilbert space representation $\RR$ of $\A_r$ is defined as the trace of the identity element of $\A_r$ in the representation $\RR$.
Some more detail is needed to make this precise, but anyway the existence of inequivalent representations of $\A_r$ is related to the fact that $\A_r$ has a trace.



   The other hyperfinite von Neumann algebra of Type II is a Type II$_\infty$ algebra.   It can
be obtained as the tensor product of a Type II$_1$ algebra with a Type I$_\infty$ algebra of all bounded operators on a separable Hilbert space.
It has a trace, which, because of the Type I$_\infty$ factor, is not defined for all elements of the algebra.   

Repeating this construction with a non-zero Hamiltonian, we can get the other hyperfinite von Neumann algebras.   Again 
with $H=\sum_{n=1}^\infty H_n$, the next
simplest case is to take 
\be\label{nextcase}H_n=\begin{pmatrix} 0&0\cr 0&E \end{pmatrix},\ee all with the same constant $E$.   The thermofield double state, in the notation of (\ref{zacko}),
is
\be\label{ozacko} \Psi_\TFD=\frac{1}{\sqrt {Z_N}}\bigotimes_{n=1}^N  \begin{pmatrix}1& 0\cr 0& e^{-\beta E/2}\end{pmatrix}, ~~~~Z_N=(1+e^{-\beta E})^N.\ee
In the large $N$ limit, we can again define a state on the algebra $\A_{r,0}$ by $F(\a_r)=\la\Psi_\TFD|\a_r|\Psi_\TFD\ra$.   The GNS construction gives
the thermofield double Hilbert space $\H_\TFD$, with an action on $\H_\TFD$ of an algebra $\A_r$ that is a closure of $\A_{r,0}$, and with a cyclic separating state $\Psi_{\TFD}$.

The state $\Psi_{\TFD}$ in this example describes  an infinite collection of qubit pairs all with the same non-maximal entanglement.   So 
$\A_r$ is again an algebra that encodes an
infinite amount of entanglement.  What is different for $E\not=0$ is that generically $F(\a_r b_r)\not= F(\b_r\a_r)$.   So the function $F$ is no longer
a trace, and indeed for $E\not=0$, $\A_r$  does not have a trace.   The algebra $\A_r$ is called an algebra of Type III$_\lambda$ with $\lambda=e^{-\beta E/2}$.
An algebra of this type was originally constructed in precisely the way that we have described \cite{Powers}.

In almost any real problem in quantum statistical mechanics, the algebra $\A_r$ that acts on the thermofield double is instead a von Neumann algebra
of Type III$_1$.   The original construction of such an algebra \cite{ArakiWoods} was based on again taking $H=\sum_{n=1}^\infty H_n$ to be a sum of
single-qubit Hamiltonians, but with different $H_n$:
\be\label{nextcasse}H_n=\begin{pmatrix} 0&0\cr 0&E_n \end{pmatrix}.\ee   In this general form, we will call the model the Araki-Woods model.
As long as $\lim_{n\to\infty } E_n\not=\infty$, there is an infinite amount of entanglement between the left and right systems, and the algebra
$\A_r$ that acts on $\H_\TFD$ will not be of Type I.  (The case $\lim_{n\to\infty} E_n=\infty$ is discussed in section \ref{ht}.)
 Except in rather special cases, $\A_r$ is a new type of  algebra that is said to be of Type III$_1$.   For example, if the $E_n$ take
two values $E$ and $E'$, each with infinite multiplicity, then, for generic $E$ and $E'$, the algebra $\A_r$  is of Type III$_1$.
This is again an algebra without a trace.

Unlike a Type II$_1$ algebra, a Type III algebra only has one  representation in a Hilbert space, up to 
isomorphism.    In the construction that we have just
described, the representation $\H_\TFD$ of
the Type III$_1$ algebra $\A_r$  is far from irreducible, since  the commutant of $\A_r$ is another Type 
III$_1$ algebra $\A_\ell$ that can be defined in the same way.
We can again choose a projection operator $\Pi\in\A_\ell$, and the image of $\Pi$ is a subspace  
$\Pi\H_\TFD\subset \H_\TFD$ that provides a representation of $\A_r$.
But as representations of $\A_r$, $\H_\TFD$ and $\Pi\H_\TFD$ are equivalent, even though one might naively 
think that the second one is smaller.   For Type II$_1$, the existence of the invariant $x$ that distinguishes
representations of different ``size'' is tied to the existence of a trace; for Type III, there is no trace 
and any two nontrivial representations are isomorphic.

Following is a summary of some facts about (hyperfinite) von Neumann algebras.   In all of these statements, 
we assume that the algebra considered is a ``factor''
(its center consists only of complex scalars).   Algebras that are not factors can be constructed in a relatively simple way from factors.  

(1) A Type I algebra $\A$ has an irreducible representation in a Hilbert space $\RR$. Its commutant in this representation consists only of its center, the
complex scalars.  This representation is essentially unique in the sense that any representation of $\A$ is a direct sum of copies of $\RR$;
differently put, any representation is of the form $\RR\otimes \Q$, where $\Q$ is some
other Hilbert space on which $\A$ acts trivially.  
  $\A$ is said to be of Type I$_n$ if $\RR$ is $n$-dimensional,
and of Type I$_\infty$ if $\RR$ has countably infinite dimension.

(2) A Type II factor $\A$ has no irreducible representation in a Hilbert space; its commutant 
in any representation is another Type II factor.   There are two hyperfinite
Type II algebras, up to isomorphism. 
 A hyperfinite Type II$_1$ algebra has a trace defined for all elements of the algebra; its representations are labeled by a positive real number $x$ (it is also
 possible to have a representation with $x=\infty$; this happens if the commutant of the Type II$_1$ algebra is of Type II$_\infty$).
A hyperfinite Type II$_\infty$ algebra has a trace that is defined only for some elements of the algebra; when it acts on a Hilbert space,
its commutant is of Type II$_1$ or Type II$_\infty$, and thus it has  distinct kinds of Hilbert space representation. (A representation in which the commutant is
of Type II$_\infty$ is unique up to isomorphism; a representation in which the commutant is of Type II$_1$ can be classified by a positive real number $x$,
but there is no canonical way to normalize $x$.) 



(3) A Type III algebra $\A$ has no irreducible representation in a Hilbert space; its commutant in any representation  
is another algebra isomorphic to $\A$.
A Type III algebra has no trace, and its representations are all isomorphic.  In the thermodynamic limit, 
the natural algebra of observables of a generic system in quantum statistical mechanics
 is of Type III$_1$.    The other hyperfinite Type III algebras are the Type III$_\lambda$ algebras that we have
 described, and a Type III$_0$ algebra that is a kind
 of $\lambda\to0$ limit of a Type III$_\lambda$ algebra.




\subsection{Relation To Quantum Field Theory}\label{reln}

In section \ref{QFT}, in order to understand quantum field theory in a curved spacetime $M$, especially in the case of an open universe, it was important
to consider the algebra $\A_\U$ of observables in a local region $\U\subset M$.    Now that we have some experience with von Neumann algebras,
we can return to this subject and ask what kind of algebra is $\A_\U$.     

We consider again the setup discussed in section \ref{whatis}.    We take $S$ to be a Cauchy hypersurface in $M$, which
we assume compact for simplicity, and $B$ to be a codimension 1 submanifold of $S$   whose
complement  consists of two open sets $V$ and $V'$ (fig. \ref{Bounded}).   We let $\U$ and $\U'$ be the domains of dependence of $V$ and $V'$ in $M$.
Then $\A_\U$ and $\A_{\U'}$ are the algebras
of observables in bounded regions of spacetime.   

To identify the algebra $\A_\U$, we use the simple remarks about von Neumann algebras that were explained at the end of section \ref{lss}.   
We also use a few facts about quantum field theory.   One set of facts involves entanglement.  For any state $\Psi\in\H$, there is a universal divergence in the entanglement entropy between
modes in $\U$ and modes in $\U'$.   The divergence comes from short wavelength modes that are localized near $B$, the ``entangling surface'' that separates
$\U$ and $\U'$.   The leading divergence is universal in the sense that it does not depend on the choice of $\Psi$.   The reason for this is that the divergence
comes from modes of very short wavelength, and at short distances every state in $\H$ looks the same.  Because it comes from modes localized near $B$,
the leading divergence is proportional to the area of $B$.   The divergence involves pairs of modes on opposite sides of $B$ that are entangled. The geometry of $\U$ and $\U'$ near $B$ can
be modeled locally by two opposite Rindler wedges in Minkowski space (see fig. \ref{Bounded}(b)), so the entanglement structure at short distances is given by Unruh's thermal
interpretation of Rindler space \cite{Unruh}, or equivalently by the Bisognano-Wichman theorem \cite{BW} which describes the application of Tomita-Takesaki
theory to Rindler space.\footnote{The contributions of Unruh and of Bisognano and Wichman were done independently at about the same
time.   The connection between them was appreciated only years afterward, by Sewell \cite{Sewell}.}  The thermal description shows that many different
pairs of modes have all possible degrees of entanglement.   In fact, the modular Hamiltonian of Rindler space is a Lorentz boost generator,
which has a continuous spectrum consisting of all real numbers.  

We also need the fact  that the local algebras in quantum field theory do not have a trace.  Given any $\a\in\A_\U$,  
its trace in $\H$ is divergent because of the infinity
of things that could be happening in region $\U'$, and there is no regularized version of this trace.

Given these facts, we can guess what type of algebra is $\A_\U$.   The algebras whose structure incorporates a universal divergence in the entanglement
entropy are of Type II and Type III.   The absence of a trace tells us that $\A_\U$ is of Type III.   And the fairly generic pattern of entanglement, with many 
 modes of all possible degrees of entanglement, analogous
to a rather generic choice of $E_n$'s in eqn. (\ref{nextcasse}),  indicates that the algebra is of Type III$_1$.

This is believed to be the right answer.  Rigorous arguments are available  \cite{Fred}, at least for open sets in Minkowski space.  Informal summaries
of these arguments with somewhat more detail than provided here can be found
 in \cite{HaagBook}, section V.6 and in \cite{WittenNotes}, section 6.5. 
 
In either quantum field theory or statistical mechanics, the Type III nature of the algebras is associated, as we have seen, 
to a divergence in the entanglement entropy.
In quantum field theory, this is an ultraviolet divergence between modes inside and outside the entangling surface $B$; in statistical mechanics
it is an infrared divergence between the modes of the left and right systems.   Even though one divergence 
is an ultraviolet divergence and the other
is an infrared divergence, they are actually quite similar.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=4.5in]{Conformal.png}
 \end{center}
\caption{\small  (a) In a two-dimensional spacetime, we consider
a  Cauchy hypersurface consisting of a circle $S$.  The entangling surface $B$
is a pair of points $p,p'$, whose complement in $S$ consists of the two intervals $V$ and $V'$.  (b) A path integral
on the disc $W$, whose boundary is $S$, computes the ground state of a conformal field theory.
(c)  The disc with the points $p$ and $p'$ removed can be conformally mapped to
$\R\times I$, where $I$ is a unit interval.  $V$ and $V'$ become the two boundary 
components of $\R\times I$, and the points $p,p'$ are projected to infinity.  \label{Conformal}}
\end{figure} 

 One aspect of the similarity is that in the case of a conformal field theory (CFT),
one can actually make a conformal transformation between the two types of divergence.
This is best-known in the case of a two-dimensional CFT \cite{HLW,CC}.  One takes the initial value surface $S$ to be a 
circle, and one takes the entangling surface $B$
to consist of a pair of points $p,p'\in S$; the complement of these points is the union of two open intervals 
$V$ and $V'$ (fig. \ref{Conformal}(a)).   Let $\H$ be the Hilbert space of the given theory
formulated on $S$.   The conformally invariant
ground state $\Omega\in\H$ can be computed by a path integral on a disc $W$ whose boundary is $S$ (fig. \ref{Conformal}(b)).  The state $\Omega$
is highly entangled between regions $V$ and $V'$.   If one tries to quantify this entanglement by computing the entanglement entropy
between $V$ and $V'$, one runs into
an ultraviolet divergence which is related to the fact that the local algebras actually are of Type III.   This ultraviolet 
divergence can be converted into
an infrared divergence by a conformal mapping that maps the disc $W$, minus the two points $p$ and $p'$, to an infinite 
strip $\R\times I$, where $I$ is an interval (fig. \ref{Conformal}(c)).    
After a Weyl
rescaling, one can take the metric of $\R\times I$ to be the flat metric $\d x^2+\d\tau^2$, $-\infty<x<\infty$, $0\leq\tau \leq 1$.
The path integral on this strip describes the thermofield double of the theory under study on the noncompact initial value 
surface $S'=\R$, and with inverse temperature 1;
the two open intervals $V$ and $V'$ have become the boundaries of the strip at $\tau=0,1$, corresponding to 
the two copies in the thermofield double.
The points $p$ and $p'$ have been projected to $x=\pm \infty$.    In the description on the disc, there is an 
ultraviolet divergence in the entanglement entropy of the
vacuum that arises from the behavior
of modes on opposite sides of the points $p$ or $p'$.     In the description on the strip, this divergence is 
reinterpreted as an infrared divergence  in the entanglement entropy of the thermofield
double near $x=\pm \infty$.

All this has an analog for a conformally invariant theory in any dimension $D$  \cite{Cas,Cas2}.   
One takes the initial value surface $S$ to be a $(D-1)$-sphere with a round
metric.  One further takes the entangling surface $B$ to be an ``equator'' in $S$, and $V$ and $V'$ to be 
the northern and southern hemispheres. Thus the setup is the same as before, except that $S$ is a $(D-1)$-sphere instead of
a circle, and for $D>2$, the equator in $S$ is connected, rather than consisting of two isolated points.    The ground state
$\Omega$ of a $D$-dimensional CFT
 can be computed by a path integral on a flat unit ball $W$ in $D$ dimensions,  whose boundary is $S$.   
 After removing the equator $B$ of the boundary, $W$
 can be conformally mapped to a product $H\times I$, where $H$ is hyperbolic space of dimension $D-1$, and 
 $I$ is again the interval $0\leq \tau\leq 1$.
A path integral on $H\times I$ again describes a thermofield double at termperature 1.    The only 
difference from before is that the spatial
manifold $H$ on which the thermodynamics is defined is hyperbolic space of dimension $D-1$ rather than 
Euclidean space.   But $H$ has infinite volume just like Euclidean space, and
there is an infrared divergence in the entanglement entropy between the two sides of the thermofield double.   
This divergence matches the ultraviolet divergence
between modes on $V$ and modes on $V'$ in the original description on the sphere.

\subsection{The Hagedorn Temperature}\label{ht}

In this section, we return to the Araki-Woods model of a Hamiltonian that is a sum of single-qubit Hamiltonians $H=\sum_{n=1}^\infty H_n$, with
\be\label{believe} H_n=\begin{pmatrix} 0 & 0\cr 0 & E_n \end{pmatrix}.\ee
Now, however, we assume that $\lim_{n\to\infty} E_n=+\infty$.   We also assume for convenience that the $E_n$ are all positive, so that the
ground state of the $n^{th}$ qubit is the state $|\negthinspace\uparrow\ra_n=\begin{pmatrix}1\cr 0\end{pmatrix}$.   The ground state of the whole system
is $|\Omega\ra_\uparrow=\otimes_{n=1}^\infty |\negthinspace\uparrow\ra_n$.    As in section \ref{spins}, a Hilbert space $\H^*$ that describes all states of infinitely many qubits
is nonseparable.   But we can define a separable Hilbert space $\H$ in which
every state can be approximated by states in which all but finitely many qubits are in their ground state $|\negthinspace\uparrow\ra_n$.   

$\H$  has a basis consisting of states in which all qubits except some finite subset $n_1,n_2,\cdots, n_k$ are in their ground state.
The energy of such a state is $E=E_{n_1}+E_{n_2}+\cdots + E_{n_k}$.   Now let us ask this question:   What is the probability to observe such a state
in a thermal ensemble, at inverse temperature $\beta$?   The probability to observe
 a microstate of energy $E$ is  of course $p(E,\beta)=\frac{1}{Z(\beta)}e^{-\beta E}$, where
\be\label{tofo} Z(\beta) =\prod_{n=1}^\infty (1+e^{-\beta E_n})\ee
is the partition function.   In section \ref{td}, we studied models in which the partition function diverges in the limit of infinitely many qubits, but now we wish
to consider the case that the $E_n$ tend to infinity quickly enough that $Z(\beta)$ converges, at least for some range of $\beta$.
Clearly when $Z(\beta)<\infty$, we have $p(E,\beta)>0$ and the probability to observe any given microstate in $\H$ in the thermal ensemble is positive.

This suggests that the thermal ensemble at inverse temperature $\beta$ can simply be defined in the Hilbert space $\H$.   To see that this is the
case, let us ask what is the probability that, for some $N$,  all qubits except the first $N$ are in their ground state.   The probability for this
in the thermal ensemble is $Z_N(\beta)/Z(\beta)$, where $Z_N(\beta)$ is a truncated partition function defined for the first $N$ qubits:
\be\label{tofoo} Z_N(\beta) =\prod_{n=1}^N (1+e^{-\beta E_n}).\ee
If $Z(\beta)=\infty$, then $Z_N(\beta)/Z(\beta)=0$ for all $N$, since $Z_N(\beta)$ is finite, but if $Z(\beta)<\infty$, then
\be\label{zofo}\lim_{N\to\infty}\frac{Z_N(\beta)}{Z(\beta)}=1. \ee
For $Z(\beta)<\infty$, this shows that, with probability 1, any state in the thermal ensemble can be approximated arbitrarily well by states in $\H$.

Therefore, in this situation, it is not necessary to go to the thermofield double in order to describe the thermal ensemble of an infinite number of qubits
in a separable Hilbert space.   What happens if we do go to the thermofield double anyway?   The answer is that we get nothing essentially new; when $Z<\infty$
the thermofield double does not combine the two copies in an interesting way.

To explain how this comes about, we consider two copies of this system,\footnote{The system considered has an obvious time-reversal symmetry, so the
two copies are identical.} the left and right copy, each consisting of countably many qubits with identical Hamiltonians.   There are nonseparable
Hilbert spaces $\H_\ell^*$ and $\H_r^*$ that describe all possible states of the left and right systems, and these  contain separable subspaces $\H_\ell$ and $\H_r$
that have bases with finitely many qubits excited.  We also write $\A_{\ell,0}$ or $\A_{r,0}$ for the algebras of operators that act on finitely many qubits
of the left or right systems, respectively, and $\Omega_{\uparrow,r}$, $\Omega_{\uparrow,\ell}$ for the ground states of the right and left systems.

We can define the thermofield double state in the naive way as a vector in $\H_\ell^*\otimes \H_r^*$:
\be\label{nozacko} \Psi_\TFD=\frac{1}{\sqrt {Z(\beta)}}\bigotimes_{n=1}^\infty \begin{pmatrix}1& 0\cr 0& e^{-\beta E_n/2}\end{pmatrix}.\ee
Then we define the thermofield double Hilbert space $\H_\TFD$ as the closure of the set of all vectors of the form $\a_r\Psi_\TFD$, $\a_r\in\A_{r,0}$.

In section \ref{lss}, we could not define the thermofield double state and Hilbert space of an infinite system in this simple way, because we were considering systems
with $Z(\beta)=\infty$.   Therefore, in eqns. (\ref{zacko}) and (\ref{ozacko}), we defined the thermofield double state directly by a formula analogous to (\ref{nozacko})
for a finite system of $N$ qubit pairs, and  we invoked the GNS construction to define $\Psi_\TFD$ and $\H_\TFD$ in the limit of an infinite system.

{\it A priori}, eqn. (\ref{nozacko})  defines $\Psi_\TFD$ as a vector in the nonseparable Hilbert space $\H_\ell^*\otimes \H_r^*$, and likewise it defines $\H_\TFD$
as a subspace of that space.   But actually, when $Z(\beta)<\infty$ so that the definition (\ref{nozacko}) makes sense, $\H_\TFD$
is the same as the separable Hilbert space $\H_\ell\otimes\H_r$.  To see this, observe that a truncated version of $\Psi_\TFD$, namely
\be\label{noozacko} \Psi_{\TFD,N}=\frac{1}{\sqrt {Z(\beta)}}\bigotimes_{n=1}^N \begin{pmatrix}1& 0\cr 0& e^{-\beta E_n/2}\end{pmatrix}\bigotimes_{n=N+1}^\infty
\begin{pmatrix} 1& 0 \cr 0 & 0 \end{pmatrix}\ee
is manifestly contained in $\H_\ell\otimes \H_r$.    But $\lim_{N\to\infty}\Psi_{\TFD,N}=\Psi_{\TFD}$.   So $\Psi_{\TFD}\subset \H_\ell\otimes \H_r$.
This implies that $\H_\TFD\subset \H_\ell\otimes \H_r$, since $\H_\TFD$ is generated from $\Psi_\TFD$ by the action of $\A_{r,0}$, and $\H_\ell\otimes \H_r$
is closed under the action of $\A_{r,0}$.
Conversely,  $\A_{r,0}$ contains an operator $\Pi_N$ that projects onto the ground state of the first $N$ qubits, and acts trivially on others;
since $|\Omega\ra_{\uparrow,\ell}\otimes |\Omega\ra_{\uparrow,r}=Z(\beta)\lim_{N\to\infty}\Pi_N\Psi_\TFD$, we have $|\Omega\ra_{\uparrow,\ell}\otimes |\Omega\ra_{\uparrow,r}\in \H_\TFD$, implying, since $\H_\ell\otimes\H_r$ is generated from $|\Omega\ra_{\uparrow,\ell}\otimes |\Omega\ra_{\uparrow,r}$
by acting with $\A_{\ell,0}\otimes \A_{r,0}$, that $\H_\ell\otimes \H_r\subset \H_\TFD$.



In short, when $Z(\beta)<\infty$, the thermofield double Hilbert space $\H_\TFD$ is just a simple tensor product $\H_\TFD=\H_\ell\otimes \H_r$.
Likewise, if we take the closures of $\A_{\ell,0}$ and $\A_{r,0}$ to get von Neumann algebras $\A_\ell$ and $\A_r$  that act on 
the thermofield double, we get nothing essentially new:
$\A_\ell$ and $\A_r$ are simply the Type I$_\infty$ algebras of all bounded operators on $\H_\ell$ and $\H_r$, respectively. In this situation,
the Hamiltonians $H_\ell$ and $H_r$ of the left and right systems are well-defined as operators on $\H_\TFD$ and are elements of $\A_\ell$ and $\A_r$
respectively.    All in all, when $Z(\beta)<\infty$, we gain little by going to the thermofield double; it is just a tensor product of two decoupled systems.

On the other hand, if $Z(\beta)=\infty$, we are in the situation described in section \ref{lss}.   The thermofield double Hilbert space $\H_\TFD$ is an essentially
new construction, not a simple tensor product, and the corresponding algebras $\A_\ell$ and $\A_r$ are generically of Type III$_1$.   The operators $H_\ell$
and $H_r$ cannot be defined as operators on $\H_\TFD$.   As a partial substitute one has $\h H=H_r-H_\ell$, which does have a limit for the infinite system,
and generates a group of outer automorphisms of $\A_r$ and of $\A_\ell$.

A particularly interesting case, and important background for section \ref{large}, is the borderline case in which $Z(\beta)<\infty$ at low enough temperature, but $Z(\beta)=\infty$ at sufficiently high temperature.
This can happen if $E_n\sim c\log n$ for large $n$, with a constant $c$.   Then at low temperatures, the thermofield double construction just describes two
decoupled systems, and all algebras are of Type I.   But at high termperatures, the thermofield double construction is genuinely new, combines the two systems in a subtle way,  and is essential
if we wish to describe the infinite qubit system in a separable Hilbert space.   The algebras are of Type III, and time translations of the algebras
are a group of outer automorphisms.    By analogy with standard terminology in strong interaction theory, string theory, and large $N$ gauge theory,
we call the temperature at which $Z(\beta)$ ceases to converge the Hagedorn temperature $T_H$, and we also write $\beta_H=1/T_H$.

\subsection{Density Matrices and Entropy}\label{density}

For a quantum system with a Hilbert space $\H$ of physical states, one usually defines the von Neumann entropy, for a state of the system described
by a density matrix $\rho:\H\to\H$, by $S(\rho)=-\Tr\,\rho\log \rho$.  As usual, here $\rho$ is a positive self-adjoint operator normalized to $\Tr\,\rho=1$.
The trace function $\a\to \Tr\,\a$  is a complex linear function from the algebra $\A$ of all operators
on $\H$ (or all bounded operators if $\H$ is infinite-dimensional) to $\C$; it satisfies $\Tr\,\a^\dagger\a>0$ for all $\a\not=0$.   This last condition ensures
that the function $F(\a)=\Tr\,\a\rho$ satisfies the conditions as stated in section \ref{whatis} for a state on the algebra $\A$. 
Conversely, every state on the algebra $\A$ is of the form $F(\a)=\Tr\,\a\rho$ for some density matrix $\rho$.  To prove this, one first observes that
the trace is nondegenerate, in the sense that every linear function on $\A$ is of the form $F(\a)=\Tr\,\a\b$ for some $\b\in\A$.   The other axioms
for a state (namely $F(\a^\dagger\a)\geq 0$ and $F(1)=1$) imply that $\rho$ must be a positive operator satisfying $\Tr\,\rho=1$, in other words, a density matrix.

Now consider any von Neumann algebra $\A$ that acts on a Hilbert space $\H$.   An element of $\A$ is called positive if it corresponds to a positive,
self-adjoint operator on $\H$.    If the algebra $\A$ has a nondegenerate trace,  
then the same arguments as before show that any state on $\A$
is of the form $F(\a)=\Tr\,\a\rho$, where $\rho$ is a density matrix, that is, a positive element of $\A$ of trace 1.   We can then define, for any state,
the von Neumann entropy $S(\rho)=-\Tr\rho\log\rho$.   In this article, the von Neumann algebras that we consider are factors, that is, algebras with trivial
center (in other words, algebras whose center consists only of $\C$).   A factor is the von Neumann algebra analog of a simple Lie group.   
In the case of a factor, any trace is nondegenerate
and therefore the condition to be able to define a von Neumann entropy is only that $\A$ has a trace.   Also, in the case of a factor, if a trace exists,
it is unique up to a multiplicative constant.   As we will see, in general it is important that the trace is not quite unique.

Let us discuss entropy for the different types of von Neumann algebra.   The original arena for von Neumann entropy
is a Type I algebra, which acts irreducibly on
a Hilbert space $\H$.    A standard argument shows that $S(\rho)$ is always nonnegative in this case.   A subtlety is that in the case of a Type I$_\infty$ algebra,
that is, if $\H$ is infinite-dimensional, it is possible to have $S(\rho)=+\infty$.   That is because the condition $\Tr\,\rho=1$ does not ensure the convergence
of $\Tr\,\rho\log\rho$.  Thus for Type I$_\infty$, the entropy takes values in $\R_{\geq 0}\cup+\infty$.   

Now let us consider algebras of Type II and Type III.   A Type III algebra has no trace and therefore no notion of von Neumann entropy.   However, a Type II algebra does have a trace, as explained in section \ref{lss}, and therefore one can define an entropy\footnote{This has been discussed, primarily for Type II$_1$, in
\cite{IESegal,ConnesStormer}.}  for a state of a von Neumann
algebra of Type II.

Let us explore this notion, initially for the case of Type II$_1$.   We recall that a Type II$_1$ algebra $\A$ has a trace
that is defined for all elements of $\A$, and is conventionally normalized so that $\Tr\,1=1$.   The simplest density matrix to consider is $\rho=1$.
In this case, $\log\rho=0$ so $S(\rho)=-\Tr\,\rho\log\rho=0$.   But what $\rho$ describes is far from being a zero entropy state in any conventional sense.   In fact, the density matrix
$\rho=1$ describes the maximally entangled thermofield double state $\Psi_\TFD$ that was defined in eqn.  \ref{zacko}.  Indeed, we defined the trace in a Type II$_1$
algebra by $\Tr\,\a=\la\Psi_\TFD|\a|\Psi_\TFD\ra$.   This implies that to satisfy $\Tr\,\a\rho = \la\Psi_\TFD|\a|\Psi_\TFD\ra$, we need to take $\rho=1$,
so $\rho=1$ is the density matrix that corresponds to the maximally entangled thermofield double state $\Psi_\TFD$.

The maximally entangled state of $N$ qubit pairs has von Neumann entropy $N\log 2$, and to get a Type II$_1$ algebra, one takes the limit $N\to\infty$.   
So the entropy diverges for $N\to\infty$. But 
with the Type II$_1$ definition of entropy, the large $N$ limit of the thermofield double 
state is deemed to have entropy 0.   This suggests that in general Type II$_1$ entropy
is ordinary von Neumann entropy with the entropy of a maximally entangled state subtracted. 
To confirm this interpretation, recall that a  
general state of a Type II$_1$ algebra can be associated  to a system of $N$ qubit pairs, in the large $N$ limit, in a state in which  
 almost all the qubit pairs are almost maximally entangled.   
 As an illustrative example, suppose that the first $k$ qubits are definitely in a ``spin up'' state, and the others are maximally mixed.
 To describe this state by a density matrix,
   let $\Pi$ be the orthogonal  projection operator onto the subspace
of  states of $N$ qubits in which the first $k$ qubits  all have spin up.   For finite $N$,  $\rho= 2^{-(N-k)}\Pi$ is a density matrix of the $N$ qubit system, and
its von Neumann  entropy is  $S_N=(N-k)\log 2$.   But in  the limit $N\to\infty$, $\Pi$ becomes an element    of the Type II$_1$ algebra with
$\Tr\,\Pi=2^{-k}$.   So in the Type II$_1$ algebra, we can define a density matrix $\rho=2^k\Pi$, with $\Tr\,\rho=1$.  For this density matrix, we compute $S=-\Tr\,\rho\log\rho=-k\log 2$.
This is the same as $S=\lim_{N\to\infty}(S_N-N\log 2)$.   In other words, $S$ is the large $N$ limit of $S_N-N\log 2$, or differently put, it is the large $N$ limit of
the entropy difference between the actual state of the first $N$ qubits and a maximally mixed state.
  As this example and discussion suggest, entropy is negative definite for a Type II$_1$ factor.

A Type III algebra can similarly be constructed, as described in section \ref{lss}, from an infinite collection of (non-maximally) entangled qubit pairs.   But in this
case, there is no way, using only the structure of the algebra, to define a renormalized entropy.   This is reflected in the fact that the divergences in the entanglement
entropy of a local region in quantum field theory are model-dependent (there is a leading divergence proportional to the area of the boundary of the
region, with a theory-dependent coefficient, and there are subleading divergences that depend on the spacetime dimension and the operator content of the theory).  
Renormalized entropies of local regions in quantum field theory can be useful and important, but defining them requires information beyond the von Neumann algebra
structure.  Similar remarks apply in quantum statistical mechanics if one considers the entropy of a state that is not thermal but looks thermal near spatial infinity.

Now let us consider an algebra $\A$ of Type II$_\infty$.   Such an algebra can be factored as\footnote{Because of the Type I$_\infty$ factor, entropy
in a Type II$_\infty$ factor can take the value $+\infty$.   Because of the Type II$_1$  factor (or because of the additive indeterminacy that we discuss shortly)
it can be negative.   In fact, it can take any value from $-\infty$ to $+\infty$.}  $\A=\A_1\otimes \A_2$, where $\A_1$ is of Type II$_1$
and $\A_2$ is the  type I$_\infty$ algebra of bounded operators on a separable Hilbert space $\K$.   We can define a trace $\Tr_1$ on $\A_1$ normalized so that $\Tr_1\,1=1$, and a trace $\Tr_2$ on $\A_2$ normalized so that,
if $\Pi\in \A_2$ is the orthogonal projection operator on a one-dimensional subspace $\K_0\subset \K$,
then $\Tr_2\,\Pi=1$.   Then we can define a trace on $\A$ by $\Tr=\Tr_1\otimes \Tr_2$.

Since a trace is available, there is a notion of entropy for such an algebra $\A$.    But there is a very important subtlety: there is no canonical way to
normalize this trace.   One immediate observation is that, since the identity element of $\A_2$  has a divergent trace, we cannot 
normalize the trace, as we did for Type II$_1$, by saying that the identity element
has trace 1.   A deeper explanation involves the fact that a Type II$_\infty$  algebra can be factored as the tensor product of algebras of Type II$_1$ and Type
I$_\infty$ in many different ways.


 Let
$\A_3$ be an algebra of Type I$_n$, acting on an $n$-dimensional Hilbert space $\H_n$, and define the trace $\Tr_3$ on $\A_3$ to be the usual trace of
a linear transformation acting on $\H_n$. Thus $\Tr_3\,1=n$.   Consider the algebra $\A=\A_1\otimes\A_2\otimes \A_3$, with $\A_1$ and $\A_2$ as before.
The algebra $\A_1'=\A_1\otimes \A_3$ is of Type II$_1$, and the algebra $\A_2'=\A_2\otimes \A_3$ is of Type I$_\infty$.   So $\A=\A_1'\otimes \A_2
=\A_1\otimes \A_2'$ gives two different factorizations of the same Type II$_\infty$ factor as the tensor product of factors of Type II$_1$ and Type I$_\infty$.
These two factorizations of $\A$ lead to definitions of the trace that differ by a factor of $n$.  To see this, consider the element $\a=1\otimes \Pi\otimes 1\in
\A_1\otimes \A_2\otimes \A_3$, where as before $\Pi$ is an element of $\A_2$ that projects on a one-dimensional subspace $\K_0\subset \K$.  With respect to the factorization of $\A$ as $\A_1'\otimes \A_2$, $\a$ is the tensor product of $1\in \A_1'$ with $\Pi\in \A_2$,
so the normalization of the trace that is natural for this factorization gives $\Tr\,\a=\Tr\,1\otimes \Pi=1$.
On the other hand, with respect to the factorization of  $\A$ as $\A_1\otimes \A_2'$, $\a$ is $1\otimes \Pi'$, where $\Pi'$ projects on the $n$-dimensional subspace
$\K_0\otimes \H_n\subset \K\otimes \H_n$.    So with the normalization of the trace that is natural for this second factorization, we would have $\Tr\,\a=n$.

Thus different choices of factorization motivate different normalizations of the trace for a Type II$_\infty$ factor.
In fact, there can be no natural normalization of the trace, because 
 a Type II$_\infty$ algebra has an outer automorphism group that rescales the trace by any positive
real number.
(This is a standard result in von Neumann algebra theory and will be explained elsewhere \cite{WittenNew}.) 
However, as long as we assume our algebra to be a factor, analogous to a simple Lie group, the only indeterminacy in the trace is an overall
multiplicative constant.

Let us see how this indeterminacy affects the definition of entropy.   If we rescale the trace by $\Tr\to\lambda\Tr$, we must compensate by rescaling the density
matrix by $\rho\to\lambda^{-1}\rho$, to preserve $\Tr\,\rho=1$.   Under the combined rescaling of $\Tr$ and $\rho$, we have
\be\label{wonko}S(\rho)=-\Tr\,\rho\log\rho\to S(\rho)+\log \lambda.\ee
In other words, when we rescale the trace by a factor $\lambda$, the entropy of any state is shifted by an additive constant $\log\lambda$, independent of the state.

This means that entropy in a Type II$_\infty$ factor is somewhat analogous to entropy in classical mechanics.   The concept of entropy was originally discovered
in the 19th century by macroscopic arguments, which showed that there must be a state function $S$ of a system in thermal equilibrium that obeys the first
law of thermodynamics.  If the relevant thermodynamic variables are the energy $E$, temperature $T$, pressure $p$, and volume $V$, then the first
law reads
\be\label{tofu}\d E=T\d S-p\d V.\ee
This equation determines $S$ up to an additive constant.   Quantum mechanically, one can fix the additive constant by saying that (assuming the system
under study has a unique ground state) the entropy vanishes at $T=0$.  Classically, no such statement is possible, because for example the entropy of a classical
harmonic oscillator goes to $-\infty$ for $T\to 0$.   

For another explanation of why it is 
difficult in classical physics to fix an overall additive constant in the entropy, consider a system of particles with positions $\vec x$ and momenta $\vec p$.
One can describe one's state of knowledge about the system with a probability distribution function $\rho(\vec p, \vec x)$.   Then a 
classical definition of entropy is
\be\label{defent} S=-\int\d\vec p\,\d \vec x \rho(\vec p,\vec x)\log \rho(\vec p,\vec x). \ee
The integral runs over the classical phase space of the system.   But classically, there is no natural way to normalize the phase space measure, since, for any
pair of canonical variables $p,x$, the measure $\d p\,\d x$ has dimensions of action, and classically there is no natural constant with dimensions of action that could
be used to normalize it.
(Quantum mechanically, one replaces $\d p\,\d x$ by $\d p\,\d x/2\pi\hbar$.)    The phase space measure in classical mechanics is naturally defined up to an overall
multiplicative constant, but there is no natural way to fix this constant.   If we rescale the measure by $\d \vec p\,\d\vec x\to \lambda\d\vec p\,\d\vec x$, for a positive
constant $\lambda$, then we have to compensate by $\rho\to\lambda^{-1}\rho$.  But this then shifts $S$ by $S\to S+\log\lambda$, just as in the discussion of
a Type II$_\infty$ algebra.   

Here is an interesting example of entropy for a state of a Type II$_\infty$ algebra $\A$. Pick a factorization $\A=\A_1\otimes \A_2$ where $\A_1$ is of Type II$_1$ and $\A_2$ is of
Type I$_\infty$.   Let $\Pi_k,$ $k=1,\cdots, n$, be orthogonal projection operators in $\A_1$ satisfying $\Pi_i \Pi_j=\delta_{ij}\Pi_j$, $\Tr\,\Pi_i=p_i$,
$\sum_{k=1}^n \Pi_k=1$.   Let $\rho_k$, $k=1,\cdots, n$  be any density matrices in $\A_2$.   Then $\rho=\sum_{k=1}^n \Pi_k \otimes \rho_k$  is a density
matrix in $\A$.   Its entropy is
\be\label{entis}S(\rho)=\sum_k p_k S(\rho_k) =-\sum_k p_k \Tr\, \rho_k\log \rho_k. \ee
In verifying this, one uses the fact that $\Pi_k\log \Pi_k=0$ for all $k$, since the only eigenvalues of $\Pi_k$ are 0 and 1, and $x\log x=0$ if $x=0$ or 1.
It is noteworthy that in the formula for $S(\rho)$ there is no Shannon term $-\sum_k p_k\log p_k$.   Thus in this particular example, Type II$_\infty$ entropy
is the average entropy of an ensemble of density matrices.

We have phrased this discussion in terms of the von Neumann entropy, but similar remarks apply for other information theoretic
measures such as the Renyi entropies $S_\alpha(\rho)=\frac{1}{1-\alpha}\log \Tr\,\rho^\alpha$.  These entropies can be defined for a state on an algebra of
Type I or Type II (but not, of course, Type III).   In the Type II$_\infty$ case, if we rescale the trace by a factor $\lambda$ and compensate by rescaling the
density matrix $\rho\to\lambda^{-1}\rho$, the Renyi entropies are shifted by
\be\label{todlo} S_\alpha(\rho)\to S_\alpha(\rho)+\frac{\alpha}{\alpha-1} \log\lambda.\ee
Thus all the Renyi entropies are well-defined in Type II$_\infty$, up to a shift that is controlled in 
this way by the same $\alpha$-independent parameter $\lambda$ that controls the indeterminacy in the von Neumann entropy.

 
 \section{The Large $N$ Limit and the Thermofield Double}\label{large}
 
QCD in Minkowski space is confining at low temperatures and has a deconfinement transition at a certain positive temperature \cite{CabPar,Poly,Suss}.
In finite volume, this transition is smoothed out.   But if we replace QCD, which has gauge group $SU(3)$, with a theory with gauge group $SU(N)$
(or $SO(N)$ or $Sp(N)$), then it is believed  that  in the large $N$ limit, there is a sharp deconfinement transition even in finite volume.   This is true
even for zero \cite{Other,HPe,Poly2,Aha} or small \cite{AhaTwo} coupling.  In the case of a gauge theory that has a gravitational dual, this  phenomenon is relevant to the AdS/CFT correspondence.   In that application, if the bulk
spacetime has $D$ noncompact dimensions, so that the conformal boundary has dimension $D-1$, the spatial manifold on which the gauge theory lives is most simply taken to be a sphere
$\S^{D-2}$.   Then the deconfinement transition is dual to the Hawking-Page transition \cite{HP} between a thermal gas in Anti de Sitter
space and a black hole \cite{Wit}.   We call the temperature at which this transition occurs $T_\HP$.

Let $\H_N$ be the Hilbert space of  a large $N$ gauge theory, quantized on the compact manifold 
$\S^{D-2}$. It is believed that  $\H_N$ has a large $N$ limit $\H_\infty$: the energy eigenvalues and multiplicities  and the matrix elements of operators
all have limits for $N\to\infty$ (and in particular the multiplicities do not grow with $N$).
At sufficiently low temperatures, the thermal ensemble can be understood in the limiting Hilbert space $\H_\infty$.   Because the energy eigenvalues
and multiplicities have limits for $N\to\infty$, the thermodynamic functions such as entropy, energy, etc., all have large $N$ limits at sufficiently
low temperatures.    Thus in the low temperature phase, the energy and entropy are of order $N^0$ for large $N$.
In the range of temperatures at which the thermodynamics can be described in $\H_\infty$, 
the natural algebra of observables at large $N$ is simply the Type I$_\infty$ algebra of all operators on $\H_\infty$.

It is believed that in large $N$ gauge theories,
 the partition function $\Tr_{\H_\infty}\,e^{-\beta H}$, computed in the limiting large $N$ Hilbert space $\H_\infty$, diverges at a temperature
$T_H$, known as the Hagedorn temperature.
This can be seen quite explicitly at zero coupling.  At or below $T_H$, the description based on the Hilbert space
$\H_\infty$ has to break down.   We will loosely call the transition  at which this happens the Hagedorn
transition.   In various weakly coupled gauge theories, it is believed that the transition occurs at a temperature slightly below $T_H$ \cite{AhaTwo}.   
In gauge theories -- such as $\N=4$ super Yang-Mills theory in four dimensions -- that participate in AdS/CFT duality, the transition away from a description in 
the Hilbert space $\H_\infty$ occurs
at the Hawking-Page temperature $T_\HP$, which is far below $T_H$ (assuming that $g^2N$ is large and the AdS theory can be studied semiclassically).  In fact,
   $T_H$ is at the string scale, while $T_\HP$ is of
order the inverse radius of the AdS space.   
Thus in the AdS/CFT context, what we are calling the Hagedorn transition is the same as the Hawking-Page
transition and occurs at a temperature far below $T_H$.   Regardless, above this transition the physics can no longer be described in $\H_\infty$.


Above the transition temperature,
the energy and entropy are both proportional to $N^2$ for large $N$ \cite{Thorn} and in particular do not have large $N$ limits.
To reach the high temperature phase in the large $N$ limit, we have to take $N\to\infty$ with the energy  $E$ proportional to $N^2$
(as opposed to taking $N\to\infty$ with fixed $E$, which will always lead to a description in the Hilbert space $\H_\infty$, regardless of $E$).    In brief,
we will refer to the large $N$ limit in that regime as the large $N$ limit above the Hagedorn transition.
It seems very unlikely that there is a limiting large $N$ Hilbert space that describes the large $N$ limit above the Hagedorn transition.   
Certainly the literature does not contain any proposal for what such a large $N$ Hilbert space would be.
Since the entropy above the Hagedorn transition is of order $N^2$, when 
 one increases the rank of the gauge group from $N$ to $N+1$, the entropy increases by a multiple of $N$, and the Hilbert space becomes much bigger.   
 So most ``above the Hagedorn transition'' microstates with gauge group $SU(N+1)$ are ``new'' and have no antecedents in the $SU(N)$ theory.

The non-existence of a large $N$ limit of the Hilbert space above the Hagedorn transition would  be analogous to the non-existence, in quantum statistical
mechanics at temperature $T>0$, of a Hilbert space that describes the infinite volume limit.  In this analogy, $N^2$ plays
 the role of the volume $V$.  
There is also an analogy with the non-existence of
a natural Hilbert space description of quantum field theory in an open universe.   

The analogy with statistical mechanics also suggests a partial cure, which is to go to the thermofield double.   This is particularly powerful in gauge theories
that participate in AdS/CFT duality.   In such a case, the large $N$ limit of the thermofield double, in the high temperature phase, 
is a two-sided eternal black hole \cite{Malda}.   By quantizing the low energy bulk fields in the  black hole spacetime, one constructs
a Hilbert space $\H_\TFD$. This Hilbert space describes the large $N$ limit of the thermofield double of the gauge theory, in the high temperature phase.

A natural algebra of observables in the large $N$ limit is the algebra of polynomial functions of single trace operators. Based on the analogy with quantum
statistical mechanics and the discussion in section \ref{ht}, we can make a guess about the nature of this large $N$ algebra.   As already noted, below the Hagedorn
transition, the physics can be described in the original large $N$ Hilbert space $\H_\infty$, and the natural algebra acting on this Hilbert space is
of Type I.   In the high termperature phase, the analogy with statistical mechanics suggests that the natural algebra of single trace operators would be of
Type III.   Indeed, this has been argued recently by Leutheusser and Liu \cite{LL}, who made this claim partly based on the AdS/CFT duality, in  a paper with several novel ideas about quantum black holes.    These issues and some subtle corrections to the large $N$ limit
will be further discussed elsewhere \cite{WittenNew}.

Finally let us consider the Hamiltonians $H_r$ and $H_\ell$ that act on the two copies in the thermofield double.   
What happens in the large $N$ limit above the Hagedorn transition is similar
to what happens in the more familiar infinite volume limit.     The difference $\h H=H_r-H_\ell$ annihilates the thermofield double state $\Psi_\TFD$ and
converges, in the large $N$ limit, to an operator that acts on the thermofield double Hilbert space $\H_\TFD$.   However, because of fluctuations, $H_r$ and $H_\ell$ do
not separately have  large $N$ limits at $\beta<1/T_\HP$.      For example,  $H_r$ has an expectation value $\la H_r\ra_\beta\sim N^2$ and so does not have
a large $N$ limit.
We can of course subtract this expectation value, but the subtracted operator $H_r-\la H_r\ra_\beta$ has divergent thermal fluctuations $\left\la \left(H_r-\la H_r\ra_\beta\right)^2\right\ra_\beta\sim N^2$ and therefore also does not converge for large $N$ to an operator on $\H_\TFD$.   $\h H$ generates
a group of outer automorphisms of the large $N$ operator algebras of the left and right systems.    This is a group of outer automorphisms because
$H_\ell$ and $H_r$ do not separately have large $N$ limits.










\noindent{{\it Acknowledgments}}
I thank H. Liu, R. Longo, R. Mahajan, J. Maldacena, N. Seiberg, J. Turiaci,  and R. Wald for helpful and informative discussions.  Research supported in part by
 NSF Grant PHY-1911298.

% L. Takhtajan
\bibliographystyle{unsrt}
\begin{thebibliography}{99}  


\bibitem{DeWitt}
B. S. DeWitt, ``Quantum Field Theory In Curved Spacetime,'' 
Phys. Reports {\bf 19} (1975) 295-357.

\bibitem{FSW}
S. A. Fulling, M. Sweeny, and R. M. Wald, ``Singularity
Structure of the Two-Point Function in Quantum Field Theory
in Curved Spacetime,'' Commun. Math. Phys. {\bf 63} (1978) 257-64.

\bibitem{FNW}
S. A. Fulling, F. J. Narcowich, and R. M. Wald, 
``Singularity Structure of the Two-Point Function in Quantum Field
Theory in Curved Spacetime, II,''    Ann. Phys. {\bf 136} (1981) 243-72.

\bibitem{BD}
N. D. Birrell and P. C. W. Davies, {\it Quantum Fields In Curved Space}
(Cambridge University Press, 1982).

\bibitem{Fulling}
S. A. Fulling, {\it Aspects of Quantum Field Theory In Curved Spacetime} (Cambridge University Press, 1989).

\bibitem{Kay}
B. S. Kay, ``The Principle Of Locality and Quantum Field Theory on (Non Globally Hyperbolic) Curved Spacetimes,''
Rev. Math. Phys. {\bf 4} (1992) 167-95.

\bibitem{BOS}
I. L. Buchbinder, S. D. Odintsov, and I. L. Shapiro, {\it Effective Action in Quantum Gravity} (Taylor\&Francis, 1992).

\bibitem{WaldBook}
R. M. Wald, {\it Quantum Field Theory In Curved Spacetime and Black Hole Thermodynamics}  (University of Chicago, 1994).

\bibitem{BFV}
R. Brunetti, K. Fredenhagen, and R. Verch,
``The Generally Covariant Locality Principle - A New Paradigm for Local Quantum Field Theory,''
arXiv:math-ph/0112041.

\bibitem{F}
K. Fredenhagen, ``Locally Covariant Quantum Field Theory,'' arXiv:hep-th/0403007.

\bibitem{HW}
S. Hollands and R. M. Wald, ``Axiomatic Quantum Field Theory In Curved Spacetime,'' arXiv:0803.2003.

\bibitem{BF}
C. Bar and K. Fredenhagen, eds., {\it Quantum Field Theory On Curved Spacetimes} (Springer, 2009).

\bibitem{PT}
L. Parker and D. Toms, {\it Quantum Field Theory In Curved Spacetime} (Cambridge University
Press, 2009).

\bibitem{Fewster}
C. J. Fewster, ``Locally Covariant Quantum Field Theory and the Problem of Formulating the Same Physics in All Spacetimes,''
Phil. Trans. R. Soc. {\bf A373} (2015)  20140238, arXiv:1502.04642.

\bibitem{ArakiQFT}
H. Araki, ``Type of von Neumann Algebra Associated with Free Field,''
Prog. Theor. Phys. {\bf 5} (1964) 1-13.

\bibitem{Fred}
K. Fredenhagen, ``On The Modular Structure Of Local Algebras Of Observables,''  Commun. Math. Phys. {\bf 97} (1985) 79.


\bibitem{HaagBook}
R. Haag, {\it Local Quantum Physics} (Springer-Verlag, 1992).

\bibitem{Yng}
J. Yngvason, ``The Role of Type III Factors in Quantum Field Theory,'' arXiv:math-ph/0411058.



\bibitem{WittenNotes} 
E. Witten, ``Some Entanglement Properties of Quantum Field Theory,'' Rev. Mod. Phys. {\bf 90} (2018) 045003, arXiv:1803.04993.


\bibitem{HHW}R. Haag, N. M. Hugenholtz, and M. Winnink, ``On The Equilibrium States in
Quantum Statistical Mechanics,'' Commun. Math. Phys. {\bf 5} (1967) 215-236.

\bibitem{Lecture}
E. Witten, ``Quantum Field Theory In Curved Spacetime,'' lecture available at \url{https://www.youtube.com/watch?v=8Wu4QhlznnY&t}.

\bibitem{LL}
S. Leutheusser and H. Liu, ``Causal Connectability Between Quantum Systems
and The Black Hole Interior in Holographic Duality,'' arXiv:2110.05497.

\bibitem{WittenNew}
E. Witten, ``Gravity and the Crossed Product,''  to appear.

\bibitem{KS}
M. Kontsevich and G. B. Segal, ``Wick Rotation and the Positivity of Energy in Quantum
Field Theory,'' Quart. J. Math. {\bf 72}  (2021) 673-99, arXiv:2105.10161.

\bibitem{vNe}
J. von Neumann, ``Die Eindeutigkeit der Schr\"{o}dingerschen Operatoren,'' Math. Ann. {\bf 104} (1931) 570-8.

\bibitem{GW}
L. G\r{a}rding and A. Wightman, ``Representations of the Commutation Relations,'' Proc. NAS {\bf 40} (1954) 622-6.

\bibitem{Sewell2}
G. L. Sewell, {\it Quantum Mechanics and its Emergent Macrophysics} (Princeton University Press, 2002).

\bibitem{Bost}
H. Bostelmann, ``Operator Product Expansions As A Consequence Of Phase Space Properties,''
arXiv:math-ph/0502004.

\bibitem{Ashtekar}
A. Ashtekar, {\it Asymptotic Quantization} (Bibliopolis, 1987).

\bibitem{Strominger}
A. Strominger, {\it Lectures On The Infrared Structure Of Gravity and Gauge Theory} (Princeton University Press, 2018).

\bibitem{SWa}K. Prabhu, 
G. Satishchandran and R. Wald, to appear.

\bibitem{Fre} R. Brunetti and K. Fredenhagen, ``Microlocal Analysis and Interacting Quantum Field Theories: Renormalization on Physical Backgrounds,''
Commun. Math. Phys. {\bf 208} (2000) 623.

\bibitem{Wal} S. Hollands and R. M. Wald, ``Existence of Local Covariant Time Ordered
Products of Quantum Fields in Curved Spacetime,'' gr-qc/0111108.


\bibitem{VN}J. von Neumann, ``On Infinite Direct Products,'' Comp. Math. {\bf 6} (1938) 1-77.

\bibitem{Powers}R. T. Powers, ``Representations of Uniformly Hyperfinite Algebras and Their Associated von Neumann Rings,'' Ann. of Math. {\bf 86} (1967) 138-171.

\bibitem{ArakiWoods}H. Araki and E. J. Woods, ``A Classification of Factors,'' Publ. RIMS Kyoto Univ. Ser. A
{\bf 3} (1968) 51-130.

\bibitem{MvN}F. J. Murray and J. von Neumann, ``On Rings Of Operators,'' Ann. Math. {\bf 37} (1936) 116-229.

\bibitem{Unruh}W. G. Unruh, ``Notes On Black Hole Evaporation,'' Phys. Rev. {\bf D14} (1976) 870-892.

\bibitem{BW}
J. Bisognano and E. H. Wichmann, ``On The Duality Condition For Quantum Fields,'' J. Math.
Phys. 17 (1976) 303-21.



\bibitem{Sewell}
G. L.  Sewell, ``Quantum Fields On Manifolds: PCT and Gravitationally Induced Thermal States,'' Ann. Phys. {\bf 141} (1982) 201-24.

\bibitem{HLW}
C. Holzhey, F. Larsen, and F. Wilczek, ``Geometric
and Renormalized Entropy In Conformal Field Theory,''
Nucl. Phys. {\bf B300} (1994) 44. 

\bibitem{CC}
P. Calabrese and J. Cardy, ``Entanglement Entropy and Quantum
Field Theory,'' J. Stat. Mech. P06002 (2004) arXiv:hep-th/0405152.

\bibitem{Cas}
H. Casini and M. Huerta, ``Entanglement Entropy For The $n$-Sphere,''
Phys. Lett. {\bf B694} (2011) 167-71, arXiv:1007.1813.

\bibitem{Cas2}
H. Casini, M. Huerta,
and R. C. Myers, ``Towards A Derivation Of Holographic Entanglement Entropy,''
JHEP {\bf 05} (2011) 036, arXiv:1102.0440.

\bibitem{IESegal}
I. E. Segal, ``A Note On The Concept of Entropy,'' J. Math. Mech. {\bf 9} (1960) 623-29.

\bibitem{ConnesStormer}
A. Connes and E. St\o{}rmer, ``Entropy For Automorphisms Of II$_1$ Von Neumann Algebras,'' Acta. Math. {\bf 134} (1975) 289-306.


\bibitem{CabPar}N. Cabibbo and G. Parisi, ``Exponential Hadronic
Spectrum And Quark Liberation,'' Phys. Lett. {\bf B59} (1975) 67-9.

\bibitem{Poly}A. M. Polyakov, ``Thermal Properties Of Gauge Fields And Quark Liberation,'' Phys. Lett. {\bf B72} (1978) 477-480.

\bibitem{Suss}L. Susskind,
``Lattice Models of Quark Confinement At High Temperature,''
Phys. Rev. {\bf D20} (1979) 2610-18.



\bibitem{Other}
B. Sundborg, ``The Hagedorn Transition, Deconfinement, and $\N=4$ SYM Theory,'' Nucl. Phys. {\bf B573} (2000) 349, arXiv:hep-th/9908001.

\bibitem{HPe}J. Hallin and D. Persson,
``Thermal Phase Transition In
Weakly interacting, Large $N_c$ QCD,'' Phys. Lett. {\bf B429} (1998) 232,
arXiv:hep-th/9803224.

\bibitem{Poly2} A. M. Polyakov, ``Gauge Fields and Space-Time,''
Int. J. Mod. Phys. {\bf A17S1} (2002) 119.

\bibitem{Aha}O. Aharony, J. Marsano, S. Minwalla, K. Papadodimas, and M. Van Raamsdonk, ``The Hagedorn/Deconfinement Phase Transition in
Weakly Coupled Large $N$ Gauge Theories,'' Phys. Rev. {\bf D74} (2006) 105012,  arXiv:hep-th/0310285.

\bibitem{AhaTwo}O. Aharony, J. Marsano, S. Minwalla, K. Papadodimas, and M. Van Raamsdonk, ``A First Order Deconfinement Transition In Yang-Mills
Theory on a Small $S^3$,''   Phys. Rev. {\bf D71} (2005) 125018,   arXiv:hep-th/0502149.



\bibitem{HP}
S. W. Hawking and D. N. Page, ``Thermodynamics of Black Holes in Anti de Sitter Space,''
Commun, Math. Phys. {\bf 87} (1983) 577-88.

\bibitem{Wit}
E. Witten, ``Anti de Sitter Space and Holography,'' Adv. Theor. Math. Phys.{\bf 2} (1998) 253-291,  arXiv:hep-th/9802150.








\bibitem{Thorn}C. Thorn, ``Infinite $N_c$ QCD At Finite Temperature: Is There An Ultimate Temperature?''
Phys.Lett.{\bf B99} (1981) 458.


\bibitem{Malda}J. M. Maldacena, ``Eternal Black Holes in Anti de Sitter,'' JHEP {\bf 04} (2003) 021,  arXiv:hep-th/0106112.



\end{thebibliography}
\end{document}
========================================

\documentclass[11pt,a4paper]{article}
\usepackage{jheppub,amsmath,  amssymb,slashed,url,bm,textgreek,upgreek}
\usepackage{graphicx}
\usepackage{epstopdf}
\def\t{{ \sf t}} 
%% \stackrel{j}{\to}
\def\kk{k}
\def\Sigmax{{\Sigma^*}}
\def\eO{{\eusm O}}
\def\phif{f}
\def\tt{{\mathfrak t}}
\def\J{\mathcal J}
\def\neg{\negthinspace}
\def\a{a}
\def\dzzt{\D(\t z,z|\theta)}
\def\dzztt{\D(\t z,z|\t\theta,\theta)}
\def\ggamma{\Gamma}
\def\Stt{\h S}
\def\Q{{\mathcal Q}}
\def\Res{{\mathrm {R}}}
\def\X{{\mathcal X}}
\def\SoS{{\mathrm S}}
\def\ds{{\mathrm{ds}}}
\def\sD{\text{{\sf D}}}
\def\aalpha{\alpha}
\def\FF{{\eusm  F}}
\def\sPi{\Phi}
\def\ct{{\cmmib t}}
\def\JJ{{\eusm J}}
\def\s{{s}}
\def\ii{i}

\def\BB{\bm B}
\def\uu{u}
\def\piGSO{{\Pi_{\mathrm{GSO}}}}
\def\tpiGSO{\t{\Pi}_{\mathrm{GSO}}}
\def\UUU{\varPhi}
\def\SSigma{{\varTheta}}
\def\Stigma{{\varSigma}}
\def\btheta{{\bm \theta}}
\def\mm{{\bm m}}
\def\zzeta{{\bm \zeta}}
\def\zizeta{\zeta}
\def\v{{\eurm v}}
\def\fD{ \eusm D}
\def\udelta{{\underline\delta}}
\def\u{{\eurm u}}
\def\UU{U}
\def\p{{\eurm p}}
\def\sp{{\eurm p}}
\def\SoS{{\eurm S}}
\def\VV{{\eusm V}}
\def\ZoZ{{\eusm Z}}
\def\z{{\mathbf z}}
\def\c{{\eurm c}}
\def\w{{\eurm w}}
\def\Chi{\chi}
\def\g{\text{{\teneurm g}}}
\def\sg{\text{{\eighteurm g}}}
\def\ssg{\text{{\seveneurm g}}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bt{{{t}}}
\def\XX{{\mathcal Y}}
\def\NS{{\mathrm {NS}}}
\def\Ra{{\mathrm R}}
\def\Ber{{\mathrm{Ber}}}
\def\BBer{{\textit{Ber}}}
\def\X{{\eusm X}}
\def\Re{{\mathrm{Re}}}
\def\Im{{\mathrm{Im}}}
\def\hat{\widehat}
\def\eff{{\mathrm{eff}}}
\def\tilde{\widetilde}
\def\fN{{\mathfrak N}}
\def\frak{\mathfrak}
\def\h{\widehat}
\def\n{\text{{\teneurm n}}}
\def\sn{\text{{\eighteurm n}}}
\def\ssn{\text{{\seveneurm n}}}
%\def\n{{\eurm n}}
\def\sPhi{\Psi}
\def\RP{{\Bbb{RP}}}
\def\q{{\mathrm q}}
\def\y{{\mathrm y}}
\def\dd{{\eurm q}}
\def\D{{\mathcal D}}
\def\S{{\mathcal S}}
\def\SIgma{\Sigma}
\def\YY{{\eusm Y}}
\def\V{{\mathcal V}}
\def\sV{{\sf V}}
\def\O{{\mathcal O}}
\def\k{{\cmmib k}}
\def\Bbb{\mathbb}
\def\gh{{\mathrm{gh}}}
\def\red{{\mathrm{red}}}
\def\A{{\mathcal A}}
\def\d{{\mathrm d}}
\def\tW{{W}}
\def\intt{{\matheurm{int}}}
\def\b{\overline}
\def\R{{\mathbb R}}
\def\C{{\mathbb C}}
\def\U{{\mathcal U}}
\def\D{{\mathcal D}}
\def\[{\bigl [}
\def\voli{{\eurm {vol}}^{-1}\cdot}
\def\]{\bigr ]}
\def\SS{{\mathfrak S}}
\def\CP{{\mathbb{CP}}}
\def\N{{\mathcal N}}
\def\T{{\mathcal T}}
\def\F{{\mathcal F}}
\def\tr{{\mathrm {tr}}}
\def\Z{{\mathbb Z}}
\def\ZZ{{\mathcal Z}}
\def\QQ{{\mathcal Q}}
\def\CC{{\mathcal C}}
\def\ad{{\mathrm{ad}}}
\def\r{{\mathrm{tr}}}
\def\Btriv{{\mathcal B}_{\mathrm{triv}}}
\def\L{{\mathcal  L}}
\def\t{\widetilde }
\def\h{\widehat}
\def\Bcc{{\mathcal B_{\mathrm{cc}}}}
\def\K{{\mathcal K}}
\def\V{{\mathcal V}}
\def\I{{\mathcal I}}
\def\G{{\mathcal G}}
\def\B{{\mathcal B}}
\def\Boper{{\mathcal B_{\mathrm{oper}}}}
\def\M{{\mathcal M}}
\def\sM{s\mathcal M}
\def\MM{{\mathfrak M}}
\def\eusmm{{\MM_{\sg,\sn_\NS,\sn_\Ra}}}
\def\W{{\mathcal W}}
\def\P{{\mathcal P}}
\def\l{\langle}
\def\Ra{{\mathrm{R}}}
\def\r{\rangle}
\def\lc{{\mathrm{lc}}}
\def\H{{\mathcal H}}
\def\cZ{\mathcal Z}
\def\tphi{\text{\textphi}}
\def\trho{\text{\textmu}}
\def\sW{{ W}}
\def\vol{{\mathrm{vol}}}
\def\ca{{\cmmib a}}
\def\ss{{d}}
\def\st{{\mathrm{st}}}
\def\spin{{\mathrm{spin}}}
\def\m{\cmmib m}
\def\tilde{\widetilde}
\def\sing{{\mathrm{sing}}}
\def\bar{\overline}
\def\DD{{\mathfrak D}}
\def\neg{\negthinspace}
\def\gst{g_{\mathrm{st}}}
\def\Ber{{\mathrm {Ber}}}
\def\Diff{{\eusm D}}
\def\Y{{\eusm Y}}

\def\dets{\det{}\negthinspace}
\font\teneurm=eurm10 \font\seveneurm=eurm7 \font\eighteurm=eurm8 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
\font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}
\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}
\def\la{\langle}
\def\ra{\rangle}
\def\d{{\mathrm d}}
\def\gen{{\rm gen}}
\def\out{{\rm out}}
\def\bh{{\rm bh}}
\def\th{{\rm th}}
\def\vN{{\rm vN}}
\def\Tr{{\rm Tr}}
\def\i{{\rm i}}
\def\ret{{\rm ret}}
\def\eff{{\rm eff}}
\def\max{{\rm max}}
\def\BH{{\rm BH}}
\def\EH{{\rm EH}}
\def\GHY{{\rm GHY}}
\def\sc{{\rm scr}}
\def\adv{{\rm adv}}
\def\TFD{{\rm TFD}}
\def\a{{\sf a}}
\def\te{\tE}
\def\c{{\sf c}}
\def\E{{\mathcal E}}
\def\RR{\mathcal R}
\def\rad{{\rm rad}}
\def\sstar{{\rm star}}
\def\Page{{\rm Page}}
\def\A{{\sf A}}
\def\B{{\sf B}}
\def\AdS{{\rm AdS}}
\def\tE{t_{\sf E}}
\def\dS{{\rm dS}}
\def\sW{{\mathcal W}}
\def\sE{{\sf E}}
\def\HHI{{\rm HHI}}
\def\sH{{\rm H}}
\def\C{{\sf C}}
\def\D{{\sf D}}
\def\CC{{\sf C}}
\def\CFT{{\sf{CFT}}}
\def\ct{{\rm ct}}
\def\cl{{\rm{cl}}}
\def\ES{{\rm {ES}}}

\title{Introduction to Black Hole Thermodynamics}



 \author{Edward Witten}
\affiliation{School of Natural Sciences, Institute for Advanced Study,\\ 1 Einstein Drive, Princeton, NJ 08540 USA}
%\emailAdd{author@inst.edu}
\abstract{These notes aim to provide an introduction to the basics of black hole thermodynamics.  After explaining Bekenstein's original proposal that black holes have
entropy, we discuss Hawking's discovery of black hole radiation, its analog for Rindler space in the Unruh effect, the Euclidean approach to black hole thermodynamics,
some basics about von Neumann entropy and its applications, the Ryu-Takayanagi formula, and the nature of a white hole.  
}

\begin{document}\maketitle

\section{Introduction}\label{intro} 

The one thing that almost everyone knows about black holes is that crossing the horizon of a black hole is a one-way trip.
What goes in does not come back out, at least according to classical general relativity.  In other words, entering a black hole
is {\it irreversible}.  

This irreversibility is in obvious tension with  basic physical principles.   For example, if quantum evolution is governed
by a hermitian Hamiltonian $H$, and there is a nonzero matrix element $\la \chi|H|\psi\ra$ for a transition from a state $\psi$ to a state $\chi$,
then there must be a complex conjugate matrix element $\la\psi|H|\chi\ra$ for a transition in the opposite direction.   
 
On the other hand, irreversibility is familiar in everyday life, as explained in a familiar English nursery rhyme. Humpty Dumpty is depicted as an egg sitting up on a wall.\footnote{According to Wikipedia,
the original context for the rhyme is unclear.}    Once the egg falls and breaks, ``all the king's horses
and all the king's men couldn't put Humpty together again.''

Classical physicists saw some tension between such irreversibility and a presumed invariance of the laws of nature under time-reversal.
The tension was largely resolved with the development of thermodynamics and statistical mechanics. 
Irreversible processes are  those in which the entropy increases.
Processes in which the entropy becomes smaller -- for example, a broken egg on the floor spontaneously reassembles and jumps up on the wall -- can happen in
principle but require extreme fine-tuning of initial conditions, so they are exponentially unlikely.   

The basic idea of black hole thermodynamics is that the irreversibility that occurs when an object is absorbed by a black hole is similar to the statistical irreversibility that is familiar in ordinary
physics. 
When a body falls into a black hole, entropy increases.   
A time-reversed scenario in which the black hole spontaneously emits that same body is possible, but requires fine-tuned initial conditions and is prohibitively unlikely, just like a process
in which a broken egg is spontaneously reconstituted.

Since the original work of Bekenstein \cite{bekenstein} and Hawking \cite{hawking} just over half a century ago, as well as the related classical observations
of Christodoulou \cite{Christodoulou} and Bardeen, Carter, and Hawking \cite{BCH}, black hole thermodynamics has raised many challenging questions about
the fundamental nature of quantum mechanics and gravity.   The goal of the present article is to provide a gentle introduction to this fascinating subject.   Hopefully, we will explain
enough to provide an entr\'{e}e to the subject, but many important aspects, both old and new, are omitted.   The literature is much too extensive
to be properly summarized here. Some of the early results not explained here can be found in \cite{wald}, chapters 12 and 14, and in the articles by
Carter, Gibbons, and Hawking in \cite{HI}; and see for example \cite{malda,malda2} for  short introductions to some of the more
contemporary developments.   Some of the background in classical general relativity that helps in understanding the subject more deeply is explained in \cite{wald}, chapters 8 and 9,
 and also in \cite{Witten}, for example. 

 In section 2 of this article, Bekenstein's heuristic proposal concerning black hole entropy is described.  Hawking's celebrated discovery of quantum emission from black holes
is the subject of sections 3 and 4. Section 5 is devoted to Rindler space and the Unruh effect, which provide a simplified framework for understanding some essential aspects of quantum black holes.   The Euclidean approach to black hole thermodynamics is introduced in section 6.    Microscopic von Neumann entropy, as opposed to macroscopic thermodynamic
entropy, is introduced in section 7 and discussed in the context of black holes in general terms in section 8 and more specifically in the framework of the Ryu-Takayanagi formula
in section 9.   Finally, section 10 addresses the question, ``What is a white hole?''


\section{Black Hole Entropy And The Generalized Second Law}\label{gsl}

The Second Law of Thermodynamics says that, in any process that we can observe in practice, the entropy is nondecreasing.   Here, entropy is the usual thermodynamic
entropy.   (In section \ref{twonotions},  we will discuss a related but different notion, the microscopic von Neumann entropy.)   Processes in which the thermodynamic entropy decreases are allowed
by the laws of nature, but are prohibitively unlikely, in practice.

However,  Bekenstein, motivated by a question from his advisor John Wheeler, observed that if we toss a cup of tea into a black hole, the entropy seems to diminish,
 assuming that we assign zero entropy to the black hole.   To avoid concluding that this process violates the Second Law, 
 Bekenstein wanted to assign an entropy to a black hole in such a way that the Second
Law would remain valid when matter falls into the black hole.   For this, he needed to attribute to the black hole an entropy that always increases according to classical general relativity. 

What property of a black hole can only increase?   It is not true that the black hole mass always increases.   A rotating black hole, for instance, can lose mass as its rotation slows down.
But there is a quantity that always increases.  Hawking had just proved the ``area theorem'' \cite{AreaTheorem}, which says that in 
classical general relativity, the area of the horizon of a black hole can only increase.\footnote{For the proof, see for example
\cite{wald}, p. 312, or \cite{Witten}, section 6.3.}  So it was fairly natural for Bekenstein to propose
that the entropy of a black hole should be a multiple of the horizon area.   For example, for a Schwarzschild black hole of mass $M$,
with line element
\be\label{linem}\d s^2=-\left(1-\frac{2 G M}{r}\right)\d t^2+\frac{\d r^2}{1-\frac{2 GM}{r}}+r^2\d\Omega^2\ee
(where $G$ is Newton's constant),
the horizon is at the Schwarzschild radius $r_S=2GM$  and the horizon area is
\be\label{horarea} A=4\pi r_S^2=16\pi G^2 M^2. \ee
Since entropy is dimensionless,\footnote{We measure temperature in energy units, with Boltzmann's constant set to 1.} 
if  black hole entropy is  to be a multiple of the horizon area, the  constant of proportionality will have 
units of inverse area.   From fundamental constants $\hbar, c$ and $G$, one can make the Planck length $\ell_P =(\hbar G/c^3)^{1/2}$
and the Planck area $\ell_P^2=\hbar G/c^3$.   In units with $c=1$, Bekenstein's formula for the entropy of a black hole was
\be\label{bhentropy} S=\frac{A}{4G\hbar},\ee
where the constant $1/4$ was not clear in Bekenstein's work and was determined by Hawking a couple of years later.
The formula with this factor of $1/4$ included is commonly called  the Bekenstein-Hawking entropy of the black hole.  


According to this formula, black hole entropy can be extraordinarily large in ordinary terms.    For example,
a black hole with the mass of the Sun has an entropy of roughly $10^{77}$, which is about $10^{18}$ times the entropy of the actual Sun. 
We included the factor of $\hbar^{-1}$ in eqn. (\ref{bhentropy}) to underscore the fact that the formula is quantum mechanical in an essential way, but  henceforth
we will set $\hbar=1$.


Bekenstein's idea was that the entropy of a black hole measures the number of ways that the black hole could have formed.   He
defined a ``generalized entropy'' -- the sum of the black hole entropy $A/4G$ and the ordinary entropy $S_\out$ of matter and radiation
outside the horizon:
\be\label{sgen}S_\gen=\frac{A}{4G}+S_\out.\ee
The generalized entropy was proposed to obey a Generalized Second Law, saying that it is nondecreasing in all processes that we
can observe in practice:
\be\label{practice}\frac{\d S_\gen}{\d t}\geq 0.\ee

Bekenstein considered several tests of the Generalized Second Law.   
For simplicity in the following we consider a Schwarzschild black hole. We want to test whether the generalized second law (\ref{practice}) is valid
when the black hole absorbs matter.  Since Bekenstein considered $S_\out$ to be the usual thermodynamic
entropy, the  statement (\ref{practice}) of the Generalized Second Law assumes that the matter system which is being absorbed by the black hole
is one for which thermodynamics is valid, meaning a system that is close enough to at least local thermodynamic 
equilibrium.\footnote{To formulate a version
of the Generalized Second Law when the matter and radiation outside the black hole are not close to thermal equilibrium, one needs to interpret $S_\out$
as  von Neumann entropy, which we introduce in section \ref{twonotions}, rather than thermodynamic entropy.}     A simple case
to consider is that the black hole is absorbing a beam of black body radiation, say at temperature $T$. 

In $3+1$ dimensions,\footnote{We generally phrase arguments in this article for the standard $3+1$-dimensional case,
as the generalization to $D$ dimensions would not add much.   The discussion of the Ryu-Takayanagi formula is the main exception, for reasons
explained in footnote \ref{exception}.}  the relation between energy $E$, temperature $T$, and entropy $S$ in black body radiation is $E=\frac{3}{4} TS$.
If a black hole of mass $M$ absorbs energy $E\ll M$ from black body radiation, its entropy $A/4G=4\pi GM^2$ increases by $8\pi GME$,
while the  entropy of the radiation decreases by $\Delta S_\out=4E/3T$.   The change in the generalized entropy is
\be\label{likely} \Delta S_\gen =\left(8\pi GM -\frac{4}{3T}\right)E. \ee
In particular, this is positive as long as $\pi r_S>1/3T$, or in other words as long as the typical photon wavelength (which is of order $1/T$) is sufficiently
small compared to the radius $r_S=2GM$  of the black hole. 

   
 However,  $\Delta S_\gen$ becomes negative if $T$ is so small that the typical photon wavelength is much larger than the Schwarzschild radius.   A black hole
 can absorb photons of such great wavelength, though not very efficiently.
The apparent entropy decrease when a black hole absorbs photons of extremely long wavelength does not have a satisfactory resolution in the 
 framework that Bekenstein assumed, which was that whatever falls behind the black hole horizon stays there
 forever.   In thermodynamic terms, since Bekenstein assumed that the black hole does not radiate, one would have
 to assign it a temperature of 0.   Thermodynamics says that at equilibrium, the changes in energy $E$ and entropy $S$
 of a system are related by $\d E= T\d S$ or $\d S=\d E/T$, so a system with $T=0$ should have $\d S=\infty$ if $\d E\not=0$.
 But Bekenstein wanted to attribute a finite, not infinite, entropy to the black hole.  
 
 
 
It turned out that the key to understanding the Generalized Second Law for a black hole that is absorbing photons of energy $\ll 1/2GM$
is to take into account the fact that the black hole is strongly emitting such photons.  In the next section, we will explain how Hawking discovered this.

The huge entropy $A/4G$ of a macroscopic black hole appears to imply that the black hole has of order $e^{A/4G}$ quantum states, though
the understanding of these states remains murky to the present day (except in the important special case of a supersymmetric black hole \cite{StromingerVafa}).   
This vast implied degeneracy of a quantum black hole may appear at first
sight to be in tension with the ``no hair theorem'' of classical general relativity \cite{nohair,nohair2}.   The no hair theorem asserts that classically
a black hole, after settling down to a stationary state, is fully characterized by the obvious conserved quantities -- mass, angular momentum, and charge.
Actually, in black hole thermodynamics, the no hair theorem is taken to represent thermalization.   An ordinary thermal system has a sort of no hair behavior.  Pour a cup of
water into a glass.   It will slosh around for a while and will visibly
not be in thermal equilibrium.   After some time, transients will die down and the water in the glass will be in apparent thermal equilibrium,  describable
just by its conserved quantities, though its
detailed microscopic state will not be describable by a truly thermal density matrix.\footnote{The relevant notions will be described in section \ref{twonotions}.  
Pouring  the cup of tea into a glass and letting it settle down is a unitary process but an  irreversible one,
so it increases the thermodynamic entropy without increasing the microscopic von Neumann entropy.  Therefore, even if the initial state of the tea was strictly thermal (described by a thermal
density matrix with equal von Neumann and
thermal entropies),
the final state has a von Neumann entropy less than that of a thermal density matrix at the relevant energy.}   The no hair
theorem is interpreted to say that a black hole does the same.




  \section{Black Hole Evaporation}\label{bhevaporation}
 
 Famously, Hawking discovered in 1974 that at the quantum level, a black hole is not really black.  Hawking reportedly was skeptical about Bekenstein's idea,
 but ended up proving it.   As preparation
 for describing Hawking's work, let us recall the notion of a Penrose diagram.
 
 Penrose diagrams are usually drawn for spherically symmetric spacetimes.   Angular coordinates are suppressed; only the
 time and a radial coordinate are shown.  The main purpose of the Penrose diagram is to exhibit causal relations in a useful
 way.   The diagram is drawn so that radially ingoing or outgoing null geodesics are at a $\pi/4$ angle to the vertical, and any causal
 curve (any null or timelike curve)  is at most at a $\pi/4$ angle from the vertical.  Since the condition for  a curve to be causal
 is invariant under conformal changes of coordinates, one usually makes a conformal mapping such that the whole diagram becomes
 compact and asymptotic regions at infinity are therefore easily visible.
 
 
      \begin{figure}
 \begin{center}
   \includegraphics[width=4in]{A.pdf}
 \end{center}
\caption{\footnotesize A Penrose diagram describing the collapse of a star to form a black hole.  \label{One}}
\end{figure} 
 
An important example is a Penrose diagram describing spherically symmetric collapse of  a star to a Schwarzschild black hole, as in  fig. \ref{One}.
 The left vertical boundary of the picture is the
origin of polar coordinates at $r=0$.    Shown in green is the worldvolume of the star.
(The fact that the star appears to emanate from a point in the far past is an artifact of the conformal mapping used in drawing the diagram.)   The
star ends its life at the singularity, depicted by the wiggly line at the top of the diagram.   Future and past null infinity are represented by the
diagonal lines on the right boundary, as labeled.  The horizon of the black hole is the diagonal black line inside the picture.    Since causal curves travel at an angle no greater than $\pi/4$ from the horizon, an observer
 outside the horizon can never see beyond the horizon.    The worldline of a massive observer who remains forever outside the horizon (and does not accelerate indefinitely) will end at the point $\i^+$,
 known as future infinity, where the horizon and future null infinity meet.   Anything that can be seen from anywhere in the spacetime outside the horizon can be seen from $\i^+$.  A massive
 observer began life in the far past, at the  point labeled $\i^-$ at the bottom of the figure.
 
 Hawking's discovery of black hole evaporation was based on studying the behavior of a quantum field in a definite classical spacetime background,
 taken to be a Schwarzschild black hole of mass $M$.
 This is potentially a sensible approximation if $M$ is much bigger than the Planck mass $(\hbar c/G)^{1/2}$, 
which is about $10^{-5}$ grams.  Equivalently, it is potentially a sensible approximation if the Schwarzschild radius
of the black hole is much bigger than the Planck length $(\hbar G/c^3)^{1/2}\approx 10^{-33}$ cm. Of course, the framework of quantum field theory in four-dimensional curved spacetime
might break down before reaching the Planck length (due to string theory or Kaluza-Klein theory, for example), but at any rate we expect that the very massive black holes
that are familiar in astrophysics are very far from any such breakdown.   So in particular, for a realistic astrophysical black hole,
Hawking's approximation is expected to be excellent.
 
 We want to analyze what an observer far from the collapsing star will see in the far future, after transients have died down.
 As an idealization, assuming that what are observed are massless fields such as the electromagnetic field, one can think of these observations as being made
 at future null infinity, and more specifically near the upper boundary of future null infinity where it ends at the point $\i^+$.   These conditions correspond to making
 observations at a great distance from the black hole and in the far future.
 
       \begin{figure}
 \begin{center}
   \includegraphics[width=4in]{B.pdf}
 \end{center}
\caption{\footnotesize Whatever the distant observer sees in the far future can be traced back to initial conditions on a Cauchy hypersurface, such as the hypersurface $\S$
shown in blue.   This Cauchy hypersurface has been chosen to cross the horizon outside the worldvolume of the collapsing star.   From this Cauchy hypersurface,
signals can propagate to the distant observer at the speed of light.   These signals can propagate along outgoing null geodesics, some of which are indicated
by the purple lines in the figure, which are at a $\pi/4$ angle to the vertical. These outgoing null geodesics, if labeled by the time of a distant observer,
``bunch up'' near the horizon, as shown,
because the redshift diverges there.   \label{Two}}
\end{figure} 
 
 Measurements that an observer will make at, or near, future null infinity can be traced back to initial conditions on a Cauchy hypersurface.
 For this purpose, we can choose any Cauchy hypersurface we want.  It is convenient to choose one that crosses the horizon outside the collapsing star such as the hypersurface
 $\S$ of fig. \ref{Two}.   From any point
 on $\S$, a massless particle might be emitted and propagate to future null infinity at the speed of light.  The diagonal purple lines in the figure represent the trajectories of such
 particles.  
 
 Let $u$ be any coordinate function on $\S$ that vanishes on the horizon and is positive outside, and such that the normal derivative of $u$ is nonzero (and finite) along the horizon.  An outgoing signal
 from the black hole that will eventually be received by a distant observer might propagate through $\S$  at any value of $u$.
 Let $t$ be the time at which the distant observer receives the signal.    The relation between $t$ and $u$ is
 \be\label{doffo} t=4GM \log \frac{1}{u} +C +\O(u), \ee
 where $C$ is a constant that depends on how far away the  observer is, and the precise definition of the function $u$.
   Eqn. (\ref{doffo}) can be justified
 by solving the geodesic equation for an outgoing null geodesic.  At the end of this section, we will explain a convenient choice of the function $u$,
 and a shortcut for doing the calculation.    For now, let us discuss the implications of eqn. (\ref{doffo}).
 
 Eqn. (\ref{doffo}) tells us that as $u\to 0^+$, the time $t$ at which the signal is received by a distant observer diverges, but only logarithmically.   Of course, this divergence
 is related
 to the fact that a signal that originates from behind the horizon -- say at $u<0$ -- will never reach the outside observer.  
 
 We can solve eqn. (\ref{doffo}) to express $u$ in terms of $t$.  Asymptotically for large $t$,
 \be\label{noffo} u = e^{C/4GM}  e^{-t/4GM}. \ee
 At late times, that is if $t$ is large, $u$ is exponentially small.    
 Therefore, late time measurements by the distant observer probe the quantum state at distances exponentially close to the horizon.   In quantum field theory,
 every state looks like the vacuum at short distances, so late time observations by the distant observer are in fact probing the vacuum state at exponentially small
 distances.   The distant observer does not need to wait terribly long before making observations that probe the vacuum at incredibly small distances. For example,
 for a black hole with the mass of the Sun, $4GM$ corresponds to a time of about $2\times 10^{-5}$ seconds, so every time the distant observer waits one second,
 $u$ becomes smaller by a factor $e^{-5\times 10^4}$.  Hence the observer need not wait very long (in human terms) to reach  the ``late time'' regime.
 

 
 Moreover,   $\frac{\d u}{\d t}$ is also exponentially small for large $t$,
 which means that a mode that reaches the observer at late times will have undergone an exponentially large redshift on its way.  
  A mode of any given energy $E$ that is observed at a sufficiently late time will have originated from a very high energy
 mode near the horizon.     Roughly
 speaking, a mode of very high energy propagates freely, along a radial null geodesic (such as the geodesics
 represented by the diagonal purple lines of
 fig. \ref{Two}).   If we assume this, we can get a very simple answer for what the distant observer will see.   The assumption is slightly
 oversimplified and a more precise story is explained in section \ref{graybody}.
 
 The distant observer probes the radiation emerging from the black hole by measuring a quantum field $\Psi$. 
 We assume that the distant observer measures $\Psi$ as a function of time $t$ and angular coordinates $\Omega$ at some fixed distance.
   A typical observable
 is a two-point function
 \be\label{dudd}\langle \Psi(\Omega,t)\Psi(\Omega', t')\rangle .\ee
 In a spherically symmetric Schwarzschild background, the field $\Psi$ can be expanded in partial waves.\footnote{Though this is far less obvious, a partial wave
 expansion is also possible in the field of a rotating (Kerr) black hole, using the fact that the usual wave equations in a Kerr geometry are separable.  That leads to a rather similar
 analysis for a rotating black hole.}   The coefficient of each partial wave
 is a $1+1$ dimensional quantum field (the two dimensions being the distance from the distance from the horizon and the time).   
 In the real world, $\Psi$ would probably be a component of the electromagnetic field, which we could expand in vector spherical harmonics.
The ideas needed to understand this case are explained in section \ref{graybody}.   A more general derivation allowing for  arbitrary non-gravitational forces is
 explained in section \ref{euclidean}.
 
 However, we can understand the essence of
 Hawking's discovery by assuming  that a particular partial wave $\psi$ of the field $\Psi$ is, say, a  chiral free fermion in the $1+1$-dimensional sense. (We take $\psi$ to be a {\it chiral} free fermion
 because only the modes that propagate outwards, from the horizon to infinity, are relevant.)   
 A chiral free fermion in $1+1$ dimensions has dimension 1/2, and its two-point function in the vacuum is\footnote{The factor  $(\d u\,\d u')^{1/2}$  is  only a convenient shorthand to
incorporate  the fact that $\psi$ has dimension $1/2$.  Under a change of coordinates from $u$ to some other coordinate such as $t$, as $\psi$ has  dimension $1/2$, it
  transforms by a factor $(\d u/\d t)^{1/2}$. That is important in the derivation of the key result (\ref{nudd}) below.   
 Including the factor $(\d u\,\d u')^{1/2}$ in the formula for the correlation function, with the rule $(\d u)^{1/2}=({\d u/\d t})^{1/2} (\d t)^{1/2}$ for any other function $t$, is a way to build in this
 transformation (and plays no other role).   A more intrinsic description is that because $\psi$ has dimension $1/2$, its two-point function $\la \psi(u)\psi(u')\ra$  is best understood as a half-density 
 rather than a function in each variable $u$ and $u'$. We  make this explicit with the factor $(\d u\, \d u')^{1/2}$.}
 \be\label{indibo} \la \psi(u)\psi(u')\ra = \frac{(\d u\,\d u')^{1/2}}{u-u'}. \ee
In late time measurements of the radiation emitted by a black hole, $u$ and $u'$ are both exponentially small and therefore
 exponentially close to each other.   Since any state looks like the vacuum at sufficiently short distances, in discussing
 what an observer will see at late times,  we can replace $ \la \psi(u)\psi(u')\ra$ by its vacuum expectation value (\ref{indibo}). 
 
 Setting $u=e^{C/4GM} e^{-t/4GM}$, we can turn eqn. (\ref{indibo}) into a formula for the two-point function measured by the
 distant observer at late times:
 \be\label{nudd} \la \psi(t)\psi(t')\ra =\frac{1}{4GM}\frac{(\d t \,\d t')^{1/2}}{e^{(t-t')/8GM}-e^{-(t-t')/8GM}}. \ee
 This is antiperiodic in imaginary time; in fact, it is odd under $t\to t+8\pi GM \i $.   Antiperiodicity with that period
 corresponds to a thermal correlation function\footnote{At temperature $T$,
 fermion correlation functions are antiperiodic under $t\to t+\i/T$, and boson correlation functions are periodic.  For a calculation similar to the one in the text with a bosonic field, one could
 consider a chiral current $J$, of dimension 1, with vacuum expectation value $\la J(u)J(u')\ra =\frac{\d u \, \d u'}{(u-u')^2}$.  Changing variables from $u$ to $t$, one finds
  periodicity of $\la J(t) J(t')\ra$ under $t\to t+8 \pi G M\i$.}   at a temperature $T_\sH=1/8\pi GM$, known as the Hawking temperature of the black hole.  In fact, the right hand side of eqn. (\ref{nudd}) is the two-point function of a chiral free fermion at temperature $T_\sH$.
 In other words it is the thermodynamic limit of  $\frac{1}{Z} \Tr\, e^{-\beta_\sH H} \psi(t)\psi(t')$, where $H$ is the Hamiltonian and $Z$ is the partition function of a chiral free fermion,
 and $\beta_\sH=1/T_\sH$.    
This statement can be verified by a standard textbook calculation, but such a calculation is not really necessary, since
this thermal two-point function is uniquely determined by the following facts: it is antiperiodic under $t\to t+8\pi GM \i$, and
 modulo this antiperiodicity, its only singularity is a simple pole at $t=t'$ with residue 1 (fig. \ref{Four}).  
  
  
          \begin{figure}
 \begin{center}
   \includegraphics[width=3.4in]{Fig3.pdf}
 \end{center}
\caption{\footnotesize The thermodynamic limit of the thermal two-point function  $\frac{1}{Z} \Tr\, e^{-\beta_\sH  H} \psi(t)\psi(t')$ of a two-dimensional chiral free fermion $\psi$
can be computed by a Euclidean signature path integral on a cylinder of circumference $\beta_\sH$. 
The cylinder is defined by complexifying the time coordinate $t$ to a complex variable $z$, with $t=\rm{Re}\,z$; $z$ is defined to be a periodic variable with
 $z\cong z+\beta_\sH \i$.  The operator $\psi$ is inserted at the points $z=t$ and $z=t'$.
The action is the usual action
$\frac{1}{2\pi}\int \d^2z \psi\partial_{\bar z}\psi $ of a chiral free fermion, and 
 $\psi$ is taken to be antiperiodic in going around the cylinder. 
 In this representation,
antiperiodicity of the thermal correlation function under $t\to t+\beta_\sH \i$ is manifest, and it is also manifest that the only singularity of the two-point function is a simple pole
with residue 1 at $t=t'$.  These properties uniquely determine the answer. \label{Four}}
\end{figure} 
  
  Since the measurements of a distant observer at late times coincide with what one would expect in a thermal ensemble at temperature $T_\sH=1/8\pi GM$,
  we learn that 
 a black hole, after transients that depend on how it was created die down, radiates thermally at that  temperature.   This explains why Bekenstein had trouble making sense of the interaction of the black hole with photons of energy
  small compared to $1/8\pi GM$.   Such photons are strongly emitted by the black hole, with a large average occupation number in each outgoing mode,
  and in investigating the Generalized Second Law, one has to take into account the entropy increase due to that emission.
 
 We can also now confirm Bekenstein's formula for the entropy of the black hole, and explain how Hawking determined
 the overall constant in this formula.   We use the First Law of thermodynamics  
 \be\label{firstlaw} \d E=T\d S, \ee where the energy $E$ is the black hole mass $M$, and
  for a Schwarzschild black hole  $T=1/8\pi G M$.   Hence  $\d S=8 \pi G M \d M$ so (assuming that $S$ vanishes in the absence
 of a black hole, that is at $M=0$) $S=4\pi G M^2$.   The area of a Schwarzschild black hole is $A=16\pi G^2 M^2$ so the entropy
 is
 \be\label{zindo} S=\frac{A}{4G}.\ee
 This is how Hawking confirmed Bekenstein's ansatz and determined the overall normalization.
 
 If we do not set $\hbar=1$, then the Hawking temperature is actually $T_H=\frac{\hbar}{8\pi GM }$, showing  explicitly that the nonzero temperature is a quantum effect.
  
 In this explanation, we used Hawking's result for the black hole temperature and an assumption that the black hole really is a thermal system to which the First Law will apply to determine
 the entropy and recover the result $S=A/4G$.   Alternatively, if we assume the ansatz $A/4G$ for the entropy and Hawking's result for the temperature, we can read the same
 computation in reverse as a verification that the First Law does hold for Schwarzschild black holes.  Similarly, by a much more detailed analysis, one can show \cite{BCH} that 
 a rotating black with angular momentum $J$  satisfies a more general version of the First Law 
$\d E=T\d S+\Omega \d J$, where $\Omega$ is called the angular potential.
A useful reference  is section 12.5 of \cite{wald}, and a derivation based on a covariant description of gravitational phase space can be found in 
\cite{IW}.    The First Law is an important aspect of the consistency of black hole thermodynamics, and the reader is urged to explore it further, but we will not explain these derivations in
detail in the present article.
However, we briefly return to the First Law in section \ref{morevn}.
 
 One way to justify eqn. (\ref{doffo}) or equivalently (\ref{noffo})  is to introduce the Kruskal-Szekeres coordinates.  A standard definition is
 \begin{align}\label{kscoords} U&=-\left(\frac{r}{2GM}-1\right)^{1/2} e^{r/4GM} e^{-t/4GM} \cr
                                 V&=\left(\frac{r}{2GM}-1\right)^{1/2} e^{r/4GM} e^{t/4GM}.\end{align}
  In terms of these coordinates, the Schwarzschild metric is
  \be\label{ksschw} \d s^2=-\frac{32 G^3 M^3}{r} e^{-r/2GM} \,\d U \, \d V +r^2\d\Omega^2,\ee
  where $r$ is defined implicitly by
  \be\label{impdef} -UV =\left(\frac{r}{2GM}-1\right) e^{r/2GM}. \ee
  The most important application of the Kruskal-Szekeres coordinates is to describe the extension of the Schwarzschild geometry beyond the horizon at $r=2GM$.
   We will return to this in section \ref{thermofield}.   For now, we will just use these coordinates to justify eqn. (\ref{noffo}).   The form (\ref{ksschw}) of the metric
   shows that a radially outgoing or ingoing null geodesic\footnote{A radial  null geodesic is defined as one located at a fixed value of the polar angles, so that $\d\Omega^2=0$
   along such a geodesic. Hence $\d U \,\d V=0$ along such a geodesic and either $\d U=0$ or $\d V=0$.}  must satisfy $\d U=0$ or $\d V=0$, so in other words $U$ or $V$ is constant along such a geodesic.   More specifically, from the formulas
   (\ref{kscoords}), we see that $U$ is constant on an outgoing radial null geodesic and $V$ is constant on an ingoing one.  Eqn. (\ref{kscoords}) shows that $U$ vanishes
   at $r=2GM$ and is negative for $r>2GM$, so for a function that vanishes on the horizon and is positive outside, we can take $u=-U$.  Eqn. (\ref{kscoords}) then gives
   the claimed result $u= C' e^{-t/4GM}$, where $C'=\left(\frac{r}{2GM}-1\right)^{1/2} e^{r/4GM}$ is a constant that depends on the position of the observer and not on the time $t$ at which
   an observation is made.   Actually, it is natural to introduce the retarded time $t_\ret=t-r$ and write the formula for $u$ in the form
   \be\label{zimpdef}u = \left(\frac{r}{2GM}-1\right)^{1/2} e^{-t_\ret/4GM}.\ee   
    For a black hole with the mass of the sun, assuming that $r/2GM$ is large but not exponentially large, $u$ becomes exponentially small as soon as $t_\ret$
    is large compared to $4GM\approx 2\times 10^{-5}$ seconds.               
 
        \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Wheeler_Image.pdf}
 \end{center}
\caption{\footnotesize  A visualization by  Wheeler \cite{ItFromBit} of the black hole horizon made out of cells roughly of Planck area, with a bit or
qubit associated to each cell.  \label{Three}}
\end{figure} 
 
 An important detail in this derivation is that it is not necessary to begin the discussion at distances so small, or energies so high, that the laws of nature are unknown.
 We inferred what the distant observer will see at late times by starting with a knowledge of the short distance behavior of the quantum field.   But here, what do we mean by short
 distances?   It is enough that the hypersurface $\S$ is far enough in the past, relative to the observer, so that
the relevant signal originates on  $\S$ at a distance from the horizon that is  very small relative  to the Schwarzschild radius of the black hole; then the details of the black hole geometry do not affect
 the key correlation function $\la\psi(u)\psi(u')\ra$, which will coincide with the expectation value in vacuum.\footnote{The derivation  given here is in the spirit of Hawking's original
 work \cite{hawking}, with an improvement that possibly was first made by Fredenhagen and Haag \cite{FH}.   The improvement is to trace the measurements made by the observer
 not back to initial conditions at past null infinity, but only to initial conditions on a conveniently chosen hypersurface $\S$ that intersects the horizon outside the worldvolume of the collapsing
 star.   In this way, one avoids any discussion of physics at extremely high energies.}
   So for example, in the case of an astrophysical black hole, with a Schwarzschild radius of a few kilometers or more,
 the ``short distance'' scale could be a millimeter: extremely small compared to the size of the black hole, but not nearly small enough to probe the limits of our knowledge of physics.
 
 
 We conclude this section with some general remarks about black hole thermodynamics and Hawking radiation.
 Many researchers have thought that, somehow, the entropy $S=A/4G$ means that a black hole
 can be described by some sort of degrees of freedom that live on its horizon -- roughly, with one bit or qubit for every
Planck unit $G$ of area.   In a famous article \cite{ItFromBit},  Wheeler illustrated this idea as in fig. \ref{Three}.  
Even today it remains a challenge to properly justify and understand this picture.

The Hawking temperature $T_\sH=1/8\pi GM$ can be expressed in terms of the Schwarzschild radius $r_S=2GM$ as
\be\label{wiggly} T_\sH=\frac{1}{4\pi r_S}. \ee
Thus the Hawking temperature is of order $1/r_S$, and a typical massless particle emitted by the black hole has a wavelength, measured
at infinity, of order $r_S$ and an energy of order $1/r_S$. 

Energy loss by a radiating  astrophysical black hole is extremely slow.   The total luminosity of a radiating body of surface  area $A$
and temperature $T$ is of order $AT^4$, which in the case of a black hole is a multiple of $1/G^2 M^2$.   Thus in order of magnitude the rate of energy
loss by a radiating astrophysical black hole is
\be\label{enloss} \frac{\d M}{\d t}\sim \frac{1}{G^2 M^2}. \ee
With real world assumptions about the particles emitted by the black hole -- mainly photons and gravitons -- the constant of proportionality in this
relation was computed by Page \cite{Page}.   (This calculation requires understanding the gray body factors, which we introduce in section \ref{graybody}.) 
Following Hawking, energy loss by a radiating black hole is called black hole evaporation.   Eqn. (\ref{enloss}) shows
that evaporation of a black hole with a typical astrophysical mass is a very slow process.   The time for a  solar mass black hole in vacuum to evaporate away
a significant part of its mass is of order $10^{67}$ years.  Of course, in the real world, an astrophysical black hole is not in vacuum and is more
likely to accrete mass than to evaporate.

Since Hawking's approximation of considering a quantum field in a given spacetime background is valid as long as the black hole is
much heavier than the Planck mass, a solar 
mass black hole in vacuum, with initial mass of order $10^{33}$ grams, will shrink to a microscopic size before 
Hawking's analysis breaks down.   We do not really know what happens at that point, but we presume that eventually
the evaporation ends and only stable elementary particles remain.

A fundamental point about Hawking radiation is that the radiation appears to be thermal even though the black hole
could have formed from a pure state.   This has presented a puzzle that drives much of the research in this field and that even today
is only partly resolved.  Hawking's approximations are valid for almost the whole evaporation process and seem to show
that the outgoing state is thermal, ultimately with a very large entropy of order the total number of photons emitted during the evaporation, which is roughly
$M/T_\sH\sim GM^2$ (or about $10^{76}$ for
a solar mass black hole).   But if the formation and evaporation of the black hole are described by the ordinary laws of quantum mechanics,
then if the initial state is pure, the final state should also be pure.

Concretely, the reason that the Hawking radiation seems to be thermal even if the black hole is in a pure state is that the
observations of the distant observer amount to observing the quantum fields only outside the horizon.
Even if a black hole formed from a pure state -- so that we can assume that the state of the whole universe is pure -- the
quantum fields restricted to only part of spacetime are in a mixed state.   That is the essence of the Hawking effect.   We will return to this in section \ref{division}.     

  
 \section{Gray Body Factors}\label{graybody}
 
 In section \ref{bhevaporation}, we assumed, in effect, that a signal emitted from the horizon propagates freely to the distant observer.
 This is oversimplified, since in general, there is a sort of angular momentum barrier around the black hole, as we will see, and an outgoing
 signal might be reflected back towards the horizon.   The derivation of section \ref{bhevaporation} gives a quick way to understand
 the essence of Hawking's discovery,  but here we will give a more precise explanation.
 
 First of all, it is possible in 3+1 dimensions to have a semirealistic model that leads precisely to the analysis in section \ref{bhevaporation}.
 For this, we consider a magnetically charged black hole and a massless electrically charged fermion field $\Psi$ interacting with the black hole.   The partial wave
 of $\Psi$ of lowest possible angular momentum is a massless fermion in the $1+1$-dimensional sense, and its outgoing (chiral) component
 has precisely the properties assumed in section \ref{bhevaporation}.   See \cite{Malda} for a study of such models.   However, more typically,
 as we will see, there is a potential barrier outside the black hole (even for angular momentum zero) and matters are not as simple as assumed in 
 section \ref{bhevaporation}.
 
 \subsection{The Potential Barrier}\label{potential}
 
 For simplicity, we will consider a massless scalar field $\phi$  in the presence of the black hole.    In the real world, it would be more realistic
 to consider the electromagnetic field or the gravitational field.   This would lead to very similar considerations, except that we would have to make a more complicated partial wave
 expansion using vector or tensor spherical harmonics. 
 
 We assume that $\phi$ interacts with gravity only, with minimal coupling via the
 action $-\frac{1}{2}\int \d^4 x \sqrt g  \,g^{\mu\nu}\partial_\mu\phi \partial_\nu\phi.$ 
 In a Schwarzschild background, the action for a mode of angular momentum $l$ is then
 \be\label{zonkyx} I= \int\d t\, \d r \left(\frac{r^2}{2}\frac{1}{1-\frac{2GM}{r}}\left(\frac{\d\phi}{\d t}\right)^2 -\frac{r^2}{2}\left(1-\frac{2GM}{r}\right)\left(\frac{\d \phi}{\d r}\right)^2
 -\frac{l(l+1)}{2}\phi^2\right). \ee  It is convenient to introduce the ``tortoise coordinate'' $r_*=r+2GM\log(r-2GM)$, which satisfies
 $\d  r =\d r_* \left(1-\frac{2GM}{r}\right)$, and ranges over the whole
 real line $-\infty<r_*<\infty$ for $2GM<r<\infty$.   The action becomes 
  \be\label{wonkyx} I= \int\d t\, \d r_* \left(\frac{r^2}{2}\left(\frac{\d\phi}{\d t}\right)^2 -\frac{r^2}{2}\left(\frac{\d \phi}{\d r_*}\right)^2
 -\left(1-\frac{2GM}{r}\right)\frac{l(l+1)}{2}\phi^2\right). \ee
 Setting $\phi=\sigma/r$ and integrating by parts, we get
 \be\label{monky} I=\int \d t\, \d r_*\left( \frac{1}{2}\left(\frac{\d\sigma}{\d t}\right)^2-\frac{1}{2}\left(\frac{\d \sigma}{\d r_*}\right)^2  -\left(1-\frac{2GM}{r}\right)\left(\frac{l(l+1)}{2r^2} +\frac{GM}{r^3}\right)\sigma^2\right). \ee
 In other words, $\sigma$ is effectively a free massless scalar  propagating in  an effective two-dimensional Minkowski space with line element  $-\d t^2+\d r_*^2$ and interacting  with the effective potential
 \be\label{onky} V_\eff=\left(1-\frac{2GM}{r}\right)\left(\frac{l(l+1)}{r^2} +\frac{2GM}{r^3}\right).\ee   This effective potential is positive definite, vanishing near the horizon
and at infinity, with a barrier in between.
  Notably, even if $l=0$, there is a nontrivial effective potential, namely
 \be\label{winky}V_\eff=\frac{2GM}{r^3}-\frac{4(GM)^2}{r^4}.\ee
  The maximum of this potential is at $r_\max=\frac{8}{ 3 }GM$, and the value of the potential at the maximum is $V_\max(l=0)= \frac{27}{1024(GM)^2}$.   
  For $l>0$, the maximum of the potential is greater.   For large $l$, the maximum is approximately at $r=3GM$, and the maximum value of the potential
  is $V_\max(l)\cong \frac{l(l+1)}{27 (GM)^2}$.   
  
  To get from the horizon to infinity, a wave will have to propagate over the potential barrier.   
  Only a wave whose energy 
 is much greater than $\sqrt{V_\max(l)}$   will propagate almost freely\footnote{Such a wave still experiences a phase shift or time delay, but this is not noticeable to the distant
 observer, who does not know when the signal was emitted.}
 from the horizon at $r_*=-\infty$ across the barrier to $r_*=+\infty$.   
 So our previous calculation is good for the $l=0$ mode if the Hawking radiation from the black hole is being observed
 at frequencies much above the Hawking temperature $T_\sH=\frac{1}{8\pi GM}\sim \sqrt{V_\max(l=0)}$. For  $l>0$, the previous calculation is good at frequencies
 much above $l T_H$.   At any given frequency, the analysis of section \ref{bhevaporation}  is completely wrong if $l$ is sufficiently large, because a wave of any given
 energy is far below the barrier if $l$ is sufficiently large.
 
An outgoing mode from the horizon at $r_*=-\infty$ might be scattered back into the black hole by the potential and reabsorbed,  or it might be transmitted across  the barrier
to $r_*=+\infty$.   Heuristically,  our calculation
 in section \ref{bhevaporation} should be modified accordingly; the probability to observe an outgoing particle near  $r_*=\infty$ should be reduced by the
 transmission probability across the barrier.
 

 Before giving a technical justification of this claim, we will first explain the implications.   Suppose that it is true that the black hole has a temperature $T_\sH$.   Then
 we expect that it can be in equilibrium with a thermal gas at that temperature \cite{Equil1,Equil2}.   
 In equilibrium with such a gas, the black hole is absorbing thermal radiation at temperature $T_\sH$;
 equilibrium can potentially be maintained because the black hole is also emitting thermal radiation at the same temperature.   In the simplest situation,  assume that the
 effective potential vanishes for some partial wave.  (As already noted, this only happens for an electrically charged massless fermion interacting with a magnetically charged black hole.)
 Then the black hole will absorb all of the incident radiation in that partial wave.   Equilibrium is maintained because, as analyzed in section \ref{bhevaporation}, in the absence of a  potential
 barrier, the black hole is also freely emitting thermal radiation at temperature $T_\sH$.    Now consider a more realistic situation with $V_\eff\not=0$.   Not all incident radiation is absorbed.
 In a given partial wave at a given energy, the absorption probability is reduced by a factor equal to the transmission probability from right to left (that is, from $r_*=+\infty$ to $r_*=-\infty$).   To maintain
 equilibrium, the emission probability must be reduced by the same factor.  However, as will be explained in a moment,  the transmission probability through the
 barrier from left to right is the same as the transmission probability from right to left.   So equilibrium of the black hole with thermal radiation at temperature $T_\sH$ is possible if the
 emission from the black hole is reduced relative to our previous result by a factor of the transmission probability from left to right through the barrier.
 
 The statement that the transmission probability from left to right equals that from right to left can be proved as follows.
 A solution of the Klein-Gordon equation for $\sigma$ with frequency $\omega$ has the form  $\sigma(r_*,t)=\lambda(r_*) e^{-\i \omega t}$, with
  \be\label{theq}\left( -\frac{\d^2}{\d r_*^2} +V_\eff(r_*)\right) \lambda(r_*)=\omega^2 \lambda(r^*). \ee
 A solution $\lambda_\omega$  that describes the scattering of a wave incident from the left has the asymptotic behavior
 \be\label{celok} \lambda_\omega(r^*)\sim \begin{cases} e^{\i \omega r_*}+R(\omega) e^{-\i \omega r_*} & r\to -\infty \cr
                                                                                            T(\omega) e^{\i \omega r_*} & r\to +\infty.\end{cases}\ee
 $T(\omega)$ and $R(\omega)$ are the transition and reflection amplitudes for a wave  of frequency $\omega$ incident from the left.
 A solution $\t\lambda_\omega$ that describes the scattering of a wave incident from the right similarly has the asymptotic behavior
  \be\label{delok} \t\lambda_\omega(r^*)\sim \begin{cases} \t T(\omega) e^{-\i \omega r_*} & r\to -\infty \cr
                                                                                           e^{-\i \omega r_*} + \t R(\omega) e^{\i \omega r_*}  & r\to +\infty.\end{cases}\ee
   where $\t T(\omega)$ and $\t R(\omega)$ are transmission and reflection amplitudes
                                                                                           for a wave incident from the right.
   Since $\lambda_\omega$ and $\t\lambda_\omega$ satisfy the same equation (\ref{theq}), the Wronskian                                                                                        
 $\lambda_\omega \frac{ \overset{\leftrightarrow}{\,\d\,}}{\d r_*}\t \lambda_\omega$ is independent of $r_*$.  Comparing the values at $r_*\to \pm\infty$,
 we get the claimed result $T(\omega)=\t T(\omega)$.
 
 \subsection{More Detailed Argument}\label{detailed}
 
       \begin{figure}
 \begin{center}
   \includegraphics[width=4in]{C.pdf}
 \end{center}
\caption{\footnotesize  This picture illustrates a more detailed derivation of the Hawking process.   $\S'$ is a late time Cauchy hypersurface on which a measurement
will be made.     The operator that will be 
measured is $W^\dagger W$, where $W$ is a linear function of a quantum field $\sigma$ and its time derivative $\dot\sigma$ on the surface $\S'$.   
By solving the wave equation backwards in time, starting with ``final data'' on
$\S'$, one can obtain an expression for $W$ in terms of $\sigma$ and $\dot\sigma$ on an earlier
hypersurface $\S$. This leads to a corrected prediction for  black hole radiation that incorporates the interaction of the outgoing radiation with the gravitational field
of the black hole.  \label{Detailedx}}
\end{figure} 
 
 
 Now, following \cite{hawking,FH}, we will aim for a more technical justification of the
  claim that the thermal radiation rate found in section \ref{bhevaporation} must be multiplied by a factor $|T(\omega)|^2$.
 The late time observer measures, for example, an operator $W^\dagger W$, where $W$ is an operator linear in the field $\sigma$.   Using the field equations, any such
 operator can be expressed in terms of the field $\sigma$ and its time derivative on an arbitrary initial value surface $\S'$:
 \be\label{whatabout} W=\int_{S'} \d^3 x\sqrt h \left( a(x)\sigma(x) +b(x)\dot \sigma(x)\right),  \ee
 where $a$ and $b$ are functions on $\S'$.
 Here $h$ is the induced metric of the Cauchy hypersurface $\S'$, and $\dot\sigma$ is the derivative of $\sigma$ in the direction normal to $\S'$.
 Though such an expression defines a field operator for any choice of the hypersurface $\S'$ and the functions $a$ and $b$, in order to define
 an operator $W$ that is related in a simple way to the observation that is going to made, it is useful to pick the hypersurface $\S'$ to pass through the detector
 at approximately the time when the measurement will be made, and to choose the functions $a$ and $b$ to be supported near the detector.   In particular,
 the functions $a$ and $b$ are then supported entirely outside the horizon.   It does not matter very much how the  hypersurface $\S'$ behaves away from the detector,
 but it is natural to choose it, as in fig. \ref{Detailedx}, to be everywhere well to the  future of the hypersurface $\S$ of fig. \ref{Two} that was used in the derivation of section \ref{bhevaporation}.
 Assuming that the observer wishes to measure the radiation flux at the angular position of the detector as a function of energy and time,  it is convenient to pick the
 functions $a$ and $b$ to be functions of the distance $r$ from the black hole and to be approximately proportional to $e^{\i \omega r}$, for some $\omega$.   Of course,
 since $a$ and $b$ are supposed to be localized near the detector, they cannot have precisely this exponential form, but they can be supported in a very small range of $\omega$.
 With a little more care with the functions $a$ and $b$,
 we can ensure that $W$ is (very nearly) an annihilation operator for modes of frequency $\omega$, while $W^\dagger$ is a creation operator; thus $W^\dagger W$ is
 a number operator and a measurement of this operator  will reveal the flux of particles at energy $\omega$ at the angular position of the detector.\footnote{To get information about the angular momentum of the emitted particles, one would need to be able to measure interference between events involving absorption of a particle
 at different angular positions.     For example, one could in principle measure $W^\dagger W'+W'^\dagger W$, where $W'$ is
defined like $W$ but for a detector at a different angular position.}
 
 A different representation of the operator $W$ is convenient.   One can view $a$ and $b$ as initial conditions for a solution $f$ of the Klein-Gordon equation $\sum_{\mu=0}^3 D_\mu D^\mu f=0$:
 \be\label{doffox} f|_{S'}= b(x),~~~ \dot f|_{S'}=-a(x).  \ee
We can then alternatively write
 \be\label{natabout} W=\int_{S'} \d \Sigma^\mu \, f \overset{\leftrightarrow}{\partial}_\mu \sigma, \ee
 where $\d \Sigma^\mu$ is the surface element associated to $\S'$.
 The point of this is that since $f$ and $\sigma$ obey the same Klein-Gordon equation $D_\mu D^\mu f=D_\mu D^\mu \sigma=0$, the quantity
$ f \overset{\leftrightarrow}{\partial}_\mu \sigma$ is a conserved current, $D_\mu\left(f \overset{\leftrightarrow}{\partial}{}^\mu \sigma\right)=0$,
and therefore we can define the same operator $W$ by an expression of the same form as eqn. (\ref{natabout}), but with $\S'$ replaced by any other Cauchy hypersurface.
In particular, we can write such a formula with $\S'$ replaced by the hypersurface $\S$ that was used in the derivation in section \ref{bhevaporation}:
\be\label{zatabout}W = \int_{S} \d \Sigma^\mu \, f \overset{\leftrightarrow}{\partial}_\mu \sigma. \ee

But what does $f$ look like on the hypersurface $\S$?   To find out, we have to start with the initial (or final?) data of eqn. (\ref{doffox}) on the hypersurface $\S'$ and solve the Klein-Gordon
equation backwards in time to find the solution on $\S$.   One general fact is that since the support of $f$ on Cauchy hypersurface $\S'$ was entirely outside the horizon, it follows
that everywhere to the past of $\S'$, $f$ is supported outside the horizon.  In particular then, that is true on $\S$.   More specifically, on the hypersurface $\S'$, $f$ is (very nearly) an incoming wave of frequency 
$\omega$. When we integrate the Klein-Gordon equation backwards in time, $f$ will propagate in towards the black hole until it meets the same potential barrier that we have already
discussed, by which it will be partly reflected and partly transmitted.   The reflected part of the wave will return  -- as we go back in time -- back towards $r=\infty$, and the
transmitted wave will continue to the near horizon region of $\S$.  

 Let $T'$ and $R'$ be the transmission and reflection amplitudes in the time-reversed scattering problem.   Then eqn. (\ref{zatabout}) exhibits $W$ as the sum of $T'$ times a near
 horizon operator and $R'$ times an operator in the Minkowski vacuum near $r=\infty$.     When the
 observer measures $\la W^\dagger W\ra$, the ``long distance'' contributions proportional to $R'$ or $\bar R'$ do not contribute, because the long distance
 operators that appear have vanishing expectation in the Minkowski vacuum
  (the part of $W^\dagger W$ that is proportional to $|R'|^2$ is a number operator whose expectation value in the Minkowski vacuum
 vanishes, and the terms proportional to $T' \bar R'$ or $\bar T' R'$ vanish because an operator linear in $\sigma$ likewise has vanishing expectation value in the Minkowski vacuum).
 So the relevant part of $W^\dagger W$ is just  $|T'|^2$ times the same near horizon operator that we would have if there were no reflection from the barrier.
 
 $T'$ and $R'$ are transmission and reflection amplitudes in a time-reversed version of the scattering problem that we studied earlier.   Time-reversal has the effect
 of complex conjugating the scattering amplitudes, so in particular $T'$ is just the complex conjugate of the amplitude $T$ for transmission through the barrier as defined
 earlier.   So  $W^\dagger W$ is just $|T|^2$ times what it would be if there were no potential barrier, as implicitly assumed in the simple derivation in section
 \ref{bhevaporation}.     Therefore, as claimed, the emission rate from the black
 hole in a given partial wave at frequency $\omega$ is $|T(\omega)|^2$ times the thermal emission rate in the given mode at the Hawking temperature.

These results and extensions of them indicate that in the far future, the quantum fields outside the black hole horizon are in a universal state, known as the Unruh state \cite{U}, 
that does not depend on the details of how the black hole formed.    

 The suppression of the Hawking radiation by what are usually called gray body factors is actually essential for enabling the Hawking process to make sense.
 If the simple derivation of section \ref{bhevaporation} were valid in every partial wave, then we would expect the same thermal emission rate in each partial wave, and, as
 there are infinitely  many partial waves, we would predict an infinite luminosity for the Hawking process.   Instead, because $|T|^2$ vanishes rapidly with increasing $l$,
 the emission is dominated by the first few partial waves and the total luminosity has the order of magnitude claimed in eqn. (\ref{enloss}).
 
 \subsection{Thermodynamic Instability}\label{unstable}
 
 Since thermodynamic equilibrium between a black hole and a thermal gas played a role in motivating this discussion, it probably is time to  point  out that in an asymptotically flat spacetime, 
 once gravitational
 back reaction is taken into account, such equilibrium is actually unstable.   In a sense, there are two reasons for this instability.   The first has to do with the thermodynamics
 of the black hole.   Consider a black hole of mass $M$ that is in equilibrium with a thermal gas at the appropriate Hawking temperature $T=1/8\pi GM$.   Now, consider
 a thermal fluctuation in which the black hole emits a few more particles than it absorbs.  As a result, the black hole mass is reduced, and because the Hawking temperature is
 inversely proportional to the mass, the black hole becomes hotter.   Since the black hole is now hotter than its surroundings, it will now with very high probability emit
 more than it absorbs, and continue to lose mass.   Thus there is a runaway instability that will cause the black hole to disappear.   Conversely, an upward fluctuation in the black hole
 mass will cause the black hole to become cooler and emit less; then it will absorb more than it emits and its mass will grow further, without limit.
 
 This instability reflects the fact  that a black hole in an asymptotically flat spacetime has a negative specific heat.   In general the specific heat of a body of energy $E$ and temperature $T$
 is defined as $C=\frac{\d E}{\d T}$, and thermodynamic stability requires $C\geq 0$.  The black hole with $E=M$ and $T=1/8\pi GM$ has
 \be\label{gofo} C=-8\pi GM^2<0,\ee
 showing the instability.  
 
 The second source of instability is that in fact, in the presence of gravity, it is not possible to have a thermal gas filling an asymptotically flat spacetime.   Consider a portion of space of radius $R$
 filled by a thermal gas of temperature $T$.   The energy density of the gas is of order $T^4$ and its total energy is of order $T^4 R^3$.   The Schwarzschild radius of a body of
 that mass is of order $G T^4 R^3$, so  a  thermal gas filling a region of radius $R$ with $R\lesssim G T^4 R^3$ will collapse to a black hole.  In other words, a thermal gas
 of temperature $T$ in an asymptotically flat spacetime can at most occupy a region of size
 \be\label{zondy} R\sim \frac{1}{{\sqrt G} T^2}\ee   without collapse to a black hole.  This instability was discussed in \cite{GPY}.
 
 Given this, what is the sense of the argument that we gave concerning equilibrium between a black hole and a thermal gas?   The answer to this question is that, as the derivation
 of the Hawking effect is based on quantum field theory in a fixed spacetime background, the whole analysis is asymptotically valid in the limit $G\to 0$.   As $G\to 0$, 
 the various instabilities that we have mentioned turn off.  
  To see this most clearly, we have to decide what we want to keep fixed as $G\to 0$.
 There is a factor of $G$ in the relation $r_S=2GM$ between the Schwarzschild radius $r_S$ and the mass $M$, so we cannot keep them both fixed as $G\to 0$.   In studying
 black holes, it is more natural to keep $r_S$ fixed as $G\to 0$.  Indeed, in section \ref{bhevaporation}, we worked in a limit $G\to 0$, since we did not consider loop effects due
 to quantum gravity fluctuations, and we worked in a definite spacetime that had a limit as $G\to 0$, which corresponds to keeping fixed $r_S$ rather than $M$ as $G\to 0$.
 It is natural, then, to express the Hawking temperature in terms of $r_S$ rather than $M$:  $T_\sH=\frac{1}{4\pi r_S}.$   Thus in the limit $G\to 0$, the Hawking temperature is fixed
 and the black hole mass $M=r_S/2G$ diverges. 
 
 With this in mind, let us re-examine the upper bound (\ref{zondy}) for the maximum size $R$ of a region of thermal radiation at temperature $T$ that does not collapse to
 a black hole.   
 Setting $T$ to be the Hawking temperature $T_\sH=1/4\pi r_S$,
 we find that the upper bound $R\leq 16\pi^2 r_S^2/\sqrt G$ is of order $1/\sqrt G$ as $G\to 0$ with fixed $r_S$.  
  If the maximum allowed $R$ is much greater than $r_S$  (the upper bound on $R/r_S$ is of order $10^{38}$ for a solar mass black hole), then although the black hole cannot
 be sensibly embedded in a thermal gas that fills all of an asymptotically flat space, it can be embedded in a thermal gas that fills an enormously large volume.
 
 The instability involving a fluctuation in the mass of the black hole also turns off as $G\to 0$.   When a statistical fluctuation occurs and the black hole emits a few more particles than it absorbs, its mass drops by an amount
 of order 1 and its temperature increases  by an amount of order $G$.   This will indeed cause the black hole to continue to emit more than it absorbs, but only by an amount of order $G$,
 and the time scale for the resulting instability to significantly change the black hole mass and the associated geometry is of order $1/G^2$.   
 
 Thus although a black hole in an asymptotically flat spacetime cannot be in perfect equilibrium with a thermal gas filling all of spacetime, one can come exceedingly close to this -- arbitrarily close
 as $G\to 0$.   Actually,  the instabilities that we have considered here can be eliminating by introducing a small negative cosmological constant and replacing
 an asymptotically flat spacetime by one that is asymptotic to Anti de Sitter space.  This regularizes the thermal gas, making it possible to have a thermal gas that fills all space.
 And a black hole of sufficiently large mass in asymptotically Anti de Sitter spacetime has positive specific heat \cite{HawkingPage}.  So in asymptotically Anti de Sitter spacetime,
 one can have perfect equilibrium between a black hole and ambient radiation.  We will consider this case in sections \ref{negative} and  \ref{rbh}, because it provides a setting in which the quantum corrections
to a black hole equilibrium state can be studied seriously.
 It is worth mentioning, however, that in this situation, most of the entropy is in the black hole rather than the radiation; the
 stable state consists of a large black hole and, relatively speaking, not very much radiation.

\section{Thermodynamics of Rindler Space}\label{division}

\subsection{Making The Cut}\label{cut}

The essence of the Hawking effect is that even if the whole universe is in a pure state, the portion of the universe outside the horizon, which is what an outside observer
can see, is in a mixed state, which moreover has thermal properties.

The basic phenomenon actually arises in a simpler context.  There is a similar thermal behavior if one studies the vacuum state in Minkowski space from the
vantage point of an observer who only makes measurements in a Rindler wedge.\footnote{An analysis  along  the following lines was originally made by Unruh and Weiss \cite{UW}. The thermal
nature of Rindler space was first seen by other arguments \cite{U} that we come to later.}   A Rindler wedge is defined
by an inequality such as $x>|t|$ or $x<-|t|$, where in some Lorentz frame $t$ is the time and $x$ is one of the spatial coordinates.

However, we will begin the analysis with a Hamiltonian description on a spatial slice.
A quantum state can be defined on any Cauchy hypersurface $\S$, say the surface $t=0$ in Minkowski space.    For simplicity, consider the theory of a single real scalar field $\phi$.
A  quantum state defined on the hypersurface $\S$ can be regarded as a functional $\Psi(\phi(\vec x))$.  In what follows, we will study the vacuum state $\Omega$.
We  decompose the spatial coordinates $\vec x$ as $(x,\vec y)$,
where $x$ is one of the spatial coordinates and the others are combined into $\vec y$.

  \begin{figure}
 \begin{center}
   \includegraphics[width=4.8in]{Fig5.pdf}
 \end{center}
\caption{\footnotesize (a) A Euclidean path integral on the half-space $\te\leq 0$ 
that prepares the vacuum state $|\Omega\ra$. (b) To prepare the pure state density matrix $|\Omega\ra\la\Omega|$ associated to the vacuum, we prepare the ket $|\Omega\ra$
as just described by a path integral on the half-plane $\tE\leq 0$, and
we use a similar path integral on the half-space $\tE\geq 0$ to prepare the bra $\la\Omega|$. Two copies of the $x$ axis, appearing respectively as the boundary of the lower and upper
half-planes,  have been separated for visibility.  (c) To construct the reduced density matrix $\rho$ of the half-line $x>0$, we ``trace out'' the quantum fields
in the region $x<0$. In path integrals, this is accomplished by gluing together the two copies of the negative $x$ axis.   The result is a path integral on Euclidean space with a cut along $\te=0$, $x>0$.   The density matrix $\rho$ is a functional
of the fields just above and just below the cut.  \label{Five}}
\end{figure} 


The vacuum state $\Omega$ can be computed by a path integral on a half-space in Euclidean signature.   We set $t=-\i\te$ and integrate over the field $\phi(\te,\vec x)$  restricted to
the half-space $\te<0$, keeping fixed the boundary values $\phi(\vec x)$ at $\te=0$.  This integral, as a function of $\phi(\vec x)$, defines the vacuum wavefunctional $\Omega(\phi(\vec x))$
(fig. \ref{Five}(a)).

The projection operator onto the vacuum state is $\rho= |\Omega\ra \la\Omega|$. This can also be regarded as the density matrix associated to the pure state $\Omega$.   It is straightforward to construct
$|\Omega\ra\la\Omega|$ via path integrals.   First of all, just as we constructed the ket $|\Omega\ra$ by a Euclidean path integral on the lower half space $\te\leq 0$, we can construct the bra $\la\Omega|$ by a similar
Euclidean path integral on the upper half space $\te\geq 0$ (fig. \ref{Five}(b)).    We can thus view the pure state density matrix $\rho$ as a function of pairs of boundary values
\be\label{gurky}\rho(\phi;\phi') =|\Omega(\phi)\ra\la\Omega(\phi')|. \ee
Here $\phi$ is the boundary value of $\phi(\te,\vec x)$ on the upper boundary of the lower half plane, and $\phi'$ is the boundary value of $\phi(\te,\vec x)$ on the lower
boundary of the upper half plane.

Now suppose that we divide the $t=0$ surface $\S$ into the partial Cauchy surfaces $\S_r$ with $x\geq 0$ and $\S_\ell $ with $x\leq 0$.  Corresponding to this, we decompose\footnote{\label{notable}
At many points in discussing Rindler space and the Unruh effect, we make  statements that are oversimplified mathematically.   For example, it is not actually true in continuum quantum field theory that the Hilbert space has a factorization $\H=\H_\ell\otimes \H_r$ (nor is it a direct sum or integral of subspaces
with such a factorization); for a partial explanation of this fact, see the last paragraph of section
\ref{sample}.  The main difficulty here and in other statements involves short distance fluctuations near $x=0$.  Of course, with a lattice cutoff, there is such a factorization, but this spoils Lorentz invariance, which will be important in the derivation.  We also ignore the fact that $\phi_\ell$ and $\phi_r$ coincide
at $t=x=0$.   There is actually a rigorous
approach to the main results that we will obtain about Rindler space.
That approach uses
 Tomita-Takesaki theory, as applied to Rindler space  by Bisognano and Wichmann  \cite{BW} and extended to the black hole context  by Sewell 
  \cite{Sewell}.   For a gentle introduction, see \cite{Notes}, section 5.   The informal arguments
given in the text, however, are highly intuitive and arrive quickly at some important results.} 
 the field $\phi(\vec x)$
as a pair $(\phi_\ell,\phi_r)$ where $\phi_\ell$ is the restriction of $\phi$ to $\S_\ell$ and $\phi_r$ is the restriction of $\phi $ to $\S_r$.   Then we view the ground state wavefunction
as a function $\Omega(\phi_\ell,\phi_r)$.    We introduce a Hilbert space $\H_r$ of functions of $\phi_r$ and a Hilbert space $\H_\ell$ of functions of $\phi_\ell$.   Then formally
$\H=\H_\ell\otimes \H_r$ and in particular
$\Omega\in\H_\ell\otimes \H_r.$

We would like to construct the reduced density matrix of the vacuum state $\Omega$ for an observer who can measure $\phi_r$ only and not $\phi_\ell$.   
For this, we first write eqn. (\ref{gurky}) in more detail, with $\phi=(\phi_\ell,\phi_r)$ and $\phi'=(\phi_\ell',\phi_r')$:
\be\label{nurky}\rho(\phi_\ell,\phi_r;\phi'_\ell,\phi'_r)=|\Omega(\phi_\ell,\phi_r)\ra\la\Omega(\phi'_\ell,\phi'_r)|.\ee
Now to construct a density matrix that is appropriate for observations of $\phi_r $ only, we are supposed to sum over all values of the unobserved variables $\phi_\ell$.
To do this, we set $\phi_\ell=\phi'_\ell$ and integrate over $\phi_\ell$.   This gives the density matrix $\rho_r(\phi_r;\phi_r')$ appropriate for measurements of $\phi_r$:
\be\label{demorc} \rho_r(\phi_r;\phi_r')=\int D\phi_\ell \,|\Omega(\phi_\ell,\phi_r\ra \,\la\Omega(\phi_\ell,\phi_r')|. \ee

How do we represent $\rho_r$ by a path integral?   Before integrating over $\phi_\ell$, we had a pure state density matrix $\rho=|\Omega\ra\,\la\Omega|$ represented as a path
integral over all of Euclidean space but with a ``cut'' on the hyperplane $\S$ defined by $\te=0$ -- and thus with separate boundary values $\phi$, $\phi'$ below and above the cut.
To compute $\rho_r$  as defined in eqn. (\ref{demorc}) requires the following.  In the region $\S_\ell$, we constrain the boundary values above and below the cut to be equal and we integrate over those boundary values.
Geometrically, the effect of this is to glue together the upper and lower half spaces  along $\S_\ell$ and integrate over the value of $\phi$ there.  
We end up with a path integral on all of $\R^4$ except for
a cut along $\S_r$ (fig. \ref{Five}(c)).   The boundary values below and above the cut are $\phi_r$ and $\phi_r'$, and a path integral on  $\R^4$ with this cut and with fixed boundary
values above and below the cut computes the matrix element $\rho_r(\phi_r;\phi_r')$ of the density matrix $\rho_r$ of $\S_r$.

Similarly, a density matrix appropriate for measurements of $\phi_\ell$ only is
obtained by setting $\phi_r=\phi_r'$ in $\rho$ and integrating over $\phi_r$:
\be\label{demorco} \rho_\ell(\phi_\ell;\phi_\ell')=\int D\phi_r\,|\Omega(\phi_\ell,\phi_r\ra \,\la\Omega(\phi_\ell',\phi_r)|. \ee
It can be represented by a path integral on $\R^4$ with a cut along $\te=0$, $x<0$.

  \begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Fig6.pdf}
 \end{center}
\caption{\footnotesize  In Minkowski space, the left and right Rindler wedges $\RR_\ell$ and $\RR_r$ are defined as the domains of dependence of the partial Cauchy hypersurfaces
$\S_\ell$ and $\S_r$.   The diagonal lines mark the boundaries of $\RR_\ell$ and $\RR_r$; they are the past and future horizons of an observer
 who remains forever in $\RR_\ell$ or $\RR_r$ and limit the portion of spacetime that the observer can see or influence.
All past and future horizons meet at the bifurcation surface $\Sigma$,   which also marks the common boundary of $\S_\ell$ and $\S_r$.
The arrows indicate the action of the Lorentz boost generator $K$, which is future-directed timelike in $\RR_r$, past-directed timelike in $\RR_\ell$, and spacelike elsewhere.
   \label{Seven}}
\end{figure} 


The relation of all this to Rindler space is as follows.   In Lorentz signature, the  domain of dependence\footnote{\label{dod}In a Lorentz signature spacetime $M$, the domain of dependence
of a set $U$ is the largest set $D(U)$ such that a solution of a standard relativistic wave equation (such as the Klein-Gordon equation) in $D(U)$ is determined by initial data along $U$.
Equivalently, a point $p\in M$ is in $D(U)$ if and only if any causal curve through $p$, if continued far enough into the past and future, eventually meets $U$. This, along with relativistic causality,
implies that a signal observed at $p$ is determined by initial (or final) data on $U$.}
 of the partial Cauchy surface $\S_r$ is the ``right Rindler wedge'' $\RR_r$, defined
by $x>|t|$ (fig. \ref{Seven}).   Whatever is the quantum field theory we are studying, formally its equations of motion determine fields on $\RR_r$ in terms of initial data on $\S_r$.
Therefore any measurement in $\RR_r$ can be viewed as a measurement of $\phi_r$, and the density matrix $\rho_r$ can more covariantly be described as the density matrix
appropriate to measurements in $\RR_r$.   Similarly, the density matrix $\rho_\ell$ is appropriate to measurements in the opposite Rindler wedge $\RR_\ell$, defined by $x<-|t|$.

Following are a few important facts about  the geometry of Rindler space.   First of all, in order to remain for all times in the right Rindler
wedge  $R_r$, an observer must accelerate indefinitely in the future and also in the past, as in eqn. (\ref{unif}) below.   (This will lead to the Unruh effect, as we will discuss.)   The portions of the spacetime visible to such an observer are bounded by the past and future horizons of Rindler space, the diagonal lines in fig. \ref{Seven}.   Similarly, an accelerating observer who remains always in
$R_\ell$ experiences past and future horizons.   The past and future horizons of both observers  intersect at a codimension two surface $\Sigma$ known as the bifurcation surface or
entangling surface,\footnote{In classical general relativity, $\Sigma$ is called the bifurcation surface from which the left and right horizons bifurcate.  Quantum mechanically, it is sometimes 
called the entangling surface of the Rindler wedges $\RR_\ell$ and $\RR_r$, which are entangled across $\Sigma$.}  which
also marks the common boundary of $\S_\ell$ and $\S_r$.
Once we introduce the Penrose diagram of de Sitter space (fig. \ref{desitter}) and the Kruskal-Szekeres extension of Schwarzschild spacetime (fig. \ref{PenroseB}), it will be clear that all this has analogs for de Sitter space and for  a black hole. Indeed, Rindler space is
analogous to the near horizon region of a Schwarzschild black hole of mass $M$ in the limit $M\to\infty$, and to the region near the cosmological horizon in de Sitter space.  That is the reason for its importance.


  We note that $\RR_r$ and $\RR_\ell$ are each invariant
under boosts of the $x-t$ plane.   This symmetry has played no role  up to this point, but now that will change.

\subsection{Boosts and the Unruh Effect}\label{rindler}

The density matrix $\rho_r$ can be understood in another way by emphasizing the rotational symmetry of the $x-\te$ plane.   Actually, it is convenient to first  relate a rotation
in Euclidean signature to a boost in Lorentz signature.   In Lorentz signature, the generator of a boost of the $x-t$ plane is
\be\label{zboost} K=\int_{\S}\d x\d \vec y \, x T_{00}(x,\vec y),\ee
where $T_{00}$ is the energy density.   We can formally write\footnote{In the decomposition $K=K_r-K_\ell$, actually, because of short distance fluctuations near $x=0$, $K_\ell$ and $K_r$ make sense as quadratic
forms (which have matrix elements) but not as operators (which have eigenvectors and eigenvalues and can be measured).  See footnote \ref{notable}.}
\be\label{lboost}K=K_r-K_\ell,\ee
with 
\begin{align}\label{mboost}K_r & =\int_{\S_r}\d x \d\vec y \, xT_{00}(x,\vec y) \cr
                                          K_\ell & =\int_{\S_\ell}\d x \d\vec y \, |x|T_{00}(x,\vec y), \end{align}
 where $K_r$ generates a Lorentz boost of $\phi_r$ and $K_\ell$ generates a Lorentz boost of $\phi_\ell$.
  $K_r$ generates a Lorentz boost of the right Rindler wedge $\RR_r$ and commutes with operators in the spacelike separated wedge
    $\RR_\ell$, while $K_\ell$ generates a Lorentz boost of $\RR_\ell$ and commutes
 with operators in $\RR_r$.  A minus sign was included in eqn. (\ref{lboost}) so that $K_r $ and $K_\ell$ each boost the corresponding Rindler wedge forward in time.   
 There is an additive ambiguity in the definition of $T_{00}$, and we assume this has been fixed so that the vacuum energy density vanishes; otherwise the integrals defining
 $K_\ell$ and $K_r$ diverge.

 
   \begin{figure}
 \begin{center}
   \includegraphics[width=4.4in]{Fig7.pdf}
 \end{center}
\caption{\footnotesize  (a)  A path integral on an angular wedge of angle $\theta$.   This
path integral is generated by the operator $\exp(-\theta K_r)$, where in Minkowski space, $K_r$ generates a boost of $\phi_r$ and commutes with $\phi_\ell$.  
(b)  Setting $\theta=2\pi$ gives the path integral of fig. \ref{Five}(c)) on the whole plane with a cut on the positive $x$ axis.  Similarly, setting $\theta=\pi$ gives the path integral of fig. \ref{Five}(a) that prepares the 
ground state.
   \label{Eight}}
\end{figure} 

 The operator $e^{-\i\eta K_r}$, with real $\eta$, acts on $\phi_r$ by a Lorentz boost with boost parameter $\eta$.   If we set $\eta=-\i\theta$, the Lorentz boost turns into a
 rotation and we get the operator $\exp(-\theta K_r)$ that in Euclidean signature rotates the $x-\te$ plane by an angle $\theta$.   In terms of path integrals,
 this means that to compute a matrix element of $\exp(-\theta K_r)$ acting on $\phi_r$, we need to perform a path integral on a wedge of opening angle $\theta$
 (fig. \ref{Eight}(a)).  If we simply set $\theta=2\pi$ (fig. \ref{Eight}(b)), the wedge of opening angle $\theta$ becomes the cut plane of fig. \ref{Five}(c).  Therefore, we get a formula for the density matrix $\rho_r$:
 \be\label{zilbo}\rho_r=\exp(-2\pi K_r). \ee
 Likewise,
 \be\label{nilbo} \rho_\ell=\exp(-2\pi K_\ell). \ee
 Let us verify that these candidate density matrices are properly normalized to satisfy  $\Tr\,\rho=1$.   Formally, $\Tr\,\exp(-2\pi K_r)$
 (or equally well $\Tr\,\exp(-2\pi K_\ell)$)
 is given by a path integral on the whole plane.   That path integral equals 1, given that the energy-momentum tensor of the theory has been renormalized so that its
 vacuum expectation value vanishes (as was assumed in the definition of $K_r$ and $K_\ell$).
 
The result for $\rho_r$ can be interpreted to mean that if we view $K_r$ as a sort of Hamiltonian of the right Rindler wedge $\RR_r$, then the density matrix $\rho_r$ is thermal
at inverse temperature $2\pi$.   A manifestation of this is the Unruh effect \cite{U} -- an observer in Minkowski space who undergoes constant acceleration (for all time) will
observe thermal correlations.    An example of a uniformly accelerated trajectory is
\be\label{unif} t=L\sinh \frac{\tau}{L},~~ x =L\cosh\frac{\tau}{L},~~\vec y=0, \ee
where $\tau$ is the proper time of the observer, and $1/L$ is the magnitude of the acceleration.   Any uniformly accelerated orbit in Minkowski space has this form for some choice of  Rindler
wedge and some $L$.   The  Lorentz boost generator $K_r$ acts on this orbit as $L\frac{\d}{\d \tau}$, so the observer could interpret $K_r$ as $L$ times the natural Hamiltonian.
Indeed the definition (\ref{mboost}) for $K_r$ shows that for observations near $x=L$, $K_r$ can be approximated as $L H$ where $H=\int_{\S_r}\d x \d\vec y \,T_{00}$ is
the Hamiltonian acting on the right Rindler wedge.

A quick way to become comvinced that the observations of such an observer will be thermal is to continue the orbit to Euclidean signature.  In Euclidean signature,
with  $t=\i \tE$, $\tau=\i \tau_E$, the orbit becomes
\be\label{zunif} \tE=L\sin\frac{\tau_E}{L},~~x=L\cos\frac{\tau_E}{L} ,~~\vec y=0.\ee
This orbit is periodic in $\tau_E$ with period $2\pi L$, suggesting that the observer will see thermal correlations at temperature $1/2\pi L$.   This can be justified rigorously
by showing that the correlations measured along the Lorentz signature orbit (\ref{unif}) satisfy the KMS condition that characterizes thermal correlations.   See for example
section 5.4 of \cite{Notes}.   The formula $1/2\pi L$ for the temperature has a natural interpretation.   From the observer's point of view, $K_r$ is interpreted, as noted earlier,
 as $LH$, with $H$ the relevant Hamiltonian, so the formula (\ref{zilbo}) becomes $\rho_r=\exp(-2\pi L H)$, leading naturally to thermal correlations at temperature $1/2\pi L$.
 
 Thus, we have learned that from the standpoint of a uniformly accelerated observer, or for observations restricted to one Rindler wedge, the vacuum state
of Minkowski space appears to be thermal with an appropriate Hamiltonian and temperature. The temperature is inversely proportional to the distance from the edge of 
the Rindler wedge at the bifurcation surface $\Sigma: x=t=0$, so it diverges near $\Sigma$ and vanishes near infinity.    Though the reasoning was slightly heuristic,
the conclusions can actually be justified by verifying the KMS condition for correlators. 
 
 After developing the Euclidean approach to black hole thermodynamics in section \ref{euclidean}, we will be able to give a precisely parallel derivation of the thermal nature
 of the black hole spacetime.    In a way, the main difference is that in the case of the black hole, the temperature measured at infinity does not vanish but equals the Hawking temperature
 of the black hole.
 A noteworthy fact about the derivation that we have given for Rindler space, and the corresponding derivation that we will eventually give for the black hole, is that it requires
 no assumptions whatsoever about the quantum field theory under consideration.    Arbitrary non-gravitational forces may be present. 
  (The assumption that the theory can be characterized by just one scalar field $\phi$ was purely
 for notational convenience.) 
  By contrast, the derivation of black hole evaporation in section \ref{bhevaporation} ignored non-gravitational forces.
                                  
\subsection{The Thermofield Double}\label{another}

For some Hilbert space $\H$, let  $\rho:\H\to \H$ be a density matrix. Recall that in general a density matrix is simply a positive (or non-negative) matrix with trace 1.
  A {\it purification} of $\rho$ is a pure state $\Psi\in\H\otimes\H'$, for some Hilbert space $\H'$, such that $\rho$ is the induced density matrix of the pure
state density matrix $|\Psi\ra\la\Psi|$ on $\H\otimes \H'$:
\be\label{tellmex}\rho=\Tr_{\H'}|\Psi\ra\la\Psi|. \ee

Every density matrix has a canonical purification.   For this, note first that if $\K$ is a vector space and $\V:\K\to\K$ is a linear transformation, then with
respect to a basis we can expand
\be\label{anytrans}\V=\sum_{i,j}v_{ij}|i\ra \la j|.\ee
Given this, we can associate to $\V$ a vector $\Psi_\V$ in a doubled Hilbert space $\K\otimes \K'$: 
\be\label{zvector}  \Psi_\V=\sum_{i,j}v_{ij}|i\ra\otimes |j\ra' .\ee
Here $\K'$ is the complex  conjugate Hilbert space of $\K$, meaning that to each bra $\la j|$ of $\K$ there is canonically associated
a ket $|j\ra'\in \K'$.   Tracing out $\K'$ from the pure state density matrix $|\Psi_V\ra\la\Psi_\V|$, we get
\be\label{nvector}\V \V^\dagger=\Tr_{\K'}|\Psi_\V\ra \la\Psi_\V|.\ee
In particular, if $\Tr\,\V \V^\dagger=1$, so that $\V \V^\dagger$ is a density matrix, then $\Psi_\V$ is a purification of this density matrix.

This enables us to define the canonical purification of a density matrix.   If $\rho$ is any density matrix, then it is
the square of $\rho^{1/2}$.  So $\Psi_{\rho^{1/2}}\in \H\otimes \H'$ is a purification of $\rho$, called the canonical
purification.  

For an important example, consider the thermal density matrix of a system with Hilbert space $\H$ and Hamiltonian $H$ at inverse
temperature $\beta$:
\be\label{dongo} \rho=\frac{1}{Z}\sum_i e^{-\beta E_i}|i\ra \la i|,\ee
where $|i\ra$ are the energy eigenstates with energies $E_i$ and $Z$ is the partition function.   
The canonical purification of a thermal density matrix   is then the state in $\H\otimes \H'$ associated to $\rho^{1/2}$:
\be\label{wongox}\Psi_\TFD=\frac{1}{\sqrt Z}\sum_i e^{-\beta E_i/2}|i\ra\otimes |i\ra'. \ee
This state is also called the {\it thermofield double}.
In general, $\H'$ is the complex conjugate of $\H$, but in  the case of a system with an antilinear time-reversal symmetry whose square is 1, the distinction between $\H$ and $\H'$ is unimportant.
This is often implicitly assumed in  discussions of the thermofield double.
 
The canonical purification of the thermal density matrix $\rho=e^{-2\pi K}$ of Rindler space is $\rho^{1/2}=e^{-\pi K}$.
 This operator is associated to the path integral of fig. \ref{Eight}(a) for the case that the wedge has opening angle $\pi$.   But a wedge of
 opening angle $\pi$ is just a half-plane.   So for this particular value of the angle, the path integral of fig. \ref{Eight}(a) actually reduces to the half-plane path integral
 that we started with in fig. \ref{Five}(a).  The state constructed by the path integral of fig. \ref{Five}(a) is simply the vacuum state $\Omega\in \H_\ell\otimes \H_r$.
 So we learn that the Minkowski space vacuum vector $\Omega$ can be interpreted as the thermofield double state of Rindler space.     In sections \ref{cosmo} and  \ref{thermofield},
 we will describe the analogous statements for de Sitter space and for a Schwarzschild black hole.
 
 To clear up one last detail in this derivation, every quantum field theory has a $\sf{CRT}$ symmetry (charge conjugation $\sf C$ combined with a spatial reflection $\sf R$
 and time-reversal $\sf T$) that exchanges the left and right Rindler wedges and exchanges $\H_\ell$ with $\H_r'$.  (Because $\sf{CRT}$ is antilinear, it exchanges $\H_\ell$
 with $\H_r'$, not $\H_r$.)   So instead of $\H_r\otimes \H_\ell$,  the vacuum vector $\Omega$ can be viewed as a vector in $\H_r\otimes \H_r'$, the expected home of the thermofield double state.
 
 Because it is an important example and
 will be useful in section \ref{anview}, we will work out  the thermofield double state for a bosonic or fermionic harmonic oscillator.  First we consider an ordinary bosonic
 harmonic oscillator with  creation and annihilation
 operators $\a^\dagger$, $\a$ satisfying $[\a,\a^\dagger]=1$ and Hamiltonian $H=\omega \a^\dagger \a$.
 A thermal density matrix at inverse temperature $\beta$ is
 \be\label{zeldo}\rho=\frac{1}{Z}\sum_{n=0}^\infty e^{-n\beta \omega }|n\ra\la n|\ee
 where $|n\ra$ is the $n^{th}$ excited state. The thermofield double state is 
 \be\label{weldo}\Psi_\TFD=\frac{1}{\sqrt Z}\sum_{n=0}^\infty e^{-n\beta\omega/2}|n\ra\otimes |n\ra'. \ee
 Here $|n\ra'$ is the $n^{th}$ excited state of an identical  second harmonic oscillator with creation and annihilation operators $\a'$, $\a'{}^\dagger$.   
Now using $\a^\dagger|n\ra =\sqrt{n+1}|n+1\ra$, etc., we find
\be\label{zoffo}\left(\a^\dagger-e^{\beta \omega/2}\a'\right)\Psi_\TFD = \left(\a-e^{-\beta\omega/2}\a'{}^\dagger\right)\Psi_\TFD =0 . \ee
Moreover, these conditions uniquely determine $\Psi_\TFD$ up to a scalar multiple.
The fermionic analog of these formulas  contains an extra minus sign associated to fermi statistics.
We  consider fermionic creation and annihilation operator $\c,$ $ \c^\dagger$, with $\{\c,\c^\dagger\}=1$, acting on a two-dimensional
Hilbert space with basis consisting of a state $|0\ra$ with $\c|0\ra=0$ and another state $|1\ra=\c^\dagger|0\ra$.   Assuming a Hamiltonian $H=\omega \c^\dagger \c$,
the thermal density matrix is $\rho=\frac{1}{Z}\left(|0\ra\la0|+e^{-\beta \omega}|1\ra\la 1|\right)$.   To construct the thermofield double, we introduce
 a second identical fermionic oscillator with creation and
annihilation operators $\t \c^\dagger $, $\t\c$ that anticommute with $\c,\c^\dagger$.  These operators can be represented in a four-dimensional Hilbert space with a state
$|0,0\ra$ annihilated by both $\c$ and $\t \c$ and additional states $|1,0\ra=\c^\dagger|0,0\ra$, $|0,1\ra=\t\c^\dagger|0,0\ra$, $|1,1\ra =\c^\dagger \t\c^\dagger|0,0\ra$.
The thermofield double state is then
\be\label{wendo}\Psi_\TFD =\frac{1}{Z^{1/2}}\left( |0,0\ra+e^{-\beta\omega/2}|1,1\ra\right), \ee
and satisfies
\begin{align}\label{lendo} \left( \c-e^{-\beta\omega/2} \t\c^\dagger\right)\Psi_\TFD &=0 \cr
                          \left(\c^\dagger+ e^{\beta\omega/2} \t\c\right)\Psi_\TFD&=0.\end{align} 

\subsection{Another View Of The Thermofield Double}\label{anview}

There is  another interesting way, going back to \cite{U}, to show that the vacuum vector $\Omega$ in Minkowski space is the 
 thermofield double state  of the Rindler wedge. This explanation is limited to free field theory, in contrast to the far more general approach that we have
already presented, but  it is illuminating.
  However, for brevity, we will only consider the case of a  chiral free fermion in two spacetime dimensions.
The idea is to show that the vacuum state  obeys conditions that correspond to eqn. (\ref{lendo}).

Consider  two-dimensional Minkowski space with metric $\d s^2=-\d t^2+\d x^2=-2 \d u \d v$, where $v=\frac{1}{\sqrt 2}(t+x)$, $u=\frac{1}{\sqrt 2}(t-x)$ are null coordinates.
The operator $P$ that generates a translation of  $v$ is positive-definite,
annihilating only the vacuum, and satisfies
\be\label{hudo} [P,\O]=-\i \frac{\d}{\d v}\O \ee
for any operator $\O$. 
Consider a hermitian chiral free fermion $\lambda(v)$ satisfying
\be\label{telgo} \{\lambda(v),\lambda(v')\}=\delta(v-v'). \ee
If $\Lambda_\omega=\int_{-\infty}^\infty \d v \,e^{-\i \omega v}\lambda(v)$, then
\be\label{elgo}\{\Lambda_\omega,\Lambda_{\omega'}\} =2\pi \delta(\omega+\omega').\ee
We have
\be\label{ifto} [P,\Lambda_\omega]=\omega \Lambda_\omega,\ee
so operators $\Lambda_\omega$ are creation operators for $\omega>0$ and annihilation operators for $\omega<0$.
To be more precise, these operators are creation and annihilation operators with respect to the Minkowski vacuum
or equivalently they are raising and lowering operators with respect to $P$.

The annihilation operators annihilate the vacuum:
\be\label{hudu} \Lambda_\omega \Omega =0,~~~\omega<0.\ee
More generally, any operator
\be\label{udu}\Lambda'_f=\int_{-\infty}^\infty \d v \,f(v)\lambda(v) \ee
annihilates the vacuum if  the function $f(v)$ is holomorphic and bounded in the upper half $v$-plane.
Indeed, a square-integrable function $f(v)$ is holomorphic and bounded  in the upper half plane if and only if
 \be\label{plunker} f(v)=\int_{-\infty}^0 \d\omega e^{-\i \omega v} g(\omega)\ee
  for some square-integrable function $g(\omega)$;
 the Fourier components of $f(v)$ with $\omega>0$ must be absent, as $e^{-\i\omega v}$ grows exponentially
 in the upper half $v$-plane if $\omega>0$.  But eqn. (\ref{plunker}) implies that $\Lambda'_f$ is a linear combination
 of annihilation operators.


Now let us take the perspective of an observer in  the right Rindler wedge $\RR_r$ defined by $x>|t|$ or $v>0$, $u<0$. 
The Killing vector field that generates a Lorentz boost of the $u-v$ plane is  $k=v\partial_v -u\partial_u$. It generates a symmetry of the right Rindler wedge
 and is future-directed timelike in the wedge.   As before, let $K$ be the hermitian conserved charge associated to $k$.
It is with respect to $K$  that correlations in the Rindler wedge have thermal properties.
So it is natural for an observer in the right Rindler wedge  to decompose the field $\lambda(v)$ in raising and lowering operators with respect to $K$.

  Acting on the chiral fermion field $\lambda(v)$, $k$ reduces to $v\partial_v$,
 and the corresponding conserved charge $K$ acts by
$[K,\lambda(v)]=-\i \left(v\partial_v+\frac{1}{2}\right) \lambda(v)$ (where the $+\frac{1}{2}$ reflects the fact that $\lambda$ has spin $\frac{1}{2}$).  
  An observer in $\RR_r$ measures $\lambda(v)$ only for $v>0$.
So\footnote{The functions $v^{-\i\omega-\frac{1}{2}}$ are delta function normalizable on the half-line $v\geq 0$.}
\be\label{omexo} U_\omega=\int_0^\infty \d v \,v^{-\i\omega-\frac{1}{2}} \lambda(v) \ee
is supported in the wedge $\RR_r$ and 
satisfies
\be\label{Nome} [K,U_\omega]= \omega U_\omega.\ee 
Hence, with respect to $K$, $U_\omega$ is a raising operator, or a creation operator,  if $\omega>0$ and a lowering operator, or an
annihilation operator, if $\omega<0$.
Moreover
\be\label{tellme}U_\omega^\dagger = U_{-\omega}. \ee


However, regardless of $\omega$, $U_\omega$ does not annihilate the Minkowski space vacuum state $\Omega$, since the
function
\be\label{dimo}f(v)=\begin{cases} v^{-\i\omega-\frac{1}{2}} & v>0\cr 0 & v<0 \end{cases}\ee
is not holomorphic in the upper half $v$-plane.
To get an annihilation operator for the Minkowski vacuum that is equivalent to $U_\omega,~\omega<0$ for observations in the right Rindler wedge, we need to modify $f(v)$ to be non-zero for $v<0$ in such a way that
$f(v)$ becomes holomorphic and  bounded in the upper half-plane.   A function that coincides with $f(v)$ for $v>0$
and is holomorphic and bounded in the upper half $v$-plane is $(v+\i\epsilon)^{-\i\omega-\frac{1}{2}}$.  
Here $\epsilon$ is
an infinitesimal positive quantity; a limit $\epsilon\to 0^+$ is understood.    The boundedness in the upper half plane holds for either sign of $\omega$.
 Hence, for all $\omega$, 
\be\label{comexo} V_\omega =\int_{-\infty}^\infty \d v (v+\i\epsilon)^{-\i\omega -\frac{1}{2}} \lambda(v)\ee
is an annihilation operator with respect to the Minkowski vacuum. 


We have
\be\label{miliko} \lim_{\epsilon\to 0^+} (v+\i\epsilon)^{-\i\omega-\frac{1}{2}} = \begin{cases}v^{-\i\omega-\frac{1}{2}} & v>0\cr
                                           -\i e^{\pi\omega} \bar v^{\,-\i\omega-\frac{1}{2}} & v<0,\end{cases}\ee
                                           where $\bar v=-v$.   
Now  define  
\be\label{niliko}\t U_\omega=\begin{cases}    \i  \int_0^\infty \d\bar v\,\bar v^{\i\omega-\frac{1}{2}} \lambda(\bar v)    &\omega <0\cr
                                                                       - \i \int_0^\infty \d\bar v\,\bar v^{\i\omega-\frac{1}{2}} \lambda(\bar v)    &\omega >0,\end{cases}\ee
 so that in particular $\t U_\omega^\dagger=\t U_{-\omega}$, in parallel with eqn. (\ref{tellme}).   The prefactors $\i$ and $-\i$ in eqn. (\ref{niliko}) are
 inessential conventions chosen to agree in a sense that will soon be clear
 with the conventions that were used earlier in analyzing a fermionic oscillator.
 More important is that relative to eqn. (\ref{comexo}), we have reversed the sign of $\omega$ in the exponent.   The reason 
is that $v$ increases toward the future in  $\RR_r$, but $\bar v$ increases toward the past in 
 $\RR_\ell$.  Hence the sign reversal is needed if  we want $\t U_\omega$ to look  in $\RR_\ell$ like a creation operator  
  if $\omega>0$ and an annihilation operator if $\omega<0$.
  With these definitions, we see that
  \be\label{zelme}V_\omega=\begin{cases} U_\omega -e^{\pi\omega} \t U_{-\omega}=U_\omega-e^{\pi\omega}\t U_\omega^\dagger & \omega<0\cr                                                                 
    U_\omega +e^{\pi\omega} \t U_{-\omega}=U_\omega+e^{\pi\omega}\t U_\omega^\dagger & \omega>0.  \end{cases}\ee
    We can now confirm that $\Omega$ is the thermofield double state with respect to the right wedge $\RR_r$ at inverse temperature
    $\beta=2\pi$:     the statement that $V_\omega\Omega=0$ for $\omega<0$ matches the first condition in eqn. (\ref{lendo}), and the statement that
    $V_\omega\Omega=0$ for $\omega>0$ matches the second one.




\section{Euclidean Approach To Black Hole Thermodynamics}\label{euclidean}

\subsection{Continuing to Euclidean Signature}\label{disappears}

Gibbons and Hawking \cite{GH}, following earlier work of Hartle and Hawking \cite{HH}, discovered a remarkable alternative approach to black hole thermodynamics based on a continuation to Euclidean signature.   Despite the power of this approach,
we have chosen to present first the Lorentz signature derivation of sections \ref{bhevaporation} and \ref{graybody}, because in that framework the underlying physical principles
are clear.   The Euclidean approach is remarkably powerful and successful, but its foundations are less clear.

The starting point is simply to continue the Schwarzschild metric
\be\label{schwarz}\d s^2=-\left(1-\frac{2 G M}{r}\right)\d t^2+\frac{\d r^2}{1-\frac{2 GM}{r}}+r^2\d\Omega^2\ee
to Euclidean signature by setting $t=-\i \tE$.   We get the Euclidean signature metric
\be\label{eucl}\d s^2=\left(1-\frac{2 G M}{r}\right)\d \tE^2+\frac{\d r^2}{1-\frac{2 GM}{r}}+r^2\d\Omega^2.\ee
Fundamentally, the reason that the simple definition $t=-\i \tE$ leads to a real metric in Euclidean signature is the following.
The Schwarzschild metric is real for real $t$, so if $t$ is regarded as a complex variable, then the Schwarzschild metric is complex conjugated under $t\leftrightarrow \bar t$.
This corresponds in terms of $\tE$ to $\tE \leftrightarrow  -\bar \tE$.   The fact that this operation complex conjugates the metric  does not imply that the metric is real for real  $\tE$.
But the Schwarzschild metric is invariant under the  time-reversal symmmetry $t\leftrightarrow -t$, so it is also complex conjugated by the 
combined action of time-reversal and   complex conjugation  of $t$.  The combined  operation is 
$t\leftrightarrow -\bar t$, or $\tE \leftrightarrow \bar \tE$. The fact that this operation complex conjugates the metric does indeed imply  that the metric is real for real $\tE$.

 Gibbons and Hawking made the remarkable discovery that the Euclidean version of the Schwarzschild metric is perfectly
smooth, complete,  and singularity-free if $\tE$ is interpreted as an angular variable 
and the horizon at $r=2GM$ is interpreted as the origin of polar coordinates.
To see this, let 
\be\label{defrho}{\t r}=4GM\left(1-\frac{2GM}{r}\right)^{1/2}. \ee
The metric is then
\be\label{nefto} \d s^2 = \frac{{\t r}^2\d\tE^2 }{(4GM)^2} + \left(\frac{r}{2GM}\right)^4 \d {\t r}^2 +r^2\d\Omega^2.\ee
Near $r=2GM$, this reduces to
\be\label{wefto} \d s^2 =  \frac{{\t r}^2\d\tE^2 }{(4GM)^2}+\d{\t r}^2 +(2GM)^2\d\Omega^2. \ee
Here we have the product of a two-manifold with metric
\be\label{efto}  \frac{{\t r}^2\d\tE^2 }{(4GM)^2}+\d{\t r}^2 \ee
with a two-sphere of metric $(2GM)^2\d\Omega^2$ and thus radius $2GM$.   
Comparing (\ref{efto}) to the metric of a plane in polar coordinates, namely $\d{\t r}^2+{\t r}^2\d\theta^2$, where $\theta\cong \theta+2\pi$,
we see that the metric (\ref{efto}) is perfectly smooth  if $\tE$ is a periodic variable 
\be\label{pervar}\tE\cong \tE+8\pi GM, \ee
and the circle parametrized by $\tE$ collapses to a point at ${\t r}=0$.   If we assume any other period for $\tE$, then the metric (\ref{efto}) has a conical singularity at the origin.
A metric with this conical singularity does not satisfy Einstein's equations, so if we want to get a complete, smooth metric satisfying Einstein's equations, we have to take
$\tE$ to be periodic precisely with period $\beta_\sH=8\pi GM$.




Notably, the required period of $\tE$ is precisely the inverse of the Hawking temperature $T_\sH=1/8\pi GM$, and equivalently the periodicity
$\tE\to \tE+8\pi GM$ precisely corresponds to the periodicity in imaginary time $t\to t+8\pi GM\i$ that appeared in our derivation in section \ref{bhevaporation}.
Thus the black hole solution is in this sense periodic in imaginary time.   Periodicity in imaginary time is a hallmark of thermal correlations, and the idea of 
Gibbons and Hawking was that the thermal nature of a black hole reflects the fact that the black hole solution is itself periodic in imaginary time.

Since $r$ is positive everywhere in the Euclidean Schwarzschild space, replacing the term $r^2 \d\Omega^2$ 
in the metric
(\ref{eucl})
with $C\d\Omega^2$ (for an arbitrary constant $C$)  does
not change the topology.  After that replacement, the metric is the sum of a metric on $\R^2$ and a metric on $S^2$. Therefore, topologically, the Euclidean Schwarzschild spacetime
is isomorphic to $\R^2\times S^2$.


For $r\to\infty$, the Euclidean Schwarzschild metric  reduces to 
\be\label{flatmetric} \d s^2= \d\tE^2+\d r^2+r^2 \d\Omega^2.\ee
Since $\d r^2+r^2\d\Omega^2$ is just the flat metric on $\R^3$ written in spherical polar coordinates, the metric (\ref{flatmetric}) is the standard product flat metric
on $\R^3\times S^1_{\beta_\sH}$, where $S^1_{\beta_\sH}$ is a circle of circumference $\beta_\sH=\frac{1}{T_\sH}= 8\pi GM$.

In ordinary quantum field theory without gravity, a thermal ensemble on a spatial manifold $\R^3$ at inverse temperature $\beta$ can be studied by a path integral
on $\R^3\times S^1_\beta$.    In gravity, if one expands around the classical solution $\R^3\times S^1_\beta$, then at one-loop order one will find the thermodynamics of
a gas of free gravitons (and other particles if fields other than the gravitational field are present) at inverse temperature $\beta$; higher order corrections will describe interactions, and will also reveal the instabilities described in section \ref{unstable}.  Since this thermal gas arises as a one-loop effect, the resulting entropy and energy densities are of order $G^0$ (as opposed to the Bekenstein-Hawking
entropy of a black hole, which is of order $G^{-1}$).
The Euclidean black hole solution looks like $\R^3\times S^1_{\beta_\sH}$ at big distances, but also contains, of course, a Euclidean version of a black hole in the interior.
The proposal of Gibbons and Hawking was that by expanding around this solution, we would get a description of a black hole interacting with  a gas of thermal radiation.
Since  the relevant value of $\beta$ for the Euclidean black hole solution is precisely the inverse temperature  $\beta_\sH$ of the black hole, the black hole and the radiation have the same
temperature and will be in equilibrium (modulo the usual instabilities).

The partition function, expanded in perturbation theory, will be schematically
\be\label{perfn} Z= e^{-I_\BH} \frac{1}{\sqrt{\det} }\left(1+\cdots\right). \ee
Here $I_\BH$ is the action of the classical black hole solution, $1/\sqrt{ \det}$ schematically represents the one-loop correction, and $\cdots$ represents effects of   two-loop order and higher.
Classical black hole thermodynamics as developed by Bekenstein and Hawking is supposed to appear in $I_\BH$.  The one-loop correction is supposed to give us a thermal
gas of gravitons (and possibly other particles) 
at the Hawking temperature, and their interaction with the black hole.   The higher order corrections will, among other things, describe interactions among
the gravitons, and generate an instability.   

Let us discuss concretely how to extract the black hole thermodynamics from the classical action.   In general, the partition function $Z$ of a thermal system at inverse temperature $\beta$
is interpreted as
$e^{S-\beta E}$, where $S$ is the entropy and $E$ is the energy.   Alternatively, $Z=e^{-\beta F}$, where $F=E-TS$ is the free energy.  Using the first law $\d E=T \d S$, there follows
a well known relation between the entropy and the partition function:
\be\label{Boxy}S=\left(1-\beta\frac{\d}{\d \beta}\right)\log Z.  \ee
In the classical limit, $Z$ is approximated as $e^{-I_\BH}$, so the formula for the entropy is
\be\label{oxy} S=-\left(1-\beta\frac{\d}{\d \beta}\right)I_\BH. \ee

In section \ref{action}, we will compute $I_\BH$ and compare the resulting expression for $S$ to the Bekenstein-Hawking formula.   In section \ref{acomp}, we will make
that comparison in another way.    But even without any of those computations, we can now fill a gap in the logic in section \ref{gsl}.   There, we recalled that Bekenstein was looking
for a nondecreasing quantity that could represent the entropy of a black hole, and, motivated by the Hawking area theorem, which says that the area $A$ of the black hole horizon
is nondecreasing, suggested that the black hole entropy is a constant multiple of the dimensionless quantity
$A/G$.      But from that point of view, any nondecreasing function of $A/G$, such as $(A/G)^2$, would
seem equally plausible.   Why is the entropy precisely a linear function of $A/G$?   Here we simply note that as the Einstein action is proportional to $1/G$, in particular
$I_\BH$ will be a multiple of $1/G$, so if the entropy defined as in eqn. (\ref{oxy}) is going to be a function of $A/G$, it will indeed have to be a constant multiple of $A/G$.
This was Bekenstein's original proposal, though certainly not the original logic.


\subsection{Computing the Action}\label{action}

Computing the Euclidean black hole action $I_\BH$ is not as straightforward as it sounds.  The usual Einstein-Hilbert action on a manifold $M$ of  Euclidean signature is
\be\label{zofo} I_\EH=-\frac{1}{16\pi G} \int_M \d^4x \sqrt g R. \ee
This vanishes in any classical solution of the associated field equations $R_{\mu\nu}=0$, since those  equations imply $R=0$.   

However, this usual form of the action has to be extended by adding the Gibbons-Hawking-York (GHY) boundary term \cite{GH,Y}.  This is necessary because $R$ depends on second
derivatives of the metric.   To understand why that is consequential, let us practice with the simple example of a free particle.   The standard action of a free particle is $I_1=\frac{1}{2}\int\d t \,\dot x^2$.
However, we could derive the same equation of motion from another action such as $I_2=-\frac{1}{2}\int \d t\,x \ddot x.$   Why is $I_1$ better than $I_2$?
 Let us derive the equations of motion from the naive action $I_2$, but on a finite time interval
$[t_1,t_2]$ and with boundary conditions in which the value of $x$ is specified at the endpoints, 
so that the variation of $x$ satisfies 
\be\label{gifme} \delta x(t)=0~{\rm for}~t=t_1,t_2.\ee   Generically, the specified values of $x$ at the endpoints are nonzero, $x(t_1),x(t_2)\not=0$.
We find $\delta I_2=-\int_{t_1}^{t_2}\d t \,\delta x \ddot x-\frac{1}{2}\left[ \delta \dot x \, x\right]_{t_1}^{t_2}.$   Vanishing of the bulk term gives the expected bulk equation of motion
$\ddot x=0$, but vanishing of the second term would give $x(t_1)=x(t_2)=0$.  Thus, the action $I_2$ will only work if we want the specified boundary values of $x$ to vanish.
 That restriction is avoided
for $I_1$: $\delta I_1=-\int_{t_1}^{t_2}\d t \,\delta x \ddot x$, given the boundary condition (\ref{gifme}).
We can also avoid the problem by adding a boundary term to $I_2$ and defining
  \be\label{blogo}I_2'=I_2 +\frac{1}{2} \left[ x\dot x\right]^{t_2}_{t_1} . \ee
The quickest way to verify that this avoids the problem is to observe that after integrating by parts, $I_2'=I_1=\frac{1}{2}\int_{t_1}^{t_2}\d t \dot x^2.$   Thus
adding this particular boundary term has compensated for a non-optimal choice of the bulk action.

The same problem arises for gravity if we study gravity on a manifold $M$ with boundary $\partial M$, with Dirichlet boundary conditions that specify the metric on $\partial M$.
Varying the naive action $I_\EH$ with respect to the metric, one obtains the expected Einstein equations in bulk, but because $I_\EH$ depends on second derivatives of the metric
one also finds an unwanted equation on the boundary which would
make the theory inconsistent (for a generic choice of the assumed boundary metric).    
General relativity is the rare example of a theory in which it is not possible in a covariant fashion to avoid the issue by integrating by parts 
and using a different bulk action.   However, one can avoid the problem by adding a boundary term to the action, namely the GHY boundary term
\be\label{nlogo} I_\GHY=-\frac{1}{8\pi G}\int_{\partial M} \d^3x \sqrt h \,K, \ee
where $K$ is the trace of the extrinsic curvature of $\partial M$, defined in the next paragraph.   The extended action \be\label{exteh} I'_\EH=I_\EH+I_\GHY\ee
 is analogous to
$I_2'$ for the free particle: it leads to a sensible variational problem, with no boundary term in the equations of motion.

To define $K$,  we introduce some conventions.   Local coordinates of  $\partial M$ will be denoted
 $x^i$, $i=1,\dots,3$ and local coordinates of $M$ near $\partial M$ will be denoted as $x^i$ and $y$, where $y=0$ on $\partial M$ and $y>0$ in a neighborhood of $\partial M$. Let
 $h_{ij}$ be the restriction to $\partial M$ of the metric $g$ of $M$.   Let $n$ be the  outward directed
 unit normal to $\partial M$ in $M$.   The extrinsic curvature of $\partial M$ is defined by $K_{ij}=D_i n_j$ and its trace is $K=h^{ij} K_{ij}$.
In Euclidean signature, the definition of $I_\GHY$ is then
\be\label{nlogox} I_\GHY=-\frac{1}{8\pi G}\int_{\partial M} \d^3x \sqrt h K. \ee

Near $\partial M$, it is always possible to put the metric of $M$ in the form
\be\label{thef} \d s^2=\d y^2+h_{ij}(x,y) \d x^i \d x^j.\ee    The outward directed unit normal to $\partial M$ is then
$n=-\partial_y$, 
so  $K_{ij}=-\frac{1}{2}\partial_y h_{ij}(x,y)|_{y=0}$ and $K=-\partial_y\left.\log {\sqrt{\det h}}\right|_{y=0}$.
If therefore we define the volume  of a hypersurface of fixed $y$ by $V(y)=\int_{\partial M}\d^3x\sqrt {\det h(x,y)} $, then  $I_\GHY$ can be expressed in terms
of the derivative of $V(y)$ at $y=0$:
\be\label{GHYev} I_\GHY= \frac{1}{8\pi G}\left.\frac{\d}{\d y}V(y)\right|_{y=0}\ee  

The Euclidean black hole geometry does not have a boundary in the usual sense, but it is not compact, and one needs to consider a sort of large radius limit of the GHY boundary term.
The procedure of Gibbons and Hawking was the following.   They cut off the Euclidean Schwarzschild solution at a large radius $r=\bar r$ and computed $I_\GHY$ with this
cut off in place. Let us call the result $I_\GHY(\bar r;\BH)$.  If one simply takes the limit of $I_\GHY(\bar r;\BH)$ for $\bar r\to\infty$, one finds that it diverges.
The same procedure also would give a divergence in the action for the flat manifold $\R^3\times S^1$.   Since Gibbons and Hawking wanted  the action of $\R^3\times S^1$ to vanish,
they subtracted away the boundary term for the case of $\R^3\times S^1$.  To define this subtraction precisely, 
they cut off $\R^3\times S^1$ in such a way that its boundary geometry is the same as that of the cut off black hole (adjusting the circumference of $S^1$ to make this
possible).   Then what they defined as the action of the Euclidean Schwarzschild solution was the large $\bar r$ limit of the difference of the boundary terms for the black hole
and for $\R^3\times S^1$:
\be\label{tellof} I_\BH = \lim_{\bar r\to\infty}\left(I_\GHY(\bar r; \BH)-I_\GHY(\bar r;\R^3\times S^1)\right). \ee
This trivially vanishes if the black hole is replaced by $\R^3\times S^1$.

With these preliminaries out of the way, the actual calculation is not difficult.
In the black hole solution, the circumference of the circle at $r=\bar r$ is $\beta_\sH\sqrt{1-\frac{2GM}{\bar r}}$, so one considers $\R^3\times S^1$ with that value of the circumference.
With the standard definitions of $r$ in the black hole metric (\ref{eucl}) and the $\R^3\times S^1$ metric (\ref{flatmetric}), a cutoff at $r=\bar r$ means that in each case the
boundary two-sphere has radius $\bar r$.   So with these choices the boundary three-geometries are the same.    To evaluate $I_\GHY$ using eqn. (\ref{GHYev}), 
we need the normal derivative $\frac{\d}{\d y}$ with $y$ normalized so that the metric looks like eqn. (\ref{thef}) near the boundary.
So
\begin{align}\label{gef} \frac{\d}{\d y}=\begin{cases} -\frac{\d}{\d r}  & \R^3\times S^1 \cr
                                                                                 -\left(1-\frac{2GM}{\bar r}\right)^{1/2}\frac{\d}{\d r} & {\rm Black ~hole} .\end{cases}\end{align}
The volume at radius $r$ is $\beta_\sH \left(1-\frac{2GM}{\bar r}\right) ^{1/2}\cdot 4\pi r^2$ for $\R^3\times S^1$, and       $\beta_\sH \left(1-\frac{2GM}{r}\right)^{1/2} \cdot 4\pi r^2$  for the black hole.
So eqn. (\ref{tellof})  together with (\ref{GHYev}) gives
\be\label{nelof} I_\BH=-\lim_{\bar r\to\infty}\beta_\sH \frac{1}{8\pi G}\sqrt{1-2GM/\bar r} \left.\frac{\d}{\d r}\right|_{r=\bar r}\left( 4\pi r^2\sqrt{1-2GM/r}-4\pi r^2 \right)
=\frac{\beta_\sH M}{2}=\frac{\beta_\sH^2}{16\pi G} . \ee
  Using this in eqn. (\ref{oxy}), we finally get the entropy:
  \be\label{zono} S= \frac{\beta_\sH^2}{16\pi G}=\frac{A}{4G}.\ee
Here  we used the usual $A=16\pi G^2 M^2$.                                                                       

\subsection{Another Computation Of The Entropy}\label{acomp}

The computation just described was quite a coup when it appeared, but one may ask a basic question.  Though this computation does give an answer proportional to the
horizon area $A$, the horizon played no particular role in the analysis and one might hope for a more direct explanation of why the  answer is proportional to the horizon area.

There is in fact an alternative derivation that avoids any subtle questions about the boundary contribution, and directly gives an answer proportional to the horizon area. 
(For an early version of this computation, see \cite{CT}.)
In this approach, we just use the fact that, on a manifold $M$ with boundary $\partial M$,  the modified action $I'_\EH$ with the GHY boundary term included has the property that, in expanding around any given metric, its variation is proportional to the Einstein equations, with no additional boundary term,
 as long as we consider only variations of the metric that leave fixed the induced metric on $\partial M$.
In other words, under a metric variation $g_{\mu\nu}\to g_{\mu\nu}+\delta g_{\mu\nu}$ with $\delta g_{\mu\nu}=0$ on the  boundary, the change in $I'_\EH$ to first order  is
\be\label{firstone}\delta I'_\EH=\frac{1}{16\pi G}\int\d^4x \sqrt g g^{\mu\mu'}g^{\nu\nu'}\delta g_{\mu'\nu'}\left(R_{\mu\nu}-\frac{1}{2} g_{\mu\nu}R\right), \ee
with no boundary term.   The specific boundary term $I_\GHY$ was chosen to make this true, but in the alternative computation of the action that we are about to explain,
all one needs to know  about $I_\GHY$ is that eqn. (\ref{firstone}) holds if it is included, and that $I_\GHY$ is defined by a local integral on $\partial M$.  One does not need
any more detailed knowledge about $I_\GHY$.

Since the formula (\ref{oxy}) for the entropy involves a derivative of the action with respect to $\beta$, to compute the entropy at some value of $\beta$, it does not
suffice to compute the action only at that value of $\beta$; one needs to know what happens if $\beta$ is changed.  But since the entropy depends only on the first derivative
of the action with respect to $\beta$, we only need to know what happens if $\beta$ is changed to first order.

In section \ref{action}, we computed the action by studying the Euclidean Schwarzschild solution as a function of $\beta $ or $M$.  When we varied $\beta$, we also varied
$M$ so that the solution remained smooth even at the origin.  

This means that when we varied the metric
with respect to $\beta$, we considered implicitly a metric variation $\delta_\beta g$ chosen so that the Einstein equations remain valid.      On the other hand, let $\delta'_\beta g$
be some other variation of the metric under a change in $\beta$, such that the change in the metric at infinity is the same, but the Einstein equations do not necessarily remain
valid.   Then $\tilde \delta g=\delta_\beta g-\delta'_\beta g$ is a metric variation in which there is no change in the metric at infinity, and in particular no change in the radius 
$\beta$ of the circle at infinity.   But that means, according to eqn. (\ref{firstone}), that as long as we are expanding around a classical solution of Einstein's equations, 
changing the metric by $\tilde \delta g$ does not affect the action to first order.   Therefore, in first order, the change in the action is the
same whether we use $\delta_\beta g$ or $\delta'_\beta g$.   We can make a convenient choice that simplifies the computation of the action.

Instead of varying $\beta$ and $M$ together, as we did in section \ref{action}, we can vary $\beta$ keeping $M$ fixed.   In other words, we leave the Euclidean Schwarzschild
solution (\ref{eucl}) completely unchanged.   All we change is the period $\beta$ of the coordinate $\tE$; instead of setting this to be $\beta_\sH=8\pi GM$, we allow an arbitrary period $\beta$.
(But since we only need the first derivative of the action with respect to $\beta$, it suffices to consider the case that $\beta$ is arbitrarily close to $8\pi GM$.)   
The near horizon metric (\ref{wefto}) is unchanged, as is the associated metric (\ref{efto}) in the two directions orthogonal to the horizon.   The only
difference is that  $\tE$ now has a general period $\beta$ rather than the specific period $8\pi GM$ that makes the metric smooth.   As a result,
the metric (\ref{efto}) has a conical singularity at the ``origin'' ${\t r}=0$.  Rather than the angle subtended by a loop around the origin being $2\pi$, it
is $\frac{\beta}{4 GM}$.   Such a conical singularity produces a delta function in the scalar curvature. 

In general,    if $P$ is a point in a Riemannian two-manifold $N$
that is a conical singularity subtended by an angle $2\pi +\varepsilon$, and $\delta_P$ is a delta function supported at $P$, then
the scalar curvature of $N$ has a delta function contribution 
\be\label{dozo}
R=-2\varepsilon \delta_P+\cdots. \ee
 This statement is actually a consequence of the Gauss-Bonnet theorem.
As a quick check, we will just consider the case $\varepsilon=-\pi$.   We can build a two-sphere by gluing together two identical squares along their boundaries;
this produces a metric that is flat except for four conical singularities with opening angle $\pi$, each corresponding to  $\varepsilon=-\pi$.
  Since this two-sphere is flat except at the four conical singularities, and the Gauss-Bonnet
theorem says that the integral of the scalar curvature for any metric on the two-sphere is $8\pi$, each  of the four conical singularities must produce in the
scalar curvature a delta function with coefficient $2\pi$.   This agrees with eqn. (\ref{dozo}) with $\varepsilon=-\pi$.

In our case, setting $\frac{\beta}{4GM}=2\pi +\varepsilon$, we have $\varepsilon=\frac{\beta-8\pi GM}{4GM}$, so the coefficient of the delta function  at the origin in the scalar curvature
of the two-dimensional metric (\ref{efto}) is $-2\varepsilon=-\frac{\beta-8\pi GM}{2GM}.$ When   $\beta\not=8\pi GM$, 
 the  Euclidean Schwarzschild solution (\ref{eucl})  has a conical singularity on the horizon, subtending  the angle $\beta/4GM$.
  So  its  scalar curvature has a delta function supported on the horizon with  coefficient $-\frac{\beta-8\pi GM}{2GM}$:
\be\label{doto}R=-\frac{\beta-8\pi GM}{2GM}\delta_H. \ee
Here  $\delta_H$ is a delta function supported on the horizon $H$ (that is, the integral of this delta function over the two directions normal to the horizon is 1).


Now we can evaluate the action.   First of all, we do not need to worry about the GHY boundary term.  It is the integral of a local 
expression on the boundary, with an   integrand that is independent of $\tE$.   Therefore, if we vary $\beta$ keeping $M$ fixed,
 the integral that gives the GHY boundary term is simply proportional to $\beta$.   But a multiple of $\beta$ is annihilated by the operator 
 $1-\beta \frac{\partial}{\partial \beta}$ and thus does not contribute in the entropy
formula (\ref{oxy}).
  
  So we can evaluate the entropy just from the bulk part of the action.
Of course, away from the horizon, regardless of the assumed value of $\beta$, the scalar curvature $R$ vanishes (as does the Ricci curvature $R_{\mu\nu}$). Thus,
the only contribution to the bulk action $I_\EH=-\frac{1}{16\pi G}\int \d^4x \sqrt g R$ comes from the delta function on the horizon.   
Hence  $\int\d^4x \sqrt g R= -\frac{\beta-8\pi GM}{2GM} A$, where we get a factor $-(\beta-8\pi GM)/2GM$ by integrating over the directions normal to the horizon and a factor of
the horizon area $A$ from integrating over the horizon.   So the action is
\be\label{nofo}I_\BH =\frac{\beta-8\pi GM}{32\pi G^2 M} A.\ee
And the entropy is
\be\label{wofo}S=-\left.\left(1-\beta\frac{\partial}{\partial\beta}\right)\right|_{\beta=8\pi GM} I_\BH=\frac{A}{4G},\ee
as found previously by other means.

This calculation goes through in much  the same way for other theories with static black holes, such as Einstein-Maxwell theory, in which one can consider
an electrically or magnetically charged black hole.   It is no longer true that the bulk contribution to the black hole action away from the horizon vanishes. But it is given by 
the  integral of a local Lagrangian density  that is independent of $\tE$, so it is proportional to $\beta$ and does not contribute to the entropy.  To analyze a black hole
that is stationary but not static, such as a Kerr black hole, one can give a similar analysis but now using  complex metrics, not just metrics of Euclidean signature \cite{GH}.  

This approach gives a satisfactory explanation of why the entropy of a stationary black hole is always $A/4G$ in the Euclidean approach to Einstein gravity,\footnote{This assumes
that the  Einstein-Hilbert action is normalized for any $D$ as $-\frac{1}{16\pi G}\int \d^Dx\sqrt g R$.} regardless of
the matter system considered and the charges carried by the black hole.   With the derivation given in section \ref{action}, this seems to require a separate computation in each case.
As an example of such a separate computation, see the derivation of the result (\ref{pilfo}) for the entropy of an AdS-Schwarzschild black hole.   As another example, though we have
here considered Schwarzschild black holes in dimension $D=4$, the generalization to any $D$ is straightforward.  The derivation that we have just given is valid for any $D$ and
shows that the entropy is always
$A/4G$, independent of $D$, where now $A$ is the $(D-2)$-volume of the horizon (thus $A$ is only an area in the usual sense if $D=4$).   The Lorentz signature approach and  the derivation of
section \ref{action} can be used to verify this fact but do not give a direct explanation of it.

The derivation of the black hole entropy that we have described is actually the simplest example in which entropy is related to the response of a system to a conical
singularity.   We will see several further examples, centering around the replica trick (section \ref{sample}).

\subsection{Is The Entropy A Counting Of States?}\label{isit}

The Euclidean computation of black hole entropy is quite remarkable, and has been the starting point for many subsequent developments.  But it raises a fundamental
question.  In what sense is the quantity that is computed this way an entropy?   What are the states that are being counted to compute this entropy?  This is certainly one of the central
puzzles concerning black hole thermodynamics.


In the absence of gravity, to compute the partition function of a quantum field theory defined on a spatial manifold $W$, say at inverse temperature $\beta$, one simply
performs a path integral on $W\times S^1_\beta$.   This path integral manifestly has a state-counting interpretation: the states are defined on $W$ and they are propagating around the
circle $S^1_\beta$.  

The gravitational path integral on the Euclidean Schwarzschild spacetime  does not have that sort of interpretation, because the topology is wrong.  Near infinity the spacetime
looks like $\R^3\times S^1_\beta$, but in the interior, at the horizon,  the circle shrinks to a point. As a result, as noted earlier,
 the topology is actually $\R^2\times S^2$, not $W\times S^1$ for some $W$.
So the path integral on the Euclidean Schwarzschild spacetime  does not have any evident, or known, interpretation as a sum over states at inverse temperature $\beta$.

That is why in these notes, we have presented first what was essentially  Hawking's original derivation in Lorentz signature \cite{hawking} (with a later refinement \cite{FH}).
It is true that the Lorentz signature derivation also does not give much insight about what are the quantum states that account for the huge Bekenstein-Hawking entropy of
a black hole.   But at least in the Lorentz signature approach, 
 the principles involved in deducing  thermal emission from the black hole are clear cut.   The fact that the results deduced in Lorentz signature agree with what is 
found in the Euclidean derivation is one of the strongest reasons to believe that the Euclidean approach is correct.   

An entropy $S=A/4G$ suggests a number of states of order $e^{A/4G}$.   For a macroscopic black hole, this is a remarkably big number, especially given that
at the classical level a black hole is quite featureless, as summarized in the no hair theorem \cite{nohair,nohair2}.  Neither the Lorentzian approach nor the Euclidean approach
really explains this vast degeneracy.   Nonetheless the huge inferred number of quantum black hole states suggests
that somehow a black hole should be understood quantum mechanically as a complex dynamical system of some kind whose description requires a Hilbert space of this
enormous size.   That is actually the modern viewpoint, as explained for example in \cite{malda}.


\subsection{Negative Cosmological Constant}\label{negative}

There are very interesting and completely different lessons to be learned by studying horizons and black holes in a world with a positive or negative cosmological constant $\Lambda$.
Here we consider the case $\Lambda<0$, originally analyzed by Hawking and Page \cite{hp},   and in section \ref{cosmo} we take $\Lambda>0$.



In $3+1$ dimensions, the maximally symmetric solution of Einstein's equations with $\Lambda<0$ 
is Anti de Sitter space, which can be described by the metric
\be\label{adsmet}\d s^2= -\sV \d t^2+\frac{1}{\sV} \d r^2+r^2\d\Omega^2,\ee
where
\be\label{vis} \sV=1+\frac{r^2}{b^2}, \ee
\be\label{bdef} b=\sqrt{-\frac{3}{\Lambda}},\ee
 $\d\Omega^2$ is the metric on a unit two-sphere, and $0\leq r<\infty$, $-\infty<t<\infty$.  
The symmetry group is $SO(2,3)$.   One generator of this group is the time translation symmetry $\frac{\partial}{\partial t}$.  
We call the corresponding conserved charge the Hamiltonian $H$,  and its eigenvalue the energy $E$.
As usual, an ensemble in which one sums over all states weighted by $e^{-\beta H}$ can be defined by rotating to imaginary time
 with $t=-\i \tE$ and taking  $\tE$ to be a periodic variable with period $\beta$. 
We arrive at the metric 
\be\label{adsth}\d s^2= \sV \d \tE^2+\frac{1}{\sV} \d r^2+r^2\d\Omega^2.\ee
Though this metric is well-behaved  if $\tE$ is considered to be real-valued, we usually will consider it for the case that $\tE$ is a periodic variable, with some period $\beta$.
In that case, we call (\ref{adsth})  the metric of $\AdS_\beta$ (thermal AdS space with inverse temperature $\beta$), and we call the corresponding ensemble a thermal ensemble
with temperature $T=1/\beta$.
 As we explain at the end of this discussion, the modern interpretation is that $T$ is the temperature measured
 in a dual conformal field theory on the boundary \cite{MaldaDual,GKP,EW}.    However, for now we just note that $T$ is far from being the temperature that would be measured
 locally by an observer living in this spacetime.   The circumference of the circle parametrized by $\tE$ at a given value of $r$ is
 $\beta\sqrt{\sV(r)}$, which for very large $r$ grows as $\beta r/b$.   The locally measured temperature is the inverse of this and vanishes for large $r$  as $b/\beta r$.
Hence a particle of any given energy is very unlikely to be found at very large $r$. 
 
In the $\AdS_\beta$ metric (\ref{adsth}), the function $\sV(r)$ is positive-definite, so the circle parametrized by $\tE$ never shrinks to a point, and the topology of
$\AdS_\beta$ is $\R^3\times S^1$, the same as it would be if $\sV(r)$ were identically equal to 1. 
 
 The AdS-Schwarzschild solution describing a spherically symmetric black hole of mass $M$ has the same form as eqn. (\ref{adsmet})  or (in Euclidean signature) eqn. (\ref{adsth}), but now
 with
 \be\label{ergy} \sV(r)=1-\frac{2GM}{r}+\frac{r^2}{b^2}. \ee   It is no longer true that $\sV(r)$ is positive-definite; it is negative for sufficiently small positive $r$.  
  The black hole horizon is at the largest zero of $\sV(r)$, which we denote as $r_+$.   Thus 
 \be\label{invox} 1-\frac{2GM }{r_+}+\frac{r_+^2}{b^2}=0 \ee  or
 \be\label{ninvo}M=\frac{r_+}{2G}\left(1+\frac{r_+^2}{b^2}\right).\ee  The parameter $M$  is the ADM energy (the eigenvalue of  the Hamiltonian $H$) measured at infinity.
 Clearly, if $b$ is extremely large compared to $GM$, or equivalently if the size of the black hole is much less than the cosmological scale $\frac{1}{\sqrt{-\Lambda}}$, this solution can be well approximated  out to $r\gg GM$ by the usual Schwarzschild solution in asymptotically flat spacetime.  
 However, if $GM\gtrsim b$ or equivalently the black hole radius is comparable to the cosmological scale or bigger, the solution is quite different from the asymptotically flat case.

 For a black hole in an asymptotically Anti de Sitter spacetime, there is no close analog of the derivation of the Hawking effect that we explained in Lorentz signature in
 section \ref{bhevaporation}.  That is because a particle emitted from the black hole will always be reflected back by a sort of potential barrier near $r=\infty$; see \cite{BF},\cite{EW}.   However, it is straightforward to imitate the Euclidean derivation.
   Expanding $r=r_++{\t r}^2$ near $r=r_+$ and following the same steps as in section \ref{disappears}, we find that the Euclidean 
   AdS-Schwarzschild metric is completely smooth and complete
 if $\tE$ is a periodic variable with period
 \be\label{dunco}\beta=\frac{4\pi r_+ b^2}{b^2+3r_+^2}. \ee
 Once again, the modern interpretation  is that $T=1/\beta$ is the temperature measured in the boundary conformal field theory.
 
 The classical thermodynamics of the AdS black hole can be analyzed by either of the two methods in sections \ref{action} and \ref{acomp}.
 To imitate the derivation of section \ref{action}, we have to compute the action of the Euclidean black hole, subtracting the action of $\AdS_\beta$ adjusted to have the
 same asymptotic form of the metric.  In contrast to the case of a black hole in asymptotically flat spacetime, the GHY boundary term makes no contribution to the difference
 in action between the two solutions, because the function $\sV(r)$ is independent of  $M$ up to a term of relative order $1/r^3$, too small to be important.
Everything therefore comes from the bulk Einstein-Hilbert action
 \be\label{difo} I_\EH=-\frac{1}{16\pi G}\int\d^4x\sqrt g \left(R-2\Lambda\right).  \ee
 The Einstein equations imply that $R=4\Lambda$, so the action of a classical solution is
formally  $ \frac{3}{8\pi G b^2}V,$ 
 where $V$ is the volume of the spacetime and we used eqn. (\ref{bdef}).   As the black hole and $\AdS_\beta$ solutions both have infinite volume, 
 we regularize by truncating these spacetimes at $r=\bar r$ for some very large $\bar r$,
 and then  we subtract from the volume of the truncated black hole solution the volume of a thermal AdS space also cut off at $r=\bar r$ and with a suitably adjusted period of $\tE$ so
 that the two solutions have the same boundary metric.
 In the black hole solution, at $r=\bar r$, the circumference of the circle parametrized by $\tE$  is $\beta\sqrt{1-\frac{2GM}{\bar r}+\frac{\bar r^2}{b^2}}$.
 The thermal AdS solution with the same circumference is $\AdS_{\beta'}$ with
 \be\label{dino}\beta'=\beta  \frac{\sqrt{1-\frac{2GM}{\bar r}+\frac{\bar r^2}{b^2}}}    {\sqrt{1+\frac{\bar r^2}{b^2}}}   
 =\beta\left(1-\frac{GMb^2}{\bar r^3}+\cdots\right),\ee
 where the omitted terms vanish fast enough to be irrelevant.  So finally the action is 
 \be\label{nifo} I=\frac{3}{8\pi Gb^2}\Delta V, \ee where $\Delta V$ is the difference between the black hole and thermal AdS  volumes computed with these cutoff parameters.
 It is straightforward to compute that the volume of the black hole cut off at $r=\bar r$ is
 \be\label{wifo} V(\BH) =\frac{4\pi}{3}\beta\left(\bar r^3-r_+^3\right). \ee
 The volume of $\AdS_{\beta'}$ also cut off at $r=\bar r$ is
 \be\label{nifox}V(\AdS_{\beta'})=\frac{4\pi}{3}\beta\left(\bar r^3-GMb^2\right)=\frac{4\pi}{3}\beta\left(\bar r^3-\frac{b^2 r_+}{2}-\frac{r_+^3}{2}\right). \ee
 The regularized action of the black hole solution is the difference, or
 \be\label{tifo} I=\frac{\pi r_+^2(b^2-r_+^2)}{G(b^2+3r_+^2)}.\ee
 Relating $I$ to the partition function by $I=-\log Z$ and defining the entropy by $S=\left(1-\beta\frac{\d}{\d \beta}\right)\log Z$,
 where the derivative can be evaluated using (\ref{dunco}), we get
 \be\label{pilfo} S=\frac{\pi r_+^2}{G}=\frac{A}{4G}.\ee
 
 Alternatively, we can follow the logic of section \ref{acomp}. This tells us immediately, without any computation, that the entropy in the classical limit is $A/4G$.

In contrast to an ordinary Schwarzschild black hole in asymptotically flat spacetime, an AdS-Schwarzschild black hole cannot have an arbitrary temperature.
On the contrary, eqn. (\ref{dunco}) shows that $\beta$ has a maximum, and therefore $T=1/\beta$ has a minimum, at $r_+=r_0=\frac{b}{\sqrt 3}$, with
$\beta=\beta_0=\frac{2\pi b}{\sqrt 3}$.   For $\beta<\beta_0$, there are two black hole solutions, corresponding to the two values of $r_+$ that satisfy the quadratic equation
(\ref{dunco}).   To decide which solution, if either, is stable, we recall that thermodynamic stability requires that the specific heat $\frac{\partial M}{\partial T}$
should be positive.  Equivalently, $\frac{\partial M}{\partial \beta}$ should be negative.   Since eqn. (\ref{ninvo}) shows that $\frac{\partial M}{\partial r_+}$ is always
positive, the condition for stability is 
\be\label{tenz} \frac{\partial \beta}{\partial r_+}<0.\ee
From eqn. (\ref{dunco}),  this is so precisely if $r_+>r_0$.   In other words, the ``small'' black hole solutions with $r_+<r_0$ are thermodynamically
unstable, but the ``large'' ones with $r_+>r_0$ are stable.  The instability for small $r_+$ should not be a surprise, because for $r_+\ll b$, the solution goes over
to the usual Schwarzschild solution in asymptotically flat spacetime, whose thermodynamic instability was discussed in section \ref{unstable}. 

Since there is no black hole solution for $T<1/\beta_0$, how do we describe thermodynamics in Anti de Sitter space at low temperatures?   The answer is straightforward: at low
temperatures, we consider an ordinary thermal ensemble of particles in AdS space, described by perturbation theory around the classical solution $\AdS_\beta$.  
 For $\beta>\beta_0$,
this is presumed to be the dominant or perhaps only  classical solution  that contributes to a thermal ensemble at the given value of
$\beta$.  For $\beta<\beta_0$, there are two classical solutions to consider, namely $\AdS_\beta$  and the black hole with $r_+>r_0$.
We expect that in the limit $G\to 0$, the thermal ensemble is dominated by the solution of lower action.   The difference between the actions of the two solutions
is precisely what we computed in eqn. (\ref{tifo}).   The black hole solution dominates if and only if this difference of actions is negative, which is so  precisely if $r_+>b$.
Therefore, for $r_+>b$, the black hole is stable; a thermal gas without a black hole, described by the $\AdS_\beta$ solution, is stable locally at this temperature but should be able to  tunnel to a state
that contains a black hole.\footnote{An explicit description of this tunneling is unknown.}   For $r_+<b$, the thermal gas is stable.
For $\frac{b}{\sqrt 3}<r_+<b$, the action of the black hole solution is bigger, so although the black hole is stable locally, it can potentially  tunnel to
thermal $\AdS_\beta$.  The phase transition between thermal AdS and the black hole  at $r_+=b$ is called the Hawking-Page transition.   Of course, this is only a true sharp phase transition
in the limit $G\to 0$. 

When $\AdS_\beta$ is the dominant solution, the entropy is of order $G^0$ for small $G$, as noted earlier.   When the black hole dominates, the entropy is of order $G^{-1}$.

Hawking and Page made several further observations about this problem.  First of all, because the locally measured temperature vanishes at infinity, a particle of
given energy is confined to a bounded volume of space, even though the total volume of space at, say, time $t=0$ is infinite.   At a given temperature $T$, typical
particles have energy $E\lesssim T$ and therefore are confined in a bounded volume.   Thus a thermal gas in an asymptotically Anti de Sitter spacetime
has a bounded total energy, total entropy, and total number of particles.  
Related to this, in Anti de Sitter space, there is a well-defined microcanonical ensemble, in which one fixes the total energy rather than the temperature.   By contrast, in an asymptotically
flat spacetime, the space of states of bounded energy is of infinite dimension and there is not a well-defined microcanonical ensemble.    For more on the microcanonical ensemble in
Anti de Sitter space, see \cite{hp}.

From the preceding formulas, one can find the following scaling relations at large $r_+$ or high temperature:
\begin{align}\label{scaling} S&\sim T^2\cr E=M&\sim T^3 \cr S&\sim E^{2/3}.\end{align}   
The third relation, which follows from the first two, has the following consequence, as noted by Hawking and Page.    The number of states at energy $E$, which is expected to be roughly
$e^{S(E)}$, grows less than exponentially with $E$, and therefore the partition function $\Tr\,e^{-\beta H}$ converges for all $\beta>0$.   This contrasts with a black
hole in asymptotically flat spacetime, where $S\sim E^2$ and therefore the partition function diverges; that is another manifestation of the thermodynamic instability
of such a black hole.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=4.8in]{Fig8.pdf}
 \end{center}
\caption{\footnotesize (a) Topologically, four-dimensional Anti de Sitter space is $B\times \R$ where $B$ is a three-dimensional ball, with conformal boundary $S^2$, and $\R$ parametrizes time.
  (b) Penrose diagram of Anti de Sitter space. As usual, time runs vertically in the diagram. 
   Plotted from left to right is the distance from the origin in $B$; $r=0$ is the left edge of the diagram and the conformal
boundary at $r=\infty$ is the right edge. 
The conformal boundary is infinitely far away if approached in a spacelike direction.
 But a massless particle, propagating
at a $\frac{\pi}{4}$ angle to the vertical on a worldline such as $\gamma$, can reach the conformal boundary and return in a finite time.  Hence boundary conditions on the conformal
boundary affect physics in the interior, making possible AdS/CFT duality.   \label{AdS}}
\end{figure} 

The  scaling laws in eqn. (\ref{scaling}) have a more specific interpretation.   They are characteristic of a $2+1$-dimensional conformal field theory
formulated in finite volume.   Indeed, this is related to the modern interpretation of  AdS black hole thermodynamics, which involves a dual conformal
field theory defined on the conformal boundary of spacetime.  The basic idea of how this duality arises can be briefly described as follows
(for illustration of some relevant facts, see fig. \ref{AdS}).
  Let $z=1/r$, so that $r=\infty$
corresponds to $z=0$.   Near $z=0$, the AdS metric can be approximated as
\be\label{mellow} \frac{\d z^2}{z^2}+\frac{1}{z^2} \left(-\d t^2+\d\Omega^2\right). \ee
What lies at $z=0$ is a copy of $\R\times S^2$, where $S^2$ is a two-sphere and $\R$ is parametrized by $t$.   
$\R\times S^2$  is sometimes called the Einstein static universe (in three spacetime dimensions).
More generally, a spacetime $M$ is said to be asymptotically locally
Anti de Sitter if one can pick a coordinate $z>0$ that vanishes at spatial infinity such that the
metric near $z=0$ takes what is known as the Fefferman-Graham form \cite{FG}:
\be\label{ellow}\frac{\d z^2}{z^2}+\frac{1}{z^2} \sum_{i,j} h_{ij} \d x^i \d x^j+\cdots, \ee
where $x^i$ are local coordinates on a  manifold $N$ of one dimension less,  $h_{ij}$ is a metric on $N$, and omitted terms are regular at $z=0$. Here the manifold $N$ that lies at $z=0$ is not part of $M$, as the distance to $z=0$ diverges:  $\int_0^\epsilon \frac{\d z}{z}=\infty$.  Rather $N$ is said to be the conformal
boundary of $M$, or the virtual boundary of $M$ at (spatial) infinity.\footnote{\label{dodads}It is sometimes convenient to complete $M$ by adjoining the virtual boundary $N$.   The completed space
$\bar M$ is a manifold with boundary  $N$. $\bar M$  does not have a natural Riemannian metric, but it does have a natural conformal structure, because if one multiplies
the metric in (\ref{mellow}) by a Weyl factor $z^2$, then it extends over $\bar M$. 
  An example of why this is useful is that it enables one to define the domain of dependence $D(U)$ of
a set $U\subset M$.   Denoting as $\bar U$ the closure of $U$ in $\bar M$, $D(U)$ is defined as the domain of dependence $D(\bar U)$ of $\bar U$ in $\bar M$, by the usual definition of footnote
\ref{dod}.  (The boundary conditions along $N$ that are used in defining the AdS/CFT correspondence ensure that the two definitions in footnote \ref{dod} give the same
result for  $D(\bar U)$.)}
  Equation (\ref{ellow}) may appear to show that $N$ is endowed with a natural Riemannian metric $h_{ij}$,
but this is misleading.   The Fefferman-Graham form (\ref{mellow}) of the metric is invariant modulo less singular terms under $z\to e^{\varphi} z$    where $\varphi$ is an arbitrary real-valued
function on\footnote{To be more precise, a coordinate transformation $(z,x^i)\to (e^\varphi z,x^i -\frac{z^2}{2} h^{ij}\partial_j\varphi)$ preserves the asymptotically locally AdS
form (\ref{mellow}) of the metric, while transforming the metric of $N$ as described in the text.}
$N$. 
This transforms the metric on $N$ by a Weyl transformation $h\to e^{2\varphi}h$.   So $N$ has a conformal structure (a Riemannian metric up to Weyl transformation)
but not a Riemannian structure. To illustrate this, we can compare the symmetry group of AdS space to that of its conformal boundary.
The isometry group of AdS space in four  spacetime dimensions
is\footnote{More precisely, assuming the time is taken to range over $-\infty<t<\infty$,  the AdS  isometry group is a cover of $SO(2,3)$ in which, roughly, the $SO(2)$ factor
is ``unwrapped.'' The same cover is the conformal group of the boundary.}  
$SO(2,3)$.  This group is also the conformal group (the group of diffeomorphisms that preserve the metric up to a Weyl transformation)
of the Einstein static universe $\R\times S^2$.   In comparing the symmetries, we have to allow conformal transformations of the boundary, not just isometries, so we have to take
into account the fact that intrinsically the boundary has only a conformal structure.


Though the distance to $z=0$ along a path of fixed $x^i$ is infinite, 
 it turns out that a light ray in an asymptotically AdS manifold can reach $z=0$ and return back in a finite time, as illustrated in fig. \ref{AdS}(b);  see for example \cite{EW}.   
 As a result, manipulating the boundary conditions along $N$
can affect physics in $M$.  By manipulating the boundary conditions along $N$, while also imposing suitable initial and final conditions in the far past and future, one can define
correlation functions on $N$ that satisfy all the general properties of correlation functions in a conformal field theory (CFT).  These ``boundary correlation functions''
are the closest analog in asymptotically AdS spacetime of the usual $S$-matrix elements that can be defined in an asymptotically flat world.

In many important examples of what the bulk gravitational theory might be, there are very strong reasons to believe
 that what can be defined  on the conformal boundary $N$ is not just a nice set of correlation functions that obey axioms of conformal field theory
but a full-fledged CFT whose content is precisely equivalent to the content of the  bulk gravitational theory in one dimension more.   In many instances, quite a few of which were described
in the original paper \cite{MaldaDual}, considerations of string theory and $M$-theory motivate precise duality conjectures relating a specific conformal field theory in $d$ dimensions
to a specific gravitational theory on an asymptotically AdS spacetime of one dimension more.
  By now, this AdS/CFT duality has been explored and  tested from
many points of view, and the evidence for it is extensive.   For  reviews, see for example \cite{VH,MaldaNew}.   

To be precise, in the AdS/CFT correspondence, one specifies the manifold $N$ on which one wishes to define the boundary CFT, together with the conformal structure of $N$.
Then in the dual gravitational description, one must allow all bulk manifolds $M$ that are asymptotic to $N$.  This in particular will entail a sum over topologies.  For example, suppose that we wish to study a thermal ensemble
in the dual CFT at inverse temperature $\beta$, on a spatial manifold $S^2$ of unit radius.   For this, we define the CFT on the Euclidean signature spacetime $N=S^2\times S^1_\beta$.
The AdS/CFT duality then instructs us that to give a dual gravitational description of this thermal ensemble, we should sum over
Euclidean manifolds that are asymptotically locally AdS with conformal boundary $N$.  For small $G$, one expects the gravitational description of the thermal ensemble to be dominated
by a classical solution of least action that has $N$ as its conformal boundary.  There are two candidates, namely $\AdS_\beta$ and the AdS black hole.   Which of them dominates
depends on $\beta$, as we have seen.  Clearly this reasoning leads back to the analysis of AdS black hole thermodynamics originally given by Hawking and Page in \cite{hp} and summarized
in the preceding paragraphs.   
The thermal ensemble of the boundary CFT on a compact manifold $S^2$ is well-defined at all temperatures,         
and satisfies the scaling relations\footnote{To be precise, this is true in a CFT that when formulated on the compact manifold $S^2$ has a discrete spectrum at all energies.
A generic CFT has that property, but there are special CFT's whose spectrum on $S^2$ is discrete only below some energy $E_0$ and continuous above that.
In such a case, the dual bulk description involves additional degrees of freedom (such as branes with special properties) such that the derivation of the scaling relations
(\ref{scaling}) is not valid.   For example, see \cite{SW}.}
 (\ref{scaling}) at high temperatures.   So those relations are a simple example of a prediction of the AdS/CFT duality.

From what we have said so far, the dual CFT provides an attractive  setting in which to understand AdS black hole thermodynamics.   But the applications of this duality go far beyond that.
For example, simple constructions in the boundary CFT can be used to create much more general density matrices than a thermal one, and the duality then gives a framework to
study these more general density matrices via gravity.  That will be important in discussing the Ryu-Takayanagi formula in section \ref{rt}.   At a more abstract level,
the boundary CFT is an ordinary quantum field theory governed by ordinary quantum mechanical laws.   Transferring this observation to the bulk,
 AdS/CFT duality provides a powerful reason to believe
that processes involving black holes can be described by unitary quantum mechanical evolution, though our understanding of quantum gravity does not yet
enable us to exhibit this fact directly. 

\subsection{Positive Cosmological Constant}\label{cosmo}

  \begin{figure}
 \begin{center}
   \includegraphics[width=3.8in]{Fig9.pdf}
 \end{center}
\caption{\footnotesize  The Penrose diagram of de Sitter space.  The worldline of a geodesic  observer who remains at rest at the north pole of the sphere is
the right edge of the diagram.   Shaded is the portion of the spacetime that the observer can see and influence, namely  the right static patch $\P_r$. Spacelike separated from $\P_r$
is a complementary left static patch $\P_\ell$.   $\P_r$ and $\P_\ell$ are  bounded, as shown, by past and future horizons that
intersect at the bifurcation surface $\Sigma$.   A Cauchy hypersurface $\S$ runs horizontally through $\Sigma$; its portions in $\P_r  $ and $\P_\ell$ are labeled
$\S_r$ and $\S_\ell$, respectively.  $\P_r$ is the domain of dependence of $\S_r$ and $\P_\ell$ is the domain of dependence of $\S_\ell$.  The arrows indicate the action of the
symmetry generator $H$, which is future-directed timelike in $\P_r$, past-directed timelike in $\P_\ell$, and spacelike elsewhere.   \label{desitter}}
\end{figure} 


Apart from black hole horizons, there can also be horizons in cosmology.   A cosmological horizon bounds the portion of spacetime that a given observer can see or influence.
To be more precise, a future cosmological horizon bounds the region of spacetime that the observer can see, and a past cosmological horizon bounds the region that the observer can
influence.   Gibbons and Hawking proposed \cite{GH2}  that also in the case of a cosmological horizon, the quantity $\frac{A}{4G}$, where $A$ is the horizon area, can be interpreted as an entropy.
One motivation for this  proposal was that the area theorem \cite{AreaTheorem} applies equally to black hole and cosmological horizons, showing that $A$ is monotonically non-decreasing, and 
suggesting that $\frac{A}{4G}$ has some sort of thermodynamic interpretation for cosmological horizons, as for black hole horizons.  

An important difference between a cosmological horizon and a black hole horizon is that a cosmological horizon is very observer-dependent and describes the region of spacetime accessible
to some particular observer.  In the case of a black hole horizon in an asymptotically flat or asymptotically AdS spacetime, we usually consider an observer at a great distance and the precise
choice of observer does not affect the definition of the horizon.  



A prototype of a spacetime with cosmological horizons is de Sitter space, which is the maximally symmetric solution of Einstein's equations with cosmological constant $\Lambda>0$.
In this particular case, unlike generic cosmologies, a temperature can be associated to the cosmological horizon, as we will see.
We will describe three different presentations of the de Sitter metric, which will exhibit various important aspects: exponential growth, topology, symmetries, and horizons.

To begin with, the  de Sitter geometry can be described by the line element
\be\label{nilbac}\d s^2=\varrho^2\left(-\d t^2+\cosh^2 t\,\d\Omega_3^2\right),\ee
where  $-\infty<t<\infty$, $\d\Omega_3^2$ is the metric of a three-sphere of unit radius, and
\be\label{ilbar}\varrho=\sqrt{\frac {3}{\Lambda}}. \ee
The  symmetry group of de Sitter space  is  $SO(4,1)$, though only an $SO(4)$ subgroup (rotating the three-sphere) is manifest in these coordinates. 
 The spatial section of de Sitter space at any constant time $t$ is a three-sphere of radius $\varrho \cosh t$.   
These spatial sections
expand exponentially towards either the future or the past; the part of the spacetime with $t\gg\varrho$ is believed to be an approximation to the present
universe.   These spatial sections are compact, so de Sitter space is a closed universe.

Any observer in de Sitter space  will experience past and future cosmological horizons.  For instance, we can consider an observer whose worldline is a geodesic.   An example
of a geodesic is the one that remains for all $t$ at the north pole of the three-sphere.   The metric along this worldline is just $\varrho^2\d t^2$, so the observer's proper time $\tau$
satisfies
\be\label{sattime}\d\tau=\varrho\,\d t. \ee
 Any other geodesic  is related to this one by
an $SO(4,1)$ transformation.    As usual, a Penrose diagram helps in visualizing the causal relations in de Sitter space.   In the Penrose diagram, we depict only two
coordinates in the spacetime -- the time and the ``latitude'' on the three-sphere.   The other polar angles on the sphere are suppressed.   A conformal mapping is made so that in the Penrose
diagram, causal curves travel at an  angle at most $\pi/4$ from the vertical.   The Penrose diagram of de Sitter space is depicted in fig. \ref{desitter}.  It is a square with $t=-\infty$
at the bottom and $t=+\infty$ at the top; the ``latitude'' on the sphere is plotted horizontally, and the left and right edges of the diagram represent the south and north poles of the sphere, respectively.
That means, in particular, that the right edge of the Penrose diagram
 is the worldline of an observer who remains at the north pole at all times (the left  edge is a geodesic that remains always
at the south pole).    The future horizon of the observer is the diagonal that slopes from the lower left to the upper right; the past horizon is the opposite diagonal.
The intersection of the two diagonals is called the bifurcation surface $\Sigma$.   It is a two-sphere of radius $\varrho$ and therefore area $A=4\pi\varrho^2$.   Any point on the past
or future horizon represents a two-sphere of the same area.

Another way to describe de Sitter space, making manifest its $SO(4,1)$ symmetry, is to represent it as a hyperboloid in a five-dimensional Minkowski space with metric
$-\d X_1^2+\sum_{j=2}^5 \d X_j^2$:
\be\label{dsmet} -X_1^2+\sum_{j=2}^5 X_j^2=\varrho^2. \ee
The relation to the  description in eqn. (\ref{nilbac}) is as follows.  Let 
\be\label{mildo} X_1=\varrho \sinh t,\ee
and for $j>1$, let $X_j=\varrho\cosh t\, Z_j$ with $\sum_{j=2}^5 Z_j^2=1$, so that the $Z_j$ parametrize
a unit three-sphere.
Then the metric $-\d X_1^2+\sum_{j=2}^5 \d X_j^2$ coincides with eqn. (\ref{nilbac}), with $\d\Omega_3^2=\sum_{j=2}^5 \d Z_j^2$.
In this representation, assuming that the north pole on the three-sphere  is taken to be at $Z_2=1$, with other $Z_j$ vanishing, 
 the observer's
orbit, parametrized by the observer's proper time $\tau$, takes the form
\be\label{zoggo}X_1=\varrho\sinh \frac{\tau}{\varrho},~~X_2=\varrho\cosh\frac{\tau}{\varrho},~~X_3=X_4=X_5=0.\ee
An important role will be played by the $SO(4,1)$ generator  $H$ that generates a Lorentz boost of the $X_1-X_2$ plane while acting trivially on $X_3,X_4,X_5$.
$H$ acts as $\varrho\frac{\d}{\d \tau}$ along the observer's  orbit.
The fixed point set of $H$ is the two-sphere $X_1=X_2=0$.   This is the bifurcation surface, a two-sphere $\Sigma$ of radius $\varrho$.



The portion of the spacetime that the observer can both see and influence, which  is bounded by the past and future horizons, is what we will call the right static patch $\P_r$.  The 
region spacelike from $\P_r$ will be called  the left static patch $\P_\ell$.  
Another change of coordinates gives a useful description of $\P_r$.  Let $X_1=\sqrt{\varrho^2-r^2}\sinh\frac{\tau}{\varrho}$, $X_2=\sqrt{\varrho^2-r^2}\cosh\frac{\tau}{\varrho}$,
and $X_j=r Y_j$ for $j=3,4,5$ with  $\sum_{j=3}^5 Y_j^2=1$.   The de Sitter metric becomes
\be\label{staticpatch}\d s^2=-\left(1-\frac{r^2}{\varrho^2}\right)\d \tau^2 +\frac{\d r^2}{1-\frac{r^2}{\varrho^2}}+r^2\d\Omega^2.\ee
The portion of de Sitter space that this coordinate system describes is precisely the right static patch $\P_r$. The observer worldline is at $r=0$, and  the coordinate $\tau$ is the observer's proper time.  The observer's horizon is in this description at  $r=\varrho$, with any  $\tau$, and is once
again a two-sphere of radius $\varrho$. (The $r,\tau$ coordinate system actually breaks down at the horizon and does not describe the portion of the spacetime beyond the horizon.)
 This way to write the metric of de Sitter space hopefully exhibits an analogy between the de Sitter cosmological horizon at $r=\varrho$ and the Schwarzschild cosmological horizon
 at $r=2GM$.   The difference is that in the case of a black hole, we usually consider an observer living ``outside'' the  horizon, while in the static patch metric (\ref{staticpatch}),
 the observer lives at $r=0$ and is surrounded by the cosmological horizon.
  The boost generator $H$ of the $X_1-X_2$ plane corresponds in this coordinate system to a symmetry that
 advances the observer's proper time
 \be\label{iko}H \sim \varrho \frac{\partial}{\partial\tau}. \ee
So this symmetry generator is $\varrho$ times the natural Hamiltonian, from the observer's point of view.   The static patch is time-independent if $\tau$ is viewed as the time
coordinate.  This is the reason for the name
``static patch.''


The fact that the time translation symmetry of the observer is a Lorentz boost of the $X_1-X_2$ plane is hopefully reminiscent of Rindler space, where a Lorentz boost
of the $x-t$ plane in Minkowski space is interpreted as the time translation symmetry of a uniformly  accelerating observer.\footnote{Here and in section \ref{thermofield},
 we will explain that the derivation of the thermal nature of Rindler   space given in 
\cite{UW} and presented in section \ref{division} has  close analogs for de Sitter space and for a Schwarzschild black hole.
This  was originally argued in  \cite{TJ}. For another perspective on the analogy between the three cases, see \cite{KW}. The framework of Tomita-Takesaki theory applies in a similar way
to all three cases \cite{Sewell}.}     Comparing figs. \ref{Seven} and \ref{desitter}, hopefully an analogy between the two cases  is evident.
The two spacelike separated static patches $\P_r$ and $\P_\ell$ correspond to the two Rindler wedges $\RR_r$ and $\RR_\ell$.      The boundaries of
$\P_r$ and $\P_\ell$ -- or of $\RR_r$ and $\RR_\ell$ -- are past and future horizons, which meet at a bifurcation surface $\Sigma$.    To the future of the future horizons
is a future wedge that an observer in $\P_r$ or $\P_\ell$ -- or in $\RR_r$ or $\RR_\ell$ -- cannot see.  Similarly to the past of the past horizons is a past wedge that these observers
cannot influence.   The boost symmetry that is future directed timelike
in $\P_r$ or $\RR_r$ is past directed timelike in $\P_\ell$ or $\RR_\ell$ and is spacelike in the past and future wedges.  A difference between the two cases is that in de Sitter space, an 
observer whose worldline is a geodesic can remain forever in $\P_r$ or $\P_\ell$, but in Rindler
space, to remain forever in $\RR_r$ or $\RR_\ell$, the observer must accelerate indefinitely in both the past and the future. 

De Sitter space can be continued to Euclidean signature by setting $t=-\i \tE$ in eqn. (\ref{nilbac}) or $X_1=-\i X_{1,\sE}$ in  eqn. (\ref{dsmet}).
The resulting Euclidean signature manifold is simply a four-sphere $S^4$ of radius $\varrho$, now with symmetry $SO(5)$:
\be\label{oggo} X_{1,\sE}^2+\sum_{j=2}^5 X_j^2=\varrho^2. \ee
In this description, $H$ acts by a rotation of the $X_{1,\sE}-X_2$ plane.   Analytic continuation from a Lorentz boost generator in Lorentz signature to  a rotation generator 
in Euclidean signature was  important in the analysis of Rindler space and plays a similar role in analyzing de Sitter space.

From the explicit description (\ref{zoggo}) of the observer's orbit, we see that after continuing the proper time $\tau$ to complex values, this orbit is periodic
in $\tau$ with period $\i\beta_\dS$, where $\beta_\dS= 2\pi\varrho$.   Therefore, in any $H$-invariant state that can be defined by analytic continuation from Euclidean signature, the observer will see
thermal correlations at temperature $T_\dS=1/\beta_\dS$, which is known as the de Sitter temperature.  Such a result was first found in \cite{FHN}, \cite{GH2}, from a different
but related point of view.

Actually, in quantum field theory in a background de Sitter space,\footnote{The linearization of gravity around de Sitter 
space can be viewed as a quantum field theory in a background de Sitter space.   But if gravity is treated beyond leading order, the de Sitter symmetry generators
become constraint operators and a quite different language is needed.}
 there is a natural de Sitter invariant state $\Psi_\dS$, sometimes called the Bunch-Davies state \cite{CT2,SS2,BD,Mo,Al}, which can be defined by
analytic continuation from Euclidean signature.   Literally, one starts with correlation functions on $S^4$,
\be\label{bumblebee}\bigl\la \phi(X_{1,\sE},\vec Z)\phi(X_{1,\sE}{}', \vec Z')\cdots \bigr\ra_{S^4} \ee
(where $\phi$ is a generic quantum field and again  $\vec Z=(X_2,\cdots,X_5)$).
These are unnormalized correlation functions, defined without dividing by a normalization constant.   The natural normalization constant  would be the $S^4$ partition function $Z$.
Then one defines Lorentz signature correlation functions by  analytic continuation to imaginary values of $X_{1,\sE}$, which correspond to real values of $X_1$.  Those
analytically continued correlation functions are by definition the expectation values of the same products of operators in the state $\Psi'_\dS$:
\be\label{tumblebee}\bigl\la \Psi'_\dS|\phi(X_1,\vec Z)\phi(X_1', \vec Z')\cdots |\Psi'_\dS\bigr\ra. \ee   We call this state $\Psi'_\dS$ rather than $\Psi_\dS$ because it is unnormalized;
tautologically, $\la\Psi'_\dS|\Psi'_\dS\ra=\la 1\ra_\dS=Z$.   So the normalized de Sitter state is
\be\label{umbletree} \Psi_\dS=\frac{\Psi'_\dS}{\sqrt Z}.\ee
Since the Euclidean correlation functions are manifestly $SO(5)$-invariant, their continuation to Lorentz signature is $SO(4,1)$-invariant, and in particular $H$-invariant.
Accordingly, in this state, the observer will see thermal correlations at the de Sitter temperature.



Analytic continuation of correlators from Euclidean signature has given a very quick and efficient way to describe the state $\Psi'_\dS$.  This
characterization of the state is also illuminating, as it makes manifest the invariance of the state under the de Sitter symmetry $SO(4,1)$.   However, it is important to also understand
how to describe the state as a functional of the quantum fields on a suitable spacelike hypersurface.  Apart from other applications that will become clear, this will fill 
 a serious gap in the definition of $\Psi'_\dS$.  We described
this state by a set of correlation functions, but to show that there really is a quantum state with those correlation functions, we need to verify a positivity condition
$\la \Psi'_\dS|\O^\dagger \O|\Psi'_\dS\ra\geq 0$, where $\O$ is a general linear combination of products $\phi(x_1)\phi(x_2)\cdots \phi(x_s)$.  This is obvious from  an alternative
definition of $\Psi'_\dS$ that we explain next.

  \begin{figure}
 \begin{center}
   \includegraphics[width=4.8in]{Fig10.pdf}
 \end{center}
\caption{\footnotesize  (a) If $\S$ is an initial value surface in spacetime, a state $\Psi_\sW(\phi_\S)$ of a quantum field $\phi_\S$ on $\S$ can be defined by
a path integral over a Euclidean manifold $\sW$ of boundary $\S$.  In our application, $\S$ is the equator of $S^4$, and $\sW$ is the lower hemisphere.
(b) An expectation $ \la\Psi_\sW|\O_1(x_1)\cdots \O_s(x_s)|\Psi_\sW\ra $ is then computed as follows: a path integral on the lower hemisphere of $S^4$
computes the ket $|\Psi_\sW\ra$, and a path integral on the upper hemisphere of $S^4$ similarly computes the bra $\la \Psi_\sW|$.   To compute the matrix
element, the two hemispheres are glued together with insertion of $\O_1(x_1)\cdots \O_s(x_s) $ on the equator.   The upshot is that 
$ \la\Psi_\sW|\O_1(x_1)\cdots \O_s(x_s)|\Psi_\sW\ra $ is computed by a path integral on $S^4$ with the indicated operator insertions.
  \label{hemisphere}}
\end{figure} 

With this aim, we first note that as the relation $t=\i \tE$ implies that $t=0$ coincides with $\tE=0$, it follows that the Euclidean hypersurface $\tE=0$ coincides
with the Lorentz signature hypersurface $t=0$, so a state defined by Euclidean methods at $\tE=0$ can be viewed as a state defined in Lorentz signature at $t=0$.
In Euclidean signature, one frequently useful way to define a quantum state on a hypersurface $\S$ is to do a path integral on a manifold $\sW$ of boundary $\S$
as a function of the boundary values on $\S$.   We will call this state $\Psi_\sW(\phi_\S)$, where $\phi_\S$ represents a generic quantum field on $\S$.
The general definition of $\Psi_\sW(\phi_\S)$ is (fig. \ref{hemisphere}(a))
\be\label{tolox}\Psi_\sW(\phi_\S)=\int_{\left.\phi_\sW\right|_\S=\phi_\S}  D\phi_\sW\, e^{-I(\phi_\sW)},\ee
where $\phi_\sW$ schematically represents a quantum field on $\sW$, $I(\phi_\sW)$ is the corresponding action, and the integral is over all fields $\phi_\sW$ on $\sW$ that
coincide with $\phi_\S$ on $\S$. The state $\Psi_\sW$ is unnormalized; we do not divide this path integral by any normaiization factor.
 To implement the definition (\ref{tolox})  in the case at hand, we note from eqn. (\ref{oggo}) that in the  description of Euclidean de Sitter space
as a four-sphere, $\tE=0$ corresponds to $X_1=0$.   For a manifold whose boundary is  the hypersurface $\S$ defined by $X_1=0$, we can take the ``lower'' hemisphere
$\sW$ defined by $X_1\leq 0$.   

With these choices,  the state $\Psi_\W$ actually coincides with $\Psi'_\dS$.   To see this, let us first compare expectation values in the two states of a general product of local
operators $\O_1(x_1)\cdots \O_s(x_s)$, where $x_1,\cdots, x_s$ are  points\footnote{The points must be distinct in order for the matrix elements that we will discuss
to be well-defined.}   in $\S$.   To compute
\be\label{herbo}  \la\Psi'_\dS|\O_1(x_1)\cdots \O_s(x_s)|\Psi'_\dS\ra, \ee
with general points $x_1,\dots, x_s$ in de Sitter space of Lorentz signature, in general we are supposed to start with correlation functions on $S^4$ 
and then analytically continue from real $\tE$ to  real $t$.   However, in the particular case that the operators are all inserted in $\S$, no analytic continuation is necessary
because $\S$ already lies at real $t$, indeed at $t=0$.   So the definition of the state $\Psi_\dS$ tells us that the correlation function (\ref{herbo}) is to be computed by
a path integral on $S^4$ with the operators inserted on the equator $\S$.

Now let us compare this to the corresponding expectation value
\be\label{herbox}  \la\Psi_\sW|\O_1(x_1)\cdots \O_s(x_s)|\Psi_\sW\ra \ee
in the state $\Psi_\sW$.   To compute this expectation value, we represent the ket $|\Psi_\sW\ra$ by a path integral on the lower hemisphere
$X_1\leq 0$, and  the bra $\la\Psi_\sW|$ by a path integral on the upper hemisphere $X_1\geq 0$.   An inner product $\la\Psi_\sW|\Psi_\sW\ra$ would be computed by a path integral on the sphere obtained by gluing together the two hemispheres.
To compute the desired expectation value  of $\O_1(x_1)\cdots \O_s(x_s)$, we glue the hemispheres together in the same way but now  with insertion
of $\O_1(x_1)\cdots \O_s(x_s)$ on their common boundary $\S$ (fig. \ref{hemisphere}(b)).  But this just builds up a path integral on $S^4$ with the desired operator insertions on $\S$ -- the
same recipe that computes the corresponding expectation value in the state $\Psi'_\dS$.   So we conclude that
\be\label{nerbo} \la\Psi'_\dS|\O_1(x_1)\cdots \O_s(x_s)|\Psi'_\dS\ra = \la\Psi_\sW|\O_1(x_1)\cdots \O_s(x_s)|\Psi_\sW\ra \ee
for arbitrary local operators $\O_1,\cdots, \O_s$ inserted  on the equator $\S$.

Is the restriction to insertions on $\S$ essential?   The answer to this question is ``no,'' basically because if $\O(x)$ is a local operator, then its derivatives of any finite order
are also local operators.   In free field theory, we can argue as follows.  Let $\phi$ be a free field that obeys, for example, a second order equation of motion.
Write $\dot \phi$ for $\frac{\partial \phi}{\partial \tE}$. 
Then by its equation of motion,  $\phi$ is determined  throughout $S^4$   in terms of the values of $\phi$ and $\dot\phi$ on the initial value surface $\S$, 
along with  the singularities at points where other operators are inserted, which are determined by universal operator product relations.
Hence  the equality (\ref{nerbo}) for points $x_i\in\S$, with the $\O$'s taken independently to be $\phi$ or $\dot\phi$, immediately implies a similar 
equality
\be\label{nerbox} \la\Psi'_\dS|\phi(x_1)\cdots \phi_s(x_s)|\Psi'_\dS\ra = \la\Psi_\sW|\phi(x_1)\cdots \phi(x_s)|\Psi_\sW\ra \ee
for any $x_1,\cdots,x_s$ in de Sitter space.   In free field theory, this suffices to show that $\Psi_\dS=\Psi_\sW$.

To reach the same conclusion in a non-free theory, we  use the fact that if $\O$ is a local operator, then so are its $t$ derivatives of any order.  
The basic idea is to try to expand a local operator $\O(t,x)$ that depends on both $t$ and a point $x\in \S$ as a sum of local operators at $t=0$.  For a local operator $\O(t,x)$
that depends on both the time $t$ and a point $x\in \S$, 
let $\O^{[k]}(x)=\left.\frac{\partial^k\O(t,x)}{\partial t^k}\right|_{t=0}$.   Then inside any matrix element in which this series converges, we can expand
\be\label{zdonk}\O(t,x)=\sum_{k=0}^\infty \frac{t^k}{k!}\O^{[k]}(x). \ee
We want to generalize eqn. (\ref{nerbo}) to a statement about operators $\O_i(t_i,x_i)$, that depend on time variables $t_i$ as well as the points $x_i\in\S$.
We make the expansion (\ref{zdonk}) for each of the operators involved.   Term by term we have an equality
\be\label{nerboxx} \la\Psi'_\dS|\O_1^{[k_1]}(x_1)\cdots \O^{[k_s]}_s(x_s)|\Psi'_\dS\ra = \la\Psi_\sW|\O^{[k_1]}_1(x_1)\cdots \O^{[k_s]}_s(x_s)|\Psi_\sW\ra\ee
since all operators involved are local operators  inserted on $\S$ and (\ref{nerbo}) holds for any such operators.
For distinct points $x_i$ and $x_j$ in $\S$, the points $(t_i,x_i)$ and $(t_j,x_j)$ are spacelike separated if $|t_i|$ and $|t_j|$ are small enough.   
Hence the left and right hand sides of the relation 
\be\label{werbo} \la\Psi'_\dS|\O_1(t_1,x_1)\cdots \O_s(t_s,x_s)|\Psi'_\dS\ra = \la\Psi_\sW|\O_1(t_1,x_1)\cdots \O_s(t_s,x_s)|\Psi_\sW\ra \ee
have power series expansions around $t_1=\cdots=t_s=0$  that are convergent for sufficiently small $|t_i|$.   So the term by term equality (\ref{nerbo}) implies
an equality for sufficiently small $|t_i|$, and hence for all $t_i$ by analyticity.   This is enough to show that $\Psi'_\dS=\Psi_\sW$.   Among other things, this confirms that $\Psi'_\dS$
is a quantum state; the original definition of $\Psi'_\dS$ by specifying a set of correlation functions did not imply that it has the positivity properties of a quantum state.  It was indeed not obvious
from the original definition that $\la \Psi'|\O^\dagger \O|\Psi'\ra\geq 0$ for all $\O$, where $\O$ is a general linear combination of products $\phi(x_1)\phi(x_2)\cdots \phi(x_s)$.


The equality $\Psi'_\dS=\Psi_{\sW}$ has a more simple analog in Minkowski space that was important in section \ref{rindler}.   The Minkowski space analog of $\Psi'_\dS$ is simply
the vacuum state $\Omega$.  The Minkowski space analog of $\Psi_\sW$ is the state prepared by a path integral on a half-space as in fig. \ref{Five}(a).   In the case of Minkowski
space, the usual argument that these states coincide is as follows.      A path integral over an infinite Euclidean
time (in this case, the Euclidean time elapsed in the half-space) projects onto the ground state, the state of minimum energy.   In Minkowski space, the vacuum state $\Omega$
is the unique state of minimum energy.  Therefore, a path integral on the Euclidean half-space prepares the vacuum state.   The reason that we cannot make a similar argument
in de Sitter space is that the state $\Psi'_\dS$ does not minimize anything.   Indeed, though a quantum field in a background de Sitter space has an $SO(4,1)$ symmetry group,
none of the $SO(4,1)$ generators are bounded below, because none of the corresponding Killing vector fields are everywhere future directed causal.   For example, the
Killing vector field  that is related to the conserved charge $H$, and that maps the observer worldline forwards in time in a sense described earlier,
 is future directed timelike in the static patch causally accessible to the observer,
but not elsewhere.
 
   \begin{figure}
 \begin{center}
   \includegraphics[width=4.1in]{Fig11.pdf}
 \end{center}
\caption{\footnotesize (a) 
 The operator $\exp(-\theta\varrho H_r)$ can be represented by a path integral on a wedge in $S^4$ obtained by rotating the three-dimensional hemisphere
 $\S_r$ through a Euclidean angle $\theta$, as in fig. \ref{Eight}(a) in the analysis of  Rindler space.
   (b) Setting $\theta=2\pi$, we get the density matrix appropriate for observations in $\S_r$ or more generally in the static patch $\P_r$, apart from a normalization factor.   (c)
Setting $\theta=\pi$, we recover the definition of the state $\Psi'_\dS$. We learn that the normalized state $\Psi_\dS$ is the thermofield double state of the two entangled regions $\S_\ell$ and $\S_r$,
or, after continuing to Lorentz signature, of their domains of dependence, namely the static patches
$\P_\ell$ and $\P_r$.
  \label{splittingx}}
\end{figure} 
 
 
 That is why the proof that $\Psi'_\dS=\Psi_{\sW}$ required a much more elaborate argument than is needed to justify the corresponding statement in Minkowski space.
 But once we know that $\Psi'_\dS=\Psi_{\sW}$, it is straightforward to imitate all of the arguments and conclusions of the analysis of Rindler space in 
 section \ref{division}. That should not be a great surprise, given the analogy between de Sitter space and Rindler space that was explained earlier.   We will express the
 following results in an informal language.\footnote{As in footnote \ref{notable}, the Hilbert space decomposition and splitting of $H$ assumed shortly
 are  not truly correct in continuum quantum field theory.
 There is an alternative rigorous formulation in terms of Tomita-Takesaki theory.}
   Split the 
  the surface $\S$ as $\S_\ell\cup \S_r$, where $\S_r$ is the part of $\S$ to the right of the horizon and $\S_\ell$ is the part to the left (fig. \ref{desitter}).   Thus $\S_\ell$ and $\S_r$
  are the ``left'' and ``right'' hemispheres in $\S$.
  Correspondingly, split the Hilbert space of the theory as
   \be\label{welfo}\H=\H_\ell\otimes \H_r,\ee
 where $\H_\ell$ and $\H_r$ describe degrees of freedom on $\S_\ell$ and $\S_r$, respectively.
 The symmetry generator $H$ can be defined as an integral over $\S$,
 \be\label{tunigo}H=\int_\S \d \Sigma^\mu T_{\mu\nu} V^\nu,\ee
 where $T_{\mu\nu}$ is the stress tensor, $V^\nu$ is the Killing vector field on de Sitter space associated to the conserved charge $H$, 
 and $\d\Sigma^\mu$ is the appropriate integration form on $\S$.
 Similarly to the splitting of the boost generator $K$ in eqn. (\ref{lboost}), split $H$
 as 
 \be\label{zongo}H=H_r-H_\ell,\ee
 where $H_r$ and $H_\ell$ are defined by integrals similar to eqn. (\ref{tunigo}) restricted to $\S_r$ or $\S_\ell$.
So formally $H_r$ acts on $\H_r$ and $H_\ell$ acts on $\H_\ell$.

Given the state $\Psi_\dS\in\H$, we want to understand the corresponding reduced density matrices $\sigma_r$ and $\sigma_\ell$ that act on $\H_r$
and $\H_\ell$, respectively.   In Lorentz signature,
similarly to what happens in  Rindler space, $\P_r$ is the domain of dependence of $\S_r$ and $\P_\ell$ is the domain of dependence of $\S_\ell$.    
So $\sigma_r$ is the appropriate density matrix for observations in the static patch $\P_r$ and likewise
$\sigma_\ell$ is the appropriate density matrix for observations in $\P_\ell$. In other words,  if $\O$ is any operator in the region $\P_r$, then  $ \la\Psi_\dS|\O|\Psi_\dS\ra=\Tr\,\O\sigma_r$,
with a similar formula in $\P_\ell$.
It will be convenient to introduce unnormalized density matrices 
\be\label{unnorm}\sigma_\ell=\frac{\sigma'_\ell}{Z},~~\sigma_r=\frac{\sigma'_r}{Z}.\ee
Thus for any operator $\O$ in $\P_r$, 
$\la\Psi'_\dS|\O|\Psi'_\dS\ra=\Tr\,\O\sigma'_r,$
and similarly for $\P_\ell$.   


The main claims are as follows.  
Similarly to what happens in Rindler space, one has 
 \be\label{wingo} \sigma'_\ell=\exp(-2\pi \varrho H_\ell),~~~~~\sigma'_r=\exp(-2\pi \varrho H_r). \ee
 Hence
  \be\label{wingot} \sigma_\ell=\frac{1}{Z}\exp(-2\pi \varrho H_\ell),~~~~~\sigma_r=\frac{1}{Z}\exp(-2\pi \varrho H_r). \ee
 Thus observations in $\P_r$ or $\P_\ell$ are thermal with Hamiltonian $H_r $ or $H_\ell$ at the de Sitter temperature
 $T_\dS=1/2\pi \varrho$.
    And also in analogy with Rindler space,
 the pure state $\Psi_\dS\in \H_\ell\otimes \H_r$ can be viewed as the thermofield double state $\Psi_\TFD$ of the entangled pair $\P_\ell$ and $\P_r$.

 Once one knows that $\Psi'_\dS=\Psi_{\sW}$, the proofs of these statements precisely parallel the corresponding arguments concerning Rindler space.  As in fig. \ref{splittingx}(a)
 (and as in fig. \ref{Eight} in the case of Rindler space),
 one interprets the operator $\exp(-\theta \varrho H_r)$ (or $\exp(-\theta \varrho H_\ell)$) in terms of a path integral on a wedge defined by rotating $\S_r$ (or $\S_\ell$) inside $S^4$
 through a Euclidean
 angle $\theta$.   Setting $\theta=2\pi$ as in fig. \ref{splittingx}(b), this path integral computes $\sigma'_r$ (or $\sigma'_\ell$), leading to the statements (\ref{wingo}) and hence (\ref{wingot}).
 Since the thermal density matrix of $\P_r$ is  $\frac{1}{Z}\exp(-2\pi\varrho H_r)$, the thermofield double state is  $\Psi_\TFD=\frac{1}{\sqrt Z}\exp(-\pi \varrho H_r)$.   But $\exp(-\pi\varrho H_r)$, which rotates $\S_r$ through an angle $\pi$ (fig. \ref{splittingx}(c)), is represented by the path integral
 on the lower hemisphere of $S^4$ that was the definition of $\Psi_\sW$.  From  $\Psi'_\dS=\Psi_\sW=\exp(-\pi\varrho H_r)$, it follows  that 
 \be\label{zuffy} \Psi_\dS=\frac{1}{\sqrt Z}\exp(-\pi\varrho H_r)=\Psi_\TFD.\ee
 
All of this has been quantum field theory in a fixed background de Sitter spacetime.   Now we will consider gravity.
Gibbons and Hawking proposed that not only does quantum field theory in de Sitter space have the thermal interpretation that we have explained, but in the context of gravity,
$\frac{A}{4G}$, where as usual $A$ is the horizon area, is an entropy, which they said ``measures the lack of information of the observer about the regions which he cannot see.'' 
In many respects, de Sitter entropy is  less well understood than black hole entropy.  But pragmatically, we can ask how to compute the   de Sitter entropy by Euclidean path integrals.   In the case of a black hole in an asymptotically flat or asymptotically AdS
spacetime, the Euclidean path integral  is interpreted as $e^{S-\beta E}=e^{-\beta F}$, where $E$ is the energy and $F$ is the free energy.   The energy that
appears in this formula is the ADM energy measured at spatial infinity. As de Sitter space is a closed universe, there is no spatial infinity so there is no conserved
charge analogous to the energy that could appear in such a formula.\footnote{At $G=0$, which corresponds to studying quantum fields in a fixed background spacetime, one has conserved charges associated to the $SO(4,1)$ symmetry of de Sitter space.   None of these charges is bounded below, since none of the corresponding Killing vector fields is everywhere future-directed  timelike.
 As soon as $G>0$, these conserved charges
become constraints that annihilate physical states.  They do not remain as operators in the quantum theory.}   It is proposed therefore that the Euclidean path integral for gravity and possibly other fields in de Sitter space should be interpreted simply
 as $e^S$.
In the semiclassical limit, this would be approximated as $e^{-I}$, where $I$ is the action, so the semiclassical formula is just $S=-I$.
  Since the Einstein equations with a cosmological constant imply (in four dimensions) that $R=4\Lambda$, the
form (\ref{difo}) of the Einstein-Hilbert action with a cosmological constant implies that 
\be\label{invo} I=-\frac{\Lambda V}{8\pi G},\ee
where $V$ is the volume of the Euclidean solution.  
As a four-sphere of radius $\varrho$ has volume $\frac{8\pi^2}{3}\varrho^4$, we find, with $\Lambda=\frac{3}{\varrho^2}$,  that the action is $-\frac{\pi \varrho^2}{G}$.  The horizon
is a two-sphere of radius $\varrho$ and area $4\pi\varrho^2$, so this  result for the action implies the expected
\be\label{melme}S=-I=\frac{A}{4G}.\ee
It is also possible to adapt the reasoning of section \ref{acomp} and prove directly  that $I=-\frac{A}{4G}$ without computing either $I$ or $A$.  

Eqn. (\ref{invo}) is applicable for the action of any solution of Einstein's equations with a cosmological constant and shows that for $\Lambda>0$, the action is a negative
multiple of the volume.  So one might expect the dominant solution to be the one of largest volume. In any dimension, among classical solutions of Einstein's equations with $\Lambda>0$, a  sphere has maximum volume.   This is proved in
\cite{bc}, p. 254; there is also a nice explanation in the Wikipedia article  ``Bishop-Gromov Inequality.''
Hence  it has been proposed that for small $G$, with $\Lambda>0$, the sum over topologies in  the Euclidean path integral of gravity is dominated by the Euclidean version of de Sitter space.



\subsection{The Thermofield Double State of a Black Hole}\label{thermofield}

For quantum fields propagating in the  Schwarzschild black hole spacetime, 
there is a close analog of the state $\Psi_\dS$,  sometimes called the Hartle-Hawking-Israel
state  $\Psi_\HHI$ \cite{HH,I}.   This state describes
a black hole in equilibrium with radiation at the Hawking temperature.  In constructing this state and describing its basic properties, it does not matter much
whether the cosmological constant is zero or negative.\footnote{There is no such construction with positive cosmological constant.  There exists a spherically
symmetric dS-Schwarzschild solution with $\Lambda>0$, but because the black hole and cosmological horizons have different temperatures, an equilibrium state
does not exist.}  For definiteness, we consider the case $\Lambda=0$ and make some brief remarks about the case $\Lambda<0$ at the end.

We recall the Schwarzschild solution
\be\label{tonzo}\d s^2=-\left(1-\frac{2GM}{r}\right)\d t^2+\frac{\d r^2}{1-\frac{2GM}{r}}    + r^2\left(\d\theta^2+\sin^2\theta \d\varphi^2\right) \ee
and its Euclidean continuation with $t=-\tE$:
 \be\label{tonzox}\d s^2=\left(1-\frac{2GM}{r}\right)\d \tE^2+\frac{\d r^2}{1-\frac{2GM}{r}}+ r^2\left(\d\theta^2+\sin^2\theta \d\varphi^2\right). \ee

As in the case of the de Sitter invariant state $\Psi_{\dS}$, we will consider two different ways to characterize the state $\Psi_\HHI$.
The equivalence of the two can be proved the same way that we proved $\Psi'_\dS=\Psi_\sW$ in section \ref{cosmo}.
First, we can define $\Psi_\HHI$ by saying that correlation functions in this state are analytic continuations from Euclidean signature.
In other words, with $\phi$ a generic quantum field, we begin by considering correlation functions defined by path integrals on the Euclidean Schwarzschild spacetime:
\be\label{winkly} \bigl\la \phi(t_{{\sf E},1},r_1,\theta_1,\varphi_1)\phi(t_{{\sf E},2},r_2,\theta_2,\varphi_2)\cdots \phi(t_{{\sf E},n},r_n,\theta_n,\varphi_n)\bigr\ra_{\ES}. \ee
Then we analytically continue to imaginary values of $t_{{\sf E},1},t_{{\sf E},2},\cdots,t_{{\sf E},n}$, which correspond to real values of $t_1,t_2,\cdots,t_n$,
to define the corresponding correlation functions in a state that we call  $\Psi'_\HHI$:
\be\label{inky}\la\Psi'_\HHI|\phi(t_1,r_1,\theta_1,\varphi_1)\phi(t_2,r_2,\theta_2,\varphi_2)\cdots \phi(t_n,r_n,\theta_n,\varphi_n)|\Psi'_\HHI\ra. \ee
This suffices to characterize the state $\Psi'_\HHI$.   The correlation functions in eqn. (\ref{winkly}) are unnormalized, so the state $\Psi'_\HHI$ is unnormalized.
By definition, $\la\Psi'_\HHI|\Psi'_\HHI\ra=\la 1\ra_{\ES}=Z$, where $Z$ is the path integral on the Euclidean Schwarzschild spacetime  with no operator insertion.
So the normalized version of the state that we have defined is
\be\label{normver}\Psi_\HHI=\frac{1}{\sqrt Z}\Psi'_\HHI.\ee  

From this construction, it is immediate that $\Psi_\HHI$ has a simple interpretation far from the black hole.  For $r\gg 2GM$, the Euclidean Schwarzschild spacetime is
asymptotically $ \R^3\times S^1$, with the circumference of $S^1$ being the inverse of the Hawking temperature $T_\sH$.  Since a path integral on $\R^3\times S^1$ with that value of the
circumference describes a thermal ensemble at temperature $T_\sH$, we conclude that far from the black hole the correlation functions in the state $\Psi_\HHI$ reduce to thermal
correlators at that temperature.   Actually, since in eqn. (\ref{inky}) we have analytically continued from Euclidean time to real time, these correlation functions, at $r\gg 2GM$,
are real time correlators in a thermal ensemble.   

 The state $\Psi_\HHI$ is time-independent, since the correlators (\ref{inky}) are certainly invariant under time translations.  So it describes an equilibrium state of thermal radiation
 at the Hawking temperature interacting with a black hole.    These statements apply in the limit $G\to 0$.   Beyond that limit, one will encounter instabilities described in section
 \ref{unstable}. In the case $\Lambda<0$, $\Psi_\HHI$ can be  defined precisely as we have just done, and the instabilities are avoided if the black hole mass is big enough.
 
The state $\Psi_\HHI$ has a surprising property that is somewhat hidden in the way we have presented it and is more obvious in an alternative description of $\Psi_\HHI$ as a functional
of quantum fields on an initial value surface $\S$.   To find this alternative construction, one can  imitate 
 the procedure that we followed in section \ref{cosmo} in the case of de Sitter space, but care is needed.
 In analyzing de Sitter space, we observed that the relation $t=-\i \tE$ implies that the Lorentz signature hypersurface $t=0$ coincides with the Euclidean signature hypersurface $\tE=0$.
This suggested to define the quantum state on the $\tE=0$ hypersurface, which in the case of de Sitter space can be immediately interpreted as a Cauchy hypersurface in Lorentz
signature.

If we do precisely this in the case of a black hole, we run into a snag.  The problem can be seen if we recall that the near horizon geometry of the Euclidean black hole,
after changing variables from $r$ to a suitable variable $\t r$ that vanishes on the horizon is (as in eqn. (\ref{wefto}))
\be\label{uto}\d s^2=\frac{\t r^2 \d\tE^2}{(4GM)^2}+\d \t r^2.\ee
plus the metric of a two-sphere of radius $2GM$.   Eqn. (\ref{uto}) describes $\R^2$ in polar coordinates if $\tE$ is regarded as a polar angle of period $8\pi GM$.
Thus the condition $\tE=0$ defines a ray in $\R^2$, ending at the horizon, which is the origin of polar coordinates at $\t r=0$.  Hence an attempt to define a Cauchy hypersurface
by a condition $\tE=0$ will fail: this condition defines a partial Cauchy hypersurface, a manifold with a boundary at the horizon.

Instead, we should slightly modify the approach and define $\S$ to be the fixed point set of the time-reversal symmetry $t\leftrightarrow -t$. 
As we noted in section \ref{disappears}, this symmetry is the reason that  the Schwarzschild solution has a continuation to Euclidean signature.
  In Lorentz signature, the fixed point set of $t\leftrightarrow -t$ is simply the hypersurface
$t=0$.  In Euclidean signature, the symmetry $t\leftrightarrow -t$ becomes $\tE\leftrightarrow -\tE$.  Since $\tE$ is a periodic variable of period $\beta_\sH=8\pi GM$, the transformation $\tE\leftrightarrow -\tE$ actually
has fixed points both at $\tE=0$ and at $\tE=\frac{1}{2}\beta_\sH$.  In the copy of $\R^2$ described in eqn. (\ref{uto}), the two rays $\tE=0$ and $\tE=\frac{1}{2}\beta_\sH$ fit together
into  a copy of $\R$ that actually is a geodesic.   This is no coincidence; the fixed point set of a symmetry of a manifold is  always a submanifold, never a submanifold with boundary.  The problem
with defining a submanifold by $\tE=0$ was that $\tE$ fails to be a good coordinate at the horizon.

   \begin{figure}
 \begin{center}
   \includegraphics[width=4.1in]{Fig12.pdf}
 \end{center}
\caption{\footnotesize  
This two-dimensional surface of revolution is the restriction of the Euclidean Schwarzschild spacetime   to fixed values of the polar angles $\theta,\phi$. The ``tip''
  of the ``cigar'' represents the black hole horizon at $r=2GM$.   The time-reversal symmetry $\tE\leftrightarrow -\tE$ acts as a reflection of the surface, leaving fixed the tip. 
 The  fixed point set $\S$ of time-reversal  is a copy of $\R$ that comes in from $r=\infty$, bends around the tip of the cigar,  and returns to $r=\infty$.  \label{cigar}} 
\end{figure} 
 

We can visualize the essential aspects of the Euclidean black hole metric   eqn. (\ref{tonzox})  if we restrict to some fixed value of the polar angles $\theta,\varphi$.
The restriction is a two-manifold $U$, parametrized by $r$ and $\tE$, with line element
\be\label{revsurf} \d s^2=\left(1-\frac{2GM}{r}\right)\d \tE^2+\frac{\d r^2}{1-\frac{2GM}{r}}.\ee
  $U$  is a surface of revolution because $\tE$ is an angular variable and the metric is invariant under
 constant shifts of $\tE$.   Since the asymptotic
circumference of the circles  parametrized by $\tE$ is a constant $\beta_\sH$, $U$ is roughly a semi-infinite cigar (fig. \ref{cigar}).   In this picture, we can visualize the codimension one fixed point set  $\S$
of the symmetry $\tE\leftrightarrow -\tE$.   Starting in the asymptotic region at large $r$ on the ``near'' side of $U$ at $\tE=0$, $\S$ continues inward all the way to the horizon
at $r=2GM$, which is the ``tip'' of the cigar,
and then returns back to large $r$  on  the ``far'' side of $U$ at $\tE=\frac{1}{2}\beta_\sH$.

Now that we have defined a hypersurface $\S$ in the Euclidean Schwarzschild spacetime, we can describe  the state $\Psi'_\HHI$
by a path integral on a manifold  $\sW$ with boundary $\S$.   We can define $\sW$ by $0\leq \tE\leq \frac{1}{2} \beta_\sH$, for example, corresponding to the bottom (or top)
half of the surface of revolution in fig. \ref{cigar}.  Then we define $\Psi'_\HHI$ by a path integral on $\sW$ with fixed boundary values on $\S$:
\be\label{omigo} \Psi'_\HHI(\phi_\S)=\int_{\left.\phi_\sW\right|_{\S}=\phi_\S}D \phi_\sW \,e^{-I(\phi_\sW)}. \ee
That the two definitions of $\Psi'_\HHI$ are equivalent follows from precisely the same argument that we used in section \ref{cosmo} to show that $\Psi'_\dS=\Psi_\sW$.

   \begin{figure}
 \begin{center}
   \includegraphics[width=5.1in]{Fig13.pdf}
 \end{center}
\caption{\footnotesize   The Penrose diagram of the extended asymptotically flat Schwarzschild spacetime. $\U_\ell$ and $\U_r$ are the two asymptotically 
flat regions at infinity.  They are bounded by 
past and future horizons labeled  $H^+$ and $H^-$.
$\mathcal S$ is the initial value surface that in the Euclidean picture is depicted in fig. \ref{cigar}. It passes from the asymptotically flat region on the left, through the ``wormhole''
and into the asymptotically flat region on the right.   The arrows indicate the action of the Killing vector field $h$
that generates time translations outside the horizon in the original Schwarzschild solution.   It is future-directed timelike in the asymptotically flat region on the right,
past-directed timelike in the asymptotically flat region on the left, and spacelike in other regions.
  \label{PenroseB}}
\end{figure} 

Since the state $\Psi_\HHI$ can be described as a functional of quantum fields on $\S$, it has a Lorentz signature interpretation as a quantum state of fields in the spacetime
to which $\S$ evolves.   Here we run into a remarkable phenomenon, which will not  surprise readers who are already familiar with the analytic
continuation of the Schwarzschild solution beyond the horizon.   In Euclidean signature, the hypersurface $\S$ has two ``ends,'' both of them at $r\to\infty$ but with $\tE$ equal to 0  or $\frac{1}{2}\beta_\sH$.   These ends are completely equivalent because of the symmetries of the Euclidean Schwarzschild solution.
Correspondingly, the Lorentz signature spacetime for which $\S$ supplies initial data has two equivalent asymptotically flat regions at infinity, joined by a sort of ``wormhole'' and
separated by a common horizon.  

 This spacetime is a real analytic  extension of the original Schwarzschild spacetime and was
 discovered well before the dawn of black hole thermodynamics.   The full analytic extension of the Schwarzschild spacetime is most efficiently seen using the Kruskal-Szekeres
coordinates, which we used for a more limited purpose in section \ref{bhevaporation}:
 \begin{align}\label{KScoords} U&=-\left(\frac{r}{2GM}-1\right)^{1/2} e^{r/4GM} e^{-t/4GM} \cr
                                 V&=\left(\frac{r}{2GM}-1\right)^{1/2} e^{r/4GM} e^{t/4GM}.\end{align}
 In Schwarzschild coordinates used in eqn.  (\ref{tonzo}), the metric is singular at $r=2GM$.   The exterior of the horizon at  $r>2GM$  corresponds in the coordinates (\ref{KScoords})
 to $U<0$, $V>0$.   In terms of $U$ and $V$, the Schwarzschild metric becomes
   \be\label{newmet} \d s^2=-\frac{32 G^3 M^3}{r} e^{-r/2GM} \,\d U \, \d V +r^2\d\Omega^2,\ee
                   with $r$ defined implicitly as a function of $U$ and $V$ by
                     \be\label{nimpdef} -UV =\left(\frac{r}{2GM}-1\right) e^{r/2GM}. \ee
   In these coordinates, the metric remains perfectly smooth at $r=2GM$, so the spacetime smoothly continues past the horizon.   However, curvature invariants in the Schwarzschild
   geometry diverge at $r=0$, so we limit these formulas to $0<r<\infty$, which corresponds to $UV<1$.    The extended Schwarzschild geometry has a symmetry $U\leftrightarrow -V$,
   so in addition to the ``original'' asymptotically flat black hole exterior at $U<0$, $V>0$, there is an isomorphic ``second'' copy at $U>0$, $V<0$.      A Penrose diagram is shown
   in fig. \ref{PenroseB}.              The spacelike hypersurface $\S$ is defined by $U=-V$, which generalizes the more naive condition $t=0$.    $\S$ extends from one
   asymptotically flat region at $U,-V\gg 0$ to the other one at $U, -V\ll 0$, passing through a\footnote{This wormhole is sometimes called
   the Einstein-Rosen bridge \cite{EinsteinRosen}, as those authors understood this aspect of the surface $\S$, though not the full picture exhibited by the Kruskal-Szekeres coordinates.} 
``wormhole'' near $U=V=0$.      
   The diagonals in the Penrose diagram with $U$ or $V$ vanishing represent past and future horizons for
   observers to the left or right of the horizon.  Details are hopefully clear from the Penrose diagram.
   
   What about the ``time translation'' symmetry of the extended Schwarzschild spacetime generated by  the vector field $h=\frac{\partial}{\partial t}$, which is associated
   to conservation of energy?  
   In Kruskal-Szekeres coordinates, we find that
   \be\label{ksboost}h= \frac{1}{4GM}\left(V\partial_V-U\partial_U\right). \ee
   Apart from the factor of $\frac{1}{4GM}$, this is a Lorentz boost generator $V\partial_V-U\partial_U$.
   Near the bifurcation surface at $U=V=0$, $U$ and $V$ are good inertial coordinates and $h$ looks like the generator of a Lorentz boost. The formula (\ref{ksboost}) tells us
   that the Killing vector field that generates time translations at infinity looks near the bifurcation surface like  $\kappa=\frac{1}{4GM}$ times a Lorentz boost generator $V\partial_V-U\partial_U$. The
   coefficient $\kappa$ in this relationship
   is called the surface gravity of the black hole, and the derivation in section \ref{eucl} shows that the Hawking temperature is $T_H=\frac{\kappa}{2\pi}$.
   
   The Penrose diagram of fig. \ref{PenroseB} has an obvious similarity to the corresponding diagrams of fig. \ref{Seven} for Rindler space and fig. \ref{desitter} for de Sitter space.
   The fundamental reason for this is that what to an observer at infinity in Schwarzschild spacetime is time translation symmetry looks like a Lorentz boost near the horizon, as a result of which 
   the near horizon region of the Schwarzschild spacetime can be modeled by Rindler space.   
      As in Rindler space and de Sitter space, the Penrose diagram of the extended Schwarzschild solution is divided into four ``wedges'' 
 by diagonal lines $U=0$ and $V=0$ that represent past and future horizons  and meet at the bifurcation surface $\Sigma$ defined by $U=V=0$.
   The right wedge with $V>0,U<0$, which we will call $\U_r$, is the region exterior to the black
   hole horizon for an observer in one of the two asymptotically flat ``ends'' of the spacetime.    Spacelike separated from it is the left wedge $\U_\ell$ with $V<0,U>0$, which is the region exterior
   to the black hole horizon for an observer in the opposite asymptotically flat end of the spacetime.  There is also a future wedge $U,V>0$, which an observer in $\U_\ell$ or $\U_r$ cannot
   see, and a past wedge $U,V<0$, which an observer in $\U_\ell$ or $\U_r$ cannot influence.      The vector field $h$ is future-directed timelike in $\U_r$, past-directed timelike in $\U_\ell$,
   and spacelike in the past and future wedges.   In particular, the past and future wedges have no timelike Killing vector field and there is no sense in which they can be considered
   time-independent. 
     
  We decompose
   the initial value surface $\S$ as $\S_\ell\cup \S_r$, where $\S_r$ is the portion at $U<0,\,V>0$, and $\S_\ell$ is the portion at $U>0,\,V<0$.  The domain of dependence 
   of $\S_r$ is the whole outside-the-horizon wedge $\U_r$, and the  domain of dependence of $\S_\ell$ is the whole outside-the-horizon  wedge 
 $\U_\ell$.  Associated to this, we formally split\footnote{The usual remark of footnote \ref{notable} applies again.  The splitting claimed in the text are
   not strictly valid in continuum quantum field theory. Tomita-Takesaki theory supplies a rigorous approach.   (In the context of quantum gravity, as opposed to quantum field
   theory in a fixed background spacetime, the splitting $H=H_r-H_\ell$ is rigorous if $H_r$ and $H_\ell$ are interpreted as the ADM energies at infinity.)}  the Hilbert space as
   \be\label{uddu}\H =\H_\ell\otimes \H_r,\ee
   where $\H_\ell$ and $\H_r$ describe degrees of freedom on $\S_\ell$ or $\S_r$, respectively.  Similarly, we split the conserved charge  $H$ associated to the Killing vector field $h$
   as
   \be\label{wuddu} H=H_r-H_\ell, \ee
   where $H_r$ acts on fields on $\S_r$, and $H_\ell$ acts on fields on $\S_\ell$.   $H_r$ is the natural Hamiltonian that generates time translations in $\U_r$, and
   similarly $H_\ell$ is the natural Hamiltonian in $\U_\ell$.
   
    As in the analysis of Rindler space and of de Sitter space, there are two key statements about this
   setup.  First, the density matrices that describe observations in the state $\Psi_\HHI$ in the regions $\U_r$ and $\U_\ell$ are respectively
   \be\label{pokko}\sigma_r=\frac{1}{Z}\exp(-\beta_\sH H_r),~~\sigma_\ell=\frac{1}{Z}\exp(-\beta_\sH H_\ell),\ee
   where $Z$ is a normalization factor ensuring that $\Tr\,\sigma_r=\Tr\,\sigma_\ell=1$.
This statement confirms that an observer in either asymptotically flat region at large $r$ will see thermal equilibrium at the Hawking temperature.   Second,
   the state $\Psi_\HHI$ can be viewed as the thermofield double state of the two entangled regions $\U_\ell$ and $\U_r$.   Proofs of these
   statements are precisely as in the discussions of Rindler space and of de Sitter space.   One represents the operator $\exp\left(-\theta\frac{\beta_\sH}{2\pi}H_r\right)$
   by a path integral on a wedge obtained by rotating $\S_r$ through an angle $\theta$ inside the Euclidean Schwarzschild spacetime.   Then by setting $\theta=2\pi$,
   one arrives at the claim (\ref{pokko}) concerning $\sigma_r$.  Of course $\sigma_\ell$ is analyzed similarly.  By setting $\theta=\pi$, one deduces that $\Psi_\HHI$ 
   can be interpreted as the thermofield double state that purifies the thermal density matrices $\sigma_r$ and $\sigma_\ell$.
   
   The ``wormhole'' near $U=V=0$ provides a kind of geometrical connection between the asymptotically flat regions $\U_\ell$ and $\U_r$.  However, $\U_\ell$ and $\U_r$
   are spacelike separated and there is no possibility of communicating from one region to the other.  An observer who enters the ``wormhole'' hoping to reach the other side
   will instead end up at the black hole singularity at $UV=1$.   The fact that one cannot transmit information from one side of the wormhole to the other is actually 
   a special case of ``topological censorship'' \cite{topocensor,topotwo} (see for example \cite{Witten} for more on this).\footnote{On the other hand, it is possible for observers entering
   the wormhole from opposite sides to meet in the black hole interior. This is a puzzling fact with no obvious counterpart for an ordinary bipartite quantum system.}    Quantum mechanically, $\U_\ell$ and $\U_r$ are entangled
   in the thermofield double state.   In general, entanglement between two quantum systems $\A$ and $\B$ establishes a sort of correlation between them, but  this
   correlation cannot be exploited to transmit information.   Indeed, nothing that one can do to system $\A$ will change the density matrix of system $\B$, or will transmit information to one
   who only has access to system $\B$.   It has been proposed that quantum entanglement in general should be understood as some sort of generalization of the
   wormhole that connects the two ends of the Schwarzschild geometry \cite{MaldaSuss}.
   
   
      \begin{figure}
 \begin{center}
   \includegraphics[width=3.1in]{Fig14.pdf}
 \end{center}
\caption{\footnotesize   The Penrose diagram of an AdS-Schwarzschild spacetime.   As in the case of an asymptotically flat Schwarzschild spacetime, there are two distinct
outside-the-horizon regions $\U_\ell$ and $\U_r$, connected by a ``wormhole.'' The conformal boundary of $\U_\ell$ is a copy of $S^2\times\R$, represented by the left
edge of the diagram; the conformal boundary of $\U_r$ is another copy of $S^2\times \R$, represented by the right edge.  The diagonal lines represent the past and future horizons of an observer
living in $\U_\ell$ or $\U_r$.  The arrows represent the action of the Killing vector field $h$ that generates time translations in the region $\U_r$;
it is future-directed timelike  in $\U_r$, past-directed timelike in $\U_\ell$, and spacelike in other regions.  Near the bifurcation surface $\Sigma$, it looks like the generator of a Lorentz
boost, as in Rindler space.  
  \label{PenroseC}}
\end{figure} 



All this, including the definition and properties of the state $\Psi_\HHI$ and the extension of the spacetime beyond the horizon to reveal a second asymptotic region, works
 in precisely the same way for the AdS-Schwarzschild solution, whose thermodynamics we studied in section \ref{negative}. 
The main difference is that 
 the boundary of the Penrose diagram outside the horizon
is timelike (fig. \ref{PenroseC}), rather than null as in the asymptotically flat case.  
 This timelike boundary represents the conformal boundary of the extended AdS-Schwarzschild spacetime.
It consists of two copies of the Einstein static universe $\R\times S^2$, one for each of the two asymptotically AdS regions of the spacetime.
In the  AdS-Schwarzschild  case, if the black hole is sufficiently massive, the state $\Psi_\HHI$ is not affected by any thermodynamic instability.  This state  is believed to be well-defined
to the extent that the bulk gravitational theory is well-defined.  In particular, in those cases in which a boundary CFT dual is known, and therefore it is believed that the bulk
gravitational theory is completely well-defined, it is believed that the state $\Psi_\HHI$ is completely and nonperturbatively well-defined.   Indeed, it is simply the dual, in AdS/CFT duality,
of the thermofield double state of a pair of entangled CFT's living at the two timelike boundaries of the Penrose diagram.  This thermofield double state is well-defined for any 
thermal quantum system.


 \section{Two Notions of Entropy}\label{twonotions}
 
 \subsection{Von Neumann Entropy}\label{vn}
 
 So far in this article, ``entropy'' has referred to thermodynamic entropy $S_\th$, which in ordinary physics obeys the Second Law
 \be\label{secondlaw}\frac{\d S_\th}{\d t}\geq 0,\ee
 with $t$ the time.   However, a more microscopic point of view about entropy has turned out to be important in understanding black holes.   Though we could start
 with classical physics, for brevity we will consider the quantum case.  A quantum mechanical system with Hilbert space $\H$ in a general,
 possibly ``mixed'' state has a density matrix $\rho$,  which is a positive operator on $\H$ with $\Tr\,\rho=1$.
The von Neumann entropy of $\rho$  is defined by
 \be\label{vonN} S_\vN(\rho)=-\Tr\,\rho\log\rho.\ee
$S_\vN(\rho)$  is invariant under unitary transformations $\rho\to U\rho U^{-1}$.   In particular, it is invariant under 
unitary quantum mechanical evolution with a Hamiltonian $H$; in such evolution, $\rho$ evolves according to $\frac{\d\rho}{\d t}=-\i [H,\rho]$, implying that its eigenvalues
 do not change and
 \be\label{zolk}\frac{\d S_\vN}{\d t}=0. \ee   This remains so even if the Hamiltonian is time-dependent.
  
 The relation between $S_\th$ and $S_\vN$  is that $S_\th$ is the largest that $S_\vN$ can be given the macroscopic
 state of a system:
 \be\label{olk} S_\vN\leq S_\th .\ee
 To explain this inequality, we will work in a microcanonical ensemble. Consider a quantum system that has $N$ states with observed values of the macroscopic
 observables (such as energy, charge, and so on).  The thermodynamic entropy is defined as the logarithm of the number
 of microstates of a system that are consistent with the macroscopic observables.   So if there are $N$ such states, the 
 thermodynamic entropy is $S_\th =\log N$.   What about the von Neumann entropy?   
 A general density matrix $\rho$
 of such a system can be diagonalized
 \be\label{delgo}\rho=\sum_{i=1}^N p_i |i\ra \la i|,\ee
 with orthonormal states $|i\ra$, and nonnegative constants $p_i$ that obey $\sum_i p_i=1$, to ensure $\Tr\,\rho=1$.
 One can interpret the formula to mean that the given system is in state $|i\ra$ with probability $p_i$.  
 The von Neumann
 entropy of a system with this diagonal density matrix is
 \be\label{welgo} S_\vN=-\Tr\,\rho\log\rho=-\sum_{i=1}^N p_i\log p_i.\ee
 A pure state is the case that 
one of the $p_i$ is 1 and the others vanish; then $S_\vN=0$.   Otherwise $S_\vN>0$, as $-x\log x>0$ for $0<x<1$.
 A simple exercise with Lagrange multipliers shows that the maximum of $-\sum_{i=1}^N p_i\log p_i$ under the 
 constraint $\sum_i p_i=1$ is achieved when all $p_i$ are equal to $1/N$, in which case the system is said to be in a maximally mixed state and
 $S_\vN=S_\th=\log N$.
 This accounts for the inequality (\ref{olk}), and shows that the inequality is saturated if and only if all microstates
 consistent with macroscopic observations are equally probable.   To summarize,
 \be\label{delmog} 0\leq S_\vN\leq \log N,\ee
 with the two inequalities saturated respectively for a pure state or a maximally mixed state.
  
The generalized entropy $S_\gen=\frac{A}{4G}+S_\out$  of a black hole is not constant in time and instead is proposed to obey a Generalized Second Law. So it is  a
 version of thermodynamic entropy.    However, microscopic von Neumann entropy is also important
 in understanding black hole thermodynamics.
 
 It can be very hard to know if a system that appears to be in thermal equilibrium is truly in a thermal state with $S_\vN
 =S_\th$, or is really in a state in which $S_\vN\ll S_\th$ with only one or a relatively small number of the $p_i$ being nonzero.   That is because,
 since the states $|i\ra$ in this discussion are by hypothesis  microstates consistent with the macroscopic properties of the system, they are hard to distinguish.
 A strong version of this statement is the Eigenvalue Thermalization Hypothesis (ETH), which says that for a generic macroscopic quantum system, generic microstates
 (usually taken to be energy eigenstates) cannot be distinguished from a thermal ensemble by any reasonably simple measurement \cite{ETH,ETH2}.  A simple measurement
 is, for example, a measurement of an $n$-point correlation function, where $n$ is a fixed number independent of the  number of atoms in the system under study (which, near the
 thermodynamic limit,  is presumed
 to be much larger than $n$).
 
 One can view von Neumann entropy as the natural microscopic definition of entropy, if one is able to probe all of the microscopic details of a system.
 It has been called the fine-grained entropy.   By contrast, if one ignores the differences between states that cannot be distinguished in any reasonably simple
 way, one arrives at the thermodynamic entropy, a coarse-grained notion of entropy.
 
   
 Let us consider a black hole that forms in the real world by the collapse of a star.  
Write $S_{\th}(\sstar)$ for the thermodynamic entropy of a star prior to collapse, and $S_\vN(\sstar)$ for its von Neumann entropy.
They obey the usual inequality 
\be\label{usual}S_\vN(\sstar)\leq S_\th(\sstar).\ee   What happens when the star collapses to a black hole?   We will assume that
this collapse is governed by ordinary quantum mechanical laws and that the collapsing star is isolated.  Since (as in eqn. (\ref{zolk})), the von Neumann entropy of an
isolated system is unchanged under quantum mechanical evolution, the von Neumann entropy is unchanged when the star collapses to a black hole,
and remains equal to $S_\vN(\sstar)$:
\be\label{holsome}S_\vN(\BH)=S_\vN(\sstar).\ee   For the thermodynamic entropy of the black hole, we take the Bekenstein-Hawking formula 
$S_\th(\BH)=A/4G$.   As we noted in section \ref{gsl}, this is vastly greater than the thermodynamic entropy $S_{\th}(\sstar)$ of the star prior to collapse:
\be\label{omy}S_\th(\sstar)\ll S_\th(\BH) .\ee
Putting these facts together, a black hole in the real world forms
in a state with von Neumann entropy much less than its thermodynamic entropy:
\be\label{zomy} S_\vN(\BH)\ll S_\th(\BH). \ee 
Both for an  ordinary quantum system and for a black hole, it can be very difficult to distinguish a state of low von Neumann entropy from a state of true
thermal equilibrium with $S_\vN=S_\th$. In the case of a black hole, the difficulty is expressed at the classical level by the no hair theorem, which says that after transients die down, a black hole
that formed from collapse is described by a simple solution of Einstein's equations that depends only on its mass, charge, and angular momentum.

\subsection{More On  von Neumann Entropy}\label{morevn}

A few facts about von Neumann entropy will be useful.\footnote{For somewhat more detailed introductions, see for example \cite{Preskill,WittenQI}.}
Consider two quantum systems $\A,\B$ with Hilbert spaces $\H_\A$, $\H_\B$.   The composite or ``bipartite'' system $\A\B$ then has Hilbert space
$\H_{\A\B}=\H_\A\otimes \H_\B$.   Let $\Psi_{\A\B}\in \H_{\A\B}$ be any pure state and let 
\be\label{zingo}\rho_\A=\Tr_{\H_\B}|\Psi_{\A\B}\ra\la \Psi_{\A\B}|, ~~\rho_\B=\Tr_{\H_\A}|\Psi_{\A\B}\ra\la \Psi_{\A\B}| \ee
be the corresponding density matrices.   The entropies $S(\rho_\A)=-\Tr_{\H_\A}\,\rho_\A\log\rho_\A$, $S(\rho_\B)=-\Tr_{\H_\B}\rho_\B\log\rho_\B$ are in this
context called entanglement entropies, because they result purely from the way the subsystems $\A,\B$ are ``entangled'' in the underlying pure state
$\Psi_{\A\B}$.     We usually write, for example, just $S_\A$ rather than $S(\rho_\A)$ if it is clear what density matrix is intended.



  A generic pure state $\Psi_{\A\B}$ of the combined system is not a tensor product $\psi_\A\otimes \chi_\B$ of pure states of the two subsystems; rather,
its canonical form up to the action of the unitaries $U,V$ on $\H_A$ and $\H_B$ is
\be\label{tolfo}\Psi_{AB}=\sum_i\sqrt{p_i} \psi_\A^i\otimes \zeta_\B^i \ee
where we can assume that the states $\psi_\A^i\in\H_\A$, $\zeta_\B^i\in\H_\B$ are normalized to $\la\psi_\A^i|\psi_\A^j\ra=\la\zeta_\B^i|\zeta_\B^j\ra=\delta^{ij}$.
Moreover, assuming that $\Psi_{\A\B}$ is normalized to $\la\Psi_{\A\B}|\Psi_{\A\B}\ra=1$, we have $\sum_i p_i=1$.
With $\Psi_{\A\B}$ as in eqn. (\ref{tolfo}), the density matrices $\rho_\A$ and $\rho_\B$ are
\be\label{plimy} \rho_\A=\sum_i p_i |\psi_\A^i\ra\la \psi_\A^i|~~~~   \rho_\B=\sum_i p_i |\zeta_\B^i\ra\la \zeta_\B^i| . \ee


Since $\rho_\A$ and $\rho_\B$ have the same eigenvalues, they certainly have the same von Neumann entropies, which in this context are entanglement entropies. 
From eqn. (\ref{plimy}), it is clear that this entanglement entropy vanishes if and only if there is only one term in the sum in eqn. (\ref{tolfo}),
that is, if and only  if $\Psi_{\A\B}=\psi_\A\otimes \zeta_\B$ is a tensor product of pure states of the two subsystems.  When that is not the case, the two subsystems
are said to be entangled.


Beyond having the same von Neumann entropy, 
$\rho_\A$ and $\rho_\B$  have the same values for any invariants that depend only on their eigenvalues.   The most important examples are the R\'{e}nyi entropies. 
The R\'{e}nyi entropy of order $\alpha$ of a density matrix $\rho$ is 
defined for $\alpha>0$, $\alpha\not=1$ by
\be\label{renyi}R_\alpha(\rho)=\frac{1}{1-\alpha}\log \Tr\,\rho^\alpha .\ee
It follows from this definition  that the R\'enyi entropies of any density matrix are non-negative:
\be\label{renyipos} R_\alpha(\rho)\geq 0, \ee
with equality only for  a pure state.  To show this, one just observes that  eigenvalues of $\rho$ are valued in the interval $[0,1]$,
and hence $\Tr\,\rho^\alpha$ is a decreasing function of $\alpha$; since $\Tr\,\rho=1$, $\Tr\,\rho^\alpha$ is bounded above by 1 if $\alpha>1$ and bounded below by 1 if $\alpha<1$,
leading to the inequality (\ref{renyipos}).    Another important fact is that $R_\alpha(\rho)$ is non-increasing\footnote{To prove this, let $p_i$ be the eigenvalues of $\rho$
and set $z_i =p_i^\alpha/\sum_j p_j^\alpha$.  A straightforward computation shows that $\frac{\d R_\alpha(\rho)}{\d \alpha}=-\frac{1}{(1-\alpha)^2} \sum_i z_i\log(z_i/p_i)$.
The collections of numbers $\{z_i\}$ and $\{p_i\}$ are both probability distributions (sets of nonnegative real numbers whose sum is 1), and we show in analyzing eqn. (\ref{lommy})
below that $\sum_i z_i \log(z_i/p_i)$ is non-negative for any two probability distributions.}
 as a function of $\alpha$:
\be\label{enyipos}\frac{\d R_\alpha(\rho)}{\d\alpha}\leq 0. \ee


We also see that the von Neumann entropy is a limit of R\'enyi entropies,
\be\label{renyilim}\lim_{\alpha\to 1} R_\alpha(\rho)=S_\vN(\rho).\ee
So the definition of $R_\alpha$ is extended by defining $R_1(\rho)=S_\vN(\rho)$.  (Similarly the definition of $R_\alpha(\rho)$ is extended for
$\alpha=0,\infty$ by taking limits.)   The definition (\ref{renyi}) makes it clear that $R_\alpha(\rho)$ only depends on the eigenvalues of $\rho$,
and therefore if the bipartite system $\A\B$ is in a pure state, $R_\alpha(\rho_\A)=R_\alpha(\rho_\B)$.  

As a special case of this, we observed in section \ref{another} that every density matrix $\rho_\A$ for a quantum system $\A$ can be purified by a pure state $\Psi_{\A\B}$ on
some bipartite system $\A\B$.   We now see that $\A$ and its purifying system $\B$  have the same von Neumann entropy, and likewise the same R\'{e}nyi entropies.
This is true regardless of the choice of $\B$, which could be, but need not be, another copy of $\A$.

Now imagine an observer $O_\A$ with the ability to manipulate system $\A$ (but no access to system $\B$), and reciprocally an observer $O_\B$ with access only to system $\B$.
$O_\A$ can act on a state $\Psi_{\A\B}$ by an operator $U_\A\otimes 1_\B$, where $U_\A$ is a unitary operator on system $\A$ and $1_\B$ is the identity operator on system $\B$.
Similarly $O_\B$ can act by $1_\A\otimes U_\B$, where $U_\B$ is a unitary on system $\B$.   Jointly, the two observers can map $\Psi_{\A\B}$ to $(U_\A\otimes U_\B)\Psi_{\A\B}$.
This will transform the density matrices $\rho_\A$ and $\rho_\B$ of the two subsystems by
\be\label{mizo} \rho_\A\to U_\A\rho_\A U_\A^{-1}, ~~~ \rho_\B\to U_\B\rho_\B U_\B^{-1}.\ee
Conjugation by a unitary operator does not change the eigenvalues of the density matrices, so it does not change the entanglement entropies $S_\A=S_\B$ of the
two systems, or  their R\'enyi entropies.   Before leaving this question,
we should contemplate a more general scenario in which
 the observer $O_\A$ brings into the picture an experimental apparatus with Hilbert space $\K_\A$, and the observer $O_\B$
likewise brings into the picture an experimental apparatus with Hilbert space $\K_\B$.   Before any experiments begin, $\K_\A$ and $\K_\B$ are initialized in the pure states
$\chi_\A$ and $\chi_\B$ respectively.\footnote{What is important is not that these states are pure but that there is no entanglement of $\K_\A$ or $\K_\B$ with each other or with the original
system $\A\B$.   Assuming this,  there is actually no essential loss of generality in assuming that the experimental equipment is initialized in a pure state; if $\K_\A$ and $\K_\B$ are initialized in mixed states, we can extend  $\K_\A$ and $\K_\B$ by adjoining the purifying systems and thereby reduce to the case that $\K_\A$ and $\K_\B$ are initialized in pure states. It does not matter whether the
observers manipulate the purifying systems or not.}
   The overall system is thus initialized in the pure state $\chi_\A\otimes \Psi_{\A\B}\otimes \chi_\B$.  
 The observer $O_\A$ thus has access to the composite system $\t \A= \A\K_\A$, and the observer $O_\B$ has access to the composite
system $\t \B=\B\K_\B$.   Before the observers take any action, the entanglement entropy of the composite systems $\t \A$ and $\t \B$ is the same as the entanglement entropy of systems $\A$ and $\B$.
Observer $O_\A$ can act on the combined system $\t \A\t \B$ with a operator $U_{\t \A}\otimes 1_{\t \B}$, where $U_{\t \A}$ is a unitary on system $\t \A$ and $I_{\t \B}$ is the identity on system
$\t \B$; similarly $O_\B$ can act with $1_{\t \A}\otimes U_{\t \B}$.   The result is to transform the state $\chi_\A\otimes \Psi_{\A\B}\otimes \chi_\B $ to 
$(U_{\t \A}\otimes 1 \otimes  U_{\t \B})(\chi_\A\otimes \Psi_{\A\B}\otimes \chi_\B) $, thus conjugating the density matrices $\rho_{\t \A}$ and $\rho_{\t \B}$: 
\be\label{vizo} \rho_{\t \A}\to U_{\t \A}\rho_{\t \A}U_{\t \A}^{-1},~~~~~\rho_{\t \B}\to U_{\t \B}\rho_{\t \B}U_{\t \B}^{-1}. \ee
This leaves unchanged the entropies $S_{\t \A}$ and $S_{\t \B}$, which remain equal to each other and to the original $S_\A$ and $S_\B$.  So in this more general sense, the two observers
acting separately  cannot modify the entanglement entropy between the subsystems that they control.

Another important concept is the {\it relative entropy} between two density matrices $\rho$ and $\sigma$ on the same Hilbert space $\H$.   It is defined
as
\be\label{tommy} S(\rho||\sigma)=\Tr\,\rho\log\rho -\Tr\,\rho\log\sigma. \ee
This quantity has applications to the question of how hard it is to determine $\rho$ and $\sigma$ by an experiment; see for example \cite{WittenQI} for more on that.
For our purposes here, all we need to know is that $S(\rho||\sigma)$ vanishes if $\rho=\sigma$, as is obvious, and is positive otherwise:
 \be\label{pommy}S(\rho||\sigma)>0~~{\rm if}~~\rho\not=\sigma.\ee  This is called {\it positivity of relative entropy}.
   To prove this statement, we can first diagonalize $\sigma$ in some basis, and then we let
$\rho_D$ be the matrix whose diagonal elements in that basis coincide with those of $\rho$, while its off-diagonal elements vanish.  $\rho_D$ is a positive
matrix with trace 1, so it is a density matrix.
Using $\Tr\,\rho\log\sigma=\Tr\,\rho_D\log \sigma$, we have
\be\label{ommy}S(\rho||\sigma) = S(\rho_D||\sigma) + S(\rho_D)-S(\rho),\ee
so to prove positivity of $S(\rho||\sigma)$, it suffices to prove positivity of $S(\rho_D||\sigma)$ and of $S(\rho_D)-S(\rho)$.
For the first statement, we use the fact that $\rho_D$ and $\sigma$ are diagonal in the same basis, say with diagonal matrix
elements $p_i$ and $q_i$, respectively.  So
\be\label{lommy} S(\rho_D||\sigma)=\sum_i p_i (\log p_i - \log q_i).\ee
The right hand side is the classical relative entropy (or Kullback-Liebler divergence) between two probability distributions $\{p_i\}$ and $\{q_i\}$.
One way to prove that this is positive is to use the fact that the classical relative entropy is a convex function on the space of probability distributions. Concretely, for $0\leq t\leq 1$, define the probability distribution $p_i(t) =(1-t)q_i +t p_i$, which coincides with $\{q_i\}$ at $t=0$ and with $\{p_i\}$ at $t=1$.
Then let $f(t)=\sum_i p_i(t)(\log p_i(t) - \log q_i)$.   For $0\leq t\leq 1$, we have
\be\label{bulsing}\ddot f(t) =\sum_i \frac{(p_i-q_i)^2}{p_i(t)}\geq 0.\ee
Since also $f(0)=\dot f(0)=0$, it follows that $f(1)\geq 0$, with equality only if $\{p_i\}=\{q_i\}$ or in other words $\rho_D=\sigma$.
   But $f(1)=S(\rho_D||\sigma)$.  To finish the proof of eqn. (\ref{pommy}), we also
need to show that $S(\rho_D)\geq S(\rho)$, with equality only if $\rho_D=\rho$.   This can be proved by a somewhat similar use of concavity.
For $0\leq t\leq 1$, define the density matrix  $\rho(t)=t\rho +(1-t)\rho_D$.   Using
\be\label{bilgox}\log\rho(t)=\int_0^\infty \d s\left(\frac{1}{s+1}-\frac{1}{s+\rho(t)}\right),\ee
we compute
\be\label{nilgox}\left.\frac{\d}{\d t} S(\rho(t))\right|_{t=0}=-\Tr\, (\rho-\rho_D)\log \rho_D=0, \ee
where the vanishing holds because $\rho-\rho_D$ is strictly off-diagonal in the basis in which $\rho_D$ is diagonal.   We also compute
\be\label{ilgox}\frac{\d^2}{\d t^2} S(\rho(t))=-\int_0^\infty\d s\,\Tr\,\dot\rho \frac{1}{s+\rho(t)}\dot\rho\frac{1}{s+\rho(t)}.\ee
The integrand is positive if $\rho\not=\rho_D$, as it is $\Tr\,B^2$ where $B$ is the self-adjoint operator $(s+\rho(t))^{-1/2}\dot\rho
(s+\rho(t))^{-1/2}$, so $\frac{\d^2}{\d t^2}S(\rho(t))<0$.   Combining these facts, we have $S(\rho(1))<S(\rho(0))$, or $S(\rho_D)>S(\rho)$, completing the proof of the inequality (\ref{pommy}).

An important special case is the following.   Let $\rho_{\A\B}$ be any density matrix on a bipartite system $\A\B$ with Hilbert space $\H_{\A\B}=\H_\A\otimes \H_\B$.
Define the reduced density matrices $\rho_\A=\Tr_{\H_\B}\,\rho_{\A\B}$, $\rho_\B=\Tr_{\H_\A}\, \rho_{\A\B}$.  Then we can define a density matrix $\sigma_{\A\B}=\rho_\A\otimes \rho_\B$ for
the combined system.   Here $\sigma_{\A\B}$ is equivalent to $\rho_{\A\B}$ for measurements of only system $\A$ or only system $\B$, but ignores the information contained in
$\rho_{\A\B}$ concerning correlations between the two systems.   Using $\log\,\sigma_{\A\B}=\log\rho_\A\otimes 1+1\otimes \log\rho_\B$
we have $S(\rho_{\A\B}||\sigma_{\A\B})=\Tr\,\rho_{\A\B}\log\rho_{\A\B}-\Tr\,\rho_{\A\B}\log\sigma_{\A\B}=-S(\rho_{\A\B}) -\Tr\,\rho_{\A\B}(\log\rho_\A\otimes 1+1\otimes \log\rho_\B)
=-S(\rho_{\A\B}) -\Tr\,\rho_\A\log\rho_\A-\Tr\,\rho_\B\log\rho_\B=-S_{\A\B}+S_\A+S_\B$, so the positivity of relative entropy implies that
\be\label{zildo}S_\A+S_\B\geq S_{\A\B}.\ee
This is called {\it subadditivity} of entropy.  An equivalent statement is that  the {\it mutual information} $I(\A:\B)=S_\A+S_\B-S_{\A\B}$ is non-negative.

Subadditivity of entropy has an interesting corollary when it is combined with the existence of purifications.   As usual, we  can purify the density matrix $\rho_{\A\B}$; we 
 introduce a third system $\C$ and a pure state $\Psi_{\A\B\C}\in \H_\A\otimes \H_\B\otimes \H_\C$ such that $\rho_{\A\B}=\Tr_{\H_\C}\,|\Psi_{\A\B\C}\ra\la\Psi_{\A\B\C}|$.
Then $S_{\A\B}=S_\C$, and likewise, since the system $\B\C$ is purifying system $\A$, $S_\A=S_{\B\C}$.   So the inequality (\ref{zildo}) becomes
$S_{\B\C}+S_\B\geq S_\C$.   Exchanging the roles of $\C$ and $\A$, we get 
\be\label{pildo} S_{\A\B}+S_\B\geq S_\A.\ee  For example, this inequality is saturated if the combined system $\A\B$ is
pure, in which case as we have discussed $S_\A=S_\B$ and $S_{\A\B}=0$.
The two statements  (\ref{zildo}) and (\ref{pildo}) combine 
to give the {\it Araki-Lieb inequality}:
\be\label{tildo}S_\B\geq |S_{\A\B}-S_\A|. \ee
Similarly, subadditivity plus the fact that $\A\B\C$ is pure implies that $S_\A+S_\C\geq S_{\A\C}=S_\B$
and $S_\B+S_\C\geq S_{\B\C}=S_\A$, so
\be\label{wildo} S_\A+S_\C\geq S_\B \geq S_\A-S_\C. \ee


Von Neumann entropies also satisfy a deeper inequality known as {\it monotonicity of relative entropy}.   
This inequality  says that tracing over or forgetting a subsystem can only
reduce the relative entropy.  In more detail, if $\rho_{\A\B}$ and $\sigma_{\A\B}$ are two density matrices of the system $\A\B$, and $\rho_\A=\Tr_{\H_\B}\,\rho_{\A\B}$, $\sigma_\A
=\Tr_{\H_\B}\,\sigma_{\A\B}$ are the reduced density matrices on system $\A$, then
\be\label{miso} S(\rho_{\A\B}||\sigma_{\A\B})\geq S(\rho_\A||\sigma_\A).\ee
This was first proved in \cite{LR}; a relatively accessible proof was given in \cite{PN}, and can also be found, for example, in sections 3.6 and 4.3 of \cite{Notes}.
Monotonicity of relative entropy has an important application in proving a version of the Generalized Second Law \cite{Wall}, but unfortunately that argument will not be explained
here.  Monotonicity of relative entropy has  a corollary that is known as {\it strong subadditivity} of entropy.\footnote{Conversely, from strong subadditivity one can deduce
monotonicity of relative entropy by a rather short argument.}   For this, let $\rho_{\A\B\C}$ be a density matrix on a tripartite system
$\A\B\C$ with Hilbert space $\H_{\A\B\C}=\H_\A\otimes \H_\B\otimes \H_\C$ and define the reduced density matrices such as $\rho_{\A\B}=\Tr_{\H_\C}\,\rho_{\A\B\C}$,
$\rho_\C=\Tr_{\H_\A\otimes \H_\B}\,\rho_{\A\B\C}$, etc.   Let $\sigma_{\A\B\C}=\rho_{\A}\otimes \rho_{\B\C}$.    Then the calculation that led to eqn. (\ref{zildo}) shows
that $S(\rho_{\A\B\C}||\sigma_{\A\B\C})=S_{\A}+S_{\B\C}-S_{\A\B\C}$.   Tracing out $\C$ from $\sigma_{\A\B\C}$, we get $\sigma_{\A\B}=\Tr_{\H_\C}\,\sigma_{\A\B\C}=\rho_\A\otimes \rho_\B$.
So $S(\rho_{\A\B}||\sigma_{\A\B})=S_\A+S_\B-S_{\A\B}$.   The inequality $S(\rho_{\A\B\C}||\sigma_{\A\B\C})\geq S(\rho_{\A\B}||\sigma_{\A\B})$ therefore becomes an inequality
that is known as  strong subadditivity:
\be\label{ziggo}S_{\A\B}+S_{\B\C}\geq S_{\A\B\C}+S_\B. \ee
This inequality also has an interesting variant that can be proved by using the fact that any density matrix  has a purification.  Let $\D$ be a quantum system such that the
state of $\A\B\C\D$ is pure.  Then $S_{\A\B}=S_{\C\D}$, $S_{\A\B\C}=S_\D$, so the inequality of strong subadditivity becomes
\be\label{liggo}S_{\C\D}+S_{\B\C} \geq S_\B +S_\D. \ee     The difference $S_{\C\D}-S_\D$ is called conditional entropy $S(\C|\D)$, and classically it is always non-negative, roughly
because one's lack of knowledge of the combined system $\C\D$ is at least as great as one's lack of knowledge of system $\D$ by itself.   
Quantum mechanically, 
it is possible to have $S_{\C\D}-S_\D<0$ if $\C$ and $\D$ are entangled (for example if $\C\D$ is in an entangled pure state, so $S_{\C\D}=0$, $S_\D>0$), and similarly
 it is possible to have $S_{\B\C}<S_\B$ if $\C$ and $\B$ are entangled.
But the sum $(S_{\C\D}-S_\D)+(S_{\C\B}-S_\B)$ is always nonnegative.  This is a statement of {\it monogamy of entanglement}; entanglement between $\C$ and one quantum system $\D$
limits how much entanglement there can be between $\C$ and another quantum system $\B$.

As a last illustration  of von Neumann entropy, we will reconsider the First Law of thermodynamics.   A thermal density matrix for a state with Hamiltonian $H$,
inverse temperature $\beta$, and partition function $Z$ is
is $\rho=\frac{1}{Z}e^{-\beta H}$.   The average energy in this state is
\be\label{omigox} E=\Tr\,H\rho, \ee
and the entropy is $S=-\Tr\,\rho\log \rho$.   To explore the First Law,
we consider an arbitrary first order deformation of $\rho$.  We get
\be\label{tomigox}\d E=\Tr\,H\d\rho \ee
and 
\be\label{omigix}\d S=-\Tr \,\d\rho\log \rho=\beta \Tr\,H \d\rho .\ee
Here we used $\log\rho=-\beta H-\log Z$ and\footnote{In proving that $\Tr\,\rho \,\d\log \rho=0$,  $\rho$ and $\d\rho$ cannot be assumed to commute.
Via  (\ref{bilgox}),  we get $\Tr\,\rho\,\d\log\rho=\int_0^\infty\d s \Tr\,\rho \frac{1}{s+\rho}\d\rho \frac{1}{s+\rho}=\int_0^\infty \d s
\Tr\, \rho \frac{1}{(s+\rho)^2}\d\rho= \Tr\,\d\rho=\d\Tr\,\rho=0$ (since $\Tr\,\rho=1$).} $\Tr\,\rho\,\d\log\rho=0$.
So with $T=1/\beta$, we have the First Law $\d E=T\d S$.  The derivation shows that this relation is valid, in first order, for an {\it arbitrary} deformation of $\rho$ (not necessarily preserving
thermal equilibrium). A standard fact is that 
for a deformation of $\rho$ in which  thermal equilibrium is maintained through all stages (with a varying temperature or changes in other thermodynamic variables), the First Law can be integrated to give information about a non-infinitesimal deformation of $\rho$.   But the derivation just given  shows that the statement holds in first order for
arbitrary perturbations.   This statement has a limit in classical General Relativity (\cite{IW}, Theorem 6.1):  with $S$ defined as $A/4G$, the First Law, in its more general version
$\d E=T\d S+\Omega\d J$, holds for an arbitrary first order deformation of a stationary, possibly rotating, black hole.


\subsection{The Page Curve}\label{Page}

Suppose that a star in a quantum mechanical pure state collapses to form a back hole.   The collapse is expected to be a unitary process, so the black hole forms in a pure state.
Then the black hole begins to decay by emitting Hawking radiation.    According to Hawking's analysis, the black hole is emitting purely thermal radiation, modulated by gray body
factors.   This means that the von Neumann entropy of the radiation equals its thermodynamic entropy
\be\label{inono}S_\vN(\rad)=S_\th(\rad),\ee
assuming that in defining the thermodynamic entropy $S_\th(\rad)$, one takes into account a knowledge of its spectrum, including gray body factors.   In particular, $S_\vN(\rad)$
steadily increases, according to Hawking's analysis.

Assuming that black hole evaporation is a unitary process, the combined system consisting of the black hole and the radiation it emits remains pure as the evaporation proceeds.
Therefore the black hole and the radiation have equal von Neumann entropies:
\be\label{equalvn} S_\vN(\BH)=S_\vN(\rad). \ee
Now we must remember the fundamental inequality (\ref{olk}) between the von Neumann and thermodynamic entropies of any system:
\be\label{fundid}S_\vN\leq S_\th. \ee
For the thermodynamic entropy of the black hole, we take the Bekenstein-Hawking entropy
\be\label{bhtake} S_\th(\BH)=\frac{A}{4G}.\ee
Therefore, we expect that at all times,
\be\label{tilox} S_\vN(\rad)=S_\vN(\BH)\leq S_\th(\BH)=\frac{A}{4G}.\ee


    \begin{figure}
 \begin{center}
   \includegraphics[width=3.1in]{PageTime.png}
 \end{center}
\caption{\footnotesize  A schematic illustration of the Page curve. Plotted is the entropy $S$ of an evaporating black hole, assumed to form in a pure state, as a function
of the time $t$.   The entropy increases steadily until the Page time and thereafter decreases steadily.   The turnabout at the Page time is believed to become sharp
in the limit $G\to 0$.   \label{pagecurve}}
\end{figure} 

At early times, there is no problem with this inequality: $S_\vN(\rad)\ll A/4G$.   However, it was observed by Page \cite{PageCurvePaper} that as $S_\vN(\rad)$ continues to increase in accord with
(\ref{inono}), while the area $A$ decreases, eventually the inequality (\ref{tilox}) will be saturated and then, if (\ref{inono}) remains valid, it will be violated. What happens then?

First of all, Page proposed, based on assuming that black hole dynamics is sufficiently complex and generic that it can be modeled by a random unitary process, that the equality (\ref{inono})
remains valid for as long as it is consistent with the inequality (\ref{tilox}).    The time at which this fails, meaning that the thermodynamic entropy of the radiation equals
the thermodynamic  entropy of the remaining black hole, is called the Page time $t_\Page$.   What happens beyond this time?  Page proposed that once
the inequality $S_\vN(\BH)\leq S_\th(\BH)$ is (nearly) saturated, it continues to be (nearly) saturated for all times, until the black hole becomes so small that thermodynamic reasoning fails.   
The idea behind this proposal is the following.   When $S_\vN(\BH)=S_\th(\BH)$, this means that the black hole is in perfect thermal equilibrium, with a truly thermal density matrix
to good approximation.   Once perfect thermal equilibrium
is achieved, one expects it to be maintained by any adiabatic process.  As long as the black hole is macroscopic, its evaporation  is a very slow, adiabatic process that
one expects would preserve thermal equilibrium.  

In short, Page proposed  that of the two inequalities
\begin{align} \label{twoineq}S_\vN(\rad)&\leq S_\th(\rad)\cr  S_\vN(\BH)&\leq S_\th(\BH), \end{align}
to very high accuracy, the first is saturated until the Page time and the second is saturated after the Page time.   Equivalently, at all times,
\be\label{eqbal} S_\vN(\BH)=S_\vN(\rad)={\rm min}(S_\th(\BH),S_\th(\rad)). \ee
We can also summarize this prediction by saying that, of the two inequalities in eqn. (\ref{twoineq}), whichever one is more restrictive, subject to the condition
$S_\vN(\BH)=S_\vN(\rad)$, is (nearly) saturated at any given time.   The curve of von Neumann entropy as a function of time that follows from this reasoning
is called the Page curve, schematically illustrated in fig. \ref{pagecurve}.

We would like to slightly extend this reasoning to the case that the star that collapsed to form a black hole was not initially in a pure state.   After all, even if the star formed 
in a pure state, by the time the star collapses to form a black hole, it has become entangled with the radiation that it
has emitted and is no longer in a pure state.   However, the von Neumann entropy of the star that is collapsing to form a black hole satisfies the usual inequality
\be\label{melmo} S_\vN(\sstar)\leq S_\th(\sstar). \ee
In the following analysis, it will be convenient to use the fact that every density matrix has a purification.   So there is some quantum system $\C$ such that
the combination of the star and $\C$ is in a pure state.   This system and the star have equal von Neumann entropies:
\be\label{elmo} S_\vN(\sstar)=S_\vN(\C). \ee
If the star was in a pure state at birth, $\C$ might be simply the radiation that the star has emitted during its lifetime prior to collapsing to a black hole, but whether that is so will not be relevant.

Now we consider the collapse of the star to form a black hole.   As explained in section \ref{vn}, because 
 the thermal entropy of the star is much less than the thermal entropy of the black hole to which it collapses,
the  black hole is born in a state of low entropy,
\be\label{pilo}S_\vN(\BH)\ll S_\th(\BH). \ee
Moreover,  $S_\vN(\C)=S_\vN(\BH)$ when the black hole is born, as $\C$ and the star were in a pure state, and the collapse of the
star to a black hole was unitary.

We want to generalize the previous discussion of the Page curve of a black hole that is born in a pure state to this more realistic case of a black hole born in a state of low entropy
compared to its thermal entropy.
As before, the black hole starts to radiate, so the thermal and von Neumann entropies of the radiation increase.   Hawking's analysis indicates that they  are equal at least initially.
But, as in the case that the black hole formed in a pure state, eventually this will lead to a contradiction.   To analyze this situation, we note that since initially the star and $\C$ were in a pure
state, it follows that after the star collapses and the black hole begins to radiate, assuming this evolution is unitary, the tripartite system consisting of the black hole, the radiation, and $\C$ will be
in a pure state.   Therefore, we have from eqn. (\ref{wildo})
\be\label{niloc} S_\vN(\rad)+S_\vN(\C) \geq S_\vN(\BH)\geq S_\vN(\rad)-S_\vN(\C). \ee   Moreover, as $\C$ does not participate in the evolution at all, $S_\vN(\C)$ is independent of time.
Since $S_\vN(\C)$ is extremely small compared to typical values of $S_\vN(\rad)$ and $S_\vN(\BH)$ during the subsequent evolution,
eqn. (\ref{niloc}) tells us that $S_\vN(\rad)$ and $S_\vN(\BH)$ will be very nearly equal throughout the evolution, though not precisely equal as in the case
of a black hole that forms in a pure state.  Therefore one expects that as in the case of a black hole that forms in a pure state, $S_\vN(\rad)$ and $S_\vN(\BH)$ will go up together  in tandem,
and then go back down together in tandem.   With a suitable assumption of randomness of the evolution, one can generalize the analysis
in \cite{PageCurvePaper} and make slightly more precise statements.

The form of the Page curve, as sketched in fig. \ref{pagecurve}, suggests some sort of phase transition at the Page time -- a transition that becomes sharp in the limit $G\to 0$.
  Something like this
has indeed been found \cite{P,AEMM}, as we briefly indicate in section \ref{pageagain}.    

\section{Black Holes and Von Neumann Entropy}\label{bhvn}

\subsection{Bekenstein-Hawking Entropy as Entanglement Entropy}\label{bhent}

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.1in]{Division.png}
 \end{center}
\caption{\footnotesize  Dividing space into two regions $\A$, $\B$.   \label{sorkin}}
\end{figure} 


An early proposal to relate black hole entropy to entanglement entropy was made by Sorkin \cite{SorkinA} in 1983 and and extended by Bombelli, Koul, Lee, and Sorkin
a few years later  \cite{SorkinB}, in work that initially attracted little attention.
For other early suggestions, see  \cite{Thooft,Srednicki}.
The idea was to interpret the Bekenstein-Hawking entropy of a black hole in terms of the entanglement entropy of quantum fields on opposite sides of the horizon.  
 
  For a simpler problem, in  some quantum field theory in Minkowski space, divide space at time $t=0$ (in some Lorentz frame)  into two complementary regions $\A$ and $\B$
(fig. \ref{sorkin}).  Let $\Omega $ be the vacuum state of the theory, 
and let $\rho_\A$ and $\rho_\B$ be the density matrices appropriate to measurements in the state $\Omega$ in
regions $\A$ and $\B$, respectively.    We constructed such a density matrix in a particular case (Rindler space) in section \ref{cut}, though
in that analysis we discussed temperature only and not entropy.
We  will discuss
some further examples in section \ref{sample}.    
The idea now is to consider the 
 von Neumann entropies $S_\vN(\rho_\A)$ and $S_\vN(\rho_\B)$.  These are equal to each other,
and can be regarded as entanglement entropies, since the overall state $\Omega$ is pure.    One finds that $S_\vN(\rho_\A)$ and $S_\vN(\rho_\B)$ are ultraviolet
divergent.   The divergence comes from short distance modes supported near the boundary $\Sigma$ between the two regions,
and accordingly the coefficient of the leading divergence is proportional to the area $A$ of  that boundary.  The computation in section \ref{sample} will
exhibit the divergence in the entanglement entropy in an illustrative case.  

The idea in \cite{SorkinA}-\cite{Srednicki} was to interpret black hole entropy as  entanglement entropy between the regions behind and outside the horizon,
with somehow  gravity cutting off the ultraviolet divergence, leaving an entanglement entropy that is still proportional to the area $A$, but with a finite  coefficient
$1/4G$.   This idea makes a great deal of intuitive sense, as it
matches two ideas:

(1) $\frac{A}{4G}$ is the irreducible entropy of the system for someone who has access only to the region outside the horizon.

(2)  The entropy of a black hole is proportional to the horizon area because  the horizon supports roughly one bit or qubit per Planck unit of area, as in Wheeler's picture (fig. \ref{Three}); here
the modes in question are the short distance modes that dominate the entanglement entropy.

This idea has not evolved into a precise proposal, even today, but further developments have certainly shown that in black hole thermodynamics, it is important
to consider the microscopic von Neumann entropy, and not only the thermodynamic entropy that Bekenstein analyzed originally.   A few, but realistically only a few, of
these further developments will be described in the rest of this article.

A decade after the initial proposal, Susskind and Uglum \cite{SU} made the following very simple observation.   The generalized entropy of a black hole
\be\label{nubbo} S_\gen=\frac{A}{4G}+S_\out ,\ee
is better defined than either term is separately,
if $S_\out $ is  understood as the von Neumann entropy  of fields outside the horizon.
We have already remarked that $S_\out$ has an ultraviolet divergence proportional to the horizon area.   In four dimensions, this is a quadratic divergence
\be\label{lubbo} S_\out = f \Lambda^2 A+\cdots,\ee 
where $f$ is a constant and $\Lambda$ is an ultraviolet cutoff.   On the other hand, in Hawking's original calculation of black hole evaporation   (and in our sketch of this
calculation in section \ref{bhevaporation}), loop effects that renormalize Newton's constant were not taken into account.   This means that we should think of the ``$G$'' that
appears in that analysis as a bare Newton constant $G_0$, and thus we should have written the generalized entropy as
\be\label{wubbo}S_\gen=\frac{A}{4G_0}+S_\out.\ee
 At one-loop order, the renormalization of Newton's constant has the general form
\be\label{dumbox}\frac{1}{G_0}=\frac{1}{G}-f'\Lambda^2,\ee
again with a quadratic divergence and a  constant $f'$.     Susskind and Uglum observed that, at least at one-loop order, $f'=f$; therefore the ultraviolet divergence cancels in $S_\gen$,
when it is expressed in terms of the physical parameter $G$.    $S_\gen$  is thus
better-defined than either of the two terms on the right hand side of eqn. (\ref{wubbo}).  These arguments were later extended; see section  \ref{rbh}.

There are two reasons that it is important in this derivation to interpret $S_\out$ as the von Neumann entropy of the quantum fields outside the horizon, not thermodynamic entropy.   First, von Neumann entropy
and not  thermodynamic entropy has the ultraviolet divergence that is needed to cancel the ultraviolet divergence in the renormalization of Newton's constant.   Second, interpreting
$S_\out$ as von Neumann entropy greatly increases the scope of the formula.  With this interpretation, $S_\gen$ is defined for an arbitrary state of the quantum fields, not 
necessarily a state for which thermodynamics is valid.

This analysis could possibly be interpreted to suggest that the part of $\frac{A}{4G}$ that results from renormalization of $\frac{1}{G}$ reflects  entanglement entropy
of the quantum fields, but  the bare contribution $\frac{A}{4G_0}$ does not.  Is it possible to interpret all of the black hole entropy as entanglement entropy of quantum fields?
 That question has motivated the suggestion \cite{Jacobson} that $\frac{1}{G_0}=0$, which would mean that there
is no Einstein-Hilbert term in the classical action and the usual gravitational action arises entirely from loop effects.   This idea has been called ``induced gravity,'' originally proposed
with a different motivation \cite{Sakharov}.   (In induced gravity,
it  is usually assumed that the gravitational field is present to begin with, and only the gravitational action, not the gravitational field, is induced.)
From a standard point of view, the absence from the classical action of a bare Einstein-Hilbert term is in principle possible, but there is no obvious reason to make this
assumption, since the absence of a classical Einstein-Hilbert term would not reflect any symmetry.  And precisely for that reason, the absence of an Einstein-Hilbert term
in the classical action does not seem to be a well-defined statement, as it depends on the renormalization scheme that one is planning to use.

In a sense string theory may give an improved version of something similar to induced gravity.  
Let us recall that in ordinary quantum field theory, the classical action and the quantum corrections are quite different things.   The classical action is not induced from anything;
it is postulated to define the theory.   Then the quantum corrections are deduced from the classical action together with Feynman diagrams and the like.   
The quantum corrections, being non-local, can describe
correlations between particles in different places and in particular between particles or fields on opposite sides of the horizon.   So they can contribute to the entanglement entropy.
The classical action, as the integral of a local expression, does not provide such correlations so it does not contribute to entanglement entropy.

Now compare to string theory.   In perturbative string theory, at least, the starting point is a two-dimensional field theory.   What in spacetime is interpreted as the classical action
comes from the path integral of the two-dimensional field theory on a Riemann surface of genus zero, and the quantum corrections similarly come from path integrals on
Riemann surfaces of genus $g>0$.
In a sense, the classical action is ``induced'' from the two-dimensional field theory; it has a similar origin to the quantum corrections.  If the genus $g>0$ contributions  can contribute
to the entanglement entropy across the horizon, it is logical that the genus zero contribution can as well.   The two-dimensional path integral on a surface of genus zero is not really
local from a spacetime point of view; it just becomes local in an asymptotic expansion at low energies.   So it is not obvious why there could not be a genus
zero contribution to the entanglement entropy.   It was indeed suggested by Susskind and Uglum \cite{SU} that there
is a classical contribution to the entanglement entropy across a horizon, coming from genus zero string worldsheets that are partly outside the horizon and partly behind it.
Unfortunately, even thirty years later,  this line of thought has not been backed up by a real calculation.




\subsection{A Sample Computation}\label{sample}

Most calculations of von Neumann entropy in quantum field theory are based on a simple device known as the {\it replica trick}, which in this context was introduced by Callan and Wilczek
\cite{CW,HLW}. (A somewhat similar replica trick was  used earlier in spin glass theory \cite{AE}.)   The idea is simple.   In many situations, it is practical to use path integrals
to construct the density matrix $\rho$ of a region. In that case, as we will see, it is also comparatively easy to describe the positive integer powers $\rho^n$
of the density matrix.   However, to describe $\log\rho$ is usually difficult, and this usually makes a direct calculation of $S(\rho)=-\Tr\,\rho\log\rho$ difficult.
Instead one computes $\Tr\,\rho^n$ for positive integer $n$.   This computation is done, as we will explain, 
 by considering $n$ copies or replicas of the original system, whence the name ``replica trick.''
After computing $\Tr\,\rho^n$ for positive integer $n$, one analytically continues it to a holomorphic function on the half-plane ${\rm Re}\,n\geq 1$ and then one computes
the entropy from the formula
\be\label{izzo}S(\rho)=-\left.\frac{\d}{\d n}\right|_{n=1}\Tr\,\rho^n. \ee

Of course, one question here is whether the analytic continuation away from integer values of $n$ exists and is unique.   In ordinary quantum mechanics, one can address
this question as follows.  As $\rho$ is a positive operator with trace 1, it follows that in the half-plane
${\rm Re}\,n\geq 1$, the function $f(n)=\Tr\,\rho^n$ is holomorphic and bounded by $|f(n)|\leq 1$.  So the analytic continuation exists.  
The continuation is unique by Carlson's theorem.
According to this  theorem (see for example
\cite{Boas}, p. 153), a holomorphic function in the half-plane ${\rm Re}\,n\geq 1$ that coincides with $f(n)$ at positive integers is unique, under condition
of being bounded or even under a much weaker condition that allows some exponential growth.  So in ordinary quantum mechanics, there is no difficulty with the existence and uniqueness of the analytic continuation away from positive integer
values of $n$.   In quantum field theory, these considerations are not really applicable, as the formalism of density matrices is not  rigorous in quantum field theory.\footnote{The factorization
of Hilbert space that is usually used in defining density matrices is not valid in continuum quantum field theory, as previously remarked in
 footnote \ref{notable}. See also a remark at the end of this section.}  But in practice, the use of the replica trick to compute entropies in quantum field theory has been very effective.   
 
 The basic strategy to compute $\Tr\,\rho^n$ is as follows. Suppose that $\rho$ is a density matrix on a Hilbert space $\H$.
   Then $\H^{\otimes n}=\H\otimes \H\otimes \cdots\H$ is the Hilbert space of a composite system consisting of $n$ copies or replicas of the original system.
   On $\H^{\otimes n}$, one defines a product density matrix 
    $\rho^{[n]}=\rho\otimes \rho\otimes \cdots\otimes \rho$ that describes $n$ replicas all in the same state $\rho$.  
         Whatever method is available to describe $\rho$ can be repeated $n$
    times to describe $\rho^{[n]}$. Explicitly
        \be\label{zilbox}\rho^{[n]}{}^{i_1\cdots i_n}_{j_1\cdots j_n} =\rho^{i_1}_{j_1}\rho^{i_2}_{j_2}\cdots \rho^{i_n}_{j_n}. \ee
  To compute $\Tr\,\rho^n$, arrange the $n$ replicas in cyclic order and contract the ``bra'' state  (or lower index) of the $i^{th}$ replica with the ``ket'' state  (or upper index) of the $i+1^{th}$:
    \be\label{ilbo} \Tr\,\rho^n =\rho^{i_1}_{i_2}\rho^{i_2}_{i_3}\rho^{i_3}_{i_4}\cdots \rho^{i_n}_{i_1}.\ee
    A slightly more abstract description is as follows.     If $P$ is the operator that cyclically permutes the $n$ replicas, then
   \be\label{usefulone}\Tr_{\H}\,\rho^n=\Tr_{\H^{[n]} }\,P\rho^{[n]}.\ee
   
   Once $\Tr\,\rho^n$ is computed, this immediately gives the R\'enyi entropies  $R_n(\rho)=\frac{1}{1-n}\log \Tr\,\rho^n$ of integer order $n>1$.  Other R\'enyi entropies and
   the von Neumann entropy are then computed by analytic continuation. 
 
 
We will explain how to carry out this program in
 a simple example, analyzed in \cite{CW,HLW,CC}, that  is highly illustrative and which  also has important applications, for instance in \cite{P,AEMM}.
 To understand this example, the reader will need a basic knowledge of two-dimensional conformal field theory (CFT) and twist fields.  Unfortunately it will not be practical to fully
 explain the background here.
 
 \begin{figure}
 \begin{center}
   \includegraphics[width=3.6in]{Fig15.pdf}
 \end{center}
\caption{\footnotesize The shaded region is the domain of dependence of the 
 interval $I=[0,L]$ at $t=0$  in two-dimensional Minkowski space.    \label{domain}}
\end{figure} 


 \begin{figure}
 \begin{center}
   \includegraphics[width=6in]{Fig16.pdf}
 \end{center}
\caption{\footnotesize (a) The density matrix $\rho$  of the interval $I=[0,L]$ is represented by a path integral on a Euclidean
$\R^2$ with a cut along $I$. (The boundaries
above and below the cut have been separated for visibility.)
 Concretely the density matrix is a function $\rho(\phi;\phi')$ where $\phi$ and $\phi'$ are respectively the boundary values along $I$ below
and above the cut.   (b) To compute $\Tr\,\rho^2$, we start with two copies of the path integral that computes $\rho$
and glue the boundary above the cut in each one to the boundary below the cut in the other, as marked.
 The resulting surface is a two-fold cover of $\R^2$ branched at the endpoints of $I$, and the path integral
on this manifold computes $\Tr\,\rho^2$.  $\Tr\,\rho^n$ is computed similarly starting with $n$ copies and gluing them in a cyclic arrangement.    \label{density}}
\end{figure} 

In two-dimensional Minkowski space with metric $\d s^2=-\d t^2+\d x^2$, we denote the initial value surface $t=0$ as $\S$, and we let $I\subset \S$ be the interval $0\leq x\leq L$.
In this spacetime, we consider a CFT with holomorphic and antiholomorphic central charge $c$, and vacuum vector $\Omega$.  
We call this theory $\T$ and generically denote the fields in this theory as $\phi$.
We want to compute the entropy of the density matrix $\rho$ that describes measurements in the state $\Omega$ in the region $I$.   Equivalently, just as in the discussion of Rindler
space in section \ref{cut}, this
is the density matrix that describes measurements in the domain of dependence of $I$ (fig. \ref{domain}), since fields in the domain of dependence are determined by fields along $I$.
In computing the entropy of the density matrix $\rho$, we are going to run into the characteristic ultraviolet divergence of all such computations.   In the particular example
that we are studying here, if there were no ultraviolet divergence, then conformal invariance, or even just global scale invariance, would imply that the answer is independent of $L$.
Instead, we will run into an ultraviolet divergence, which makes possible a logarithmic dependence on $L$.   A drawback of this example is that, since we are in two spacetime dimensions,
the boundary of the region $I$ consists of a pair of points, each of ``area'' 1,  so in this calculation we will not see clearly that the coefficient of the ultraviolet divergence is a multiple of
the area.   (A rather similar calculation in dimension $D>2$  does make that clear.) 

The first step, of  course, is to construct the density matrix $\rho$.   This can be done precisely in the way that we constructed the density matrix for Rindler space in section 
\ref{cut}.   After continuing to Euclidean signature by $t=\i \tE$, the  projection operator  $|\Omega\ra\la\Omega|$ onto the vacuum is represented, as in fig. \ref{Five}(b),
 by a path integral on $\R^2$
with a cut on the line $\tE=0$.   The bra $\la\Omega|$ is represented by a path integral on the region $\tE>0$ as a function of the boundary values of the fields  above the
cut; the ket $|\Omega\ra$ is similarly represented by a path integral on the region $\tE<0$ as a function of the boundary values of the fields below the cut.  Now suppose we want
to construct 
a density matrix appropriate for measurements only on a portion $I$ of the $x$ axis, whose complement we will call $I^c$.  To do this, we glue together the upper and lower
half spaces along $I^c$, leaving a cut only on $I$.  The logic is the same as in section \ref{cut}: to ``trace out'' the fields on $I^c$ from the pure state density matrix 
$|\Omega\ra\la\Omega|$, we set the boundary values along $I^c$ to be equal above and below the cut and then integrate over them; this has the effect of erasing the
cut along $I^c$.

The resulting construction of the density matrix 
is depicted in fig. \ref{density}(a).  As in the discussion of Rindler space, the density matrix can be viewed as a function $\rho(\phi;\phi')$, where $\phi'$ denotes
fields on the boundary above the cut and $\phi$ denotes fields on the boundary below the cut.      Now let us  compute  $\Tr\,\rho^n$ for a positive integer $n$.   
For this purpose, as described earlier,  we take $n$ disjoint copies of the $z$-plane, each with a cut on the interval $[0,L]$ of the real axis, to represent the $n$-fold tensor
product $\rho^{[n]}=\rho\otimes\rho\otimes \cdots\otimes\rho$.   Then after arranging the replicas in cyclic order, we contract the bra state in the $i^{th}$ replica with the
ket state in the $i+1^{th}$.   Geometrically this contraction is accomplished by gluing together the boundary above the cut in the $i^{th}$ copy of the $z$-plane to
the boundary below the cut in the $i+1^{th}$.     This gluing recipe is illustrated for $n=2$ in fig. \ref{density}(b).   The gluing constructs a Riemann surface $C_n$ that is an $n$-fold
cover of the complex $z$-plane, with branch points at $z=0$ and $z=L$, and no other branch points on the complex $z$-plane or at $z=\infty$.  The monodromy around
the branch points is a cyclic permutation of the $n$ sheets at $z=0$ and an inverse cyclic permutation at $z=L$.
$C_n$ can be described by the equation
\be\label{meliflo} y^n=\frac{z}{z-L}, \ee
which describes a cover of the complex $z$-plane with precisely the right branch points and monodromy. 

The cyclic arrangement of the $n$ replicas and the rule for gluing each one to the next are invariant under a cyclic permutation of the replicas.  This cyclic permutation generates
a symmetry group $\Z_n$ that we will call a replica symmetry.
In the algebraic description (\ref{meliflo}) of the Riemann surface $C_n$, the generator of the replica symmetry is $y\to e^{2\pi \i /n}y$.

The upshot of all this is that $\Tr\,\rho^n$ is given by the path integral of the CFT under study on $C_n$.   However, there is a simpler approach.   Away from the branch points,
 $C_n$ is just $n$ copies of the original complex $z$-plane $C$.  Instead of studying one copy of theory $\T$ on an $n$-fold cover of $C$, it is equivalent, away from the
branch points, to study $n$ copies of theory $\T$ on $C$.   We will denote as $\T^n$ the CFT that consists of $n$ copies of theory $\T$.
We would like to compute $\Tr\,\rho^n$ by studying theory $\T^n$ on $C$.  In doing this, what are we supposed to say about the branch points of the covering map $C_n\to C$?
This question actually has a simple answer.    Theory $\T^n$ is invariant under the group of permutations of the $n$ copies.   Under broad conditions,\footnote{The discrete
symmetry must be one that could be gauged; its 't Hooft anomaly must vanish. That condition is satisfied in the present example.} to a discrete symmetry $\gamma$ of a CFT, one can associate
a ``twist field'' $\Theta_\gamma$, with the property that in going around a point $p$ at which the operator $\Theta_\gamma(p)$ is inserted, the fields undergo the automorphism
$\gamma$.   Such twist fields were first constructed in \cite{DFMS} and have relatively simple properties; in particular, 
the twist field of lowest possible dimension
for a given $\gamma$ is a conformal primary.  In our problem,  
at $z=0$, we want a lowest energy conformal primary\footnote{In a lattice regularization, as introduced shortly, one would meet here a non-universal linear combination of all possible
twist fields for given $\gamma$.  But in the limit that the lattice scale $\varepsilon$ becomes small, the dominant contribution will come from the twist field for $\gamma$ of lowest
possible dimension.   That is why the relevant twist field $\Theta_{(n)}$ is the one of lowest dimension, which in particular is a conformal primary.  There
are many other conformal primary twist fields of higher dimension for the same $\gamma$.}  twist
field $\Theta_{(n)}$ that cyclically permutes the $n$ sheets; at $z=L$, we need the conjugate twist field $\bar\Theta_{(n)}$ that cyclically permutes the $n$ sheets in the opposite direction.  

Instead of studying the path integral of theory $\T$ on $C_n$, it is equivalent, and more transparent, to study the path integral of theory $\T^n$ on $C$, with a pair of twist field
insertions.  The resulting formula for $\Tr\,\rho^n$ is a two-point function of twist fields inserted at $z=0$ and $z=L$:
\be\label{polo} \Tr\,\rho^n=\la \Theta_{(n)}(0) \bar\Theta_{(n)}(L)\ra. \ee  



It turns out that $\Theta_{(n)}$ and its conjugate $\bar\Theta_{(n)}$ are primary fields of dimension
\be\label{orto} \Delta_n=\frac{c}{12}\left(n-\frac{1}{n}\right).\ee
Before explaining how to obtain this result, we will explain how to use it to compute the entropy.

In general,  if $\O$ is a CFT primary field of scaling dimension $\Delta$ and $\bar \O$ is its conjugate, 
the two point function is 
\be\label{tellmet}\la \O(0)\bar \O(L)\ra = w L^{-2\Delta}, \ee
with a constant $w$ that depends on how the operator $\O$ is normalized.   Applying this in the present context, we may seem to have a contradiction.  The quantity $\Tr\,\rho^n$ that we are trying
to compute is a dimensionless function of $n$, of course, but the two-point function $\la \Theta_{(n)}(0)\bar\Theta_{(n)}(L)\ra$ will be proportional to $L^{-2\Delta_n}$.
Apart from $L$, there appears to be no other dimensionful quantity in the problem, so how can we possibly get a dimensionally correct answer for $\Tr\,\rho^n$?

The answer to this question involves the fact that in continuum relativistic quantum field theory, the density matrix formalism is not strictly applicable.   Of course,
with a suitable lattice regularization, density matrices do exist.   A lattice regularization breaks Lorentz invariance, but in the present discussion, unlike our previous analysis
of Rindler space, that is not a problem. A lattice regularization introduces another dimensionful parameter -- the lattice scale $\varepsilon$  -- making it possible
to write a dimensionally correct formula. 
Near the continuum limit -- that is, for small $\varepsilon$ -- the resulting formula  will scale  with $L$ as $L^{-2\Delta_n}$, the expected CFT behavior for the two-point function
of an operator of dimension $\Delta_n$.       The dimensionally correct version of the formula for $\Tr\,\rho^n$ is
\be\label{inot} \Tr\,\rho^n =w(n) \left(\frac{\varepsilon}{L}\right)^{2\Delta_n} =w(n) \left(\frac{\varepsilon}{L}\right)^{\frac{c}{6}\left(n-\frac{1}{n}\right)}. \ee
Here $w(n)$ is a dimensionless function of $n$; it is non-universal and  depends on the specific cutoff used.   Note that $w(1)=1$, since $\Tr\,\rho=1$.

Analytic continuation of this result is immediate; the only singularity is at $n=0$.  It is now  straightforward to compute $S(\rho)=-\Tr\,\rho\log\rho$:
\be\label{plimbo} S(\rho)=-\left.\frac{\d}{\d n}\right|_{n=1}\left( w(n) \left(\frac{\varepsilon}{L}\right)^{\frac{c}{6}\left(n-\frac{1}{n}\right) }\right)= \frac{c}{3}\log\frac{L}{\varepsilon}   -w'(1).\ee 
The logarithmic term $\frac{c}{3}\log \frac{L}{\varepsilon}$ is universal and has many applications, 
but the constant $-w'(1)$ is not universal; it depends on the cutoff-dependent function $w(n)$ in eqn. (\ref{inot}).   It is noteworthy that the universal result depends on the cutoff
 $\varepsilon$, illustrating the fact that in quantum field theory, such entanglement entropies are ultraviolet divergent.
  In two dimensions, the dependence on $\varepsilon$ is only logarithmic; an analogous computation in $D$ dimensions
gives a leading divergence proportional to $\frac{A}{\varepsilon^{D-2}}$, where $A$ is the area (in the $(D-2)$-dimensional sense) of the boundary of the region considered.

 \begin{figure}
 \begin{center}
   \includegraphics[width=4.9in]{Fig17.pdf}
 \end{center}
\caption{\footnotesize The state-operator correspondence of conformal field theory:  a  local operator $\O$  of scaling dimension $\Delta$ corresponds to a state
$\Psi_\O$ of energy $E=\Delta-\frac{c}{12}$, provided the theory is quantized on a circle of circumference $2\pi$.   To prove this, one starts with the picture in (a)
with the operator $\O$ inserted at a point $p$ on $\R^2$; then one makes a conformal mapping from $\R^2$ with the point $p$ removed to an infinite cylinder of circumference $2\pi$.
The operator $\O$ is transformed into a state $\Psi_\O$ that is inserted at one end of the cylinder  as in (b).  Taking into account the scaling dimension of $\O$ and the conformal
anomaly, one learns that the state $\Psi_\O$ has energy $\Delta-\frac{c}{12}$. \label{stateoperator}}
\end{figure} 

It remains to explain the formula (\ref{orto}) for the dimension of the operator $\Theta_{(n)}$.   For this purpose, we use the state-operator correspondence of conformal
field theory (fig. \ref{stateoperator}).   In a conformal field theory with central charge $c$, an
 operator of dimension $\Delta$ corresponds to a state of energy $E=\Delta-\frac{c}{12}$, if the theory is quantized on a circle
of standard circumference $2\pi$.     But if the circumference is $2\pi R$, then the energy is
\be\label{manygo}E_R=\frac{1}{R}\left(\Delta-\frac{c}{12}\right). \ee

The operator of lowest dimension is the identity operator, with $\Delta=0$.  The corresponding state is the ground state; on a circle of circumference $2\pi$, its energy is
$-\frac{c}{12}$.  This negative 
ground state energy of a CFT quantized on a circle is a generalization of the usual Casimir energy of a free field.  

Theory $\T^n$ is the product of $n$ copies of theory $\T$, so if theory $\T$ has central charge $c$, then $\T^n$ has central charge $nc$.
Hence if  we quantize theory $\T^n$ on a circle of circumference $2\pi$, as in fig. \ref{stateoperator}(b), then an operator $\O$ of dimension $\Delta$ corresponds  to a state
 $\Psi_\O$ of energy $\Delta-\frac{nc}{12}$. In general, a quantum state  of theory $\T^n$ on the cylinder can be viewed as a state of theory $\T$ on an $n$-sheeted cover
 of the cylinder.     If $\O$ is a twist field associated to a  permutation $\gamma$ of the $n$ copies of $\T$, then the state $\Psi_\O$ is what is called a twisted sector state \cite{orbifold}, which means in the case of theory $\T^n$ that
 the $n$ sheets of the cover are permuted by $\gamma$ in going around the cylinder.   The specific twist field $\Theta_{(n)}$ is associated to a cyclic permutation of the
 $n$ factors, so if  $\O=\Theta_{(n)}$, then the $n$ sheets are cyclically permuted in going around the cylinder.   That means that the $n$-fold cover of the cylinder is a connected
 manifold, a cylinder of circumference $2\pi n$.   So instead of viewing $\Psi_\O$ as a state in theory $\T^n$ on a cylinder of circumference $2\pi$, we can view it as a state of
 theory $\T$ on a circumference $2\pi n$.  As such, since $\Theta_n$ is the primary operator of lowest dimension for the given permutation,
  $\Psi_\O$ is the  primary state of lowest energy, namely the
 ground state. So its energy is given by eqn. (\ref{manygo}) with $\Delta=0$ and $R=n$ and is therefore $-\frac{c}{12 n}$.  
 The upshot then is that the energy of the state $\Psi_{\Theta_{(n)}}$ is $\Delta_n -\frac{nc}{12} $ if computed one way, and $-\frac{c}{12n}$ if computed another way.
 Comparing these formuls, we get the claimed result (\ref{orto}) for $\Delta_n$.
 
 The ultraviolet divergent part of the entanglement entropy that we computed is $\frac{c}{3}\log \frac{1}{\varepsilon}$.   This comes from short distance modes
 near the ends of the interval.  As the interval has two ends which make equal contributions, the short distance modes near one end of the interval contribute
 $\frac{c}{6}\log \frac{1}{\varepsilon}$.  This is also the divergent part of the entanglement entropy in any two-dimensional quantum field theory that, while not being conformally invariant,
 is asymptotic in the ultraviolet to a conformal field theory of central charge $c$.
 Though we computed the entanglement entropy for the vacuum state, this divergent contribution is universal, independent of the state,
 because all states look like the vacuum at short distances.  
 
  Related to the ultraviolet divergence that we found in the entanglement entropy is a conformal anomaly.   Suppose that we make a Weyl transformation of
 the metric on $\R^2$ by $g\to e^{2v} g$, for a real-valued function $v$.   This multiplies all  locally measured lengths by $e^v$, so  the short distance cutoff $\varepsilon$
 is replaced by $e^v \varepsilon$.   In particular, after a general  spatially dependent Weyl tansformation, the short distance cutoff is  spatially dependent.   We found
 that the entanglement entropy of the interval has a divergent contribution $\frac{c}{6}\log \frac{1}{\varepsilon}$ at each end.  So under $\varepsilon\to e^v\varepsilon$,
 the entanglement entropy is shifted at each end by $-\frac{c}{6}v$.   The total ``conformal anomaly'' in the entanglement entropy is a sum of contributions at the endpoints $z=0,L$:
 \be\label{sanom} \Delta S =-\frac{c}{6}\left( v(0)+v(L)\right). \ee
 
  The universal divergence in the entanglement entropy shows that it is not true that the Hilbert space $\H$
 of a quantum field theory on the real line has a factorization $\H_I\otimes\H_{I^c}$ as the tensor product of a Hilbert space $\H_I$ of modes supported on an interval $I$ and
 a Hilbert space $\H_{I^c}$ of modes supported on the complement $I^c$ of $I$; nor is $\H$ the direct sum or integral of subspaces with such a factorization.
 If $\H$ did have such a form, there would exist states of finite (or even zero) entanglement entropy.  The absence of such a factorization is related to the fact that the algebra of
 operators in a region such as $I$ or $I^c$ is a von Neumann algebra of Type III, for which density operators cannot be defined.
 



\subsection{The Bekenstein Bound}\label{Bek}

The Bekenstein bound is an interesting and relatively simple example  in which understanding ``entropy'' to be microscopic von Neumann entropy -- rather than thermodynamic
entropy -- made it possible to unravel a longstanding puzzle.

Some years after his original proposal concerning black hole entropy, Bekenstein \cite{Bek2} revisited the original work, and made the following proposal.
Suppose that a black hole of mass $M$ and therefore of radius $r_S=2GM$ absorbs a body of size $R$, energy $E$, and 
entropy $S$.    Assuming that $E\ll M$, the black hole entropy changes, as we actually computed
in section \ref{gsl}, by approximately $8\pi GME$.   On the other hand, the entropy $S$ of the infalling body disappears.
So a process in which the black hole absorbs the given body satisfies the Generalized Second Law if and only if
\be\label{tongo} 8\pi GME >S. \ee
If one naively says that a black hole of radius $2GM$ and therefore diameter  $4GM$ can only absorb a body of size $R< 4GM$, then an inequality
\be\label{wongo} 2\pi RE >S \ee
will suffice to ensure that the Generalized Second Law is not violated. 

Bekenstein observed that the inequality (\ref{wongo}), which became known as the Bekenstein bound,
 does not depend on Newton's constant and makes no mention of gravity or black holes,
but is just a statement about the matter system that is possibly falling into the black hole.   This motivated Bekenstein to propose that the inequality
is a universal inequality about relativistic quantum systems.  Since the reasoning that led to the Bekenstein bound is rather heuristic,  one might prefer to state
the Bekenstein bound as the assertion that there is some constant $k$ such that
\be\label{longo} k RE>S\ee
for all matter systems.

Plenty of criticisms could be made of this proposal.  
 For one thing, it is not really true that a black hole cannot absorb a larger body.   In the real world, astronomers
observe ``tidal disruption events''  (TDE's) in which a black hole absorbs a potentially much larger star (though in  most observed TDE's, the black hole is at least as big as the star).  
However, a real star has relatively low entropy, and a TDE in the real world actually does satisfy the Generalized Second Law, though not some of the assumptions
in heuristic arguments that motivate the Bekenstein bound.
 
 There were at least two other important objections.  
 First, a simple argument appears to show that the Bekenstein bound cannot possibly be
 true as a universal statement about relativistic quantum field theories.    Consider a free field theory with $N$ scalar fields  all of the same mass $m$.   Consider a box of some size
 $R$ and place one particle inside the box (in a maximally mixed state in which each of the $N$ possible particle types is equally likely).   The mass of the resulting system does not depend on $N$, but its entropy receives a contribution $\log N$ because there are $N$ choices of
 which species of particle to place inside the box.   So it seems clear that the Bekenstein bound is violated if $N$ is sufficiently large.
 
 A quite different objection involves the question of whether the Bekenstein bound is interesting in a case in which its meaning is clear.
 First let us consider a case in which the statement of the bound does have a clear meaning.   Consider a box of size $R$ containing black body radiation of temperature $T$.  (Massless particles
 in the box present a stronger challenge to the Bekenstein bound than massive ones as they have less energy for given entropy.)    Since the $S$ in the Bekenstein bound was presumed to 
 be thermodynamic entropy, we assume
 that $T$ is large enough so that thermodynamics is applicable.   For this, we need
 \be\label{donko} RT\gg 1. \ee
The total entropy of radiation of temperature $T$ filling a region of size $R$ and volume of order $R^3$ is of order $R^3T^3$; the total energy
is of order $R^3T^4$.     In order of magnitude, therefore, the ratio $RE/S$, which is supposed to
 be bounded below by a constant, is actually of order $RT\gg 1$.   Thus the Bekenstein bound is satisfied for such a system, but is not tight enough to be very interesting.  
 
 In what situation is the Bekenstein bound actually interesting?   To try to do better, we can take $RT\sim 1$.
 Two things go wrong. Frst, then the box only contains a few particles and thermodynamics is not applicable.   Second, we really should take account of the mass of the box
 and  since this mass contributes to the energy but not the entropy, that  causes the Bekenstein bound to be trivial even if $RT\sim 1$.
 
 To do better, we should get rid of the box, and consider one or a few massless particles without the box.   But then what does the Bekenstein bound mean?
 What is the entropy of a state consisting of a single particle without a box?   Thermodynamics is certainly not applicable.    And for that matter, in relativistic quantum mechanics, the ``size'' $R$
 of a state consisting of only one or a few particles is  somewhat murky, as particles cannot really be localized.   
 In other words, it seemed that in the situation in which it was interesting, the Bekenstein
 bound was ill-defined.  
 
 However, Casini \cite{Casini}, partly inspired by earlier work \cite{MMR}, showed that with a suitable reinterpretation 
 of the terms, a version of the Bekenstein bound actually is valid as a universal statement in quantum field
 theory.    The idea was to exploit the positivity of relative entropy, for measurements in a Rindler wedge.   Let $\Omega$ be the ground state of some quantum field theory,
 and let $\Psi$ be some other state in which we want to test the Bekenstein bound.   In section \ref{rindler}, we determined the density matrix $\sigma$ of the state $\Omega$
 restricted to the partial Cauchy hypersurface $\S_r$ defined by $t=0,\, x>0$, or equivalently to the right Rindler wedge $\RR_r$ defined by $x>|t|$:
 \be\label{zolbo} \sigma=\exp(-2\pi K_R),~~~~~K_R=\int_{x\geq 0}\d x \,\d\vec y \, x T_{00}(x,\vec y).\ee
 We do not know much about the corresponding density matrix of a general state $\Psi$; let us just call this density matrix $\rho$.   Positivity of relative entropy says that
 \be\label{olbo}S(\rho||\sigma)\geq 0. \ee
 The familiar definition is\footnote{Relative entropy
 for measurements in a spacetime region in quantum field theory has a rigorous definition due to Araki \cite{Araki}, using Tomita-Takesaki theory.
 For an introduction, see \cite{Notes}.   However, that definition does not lend itself well to the following analysis.  For a recent attempt to circumvent this difficulty, see \cite{KLS}.}
 \be\label{dumbo}S(\rho||\sigma)=\Tr\,\rho\log\rho -\Tr\,\rho\log\sigma.\ee    Here, although $S(\rho||\sigma)$ is actually unambiguous and ultraviolet finite,
  as the following analysis
 will essentially show, the two terms separately do not have that property.   However, one can add and subtract $\Tr\,\sigma\log\sigma$ in such a way as to write $S(\rho||\sigma)$ as
 the sum of two terms that are each unambiguous and ultraviolet finite:
 \be\label{tolbo}S(\rho||\sigma) =\left(\Tr\,\rho\log\rho-\Tr\,\sigma\log\sigma\right)+\left(-\Tr \,\rho\log\sigma+\Tr\,\sigma\log\sigma\right). \ee
 
 Let us first discuss the first term $\Tr\,\rho\log\rho-\Tr\,\sigma\log\sigma$.  Formally, this is a difference of entropies: $-\Tr\,\sigma\log\sigma$ is $S_\vN(\sigma)$, the
 von Neumann entropy of the density matrix $\sigma$, and similarly $\Tr\,\rho\log\rho$ is $-S_\vN(\rho)$, the negative of the von Neumann entropy of $\rho$.
 In a Hamiltonian approach, these von Neumann entropies measure entanglement in the states $\Psi$ or $\Omega$  between modes in the partial Cauchy hypersurface $\S_r$ 
 and modes in the complementary partial Cauchy hypersurface $\S_\ell$; in a covariant description, they measures entanglement between modes in the Rindler
 wedge $\RR_r$ and modes in the complementary Rindler wedge $\RR_\ell$.    
The von Neumann entropy is this problem is ultraviolet divergent because of entanglement between
 short wavelength modes close to but on opposite sides of the common boundary of $\S_\ell$ and $\S_r$ at $x=0$.  That common boundary, which is often called the
 entangling surface,  
  is also the ``edge'' or corner at which $R_\ell$ and $R_r$ meet; it was denoted as $\Sigma$ in  fig. \ref{Seven}.
   We illustrated the ultraviolet  divergence in the entanglement entropy in a concrete example in section \ref{sample}.
Because every state looks like the vacuum at short distances, the ultraviolet divergence is independent of the state
 and therefore the difference $\Delta S= S_\vN(\rho)-S_\vN(\sigma)$ is ultraviolet finite.   Now we can understand one
  contribution on the right hand side of eqn. (\ref{tolbo}): it is  precisely $-\Delta S$.
 
 From eqn. (\ref{zolbo}), we have $\log \sigma = -2\pi K_R$ and therefore the other contribution in eqn. (\ref{tolbo}) is $2\pi\left( \Tr\,\rho K_R-\Tr\,\sigma K_R\right)$.   
 The definition of the density matrix $\rho$ is that for any operator $\O$ supported on $\S_r$ (or in the wedge $\RR_r$),  $\Tr\,\rho\O=\la\Psi|\O|\Psi\ra$.
 Similarly, $\sigma$ has the property that for any such $\O$, $\Tr\,\sigma\O=\la\Omega|\O|\Omega\ra$.   Applying this principle with $\O=K_R$ and using the
 definition of $K_R$, we get 
\be\label{doofus}  -\Tr \,\rho\log\sigma+\Tr\,\sigma\log\sigma=2\pi \int_{\S_r} \d x\d\vec y \,x   \left(\la\Psi| T_{00}(x,\vec y)|\Psi\ra -\la\Omega|T_{00}(x,\vec y)|\Omega\ra\right). \ee
In quantum field theory, the definition of the operator $T_{00}(\vec x)$ is not straightforward; it is subject to an additive renormalization.  However, this
renormalization only involves an additive $c$-number, which cancels in the difference $\la\Psi| T_{00}(x,\vec y)|\Psi\ra -\la\Omega|T_{00}(x,\vec y)|\Omega\ra$.
So that difference, and therefore eqn. (\ref{doofus}), is well-defined, not affected by the renormalization ambiguity.  One usually picks a renormalization scheme in 
which $\la\Omega|T_{00}(x,\vec y)|\Omega\ra=0$; with such a choice the quantity in eqn. (\ref{doofus}) is $2\pi \E$, with
\be\label{oofus} \E=\int_{\S_r}\d x\,\d\vec y\, x\la\Psi|T_{00}(x,\vec y)|\Psi\ra .\ee
The inequality of positivity of relative entropy thus becomes 
\be\label{bumble} 2\pi \E\geq \Delta S, \ee
with equality only if $\Psi=\Omega$.  

Casini proposed this inequality as a rigorous version of the Bekenstein bound.   The quantity $S$ on the right hand side of the original Bekenstein bound (\ref{wongo}) 
is replaced here with $\Delta S$, the difference of von Neumann entropies between a general state $\Psi$
and the vacuum state $\Omega$.   In case $\Psi$ differs from $\Omega$ by the presence of a matter system that is well localized away from the entangling surface $\Sigma$,
$\Delta S$ will be approximately the von Neumann entropy of this matter system.   However, $\Delta S$ is well-defined for an arbitrary state $\Psi$, even if $\Psi$ differs from
the vacuum by, say, the presence of a single particle, which -- to the extent such localization makes sense relativistically -- may be located partly in $\RR_r$ and partly in $\RR_\ell$.
As for $\E$, Casini interpreted this as a substitute for the product $RE$ in the original Bekenstein bound.   (Thus, Casini defined a rigorous substitute for the product $RE$ 
but not for $R$ and $E$ separately.)   To explain the motivation for this interpretation of $\E$, suppose that $\Psi$ describes an object or matter state of some kind  that can be understood
semiclassically and that has size $R$ and energy $E$.   To use the inequality (\ref{bumble}) to make  a statement about the size, energy, and entropy of this object, we place it in $\S_r$,
that is at $x>0$.     On the other hand, to make the inequality (\ref{bumble}) as sharp as possible, we want to make $\E$ as small as possible under the constraint that the object is 
supported at $x>0$.   So, as the object under study has size $R$, we place it in the region $0<x<R$.   But then, for a system of energy $E$ localized in that range of $x$,
the order of magnitude of $\E$ is $\E\sim ER$.   Thus in a situation in which the terms in the original Bekenstein bound have a clear meaning, the inequality (\ref{bumble}) has a similar
import to the Bekenstein  bound.   But it has the virtue of being rigorously true for an arbitrary quantum state.

To underscore that the inequality (\ref{bumble}) goes far beyond any semiclassical  reasoning, we may point out that there exist states $\Psi$ such that the left and right hand
sides of the inequality (\ref{bumble}) are both negative, and still, of course, the inequality is satisfied.   To make $\E$ negative, let $\Upsilon$ be any state such that the
matrix element $\la\Upsilon|K_R|\Omega\ra\not=0$. (Such states exist since $K_R|\Omega\ra\not=0$.)     Then a suitable linear combination of $\Omega$ and $\Upsilon$
has negative $\E$.   The inequality then implies that this state has negative $\Delta S$.   In free field theory, another way to construct a state with negative $\Delta S$ is roughly the following.
Take any finite set of modes in $R_r$ that are entangled with a corresponding finite set of modes in $R_\ell$, and disentangle those particular modes without affecting the state of other
modes.  This reduces the entanglement entropy between the two Rindler wedges so it produces a state with $\Delta S<0$.



What was wrong with the attempt to disprove the Bekenstein bound by considering a theory with $N$ free fields of mass $m$ for very large $N$?  This was originally understood in \cite{MMR},
with additional analysis in  \cite{Casini}.
Suppose we place a particle  (in a mixed state of entropy $\log N$) near  $x=R$.  Naively this adds $\log N$ to the entropy and can violate the Bekenstein bound.
 It turns out that if $N$ is large enough to cause a problem,
vacuum fluctuations are  important.  
   To try to violate the Bekenstein bound, we take  $\log N>2\pi mR$ or $N>e^{2\pi mR}$.  The probability of a vacuum fluctuation in which a particle-antiparticle
pair appears and separates a distance $L$ is roughly $e^{-mL}$.   The number of such pairs with the particle near  $x= R$ and the antiparticle at $x<0$ is roughly
$N e^{-mR}$.    So if $N>e^{2\pi m R}$, the number of such pairs is overwhelmingly large, and the additional entropy due to an added particle cannot be computed
without taking into account the particles that are  present due to vacuum fluctuations.  Detailed calculation \cite{MMR,Casini} verifies consistency with the Bekenstein bound.


\subsection{R\'{e}nyi Entropy and Generalized Entropy of a Black Hole}\label{rbh}

Here we will analyze the claim cited in section \ref{bhent} that the generalized entropy $S_\gen=\frac{A}{4G}+S_\out$ is a well-defined quantity,
not subject to ultraviolet divergences, in any theory of gravity (possibly interacting with other fields) that has been satisfactorily defined or renormalized.    We will do this analysis
for a pair of black holes  entangled in the thermofield double state $\Psi_\HHI$.  In such a case, each of the two black holes is in perfect thermal equilibrium, so the distinction between
thermodynamic entropy and microscopic von Neumann entropy is not important.   As a statement about von Neumann entropy, the
 argument extends readily beyond the state $\Psi_\HHI$ to other states prepared by Euclidean 
path integrals, such as we will discuss in section \ref{just}. 

Actually, it is convenient to first consider a more general problem of showing that R\'{e}nyi entropies are well-defined in the thermofield double state.   
We recall that the R\'{e}nyi entropy of order $\alpha$ of a density matrix
$\rho$ is defined by
\be\label{mozo} R_\alpha(\rho)=\frac{1}{1-\alpha}\log \Tr\,\rho^\alpha. \ee
The von Neumann entropy is the limit of the R\'{e}nyi entropy for $\alpha\to 1$, so what we learn about R\'enyi entropy applies also to von Neumann entropy.

In making the argument, we will consider an AdS-Schwarzschild black hole with $\Lambda<0$.  
Taking $\Lambda<0$ provides an infrared regulator that eliminates the thermal instabilities 
described in section \ref{unstable}  (in the case of a sufficiently massive black hole), so we are not limited to lowest order of perturbation theory.
Indeed, if the gravitational theory considered in asymptotically AdS spacetime has a known CFT dual on the boundary, then we expect the gravitational theory to be
nonperturbatively well-defined and the main conclusion about the R\'enyi entropies to be likewise valid non-perturbatively.   Even if a dual CFT is not known, and may not exist,\footnote{A generic theory of gravity, such as Einstein gravity with or without a cosmological constant and  with 
no other fields or with only finitely many other fields, may well lack a sensible ultraviolet completion.  The cases
in which dual CFT's are known are derived from string/M-theory and correspond to theories of gravity that do have ultraviolet completions.}
the calculation of the entropies will make sense to the extent that the theory does.

Another way to avoid infrared instabilities, while keeping to $\Lambda=0$, is to take the limit that the black hole mass goes to infinity.  Then the near horizon region outside  the black
hole  converges to Rindler space.   This is a  useful framework, studied for example in \cite{CW}.    But here we will work in the AdS-Schwarzschild setting, as this makes the
role of gravity more transparent.

We will see that, for investigating the finiteness of the entropy, a theory of quantum fields in a fixed spacetime background is fundamentally different from a theory
in which gravity is dynamical.  
We start by considering an ordinary quantum field in a fixed gravitational background, which we take to be the maximal extension of the AdS-Schwarzschild spacetime,
with Penrose diagram depicted in fig. \ref{PenroseC}.  As before, we denote the asymptotically AdS regions to the right and left of the horizon as $\U_r$ and $\U_\ell$.
As explained in section \ref{thermofield}, the density matrix $\sigma_r$ that describes observations in the region $\U_r$ in the thermofield double state $\Psi_\HHI$
is \be\label{hyto}\sigma_r=\frac{1}{Z}e^{-\beta_\sH H_r}, \ee
where $\beta_\sH$ is the relevant Hawking temperature and $H_r$ is the Hamiltonian that acts on the  Hilbert space $\H_r$ of region $\U_r$.  
To compute the R\'enyi entropy $R_\alpha(\sigma_r)$, we need to compute
\be\label{zoldo} \Tr\,\sigma_r^\alpha =\frac{\Tr\, e^{-\alpha\beta_\sH H_r}}{Z^\alpha}. \ee
Now recall that the operator $e^{-\beta_\sH H_r}$ rotates the partial initial value surface $\S_r$ discussed in section \ref{thermofield} through an angle $2\pi$
inside the Euclidean AdS-Schwarzschild spacetime.   Therefore, the operator $e^{-\alpha\beta_\sH H_r}$ rotates $\S_r$ through an angle $2\pi\alpha$, producing a
singularity at the horizon with a deficit angle $2\pi(1-\alpha)$.   The quantity $\Tr\,e^{-\alpha\beta_\sH H_r}$ is simply the partition function of the field $\phi$
in this singular spacetime.   As discussed in section \ref{bhent}, that partition function will be ultraviolet divergent because of the singularity.    
There is no way to eliminate the divergence by redefining $H_r$.   Since commutators of $H_r$ with $\phi$ are required to generate time translations, the only allowed
redefinition of $H_r$ is an additive constant.  But because of the normalization condition $\Tr\,\sigma_r=1$, an additive constant in $H_r$ would be compensated by a rescaling
of $Z$, with no effect on $\sigma_r$. 

Now let us compare this with what happens if the gravitational field is taken to be dynamical, and not just a $c$-number background.   Then to compute
$\Tr\,e^{-\alpha \beta_\sH H}$, we are supposed to do a path integral over asymptotically AdS metrics whose conformal boundary is $S^2\times S^1_{\alpha\beta_\sH}$,
where $S^2$ is a unit two-sphere and $S^1_{\alpha\beta_\sH}$ is a circle of circumference $\alpha\beta_\sH$.   This is the recipe of the AdS/CFT correspondence, but it
is actually also the procedure followed by Hawking and Page (though not described in precisely the same language) long before AdS/CFT duality was formulated \cite{hp}.   For small $G$,
one expects the path integral to be dominated by a classical solution of minimum action with the appropriate asymptotic behavior.  As explained in section \ref{negative},
  the  classical solution of minimum action is  believed to be thermal $\AdS_{\alpha\beta_\sH}$ or a black
hole of appropriate mass, depending on the value of $\alpha\beta_\sH$.   Both of these solutions are smooth; no singularity appears in the computation.   Assuming any necessary renormalizations have been performed to make the gravitational path integral well-defined,
the expansion around the dominant classical solution is manifestly going to give a finite answer.   Indeed, if  the assumed gravitational theory is such that a boundary CFT exists,
what the gravitational path integral  computes is equivalent to the manifestly well-defined quantity $\Tr_{\sf {CFT}}\, e^{-\alpha \beta_\sH H}$, where $H$ is the Hamiltonian of the 
boundary CFT quantized on a unit two-sphere, and $\Tr_{\sf{CFT}} $ denotes a trace in the CFT Hilbert space.

In general, in any quantum field theory that requires regularization of divergent quantities, the finiteness of physical amplitudes depends on cancellations between
divergent loops and counterterms. 
In low energy quantum field theory with gravity, defining the gravitational path integral involves canceling the divergences in loop diagrams against
classical counterterms.   In particular, the well-definedness of the gravitational path integral that computes $\Tr\,e^{-\alpha\beta_\sH H}$ will depend on such cancellations
between loop effects and counterterms.   This is quite analogous to the claim of Susskind and Uglum that the generalized entropy is finite because of a cancellation
between a loop divergence in $S_\out$ and a renormalization counterterm that affects the value of $G$ in the classical  $\frac{A}{4G}$ contribution to black hole entropy.
 
 Indeed, the original one-loop analysis of the generalized entropy \cite{SU}  is essentially  a more explicit
special case of what we have just discussed.   Here we roughly follow \cite{CW}.   The argument is most easily expressed in terms of the effective action $I_\eff$ of the theory.
At one-loop order, this is a sum
\be\label{zingox}I_\eff = I_\cl+ \frac{1}{2}\log \det\, D .  \ee
Here $I_\cl$ is the classical action, defined in terms of a bare Newton constant $G_0$, and  $\det\,D$ is the one-loop determinant of the matter fields (one-loop gravitational fluctuations
are included, and for simplicity the matter fields are assumed to be bosonic; fermion determinants contribute with the opposite sign).  
If the theory has been successfully renormalized, then $I_\eff$ is well-defined and finite; concretely, the cutoff dependence of $G_0$ is defined to cancel divergences in
$\frac{1}{2}\log \det\, D$.   
 The quantum-corrected 
black hole solution is an extremum of the quantum effective action $I_\eff$, not of the classical action $I_\cl$.     The definition of $I_\eff$ is that the partition function is
$Z=e^{-I_\eff}$, so as in eqns. (\ref{Boxy}),(\ref{oxy}), the black hole entropy at inverse temperature $\beta$ is 
\be\label{bodo}S(\beta)=\left(1-\beta \frac{\d} {\d\beta}\right)\log Z(\beta)=-\left(1-\beta \frac{\d} {\d\beta}\right)I_\eff(\beta)\ee
or in more detail
\be\label{nodo}S(\beta)
=-\left(1-\beta \frac{\d} {\d\beta}\right)\left( I_\cl -\frac{1}{2}\log \det\, D\right).\ee
Here $I_\eff(\beta)$ is the effective action of a black hole that has inverse temperature $\beta$, and has a mass $M(\beta)$ that can be found by extremizing the effective
action for a given $\beta$ and evaluating the ADM mass at infinity.   The function $M(\beta)$ will receive quantum corrections and will not coincide with the classical result.


In eqn. (\ref{nodo}) as just described, to evaluate the derivative with respect to $\beta$, 
we should vary $\beta$ and vary $M$ as a function of $\beta$ so that the quantum-corrected black hole solution remains smooth at the horizon,
and then evaluate the right hand side of eqn. (\ref{nodo}).
But just as in section \ref{another}, since in eqn. (\ref{nodo}) we only need the first derivative with respect to $\beta$, and $I_\eff(\beta)$ is obtained by evaluating the effective
action at an extremum, we will get the same result if we vary $\beta$ keeping $M$ fixed, producing a conical singularity at the horizon.  
When we do the calculation that way, the contribution to eqn.  (\ref{nodo}) from $ -\frac{1}{2}\log \det\, D$ is just the replica trick calculation of the matter entropy
$S_\out$ outside the horizon.   The contribution of the conical singularity at the horizon is $A/4 G_0$.  Of course, $G_0$ is ultraviolet divergent as in eqn.
(\ref{dumbox}).   But  the form (\ref{bodo}) makes it obvious that these divergences cancel, since ultraviolet divergences have been canceled in defining $I_\eff(\beta)$.

An interesting detail about this is that the area $A$ receives quantum corrections:
\be\label{ziff} A=A_\cl +G b_1+\O(G^2),\ee
where $A_\cl$ is the classical area and the one-loop correction is $Gb_1$.   The contribution $A/4G_0$ to the generalized entropy 
from the $I_\cl$ term in eqn. (\ref{nodo}), is then, using eqn. (\ref{dumbox})
for $G_0$,
\be\label{melbox}   \frac{1}{4}\left(\frac{1}{G}- f'\Lambda^2\right)\left(A_\cl +G b_1\right).  \ee
We see that in order $G^0$, the correction to the area contributes only the finite term $b_1/4$ to the entropy.  But in order $G$, there is a divergent term
$-f'\Lambda^2b_1/4$.   Therefore, in two-loop order and higher, the correction to the horizon area plays a role in the cancellation of divergences
that makes the generalized entropy finite.
 



\section{The Ryu-Takayanagi Formula}\label{rt}

At this point, it is hopefully clear that von Neumann entropy as well as thermodynamic entropy is important in black hole physics.
As there is a Bekenstein-Hawking area formula for the thermodynamic entropy, one may wonder if there is also a similar area formula
for von Neumann entropy.   In fact,  in the context of AdS/CFT duality, this question was answered before it had been widely asked by the Ryu-Takayanagi (RT) formula \cite{RT},
with several important later refinements \cite{HRT,LM,BDHM,FLM,NEW}.  

In section \ref{hm}, we will describe a heuristic motivation for the RT formula.   In section \ref{original}, we explain the original setting in which the RT formula
was formulated, and some interesting tests of it in that context.
In section \ref{just}, we sketch a proof of the RT formula, following \cite{LM}.   In section \ref{pageagain}, we briefly summarize a few of the further developments.



\subsection{Heuristic Motivation}\label{hm}

 \begin{figure}
 \begin{center}
   \includegraphics[width=6.6in]{Fig21.pdf}
 \end{center} 
\caption{\footnotesize (a) Two black holes, in different asymptotically AdS regions, entangled  in the thermofield double state $\Psi_\HHI$.  Shown are 
the exterior regions $\U_\ell$ and $\U_r$, and the bifurcation surface $\Sigma$.  
(b) An observer $O_r$ with access to the right conformal boundary creates a new
 state by acting with a unitary operator that modifies the state near a given point on the conformal boundary.   Depicted is the spacetime history of this state assuming that
 it is allowed to evolve to the past and future via the unperturbed Hamiltonian.  Back reaction on the geometry (which causes the horizon to move outward)
 is ignored here and in (c) and (d).  (c) The observer $O_r$ makes multiple such
  perturbations at different times.   (d) An observer $O_\ell$ with access to the left conformal boundary makes similar perturbations of the state. (e)  A possible outcome of these manipulations, with back reaction
 taken into account.
 The original bifurcation surface $\Sigma$ lies far behind the horizons of $O_r$ and $O_\ell$, deep  inside the ``wormhole'' that connects the two sides.    $\Sigma$
  is not a horizon any more, but it is an extremal surface and its area is unchanged. \label{TFDmany}}
\end{figure} 

We start with a heuristic justification of the RT formula based on considering a pair of black holes, 
 entangled in a general state.    To begin with, consider  two black holes
in thermal equilibrium, entangled in the thermofield double state $\Psi_\TFD$.       Shown in the Penrose diagram of
fig. \ref{TFDmany}(a)  are the diagonal lines that represent past
and future horizons for an observer in the left or right exterior region $\U_\ell$ or $\U_r$, and the bifurcation surface $\Sigma$ at which the past and future horizons meet.  As usual
$\U_\ell $ and $\U_r$ are spacelike separated from $\Sigma$ and are respectively to its  left or right.   The conformal boundary of the spacetime consists of two copies of the Einstein static universe
$\S^2\times \R$, appearing as the left and right boundaries of the Penrose diagram.   

An observer $O_r$ with access to the right boundary, by manipulating the boundary conditions in a way described in the AdS/CFT correspondence \cite{EW}, 
 can create a new state that differs from the original one in region $\U_r$
(and in the past and future wedges as well, as we will see), but not in $\U_\ell$; conversely an observer $O_\ell$ with access to the left boundary can disturb the spacetime in region $\U_\ell$
but not in $\U_r$.   
However, whatever can be done by these boundary observers will not disturb the entanglement entropy between the two sides (see the analysis of eqns. (\ref{mizo}) and (\ref{vizo})).
We will use this as a clue to suggest what sort of area formula could represent the von Neumann entropy.


What can $O_r$ do to disturb the state?   At some chosen time $t$, $O_r$ can modify the state by injecting a particle in from the boundary (fig. \ref{TFDmany}(b)).
(Concretely, this is done by manipulating the boundary conditions in a way that is familiar in the AdS/CFT correspondence \cite{EW}; note that here we do not need to assume
the existence of a full-fledged CFT dual of the bulk gravitational theory under study.)  
As explained in \cite{SS}, the most convenient way to look at the outcome of injecting a particle is the following.  The action of the observer creates from $\Psi_\TFD$ a new state $\Psi'$ whose
evolution we can usefully study in the unperturbed dynamics; in other words, once the new state $\Psi'$ is selected, we evolve it forwards and backwards in time using the unperturbed
Hamiltonian, as if the observer is not there.   Followed forwards in time, a particle injected into the spacetime by the observer $O_r$ will most likely eventually fall across the future
horizon; however, if we follow the same trajectory backwards in time, the particle will be reflected from the conformal boundary of the spacetime, return inward, and most likely eventually fall across
the past horizon.   The spacetime evolution of the perturbed state is depicted in fig. \ref{TFDmany}(b).  This is a schematic picture in which the modification of the geometry by the injected particle is
not shown (there is no claim, for example,  that the resulting spacetime can be obtained by gluing together  pieces of AdS Schwarzschild solutions with different masses).

Of course $O_r$ can make such manipulations repeatedly, creating a state in which many particles emerge from the past horizon, are reflected from the right conformal boundary, and eventually
fall back behind the future horizon, as in  \ref{TFDmany}(c).      This figure has not been drawn realistically to show the back-reaction on the geometry of the infalling particles (and interactions
among these particles have also been ignored).
Even if the injected  particles have modest energy, the resulting back-reaction can be large if the particles  are injected into the spacetime at widely separate times  and out of
time order \cite{SS,SSagain}.  The consequences of  this
back-reaction are  very interesting and surprisingly complicated, with an intimate relation to chaos in black hole physics \cite{SS}, as partly anticipated in \cite{DT}.
For our present purposes of motivating the RT formula, the only aspect of this that we need to know is that injecting particles from the right boundary into the bulk increases the ADM mass of the spacetime
as measured on the right boundary, causing the horizon to move outward.   Therefore, in fig. \ref{TFDmany}(c), the surface labeled $\Sigma$ no longer lies on the past or 
future horizon from the point of
view of $O_r$, though as nothing has been done to the part of the spacetime that is to the left of $\Sigma$, 
this surface is still the intersection of past and future horizons from the
point of view of $O_\ell$.

However, the observer $O_\ell$ is, of course, similarly free to modify the state by injecting particles from the left boundary.   This will produce the still more complicated spacetime of
 fig. \ref{TFDmany}(d),
which again has been drawn ignoring back-reaction and particle interactions.    For our purposes, what is important about this picture is the following.   First of all,  the 
observers $O_\ell$ and $O_r$ have been able to modify the geometry everywhere except at the bifurcation surface $\Sigma$.  Second, after these manipulations, the past and future horizons
of $O_r$ have moved to the right, the past and future horizons of $O_\ell$ have moved to the left, and the surface $\Sigma$ is behind the past and future horizons of both observers.
A schematic depiction  of this  is shown in fig. \ref{TFDmany}(e).  The past and future horizons of $O_\ell$ are far to the left of the past and future horizons
of $O_r$.   Between the horizons of $O_\ell$ and $O_r$ is a long ``wormhole,'' out of sight of each observer and beyond their influence.   The former bifurcation surface $\Sigma$ is still present, with its area unchanged, somewhere in the wormhole.

Now, since whatever the two observers have done has not changed the entanglement entropy between the two sides, if we are going to find an area formula for that entanglement
entropy, it must be the area of a surface whose area the two observers are unable to change.  But since the only place where the actions of $O_\ell$ and $O_r$ do not disturb
the geometry is the former bifurcation surface $\Sigma$, we conclude that if the area of any surface in the spacetime is going to represent the entanglement entropy of interest, 
this is most plausibly going to be $\Sigma$.

But how do we characterize the surface $\Sigma$?  Before the manipulations by $O_r$ and $O_\ell$, this surface was the bifurcation surface where the two horizons meet.  
After those manipulations, $\Sigma$
is no longer on the  horizon of either observer.   If this surface is going to represent an entropy, we need another way to characterize it.

With this aim, we go back to the original spacetime of fig. \ref{TFDmany}(a), before any manipulations by the two observers.   
The extended Schwarzschild solution has a time translation symmetry and an $SO(3)$ symmetry that rotates the polar angles (which are not shown in the Penrose diagram).
The Penrose diagram exhibits an additional  $\Z_2\times \Z_2$
symmetry, where one $\Z_2$ is a spatial reflection that exchanges the left and right ends of the figure, and the other $\Z_2$ is a time-reversal symmetry that exchanges the past and future.
  The bifurcation surface  $\Sigma$  is invariant  under $\Z_2\times \Z_2$, and this 
 ensures that $\Sigma$  is an {\it extremal surface}, meaning a surface whose
area is invariant to first order if it is slightly displaced in any direction.   This extremal property can also be deduced from the fact that $\Sigma$ is the fixed point set of the time-translation
symmetry.\footnote{Because time-translation symmetry rescales $U$ and $V$, it implies that the horizon area is independent of $U$ at $V=0$ and independent of $V$ at $U=0$.
(We see this explicitly in eqn.  (\ref{nimpdef}): if $U$ or $V$ vanishes, then $r=2GM$.)   Hence at $U=V=0$, the $U$ and $V$ derivatives of the horizon area both vanish,
so the bifurcation surface at $U=V=0$ is an extremal surface.}

Rather than invoking the symmetries, we can also demonstrate that $\Sigma$ is an extremal surface with formulas.   The area of the two-sphere
represented by a point in the Penrose diagram is $4\pi r^2$, where the relation between $r$ and the Kruskal-Szekeres null coordinates $U,V$ is\footnote{This formula is for an asymptotically
flat Schwarzschild black hole, but the analogous formula for an AdS-Schwarzschild black hole is similar.}
\be\label{dotme} \left(\frac{r}{2GM}-1\right) e^{r/2GM}=-UV. \ee
The bifurcation surface $\Sigma$ is at $U=V=0$, and from the formula (\ref{dotme}), it is evident that $\left.\frac{\partial r}{\partial U}\right|_{U=V=0}=\left.\frac{\partial r}{\partial V}\right|_{U=V=0}=0$.
Since the area is $4\pi r^2$, the fact that $r$ is stationary at the horizon again shows that $\Sigma$ is an extremal surface.

$\Sigma$ has a few additional important properties.   Let $T$ and $X$ be timelike and spacelike coordinates such that $U=T-X$, $V=T+X$, so $-UV=-T^2+X^2$.
From eqn. (\ref{dotme}) we see that 
\be\label{icono}\frac{\partial^2 r}{\partial X^2}>0. \ee
Thus the area of $\Sigma$ is a local minimum if $\Sigma$ is moved in a spatial direction.\footnote{It is also true that the area of $\Sigma$ is a local maximum if $\Sigma$
is moved in a timelike direction.   This condition need not be stated separately, as for Einstein gravity coupled to a reasonable matter system (satisfying the null energy condition),
it follows from (\ref{icono}) together with the Raychaudhuri equation. For example, see \cite{Twice}.} 
Another important fact is that $\Sigma$ is homologous to either the left or right conformal boundary of the spacetime.  In fact, the homology can be made through any Cauchy hypersurface
that passes through $\Sigma$, such as the surface $t=0$ that is the fixed point set of the time-reversal symmetry.

Finally, we can formulate the RT formula, 
 or more precisely its time-dependent HRT generalization \cite{HRT}, for the sort of general two-sided geometry that we have been considering here.  According to the RT or HRT formula,
 the von Neumann entropy of a density matrix that describes observations made at the left boundary or at the right boundary, or equivalently the entanglement entropy
between the two sides, is (to lowest order in $G$)
\be\label{nubo} S_\vN=\frac{A(\SIgma)}{4G},\ \ee
where $A(\Sigma)$ is the area of an extremal surface $\Sigma$ that is a local minimum of the area in spatial directions, and is homologous to either conformal boundary.
If there is more than one such surface, then they are called candidate RT (or HRT) surfaces, and the entropy is given by $A(\Sigma)/4G$, where $\Sigma$ is the candidate RT
surface that has the least area among all such surfaces.\footnote{If the candidate RT surface of minimum area is not unique, then of course it does not
matter which one we pick in evaluating the RT formula for the leading order entropy.  In this case, it is believed that there are quantum corrections to the entropy
of order $G^{-1/2}$, rather than the usual $\O(1)$ \cite{MWW}.}

In particular, by the sort of manipulations sketched in fig. \ref{TFDmany}, the observers $O_\ell$ and $O_r$ may be able to create a spacetime with multiple candidate RT
surfaces.   But the RT/HRT formula says that as these manipulations cannot change $S_\vN$, any such additional candidate RT surfaces have an area at least as large as that of the original
bifurcation surface  $\Sigma$.  This is a nontrivial prediction about classical general relativity.

In section \ref{original}, we will discuss more examples of the RT formula at work, in the original setting in which it was proposed. 


\subsection{The Original Setting}\label{original}




The RT formula \cite{RT} was originally 
formulated as a statement about the entropy of a region in the boundary conformal field theory.   We recall  that according to this duality, a particular $d$-dimensional CFT, formulated on a $d$-manifold $Y$, has
the same content as a $D=d+1$-dimensional gravitational theory\footnote{\label{exception} In this article, we have generally discussed black holes in the familiar  $D=4$ world.
Extension  to other values of $D$ would generally not have added much.
However, in analyzing the RT formula, we will consider arbitrary $D$ for several reasons.   One reason is that in string theory, there are important examples with various values of $D$.
Another reason is that  the case $D=3$, $d=2$ is illuminating and easy to visualize.  Yet another reason is that if one wants to use the RT formula to learn about gravity,
one might consider  $D=4$, $d=3$ to be the most natural case, but if one wants to use it to study entanglement entropy in quantum field theory, then one might be particularly
interested in $D=5$, $d=4$.  The cases $D=4,d=3$ and $D=3,d=2$ are also important in some condensed matter applications. So in short it seems artificial to limit
a discussion of the RT formula to a particular value of $D$. }   formulated on an asymptotically locally AdS manifold $X$ whose conformal boundary is $Y$.   In principle,
for given $Y$, one must take into account all possible choices of $X$, but in the sort of simple applications of the RT formula that we will discuss, there is a particular $X$
that dominates for small $G$.   In fact (as in \cite{RT}), the main example that we will discuss here is that $Y$ is the $d$-dimensional Einstein static universe $S^{d-1}\times \R$,
and $X$ is $\AdS_D$, Anti de Sitter space of dimension $D=d+1$.   
As in  the original formulation of the RT formula, we will assume a time-reversal symmetry $t\to -t$ that leaves fixed the initial value surfaces $\S\subset X$ and $\S'\subset Y$, respectively 
of dimension $d$ and $d-1$. Here $\S'$ is the conformal boundary of $\S$.
(To be more precise, we formulate the CFT on a manifold $Y$ with a time-reversal symmetry, and we assume -- as is true in simple examples, including those
we will discuss -- that the relevant $X$ also possesses this symmetry.)   Now, let $\A$ be some region in $\S'$.  We assume that the boundary of $\A$ is an embedded
$d-2$-dimensional manifold $\partial\A\subset \S'$.
For some given state $\Psi$ of the quantum fields on $Y$, let $\rho_\A$ be the density matrix appropriate for measurements in the region $\A$. 
The original version of the RT formula answered the following question: What is the von Neumann entropy $S_\vN(\rho_\A)$?   The proposed
answer was that this entropy is given by a formula analogous to the Bekenstein-Hawking entropy formula
\be\label{rtform} S_\vN(\rho_\A)=\frac{A(\Sigma_\A)}{4G}+\cdots,\ee 
where $\Sigma_\A$ is a particular surface known as the RT surface of $\A$, and 
 the omitted terms are $\O(1)$ for small $G$.     The definition of $\Sigma_\A$ is as follows:
 among all $d-1$-dimensional surfaces in $\S$ whose boundary coincides with $\partial \A$ and which are also homologous to $\A$, $\Sigma_\A$ is the one whose area $A(\Sigma_\A)$ is smallest.   To be more precise, this ``area'' is really a renormalized area, as discussed at the end of this section, 
and as $\Sigma_\A$ has dimension $d-1$,
it is really an area in the $d-1$-dimensional sense (thus it is only an ordinary area if $D=4$, $d=3$).  The statement that $\Sigma_\A$ is homologous to $\A$ means that
$\Sigma_\A$ and $\A$ together are the boundary of a region in $\S$.   
There is no explicit dependence on the quantum state $\Psi$ in  the formula (\ref{rtform}), so if true this formula
 implies that for small $G$, the leading  contribution to the entropy depends on $\Psi$
only to the extent that the geometry depends on $\Psi$.    When it is clear what density matrix is intended, we abbreviate $S_\vN(\rho_\A)$ as $S_\A$.

 \begin{figure}
 \begin{center}
   \includegraphics[width=3.6in]{Fig22.pdf}
 \end{center}
\caption{\footnotesize The disc $\S$, with conformal boundary $\S'$, is a Cauchy hypersurface in $\AdS_3$.  $\S'$ is decomposed as the union
of two complementary  intervals $\A, \B$, as shown.  $\A$ and $\B$ have the same RT surface, denoted $\Sigma_{\A/\B}$.   It  is the  curve in $\S$ of minimal (renormalized) length whose ends are the endpoints of $\A$
(or $\B$).  As a curve of minimal length, it is a geodesic.   \label{RTpic2}}
\end{figure} 




If there are several surfaces  $\Sigma_{\A,\alpha}\subset \S$ that obey the necessary topological conditions to be the RT surface of $\A$
($\partial \Sigma_{\A,\alpha}=\partial\A$, and $\Sigma_{\A,\alpha}$ is homologous to $\A$) and that locally minimize
the area, then they are called candidate RT surfaces.   The true RT surface is the candidate RT surface of minimal area.  

The case $d=2$ is particularly easy to visualize.   As a first example, we will take the full spacetime to be $\AdS_3$, with conformal boundary the Einstein static universe
$S^1\times \R$, and the state to be, for example,
the CFT ground state (or any other state that produces negligible back-reaction on the geometry).      Then a  time-reversal symmetric  initial value surface 
is the disc\footnote{$\S$ is a disc topologically, but its metric is that of Euclidean AdS$_2$.} $\S$ of fig. \ref{RTpic2}; its conformal boundary is a circle $\S'$.  To illustrate the RT formula, we decompose $\S'$ as the union of complementary closed intervals $\A$, $\B$ (by which
we mean intervals that share common endpoints but are otherwise disjoint).  For $d=2$, $\Sigma_\A$ has dimension
 $d-1=1$, so it is an embedded one-manifold and its ``area'' is really a
(renormalized) length.  An embedded one-manifold of minimal length is a geodesic.  So in fact, $\Sigma_\A$ is just a geodesic in $\S$  that connects the endpoints of $\A$, as shown in the figure.
In this particular example, the geodesic in $\S$ that connects the endpoints of $\A\subset \S'$ is unique.  Since it is unique, it is 
 the RT surface $\Sigma_\A$. The union of   $\A$ and $\Sigma_\A$ is the boundary
of a region in $\S$, so the homology constraint is satisfied.

In this simple example, as  the combined system $\A\B$
is in a pure state -- namely the ground state of the CFT -- we expect $S_\A=S_\B$.   From the point of view of the RT formula, this is true because $\A$ and $\B$
have the same RT surface.   Indeed, $\A$ and $\B$ have the same endpoints, so the geodesic $\Sigma_\A$ connecting the endpoints of $\A$ is trivially the same as the geodesic
$\Sigma_\B$ connecting the endpoints of $\B$.   We denote this common RT surface of $\A$ and $\B$ as $\Sigma_{\A/\B}$.


 \begin{figure}
 \begin{center}
   \includegraphics[width=5.6in]{Fig29.pdf}
 \end{center}
\caption{\footnotesize (a) A geodesic that contains a crossing.  (b) Such a crossing can be resolved in two ways.   This does not affect the endpoints of the geodesic,
and one of the resolutions will satisfy the homology constraint.  The resolution shortens the length of the curve.  So a geodesic with a self-crossing is never the RT surface.  \label{resolution}}
\end{figure} 

In this particular example, there was only one geodesic connecting the endpoints of $\A$, so it is inevitably the RT surface $\Sigma_\A$.  In a more complicated example, 
there might be several candidates joining the endpoints of $\A$.  In a negatively curved two-manifold such as $\S$, any geodesic locally minimizes the length, so any such geodesic that satisfies the homology constraint is a candidate RT surface.   In looking for the true RT surface, we can restrict ourselves to embedded geodesics, because a geodesic 
that is not embedded can always be shortened by resolving the crossing (fig. \ref{resolution}), so is never the RT surface.
(An RT surface is not required to be connected, so we do not have to worry about whether resolving the crossing affects  whether the geodesic is connected.)
Of these candidates, the true RT surface $\Sigma_\A$ is the one of least renormalized length.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=5.1in]{Fig23.pdf}
 \end{center}
\caption{\footnotesize (a) This figure represents a time zero slice $\S$ of a two-sided  AdS-Schwarzschild black hole in dimension $D=3$ (that is, a BTZ black hole).   The conformal boundary now has two components.
One of those components, labeled $\S'$, is decomposed as the union of complementary regions $\A,$ $\B$ as before.   (b)   In applying the RT formula to regions $\A$ and $\B$,
only the part of (a) to the left of the bifurcation surface is relevant, since geodesics with endpoints on $\S'$ will not reach $\Sigma$.   The relevant part of fig. (a) is drawn
here  in a convenient view.  It is a disc with a grayed-out hole in the center, representing the black hole.   The boundary of the hole is the bifurcation surface $\Sigma$.   There are three relevant geodesics in this figure: two of them
are embedded geodesics $\varSigma_\A$ and $\varSigma_\B$
that connect
the endpoints of $\A$ and $\B$ and are homologous respectively to $\A$ and $\B$, and the third is the closed embedded geodesic $\Sigma$.    \label{BTZpic}}
\end{figure} 
It is instructive to see what happens if the combined system $\A\B$ is not in a pure state.  
A small entropy of the combined system will not matter; to get something interesting we should put the combined system in a state with entropy of order $1/G$, which is most naturally
accomplished by introducing  a black hole.
 So  we consider two copies of the Einstein static universe $S^1\times \R$ entangled
in the thermofield double state $\Psi_\HHI$, at some temperature.   The bulk spacetime is then the maximally extended Schwarzschild solution
(in three dimensions, the BTZ black hole with zero angular momentum \cite{BTZ}).
A $t=0$ slice of the black hole, which we call $\S$,  is an Einstein-Rosen bridge or
``wormhole'' connecting the two components of  the conformal boundary
(fig. \ref{BTZpic}(a)).  $\S$ is a surface of constant negative curvature with  $\Sigma$, the bifurcation surface at which various horizons meet, at its center.
The conformal boundary of $\S$ is the disjoint union of two circles, one for each asymptotically AdS world outside the black hole horizon.
We focus on one component of the conformal boundary, which we call $\S'$.  
We divide  $\S'$ as the union of two complementary intervals $\A$ and $\B$.   It is a simple fact of differential geometry that a geodesic connecting two points on the same component of 
the conformal boundary of $\S$ never reaches $\Sigma$; it remains everywhere on one side of $\Sigma$.  (This can be proved using the constant negative curvature of $\Sigma$.)  Hence to understand candidate RT surfaces of $\A$ or $\B$,
we can restrict attention to the left half of fig. \ref{BTZpic}(a), which is drawn in a convenient way in fig. \ref{BTZpic}(b).  Depicted in this figure is an annulus; the outer boundary
of the annulus is the circle $\S'=\A\cup \B$, and the inner boundary is the surface $\Sigma$, which is the intersection of $\S$ with the horizon.   
The ``hole'' at the center of the annulus represents the black hole.

In fig. \ref{BTZpic}(b), any two points on the boundary are joined by precisely two (connected) embedded geodesics, labeled in the figure as $\varSigma_\A$ and $\varSigma_\B$. (There
are also infinitely many self-intersecting geodesics with the same endpoints that wrap around the hole any number of times.) We
call these $\varSigma_\A$ and $\varSigma_\B$ as we do not yet know if they are the true RT surfaces $\Sigma_\A$ and $\Sigma_\B$.  $\varSigma_\A$  goes around the black hole to the left and 
$\varSigma_\B$  goes around it to the right.  There is just one more embedded geodesic, namely the horizon $\Sigma$.
Since these are the only three embedded geodesics, a candidate RT surface must be built from them.   The candidate RT surfaces for $\A$ are $\varSigma_\A$ and the
disjoint union $\varSigma_B\cup \Sigma$, which is also  homologous to $\A$.   Similarly the candidate RT surfaces for $\B$ are $\varSigma_\B$ and $\varSigma_\A\cup \Sigma$.
Note that $\varSigma_\B$ is not a candidate RT surface for $\A$ as it is not homologous to $\A$; similarly $\varSigma_\A$ is not a candidate for $\B$.

If $\A$ and $\B$ are of approximately equal size, then
$\varSigma_\A$ and $\varSigma_\B$ are indeed the true RT surfaces, because $\varSigma_\A$ and $\varSigma_\B$ have almost the same renormalized length,
so the renormalized length of $\varSigma_\A$ is less than that of the other candidate $\varSigma_\B\cup \Sigma$.
   Note that if $\A$ and $\B$ are not of the same size, then $\varSigma_\A$ and $\varSigma_\B$ are of unequal
lengths and therefore,   
 the RT formula implies that $S_\A\not= S_\B$.   It is no surprise that $S_\A$ and $S_\B$ can be unequal, as the presence of the black hole means that
the combined system $\A\B$ is in a thermal state, not a pure state.


Now let  $\C$ be  the second boundary  of $\S$ at the right of fig. \ref{BTZpic}(a).  Since $\C$ has no boundary, its RT surface will be an embedded closed geodesic that is homologous to $\C$.
 There is only one candidate, namely the horizon $\Sigma$.   So $\Sigma=\Sigma_\C$ is the RT surface of $\C$
and therefore $S_\C$  is just the Bekenstein-Hawking entropy of the black hole.
 In fact, the RT formula was constructed to incorporate this expectation.


In this situation, $\Psi_\HHI$ is a pure state of the combined system $\A\B\C$.  Hence $S_\A=S_{\B\C}$,
and subadditivity of entropy $S_\B+S_\C\geq S_{\B\C}$ tells us that
\be\label{junco} S_A\leq S_\B+S_\C. \ee 
If $\Sigma_\A$ and $\Sigma_\B$ are the RT surfaces of $\A$ and $\B$, then the inequality (\ref{junco}) implies that 
\be\label{numbox}A(\Sigma_\A)\leq A(\Sigma_\B)+A(\Sigma_\C)=A(\Sigma_\B)+A(\Sigma).\ee
This inequality is satisfied if $\A$ and $\B$ are of approximately equal size, but it is violated if  $\A$ is much bigger than $\B$.   
In that case, the true RT surfaces of $\A$ and $\B$ are  $\Sigma_\A=\varSigma_\B\cup \Sigma$ and $\Sigma_\B=\varSigma_B$.
Clearly the inequality (\ref{numbox}) is then saturated.


Going back to fig. \ref{RTpic2}, instead of discussing the von Neumann entropy of $\A$ or $\B$, let us discuss the von Neumann entropy of the whole boundary $\S'$.
Since the whole system is in a pure state, the entropy of $\S'$ should vanish.
   To get that answer from the RT formula,
the RT surface $\Sigma_\S'$ must be empty.   Indeed, the empty surface is an allowed RT surface in this example because (1) $\S'$ has no boundary, so the condition that
the boundary of $\Sigma_{\S'}$ coincides with the boundary of $\S'$ allows $\Sigma_{\S'}$  to be empty, and (2) $\S'$ is the boundary of a two-manifold in $\S$ (namely $\S$ itself),
so it is homologous to the empty set, and therefore the empty set satisfies the homology condition that an RT surface is supposed to satisfy.
   By contrast in fig. \ref{BTZpic}(a), $\C$ has no boundary, but it is not homologous to the empty set, so the empty surface is not
a candidate RT surface for $\C$.   This is as expected as in that example, the quantum state restricted to $\C$ is thermal, with a positive von Neumann entropy.

These examples have illustrated a few important points: the RT surface of a region must be homologous to that region; the empty set is allowed as a possible RT surface;
and as parameters are varied, there can be a phase transition in the location of the RT surface.   We will describe another two illustrative examples.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=5.1in]{Fig24.pdf}
 \end{center}
\caption{\footnotesize (a) $\S$ is an initial value surface in $\AdS_3$.  $\A$ and $\B$ are disjoint intervals in the conformal boundary $\S'$.
If $\A$ and $\B$ are sufficiently small compared to their separation, then the RT surface of the union $\A\cup \B$ is just the union of the separate RT surfaces of $\A$ and $\B$.
The mutual information $I(\A:\B)$ vanishes in leading order $1/G$.
(b) If instead $\A$ and $\B$ are sufficiently large compared to their separation, a quite different candidate RT surface has a smaller renormalized length.
In this case, the mutual information $I(\A:\B)$ is nonvanishing in leading order.    \label{TwoIntervals}}
\end{figure} 

 \begin{figure}
 \begin{center}
   \includegraphics[width=3.1in]{Fig25.pdf}
 \end{center}
\caption{\footnotesize Three regions $\A,\B,\C$ in the conformal boundary of an initial value surface in $\AdS_3$.   The RT surface of $\A\B$ is the union of the segments labeled 1 and 3;
the RT surface of  $\B\C$ is the union of segments labeled 2 and 4.   The union of 2 and 3 is a surface whose endpoints comprise the boundary of $\B$, so its  renormalized length
exceeds that of the RT surface of $\B$; similarly the union of 1 and 4 has a renormalized length that exceeds that of the RT surface of the combined region $\A\B\C$.  So
the RT formula predicts the inquality $S_{\A\B}+S_{\B\C}\geq S_\B+S_{\A\B\C}$ of strong subadditivity.  \label{SSA}}
\end{figure} 

In fig. \ref{TwoIntervals}, we return to the case that the bulk manifold is AdS$_3$ with $t=0$ slice $\S$,  but now we consider two {\it disjoint} intervals $\A$, $\B$ in the conformal
boundary $S'$ of $\S$ \cite{Headrick}.  We already know that the RT surface $\Sigma_\A$ of  $\A$ is the geodesic connecting the endpoints of $\A$, and $\Sigma_\B$ is described similarly.
But what is the RT surface of $\A\B$, the disjoint union of the two intervals $\A$ and $\B$?  One candidate RT surface is the disjoint union $\Sigma_\A\cup\Sigma_\B$; this is
locally area-minimizing, and it is homologous to the disjoint union of $\A$ and $\B$.  That is actually the true RT surface if the intervals $\A$ and $\B$ are small enough, as in fig.
\ref{TwoIntervals}(a).
When that is the case, the inequality of subadditivity of entropy  is saturated in order $1/G$:
\be\label{melox} S_\A+S_\B=S_{\A\B}+\O(1). \ee
Equivalently, in this regime, the mutual information $I(\A:\B)=S_\A+S_\B-S_{\A\B}$ vanishes in order $1/G$.   However, if $\A$ and $\B$ are sufficiently large, a different candidate RT surface is shorter
(fig. \ref{TwoIntervals}(b)), and $I(\A:\B)$ is nonzero in order $1/G$.   This gives another interesting example of a phase transition in the location of the RT surface.

For a final example, we note that the rather deep inequality of strong subadditivity of entropy has a simple geometrical explanation in the context of the RT formula, at least in the time-symmetric
case.
This is briefly explained in fig. \ref{SSA}.  For a fuller discussion in a general $D$-dimensional context, see \cite{TakHead}.  

If the spacetime is not assumed to be invariant under time-reversal,  then one must define the RT surface not as a minimal area surface in space that satisfies a homology
constraint, but as an extremal surface in spacetime that satisfies such a constraint  and has the least area among all such surfaces 
\cite{HRT}.  It is still possible to deduce strong subadditivity in this more general context \cite{Wall2}.
The necessary argument is  much more involved and depends on subtle properties of the Einstein equations.   

Up to this point, we have ignored the fact that these entropies and areas are all divergent.   Indeed, one of the original arguments for the RT formula \cite{RT}
was that it correctly reproduces the expected ultraviolet divergence of the entanglement entropy of a region in quantum field theory. We recall that for a general region $\A$ in a $d$-dimensional
quantum field theory defined on a manifold $Y$, the entropy $S_\A$ has a leading ultraviolet divergence proportional to the area of $\partial\A$:
\be\label{divent}S_\A=\begin{cases} k \frac{A(\partial \A)}{\varepsilon^{d-2}}+\dots & d>2\cr
                                                    k\log\frac{1}{\varepsilon}+\cdots & d=2,\end{cases} \ee
where $\varepsilon$ is a short distance cutoff, $k$ is a constant that depends on the theory, the omitted terms are less singular as $\varepsilon\to 0$, and 
the behavior for $d=2$ is familiar from  section \ref{sample}.
This formula is valid in any quantum field theory, conformally invariant or not.   In the conformally invariant case, the formula for $S_\A$ is not invariant under Weyl transformations of
the metric on $Y$.   Indeed, there is no Weyl-invariant notion of the ``area'' $A(\partial \A)$ of the $d-2$-manifold $\partial \A$.   To define a ``constant'' cutoff $\varepsilon$, one has to fix a Weyl 
frame on $Y$ -- that is, one has to endow $Y$ with a Riemannian metric $h$, not just a conformal class of such metrics -- and then the area is well-defined.
All this is in perfect parallel with  the behavior of the RT formula.
We recall that the metric of an asymptotically locally AdS manifold $X$ of dimension $D=d+1$  near its conformal boundary $Y$
has the form
\be\label{confb}\d s^2=\frac{1}{z^2}\left(\d z^2+\sum_{i,j=1}^d  g_{ij}(x)\d x^i\d x^j\right) ,\ee
where $z>0$ in $X$ and $z=0$ on the conformal boundary $Y$.   The function $z$ is only uniquely defined up to multiplying by a positive function on $Y$.   A particular choice of
the function $z$ endows $Y$ with the Riemannian metric $g$ (and not just a conformal class of metrics) and also makes it possible to define a cutoff on the areas by restricting
to $z\geq \varepsilon$ for some $\varepsilon>0$.  
The metric on $Y$ can be restricted to  $\partial\A$, giving a  Riemannian metric that we will call $h$.     If $\Sigma_\A\subset X$ is an extremal surface that is asymptotic at infinity to $\partial \A$, then the metric of $\Sigma_\A$ looks near its conformal boundary   like
\be\label{nonfb} \d s^2 =\frac{1}{z^2}\left(\d z^2+\sum_{i,j=1}^{d-2} h_{ij}(y)\d y^i\d y^j\right),  \ee where $y^1,\dots,y^{d-2}$ are local coordinates on $\partial\SIgma_\A$. 
The leading behavior, for small $\varepsilon$, of the contribution of the  region $z\geq \varepsilon$ to the ``area''  of $\Sigma_\A$ (in the $D-2$-dimensional sense) is then
\be\label{fonb} A(\Sigma_\A)\sim \int_{\varepsilon} \frac{\d z}{z^{d-1}} \int_{\partial\A}\d^{d-2} y \sqrt{\det h}\sim \begin{cases} \frac{A(\partial\A)}{(d-2)\varepsilon^{d-2}} & d>2 \cr
  A(\partial\A)\log\frac{1}{\varepsilon} & d=2. \end{cases}\ee
 All this   matches the CFT answer (\ref{divent}).  
 
  A noteworthy fact,  surprising but characteristic of the AdS/CFT correspondence, is that although the
 same leading divergence arises in the boundary field theory or the bulk gravitational theory, the interpretation is different. 
 In the boundary  field theory, the divergence in the entanglement entropy $S_\A$ is an ultraviolet effect, coming from modes of short wavelength supported near $\partial\A$, while
 in the bulk gravitational theory, the divergence in the RT formula for the entanglement entropy is an infrared effect, coming from the divergence of distances, areas,  and volumes
 as $z\to 0$.
 
 We have here considered only the leading divergence in the entanglement entropy.  But in fact the parallelism between the predictions of field theory on the boundary and the RT
 formula in the bulk continues
 for subleading divergences, which in general can be matched between the boundary and bulk descriptions. 
 For $d=2$, the entanglement entropy has  only the logarithmic divergence that we have analyzed, but for $d>2$, in general the expansion of $S_\A$ for small $\varepsilon$
 has a succession of less singular terms proportional to lower powers of $\frac{1}{\varepsilon}$,  with a $\log\frac{1}{\varepsilon}$ term at the end for even $d$.  (In some cases, depending
 on the dimensions of relevant operators in a particular theory, there can be a logarithm also for odd $d$.)
    When there is no logarithmic term, it is possible,
 by subtracting the power law divergences, to define a Weyl-invariant regularized version of the entanglement entropy.   When there is a logarithm, the finite part of the entanglement
 entropy has a Weyl anomaly, as explained for $d=2$ at the end of section \ref{sample}.  Divergences  and conformal anomalies in areas or volumes of extremal submanifolds asymptotic to
 the boundary of an asymptotically locally AdS manifold were originally studied with a different motivation \cite{KS,GW}.
 

\subsection{Derivation}\label{just}



Finally we will explain a path integral argument for  the RT formula, for a large class of states \cite{LM}.  See also section 2 of \cite{malda2} for another exposition, and \cite{Fursaev}  for an earlier attempt with  some of the ideas.


We return to the two-sided situation considered in section \ref{hm}, but now, instead of considering two copies of a CFT entangled in the thermofield double state,
we will consider two copies entangled in a more general state.  The aim is to argue that the RT formula computes the entanglement entropy between the two copies,
in this more general situation.  (After explaining this argument, we will briefly sketch a similar argument in the original setting of the RT formula 
where  one aims to compute the entropy of a region $\A$ in a single copy of the CFT.)
In these arguments, we will formulate the CFT on a $d$-manifold $Y$
that is static, meaning that it is a product $\S'\times \R$, where $\S'$ is a manifold of dimension $d-1$, $\R$ parametrizes the time, and the metric on $\S'\times \R$ 
is a simple product metric.   If $\S'=S^{d-1}$, then $\S'\times \R$ is the Einstein static universe, but we do not restrict to that case.

A first point to notice is that  there are  many CFT density matrices that can be conveniently studied via AdS/CFT duality.
The most familiar one is the thermal density matrix
\be\label{utt} \rho_\th =\frac{e^{-\beta H}}{Z_\th}, \ee
where $H$ is the Hamiltonian of the CFT formulated on the spatial manifold $\S'$.  As usual, $\beta$ is the inverse temperature and $Z_\th$ is the thermal partition function
computed in the boundary CFT.   Expectations of operators in the mixed state $\rho_\th$ can, of course, be computed directly in the CFT, but in AdS/CFT duality,
they can also be computed by  a Euclidean path integral over
manifolds $X$ that are asymptotically locally AdS with $\S'\times S^1_\beta$ for conformal boundary.   All such manifolds $X$ should be included, though frequently there is
one such manifold that dominates for small $G$.     Operator insertions in the CFT path integral are reflected in the gravitational description by the choice of boundary conditions
along $Y$.

However, there are many other density matrices that in principle can be studied similarly in AdS/CFT duality.  
A typical example for illustration is the following.
  Make a relevant deformation of the CFT to get a quantum field theory that is not conformally invariant but is conformally invariant
at short distances.  Let $\t H$ be the Hamiltonian of this theory and define 
\be\label{mutt} \rho=\frac{1}{Z}e^{-\beta_1 H}e^{-\beta_2 \t H} e^{-\beta_1 H},~~~~~Z=\Tr\,e^{-\beta_1 H}e^{-\beta_2 \t H} e^{-\beta_1 H}. \ee
To show that $\rho$ is a density matrix, we need to show that it is positive and self-adjoint.   This is straightforward as
\be\label{ult}\rho=\V\V^\dagger, ~~\V=\frac{e^{-\beta_1 H}e^{-\beta_2 \t H/2}}{\sqrt{Z}}.\ee
AdS/CFT duality gives a gravitational recipe to compute expectation values of operators in the mixed state $\rho$.
The recipe involves a path integral over bulk manifolds $X$ whose conformal boundary is $\S'\times S^1_\beta$, with $\beta=2\beta_1+\beta_2$  (see fig. \ref{deriv}(a)), and with boundary conditions
that account for the modification of the Hamiltonian in the definition of $\rho$ and whatever operator insertions one wishes to make.
This construction has many obvious generalizations.   One can give the Hamiltonian a more general time-dependence, continuous or as in the preceding example
only piecewise continuous, as long as a condition like (\ref{ult}) is available to ensure that $\rho$ is a density matrix.  
Other generalizations are possible; for example, if $\O$ is an operator in the CFT -- possibly a product of local operators at different points in $\S'$ -- one can define
a density matrix
\be\label{zutt}\rho'=\frac{1}{Z'}e^{-\beta_1 H}\O e^{-\beta_2 H}\O^\dagger e^{-\beta_1 H},\ee
where $Z'$ is a normalizing factor.   Such a density matrix and many obvious combinations and extensions of these definitions can be conveniently studied in AdS/CFT duality.

The formula $\rho=\V\V^\dagger$, beyond proving that $\rho$ is a density matrix, means that we can view $\V$ as a purification of the density matrix $\rho$.
In fact, as  in the general discussion of eqns. (\ref{anytrans})-(\ref{nvector}),
the operator $\V$ 
on the CFT Hilbert space $\H$ can be associated
to a highly entangled vector $\Psi_{\V}$ in the tensor 
product $\H\otimes\H$ of two copies of  $\H$.    $\Psi_{V}$ is a  generalization  of the thermofield double state $\Psi_\TFD$: it is a pure state
of a doubled system with  density matrix $\rho$ on the original system.   In contrast to the thermofield double state, here no symmetry
is present, in general, between the two copies of $\H$.   The density matrix for the second copy is  $\t\rho=(\V^\dagger \V)^{\rm{tr}}$, where $\rm{tr}$ denotes the transpose.
This generically differs from $\rho$ though
$\rho$ and $\t\rho$ have the same entropies.


Let $\rho$ be any density matrix, such as the one in eqn. (\ref{mutt}),  that can be described in the CFT by a path integral on $\S'\times S^1_\beta$ for some $\beta$, though with operator insertions that may not be invariant under rotation of $S^1_\beta$.
  We would like to understand a Lorentz signature spacetime
related to $\rho$ in the same way that a thermal density matrix is related, if the temperature is high enough, to the extended Schwarzschild spacetime.
This is most straightforward if the density matrix $\rho$ has a time-reversal symmetry, acting on $\S'\times S^1_\beta$ as a reflection on $S^1_\beta$.  For example, if $H$ and $\t H$ are both time-reversal invariant Hamiltonians, then the density matrix $\rho$ has a time-reversal
symmetry that reverses the order of the three factors in eqn. (\ref{mutt}).   This symmetry acts by a reflection  of $S^1_\beta$ with two fixed points $p$ and $p'$, as illustrated in fig. \ref{deriv}(b).  
So the time-reversal operation acting on $\S'\times S^1_\beta$ has fixed point set $\S'\times (p\cup p')$.   


 \begin{figure}
 \begin{center}
   \includegraphics[width=6.1in]{Fig26.pdf}
 \end{center}
\caption{\footnotesize (a)  To study the density matrix $\rho=\frac{1}{Z} e^{-\beta_1 H} e^{-\beta_2 \t H} e^{-\beta_1H}$, one performs a path integral in the boundary CFT on
$\S'\times S^1_{2\beta_1+\beta_2}$   with boundary conditions that are not invariant under rotations of $S^1_{2\beta_1+\beta_2}$; rather 
$S^1_{2\beta_1+\beta_2}$ is divided into successive intervals of lengths $\beta_1$, $\beta_2$, and $\beta_1$  with boundary conditions set by $H$, $\t H$, and  again $H$.
In AdS/CFT duality, the  entropy is nonzero in order $1/G$ if this circle is contractible in the bulk manifold that dominates the gravitational description.
 (b)  If $H$ and $\t H$ are time-reversal invariant Hamiltonians, then the construction 
has a time-reversal symmetry that acts as a reflection on $S^1_{2\beta_1+\beta_2}$, leaving fixed two points  $p$ and $p'$, as sketched here.
(c) To compute $\Tr\,\rho^n$, we replace the circle $S^1_\beta$ by an $n$-fold connected cover of itself, repeating the boundary conditions $n$
times, as sketched here for $n=2$.  \label{deriv}}
\end{figure} 

Now, in AdS/CFT duality, consider the gravitational path integral in which we sum over bulk manifolds  that have $\S'\times S^1_\beta$
as their conformal boundary.  If there is a unique manifold $X$ that dominates this sum as  $G\to 0$, the time-reversal symmetry of the conformal boundary
must extend to a time-reversal symmetry of $X$.   Assuming that this is the case,\footnote{The alternative is that rather than a single manifold that dominates
for small $G$, there might be a pair of dominant manifolds exchanged by the time-reversal symmetry of the boundary conditions.  In that case, the time-reversal
symmetry of the density matrix is spontaneously broken as $G\to 0$.}  the time-reversal symmetry
of $X$ will have a fixed point set $\S$ whose conformal boundary will be the fixed point set $\S'\times (p\cup p')$ of the boundary.   Let $\tE$ be a Euclidean time coordinate
that vanishes along $\S$ and is odd under time-reversal.  The  time-reversal symmetry of the Euclidean manifold $X$ ensures that by
defining $t=-\i \tE$ and taking $t$ to be real, we get a real Lorentz signature spacetime $X_L$. (This analytic continuation leads to a real metric by the same reasoning
as  in section \ref{thermofield}, though now we are proceeding in 
reverse, starting in Euclidean signature and continuing to Lorentz signature.)
  We can view $X_L$ as the Lorentz signature spacetime that evolves from 
the initial value surface $\S$.

In the particular case of a thermal density matrix $\rho_\th =\frac{1}{Z}e^{-\beta H}$, the AdS/CFT correspondence gives a convenient bulk description of any power of $\rho_\th$,
such as $\rho_\th^n=\frac{1}{Z^n}e^{-n \beta H}$.   In particular, we can compute $\Tr\, e^{-n\beta H}$ by summing over Euclidean manifolds $X$ with conformal boundary
$\S'\times S^1_{n\beta}$.   It is then straightforward to compute the entropy by differentiating with respect to $n$, as we have done in section \ref{euclidean}.
The basic reason that this is possible is that the boundary conditions on $\S'\times S^1_\beta$ that are associated to the thermal density matrix $\rho_\th$ are local and are invariant
under rotations of $S^1_\beta$.   Hence one can study an arbitrary power of $\rho_\th$ by suitably changing the circumference of the circle.

A more generic density matrix, such as $\rho$ as defined in eqn. (\ref{mutt}),
 can still be described by a path integral on manifolds with conformal boundary
 $\S'\times S^1_\beta$, but now with  boundary conditions that are not invariant under rotations of $S^1_\beta$.  Accordingly, there  is no convenient way, either in the boundary CFT or in the
 bulk gravitational description, to access non-integer powers of $\rho$.   However, it is always straightforward to access positive integer powers of $\rho$.  To do so in the gravitational
 description,
 we just replace  $S^1_\beta$ by an $n$-fold unramified cover of itself.   This cover is a copy of $S^1_{n\beta}$, but with the boundary conditions, whatever they are, repeated
 $n$ times (fig. \ref{deriv}(c)).    A bulk path integral over manifolds asymptotic to $\S'\times S^1_{n\beta}$ gives a recipe in gravity to compute $\Tr\,\rho^n$ and therefore
 the R\'enyi entropy of order $n$.   As in the general discussion of the replica trick in section \ref{sample}, analytic continuation in $n$ then potentially enables one to compute
 the R\'enyi entropies of general $n$ and in particular the von Neumann entropy.

The implications  depend on the nature of the dominant bulk manifolds.
Not much is known in general about what sort of manifold $X$ dominates the gravitational description of a density matrix such as $\rho$.  The case
that is best understood is the case $\S'=S^{d-1}$ with $\rho$ a thermal density matrix.   In that case, as discussed in section \ref{negative}, there are two
different phases: at sufficiently large $\beta$, the dominant manifold is what we called $\AdS_\beta$ or thermal AdS, and at sufficiently small $\beta$, the
Euclidean black hole dominates.   They differ topologically in the following way.  $\AdS_\beta$ is the product of $S^1_\beta$ with another manifold $B$ (a $d$-dimensional ball).
By contrast,  in the Euclidean black hole solution,
the circle $S^1_\beta$ at infinity is contractible in the interior; it is the boundary of the cigar of fig. \ref{cigar}, and accordingly the topology of the Euclidean black hole solution is
different.   Each of these behaviors is possible for a density matrix that is
not thermal.   Indeed, in the case of a density matrix that is sufficiently close to a thermal one -- for instance, the density matrix defined in eqn. (\ref{mutt}) if the Hamiltonian
$\h H$ is a sufficiently small perturbation of $H$ -- we expect that the dominant manifold $X$ will be the same topologically as for a thermal density matrix, but with
a different metric.  It will take a sufficiently large perturbation of the density matrix to cause a jump in the topology of $X$.

Let us first see what result the replica trick gives in a case that is similar to the low temperature phase of a thermal density matrix.   That is, we will
assume that the Euclidean manifold that dominates the gravitational description of the density matrix $\rho$ is\footnote{A weaker topological condition would actually
suffice.   It is enough to know that the $X$ has an $n$-fold unramified cover that restricts on the conformal boundary to $\S'\times S^1_{n\beta}$.
The argument in the text will then show that this $n$-fold cover of $X$ is the manifold $X_n$ that dominates the computation of $\Tr\,\rho^n$.}    $X=B\times S^1_\beta$ for some
$B$.   In that case, there is an obvious candidate for  the manifold that dominates the computation of $\rho^n$, namely $X_n=B\times S^1_{n\beta}$, obtained by taking a connected  $n$-fold cover
of the circle at infinity.   It turns out that this is always the manifold that dominates the computation of $\Tr\,\rho^n$.   For this we can reason as follows.

Let $\rho$ be the density matrix  that is associated to $\S'\times S^1_\beta$ with some boundary conditions.
Then we define
\be\label{pillow}\rho=\frac{\h \rho}{\Tr\,\h\rho} \ee
where $\h\rho$ is defined via a gravitational path integral with the given boundary conditions and no normalizing factor, and  the normalizing
factor $1/\Tr\,\h\rho$   ensures that $\Tr\,\rho=1$.   
Hence
\be\label{illox}\Tr\,\rho^n =\frac{\Tr\,\h\rho^n}{\left(\Tr\,\h\rho\right)^n}. \ee
Suppose that $X=X_{[1]}$ is the bulk manifold that dominates the path integral over manifolds with conformal boundary $\S'\times S^1_\beta$ (with some given
boundary conditions associated to $\rho$), and $X_{[n]}$ dominates the path integral if $S^1_\beta$ is replaced by its $n$-fold cover $S^1_{n\beta}$ (with the boundary
conditions repeated $n$ times).   Then to leading order in $G$, denoting the action of the classical solution $X_{[n]}$ as  $I(X_{[n]})$, we have 
$\Tr\,\h\rho^n=e^{-I(X_{[n]})}$, and therefore from (\ref{illox})
\be\label{zillow} \Tr\,\rho^n=\exp(- I(X_{[n]})+n I(X_{[1]})). \ee
Equivalently, the R\'enyi entropy of order $n$ is
\be\label{illow}R_n(\rho)=\frac{1}{n-1}\left(I(X_{[n]})-n I(X_{[1]})  \right) +\O(1).\ee

Let us consider the $n$-fold cover $X_n$ as a candidate for what might be the dominant manifold $X_{[n]}$.
As $X_{n}$ is locally isomorphic
to $X$ but covers it $n$ times,  its classical action is $I(X_{n})=n I(X)$.   
Therefore, if $X_n$ is the dominant manifold in the computation of $\Tr\,\rho^n$, then eqn (\ref{illow}) tells us that $R_n(\rho)$ vanishes in order $1/G$.
If so, then by analytic continuation, all R\'enyi and von Neumann entropies vanish.
Could there be a more dominant contribution to $\Tr\,\rho^n$?   If there is another manifold that is more dominant than $X_n$, its action must be less
then $I(X_n)=n I(X)$, and in that case, eqn. (\ref{illow}) tells us that $R_n(\rho)<0 $ in order $1/G$.  For sufficiently small $G$, this contradicts the positivity 
of  R\'enyi entropies (eqn. (\ref{renyipos})).   So $X_n$ is the dominant manifold, and  $R_n(\rho)$ vanishes in order $1/G$.   By analytic continuation in $n$, this is true   
for all R\'enyi entropies $R_\alpha(\rho)$ and for the von Neumann entropy.\footnote{More explicitly, since $R_n(\rho)$ is non-increasing as a function of $n$ (eqn. (\ref{enyipos}))
and non-negative, its vanishing for any given $n$ implies vanishing for all $n'<n$.}

Now let us discuss the generalization of the high temperature thermal phase.   For sufficiently small $\beta$, as discussed in section \ref{negative}, 
the dominant manifold with $S^{d-1}\times S^1_\beta$ for its conformal boundary is the Euclidean black hole.\footnote{The analysis in section \ref{negative} was
written for $D=4$, $d=3$,  but the behavior is similar in any dimension.}   Topologically, the Euclidean black hole is  $S^{d-1}\times D$, where $D$, topologically
a disc, is the ``cigar'' in fig. \ref{cigar}.   If one replaces $S^{d-1}$ with any other $d-1$-manifold $\S'$, one  expects that for sufficiently small $\beta$, the behavior
is the same: the dominant Euclidean manifold is topologically $\S'\times D$.   The logic in expecting this is that in the limit of high temperatures, the thermal
ensemble of the CFT should not be sensitive to the spatial manifold on which the CFT is formulated.    One can also support this claim by studying the Einstein equations.

If $\rho$ is a density matrix that is not purely thermal, for example if we define $\rho$ by deforming away from a thermal density matrix as in eqn. (\ref{mutt}), the metric of the dominant
Euclidean manifold will change, but at least for a sufficiently
small perturbation, the topology will be the same.   Thus for a whole open set in the space of density matrices, we expect the dominant
manifold $X$ to be topologically $\S'\times D$.  Moreover, for a time-reversal invariant density matrix that is sufficiently close to a thermal one, we expect
the time-reversal symmetry to remain unbroken, so the dominant metric on $X=X_{[1]}$ will possess the time-reversal symmetry of the
boundary.    
   The fixed point set of this time-reversal symmetry will be topologically  $\S=\S'\times \R$, 
   as in the thermal case.  
   Here  $\S$ is the time-reversal invariant Cauchy hypersurface that was introduced earlier
   in constructing the Lorentz signature spacetime $X_L$ (but now we know the topology of $\S$ because the density matrix is close to a thermal one).
     The RT formula says that there should be  a minimum area surface $\Sigma\subset \S$ -- the RT surface -- whose area determines the entropy of $\rho$
in leading order:
\be\label{milgo|} S(\rho)=\frac{A(\Sigma)}{4G}+\O(1). \ee

For any given integer $n$, if $\beta$ is sufficiently small, then $n\beta$ is sufficiently small that the dominant manifold $X_{[n]}$ is still topologically $\S'\times D$, though with a different metric.  
The conformal boundary of $\S'\times D$ is $\S'\times S^1_{n\beta}$.   We recall that generically, the boundary conditions associated to the computation of $\Tr\,\rho^n$ are not
invariant under a general  rotation of $S^1_{n\beta}$, but they are invariant under the replica symmetry -- the group $\Z_n$ generated by a $2\pi/n$ rotation that cyclically permutes
the replicas.   We say that the replica symmetry is unbroken if the $\Z_n$ symmetry of the conformal boundary extends to a $\Z_n$ symmetry of the dominant manifold $X_{[n]}$.
This is certainly true for a thermal density matrix, so it is also true for a density matrix that is sufficiently close to a thermal one.   In the derivation of the RT formula, it is necessary
to assume that the replica symmetry is unbroken.

Now, consider the quotient 
 $X'_{[n]}=X_{[n]}/\Z_n$.  In general, the $\Z_n$ action on $X_{[n]}$ has fixed points.  In the example in which $X_{[n]} =\S'\times D$,   $\Z_n$ acts by a rotation of $D$, with a fixed
 point at the ``origin,''  so
 the fixed point set is a codimension two surface  $\Sigma_{[n]}\subset X_{[n]}$ that is a copy of $\S'$.  
In the quotient $X'_{[n]}$, $\Sigma_{[n]}$ becomes the locus of a conical singularity with opening angle $2\pi/n$.  Since $2\pi/n=2\pi+\varepsilon$ with
 \be\label{mino}\varepsilon=-2\pi\left(1-\frac{1}{n}\right), \ee the corresponding excess angle is $\varepsilon$.
 $X'_{[n]}$ is not a solution of Einstein's equations, because the equations fail along the locus $\Sigma_{[n]}$ of the conical singularity. 
 We can think of this conical singularity as the back-reaction on the geometry of a codimension two ``cosmic brane,'' whose tension is
 such that it produces a conical singularity with precisely  this cone angle.    The conical singularity contributes to the Einstein action,
 as analyzed in section \ref{another}.  Let $I_0(X'_{[n]})$ be the action of $X'_{[n]}$ integrating the Lagrangian density away from the singularity and ignoring the contribution
 of the conical singularity, and let $I(X'_{[n]})$ be the full action including the contribution of the singularity.   The relation between them, according to eqn. (\ref{dozo}) with
the value of $\varepsilon$ given in eqn. (\ref{mino})  and following the computation that led to eqn. (\ref{nofo}), is
 \be\label{dincox} I(X'_{[n]})=I_0(X'_{[n]})-\frac{A(\Sigma_{[n]})}{4G }\left(1-\frac{1}{n}\right) , \ee
 where as usual $A(\Sigma_{[n]})$ is the area of $\Sigma_{[n]}$.   
 On the other hand, the relation beween $I(X_{[n]})$ and $I_0(X'_{[n]})$ is
 \be\label{incox} I(X_{[n]})=n I_0(X'_{[n]}),\ee
 since away from $\Sigma_{[n]}$, $X_{[n]}$ is an unramified $n$-fold cover of $X'_{[n]}$.  
 So from (\ref{illow}), the leading order R\'enyi entropy is
 \be\label{hincox} R_n(\rho)=\frac{1}{n-1}\left( I(X_{[n]})-nI(X_{[1]})\right)=  \frac{n}{n-1}\left( I(X'_{[n]})-I(X_{[1]})\right) +\frac{A(\Sigma_{[n]}  ) }  {4Gn}. \ee
 
 In this form, analytic continuation in $n$ is possible, by simply varying the tension of the cosmic string or equivalently by varying the assumed cone angle $2\pi/n$.
There is no simple general formula for $R_n(\rho)$, because the metric of $X'_{[n]}$ depends on $n$ in a way that in general is difficult to control.   However,
there is a simple answer in the limit $n\to1$,
because in that limit, the excess angle $\varepsilon$ vanishes and $X'_{[n]}$ converges to the original manifold $X_{[1]}$. 
  As in section \ref{another}, since $X_{[1]}$ is a classical solution, its action is invariant to first order under any deformation
 that satisfies the boundary conditions.   To first order near $n=1$, we can view $X'_{[n]}$ as a first order deformation of $X_{[1]}$, so $I(X'_{[n]})-I(X_{[1]}) $ is of order $(n-1)^2$
 near $n=1$ and does not contribute to $S_\vN(\rho)=\lim_{n\to 1} R_n(\rho)$.   Hence
 \be\label{vnanswer} S_\vN(\rho)=\frac{A(\Sigma)}{4G},\ee
 where $\Sigma\subset X_{[1]}$ is the codimension two surface  that is the limit for $n\to 1$ of the surface $\Sigma_{[n]}\subset X'_{[n]}$.   
 
To recover the RT formula,  we must show that $A(\Sigma)$ is a surface of minimal area in $X=X_{[1]}$.    This was explained in \cite{LM}, but rather than reproduce
 their reasoning in detail, we will explain an analogy that goes back to the work of Einstein, Infeld, and Hoffman (EIH) \cite{EIH}.  Einstein was dissatisfied with postulating that a test
 particle in a gravitational field propagates on a geodesic, and wanted to argue that this follows from the Einstein field equations.   In modern language, EIH considered a small
 black hole propagating in a gravitational field with a much larger radius of curvature.   The whole spacetime is governed by the Einstein field equations; it is not possible
 to make a separate postulate governing how the black hole propagates.   The gravitational field of the small black hole contributes to the geometry and the nonlinear Einstein equations
 determine the full solution including the trajectory of the black hole.   In the limit, however, that the black hole mass goes to zero, the black hole becomes a test particle that no longer
 influences the geometry and it is indeed necessary to give a condition that describes its trajectory.   EIH showed that in that limit,
 the Einstein equations for the spacetime reduce to the condition that the spacetime in which the black hole propagates satisfies the Einstein equations, and the black hole
 propagates on a geodesic in this spacetime.
 
 To possibly make this more intuitive, we can consider  a small body like the Moon (in a gravitational field of very large scale compared to the size of the Moon) rather than
 a black hole.
 Recall first that for a test particle, the geodesic equation is equivalent to the statement that the energy-momentum of the particle is covariantly 
 conserved.   If we consider not an infinitesimal test particle
 but a body like the Moon, its energy-momentum tensor $T_{\mu\nu}$ appears in the Einstein equations:
 \be\label{refo}R_{\mu\nu}-\frac{1}{2}g_{\mu\nu}R=8\pi G T_{\mu\nu}. \ee
 This results in  back-reaction of the Moon on the ambient spacetime geometry.
 Beyond the Einstein equations and the equation of state of the material making up the Moon, there is no need to impose any other equation.  
 The Einstein equations determine the spacetime, including the position of the Moon in it.    Since the Moon is a source for the geometry, there is no way to move the Moon without
 changing the geometry.
   Via the Bianchi identity, the Einstein equations imply
 that the stress tensor of the Moon is conserved, $D^\mu T_{\mu\nu}=0$.   So this need not be postulated separately.   However, in the limit in which the mass of the Moon
vanishes and we ignore its back-reaction on the geometry, we  drop the term $8\pi G T_{\mu\nu}$ from the right hand side of Einstein's equations.   Then Einstein's
 equations  no longer tell us that $D^\mu T_{\mu\nu}=0$ and we do need to impose this separately; that is, in this limit, 
 we need to impose the geodesic equation for the Moon as a separate condition.
 
 The analog here is the following.   As long as $n\not=1$, there is no meaningful condition  on the position of the  locus $\Sigma_{[n]}$ of a conical singularity in $X'_{[n]}$.
 The geometry of $X'_{[n]}$ away from the conical singularity is determined by the Einstein equations.   There is no way to move the singularity without changing the geometry
 and we are not free to change the geometry as it is determined by the Einstein equations.   If one considers the conical singularity to be sourced by a cosmic brane, one would
say that the Einstein equations including this source determine the spacetime geometry and imply that the energy-momentum tensor of the brane is conserved.
  In the limit that $n\to 1$, however, there is no conical singularity, the cosmic brane is not sourcing anything, and one does need to impose the condition that its energy-momentum
  tensor is conserved.   
 Generalizing the geodesic equation for a test particle, the condition of conservation of the stress tensor for a brane in an ambient spacetime is that its worldvolume has extremal area.
 Analogously to the EIH result and its counterpart for the Moon,
 it is shown in \cite{LM} that in the limit $n\to 1$, the Einstein equations for $X'_{[n]}$ go over to the Einstein equations for $X$ together
 with the condition that $\Sigma$ is a surface of extremal area.
 
 We also want to know that $\Sigma$ satisfies the homology constraint: it should be homologous to the conformal boundary of $X$.   This is not entirely clear in general,
 but it is clear in the case of a density matrix that is sufficiently
 close to a thermal one, in the sense that $X$ and $X_{[n]}$ are topologically what they would be in the thermal case.  The initial value
 surface $\S$ is then topologically a product $\S'\times \R$, and $\Sigma$ is topologically $\S'\times q$ (where $q$ is a point in $\R$), which is manifestly homologous to the conformal boundary.
 
 
 We have phrased these arguments for the case of a density matrix that is sufficiently close to being thermal that the topology of $X$ and $X_{[n]}$ is known.   However, much of this
 reasoning applies as long as $X_{[n]}$ is such that the replica symmetry is unbroken and the quotient $X'_{[n]}=X_{[n]}/\Z_n$ is topologically $X$ with a conical singularity at the $\Z_n$ fixed points.
 The codimension 2 fixed points comprise the RT surface.  It is not clear whether in general one should expect that $\Z_n$ has additional fixed points of codimension bigger than 2.
 A scaling argument indicates that they do not contribute to the Einstein-Hilbert action, so maybe such fixed points can occur and are not important.  It is not completely clear
 that in general the codimension 2 fixed point set satisfies the homology constraint of the RT formula, though this is certainly true in the almost thermal case.   
 
 This argument  also has an analog for the one-sided case that provided the original setting for the RT formula.   Here as in section \ref{original}, we consider 
  a $d$-dimensional CFT on a spatial manifold $Y$, with Cauchy hypersurface $\S'$, embedded in $Y$ at $t=0$.   Given a normalized quantum state $\Psi$ 
  of the CFT and a region $\A\subset \S'$ with boundary $\partial\A$, we let $\rho_\A$ be the density matrix for observations in the state $\Psi$ in the region $\A$.   
  We would like to compute the von Neumann
  entropy $S_\vN(\rho_\A)$.   As a first step, we consider the replica trick in the CFT to compute R\'enyi entropies $R_n(\rho_\A)$ for integer $n$.   For this, following the logic
  in section \ref{sample}, we replace $Y$ with $Y_{[n]}$, an $n$-fold cover of $Y$ branched over the codimension two manifold $\partial\A$.  The path integral on $Y_{[n]}$
  (with boundary conditions in the far past and far future appropriate to $n$ copies of $\Psi$) computes $\Tr\,\rho_\A^n$ and thus the $n^{th}$ R\'enyi entropy of $\rho_\A$.   
  On the other hand, we can apply AdS/CFT duality to the CFT formulated on $Y_{[n]}$ and thereby get a gravitational recipe to compute $R_n(\rho_\A)$.  In this recipe,
  we are supposed to sum over bulk manifolds  with conformal boundary $Y_{[n]}$. Among these manifolds, let $X_{[n]}$ have minimum action.
   Then AdS/CFT duality says that in leading order 
  \be\label{tracon} \Tr\,\rho_\A^n=\exp(-I(X_{[n]})).\ee
  (The normalizing factor $\exp(n I(X_{[1]})$ in eqn. (\ref{zillow}) is, according to AdS/CFT duality, equal to $(|\Psi|^2)^{-n}$, so it equals 1 if $\Psi$ is normalized.) 
  Now, as before, we assume that $X_{[n]}$ is invariant under the $\Z_{[n]}$ replica symmetry and we define $X'_{[n]}=X_{[n]}/\Z_n$.   $X'_{[n]}$ will have a conical
  singularity, with cone angle $2\pi/n$, on a codimension two manifold $\Sigma_{[n]}$ whose conformal boundary is $\partial\A$.  The conformal boundary of $\Sigma_{[n]}$ is $\partial \A$
   because 
 the conformal boundary of $X'_{[n]}$ is $Y'_{[n]}=Y_{[n]}/\Z_n$, and $Y'_{[n]}$ has a conical singularity along $\partial\A$.   As in the previous discussion, the formula (\ref{tracon})
 for $\Tr\,\rho_\A^n$ can be analytically continued in $n$ and leads to a simple answer in the limit $n\to 1$.   Following the same logic as before, one finds a formula
 for the von Neumann entropy of $\rho_\A$ in terms of the (renormalized) area of a surface $\Sigma$ that is the limit of $\Sigma_{[n]}$ for $n\to 1$:
 \be\label{zerdo} S_\vN(\rho_\A)=\frac{A(\Sigma)}{4G}. \ee
 The same argument as before shows that $\Sigma$ is a surface of extremal  area.   
 
 In both versions of the argument, in order to complete the derivation of the RT formula, we would like to know that $\Sigma$ has minimal area, not just extremal area.
 This question is vacuous for a density matrix of the full CFT that is sufficiently close to a thermal one, since the Euclidean black hole solution has a unique codimension two surface of
 extremal area (the bifurcation surface), and this extremal surface remains unique after any sufficiently small change in the spacetime. So in such a case an extremal surface  automatically
 has minimum area.   However, in general there can be multiple candidate
 RT surfaces (as we saw in some examples in section \ref{original}), and the extension of the derivation that we have explained to cover this case is subtle and not fully understood in general.  
   Let $X$ be the dominant bulk spacetime associated to the CFT density matrix $\rho$ (in the two-sided case) or to the CFT state $\Psi$ (in the
 one-sided version of the problem).   The candidate RT surfaces are the extremal area surfaces $\Sigma_\mu\subset X$, $\mu=1,\cdots,s$  that satisfy the homology constraint.
 If $\Sigma_\mu $ is any of these surfaces,  we can wrap a cosmic brane on $\Sigma_\mu$, and, after solving for back-reaction,
 we can find, at least for $n$ near 1,  a spacetime $X'_{\mu,n}$ with a conical singularity of cone angle $2\pi/n$ on a surface $\Sigma_{\mu,n}$ (which reduces to $\Sigma_\mu$ as $n\to 1$).   
 Hopefully, $X'_{\mu,n}$  can be continued to integers $n>1$ and
 at such values, hopefully $X'_{\mu,n}$ is a quotient $X_{\mu,n}/\Z_n$, where $X_{\mu,n}$ is a manifold that can contribute to the $n^{th}$ R\'enyi entropy of the relevant
 density matrix.   
 Among the $X_{\mu,n}$, the  one whose action $I(X_{\mu,n})$ is smallest is expected to  dominate  the  computation of the $n^{th}$ R\'enyi entropy.   
 Under these assumptions,
  since the limit of $I(X_{\mu,n})$ for $n\to 1$ is $A(\Sigma_\mu)/4G$,  the candidate RT surface of least area is indeed the one whose area determines the von Neumann entropy.


 In general, not much is known about constructing candidate manifolds $X_{\mu,n}$ for integer $n>1$ associated to candidate RT surfaces $\Sigma_\mu$.
In a few cases, this has been done.  For instance, in the example shown in fig, \ref{TwoIntervals} with two candidate RT surfaces $\Sigma_\mu$, $\mu=1,2$,
manifolds $X_{\mu,2}$ were explicitly described and studied in \cite{Headrick}, and this has been extended to $X_{\mu,n}$ \cite{BDHM}.


This discussion  of candidate RT surfaces
should alert us  to another subtlety in the derivation of the RT formula.   In general, in the limit $G\to 0$, the $n^{th}$ R\'enyi
entropy can have a phase transition as a function of $n$.   This will happen if the choice of $\mu$ that minimizes 
$I(X_{\mu,n})$ jumps as a function of $n$.   Therefore, it is oversimplified to present the derivation in terms of a family of manifolds $X_{[n]}$ that is analytic in $n$
and that dominate the $n^{th}$ R\'enyi entropy for each integer $n$. Rather, one has to think in terms of, roughly, a family of manifolds $X_{[n]}$ that depends analytically on $n$
 and that  minimizes the action, among all such families, if $n$ is sufficiently close to 1.    It was in part to avoid such issues that at the outset, we presented the derivation of the RT formula
  in terms of density
matrices that are sufficiently close to a thermal one.   For that class of density matrices, the extremal surface is unique and the topology of the manifolds $X_{[n]}$ is known,
so many tricky issues do not arise.

Even if we restrict to density matrices that are sufficiently close to a thermal one,
there is still an inconvenient issue.   In the case of a thermal density matrix,
it  is true that for any given $n>1$,
if $\beta$ is small enough, the $n^{th}$ R\'enyi entropy is dominated by a Euclidean black hole with inverse temperature $n\beta$.   
But for any given $\beta$, this is false if $n$ is too large.   Indeed, the Euclidean black hole solution with inverse temperature $n\beta$  does not
exist if  $n$ is too large, because as we saw in section \ref{negative}, there is a maximum value of the inverse temperature  for this solution to exist.
A possible point of view is to vary both $\beta$ and $n$, computing $I(X_{[n]})$ for those values  of $\beta$ and $n$ for which this makes sense
and then analytically continuing to $n=1$ and the desired value of $\beta$.    The last step will not be problematical, since if the Euclidean black
hole exists at inverse temperature $\beta$, it will also exist at inverse temperature $n\beta$ if $n$ is close enough to 1.
 

 
\subsection{Further Developments}\label{pageagain}

We will conclude by indicating, without detailed explanation, a few important further developments involving the RT formula.

A first question involves quantum corrections to the RT formula \cite{BDHM,FLM}.   Let $Y$ be a spacetime on which a holographic CFT is formulated, and suppose that (for some class of states in the
CFT) $X$ is the
manifold that dominates  the dual bulk description of the CFT on $Y$.   For some spatial region $\A\subset Y$, let $\Sigma_\A\subset X$ be the RT surface.   Let $\S$ be a Cauchy hypersurface
that contains both $\Sigma_\A$ and $\A$.  The homology constraint says that $\Sigma_\A$ and $\A$ are together the boundary of a region $\S_\A\subset \S$ (illustrated in an example in
fig. \ref{entanglementwedge}).  
Let $\rho_\A$ be the CFT density matrix for the region $\A$, and let $\rho_{\S_\A}$ be the density matrix of the bulk quantum fields for the region $\S_\A$.
A refinement of the RT formula with the one-loop quantum correction included is
\be\label{polly} S_\vN(\rho_\A)=\frac{A(\Sigma_\A)}{4G}+S_\vN(\rho_{\S_\A}). \ee
Here $S_\vN(\rho_{\S_\A})$ appears where $S_\out$ appeared  in Bekenstein's original definition (\ref{sgen}) of the generalized entropy, so one can think of the right hand side of eqn. (\ref{polly})
as the generalized entropy of the RT surface (while Bekenstein defined the generalized entropy of the black hole horizon, which in general is a time-dependent thermodynamic entropy, not
a von Neumann entropy, even if one interprets $S_\out$ as the von Neumann entropy of the fields outside the black hole).   
The proof of eqn. (\ref{polly}) is roughly as follows.   The derivation of the RT formula was based on interpreting the R\'enyi entropy $R_n(\rho_\A)$ in terms of the partition function $Z(X_n)$
of the bulk theory on a certain manifold $X_n$.  To get the RT formula, we approximated this partition function as the exponential of minus the classical action.  This led to a sort of classical
replica trick calculation that yielded the RT formula.   Suppose instead that we compute  $Z(X_n)$ more precisely, including the one-loop partition function of the bulk quantum fields.
Repeating the derivation of section \ref{just} but including the one-loop correction, we simply run into the replica trick calculation of $S_\vN(\rho_{\S_\A})$, accounting for the second
term on the right hand side of eqn. (\ref{polly}).  


 AdS/CFT duality says that from a knowledge of the quantum state $\Psi$ of the boundary
CFT, one can extract a full knowledge of the bulk quantum state.  But suppose that one has access not to $\Psi$ but only to the density matrix $\rho_\A$ that describes CFT measurements
in the region $\A$ (and therefore also in its domain of dependence $D(\A)$).   What portion of the bulk spacetime is determined by a knowledge of $\rho_\A$?
The quantum-corrected RT formula (\ref{polly}) suggests an answer.   Consider a particle in the bulk spacetime such as a spin $\mathfrak s$  (fig. \ref{entanglementwedge}).   The quantum state of this  particle contributes to $S_\vN(\rho(\S_\A))$, and thereby,
via the formula (\ref{polly}), to $S_\vN(\A)$,  if its worldline passes
through $\S_\A$, and not otherwise.    This suggests that a knowledge of $\rho_\A$ determines the bulk quantum state in the region $\S_\A$ -- or equivalently in its domain of
dependence $D(\S_\A)$ --  and not outside.   The domain of dependence\footnote{The domain of dependence of a subset of an asymptotically Anti de Sitter spacetime was defined
in footnote \ref{dodads}.} of $\S_\A$ is called the {\it entanglement wedge} $\E(\A)$.  The upshot is that a knowledge of the boundary state
in region $\A$ determines the bulk state in the region $\E(\A)$, but not beyond.  Deducing the contents of the bulk region $\E(\A)$ from a knowledge of the density matrix $\rho_\A$ of the boundary 
region $\A$ is called
entanglement wedge reconstruction \cite{CKNR,HHLR,JLMS,DHW}.


   \begin{figure}
 \begin{center}
   \includegraphics[width=3.1in]{Fig28.pdf}
 \end{center}
\caption{\footnotesize
 The shaded region $\S(\A)$ is bounded by $\A$ and its RT surface $\Sigma_{\A/\B}$; the unshaded region is the corresponding $\S(\B)$.   The entanglement wedge $\E(\A)$
is the domain of dependence of $\S(\A)$; similarly, the entanglement wedge $\E(\B)$ is the domain of dependence of $\S(\B)$. The spin $\mathfrak s$ at the center of the disc is contained in 
$\S(\A)$ but not in $\S(\B)$, so it can be measured by a boundary observer with access only to operators in region $\A$, but not by a boundary observer with access only to
operators in region $\B$.
\label{entanglementwedge}}
\end{figure} 



We recall that a candidate RT surface for a given region $\A$ is defined as a surface of extremal area that satisfies certain topological conditions (it has the same boundary as $\A$ and
is homologous to $\A$).   The formula (\ref{polly}) and its
derivation, however, suggest that  instead of classical extremal surfaces that extremize
the area, we should consider {\it quantum extremal surfaces} that extremize the generalized entropy.   Here the generalized entropy of a surface $\Sigma_\A$ is defined
to be the right hand side of eqn. (\ref{polly}).   In this language, one states the quantum--corrected RT formula as follows.   A candidate quantum extremal surface associated to
some region $\A$ of the conformal boundary is a
surface $\Sigma$ that satisfies the appropriate topological conditions and  extremizes the generalized entropy.
An improved formula for $S_\vN(\rho_\A)$ is then proposed to be the generalized entropy of the quantum extremal surface that has the smallest generalized entropy \cite{NEW}.
The heuristic idea behind this is the following.  The derivation in section \ref{just} shows that the $A/4G$ term in the classical RT formula arises from minimizing the action of a certain
solution with replicated boundary conditions.  Instead of minimizing the action, it would be a better approximation to minimize the effective action, including the one-loop quantum correction.
But this has the effect of replacing $A/4G$ with the generalized entropy.  So instead of considering minimal surfaces that minimize $A/4G$, we should consider quantum minimal
surfaces that minimize the generalized entropy.   

At first sight, one might expect that to the extent that semiclassical reasoning is valid, the $S_\out$ term in the generalized entropy, which is of order $G^0$, would be negligible compared
to the area term, which is of order $G^{-1}$.   If so, it would not matter (except near an entanglement phase transition at which two candidate RT surfaces exchange dominance)
whether we minimize the area or the generalized entropy.   However, that is not the thole story.
It is possible for the correction term $S_\vN(\rho_{\S_\A})$ in the generalized entropy formula eqn. (\ref{polly}) to be large,
for example in the case of a black hole that has been emitting Hawking radiation for a long time.   Then the difference between classical and quantum versions of the RT formula can be
important.

Once one identifies the entropy of a boundary region $\A$ as the generalized entropy of a quantum extremal surface of minimum generalized entropy,
the possibility arises that a phase transition will occur in the entropy of a region if two quantum extremal surfaces exchange dominance.  In our discussion of the Page
curve, we encountered a phenomenon reminiscent of a phase transition: the entropy of an evaporating black hole is claimed to vary as a function of time in a way that
becomes nonanalytic at the Page time as $G\to 0$
 (see fig. \ref{pagecurve}).   This has been interpreted as resulting from a phase transition in the quantum extremal  surface \cite{P,AEMM}.  Roughly
speaking, prior to the Page time, the entropy of an evaporating black hole is described in terms of an empty quantum extremal surface, and after the Page time it
is described in terms of a quantum extremal surface located near the black hole horizon.   This is perhaps the most significant recent result about black hole thermodynamics, but  explaining it here would take us too far afield.   See \cite{malda,malda2} for
expositions.


Finally, we will briefly discuss the implications of entanglement wedge reconstruction for the nature of the holographic map from bulk degrees of freedom to boundary degrees of freedom.
As a motivating example, we return to the case of  $\AdS_3$ with an initial value surface $\S$ that is a hyperbolic disc.    Consider a state that is fairly close to the $\AdS_3$ ground state, but with a spin $1/2$ particle $\mathfrak s$ in the center of $\S$, and  possibly some other particles distributed throughout  $\S$. 
Let $\O$ be the operator that measures the spin of particle $\mathfrak s$ in some chosen direction.   This operator is not defined on all states of the theory -- the particle $\mathfrak s$
may be absent, or the metric or topology of $\S$ may be so different from what is assumed in fig. \ref{RTpic2} that $\S$  may have no well-defined ``center.''  But on a suitable subspace $\H_0$ of bulk states, the operator $\O$ is meaningful, at least semiclassically
(that is, for small $G$, or equivalently for  large $N$ in the boundary CFT).
 AdS/CFT duality says that the CFT Hilbert space $\H_\CFT$ has a subspace $\H_{0,\CFT}$ that describes the bulk states $\H_0$, and there is a CFT operator $\O_\CFT$
such that a CFT measurement of $\O_\CFT$ is equivalent to a bulk measurement of $\O$.   (It does not matter how we define $\O_\CFT$ on states orthogonal to $\H_{0,\CFT}$;
we can simply define it to annihilate those states.)   Thus, conditional on knowing that the system is in the subspace $\H_0$ in which the question makes sense, an observer with
access to the CFT on the conformal boundary of spacetime can measure the bulk spin $\mathfrak s$ by measuring the operator $\O_\CFT$.

But what about an observer who has access to only part of the conformal boundary of spacetime?   For example, in fig. \ref{entanglementwedge}, consider an observer who has access only
to operators that can be defined in  region $\A$ (or equivalently in the domain of dependence $D(\A)$). 
Entanglement wedge reconstruction asserts that such an observer can measure the spin of particle $\mathfrak s$ if and only if it passes through the corresponding bulk region $\S(\A)$ or
equivalently
its domain of dependence $\E(\A)$.     From the figure, we see that, with $\A$ comprising more than half of the boundary of the disc and $\B$ comprising
less than half, the center of the disc is contained in $\S(\A)$ and not in $\S(\B)$.   So in this particular example, the prediction is that an observer with access only to region $\A$
of the conformal boundary can measure the spin of particle $\mathfrak s$, and an observer with access only to region $\B$ cannot.   Obviously, a rotation of the diagram  would
change nothing essential.   The general statement, for a single interval, is that the CFT restricted to an interval $I$
encodes the information needed to measure spin $\mathfrak s$ if and only if $I$ comprises more than half of the boundary of the disc.

    \begin{figure}
 \begin{center}
   \includegraphics[width=3.61in]{Fig27.pdf}
 \end{center}
\caption{\footnotesize The boundary  of the Cauchy hypersurface $\S$ is divided in three equal parts $\A$, $\B$, $\CC$, disjoint except for endpoints (or with very small overlaps).  The
entanglement wedges of $\A$, $\B$, and $\CC$ are bounded respectively by the geodesics labeled $1,2,$ and $3$.  The resulting entanglement wedges do not
contain the center of the disc and a CFT  observer with access to only one of $\A$, $\B$, or $\CC$ cannot measure the spin $\mathfrak s$ that is located  there.   
However, the entanglement wedges of the joint regions $\A\B$, $\B\CC$, and $\CC\A$ are bounded respectively by the geodesics $3$, $1$, and $2$.  Each of these
entanglement wedges contain the center of the disc, so an observer with access to any  two of the three regions can measure the spin in question.\label{TripleDivision}}
\end{figure} 

This has fascinating implications for the way bulk information is encoded in the AdS/CFT correspondence \cite{ADH,PYHP}.  To illustrate why, consider a simple
case in which the boundary of the disc $\S$ is divided as the union of three intervals $\A,$ $\B$, and $\CC$ of equal size, disjoint except for their boundaries (fig. \ref{TripleDivision}).
Any one of the regions has an entanglement wedge that does not contain the center of the disc, so an observer with access to only one of the three regions cannot measure the
spin of particle $\mathfrak s$.   However, the entanglement wedge of the union of any two of the three regions does contain the center of the disc.   This tells us that bulk information
is stored in the boundary in a way that is {\it distributed} (because two regions together contain information that either region separately would not) and {\it redundant} (losing access
to any one of the three regions does not cause the information to become inaccessible as it is fully encoded in the other two regions).

Classically, such distributed, redundant encoding can be achieved as follows.   Suppose for example that one wishes to store in $\partial \S$ a knowledge of the value of a classical 
$\Z_2$-valued spin $s$.
One way to do this is to pick three elements $a,b,c\in\Z_2$ that are  random except for a condition $a+b+c=s$ mod 2.   (For example, one can pick $a$ and $b$ at random and
pick $c$ so that $a+b+c=s$ mod 2.)   Then one can, say,  store the values of  $a$ and $b$ in region $\A$, the values of $b$ and $c$ in region $\B$, and the values of $c$ and $a$ in
region $\CC$.   Clearly, any one of regions $\A$, $\B$, and $\CC$ does not contain any information about the value of $s$, but any two regions taken together do contain this
information.

Encoding the quantum spin $\mathfrak s$ in the boundary CFT is a more subtle problem than encoding a classical spin $s$.   The reason is that the operators that can be used
to measure $\mathfrak s$ in the bulk do not commute with each other, and the encoding in the boundary CFT must be made in such a way that {\it any} bulk measurement 
is equivalent to some boundary measurement.  This is loosely described by saying that what must be encoded is quantum information, not just classical information.
Distributed, redundant encoding of quantum information is possible  \cite{Shor}, though this is much more subtle than in the classical case.   
In fact, distributed, redundant encoding of information
 would be essential to the functioning
of a hypothetical large scale quantum computer.   The basic reason for this is that any computer, classical or quantum, makes errors, since the components from which it is built are
not perfect.  To do any large scale computation reliably therefore
requires a method to correct errors.     Quantum error correction depends on distributed, redundant encoding of a quantum state.   See for example \cite{PYHP} for a basic
introduction.






 
\section{What is a White Hole?}\label{whitehole}


    \begin{figure}
 \begin{center}
   \includegraphics[width=5.9in]{D.pdf}
 \end{center}
\caption{\footnotesize  In (a), a star collapses to form a black hole.  The diagonal black line labeled $H$ is the future horizon of an outside observer.  The wiggly line at the top
represents the black hole singularity. $\i^-$ and $\i^+$ are past and future timelike  infinity for an observer outside the horizon.
Sketched in (b) is the time-reversed spacetime: a white hole spontaneously emits a star.  The diagonal black line labeled $H$ is the past horizon of an outside observer
-- bounding the region that the observer cannot enter or influence. $\i^-$ and $\i^+$ are past and future timelike infinity for an observer outside the horizon.  The diagonal 
line $\gamma$ is the worldline of an infalling massless particle that was injected from a great distance far in the past.   Initially, its energy was of of order the Hawking temperature;
by the time it collides with the star that is emerging from the white hole, its energy is exponentially large.  This exponential blueshift is the time-reversal  of the exponential
redshift on which  Hawking's derivation of black hole evaporation is based.   \label{blackandwhite}}
\end{figure} 

A white hole is the time-reversal of a black hole.    A black hole has a future horizon with the property that from outside the future horizon one cannot see what is behind it.
A white hole has a past horizon with the property that from outside the past horizon one cannot influence what is behind it.   Anything can fall into a black hole, and conversely,
anything can emerge spontaneously from a white hole.    Fig. \ref{blackandwhite}(a) is a Penrose diagram describing the collapse of a star to form a black hole.  In the time-reversed Penrose diagram
of fig.  \ref{blackandwhite}(b), a white hole spontaneously emits a star.  In fact, one might prefer to describe fig. \ref{blackandwhite}(b) by saying that the white hole spontaneously converts
into a star since on any spacelike surface that is sufficiently far in the future, an ordinary star is all that there is.   

A white hole singularity is certainly an example of a naked singularity that can be seen by an observer outside the white hole.   
Penrose's cosmic censorship conjecture states roughly  
that in Einstein's theory a naked singularity never forms to the future of a Cauchy hypersurface.
  Even if this conjecture is true, it has no bearing on the spacetime of fig. \ref{blackandwhite}(b), in which the naked singularity is  to the past of any Cauchy hypersurface.   Just like the black hole spacetime, we can consider the white hole spacetime to be the result of evolving Einstein's equations forwards and backwards in time, starting from
a smooth, complete Cauchy hypersurface.    It is a perfectly valid solution of Einstein's equations.

What does black hole thermodynamics say about a white hole?   The collapse of a star to form a black hole is a highly irreversible phenomenon in which the
entropy sharply increases.   So its time-reversal  is a phenomenon that strongly violates the Second Law of Thermodynamics, with a sharp reduction in the thermodynamic entropy
when the white hole converts into a star.

As we discussed in the introduction, in ordinary physics, processes that involve a macroscopic violation of the Second Law can happen at least in theory, but they are prohibitively unlikely
(and  not observed in practice) because they require extreme fine-tuning of the initial conditions.   An ice cube in a cup of hot tea will melt, so applying time-reversal symmetry,
one can envisage initial conditions for the cup of hot tea such that an ice cube will spontaneously form, say near time $t=0$.  But with slightly different initial conditions, this will not happen at all.   Starting with special initial conditions that
will lead to a violation of the Second Law, how big  must a perturbation be to produce initial conditions in which the Second Law will not be violated?  An important part of the answer
to this question is that the farther in the past the perturbation acts, the smaller it can be.    That is because only a very tiny fraction of the phase space volume -- or in quantum mechanical
terms, only a very small fraction of possible quantum states -- correspond to initial conditions that will lead to a macroscopic violation of the Second Law near $t=0$.
The presumably highly non-integrable dynamics of a vast number of molecules
making up a cup of heat tea will scramble the special initial conditions that lead to violation of the second law with far more numerous 
generic ones that do not.   In a generic non-integrable many-body system,
there is some ``scrambling time'' $t_\sc$ that suffices to mix the phase space so thoroughly that 
 a generic perturbation of just one or a few molecules at or prior to time $-t_\sc$ would be expected to prevent violation of the Second Law near $t=0$.
 
 
Black hole thermodynamics  suggests that a similar statement will be true for a white hole spacetime, since such a spacetime represents a violation of the Second Law.
A very small perturbation, acting sufficiently far in the past, should have a drastic effect
on the white hole spacetime and in particular it should be possible for a small perturbation sufficiently far in the past to prevent the evolution of this spacetime from violating
the Second Law.  

This reasoning alone does not tell us how far in the past a perturbation should act in order to radically affect the black hole spacetime.   However, known results about
black holes give a clue.   Black holes
are believed to be the fastest scramblers allowed by quantum mechanics \cite{SuSe}, with a scrambling time of order
\be\label{wono} t_\sc = \frac{1}{T_\sH}\log S \ee
where $S\sim GM^2$ is the entropy.
This observation is also related to the chaotic nature of black hole dynamics, which was found in  \cite{SS},  partly presaged in  earlier ideas \cite{DT}.
(In general, among systems of a given temperature and entropy, a black hole has the fastest possible  growth of chaos \cite{StMC}.)   Converting from black holes
to white holes, 
it is natural to guess that $t_\sc$ is also the answer to the question, ``How far in the past should a perturbation be made in order to radically affect the white hole spacetime?''

It is not hard to see why that is the case, by adapting the arguments that have been used for Hawking radiation and for chaos.\footnote{Essentially  the following argument
was first presented by Eardley \cite{Eardley}.}
In the derivation of Hawking radiation in section \ref{bhevaporation}, we observed the following.   Suppose that an outgoing massless quantum with an energy of
order the Hawking temperature $T_\sH$ is observed by a distant observer at a late retarded time $t_\ret$.  We can trace that particle back to an outgoing particle just outside the horizon
at an early time with a huge energy of order $T_\sH e^{t_\ret/4GM}$ (times a factor that depends on how far away is the distant observer in question, and how early is the ``early time''
that we consider, but not on $t_\ret$).    Thus by waiting for a while, the observer can see particles of modest energy coming out that at an early time were near the horizon
with an exponentially large energy.

The time-reversal of the retarded time $t_\ret=t-r$ is $-t-r$, which is the negative of the advanced time $t_\adv=t+r$.   By time-reversing the process described in the last paragraph, we learn
 the following.   Suppose that far in the past, at advanced time $t_\adv = - \tau$, an observer at a great distance from the white hole sends a massless particle with energy of order $T_\sH$  
inwards towards the white hole, as depicted in fig \ref{blackandwhite}(b).  With a probability of order one, this particle might be reflected back by the potential barrier discussed in section \ref{graybody}, but with a probability that
is also of order one, it will continue in to the origin and eventually encounter the material that is emerging from the white hole.   If so, by the time the incident particle reaches the star
that is emerging from the white hole, it will have an energy of order $T_\sH e^{\tau/4GM}$ (times a factor that depends on how far away is the distant observer in question, but not
on $\tau$).  With $\tau$ of order $t_\sc$, this will exceed the ADM mass of the white hole spacetime.   What happens next is hard to say, as our knowledge of physics
does not suffice to describe the collision of
 such an ultrarelativistic particle
 with the star that is emerging from the white hole.    But presumably whatever happens
will represent a substantial perturbation of the white hole spacetime.  The production of a black hole seems likely, especially if several such particles are incident on the white hole
from different directions.  The black hole will have a large entropy, so its formation will ensure that the Second Law is not violated.


So far, we have considered the white hole spacetime as a purely classical background.   Quantum mechanically,
we have to take the Hawking radiation into account, and fine-tuning of the white hole spacetime is even more glaring.
  Quantum mechanically, in fig. \ref{blackandwhite}(a), there is in the far future outgoing Hawking radiation, with a thermal spectrum modulated by gray body factors.
   The time-reversed state in fig. \ref{blackandwhite}(b) has incoming Hawking radiation in the far past with the same thermal spectrum  modulated by 
gray body factors.  
The incoming radiation is entangled with modes behind or near the past horizon of the white hole
in just such a way as to build up the quantum correlations
 that make a quantum state that is smooth along the horizon.    
This imploding shell of Hawking radiation converging on the white hole with just the right spectrum to make that work
would look highly fine-tuned to a distant observer.   And if the distant observer disturbs
this fine-tuning by adding or subtracting an additional incoming particle  at a very early time, that will lead to a drastic change in the spacetime evolution such as we already discussed.

So as suggested by  black hole thermodynamics, the white hole spacetime is fine-tuned and unstable to a perturbation acting far enough in the past.


\vskip1cm
 \noindent {\it {Acknowledgements}}   
 I thank Z. Komargodsky, J. Maldacena, and D. Stanford for discussions, and   A. Herdershee, T. Jacobson,   B. Zhao, and especially R. Wald  for comments on the manuscript.
  Research supported in part by NSF Grant PHY-2207584.  No data were generated in the course of this work.
 \bibliographystyle{unsrt}
\begin{thebibliography}{99}

\bibitem{bekenstein}J. D. Bekenstein, ``Black Holes and Entropy,'' Phys. Rev. {\bf D7} (1973) 2333-2346.

\bibitem{hawking}S. W. Hawking, ``Particle Creation By Black Holes,''
Commun. Math. Phys. {\bf 43} (1975) 199-220.

\bibitem{Christodoulou}
D. Christodoulou, ``Reversible and Irreversible Transformations in Black-Hole Physics,'' Phys. Rev. Lett. {\bf 25} (1970) 1596.

\bibitem{BCH}
J. M. Bardeen,   B. Carter, and S. W. Hawking, ``The Four Laws of Black Hole Mechanics,'' 
Commun. Math. Phys. {\bf 31} (1973) 161-70.

\bibitem{wald}R. M. Wald, {\it General Relativity} (University of Chicago Press, 1984).

\bibitem{HI}
S. W. Hawking and W. Israel, eds., {\it General Relativity: an Einstein Centenary Survey} (Cambridge University Press, 1979).



\bibitem{malda} A. Almheiri, T. Hartman, J. Maldacena, E. Shaghoulian,
and A. Tajdini, ``The Entropy of Hawking Radiation,'' Rev. Mod. Phys. {\bf 93} (2021) 35002, arXiv:2006.06872.

\bibitem{malda2}A. Almheiri, T. Hartman, J. Maldacena, E. Shaghoulian,
and A. Tajdini, ``Replica Wormholes and The Entropy of Hawking Radiation,''   JHEP {\bf 05} (2020) 013, arXiv:1911.12333 

\bibitem{Witten}
E. Witten, ``Light Rays, Singularities, and All That,'' Rev. Mod. Phys. {\bf 92} (2020) 045004, arXiv:1901.03928.

\bibitem{AreaTheorem}S. W. Hawking, ``Black Holes In General Relativity,'' Commun. Math. Phys. {\bf 25} (1972) 152-66.

\bibitem{StromingerVafa}
A. Strominger and C. Vafa, ``Microscopic Origin of the Bekenstein-Hawking Entropy,'' 
Phys. Lett. {\bf B379} (1996), 99-104, hep-th/9601029.

\bibitem{nohair}
W. Israel, ``Event Horizons in Static Vacuum Spacetimes,'' Phys. Rev. {\bf 164} (1967) 1776-9.

\bibitem{nohair2}
B. Carter, ``Axisymmetric Black Hole Has Only Two  Degrees of Freedom,''
Phys. Rev. Lett. {\bf 26} (1971) 331-333..

\bibitem{IW}V. Iyer and R. Wald, ``Some Properties of the Noether Charge and a Proposal for Dynamical Black Hole
Entropy,'' Phys. Rev. {\bf D50}  (1994) 846-64.

\bibitem{Page}D. Page, ``Particle Emission From a Black Hole: Massless Particles From an
Uncharged, Nonrotating Hole,'' Phys. Rev. {\bf D13} (1976) 198-206.

\bibitem{FH}
K. Fredenhagen and R. Haag, ``On The Derivation of the Hawking
Radiation Associated With the Black Hole,''
Commun. Math. Phys. {\bf 127} (1990) 273.

\bibitem{ItFromBit}
J. A. Wheeler, ``Information, Physics, Quantum: The Search For Links,'' in S. Kobayashi, ed., {\it 3rd International Symposium on Foundations of Quantum Mechanics in Light} (Physical
Society of Japan, 1990), available at \url{https://philpapers.org/archive/WHEIPQ.pdf}.

\bibitem{Malda}
J. Maldacena, ``Comments on Magnetically Charged Black Holes,'' JHEP {\bf 04} (2021) 079, arXiv:2004.06084.

\bibitem{Equil1}  G. W. Gibbons and M. J. Perry, ``Black Holes in Thermal Equilibrium,'' 
Phys. Rev. Lett. {\bf 36} (1976) 965-7.

\bibitem{Equil2}G. W. Gibbons and M. J. Perry, ``Black Holes and Thermal Green Functions,''
Proc. R. Sol. Lond. {\bf A358} (1978) 467-94.

\bibitem{U} W. G. Unruh, ``Notes on Black-Hole Evaporation,'' Phys. Rev. {\bf D14} (1976) 870-92.


\bibitem{GPY}
D. J. Gross, M. J. Perry, and L. Yaffe, ``Instability of Flat Space at Finite Temperature,''
Phys. Rev. {\bf D25} (1982) 330-55.

\bibitem{HawkingPage}S. W. Hawking and D. Page, ``Thermodynamics of Black Holes in Anti de Sitter Space,'' Commun. Math. Phys. {\bf 87}  (1983) 577.

\bibitem{UW} W. G. Unruh and N. Weiss, ``Acceleration Radiation in Interacting Field Theories,'' Phys. Rev. {\bf D29} (1984) 1656-62.


\bibitem{BW}J. Bisognano and E. Wichmann, ``On The Duality Condition For Quantum Fields,'' J. Math.
Phys. 17 (1976) 303-21.

\bibitem{Sewell}G. L. Sewell,
``Quantum Fields On Manifolds: PCT and Gravitationally Induced Thermal
States,'' Ann. Phys. {\bf  141} (1982) 201-24.

\bibitem{Notes}E. Witten, ``Notes on Some Entanglement Properties of Quantum Field Theory,'' Rev. Mod. Phys. {\bf 90} (2018) 045003,
arXiv:1803.04993.

\bibitem{GH}G. W. Gibbons and S. W. Hawking, ``Action Integrals and Partition Functions in Quantum Gravity,''
Phys. Rev. {\bf D15} (1977) 2752-6.

\bibitem{HH}
S. W. Hawking and J. Hartle, ``Path Integral Derivation of Black Hole Radiance,'' Phys. Rev. {\bf D13} (1976) 2188-2203.

\bibitem{Y}
J. W. York, ``Role of Conformal Three-Geometry in the Dynamics of Gravitation,'' Phys. Rev, Lett. {\bf 28} (1972) 1082.

\bibitem{CT}
S. Carlip and C. Teitelboim, ``The Off-Shell Black Hole,'' arXiv:gr-qc/9312002.

\bibitem{hp}
S. W. Hawking and D. N. Page, ``Thermodynamics of Black Holes in Anti-de Sitter Space,''
Commun. Math. Phys. {\bf 87} (1983) 577-88. 

\bibitem{MaldaDual}J. M. Maldacena, ``The Large $N$ Limit
Of Superconformal Field Theories and Supergravity,''
Adv. Theor. Math. Phys. {\bf 2} (1998) 231-52.

\bibitem{GKP}S. S. Gubser, I. R. Klebanov, and A. M. Polyakov,
``Gauge Theory Correlators From Noncritical String Theory,'' Phys. Lett. {\bf B428} (1998) 105-14.

\bibitem{EW}E. Witten, ``Anti-de Sitter Space and Holography,'' Adv. Theor. Math. Phys.
{\bf 2} (1998) 253-91.

\bibitem{BF} P. Breitenlohner and D. Z. Freedman, ``Stability in Gauged Extended Supergravity,''
Annals Phys. {\bf 144} (1982) 249.

\bibitem{FG}C. Fefferman and C. R. Graham, ``Conformal Invariants,'' in {\it Elie Cartan et les Math\'ematiques d'Aujourdhui}
(Asterisque, 1985) 95.

\bibitem{VH}
V. Hubeny, ``The AdS/CFT Correspondence,'' Class. Quant. Grav. {\bf 32} (2015) 12, arXiv:1501.00007.

\bibitem{MaldaNew}
J. M. Maldacena, ``The AdS/CFT Correspondence,'' available at \url{https://link.springer.com/referenceworkentry/10.1007/978-981-19-3079-9_65-1#Sec14}.

\bibitem{SW}
N. Seiberg and E. Witten, ``The D1/D5 System and Singular CFT,''
JHEP {\bf 04} (1999) 017, hep-th/9903224.

\bibitem{GH2}
G. W. Gibbons and S. W. Hawking, ``Cosmological Event Horizons, Thermodynamics,
and Particle Creation,'' Phys. Rev. {\bf D15} (1977) 2738-2751.

\bibitem{FHN}R. Figari, R. Hoegh-Krohn, and C. R. Nappi, ``Interacting
Relativistic Boson Fields in the De Sitter Universe With Two Space-Time
Dimensions,''
Commun. Math. Phys. {\bf 44} (1975) 265-278.

\bibitem{TJ}
T. Jacobson, ``A Note On Hartle-Hawking Vacua,''   Phys. Rev. {\bf D50} (1994) R6031-R6032, gr-qc/9407022.

\bibitem{KW} B. S. Kay and R. M. Wald, ``Theorems on the Uniqueness and Thermal
Properties of Stationary, Nonsingular, Quasifree States On Space-Times with a Bifurcate Horizon,'''
Phys. Rept. {\bf 207}  (1991) 49-136. 


\bibitem{CT2} N. A. Chernikov and E. A. Tagirov, ``Quantum theory of scalar field in de Sitter space-time,''
Annales de l'Institut Henri Poincar\'{e} A IX (1968) 109.

\bibitem{SS2}C. Schomblond and P. Spindel,  ``Conditions d'unicit\'{e}
pour le propagateur $\Delta_1(x;y)$  du champ scalaire dans l'univers de de Sitter,''  Annales de l'Institut Henri Poincar\'{e} A XXV (1976) 67.


\bibitem{BD}T. S. Bunch and P. Davies,
``Quantum Field Theory in de Sitter Space:
Renormalization by Point Splitting,'' Proc. Roy. Soc. London {\bf A360} (1978) 117-34.

\bibitem{Mo}
E. Mottola, ``Particle Creation in de Sitter Space,'' Phys. Rev. {\bf D31} (1985) 754.

\bibitem{Al}
B. Allen, ``Vacuum States in de Sitter Space,'' Phys. Rev. {\bf D32} (1985) 3136.



\bibitem{bc}
R. L. Bishop and R. L. Crittenden, {\it Geometry of Manifolds} (Academic Press, 1964). 


\bibitem{I}
W. Israel, ``Thermo-field Dynamics of Black Holes,'' Phys. Lett. {\bf 57} (1976) 107-10.

\bibitem{EinsteinRosen}
A. Einstein and N. Rosen, ``The Particle Problem in The General Theory of Relativity,'' Phys. Rev. {\bf 48} (1935) 73-7.

\bibitem{topocensor} J. L. Friedman, K. Schleich, and D. M. Witt, ``Topological Censorship,'' Phys. Rev. Lett. {\bf 71} (1993)
1486-9, arXiv:gr-qc/9305017.


\bibitem{topotwo} G. J. Galloway, K. Schleich, D. Witt, and E. Woolgar, ``The AdS/CFT Correspondence And Topological Censorship,''  Phys. Lett. {\bf B505} (2001) 255-62, hep-th/9912119.

\bibitem{MaldaSuss} J. Maldacena and L. Susskind, ``Cool Horizons for Entangled Black Holes,'' Fortschritte fur Physik {\bf 61} (2013) 781-811.

\bibitem{ETH}J. M. Deutsch, ``Quantum Statistical Mechanics in a Closed System,'' Phys. Rev {\bf A43} (1991) 2046-9.

\bibitem{ETH2}
M. Srednicki, ``Chaos and Quantum Thermalization,'' Phys. Rev. {\bf E50} (1994) 888-901.

\bibitem{Preskill}J, Preskill, ``Chapter 10: Quantum Shannon Theory,''
available at \url{http://theory.caltech.edu/~preskill/ph219/chap10_6A_2022.pdf}.

\bibitem{WittenQI}E. Witten, ``A Mini-Introduction to Information Theory,'' La Rivista del Nuovo Cimento {\bf 43} (2020) 187,
arXiv:1805.11965.

\bibitem{LR}
 E. H. Lieb and M. B. Ruskai, ``Proof Of The Strong Subadditivity Of Quantum Mechanical Entropy,''  J. Math. Phys. {\bf 14} (1973) 1938.

 \bibitem{PN} 
 M. A. Nielsen and D. Petz, ``A Simple Proof of the Strong Subadditivity Inequality,'' Quantum
Information and Computation {\bf 5} (2005) 507-13, arXiv:quant-ph/0408130.

\bibitem{Wall}A. C. Wall, ``A Proof of the Generalized Second Law for Rapidly Changing
Fields and Arbitrary Horizon Slices,'' Phys. Rev. {\bf D85} (2012) 104049, arXiv:1105.3445.

\bibitem{PageCurvePaper}D. Page, ``Information in Black Hole Radiation,''  Phys. Rev. Lett. {\bf 71} (1993) 3743-46,
hep-th/9306083.

\bibitem{P}G. Penington, ``Entanglement Wedge Reconstruction and the Information Paradox,''
JHEP {\bf 09} (2020) 002, arXiv:1905.08255.

\bibitem{AEMM}A. Almheiri,  N. Engelhardt, D. Marolf,  and H. Maxfield, ``The Entropy of Bulk Quantum
Fields and the Entanglement Wedge of an Evaporating Black Hole,'' JHEP {\bf 12} (2019) 063, arXiv:1905.08762.

\bibitem{SorkinA}
R.D. Sorkin, ``On The Entropy of a Vacuum Outside a Horizon,'' in B. Bertotti, F. de Fellice, and A. Pascolini, eds., {\it General Relativity and Gravitation, proceedings of
the GR10 Conference, Padova 1983}  (Consiglio Nazionale della Ricerche, Roma, 1983) Vol.
2, available at arXiv:1402.3589.

\bibitem{SorkinB}
L. Bombelli, R.K. Koul, J. Lee and R.D. Sorkin, ``Quantum Source of Entropy for Black Holes,'' Phys. Rev. {\bf D34}
(1986) 373.

\bibitem{Thooft}
G. 't Hooft, ``On The Quantum Structure Of A Black Hole,'' Nucl. Phys. {\bf B256} (1985) 727.


\bibitem{Srednicki}M. Srednicki, ``Entropy and Area,'' Phys. Rev. Lett. {\bf 71} (1993) 666-9, arXiv:hep-th/9303048.

\bibitem{SU}
L. Susskind and J. Uglum, ``Black Hole Entropy in
Canonical Quantum Gravity and Superstring Theory,'' hep-th/9401070.

\bibitem{Jacobson}
T. Jacobson, ``Black Hole Entropy and Induced Gravity,''
arXiv:gr-qc/9404039.

\bibitem{Sakharov}
A. D. Sakharov, ``Vacuum Quantum Fluctuations In Curved Space And The Theory
Of Gravitation,''  Sov. Phys. Dokl. {\bf 12} (1968) 1040 [Dokl. Akad. Nauk Ser. Fiz. 177
(1968) 70], 
reprinted in Gen. Rel. Grav. {\bf 32} (2000) 365-367.


\bibitem{CW}C. Callan and F. Wilczek, ``On Geometric Entropy,''  Phys. Lett. {\bf B333} (1994) 55-61, arXiv:hep-th/9401072.

\bibitem{HLW}
C. Holzhey, F. Larsen, and F. Wilczek, ``Geometric and Renormalized Entropy in Conformal Field Theory,'' Nucl. Phys. {\bf B424}
(1994) 443-67,
arXiv:hep-th/9403108.

\bibitem{AE}
S. F. Edwards and P. W. Anderson, ``Theory of Spin Glasses,'' J. Phys. {\bf F5} (1975) 965.

\bibitem{CC}
P. Calabrese and J. Cardy, ``Entanglement Entropy and Quantum Field Theory,'' J.Stat.Mech. {\bf 0406} (2004) P06002, arXiv:hep-th/0405152.

 
\bibitem{Boas}
R. P. Boas, Jr., ``Entire Functions'' (Academic Press, New York, 1954).

\bibitem{DFMS}
L. J. Dixon, D. Friedan, E. Martinec, and S. H. Shenker,
``The Conformal Field Theory of Orbifolds,'' Nucl. Phys. {\bf B282} (1987) 13-73.

\bibitem{orbifold}L. J. Dixon, J. A. Harvey, C. Vafa, and E. Witten, ``Strings on Orbifolds,''
Nucl. Phys. {\bf B261} (1985) 678-86.

\bibitem{Bek2}J. D. Bekenstein, ``Universal Upper Bound on the Entropy-to-Energy
Ratio for Bounded Systems,'' Phys. Rev. {\bf D23} (1981) 287-98.

\bibitem{Casini}H. Casini, ``Relative Entropy and the Bekenstein Bound,'' Class. Quant. Grav. {\bf 25} (2008) 205021,
arXiv:0804.2182.

\bibitem{MMR}
D. Marolf, D. Minic, and S. F. Ross, ``Notes on Spacetime Thermodynamics
and the Oberver-dependence of Entropy,'' Phys. Rev. {\bf D69} (2004) 064006, arXiv:hep-th/03120022.

\bibitem{Araki}H. Araki, ``Relative Entropy of States of Von Neumann Algebras,'' Publ. RIMS, Kyoto Univ. {\bf 11} (1976) 809-33.

\bibitem{KLS}J. Kudler-Flam, S. Leutheusser, A. A. Rahman,
G. Satishchandran, and A. J. Speranza, ``A Covariant Regulator
for Entanglement Entropy: Proofs of the Bekenstein Bound and
QNEC,'' arXiv:2312.07646.

\bibitem{RT}S. Ryu and T. Takayanagi, ``Holographic Derivation of Entanglement Entropy from AdS/CFT,''
Phys. Rev. Lett. {\bf 96} (2006) 181602,  arXiv:hep-th/0603001.

\bibitem{HRT}V. E. Hubeny, M. Rangamani and T. Takayanagi, ``A Covariant Holographic Entanglement
Entropy Proposal, JHEP {\bf 07} (2007) 062, arXiv:0705.0016.

\bibitem{LM}
A. Lewkowycz and J. Maldacena, ``Generalized Gravitational Entropy,'' JHEP {\bf 08} (2013) 090,
arXiv:1304.4926.

\bibitem{BDHM} T. Barrella, X. Dong, S. A. Hartnoll and V. L. Martin, ``Holographic Entanglement Beyond
Classical Gravity,''  JHEP {\bf 09} (2013) 109, arXiv:1306.4682.


\bibitem{FLM}  T. Faulkner, A. Lewkowycz and J. Maldacena, ``Quantum Corrections to Holographic
Entanglement Entropy,''  JHEP {\bf 11} (2013) 074, arXiv:1307.2892.

\bibitem{NEW}
N. Engelhardt and A. C. Wall, ``Quantum Extremal Surfaces: Holographic Entanglement Beyond the Classical Regime,''
JHEP {\bf 01} (2015) 073.

\bibitem{SS}
S. H. Shenker and D. Stanford, ``Black Holes and the  Butterfly Effect,'' JHEP {\bf 03} (2014) 067,
arXiv:1306.0622.

\bibitem{SSagain}S. H. Shenker and D. Stanford, ``Multiple Shocks,''
JHEP {\bf 12} (2014) 046, arXiv:1312.3296.



\bibitem{DT}
T. Dray and  G. 't Hooft, ``The Effect of Spherical Shells of Matter on the Schwarzschild Black Hole,''
Commun. Math. Phys. {\bf 99} (1985) 613.


\bibitem{Twice} N. Engelhardt, G. Penington, and A. Shahbazi-Moghaddam, ``Twice Upon A Time: Timelike Separated
Quantum Extremal Surfaces,'' JHEP {\bf 01} (2024) 033, arXiv:2308.16226.


\bibitem{BTZ}M. Ba\~{n}ados, C. Teitelboim, and J.Zanelli, ``The Black Hole In Three Dimensional Spacetime,'''  Phys. Rev. Lett. {\bf 69} (1992) 1849-51,
  arXiv:hep-th/9204099. 


\bibitem{MWW}
D Marolf, S. Wang, and Z. Wang, ``Probing Phase Transitions of Holographic Entanglement Entropy With Fixed Area States,''
arXiv:2006.10089.

\bibitem{TakHead}M. Headrick and T. Takayanagi, ``A Holographic Proof of the Strong Subadditivity of Entanglement Entropy,''
Phys. Rev. {\bf D76} (2007) 106013.

\bibitem{Wall2}A. Wall,  ``Maximin Surfaces, and the Strong Subadditivity of the Covaeriant Holographic
Entanglement Entropy,'' Class. Quant. Grav. {\bf 31} (2014) 225007, arXiv:1211.3494.

\bibitem{KS}M. Henningson and K. Skenderis, ``Weyl Anomaly For Wilson Surfaces,'' JHEP {\bf 9906} (1999) 012, 
arXiv:hep-th/9905163.

\bibitem{GW} R. Graham and E. Witten, ``Conformal Anomaly of Submanifold
Observables in AdS/CFT Correspondence,''
Nucl. Phys. {\bf B546} (1999) 52-64.



\bibitem{Fursaev}
D. V. Fursaev, ``Proof of the Holographic Formula for Entanglement Entropy,'' arXiv:hep-th/0606184.




\bibitem{EIH}A. Einstein, L. Infeld, and B. Hoffman, ``The Gravitational Equations and the Problem of Motion,'' Ann. Math. {\bf 39} (1938) 65-100.



\bibitem{Headrick}
M. Headrick, ``Entanglement R\'enyi Entropies in Holographic Theories,''   Phys. Rev. {\bf D82} (2010) 126010,   arXiv:1006.00473.




\bibitem{CKNR} B.  Czech, J. L Karczmarek, F.  Nogueira, and M. Van Raamsdonk,
``The Gravity Dual of a Density Matrix,''  Class.  Qtm.  Grav., {\bf 29} (2012) 155009.

\bibitem{HHLR}
 M.  Headrick, V. E. Hubeny, A. Lawrence, and M.  Rangamani. ``Causality \& Holographic Entanglement Entropy,''  JHEP {\bf 12} (2014) 162.
 
\bibitem{JLMS}
 D.  L Jafferis, A.  Lewkowycz, J.  Maldacena, and S Josephine Suh, ``Relative Entropy
Equals Bulk Relative Entropy,''  JHEP  {\bf 4} (2016).


\bibitem{DHW} X. Dong, D. Harlow, and A.  C Wall, ``Reconstruction of Bulk Operators Within the
Entanglement Wedge in Gauge-Gravity Duality,''  Phys.  Rev. Lett. {\bf  117} (2016) 021601.










\bibitem{ADH}
A. Almheiri, X. Dong, and D. Harlow, ``Bulk
Locality and Quantum Error Correction in AdS/CFT,''
JHEP {\bf 04}  (2015) 163 , arXiv:1411.7041.

\bibitem{PYHP}
 F.Pastawski, B. Yoshida, D. Harlow, and
J. Preskill, ``Holographic Quantum Error-Correcting
Codes: Toy Models for the Bulk/Boundary Correspondence,'' JHEP {\bf 06} (2015) 149, arXiv:1503.06237.


\bibitem{Shor}
P. W.  Shor, ``Fault-Tolerant Quantum Computation,''  Proceedings of 37th Conference on Foundations of Computer Science,  IEEE Comput. Soc. Press. (1996),  pp. 56-65..



\bibitem{SuSe}
Y. Sekino and L. Susskind, ``Fast Scramblers,'' JHEP {\bf 10} (2008) 065, arXiv:0808.2096.





\bibitem{StMC}J. Maldacena, S. H. Shenker, and D. Stanford, ``A Bound on Chaos,''
JHEP {\bf 08} (2016) 106, arXiv:1503.01409.

\bibitem{Eardley}
D. M. Eardley, ``Death of White Holes in the Early Universe,''  Phys. Rev. Lett. {\bf 33} 442-4.

\end{thebibliography}
\end{document}

     \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig4.pdf}
 \end{center}
\caption{\footnotesize  The lightly shaded region is the $t>0$ portion of a real analytic spacetime of Lorentz signature.   From $t=0$,  we  continue the spacetime
in the direction of imaginary time, truncating it at $t=-\i\epsilon$.   The  Euclidean part of the picture is more darkly shaded.    \label{four}}
\end{figure} 

To answer this question, let $K(x_2,x_1;t)$ be the amplitude for the particle to propagate from $x_1$ to $x_2$ in time $t$.    One would like to compute $K$ from
a path integral formula
\be\label{pinto} K(x_2,x_1;t)=\int_{P(x_2,x_1;t)}  D X(t) \exp(-I), \ee
where $P(x_2,x_1;t)$ is the set of paths that start at $x_1$ at time 0 and  end at  $x_2$ at time $t$, and 
where the action $I$ will be either $I_1$ or $I_2$.   One would like to be able to express the transition amplltude as a sum over intermediate states at an arbitrarily chosen time:
\be\label{logo} K(x_3,x_1; t_1+t_2)=\int \d x_2\, K(x_3,x_2;t_2) K(x_2,x_1; t_1). \ee
For this to be true, we need the following: if $\gamma$ is a path from $x_1$ at time $0$ to $x_2$ at time $t_1$, $\gamma'$ is a path from $x_2$ at time $t_1$ to $x_3$ at time $t_1+t_2$, and $\gamma'\star \gamma$ is the concatenation
of the two paths (execute $\gamma$ followed by $\gamma'$), then we want
\be\label{nogo} I(\gamma'\star \gamma)=I(\gamma')+I(\gamma).  \ee
If this is so, a standard path integral argument will give eqn. (\ref{logo}).
Eqn. (\ref{nogo}) 
 is true if $I=I_1$ but not if $I=I_2$.   The reason is that the path $\gamma'\star\gamma$ has the property that $x(t)$ is continuous but generically $\dot x(t)$ is discontinuous at $t=t_1$.
Such a discontinuity leads to a delta function contribution to $I_2$ at $t=t_2$.  This delta function will contribute on the left hand side of eqn. (\ref{nogo}) but not
on the right hand side.  There is no such delta function in $I_1$ because $I_1$ does not depend on the second derivative $\ddot x$. l   So $I_1$ but not $I_2$ satisfies eqn. (\ref{nogo}).

We can modify $I_2$ by adding a boundary term chosen to restore eqn. (\ref{nogo}):
\be\label{blogo}I_2'=-\frac{1}{2}\int_{t_1}^{t_2} \d t\,x \ddot x+ \left[ x\dot x\right]^{t_2}_{t_1} . \ee
The quickest way to verify that $I'_2$ satisfies eqn. (\ref{nogo}) is to observe that, after integrating by parts, $I_2'=I_1=\frac{1}{2}\int_{t_1}^{t_2}\d t \dot x^2.$   Thus
adding this particular boundary term has compensated for a non-optimal choice of the bulk action.

Going back to gravity, the action $I_\EH$, because it depends on the second derivative of the metric, has the same problem that $I_2$ has for the point particle.  Let us
assume the usual framework in which a quantum state in $3+1$ dimensions is regarded as a functional  of a metric on a three-manifold.   Thus an initial
or final state can be specified by specifying a three-geometry. 
 If we define
gravitational transition amplitudes via a path integral defined using the action $I_\EH$, then it will not be possible to express a transition amplitude from one spatial geometry
to another in terms of a sum over intermediate states, because the analog of eqn. (\ref{nogo}) does not hold.   Where gravity differs from the point particle -- and from most other
theories that are commonly studied -- is that there is no covariant way to integrate by parts to eliminate the second derivatives from $I_\EH$.  One can, however, eliminate the problem
by adding a boundary term, the Gibbons-Hawking-York term $I_\GHY$.  The modified Einstein-Hilbert action $I'_\EH=I_\EH+I_\GHY$, similarly to $I_2'$, does satisfy the analog of
eqn. (\ref{nogo}).

A related way to explain the issue is the following.   Let us go back to the free particle and


We will be brief as the arguments are familiar.
First we decompose $\S$ as the union of a ``right'' part $\S_r$ at $\tE=0$ and a ``left'' part $\S_\ell$ at $\tE=\frac{1}{2}\beta_H$.   Correspondingly, we decompose the Hilbert space 
$\H$ of states on $\S$ as $\H_\ell\otimes \H_r$, where $\H_\ell$ and $\H_r$ describe fields on $\S_\ell$ and on $\S_r$, respectively.   Let  $\sigma_r$ be the density matrix 
that describes measurements on $\S_r$ in the state $\Psi_\HHI$.   As in the case of de Sitter space,
 a path integral on $X$
with a cut along $\S_r$ computes an unnormalized density matrix $\sigma'_r=Z\sigma_r$, where $Z$ is the partition function of $X$.
   Concretely, a path integral on $X$ with boundary values $\phi$ and $\phi'$ below
and above the cut computes $\sigma'_r(\phi,\phi')$.
   The manifold $X$ with this cut can be generated, as usual, 
   by rotating $\S_r$ inside $X$ by an angle $2\pi$.   If we rotate just by an angle $\pi$, we build the  half-space $\W$;  the associated path
integral
is the definition of the state $\Psi'_\HHI$.  Instead of viewing $\Psi'_\HHI$ as a state in $\H_\ell\otimes \H_r$, we can view it as an operator on $\H_r$.   The operator that generates
a $\pi$ rotation of $\S_r$, which is $\Psi'_\HHI$, is the square root of the operator that generates a $2\pi$ rotation, which is $\sigma_r'$.   
So $\Psi'_\HHI$ corresponds to $\sigma'_r{}^{1/2}$, and 
the normalized state
$\Psi_\HHI$ corresponds to $\sigma_r^{1/2}$; in other words, $\Psi_\HHI$ is the thermofield double state of the density matrix $\sigma_r$. 

Far from the black hole, all this has a transparent meaning, since the Euclidean black hole spacetime $X$ reduces to $\R^3\times S^1_{\beta_H}$.   $X$ with a cut along $\S_r$ is
simply $\R^3\times I_{\beta_H}$, where $I_{\beta_H}$ is an interval of length $\beta_H$.  In the usual way, the path integral on $\R^3\times I_{\beta_H}$ computes the operator
$e^{-\beta_H H}$, where $H$ is the Minkowski space Hamiltonian.   The corresponding density matrix $\sigma_r=\frac{1}{Z}e^{-\beta H}$ is a standard thermal density matrix.   
$\W$, which was defined as the region  $0\leq \tE\leq \frac{1}{2}\beta_H$ in $X$, reduces at infinity to $\R^3\times I_{\frac{1}{2}\beta_H}$, where now the width of the interval is $\frac{1}{2}\beta_H$.
The path integral on $\R^3\times I_{\frac{1}{2}\beta_H}$ computes  the state $\Psi'_\HHI$.   Clearly $\Psi'_\HHI$ corresponds to the operator
$\exp(-\frac{1}{2}\beta_H H)$.   The normalized state $\Psi_\HHI$ corresponds to $\frac{1}{\sqrt Z} \exp(-\frac{1}{2}\beta_H)=\sigma_r^{1/2}$.   Thus $\Psi_\HHI$ is the thermofield
double state.
========================================

%least upper bound was changed to greatest lower bound in Appendix C

\documentclass[12pt]{article}
\usepackage{cite}
%\usepackage[pdftex]{hyperref}
\usepackage{amsmath, amsthm, amssymb,slashed,upgreek,url}
%%%
\usepackage{ifpdf}
\ifpdf
  \usepackage[pdftex]{graphicx}
  \usepackage{epstopdf}
\else  
  \usepackage[dvips]{graphicx}
\fi
%%%
\textheight 8.5in \textwidth 7.3in \oddsidemargin -.5in \topmargin
-.35in
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\parskip=\baselineskip
\def\Bbb{\mathbb}
\def\Tr{{\rm Tr}}
\def\16{{\bf 16}}
\def\S{S}
\def\1{{\bf 1}}
\def\2{{\bf 2}}
\def\3{{\bf 3}}
\def\4{{\bf 4}}
\def\c{{\sf c}}
\def\sv{{\sf v}}
\def\sx{{\sf x}}
\def\y{{\sf y}}
\def\I{{\mathcal I}}
\def\K{{\mathcal K}}
\def\\SPT{\sf{\SPT}}
\def\a{{\sf a}}
\def\sv{{\sf v}}
\def\sc{{\sf x}}
\def\D{{\sf Y}}
\def\D{{\sf D}}
\def\DD{{\mathcal D}}
\def\b{{\sf b}}
\def\ds{{\mathrm{ds}}}
%\def\A{{\sf A}}
%\def\B{{\sf B}}
\def\nn{{[n]}}

\def\kk{{[k]}}
\def\veps{\varepsilon}
\def\oone{{[1]}}
\def\ttwo{{[2]}}
\def\dn{{\la n\ra}}
\def\dk{{\la k \ra}}
\def\done{{\la 1\ra}}
\def\dtwo{{\la 2\ra}}
\def\tr{{\mathrm{tr}}}
\def\\SRT{{\sf{\SRT}}}
\def\CC{\mathcal C}
\def\h{\widehat}
\def\bar{\overline}
\def\tilde{\widetilde}
\def\ra{\rangle}
\def\da{\dagger}
\def\bp{\begin{pmatrix}}
\def\ep{\end{pmatrix}}
\def\la{\langle}
\def\R{{\Bbb{R}}}\def\Z{{\Bbb{Z}}}
\def\N{{\mathcal N}}
\def\RR{{\sf R}}
\def\T{{\mathcal T}}
\def\hat{\widehat}
\font\teneurm=eurm10 \font\seveneurm=eurm7 \font\fiveeurm=eurm5
\newfam\eurmfam
\textfont\eurmfam=\teneurm \scriptfont\eurmfam=\seveneurm
\scriptscriptfont\eurmfam=\fiveeurm
\def\eurm#1{{\fam\eurmfam\relax#1}}
\font\teneusm=eusm10 \font\seveneusm=eusm7 \font\fiveeusm=eusm5
\newfam\eusmfam
\textfont\eusmfam=\teneusm \scriptfont\eusmfam=\seveneusm
\scriptscriptfont\eusmfam=\fiveeusm
\def\eusm#1{{\fam\eusmfam\relax#1}}
\font\tencmmib=cmmib10 \skewchar\tencmmib='177
\font\sevencmmib=cmmib7 \skewchar\sevencmmib='177
\font\fivecmmib=cmmib5 \skewchar\fivecmmib='177
\newfam\cmmibfam
\textfont\cmmibfam=\tencmmib \scriptfont\cmmibfam=\sevencmmib
\scriptscriptfont\cmmibfam=\fivecmmib
\def\cmmib#1{{\fam\cmmibfam\relax#1}}
\numberwithin{equation}{section}
\def\neg{\negthinspace}
\def\d{\mathrm d}
\def\u{{\sf u}}

\def\L{{\mathcal L}}
\def\\S{{\Bbb \S}}
\def\Z{{\Bbb Z}}
\def\bar{\overline}
\def\A{{\mathcal A}}
\def\min{{\mathrm{min}}}
\def\bar{\overline}


\begin{document}
\begin{titlepage}
\begin{flushright}
%hep-th/yymm.nnnn
\end{flushright}
\vskip 1.5in
\begin{center}
{\bf\Large{Light Rays, Singularities, and All That}}
\vskip
0.5cm {Edward Witten} \vskip 0.05in {\small{ \textit{School of
Natural Sciences, Institute for Advanced Study}\vskip -.4cm
{\textit{Einstein Drive, Princeton, NJ 08540 USA}}}
}
\end{center}
\vskip 0.5in
\baselineskip 16pt
%
\abstract{This article is an introduction to causal properties of General Relativity.   Topics include the Raychaudhuri equation,
singularity theorems of Penrose and Hawking,  the black hole area theorem, 
topological censorship, and the Gao-Wald theorem.  The article is based on lectures
at the 2018  summer program Prospects in Theoretical Physics at the Institute for Advanced Study, and also at the 2020 New Zealand Mathematical Research Institute summer
school in Nelson, New Zealand.}
\date{May, 2018}
\end{titlepage}
\def\Hom{\mathrm{Hom}}
\def\H{{\mathcal H}}
\def\d{{\mathrm d}}
\def\t{\widetilde}
\def\U{{\mathcal U}}
\def\UU{{\mathrm U}}
\def\V{{\mathcal V}}
\def\st{{\sf t}}
\def\O{{\mathcal O}}
\def\i{{\mathrm i}}
\def\A{{\mathcal A}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}


\tableofcontents


  
\def\aa{{\sf a}}
\def\bb{{\sf b}}
\def\a{{\bf a}}
\def\x{{\bf x}}
\def\y{{\bf y}}
\def\z{{\bf z}}
 \def\sym{{\mathrm{sym}}}
 \def\zotimes{{\otimes N}}
 \def\cl{{\mathrm{cl}}}
\def\h{\widehat}
\def\t{\widetilde}
\def\tt{\sf t}
%\def\\S\S{{\mathcal \S}}
\def\tr{{\mathrm{tr}}}
\def\d{{\mathrm{d}}}
\def\H{{\mathcal H}}
\def\O{{\mathcal O}}
\def\Tr{{\mathrm{Tr}}}
\def\diag{{\mathrm{diag}}}
\def\la{\langle}
\def\ra{\rangle}

\section{Introduction}\label{intro}

Here are some questions about the global properties of classical General Relativity:
\begin{enumerate}
\item Under what conditions can one predict the formation of a black hole?
\item Why can the area of a classical black hole horizon only increase?
\item Why, classically, is it not possible to travel through a ``wormhole'' in spacetime?
\end{enumerate}

These are questions of Riemannian geometry in Lorentz signature.
They involve the causal structure of spacetime: where can one get, from a given starting point, along a worldline
that is everywhere within the local light cone?

 Everyday life gives us some intuition about Riemannian
geometry in the ordinary case of Euclidean signature.   We live in  three-dimensional Euclidean space, to an excellent
approximation, and we are quite familiar 
 with two-dimensional curved surfaces.   A two-dimensional curved surface is a reasonable
prototype for Riemannian geometry in Euclidean signature, though Riemannian geometry certainly has important features that only
appear in higher dimension.

By contrast, everyday life  does not fully prepare us for   Lorentz signature geometry.   What is fundamentally different about Lorentz signature is the constraint
of causality:  a signal cannot travel outside the light cone.  Because the speed of light is so large on a human scale, the constraints of relativistic causality
are not apparent in everyday life.

These constraints are most interesting in the context of gravity.   Black holes -- regions of spacetime from which no signal can escape
to the outside world -- provide a dramatic manifestation of how the constraints of relativistic causality play out in the context of General Relativity.

The field equations of classical General Relativity are notoriously difficult, nonlinear equations, from which it can be hard to extract insight.
But it turns out that by rather simple arguments involving
 a fascinating interplay of causality, positivity of energy, and the Einstein equations,  it is possible to gain a great deal of qualitative understanding
of cosmology, gravitational collapse, and spacetime singularities.


The aim of the present article is to introduce this subject as readily as possible, with a minimum of formalism.  
 This will come at the cost
of cutting a few mathematical corners and omitting  important details -- and further results -- 
 that can be found in more complete treatments.    Several classical accounts of this material were written by the original pioneers,
  including Penrose \cite{Penrose} and Hawking \cite{HawkingEllis}.   Some  details and further results omitted in the present article can be found in
   the classic textbook by Wald \cite{Wald}, especially chapters 8, 9, and 12.   Several helpful sets of lecture notes are  \cite{Galloway, Chrusciel, Aretakis}.    A detailed mathematical
   reference on Lorentz signature geometry is \cite{BEE}.

 To a reader wishing to become familiar with these matters, one can offer some
good news:   there are many interesting results, but  a major role is played by a few key ideas that date back to the 1960's.
  So one can become  conversant with a significant body of material in a relatively short span of time.

The article is organized as follows.
Some basics about causality are described in sections \ref{classic} and \ref{glohyper}.  In section \ref{geofocal}, we explore the properties of timelike geodesics and
navigate towards  what is arguably
the most easily explained singularity theorem,
namely a result of Hawking about the Big Bang \cite{Hawkingsing}.   In  section \ref{ng}, we analyze the somewhat subtler problem of null geodesics  and present the original and most important modern
singularity theorem, which is  Penrose's theorem about gravitational collapse \cite{Penrosesing}.  
Section \ref{blackholes} describes some basic properties of black holes which can be understood once one is familiar
with the ideas that go into Penrose's proof.  A highlight is the Hawking area theorem \cite{Hawkingarea}. Section \ref{addtop} is devoted
to some additional matters, notably topological censorship \cite{topocensor,topocensor2}, the Gao-Wald theorem \cite{Gao-Wald}, and their extension to the case that one
assumes an averaged null energy condition (ANEC) rather than the classical null energy condition.    Finally, in section \ref{newlook}
we re-examine null geodesics in a more precise way, with fuller explanations of some important points from section \ref{ng} plus some further results.

For the most part, this article assumes only a basic knowledge of General Relativity.   
At some points, it will be helpful to be familiar with the Penrose diagrams of some standard spacetimes.
The most important example -- because of its role in motivating Penrose's work --  is simply the Schwarzschild solution.
The other examples that appear in places 
(Anti de Sitter space, de Sitter space, and the Reissner-Nordstr\"{o}m solution) provide illustrations that actually can be omitted on first reading; the article will remain comprehensible.  
Much of the relevant background to the Anti de Sitter and de Sitter
examples is explained in Appendices \ref{ads} and \ref{dSitter}.



\section{Causal Paths}\label{classic}

To understand the causal structure of spacetime,\footnote{ \label{recall} In this article, a ``spacetime'' $M$ is a $\D$-dimensional manifold,
 connected, with a smooth Lorentz signature metric.  We assume that $M$ is time-oriented, which means
that at each point in $M$, there is a preferred notion of what represents a ``future'' or ``past'' timelike direction.   We allow arbitrary $\D$ -- rather than specializing to $\D=4$ -- since
this does not introduce any complications.   It is interesting to consider the generalization to arbitrary $\D$, since any significant dependence on $\D$
might shed light on why we live in $\D=4$, at least macroscopically.   Moreover, 
 the generalization to arbitrary $\D$ is important in contemporary research on quantum gravity.}
 we will have to study causal paths.   We usually describe a path in parametric form as 
  $x^\mu(s)$, where $x^\mu$ are local coordinates in spacetime and $s$ is a parameter. (We require that the tangent vector $\d x^\mu/\d s$ is nonzero for all $s$, and  we consider two paths to be equivalent if they differ only by a reparametrization $s\to \t s(s)$.)   A path $x^\mu(s)$ is causal if its tangent vector $\frac{\d x^\mu}{\d s}$ is everywhere timelike or null. 
 
 \begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Singul1.pdf} 
 \end{center}
\caption{\small  For two spacetime points $q,p$, with $p$ to the future of $q$, the causal diamond $D_q^p$ consists of all points
that are in the causal future of $q$ and the causal past of $p$.   
Sometimes it is of interest to consider a spacetime in which a point $r$ is omitted from the causal diamond, as sketched here.  \label{Fig2}}
\end{figure}
    
We will often ask questions along the lines of ``What is the optimal causal path?'' for achieving some
given objective.   For example, what is the closest one can come to escaping from the black hole or traversing the wormhole?
The answer to such a question usually involves a geodesic with special properties.   So geodesics will play an important role.

We start simply by considering causal paths in Minkowski space  from a point $q$ to a point $p$ in its causal future (the points inside  or on the future light cone of $q$).
Such a path will lie within a subset of spacetime that we will call the ``causal diamond'' $D_q^p$ (fig. \ref{Fig2}).  This diamond
  is the intersection of the causal
future of\footnote{\label{detail} An important detail -- here and 
 later -- is that we consider $q$ itself to be in its own causal future (or past).
 Thus $q$ (or $p$) is contained in $D_q^p$.   Related to this, in the definition of a causal path, we allow the case of a trivial
 path that consists of only one point.  The purpose of this is to simplify various statements about closedness or compactness.} $q$  with the causal past of $p$.

The first essential point is that the space of causal paths from $q$ to $p$ is in a suitable sense compact.  
Causality is essential here.  Without it, a sequence of paths, even if confined to a compact region of spacetime (like $D_q^p$),
could oscillate more and more wildly, with no convergent subsequence.   For example, in two-dimensional Minkowski space $M$ with
metric $\mathrm{ds}^2=-\d t^2+\d x^2$ (where we will sometimes write $\x$ for the pair $(t,x)$), here is a sequence of non-causal paths\footnote{To put these paths in parametric
form, one would simply write $t(s)=s$, $x(s)=\sin (\pi n s)$.} from $q=(0,0)$ to $p=(1,0)$:
\be\label{first} x=\sin(\pi n t),~~~~0\leq t\leq 1.\ee      Though restricted to a compact portion of $M$,
these paths oscillate more and more wildly with no limit for $n\to\infty$.  Taking a subsequence does not help, so the space of all paths from
$q$ to $p$ is not compact in any reasonable sense.


Causality changes things because  it gives a constraint $|\d  x/\d t|\leq 1$.  
To understand why this leads to compactness,  it is convenient to flip the sign of the $\d t^2 $	term in the metric (in our chosen coordinate system) and define
the Euclidean signature metric 
\be\label{second} \ds_E^2=\d t^2+\d x^2. \ee    
A straight line from $q=(0,0)$ to $p=(1,0)$ has Euclidean length 1, and an arbitrary causal path between those points has Euclidean length no more than $\sqrt 2$.
(The reader should be able to describe an example of a causal path of maximal Euclidean length.)

Once we have an upper bound on the Euclidean length, compactness follows.   Parametrize a causal path of Euclidean
length $\lambda \leq \sqrt 2$ by a parameter $s$ that measures  the arclength divided by $\lambda$, so $s$ runs from 0 to 1.  Suppose
that we are given a sequence of such causal paths $\x_n(s), ~~n=1,2,3,\cdots$.   Since each of these paths begins
at $q$, ends at $p$, and has total Euclidean length $\leq \sqrt 2$, there is a compact subset $D$ of Minkowski space that contains all of them.

The existence of a convergent subsequence of the sequence of paths $\x_n(s)$ follows by an argument that might be familiar.  First consider what happens at $s=1/2$.  
Since $\x_n(1/2)$ is contained, for each $n$, in the compact region $D$, there is a subsequence of the paths $\x_n(s)$ such that $\x_n(1/2)$ converges
to some point in $D$.  Extracting a further subsequence, one ensures that $\x_n(1/4)$ and $\x_n(3/4)$ converge.   Continuing in this way, one ultimately
extracts a subsequence of the original sequence with the property  that $\x_n(s)$ converges for any rational number $s$ whose denominator is a power of 2.
 The bound on the length ensures that wild fluctuations are not possible, so actually for this subsequence, $\x_n(s)$ converges for all $s$.
So  any sequence of causal paths from $q$ to $p$ has a convergent subsequence, and thus the space of such causal paths is compact.\footnote{\label{humph}In this footnote
and the next one, we give the reader a taste of the sort of mathematical details that will generally be elided in this article.    The topology in which the space of causal
paths is compact is the one for which the argument in the text is correct:   a sequence $\x_n(s)$ converges to $\x(s)$ if it converges for each $s$.   In addition, to state properly
the argument in the text, we have to take into account that such a pointwise limit of smooth curves is not necessarily smooth.   One defines a continuous causal curve as the pointwise
limit of a sequence of smooth causal curves.   (A simple example of a continuous causal curve that is not smooth is a piecewise smooth causal curve.)
The argument in the text has to be restated to show that a sequence of continuous causal curves has a
subsequence that converges to a continuous causal curve. Basically, if $\gamma_1,\gamma_2,\cdots$ is a sequence of continuous causal curves, then after passing to a subsequence, one can assume as in the text
that the $\gamma_i$ converge to a continuous curve $\gamma$, and we have to show that $\gamma$ is a continuous causal curve.   Each $\gamma_j$, being a continuous causal curve, is the pointwise limit of a sequence $\gamma_{j,1},\gamma_{j,2},\cdots$
of smooth causal curves.   After possibly passing to subsequences, we can assume that $\gamma_j$ and $\gamma_{j'}$ are close to each other for large $j,j'$ (say within Euclidean distance $1/n$ if $j,j'\geq n$)
and similarly that $\gamma_{j,k}$ is close to $\gamma_j$ for $k\geq j$ (say within a Euclidean distance $1/j$).  Then the diagonal sequence $\{\gamma_{j,j}\}$ is a sequence of smooth
causal curves that converges to $\gamma$, so $\gamma$ is a continuous causal curve.}

This argument carries over without any essential change to $\D$-dimensional Minkowski space with metric $\ds^2=-\d t^2+\d \vec x^2$.
Thus if $p$ is to the causal future of $q$, the space of causal paths from $q$ to $p$ is compact.

 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Wild.png} 
 \end{center}
\caption{\small  The purpose of this figure is to illustrate the fact that a smooth timelike curve $\gamma$ can be approximated by a sequence of causal curves
$\gamma_n$ that fluctuate rapidly near $\gamma$ in lightlike or almost lightlike directions, such that the $\gamma_n$ converge to $\gamma$ but the proper time elapsed along
the $\gamma_n$ does not converge to the proper time elapsed along $\gamma$.   Rather the proper time elapsed along the $\gamma_n$ can be very small or even zero.
  \label{Wild}}
\end{figure}

Here is a consequence that turns out to be important.
The proper time elapsed along a causal path is 
\be\label{third}\tau =\int_0^1\d s\sqrt{ \left(\frac{\d t}{\d s} \right) ^2- \left(\frac{\d \vec x}{\d s}  \right)^2   }.\ee
Assuming that $p$ is in the causal future of $q$ -- so that causal paths from $q$ to $p$ do exist -- the compactness of the space of causal
paths from $q$ to $p$ ensures that there must be such a path 
 that maximizes $\tau$.
In more detail, there must be an upper bound on $\tau$ among all causal paths from $q$ to $p$, because a sequence of causal paths $\x_n(s)$
whose elapsed proper time $\tau_n$ grows without limit for $n\to \infty$ could not have a convergent subsequence.   If $\tau_0$ is the least upper
bound of the proper time for any causal path from $q$ to $p$, then a sequence of paths $\x_n(s)$ of proper time $\tau_n$ such that $\tau_n\to\tau_0$ for $n\to\infty$
 has a convergent subsequence,
and the limit of this subsequence is a causal path with proper time\footnote{The proper time is not actually a continuous function on the space of paths, in the
topology defined in footnote \ref{humph}.   That is because a sequence of causal paths $\gamma_n$ might converge pointwise to a causal path $\gamma$
but with wild short-scale oscillations in lightlike (or almost lightlike) directions.  See fig.  \ref{Wild}.  The correct statement is that if a sequence $\gamma_n$ converges
to $\gamma$, then the proper time elapsed along $\gamma$ is equal to or greater than the limit (or if this limit does not exist, the lim sup) of the proper
time elapsed along $\gamma_n$.   In other words, upon taking a limit, the proper time can jump upwards but cannot jump downwards.   Technically this
is described by saying that the proper time function is an upper semicontinuous function on the space of causal paths.   Upward jumps  do not spoil the argument
given in the text (though downward jumps would spoil it), because by the way $\tau_0$ was defined,  the  limit of a subsequence of the $\x_n(s)$ cannot
have a proper time greater than $\tau_0$.    One could modify the notion of convergence to make the elapsed proper time a continuous function on the space of causal
paths, but this is inconvenient because then compactness would fail.} $\tau_0$.  

A causal path that maximizes -- or just extremizes -- the elapsed proper time is a geodesic.   So if $p$ is in the future of $q$,
there must be a proper time maximizing geodesic from $q$ to 
$p$.   In the particular case of Minkowski space, we can prove this more trivially.    
There is a unique geodesic from $q$ to $p$, namely a straight line, and it maximizes the proper time.   (The fact that a timelike geodesic in Minkowski space
maximizes the proper time between its endpoints is sometimes called the twin paradox.  A twin who travels from $q$ to $p$ along a non-geodesic path, accelerating
at some point along the way, comes back younger than a twin whose trajectory from  $q$ to $p$ is a geodesic.   In a suitable Lorentz frame, the twin whose path
is a geodesic was always at rest, but there is no such frame for the twin whose trajectory involved acceleration.)



The only fact that we really needed about Minkowski space to establish the compactness of the space of causal paths from $q$ to $p$ was
that the causal diamond $D_q^p$ consisting of points that such a path can visit is compact.   If $q$ and $p$ are points in any Lorentz signature spacetime,
we can define a generalized causal diamond $D_q^p$ that consists of points 
 that are in the causal
future of $q$ and the causal past of $p$.    Whenever $D_q^p$ is compact,   the same reasoning as before will show that
the space of causal paths from $q$ to $p$ is also compact, and therefore that there is a geodesic from $q$ to $p$ that maximizes the elapsed proper time.

A small neighborhood  $U$ of  a point $q$ in any spacetime $M$ can always
be well-approximated by a similar small open set in Minkowski space.     A precise statement (here and whenever we want to compare a small neighborhood of a point in some
spacetime
to a small open set in Minkowski space) is that $q$ is contained in  a convex normal neighborhood $U$, in which
there is a unique geodesic between any two points.\footnote{For more detail on this concept,
 see \cite{HawkingEllis}, especially p. 103, or \cite{Wald}, p. 191.}    Roughly, in such a neighborhood, causal relations are as they are in a similar neighborhood in Minkowski space.  We will
 call such a neighborhood a local Minkowski neighborhood.
 
  If $p$ is just slightly to the future of $q$,  one might hope that $D^p_q$ will be compact, just like a causal diamond in Minkowski space.  
 This is actually true if $M$ satisfies a physically sensible condition of causality.  A causality condition is needed for the following reason.   In order to compare $D^p_q$ to a causal diamond
 in Minkowski space, we want to know that if $p$ is close enough to $q$, then $D^p_q$ is contained in a local Minkowski neighborhood of $q$.   That is not true
 in a spacetime with closed causal curves (if $\gamma_0$ is a closed causal curve from $q$ to itself, then a causal path from $q$ to $p$ can traverse $\gamma_0$ followed by any causal
 path from $q$ to $p$; such a path will not be contained in a local Minkowski neighborhood of $q$, since there are no closed causal curves in such a neighborhood).   The condition that we need is
  a little stronger than absence of closed causal curves and is called ``strong causality'' (see section \ref{causality} for more
 detail).     In a strongly causal spacetime, causal paths from $q$ to $p$ are contained in a local Minkowski neighborhood of $q$ if $p$ is close
 enough to $q$.   $D^p_q$ is then compact, as in Minkowski space.   In this article, we always assume strong causality.


As $p$ moves farther into the future, compactness of $D^p_q$ can break down.   We will give two examples.
  The first example is simple but slightly artificial.  The second example is perhaps more natural.

For the first example, start with Minkowski space $M$, and make a new spacetime $M'$  by omitting from $M$ a point
$r$ that is in the interior of $D_q^p$ (fig. \ref{Fig2}).    $M'$ is a manifold, with a smooth Lorentz signature metric tensor, so we can regard
it as a classical spacetime in its own right.   But in $M'$,  the causal diamond $D_q^p$ is not compact, since the point $r$ is missing.
Accordingly the space of causal paths from $q$ to $p$ in $M'$ is not compact.  A sequence of causal paths in $M'$
whose limit in $M$ would pass through $r$ does not have a limit among paths in $M'$.   If in $M$, $r$ happens to lie on the geodesic from $q$ to $p$,
then in $M'$ there is no geodesic from $q$ to $p$.  Of course, in this example $D_q^p$ is compact if $p$ is to the past of $r$.

We can make this example a little less artificial by using the fact that the space of causal paths is invariant under 
a Weyl transformation of the spacetime metric, that is, under multiplying the metric by a positive  function $e^\phi$, for any real-valued
function $\phi$ on spacetime.   The reason
for this is that two metrics $\ds^2$ and $e^\phi\ds^2$ that differ by a Weyl transformation  have the same local light cones and so the same spaces of causal paths.
With this in mind,  replace the usual Minkowski space metric $-\d t^2+\d \vec x^2$ with a Weyl-transformed metric
$e^\phi(-\d t^2+\d\vec x^2) $.  If the function $\phi$ is chosen to blow up at the point $r$, producing a singularity,
this provides a rationale for omitting that point from the spacetime. This gives a relatively natural example of a spacetime in which causal diamonds are not compact.

\begin{figure}
 \begin{center}
   \includegraphics[width=3in]{AdS-Penrose.pdf} 
 \end{center}
\caption{\small The Penrose diagram of AdS$_2$ spacetime.    The causal structure is that of the strip $0<\sigma<\pi$ in Minkowski spacetime with metric $\ds^2=-\d t^2+\d\sigma^2$. Causal
curves make an angle no greater than $\pi/4$ from the vertical.
   A causal curve from $q$ can travel
to the right edge of the figure, linger for a while very near the boundary, and then proceed on to $p$.   A causal curve of this kind can have an arbitrarily large
elapsed proper time.  By contrast, if $p$ is replaced by a point $p'$ inside the quadrilateral $qsq'r$, then a causal curve from $q$ to $p'$ cannot reach
the boundary and has a maximum possible elapsed proper time.   The curved lines in the figure are the timelike geodesics through the point $q$; every
point $p'$ inside the quadrilateral $qsq'r$ is on such a geodesic (reflecting compactness of $D_q^{p'}$ for such $p'$).
These timelike geodesics all focus at the point $q'$, as shown.  Their continuation to the future of $q'$ or the past of $q$ is indicated. No geodesic from $q$
reaches $p$. There is a timelike geodesic from $q$ to $w$, but it does not maximize the proper time.  Some of these details will be important in section \ref{loran}.
 (Compare with Fig. 7 of \cite{Penrose}.)  \label{Fig1}}
\end{figure}
 
For a second example,\footnote{\label{noted}This example can be omitted on first reading.   The background required to understand it is largely explained in Appendix \ref{ads}.} we consider Anti de Sitter (AdS) spacetime, which is the maximally homogeneous spacetime with negative cosmological constant.   For simplicity, we consider two-dimensional Anti de Sitter spacetime AdS$_2$.    As explained in detail in Appendix \ref{ads}, this spacetime
 can be described by the metric
 \be\label{wombox} \ds^2=\frac{R^2}{\sin^2\sigma}\left(-\d t^2+\d\sigma^2\right),~~-\infty<t<\infty, ~~~0<\sigma<\pi. \ee
 The causal structure is not affected by the factor $R^2/\sin^2\sigma$, which does not affect which curves are timelike or null.  
 So from a causal point of view, we can drop this factor and just consider the strip $0<\sigma<\pi$ in a Minkowski space with metric $\ds^2=-\d t^2+\d\sigma^2$.
 This strip is depicted in the Penrose diagram
 of fig. \ref{Fig1}.    A causal curve in the Penrose diagram is one whose tangent vector everywhere makes an angle no greater than $\pi/4$ with the vertical.  Null geodesics
 are straight lines for which the angle is precisely $\pi/4$; some of these are drawn in the figure.
 
 The boundaries of the Penrose diagram at $\sigma=0,\pi$ are not part of the AdS$_2$ spacetime. They are infinitely far away along, for example, a spacelike hypersurface
 $t={\mathrm{constant}}$.    Nevertheless, a causal curve that is null or asymptotically null can reach $\sigma=0$ or $\pi$ at finite $t$.    Accordingly, it is 
sometimes useful to partially compactify
AdS space by adding in  boundary points at $\sigma=0,\pi$.  Those points make up what is called the conformal boundary of AdS$_2$.   But importantly,
the conformal boundary is not actually part of the AdS$_2$ spacetime.   We cannot include the boundary points because (in view of the $1/\sin^2\sigma$ factor) the metric blows up along the conformal
boundary.


 As in any spacetime (satisfying a reasonable causality condition), if  $q$ is a point in AdS spacetime, and $p'$ is a point slightly to its future, then $D_q^{p'}$ is compact.   But in AdS spacetime,
$D_q^{p'}$ fails to be compact if $p'$ is sufficiently far to the future of $q$ that a causal path from $q$ to $p'$  can reach from $q$ all the way to the conformal
boundary on its way to $p'$.  In this case, the fact that the conformal boundary points are not actually part of the AdS spacetime means that $D_q^{p'}$
is not compact.  The ``missing'' conformal boundary points play a role similar to the missing point $r$ in the previous example.



In practice, if a point $p'$ is  contained in the quadrilateral  $qsq'r$ in the figure, then a causal path from $q$ to $p'$ cannot reach the conformal
boundary en route, and 
 $D_q^{p'}$ is compact.   But if $p'$ is to the future of $q$ and not in this quadrilateral, then a causal path from $q$ to $p'$ can reach the conformal
 boundary on its way, and compactness of $D_q^{p'}$ fails.   Concretely, a sequence of causal curves from $q$ within the AdS space 
 that go closer and closer to the conformal boundary
 on their way to $p'$ will have no convergent subsequence.
  
 When $D_q^{p'}$ is not compact, there may not exist a causal path from $q$ to $p'$ of maximal elapsed proper time.
An example is the point labeled $p$ in the figure, which is to the future of $q$ but is not contained in the quadrilateral.   
There is no upper bound on the elapsed proper time of a causal path from $q$ to $p$.
A causal path that starts at $q$, propagates  very close to the right edge of the figure, lingers there for a while, and then continues on to $p$,
can have an arbitrarily long elapsed  proper time.   This statement reflects the factor of $1/\sin^2\sigma$ in the AdS$_2$ metric (\ref{wombox}).   Since a causal path
from $q$ to $p$ can linger for a positive interval of $t$ in a region of arbitrarily small $\sin\sigma$, there is no upper bound on its elapsed proper time.

  In fact, there is no geodesic from $q$ to $p$.   All  future-going timelike geodesics
from $q$ actually converge at a focal point $q'$ to the future of $q$, whose importance will become clear in section \ref{geofocal}.    From $q'$, these geodesics continue
``upward'' in the diagram, as shown, never reaching $p$.  Lightlike or spacelike geodesics from $q$ terminate on the conformal boundary in the past of $p$.   

In view of examples such as these, one would like a useful criterion that ensures the compactness of the generalized causal diamonds  $D_q^p$.
Luckily, there is  such a criterion.

\section{Globally Hyperbolic Spacetimes}\label{glohyper}  
 
 
 \subsection{Definition}\label{def}
  
In a traditional understanding of physics, one imagines specifying initial data on an initial value hypersurface\footnote{By definition, a hypersurface
is a submanifold of codimension 1.} $\S$  and then
one defines equations of motion that are supposed to determine what happens to the future (and past) of $\S$.  

To implement this idea in General Relativity, we require $S$ to be a spacelike hypersurface.\footnote{More generally,
one can define initial data on a hypersurface that has some null portions, as long as it is achronal (see below).   We will consider only the more intuitive case
of a spacelike hypersurface.}
 Saying that $\S$ is spacelike
means that the nearby points in $\S$ are spacelike separated; more technically, the Lorentz signature metric of the full spacetime manifold $M$ induces on $\S$
a Euclidean signature metric.   A typical example is the hypersurface $t=0$ in a Minkowski space with metric   $\ds^2=-\d t^2+\d \vec x^2$.
The induced metric on the surface $t=0$ is simply the Euclidean metric $\d\vec x^2$.


\begin{figure}
 \begin{center}
   \includegraphics[width=1.4in]{Singul5.pdf} 
 \end{center}
\caption{\small A spacelike hypersurface $\S_\varepsilon$ that is closed but not achronal.  \label{Fig3}}
\end{figure}

We actually need a further condition, which is that $\S$ should be {\it achronal}.   In general, a subset $\S$ of a spacetime  $M$ is called achronal if there is
no timelike path in $M$ connecting distinct points $q,p\in \S$.  If there is such a path, then data at $q$ will influence what happens at $p$ and it is not sensible
to specify ``initial conditions'' on $\S$ ignoring this.

To see that a spacelike hypersurface is not necessarily achronal, consider the two-dimensional cylindrical spacetime with flat metric
\be\label{zorfo} \ds^2=-\d t^2+\d\phi^2,\ee
where $t$ is a real variable, but $\phi$ is an angular variable, $\phi\cong\phi+2\pi$.
The hypersurface $\S_\varepsilon$ defined by
\be\label{morfo} t=\varepsilon\phi, \ee
for nonzero $\varepsilon$, wraps infinitely many times around the cylinder (fig. \ref{Fig3}).   $\S_\varepsilon$ is  spacelike if $\varepsilon$ is small, but it is not achronal;
for example, the points $(t,\phi)=(0,0)$ and $(t,\phi)=(2\pi\varepsilon,0)$ in $\S_\varepsilon$ can be connected by an obvious timelike geodesic.   Thus a spacelike
hypersurface is not necessarily achronal: in a spacelike hypersurface $S$,  sufficiently near points in $\S$ are not connected by a nearby timelike
path, while in an achronal hypersurface, the same statement holds without the condition that the points and paths should be sufficiently near.   (Conversely, an achronal
hypersurface may not be spacelike as it may have null regions.) 




\begin{figure}
 \begin{center}
   \includegraphics[width=1.6in]{Singul6.pdf} 
 \end{center}
\caption{\small If $\S$ is a spacelike hypersurface and $\gamma$ is a null curve 
 connecting points $p,p'\in \S$, then by moving
$p'$ along $\S$ ``towards'' $\gamma$, one gets a point $p''\in \S$ such that there is a strictly timelike curve $\t\gamma$ from $p$ to $p''$.
This is illustrated using the hypersurface $\S_\varepsilon$ of fig. \ref{Fig3}.   \label{Fig3a}}
\end{figure}

If an achronal set $\S$ is also a spacelike hypersurface, the statement of achronality can be sharpened.
The definition of achronal says that there is no timelike path $\gamma\subset M$ connecting distinct points $p,p'\in \S$, but if $\S$ is of codimension 1 in $M$, 
it follows that there actually is no causal path from $p$ to $p'$.  In other words, $\gamma$ does not exist even if it is allowed to be null  rather than timelike.
To see this, let us think of the directions in which a point $p\in \S$ can be displaced, while remaining in $\S$, as the ``spatial'' directions.
For $\S$ a spacelike  hypersurface, these directions do constitute, at every point $p\in \S$, a complete set of spatial directions, in some local Lorentz frame at $p$.
If $p,p'\in \S$ are connected by a  causal path $\gamma$ that is null (in whole or in part), then after displacing $p$ or $p'$ along $\S$
in the appropriate  direction, $\gamma$ can be deformed to
 a timelike path; see fig. \ref{Fig3a}.    
 
 Here it is important that $\S$ is of  codimension 1.   Otherwise the necessary displacement  may not be possible. 

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig3M.pdf} 
 \end{center}
\caption{\small a) The causal curve $\gamma$ in a spacetime $M$ can be extended indefinitely into the past and future. b) A point $r$ has been removed from $M$ to
make a new spacetime $M'$.  $\gamma$ splits into two causal curves $\gamma_1$ and $\gamma_2$.  $\gamma_1$ is inextendible in the future and $\gamma_2$ is inextendible
in the past.  \label{Fig3M}}
\end{figure}

To complete the definition of an initial value hypersurface in General Relativity, we need the notion of an {\it inextendible} causal curve.   A causal
curve is extendible if it can be extended further.  Otherwise it is inextendible. For example, in Minkowski space, the timelike geodesic $(t(s),\vec x(s))=(s,0)$
is inextendible if $s$ is regarded as a real variable.   But if we arbitrarily restrict $s$ to a subset of the real line, for example $0<s<1$,
we get an extendible causal curve.  If we remove from some spacetime $M$ a point $r$ to get the spacetime $M'$ of fig. \ref{Fig2}, then an inextendible
causal path in $M$ that passes through $r$ breaks up in $M'$ into two separate causal paths, one to the future of $r$ and one to the past of $r$ (fig. \ref{Fig3M}).
Each of them is  inextendible.   A sufficient, but not necessary, condition for a timelike path $\gamma$ to be inextendible is that the  proper time elapsed
along $\gamma$  diverges
both in the past and in the future.    

Let $\gamma$ be a causal curve $x^\mu(s)$.   With a suitable choice of the parameter $s$, we can always assume that $s$ ranges over the unit interval,
with or without its endpoints.   Suppose for example that $s$ ranges over a closed interval $[0,1]$ or a semi-open interval $(0,1]$.   Then we define $p=x^\mu(1)$ as the future
endpoint\footnote{\label{technical} We use the term ``endpoint'' in this familiar sense, but we should warn the reader that the same term is used in mathematical
relativity with a somewhat different and more technical meaning.   See \cite{Wald}, p. 193.}
 of $\gamma$.   Such a $\gamma$ is always extendible to the future beyond $p$; the extension can be made by adjoining to $\gamma$ any future-going causal path from $p$.
Even if $\gamma$ is initially defined on an open or semi-open interval $(0,1)$ or $[0,1)$  without a future endpoint, if the limit $p=\lim_{s\to 1}x^\mu(s)$ exists,
we can add $p$ to $\gamma$ as a future endpoint, and then continue $\gamma$ past $p$ as before.   So if $\gamma$ is inextendible to the future, this means that
$\gamma$ has no future endpoint and it is not possible to add one.    (Informally, this might mean, for example, that $\gamma$ has already been extended infinitely to the future,
or at least as far as the spacetime goes, or that $\gamma$ ends at a singularity.)
Similarly, if $\gamma$ cannot be extended to the past, this means that $\gamma$ has no past endpoint and it is not possible to add one.   



 
Finally we can define the appropriate concept of an initial value surface in General Relativity, technically called a Cauchy hypersurface.
A Cauchy hypersurface or initial value hypersurface in $M$ is an achronal spacelike hypersurface $\S$ with the property that if $p$ is a point in $M$ not in $\S$, then every
inextendible causal path $\gamma$ through $p$ intersects $\S$.
  A spacetime $M$ with a Cauchy hypersurface $\S$ is said to be {\it globally hyperbolic}.
  
  
 This definition  requires some explanation.  
The intuitive idea is that any signal that one observes at $p$ can be considered to have arrived at $p$ along some causal path.
If $p$ is to the future of $\S$ and every sufficiently extended past-going causal path
through $p$ meets $\S$, then what one will observe at $p$ can be predicted from a knowledge of what there was on $\S$, together with suitable dynamical equations.
If there is a past-going causal path $\gamma$ through $p$ that cannot be extended until it meets  $\S$, then a knowledge of what there was on $\S$ does not 
suffice to predict the physics at $p$;
one would also need an initial condition along $\gamma$.   (Obviously, if $p$ is to the past of $\S$, then similar statements hold, after exchanging ``past'' with ``future''
and ``initial condition'' with ``final condition.'')   Thus, globally hyperbolic spacetimes are the ones in which the traditional idea of predicting the future from the past is
applicable.

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig7M.pdf} 
 \end{center}
\caption{\small $S$ is a spacelike hypersurface in a spacetime that is not globally hyperbolic because a point $r$ in the future of $S$ has been removed.
Initial data on $S$ do not suffice to predict what will be observed at a point $p$ that is to the future of $r$.  To make such a prediction, one would need
to know something about possible signals that might emerge from the point $r$.   Technically, $S$ is not a Cauchy hypersurface for this spacetime  because there is a timelike curve
from $p$, as shown, that cannot be extended in the past until it meets $S$.  Rather, it gets ``stuck'' at the missing point.   \label{Fig7M}}
\end{figure}

 For example, the hypersurface $t=0$ in Minkowski space is an initial value hypersurface, and Minkowski space is globally hyperbolic.  
 On the other hand, omitting a point $r$  from a globally hyperbolic spacetime gives a spacetime that is not globally hyperbolic.   See fig. \ref{Fig7M}.  More
 sophisticated examples of  spacetimes that are not globally hyperbolic arise when certain black hole spacetimes (such as the Reissner-Nordstr\"{o}m or Kerr
 solutions) are extended beyond their horizons (see fig. \ref{Fig41M} in section \ref{ch}).
 
 
  
 An inextendible causal
path $\gamma\subset M$ will always intersect an initial value hypersurface $\S$, by the definition of such a hypersurface, but actually it will
always intersect $\S$ in precisely one point.  If $\gamma$ intersects $\S$ in two points $p$ and $p'$,
then the existence of the causal path $\gamma$ connecting $p$ and $p'$ contradicts the achronal nature of $\S$.    A Cauchy hypersurface $\S$ always divides $M$ into
a ``future'' and a ``past,'' for the following reason.   Suppose that $p\in M$ is not contained in $\S$, and let $\gamma$ be any inextendible causal path through $p$.
As we have just seen, such a path will intersect $\S$ at a unique point $q$.   We say that $p$ is to the future (or past) of $\S$ if it is to the future (or past) of $q$
along $\gamma$.   (As an exercise, the reader can check that this definition is consistent: if $\gamma, \gamma'$ are causal curves through $p$, meeting
$\S$ at points $q,q'$, then $q'$ is to the past of $p$ along $\gamma'$ if and only if $q$ is to the past of $p$ along $\gamma$.)  

It is not completely obvious that in General
Relativity, only globally hyperbolic spacetimes are relevant. Perhaps physics will eventually transcend the  idea of predictions
based on initial conditions.  But this will certainly involve more exotic considerations.  The study of globally hyperbolic spacetimes
is surely well-motivated.  

\subsection{Some Properties of Globally Hyperbolic Spacetimes}\label{somep}

 The following are useful facts that will also help one become
familiar with globally hyperbolic spacetimes.  

A globally hyperbolic spacetime $M$ can have no closed causal curves.  
 If there is a closed causal curve $\gamma\subset M$, then in parametric
form $\gamma$ is represented by a curve $x^\mu(s)$ with, say,  $x^\mu(s+1)=x^\mu(s)$.   We could think of $s$ as a periodic variable $s+1\cong s$, but
for the present argument, it is better to think of $s$ as a real variable, in which case $x^\mu(s)$ is an inextendible causal curve that repeats the same
spacetime trajectory infinitely many times. This curve will have to intersect  a Cauchy hypersurface 
$\S$, and it will do so infinitely many times.  But the existence of a causal curve that intersects $S$ more than once contradicts the achronality of $S$.  

Actually, if  $M$ is a globally hyperbolic spacetime with Cauchy hypersurface $\S$, then any other Cauchy hypersurface $\S'\subset M$
is topologically equivalent to $\S$.   The intuitive idea
is that $\S'$ can be reached from $\S$ by flowing backwards and forwards in ``time.''  Of course, for this idea to make sense in General Relativity, we have
to make a rather arbitrary choice of what we mean by time.  Let $\ds^2=g_{\mu\nu}\d x^\mu\d x^\nu$ be the Lorentz signature metric of $M$.  Pick an arbitrary Euclidean
signature metric $\ds_E^2=h_{\mu\nu}\d x^\mu\d x^\nu$.   At any point $p\in M$, one can pick coordinates with $h_{\mu\nu}=\delta_{\mu\nu}$.   Then
by an orthogonal rotation of that local coordinate system, one can further diagonalize $g_{\mu\nu}$ at the point $p$, putting it in the form $\mathrm{diag}(\lambda_1,\cdots,\lambda_\D)$.  Since
$g_{\mu\nu}$ has Lorentz signature, precisely one of the eigenvalues is negative.   The corresponding eigenvector $V^\mu$ is a timelike vector at $p$.  We  can normalize
this eigenvector up to sign by\footnote{Here and later, a summation over repeated indices is understood, unless otherwise stated.}
\be\label{morrox}h_{\mu\nu}V^\mu V^\nu=1,\ee  and, since $M$ is assumed to be time-oriented, we can fix its sign by requiring that it is future-pointing in the Lorentz signature metric $g$.




Having fixed this timelike vector field $V^\mu$ on $M$, we now construct timelike curves on $M$ by flowing in the $V^\mu$ direction.
For this, we look at the ordinary differential equation
\be\label{morro}\frac{\d x^\mu}{\d s}=V^\mu(x(s)), \ee
whose solutions, if we take the range of $s$ to be as large as possible, are inextendible causal curves.\footnote{If it is possible to add a past or future endpoint  $p$ to such a curve $\gamma$, then the
solution of 
 equation (\ref{morro}) can be continued for at least a short range of $s$ beyond $p$ (this is obvious in a local Minkowski neighborhood of $p$), so that $\gamma$ was not defined by solving the equation in the largest possible range of $s$. If it is not
 possible to add a past or future endpoint, then $\gamma$ is inextendible.}
   These curves are called the integral curves of the vector
field $V^\mu$.   
Every point $p\in M$ lies on a unique\footnote{We consider two parametrized causal paths $x^\mu(s)$ to be equivalent if they differ
 only by the choice of the parameter. In the present context, this means that two solutions of eqn. (\ref{morro}) that differ by an additive shift of the parameter
 $s$ correspond to the same integral curve.}
 such curve, namely the one that starts at $p$ at $s=0$.  Since the integral curves are inextendible causal curves, each such curve $\gamma$ intersects $\S$
 in a unique point.   If the integral curve through $p\in M$ meets $\S$ at a point $q$, then we define the ``time'' at $p$ by $t(p)=s(p)-s(q)$.   The 
 function defined this way vanishes for $p\in \S$, and increases towards the future along the integral curves. 
 
  The normalization condition (\ref{morrox}) means that the
 parameter $t$ just measures  arclength  in the Euclidean signature metric $h$.    The metric $h$ can always be chosen so that the arclength along
 an inextendible  curve in $M$ is divergent in both directions, roughly by making  a Weyl rescaling by a factor that blows up at infinity  \cite{NO}.  (See Appendix \ref{moredetail}
 for more detail on this statement.)
  Once this is done,   $t$ runs over the full range $-\infty<t<\infty$ for every  integral curve.
 
 
 
 
 \begin{figure}
 \begin{center}
   \includegraphics[width=4.5in]{Singul3.pdf} 
 \end{center}
\caption{\small If $\S\subset M$ is an initial value hypersurface, then every achronal set $\S'\subset M$ is equivalent topologically to a subset of $\S$.
The equivalence is found, roughly, by ``flowing'' in the time direction from $\S'$ to $\S$. This picture is meant to represent a typical impossible
situation, in which $\S$ is not
compact and $\S'$ is a compact achronal hypersurface.  The ``flow'' from $\S'$ to $\S$ would map more than one
point in $\S'$ to the same point in $\S$.  \label{Fig4}}
\end{figure}
 
 Now let $\S'\subset M$ be another Cauchy hypersurface.  Every $p\in \S'$ is on a unique integral curve, which intersects $\S$ at a unique point $q$.
We define a map $\varphi:\S'\to \S$ by  $\varphi(p)=q$.   Then $\varphi$ maps $\S'$ onto all of $\S$, because conversely, for any $q\in \S$, the integral curve through $q$  intersects
$\S'$ at some point $p$, so that $\varphi(p)=q.$    So $\varphi$ 
is  a 1-1 smooth mapping between $\S'$ and $\S$, showing that they are equivalent topologically, as claimed.  

 If $\S'$ is achronal,
 but not Cauchy, we can still map $\S'$ to $\S$ by $\varphi(p)=q$.   This map is an embedding but is not necessarily an isomorphism (as $\varphi(\S')$ may
 not be all of $\S$).   So we learn that any achronal set  $\S'\subset M$ is equivalent topologically to a portion of $\S$.  A special case of this is important
 in the proof of Penrose's singularity theorem for black holes (section \ref{penroseproof}).
 If $\S$ is not compact (but connected), then an achronal codimension 1 submanifold $\S'\subset M$ cannot be compact (fig. \ref{Fig4}).  For a compact $(\D-1)$-manifold $\S'$ cannot
 be embedded as part of a noncompact (connected) $(\D-1)$-manifold $\S$.

 
We can now also deduce  that topologically, $M=\S\times \R$.   Indeed, we can continuously parametrize $p\in M$ 
 by $t(p)$ 
and $\varphi(p)$.   Since $\varphi(p)$ is any point in $\S$, and $t(p)$ is any real number (assuming the metric $h$ is chosen to be complete, as discussed above),
this shows that $M=\S\times \R$.

A Cauchy hypersurface $\S\subset M$ is always a closed subspace of $M$. This immediately follows from the fact that $M=S\times \R$, since $S\times \{0\}$ (for any point $0\in\R$) is
closed in $S\times \R$.    For a more direct proof,  suppose that $p\in M$ is in the closure of $\S$ but not in $\S$ (fig. \ref{Singul4}).
Let $\gamma$ be any inextendible timelike path through $p$.  $\gamma$ meets $\S$ at some other point $p'$, since $\S$ is Cauchy.
But then, since $p$ is in the closure of $\S$, it is possible to slightly modify $\gamma$ only near $p$ to get a timelike path from $\S$ to itself,
showing that $\S$ is not achronal.  
 


 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Singul4.pdf} 
 \end{center}
\caption{\small  This picture aims to illustrate an argument in the text showing that a Cauchy hypersurface $\S\subset M$  is always closed in $M$. \label{Singul4}}
\end{figure}

Although the function $t(p)$ that we have defined increases towards the future along the integral curves, it does not necessarily increase towards the future
along an arbitrary causal curve.   For some purposes, one would like a function, known as a time function, with this property.   A simple construction was given in \cite{Geroch}.

 


\subsection{More On Compactness}\label{cpct}

Globally hyperbolic spacetimes have the property that spaces of causal paths with suitable conditions on the endpoints
are compact.\footnote{This was actually the original definition of a globally hyperbolic spacetime \cite{Leray}.   The definition in terms of intextendible causal curves
came later \cite{Geroch}.}   For example, for $\S$ an initial value hypersurface and $q$ a point to the past of $\S$, let $\CC_q^\S$
be the space of causal paths from $q$ to $\S$.
The space of such paths is compact, as one can see by considering a sequence of causal
paths $\gamma_n\in \CC_q^\S$.


\begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Singul2.pdf} 
 \end{center}
\caption{\small This picture illustrates the argument showing that $\CC_q^\S$ is compact.   At the bottom of the figure is a small causal diamond $D_q^s$ that
can be approximated by a causal diamond in Minkowski space.
 \label{Singul2}}
\end{figure}

If the point $s$ is slightly to the future of $q$, then the causal diamond $D_q^s$  looks like a causal diamond in Minkowski
spacetime, with $q$ at its past vertex, and in particular is compact.\footnote{As explained in section \ref{classic}, this statement requires  strong causality.    For now we take this as a physically
well-motivated assumption, but in Appendix \ref{detailedproof}, 
we show that globally hyperbolic spacetimes are strongly causal.  See also section \ref{causality} for more on strong causality.}  If we restrict the paths $\gamma_n$ to that
diamond, we can make the same argument as in Minkowski space, showing that
a subsequence $\gamma_{n,[1]}$ of the $\gamma_n$ (when restricted to the diamond)
converges to some causal path $\gamma_{[1]}$ from $q$ to a point $q'$ on
one of the future boundaries of the diamond, as in fig. \ref{Singul2}.    This much does not require the assumption of global hyperbolicity.   Now we start at $q'$,
and continue in the same way, showing that a  subsequence $\gamma_{n,[2]}$ of the $\gamma_{n,[1]}$
 converges in a larger region to a causal curve $\gamma_{[2]}$ that continues
past $q'$.    We keep
going in this way and eventually learn that a subsequence of the original sequence converges to a causal curve $\overline\gamma$ from
$q$ to   $\S$.   For more details on this argument, see  Appendix \ref{detailedproof}.   

The role of global hyperbolicity in the argument is to ensure that we never get ``stuck.''
Without global hyperbolicity, after iterating the above process,
we might arrive at a subsequence of the original sequence that has a limit path $\gamma_*$ that does not reach $\S$
and cannot be further extended.  To give an example of how this would actually happen, suppose that the original sequence $\gamma_n$ converges
to a causal curve $\gamma_*\in \CC_q^\S$, and let $p$ be a point in $\gamma_*$  that is not in any of the $\gamma_n$.   Then in the spacetime $M'$
that is obtained from $M$ by omitting the point $p$, the sequence $\gamma_n\in\CC_q^\S$ has no subsequence that converges to any causal curve from
$q$ to $\S$.  

Compactness of the space of causal curves from $q$ to $\S$ implies in particular that the set of points $D_q^\S$ that can be visited by such a curve
is also compact.   Clearly, if $p_1,p_2,\cdots$ is a sequence of points in $D_q^\S$ with no convergent subsequence, and $\gamma_1,\gamma_2,\cdots
\in \CC_q^\S$ is a sequence of causal curves from $q$ to $\S$ with $p_i\in\gamma_i$, then the sequence of curves $\gamma_1,\gamma_2,\cdots $ can have
no convergent subsequence.  Conversely, if one knows that $D_q^\S$ is compact, compactness of $\CC_q^\S$ follows by essentially the same argument that we
used in section \ref{classic} for curves in Minkowski space.    Pick an auxiliary Euclidean signature metric on $D_q^\S$.   Given a sequence $\gamma_1,\gamma_2,\cdots\in D_q^\S$,
parametrize the $\gamma_i$ by a parameter $s$ that is a multiple of the Euclidean arclength, normalized to run over the interval $[0,1]$, with $s=0$ corresponding to the initial
endpoint at $q$, and $s=1$ corresponding to a final endpoint in $\S$.   The $\gamma_i$ already coincide at $s=0$.   Using the compactness of $D_q^\S$, one can extract
a subsequence of the $\gamma_i$ that converges at $s=1$, a further subsequence that converges at $s=1/2$, and eventually, as in section \ref{classic},
 a subsequence that converges at a dense set of values of $s$.
Because the $\gamma_i$  are causal curves, wild fluctuations are impossible and this subsequence converges for all values of $s$.



If $q$ is to the future of $\S$, we write $\CC_\S^q$ for the space of causal paths from $\S$ to $q$ and $D_\S^q$ for the space of points that can be visited by such
a path.   The above reasoning has an obvious mirror image to show that $\CC_\S^q$ and $D_\S^q$ are compact.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig5M.pdf} 
 \end{center}
\caption{\small  Suppose that $p$ is to the past of a hypersurface $\S$ and $q$ is to the past of $p$.   A causal path $\gamma$ from $q$ to $p$ and a causal path $\lambda$ from
$p$ to $\S$ can be conjoined or ``composed'' to make a causal path $\gamma *\lambda$ from $q$ to $\S$. \label{Fig5M}}
\end{figure}
Now let $p$ and $q$ be points in $M$ with $p$ to the future of $q$.   Let $\CC_q^p$ be the space of causal curves from $q$ to $p$, and $D_q^p$
the space of points that can be visited by such a curve (thus $D_q^p$ is the intersection of the causal past of $p$ with the causal future of $q$).   
We want to show that $D_q^p$ and $\CC_q^p$ are compact.   Suppose, for example, that $q$ and $p$ are both to the past of $\S$.
Let $\lambda$ be some fixed causal path from $p$ to $\S$.   If $\gamma $ is any causal path from from $q$ to $p$, then we define
$\gamma *\lambda$ to be the ``composition'' of the two paths (fig. \ref{Fig5M}).   Then $\gamma\to \gamma * \lambda$ gives an embedding of $\CC_q^p$ in $\CC_q^\S$.  Given a sequence $\gamma_1,\gamma_2,\cdots$
in $\CC_q^p$, compactness of $\CC_q^\S$ implies that the sequence $\gamma_1* \lambda,\gamma_2*\lambda,\cdots$ has a convergent
subsequence, and this determines a convergent subsequence of the original sequence $\gamma_1,\gamma_2,\cdots$.   So $\CC_q^p$ is compact.
As in our discussion of $\CC_q^\S$, this implies as well compactness of $D_q^p$.   

Clearly, nothing essential changes in this reasoning if $q$ and $p$ are both to the future of $\S$.   What if $q$ is to the past of $\S$ and $p$ to the future?
One way to proceed is to observe that a causal path $\gamma$ from $q$ to $p$ can be viewed as the composition $\mu *\lambda$
of a causal path $\mu$ from $q$ to $\S$ and a causal path $\lambda$ from $\S$ to $p$.   So a sequence $\gamma_n\in \CC_q^p$
can be viewed as a sequence $\mu_n*\lambda_n$, with $\mu_n\in \CC_q^\S$, $\lambda_n\in \CC_\S^p$.   Compactness of $\CC_q^\S$ and $\CC_\S^p$
means that after restricting to a suitable subsequence, we can assume that $\mu_n$ and $\lambda_n$ converge.   This gives a convergent
subsequence of the original $\gamma_n$, showing compactness of $\CC_q^p$.  Accordingly $D_q^p$ is also compact.  

Compactness of the spaces of causal paths implies that in a globally hyperbolic
spacetime $M$, just as in Minkowski space, there is a causal path of maximal elapsed proper time from $q$ to any point $p$ in its future.
This path will be a geodesic, of course.    Assuming that $p$ can be reached from $q$ by a causal path that is not everywhere null, this geodesic will be timelike.
(If every causal path from $q$ to $p$ is null, then every such path is actually a null geodesic.   This important case will be analyzed in section \ref{ng}.)



  Similarly, if $\S$ is a Cauchy  hypersurface, and $q$ is a point not on $\S$,  then there is a causal path
of maximal elapsed proper time from $q$ to $\S$.  Such a path will be a timelike geodesic $\gamma$ that satisfies some further conditions that we will discuss in section \ref{loran}.
 
 \subsection{Cauchy Horizons}\label{ch}
 
 
 \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig6M.pdf}\caption{\small    Let $\S$ be the past hyperboloid $t^2=\vec x^2+R^2$, $t<0$ in Minkowski spacetime.  It is spacelike and achronal, but it is not
   a Cauchy hypersurface because, as shown, it is possible for a causal curve $\gamma$ that is infinitely extended to both the past and future to never intersect $\S$.    The domain of
   dependence of $\S$ is the interior of the past light cone of the origin (the point labeled $r$).   The Cauchy horizon $H_S$ is the past light cone of the origin.   \label{Fig6M}}\end{center}
\end{figure} 
 
Sometimes in a spacetime $M$, one encounters a spacelike hypersurface $\S$ that is achronal, but is not an initial value hypersurface because
there are inextendible causal paths in $M$ that never meet $\S$.  For an example, see fig. \ref{Fig6M}.  

 Nevertheless, it will always be true that if $p$ is a point just slightly to the future
of  $q\in \S$, then any inextendible causal path through $p$ will meet $\S$.   This is true because a very small neighborhood of $q$ can be
approximated by a small open set in Minkowski space, with $\S$ approximated by the spacelike hyperplane $t=0$.  The statement is true in that model example,
so it is true in general.
 

\begin{figure}
 \begin{center}
   \includegraphics[width=4in]{Fig41M.pdf}\caption{\small  (a) This is the Penrose diagram of the maximal analytic extension of the Reissner-Nordstr\"{o}m spacetime.
  It  describes a black hole carrying electric and/or magnetic charge.   The full spacetime $\h M$ is not globally hyperbolic, but
each  ``diamond,'' if considered by itself, is globally hyperbolic.   For example, the diamond
   shown in the center  represents a globally hyperbolic spacetime $M$ with Cauchy hypersurface $\S$.   The null surfaces labeled $H_S^+$ and $H_S^-$ (thick black lines)
    are the future and past Cauchy horizons of $\S$; the spacetime continues
   to the future of $H_S^+$ or to the past of $H_S^-$, but the continuation is not uniquely determined by initial data on $\S$.   Sketched here is the unique  continuation that is real analytic; 
   beyond $H_S^\pm$,
it has timelike singularities (represented by the wiggly vertical lines)   and repeats indefinitely into the past and future,
   with multiple globally hyperbolic ``diamonds.''   (b) We take a closer look at one causal diamond $M$.   It contains two asymptotically flat regions, labeled  I and II, connected by a ``wormhole''
   (see section \ref{cc}),
   and separated by  future and past horizons, labeled $H^\pm$.  To the future of $H^+$, from the standpoint of an observer in region I or II,
    is a black hole region.   The part of this region that is before the future Cauchy horizon is represented by the small shaded diamond.
    To the past of $H^-$ is a white hole region whose portion in the globally hyperbolic spacetime is represented by the small unshaded diamond.  
    (Much of this structure is also present in the simpler case of Schwarzschild spacetime, where it is exhibited in fig. \ref{Fig40M} of section \ref{cc}.)  In particular, the Cauchy horizons (again
    shown as thick black lines) are respectively to the future of $H^+$ and the past of $H^-$.  This structure
     was omitted in (a) to avoid clutter.   \label{Fig41M}}\end{center}
\end{figure} 



This suggests the following
definition.    The {\it domain of dependence} $\DD_\S$ of $\S$ consists of all points $p\in M$ with the property that every inextendible causal curve
through $p$ meets $\S$.    $\DD_\S$ is the largest region in $M$ in which the physics can be predicted from a knowledge of initial conditions
on $\S$.   
 
$\DD_\S$ can be regarded as a spacetime in its own right.   (The only nontrivial point here is that $\DD_\S$ is open in $M$, so that it is a manifold.)
As such, $\DD_\S$ is globally hyperbolic, with $\S$ as an initial value surface.   This is clear from the way that $\DD_\S$ was defined; we threw
away from $M$ any point that lies on an inextendible causal curve that does not meet $\S$.     Therefore, all results for globally hyperbolic spacetimes
apply to $\DD_\S$.

In particular, $\S$ divides $\DD_\S$ into a ``future'' and a ``past,'' which are known as the future and past domains of dependence of $\S$, denoted $\DD_\S^+$ and
$\DD_\S^-$.

The boundary of the closure of $\DD_\S$ (or of $\DD_\S^+$ or $\DD_\S^-$) is called the Cauchy horizon, $H_\S$ (or the future or past Cauchy horizon $H_\S^+$ or $H_\S^-$).
For an additional but more complicated example of a spacetime with Cauchy horizons, see fig. \ref{Fig41M}.  (Details of this example are not important in the rest of the article.  There is a much simpler Penrose diagram in section \ref{trapped}, and in that context we will give a very short explanation of the meaning of such diagrams.
To appreciate the more complicated example of fig. \ref{Fig41M} requires familiarity with the analytic continuation of the Reissner-Nordstr\"{o}m solution
of General Relativity,  which is  described for example in \cite{Wald} or \cite{MTW}.)





\subsection{Causality Conditions}\label{causality}

The most obvious causality condition in General Relativity is the absence of closed causal curves: there is no (nonconstant) closed causal curve from a point $q$ to itself.

It turns out that to get a well-behaved theory, one needs a somewhat stronger causality condition.   The causality condition that we will generally use in the present article
is global hyperbolicity.   It is the strongest causality condition  in wide use. We have seen that it implies the absence of closed causal curves.

A somewhat weaker condition, but still stronger than the absence of closed causal curves,
 is ``strong causality.'' A spacetime $M$ is strongly causal if every point $q\in M$ has an arbitrarily small neighborhood $V$ with the property that any causal
curve between points $p,p'\in V$ is entirely contained in $V$. (Arbitrarily small means that if $U$ is any open set containing $q$, then $q$ is contained in a smaller open
set $V\subset U$ that has the stated property.)  The absence of closed causal curves
can be regarded as the special case of this with $p=p'=q$, since if every closed causal curve from a point $q$ to itself is contained in an arbitrarily small open set around $q$,
this means that there is no nontrivial causal curve from $q$ to itself.   Strong causality roughly says that there are no causal curves that are arbitrarily close to being closed.  

For an example of a spacetime that has no closed timelike curves but is not strongly causal, consider the two-dimensional spacetime $M$ with metric tensor
\be\label{vunxo}\d s^2=-\d v \d u+ v^2 \d u^2,\ee
where $v$ is real-valued, but $u$ is an angular variable, $u\cong u+2\pi$.   A short calculation shows that the only closed causal curve in $M$ is the curve $v =0$.     Suppose
that we remove a point $p$ on that curve, to make a new spacetime $M'$.   Then strong causality is violated at any point $q\in M'$ that has $v=0$.   There is no closed causal curve
from $q$ to itself (since the point $p$ was removed), but there are closed causal curves from $q$ that come arbitrarily close to returning to $q$; these are curves that remain everywhere
at very small $v$.   It is reasonable to consider such behavior
to be unphysical.

We already met a typical application of strong causality in section \ref{classic}: it  ensures that a causal diamond $D_q^p$, with $p$ just slightly to the future of $q$,
is compact. To justify this statement in somewhat more detail, let $U$ be a local Minkowski neighborhood of $q$.   If strong causality holds
at $q$, then $q$ is contained in an open neighborhood $V\subset U$ with the property that any causal curve between two points in $V$ is entirely contained in $V$.
So if $p\in V$, the causal diamond $D_q^p$ is contained in $V$ and therefore in $U$. Because $U$ is a local Minkowski neighborhood, $D_q^p$ is compact.  
    Another typical application  will appear in section \ref{prompt}.

Minkowski space is strongly causal, because if $U$ is any neighborhood of a point $q$ in Minkowski space, then $q$ is contained in some causal diamond $D_r^{s}$ (with $r$ just
to the past of $q$, and $s$ just to its future) that
is in turn contained in $U$.   Moreover, any causal curve in Minkowski space between two points in $D_r^s$ is entirely contained in $D_r^s$.  Thus we can use the interior
of $D_r^s$ as
the open set $V\subset U$ in the definition of strong causality.

More generally, globally hyperbolic spacetimes are strongly causal.  The proof  is deferred to Appendix \ref{detailedproof}.   
In reading this article, one may assume that spacetime is globally hyperbolic and strongly causal.  It is not important on first reading to understand that the first assumption
implies the second.  The assumption of strong causality is not always stated
explicitly, as it does follow from global hyperbolicity. 

It turns out there are also advantages to a causality condition somewhat stronger than  strong causality, known as ``stable causality.''   For the definition, and a proof that
globally hyperbolic spacetimes are stably causal, see \cite{Wald}, p. 198.  




\subsection{Maximal Extensions}\label{maximal}

To avoid artificial examples, one usually places one more technical condition on a globally hyperbolic spacetime.

To explain what we wish to avoid, let $M$ be Minkowski space, and let $M'$ be the subset of $M$ defined by a condition $-1<t<1$ on the ``time'' coordinate $t$ (in some Lorentz
frame).    Then $M'$ is a globally hyperbolic spacetime, with Cauchy hypersurface  $t=0$.  A timelike path in $M'$ will end after a finite proper time,
but only because of the way we truncated the spacetime.

 In discussing a globally hyperbolic spacetime $M$ with Cauchy hypersurface $\S$, to avoid such artificial examples,
 one typically asks that $M$ be maximal under the condition that physics in $M$ can be predicted
based on data in $\S$.   In other words, one asks that $M$ be maximal\footnote{A theorem of Choquet-Bruhat and Geroch \cite{CG} states
that, given initial data on a Cauchy hypersurface $S$, a maximally extended globally hyperbolic
spacetime $M$ obeying the Einstein equations always exists and is unique up to diffeomorphism.}  under the condition that it is globally hyperbolic with Cauchy hypersurface $\S$.

It can happen that $M$ can be further extended to a larger spacetime $\h M$, but that this larger spacetime is not globally hyperbolic.   If so, there is a Cauchy horizon in $\h M$ and
$M$ is the domain of dependence of $\S$ in $\h M$.   

 A well-known example is the maximal analytic extension of the Reissner-Nordstr\"{o}m solution, describing a spherically symmetric
 charged black hole.  Let $\h M$ be this spacetime; the Penrose diagram is in fig. \ref{Fig41M}.    The spacelike surface $\S$ is a Cauchy hypersurface for a spacetime $M\subset \h M$
that includes the region exterior to the black hole (in each of two asymptotically flat worlds, in fact) as well as a portion of the black hole interior.   Behind the black hole
horizon are past and future Cauchy horizons, so $\S$ is not a Cauchy hypersurface for all of $\h M$.  


\section{Geodesics and Focal Points }\label{geofocal}

From here, we will navigate to the easiest-to-explain non-trivial result about singularities in General Relativity.  This means not following
the historical order.  The easiest result to explain is a theorem by Hawking \cite{Hawkingsing}
about the Big Bang singularity in traditional cosmology without inflation.
It is easier to explain because it involves only timelike geodesics, while
more or less all our other topics  involve the slightly subtler
case of null geodesics.

\subsection{The Riemannian Case}\label{riemann}


 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Fig13M.pdf} 
 \end{center}
\caption{\small  (a) A geodesic between two points $p$ and $q$ in a two-sphere that goes less than half way around the sphere minimizes
the length between those two points.   (b)   Any geodesic through the north pole $N$ reaches the south pole $S$ after going half-way around the sphere;
the point $S$ is called a focal point for these geodesics.   The geodesics from $N$ to $S$ are lines of constant longitude, as drawn.  When continued more than half-way around
the sphere, these geodesics are no longer length minimizing.   \label{Fig13M}}
\end{figure}

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.4in]{Fig14M.pdf} 
 \end{center}
\caption{\small  If the geodesic segment $qq'$ can be deformed -- at least to first order --  to a nearby geodesic connecting the same two points,
then $q'$ is called a focal point for geodesics that emanate from $q$.    \label{Fig14M}}
\end{figure}

We will start in ordinary Riemannian geometry, where we have more intuition,\footnote{For more detail on this material, see for example \cite{Jost}, chapter 4.}
and then we will go over to the Lorentz signature case.    Here is a question:   in Riemannian geometry, is a geodesic the shortest
distance between two points?    The answer is always ``yes'' for a sufficiently short geodesic, but in general if one follows a geodesic
for too far, it is no longer length minimizing.   An instructive and familiar example is the two-sphere
with its round metric.  A geodesic between two points $q$ and $p$
that goes less than half way around the sphere is the unique shortest path between those two points (fig. \ref{Fig13M}(a)).
But any geodesic that leaves $q$ and goes more than half way around the sphere is no
longer length minimizing.    What happens
is illustrated  in fig. \ref{Fig13M}(b) for the case that $q$ is the north pole $N$.  The geodesics that 
emanate from $N$ initially separate, but after going half way around the sphere, they reconverge at the south pole $S$.  The point of reconvergence is called a focal point or  a conjugate point.
  A geodesic that is continued past a focal point and thus has gone more than half way around the sphere is no longer length minimizing.   By ``slipping it around the
  sphere,'' one can replace it with a shorter geodesic between the same two points that goes around the same great circle on the sphere in the opposite direction.
  
  

This phenomenon does not depend on any details of the sphere.  Consider geodesics that originate at a point $q$ in some Riemannian manifold $M$.  
 Let $qp$
be such a geodesic and suppose   (fig. \ref{Fig14M}) that the $qq'$ part of this geodesic can be deformed slightly to another nearby
geodesic that also connects the two points $q$ and $q'$.  This displaced geodesic automatically has the same length as the first one since geodesics are stationary points of the length function.
 Then the displaced path $qq'p$ has a ``kink'' and
its length can be reduced by rounding out the kink.   So the original geodesic $qp$ was not length minimizing.

 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Drawing.pdf} 
 \end{center}
\caption{\small    This is a new picture of the displaced path $qq'p$ that was introduced in
 fig. \ref{Fig14M}.   Here we emphasize that this path is made of two geodesic segments $qq'$ and $q'p$ that meet
at a ``kink.''    A
small neighborhood of $q'$, containing the nearby points $r$ and $s$, can be approximated by
a portion of flat Euclidean space.   The triangle inequality of Euclidean space says that the portion $rq's$ of $qq'p$ can be shortened by replacing it by a straight line
$rs$, shown as a dashed line.  So ``rounding out the kink''  of $qq'p$ reduces its length. \label{Drawing}}
\end{figure}

The fact that rounding out the kink reduces the length is basically the triangle inequality of Euclidean space, as explained in fig. \ref{Drawing}.  Indeed, a small
neighborhood of the point $q'$ can be approximated by a corresponding neighborhood in Euclidean space, and in Euclidean space, the triangle inequality says that rounding out
a kink reduces the length.    Quantitatively, if the displaced path $qq'p$ ``bends'' by a small
angle $\alpha$ at the point $q$, then rounding out the kink can reduce the length by an amount of order $\alpha^2$.  One can verify this with a little plane geometry, using
the fact that the geometry near the kink  can be embedded in Euclidean space.  Since
$\alpha$ is proportional to the amount by which the $qq'$ segment of the original geodesic $qp$ was displaced, this means that rounding out the kink reduces the length by an amount that is of second
order in the displacement.



It is not important here  that {\it all} geodesics from $q$ are focused to $q'$ (as happens in the case of a sphere).   To ensure that the geodesic
$qq'p$ is not length minimizing, it is sufficient that there is {\it some} direction in which the $qq'$ part can be displaced, not changing its endpoints.
  We do not even need to know that the  geodesic segment $qq'$ can be displaced {\it exactly} as a geodesic.    We only need to know that it can be displaced
while still solving the geodesic equation in first order.     That ensures that the displacement does not change the length function in second order. 
Rounding off the kink in $qq'p$ does reduce the length in second order, so displacing the $qq'$ segment and rounding off the kink will reduce
the length if the displacement caused no increase in second order.   

We will explain this important point in a little more detail.  A geodesic is a curve that extremizes the length between its endpoints, so any displacement of the geodesic segment $qq'$ to a nearby
path from $q$ to $q'$ will not change the length of this segment
in first order.   A displacement that obeys the geodesic equation in first order will leave fixed the length in second order.\footnote{To orient oneself to this
statement, let
 $f(y)$ be a smooth function of a real variable $y$, and suppose an equation $\d f/d y=0$ is satisfied at $y=y_0$.   We expand near $y=y_0$ by $y=y_0+\delta y$.
Since $f'(y_0)=0$, the general form of the expansion is $f(y)=f(y_0)+\frac{1}{2}\delta y^2 f''(y_0)+\O(\delta y^3)$.  But suppose that the equation $f'(y)=0$
is still satisfied at linear order in $\delta y$.   Since $f'(y)=\delta y f''(y_0)+\O(\delta y^2)$, this statement is equivalent to $f''(y_0)=0$, so it implies that
$f(y)$ is independent of $\delta y$ up to  order  $\delta y^3$.  In our application, what plays the role of $y$ is a path $x(s)$ between given points $q$ and $q'$,
and what plays the role of $f$ is the length function $L$ on the space of such paths.  The geodesic equation $\delta L/\delta x(s)=0$ is the analog of $f'(y)=0$.   A first order deformation  $\delta x(s)$ of a geodesic that preserves the geodesic equation $\delta L/\delta x(s)=0$ is the analog of a deformation $y=y_0+\delta y$
that satisfies the equation $f'(y)=0$ to first order in $\delta y$. So such a deformation leaves $L$ fixed in second order in $\delta x(s)$.  First order deformations
of geodesics are discussed in detail (in the null case) in  section \ref{newlook}.  }  
But rounding out the kink reduces the length in second
order, as we have noted. 
So    if a displacement obeys the geodesic equation in first order, then making a small displacement and rounding off the kink
will reduce the length.  All this will have an analog for timelike geodesics in Lorentz signature.



To summarize, if a geodesic segment $qq'$ can be displaced, at least in first order, to a nearby geodesic from $q$ to $q'$, we call the point $q'$ a focal point (or conjugate point).
A geodesic that emanates from $q$ is no longer length minimizing once it is continued past its first focal point.   The absence of a focal point is, however, only a necessary condition for a geodesic
to be length minimizing, not a sufficient one.   For example, on a torus with a flat metric,  geodesics have no focal points no matter how far they are extended.
On the other hand, any two points on the torus can be connected by infinitely many
different (and homotopically inequivalent) geodesics.   Most of those geodesics are not length minimizing.

 \begin{figure}
 \begin{center}
   \includegraphics[width=4in]{Fig15MNew.pdf} 
 \end{center}
\caption{\small This figure illustrates necessary (not sufficient)  conditions for a geodesic $\gamma$ to be the shortest path from a point $q$ to a submanifold $W$. (a) $\gamma$ must be orthogonal
to $W$ at the point $p$ at which they meet, or its length can be reduced by moving $p$ as shown, to make an orthogonal geodesic $\gamma'$.
(b) There must be no focal point along $\gamma$.   Here a point $q'\in\gamma$ is called a focal point if the segment $pq'$ of $\gamma$ can be displaced, at least to first order,
to another geodesic from $W$ to $q'$ that is also orthogonal to $W$.  This is not possible for ``outgoing'' geodesics orthogonal to a convex body in Euclidean
space, but it can occur
in a more general situation, as shown. \label{Fig15M}}
\end{figure}
Often, we are interested in a length minimizing path, not from a point $q$ to a point $p$, but from $q$ to some given set $W$. 
(This will be the situation when we are proving Hawking's singularity theorem.)   The simple case is that $W$ is a submanifold, without boundary.  
 A path
that {\it extremizes} the distance from $q$ to $W$ is now a geodesic that is orthogonal to $W$.   The condition here of orthogonality is familiar from elementary
geometry.   If $\gamma$ is a geodesic from $q$ to a point $p\in W$ but $\gamma$ is not orthogonal to $W$ at $p$, then the length of $\gamma$
can be reduced by moving slightly the endpoint $p$ (fig. \ref{Fig15M}(a)).



Assuming that $\gamma$ is orthogonal to $W$ at $p$, it will be length minimizing (and not just length extremizing) if $q$ is close enough to $W$.
Once again, however, if $q$ is sufficiently far from $W$, it may develop a focal point, and in that case it will no longer be length minimizing.
Now, however, the appropriate definition of a focal point is slightly different (fig. \ref{Fig15M}(b)).   
A geodesic $\gamma$ from $q$ to $W$, meeting $W$ orthogonally at some
point $p\in W$, has a focal point $q'$ if the $q'p$ portion of this geodesic can be displaced -- at least to first order -- to a nearby  geodesic, also connecting $q'$
to $W$ and meeting $W$ orthogonally.   In this situation, just as before, by displacing the $q'W$ portion of $\gamma$ and then rounding
out the resulting ``kink,'' one can find a shorter path from $q$ to $W$.    

  

\subsection{Lorentz Signature Analog}\label{loran}

Now we go over to Lorentz signature.    What we have said has no good analog for {\it spacelike} geodesics. 
A spacelike geodesic in a spacetime of Lorentz signature is never a minimum or a maximum of the length function, since oscillations in spatial
directions tend to increase the length and oscillations in the time direction tend to reduce it.    Two points at spacelike separation can be
separated by an everywhere spacelike path that is arbitrarily short or arbitrarily long.


 \begin{figure}
 \begin{center}
   \includegraphics[width=.5in]{Fig17M.pdf}\caption{\small  This figure is a Lorentz signature analog of fig. \ref{Fig14M}.  (Time runs vertically here and in fig. \ref{Drawing2}.)   A timelike geodesic that originates at a point $q$
    does not maximize the elapsed proper time along its path
   if it contains a focal point $q'$.   For in that case, displacing the $qq'$ segment of the given geodesic and smoothing out the resulting kink will increase the elapsed proper time.    \label{dufo}}\end{center}
\end{figure} 
However, what we have said does have a close analog for {\it timelike} geodesics.      Here we should discuss the elapsed proper time
of a geodesic (not the length) and spatial fluctuations tend to reduce it.    So a sufficiently short segment of any timelike geodesic $\gamma$ {\it maximizes} the elapsed
proper time.\footnote{In any spacetime, this is true at least locally, meaning that if  $q,p\in\gamma$ with $p$ slightly to the future of $q$, then $\gamma$ has a greater proper time than
any nearby causal path from $q$ to $p$.  If $M$ is strongly causal, then the local statement is enough, since causal curves between sufficiently nearby points do not make large excursions.}   But if we continue a timelike geodesic past a focal point, it no longer maximizes the proper time.    

 The appropriate definition of a focal point is the same as before.  
Consider a future-going timelike geodesic that originates at a point $q$ in spacetime (fig. \ref{dufo}).
Such a geodesic is said to have a  focal point at $q'$ if the $qq'$ part of the geodesic can be slightly displaced to another timelike geodesic connecting $q$ to $q'$.
This displacement produces a kink at $q'$, and rounding out the kink will increase the proper time.   
That rounding out the kink increases the proper time is basically the ``twin paradox'' of Special Relativity (fig. \ref{Drawing2}), in the same sense that the analogous statement in Euclidean signature
is the triangle inequality  of Euclidean geometry  (fig. \ref{Drawing}).  


As in the Euclidean signature case and for the same reasons, to ensure that the original geodesic $qp$ does not maximize the proper time, 
it is not important here that the $qq'$ segment of $qp$ can be displaced exactly as a geodesic from $q$ to $q'$.  It is sufficient if this displacement can be made to first order.   

  \begin{figure}
 \begin{center}
   \includegraphics[width=1in]{Drawing2.pdf}\caption{\small The displaced path $qq'p$ of fig. \ref{dufo} has been redrawn in a way that emphasizes
   that the segments $qq'$ and $q'p$ are timelike geodesics.  A small neighborhood of $q'$ containing the points $r$ and $s$ can be approximated by a portion of Minkowski space.
   The ``twin paradox'' of special relativity says that the proper time elapsed 
   along the portion $rq's$ of $qq'p$ is less than the proper time elapsed along the geodesic $rs$, which is shown as a dashed line.  
   (In other words, the twin who takes a trip on the worldline
   $rq's$ comes back younger than the twin who stays home on the worldline $rs$.)
 Thus, the proper time of $qq'p$ can be increased by rounding out the kink, replacing $rq's$ with $rs$. \label{Drawing2}}\end{center}
\end{figure} 
 
 



Here 
are two examples of timelike geodesics that do not maximize the proper time between initial and final points.  The first arises in the motion of the Earth
around the Sun.  Continued over many orbits, this motion is a geodesic that does not maximize the proper time.  One can do better
by launching a spaceship with almost the escape velocity from the Solar System, with the orbit so adjusted that the spaceship
falls back to Earth after a very long time, during which the Earth makes many orbits.  The elapsed proper time is greater for the spaceship than for the Earth
because it is less affected both by the gravitational redshift and by the  Lorentz time dilation.




A second example arises in Anti de Sitter spacetime.\footnote{This example can be omitted on first reading; alternatively, see Appendix \ref{ads} for background.}  Here we may refer back to fig. \ref{Fig1} of section \ref{classic}.   Future-going timelike geodesics from $q$ meet at the focal point $q'$.  These
geodesics fail to be proper time maximizing when continued past $q'$.   For example, the timelike geodesic $qw$ shown in the figure is not proper time
maximizing.  Indeed, there is no upper bound on the proper time of a  causal path from $q$ to $w$, since a timelike path from $q$ that travels very close to the edge of the figure,
lingers there for a while, and then goes on to $w$ can have an arbitrarily large elapsed proper time.

The absence of a focal point is only a necessary condition for a timelike geodesic $\ell$ from $q$ to $p$ to maximize the proper time, not a sufficient condition.
The presence of a focal point means that $\ell$ can be slightly deformed to a timelike path with greater elapsed proper time.  But even if this is not possible, there might be another
timelike path from $q$ to $p$, not a small deformation of $\ell$, with greater proper time.  Apart from examples we have already given, this  point can be illustrated using the cylindrical spacetime of eqn. (\ref{zorfo}).   This spacetime is flat,
and the timelike geodesics in it do not have focal points, no matter how far they are continued.   If the point $p$ is sufficiently far to the future of $q$, then there are multiple timelike geodesics
from $q$ to $p$, differing by how many times they wind around the cylinder en route from $q$ to $p$.   These timelike geodesics have different values of the elapsed proper time,
so most of them are not proper time maximizing, even though they have no focal point.

 \begin{figure}
 \begin{center}
   \includegraphics[width=4in]{Fig19M.pdf}\caption{\small   This is a Lorentz signature analog of fig. \ref{Fig15M}, showing necessary conditions in order for a timelike geodesic
   $\gamma$ from a point $q$ to a spacelike hypersurface $S$ to maximize the elapsed proper time.  (a)  $\gamma$ must be orthogonal to $S$ at the point $p$ at which they meet, or else the
   proper time could be increased by moving $p$ along $S$ in the appropriate direction, to $p'$ as shown. (b)  And $\gamma$ must contain no focal point $q'$.   Here $q'$ is a focal point if the $q'p$ segment of
   $\gamma$ can be displaced (at least in first order) 
   to a nearby timelike geodesic $q'p'$, also orthogonal to $S$.    In that case, by rounding out the kink of the composite path $qq'p'$, one would get a timelike
   path from $q$ to $S$ with a proper time greater than that of $qp$.   Thus, in the picture, $q'$ is a focal point on the geodesic $qp$ if $q'p'$ is a geodesic
    orthogonal to $S$ at $p'$.   \label{lufo}}\end{center}
\end{figure} 

We can also consider a causal path $\gamma$ from a point $q$ to a spacelike submanifold $S$ in its future.   To maximize the elapsed proper time, $\gamma$ must satisfy conditions that parallel
what we found in the Euclidean case (fig. \ref{lufo}).  First, $\gamma$ must be a timelike geodesic from $q$ to $S$.  Second, $\gamma$ must be orthogonal to $S$ at the point $p$ at which it meets $S$.
Third, there must be no focal point $q'$ on $\gamma$.   $q'$ is a focal point if the $q'p$ segment of $\gamma$ can be slightly displaced to a nearby timelike geodesic, also connecting
$q'$ to $S$ and orthogonal to $S$.  

\subsection{Raychaudhuri's Equation}\label{rayeq}

To prove a singularity theorem, we need a good way to predict the occurrence of focal points on timelike geodesics.   Such a method is provided
by Raychaudhuri's equation.  (In fact, what is relevant here is Raychaudhuri's original timelike equation \cite{Raychaudhuri}, not the slightly more
subtle null version that was described later by Sachs  \cite{sachs} and that we will discuss in due course.)   Raychaudhuri's equation shows
that focal points are easy to come by, roughly because gravity tends to focus nearby geodesics.  

In $\D=d+1$ dimensions, we consider a spacetime $M$ with an initial value surface $S$ with local coordinates $\vec x= (x^1,\cdots, x^{d})$.   By looking at timelike geodesics
orthogonal to $S$, we can construct a coordinate system in a neighborhood of $S$.   If a point $p$ is on a timelike 
geodesic that meets $S$ orthogonally at $\vec x$, and the proper time from $S$ to $p$ (measured along the geodesic) is $t$,
then we assign to $p$ the coordinates $t,\vec x$ if $p$ is to the future of $S$, or $-t,\vec x$ if it is to the past.

In this coordinate system, the line element of $M$ is
\be\label{zolbo}\ds^2=-\d t^2+g_{ij}(t,\vec x) \d x^i\d x^j. \ee   
We can verify this as follows.  First of all, in this coordinate system, $g_{tt}=-1$, since $t$ was defined to 
measure the proper time along any path with constant $x^i$.  Further,  the geodesic equation can be written
\be\label{polbo}0=\frac{D^2 x^\mu}{D\tau^2}=\frac{\d^2 x^\mu}{\d\tau^2}+\Gamma^{\mu}_{\alpha\beta}\frac{\d x^\alpha}{\d\tau}\frac{\d x^\beta}{\d\tau}. \ee
In our coordinate system, this equation is supposed to have a solution with $t=\tau$, and with the $x^i$ equal to arbitrary constants.   For that to be so, we
need $\Gamma^\mu_{tt}=0$ for all $\mu$.  From this, it follows that $\partial_t g_{t i}=0$.   But $g_{ti}$ vanishes at $t=0$ (since the coordinate system is
constructed using geodesics that are orthogonal to $S$ at $t=0$) so $g_{ti}=0$ for all $t$.  

 
Thus the coordinate system constructed using the orthogonal geodesics  could be obtained  by merely asking for coordinates in which
the metric tensor satisfies $g_{tt}=-1$, $g_{ti}=0$.
The advantage of the more geometric language of orthogonal geodesics is that this will help us understand how the coordinate
system can break down.  The conclusions we draw will be manifestly independent of the local coordinate system on $S$, which was chosen for convenience.

 \begin{figure}
 \begin{center}
   \includegraphics[width=1.8in]{Fig29M.pdf}\caption{\small   If orthogonal geodesics from a spacelike hypersurface $S$ are focused at a point $p$ to the future of $S$, then the coordinate
   system based on the orthogonal geodesics will break down at $p$.  \label{Fig29M}}\end{center}
\end{figure}

Even if $M$ remains nonsingular, our coordinate system breaks down if orthogonal geodesics that originate at different points on $S$ meet at the same point $p\in M$.
For in this case, we do not know what $\vec x$ value to assign to $p$.   A related statement is that the coordinate system breaks down at focal points.  For if orthogonal geodesics
from nearby starting points converge at $p$ (fig. \ref{Fig29M}), then the starting points of the orthogonal geodesics will not be part of a good coordinate system near $p$.

Since $g_{ij}(t,\vec x)$ measures the distance between nearby orthogonal geodesics, a sufficient criterion for a focal point is
\be\label{holbo}\det\,g_{ij}(t,\vec x)=0.\ee
This condition is actually necessary as well as sufficient.
That is not immediately obvious, since 
it might appear that  if one eigenvalue of $g_{ij}(t,\vec x)$ goes to 0 and one to $\infty$, then $\det g_{ij}(t,\vec x)$ could remain fixed while
a focal point develops.    However, as long as $M$ remains smooth, the point in $M$ that a geodesic that is  
orthogonal to $S$ at a point $q\in S$ reaches after a proper time $t$ is a smooth function of $t$
and $q$.  Hence matrix elements and  eigenvalues of $g_{ij}(t,\vec x)$ never diverge except at a singularity of 
$M$, and so (with $M$ being smooth)   the determinant of $g_{ij}(t,\vec x)$ vanishes if and only if one
of its eigenvalues vanishes.

 Raychaudhuri's equation gives a useful criterion for predicting that $\det g_{ij}$ will go to 0 within a known time.   In general, 
 this will represent only a breakdown of the coordinate
system, not a true spacetime singularity, but we will see that the criterion provided by Raychaudhuri's equation is a 
useful starting point for predicting spacetime singularities.

Raychaudhuri's equation is just the Einstein equation
\be\label{raych} R_{tt}=8\pi G\left(T_{tt}-\frac{1}{\D-2}g_{tt}T^\alpha_\alpha\right)\ee
in the coordinate system defined by the orthogonal geodesics. 
A straightforward computation in the metric (\ref{zolbo}) shows that 
\begin{align}\label{wobbo} R_{tt} & = -\partial_t \Gamma^i_{ti}-\Gamma^i_{tj}\Gamma^j_{ti} =
-\frac{1}{2}\partial_t(g^{ik}\partial_t g_{ik})-\frac{1}{4}\left(g^{ik}\partial_t g_{kj}\right)\left(g^{jm}\partial_t g_{mi}\right)\cr
&=-\frac{1}{2}\partial_t \Tr \,g^{-1} \dot g -\frac{1}{4} \Tr (g^{-1}\dot g)^2,
\end{align}
where the dot represents a derivative with respect to $t$.


It is convenient to define
\be\label{naych} V=\sqrt {\det g} \ee
which measures the volume occupied by a little bundle of geodesics.    The quantity 
\be\label{aych}\theta= \frac{\dot V}{V}=\frac{1}{2}\Tr\, g^{-1} \dot g\ee
 is called the expansion. 

It is convenient to also define the traceless part of $g^{-1}\dot g$ (the ``shear'')
\be\label{shear}\sigma^i_j=\frac{1}{2}\left(g^{ik}\dot g_{kj}-\frac{1}{d}\delta^i_j\Tr \,g^{-1}\dot g\right),\ee
where the factor of $1/2$ is conventional. So
\be\label{rzero}R_{tt}=-\partial_t \left(\frac{\dot V}{V}\right)-\frac{1}{d}\left(\frac{\dot V}{V}\right)^2 -\Tr\, \sigma^2= -\dot\theta-\frac{\theta^2}{d}-\Tr\,\sigma^2 .\ee
If we define
\be\label{strest}\h T_{\mu\nu}=T_{\mu\nu}-\frac{1}{\D-2}g_{\mu\nu}T^\alpha_\alpha,\ee
then the Einstein-Raychaudhuri equation $R_{tt}=8\pi G\h T_{tt}$ becomes
\be\label{ER}\partial_t\left(\frac{\dot V}{V}\right)+\frac{1}{d} \left(\frac{\dot V}{V}\right)^2 =-\Tr\,\sigma^2 -8\pi G\h T_{tt}.\ee

The {\it strong energy condition} is the statement that
\be\label{minxo}\h T_{tt}\geq 0\ee
at every point and in every local Lorentz frame.    It is satisfied by the usual equations of state of ordinary radiation and matter.
It is also satisfied by a negative cosmological constant.  The outstanding example that does {\it not} satisfy the strong energy condition is a positive cosmological constant.\footnote{More generally, in a  theory -- such as the Standard Model of particle physics  -- with an elementary scalar field $\phi$ and a potential energy
function $U(\phi)$, the strong energy condition
is violated unless  $U(\phi)$ is negative-definite (this is not true in the Standard Model even if we assume the cosmological constant to vanish).}    If we assume the
strong energy condition, then all the terms on the right hand side of the Einstein-Raychaudhuri equation are negative and so we get an inequality
\be\label{yeg}\partial_t\left(\frac{\dot V}{V}\right)+\frac{1}{d} \left(\frac{\dot V}{V}\right)^2\leq 0.\ee
Equivalently,
\be\label{zeg}\partial_t\left(\frac{1}{\theta}\right)= \partial_t\left( \frac{1}{\dot V/V}\right)\geq \frac{1}{d}.\ee

Now we can get a useful condition for the occurrence of focal points.  Let us go back to our initial value surface $S$ 
and assume that
$\theta<0$ at some point on this surface, say $\theta=-w$, $w>0$.      So the initial value of $1/\theta$ is $-1/w$ and
the lower bound on $\partial_t(1/\theta)$ implies that $1/\theta\geq -1/w+t/d$ or
\be\label{pleg} \frac{\dot V}{V}\leq-\left(\frac{1}{w}-\frac{t}{d}\right)^{-1}. \ee
Since $\dot V/V={\d}\log V/\d t$, we can integrate this to get
\be\label{mleg} \log V(t)-\log V(0)\leq   {d}\bigl(\log (1/w -t/d)-\log (1/w)\bigr), \ee
showing that $\log V(t)\to -\infty$ and thus $V(t)\to 0$ at a time no later than $t=d/w$.

For $V(t)$ to vanish signifies a focal point, or possibly a spacetime singularity.   So (assuming the strong energy condition) 
an  orthogonal geodesic that departs from $S$ at $t=0$ at a point at which $\theta=-w<0$
will reach a focal point, or possibly a singularity, after a proper time $t\leq d/w$.   



In many situations the vanishing of $V$ predicted by the Raychaudhuri equation represents only a focal point, a breakdown of the coordinate
system, and not a spacetime singularity.
The following example may help make this obvious.   For $M$, take Minkowski space, which certainly has no singularity.   For an initial value surface $S\subset M$, consider first
the flat hypersurface $t=0$.  For this hypersurface, $\theta$ vanishes identically, and the orthogonal geodesics are simply lines of constant $\vec x$; they do not meet at focal points.
    Now perturb $S$ slightly to $t=\varepsilon f(\vec x)$ for some
function  $f(\vec x)$ and small real  $\varepsilon$.  
The reader should be able to see that in this case,
 $\theta$ is not identically zero, and the orthogonal geodesics will reach focal points, as predicted by the Raychaudhuri equation.   In general, these focal points occur
 to the past or future of $S$, depending on which way $S$ ``bends'' in a given region.
 Clearly these focal points have nothing to do with a spacetime singularity.

Thus, to predict a spacetime singularity requires a more precise argument, with some input beyond Raychaudhuri's equation.


\subsection{Hawking's Big Bang Singularity Theorem}\label{hbb}

In proving a singularity theorem,
Hawking assumed that the universe is globally hyperbolic with Cauchy hypersurface $\S$.
  He also assumed the strong energy condition, in effect assuming that the stress tensor is  made of ordinary matter and radiation.   (The inflationary universe, which gives
a way to avoid Hawking's conclusion because a positive cosmological constant does not satisfy the strong energy condition, was still in the future.)
 If the universe is perfectly homogeneous and isotropic, it is described by the Friedmann-Lema\^itre-Robertson-Walker (FLRW)  solution and emerged
from the Big Bang at a calculable time in the past. 

Suppose, however, more realistically, that the universe is not perfectly homogeneous
but that the local Hubble parameter is everywhere positive.  Did such a universe emerge from a Big Bang?   One could imagine that following the Einstein
equations back in time, the inhomogeneities become more severe, the FLRW solution is not a good approximation, and part or most (or maybe even all)
of the universe did not really come from an initial singularity.

Hawking, however, proved that assuming the strong energy condition and assuming that the universe is globally hyperbolic (and of course assuming the classical
Einstein equations), this is not the case. 
 To be more exact, he showed that if the local Hubble parameter
has a positive minimum value $h_\min$ on an initial value surface $\S$,
then there is no point in spacetime that is a proper time more than $1/h_\min$ to the past of $\S$, along any causal path.


Here we should explain precisely what is meant by the local Hubble parameter.   For a homogeneous isotropic expansion such as
the familiar FLRW cosmological model 
\be\label{incob}\ds^2=-\d t^2+a^2(t) \d \vec x^2 ,\ee where for simplicity we ignore the curvature of the spatial sections,
 one usually defines
the Hubble parameter by $h=\dot a/a$.     We can view the line element (\ref{incob}) as a special case of eqn. (\ref{zolbo}),
and from that point of view, we have  $h=\dot V/dV$ (since $V=\sqrt {\det g} $ is the same as $a^{d}$ in the homogeneous isotropic case).  We will
use that definition in general, so the assumption on the Hubble
parameter is that in the coordinate system of eqn. (\ref{zolbo}), $\dot V/V\geq dh_\min$, assuming time is measured towards the future.   But we will measure time towards the past and so instead we write
the assumption as
\be\label{mumwot}\frac{\dot V}{V}\leq-d h_\min.\ee

Hawking's proof consists of comparing two statements.   (1)  Since the universe is globally hyperbolic, every point $p$ is connected to $\S$ by a causal path of maximal
proper time, as explained in section \ref{cpct}.
 As we know from the discussion of fig. \ref{lufo}, such a path is a timelike geodesic without focal points that is orthogonal to $\S$.
(2) But the assumption that the initial value of $\dot V/V$ on the surface $\S$ is everywhere $\leq -dh_\min$ implies that any past-going timelike geodesic
orthogonal to $\S$ develops a focal point within a proper time at most $1/h_\min$.

  Combining the two statements, we see that there is no point in spacetime that is to the past of $\S$ by a proper time more than $1/h_\min$, along any causal path.
 Thus (given Hawking's assumptions) the minimum value of the 
local Hubble parameter gives an upper bound on how long anything in the universe could
have existed in the past.  This is Hawking's theorem about the Big Bang.

An alternative statement of Hawking's theorem is that no timelike geodesic $\gamma$ from $\S$ can be continued into the past for a proper time greater than $1/h_\min$.    Otherwise, there would be a point
$p\in \gamma$ that is to the past of $\S$ by a proper time measured along $\gamma$
that is greater than $1/h_\min$, contradicting what was just proved.     

In Euclidean signature, a Riemannian manifold is said to be geodesically complete if all geodesics can be continued up to an arbitrarily large
distance in both directions.   In Lorentz signature, there are separate notions of completeness for timelike, spacelike, or null geodesics, which say that any timelike, spacelike, or null
geodesic can be continued in both directions,  up to arbitrarily large values of the proper time, the distance, or the affine parameter, respectively.    Hawking's theorem
shows  that a Big Bang spacetime that satisfies certain hypotheses is timelike geodesically incomplete, in a very strong sense: {\it no} timelike geodesic from $\S$ can be continued
into the past for more than a bounded proper time.   (Penrose's theorem, which we explore in section \ref{penroseproof}, gives a much weaker statement of null geodesic incompleteness:
under certain conditions,  not all null geodesics can be continued indefinitely.)

Although Hawking's theorem is generally regarded as a statement about the Big Bang singularity, singularities are not directly involved in the statement or proof of the theorem.
 In fact, to the present day, one has only a limited understanding of the implications of Einstein's equations
concerning singularities.  In the classic singularity theorems, going back to Penrose \cite{Penrosesing}, only the
 smooth part of  spacetime is studied, or to put it differently, ``spacetime'' is taken to be, by definition,
a manifold with a smooth metric of Lorentz signature (this is the definition that we started with in footnote \ref{recall} of section \ref{classic}).  Then
``singularity theorems'' are really statements about  geodesic incompleteness of  spacetime.   In the case of Hawking's theorem, one may surmise that the reason that the past-going
timelike geodesics from $\S$ cannot be continued indefinitely is that they terminate on singularities, as in the simple FLRW model, but this goes beyond what is proved.   When we come to 
Penrose's theorem, we will explore this point in more detail.










\section{Null Geodesics and Penrose's Theorem}\label{ng}

\subsection{Promptness}\label{prompt}

Hopefully, our study of timelike geodesics in section \ref{geofocal} was enough fun that the reader is eager for an analogous study of null geodesics.  In this section,
we explain the properties of null geodesics that are needed for applications such as Penrose's theorem and an understanding of black holes.   Some important points are  explained
only informally in this section and are  revisited more precisely in section \ref{newlook}.   A converse of some statements is explained in Appendix \ref{failure}.
 
Causal paths and in particular null geodesics will be assumed to be future-going unless otherwise specified.   Of course, similar statements
apply to past-going causal paths, with the roles of the future and the past exchanged. 

 
 \begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig20M.pdf}\caption{\small     In the diagram, time runs vertically, so $r$ is to the past of $p$.
    A causal path $\gamma$ from $q$ to $p$ is ``prompt'' if there does not exist
   any causal path $\gamma'$ from $q$ to a point such as $r$ that is to the past of $p$.
      \label{Fig20M}}\end{center}
\end{figure} 
 
 Any null geodesic has zero elapsed proper time.  Nevertheless, there is a good notion that has  properties somewhat similar to ``maximal elapsed proper time'' for timelike paths.
  We will say that a  causal
path from $q$ to $p$ is ``prompt'' if  no causal path from $q$ to $p$   arrives sooner.    To be precise, the path $\ell$ from $q$ to $p$
is prompt if  there is  no  causal path $\ell'$ from $q$ to a point $r$ near $p$ and just to its past (fig. \ref{Fig20M}).     

A prompt causal path from $q$ to $p$ only exists if it is just barely possible to reach $p$ from $q$ by a causal path.  
  To formalize this, we write $J^+(q)$ for the causal future
of $q$, consisting of all points that can be reached from $q$ by a future-going causal path,  and $\partial J^+(q)$ for its boundary.
  If $p$ can be reached from $q$ by a prompt causal path $\ell$, then $p\in J^+(q)$
(because $\ell$ is causal), and $p\in \partial J^+(q)$ (because points slightly to the past of $p$ are not in $J^+(q)$). Thus, almost
by definition, a prompt causal path from $q$ to $p$ can only exist if $p\in\partial J^+(q)$.  

 \begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig21M.pdf}\caption{\small   If $q$ is a point in Minkowski space, then the causal future $J^+(q)$ of $q$ consists of all
   points in or on the future light cone of $q$.   Its boundary $\partial J^+(q)$ consists of the points on the future light cone.   We consider
   $q$ itself to be contained in $J^+(q)$ and in $\partial J^+(q)$.  \label{Fig21M}}\end{center}
\end{figure} 
 For example, if $q$ is a point in Minkowski space, then $J^+(q)$ consists of points inside or on the future light cone (fig. \ref{Fig21M}); $\partial J^+(q)$ consists of the future light cone itself.
 Every point $p\in \partial J^+(q)$ is connected to $q$ by a null geodesic, and this null geodesic is a prompt causal path.
 
 
 
In a spacetime that obeys a suitable causality condition, a short enough segment of a null geodesic  is always prompt as a path between its endpoints, just
as in Minkowski space.  This statement does require a causality condition, because it is untrue in a spacetime with closed timelike curves, as the reader can verify.
At the end of this section, we will show that strong causality is enough.  If
continued far enough, a null geodesic may become non-prompt because of gravitational lensing.    For example, when we see multiple images of the
same supernova explosion, the images do not arrive at the same time and clearly the ones that do not arrive first are not prompt.

The prompt part of a null geodesic is always an initial segment, since if a null geodesic is continued until it becomes nonprompt, continuing it farther does not make it prompt again. 
 To see this, suppose that a future-going null geodesic $\gamma$ from $q$ to $p$  is continued
farther in the future until it reaches a point $r$.  Suppose that $\gamma$ is not prompt as a path from $q$ to $p$, meaning that there is a causal curve $\gamma'$ from $q$
that arrives at a point $p'$ just to the past of $p$ (fig. \ref{46M}(a)).    Then continuing $\gamma'$ into the future, always close to $\gamma$ and slightly in its past, we get a causal curve from $q$
to a point $r'$ that is just to the past of $r$, showing that $\gamma$ is not prompt as a path from $q$ to $r$ (fig. \ref{46M}(b)).    Note that a very small neighborhood of a single geodesic, such as $\gamma$, can be embedded
   to good approximation in Minkowski space, so one can visualize the relation between $\gamma$ and $\gamma'$  in the region between $p$ and $r$
   as the relation between a lightlike straight line in Minkowski space and a causal
   path (possibly close to a parallel lightlike line) that is slightly to its past.  



\begin{figure}
 \begin{center}
   \includegraphics[width=3.8in]{Fig46M.pdf}\caption{\small  (a) The null geodesic $\gamma$ is not a prompt path from $q$ to $p$, since $\gamma'$ is a causal path from $q$
   that arrives at the point $p'$ that is slightly to the past of $p$.   (b)     When continued on to a later point $r$, $\gamma$ is not prompt as a path from $q$ to $r$, because $\gamma'$
   can likewise be continued past $p'$ to a point $r'$ that is just to the past of $r$.    \label{46M}}\end{center}
\end{figure} 

Prompt causal paths have very special properties that ultimately make them good analogs of proper time maximizing timelike paths.
A causal path $\ell$ from $q$ to $r$  whose tangent vector is somewhere timelike
(rather than null) cannot be prompt, because by modifying $\ell$ slightly to be everywhere null, we could find a causal path  from $q$ that is slightly to the
past of $\ell$.   
Actually, to be prompt, $\ell$
has to be a null geodesic, since if it ``bends'' anywhere, one could take a shortcut by straightening out the bend (in some small region that can be approximated by Minkowski space)
and again replace $\ell$ with a causal path from $q$ that is slightly to its past.    In Minkowski space, these statements amount to the assertion that to get somewhere as quickly as possible,
one should travel in a straight line at the speed of light.   They are true in general because a sufficiently small portion of any spacetime can be approximated by Minkowski space.  If $\ell$
fails to be a null geodesic at a point $p\in \ell$, then, in a local Minkowski neighborhood of $p$, one can replace $\ell$ with a causal path
$\ell'$ that agrees with $\ell$ almost up to $p$ and thereafter is slightly to its past.  No matter what $\ell$ does to the future of $p$, one then continues $\ell'$ in a similar way, keeping always slightly to the
past of $\ell$.   The relation between $\ell'$ and $\ell$ in the region beyond $p$ is similar to the relation between $\gamma'$ and $\gamma$ in fig. \ref{46M}(b).



We conclude this section by showing that in a strongly causal spacetime $M$, every null geodesic has an initial segment that is prompt.  
Let $\gamma$ be a future-going null geodesic that originates at a point $q$.   If a point $p$ that is to the future of $q$  along $\gamma$ has the property that
$\gamma$ is the only causal path from $q$ to $p$, then the $qp$ segment of $\gamma$ is prompt.
The alternative -- that points on $\gamma$ arbitrarily close to $q$ can be reached from $q$
by some causal path other than $\gamma$ -- is not possible in a strongly causal spacetime.  To see this, 
observe that $q$ has a local Minkowski neighborhood  $U$ that can be well approximated by the interior of a causal diamond in Minkowski space.
This implies that   any null geodesic $qp\subset U$ is prompt among paths in $U$, and in fact it is the only causal path in $U$ from $q$ to $p$.
This much does not require strong causality.   If $M$ is strongly causal, then $q$ has a possibly smaller neighborhood $V\subset U$
with the property that  any causal path in $M$ between two points in $V$ is entirely contained in $V$.
Taking these statements together, we see that if $p\in V$,  a null geodesic segment from $q$ to $p$ is entirely contained in $V\subset U$ and so is prompt.   So if $\ell$ is any
future-going null geodesic from $q$, the initial segment of $\ell$ that lies in $V$ is prompt.



An analogous question for timelike geodesics is the following.
If $\gamma$ is a timelike geodesic, does a small initial segment of $\gamma$ maximize the proper time between its endpoints?   We leave it to the reader to verify that this
statement  is false in a spacetime with closed timelike curves, and  true in a strongly causal spacetime.


\subsection{Promptness And Focal Points}\label{pfp}

 \begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig22M.pdf}\caption{\small   Depicted is a null geodesic segment $qp$.   The point $q'$ is called a focal point of the null geodesics that
   originate at $q$ if the $qq'$ segment of $qp$ can be displaced, at least to first order, to a nearby null geodesic from $q$ to $q'$.   If it contains such a focal point, then the original
   geodesic $qp$ is not prompt.  \label{Fig22M}}\end{center}
\end{figure} 



To be prompt, a null geodesic $\ell$ from $q$ to $p$ must contain no focal point.\footnote{For a detailed explanation of the following based on
formulas rather than pictures,  see section \ref{newlook}.}   Here $q'$ is a focal point if (at least in first order, as discussed shortly)
the $qq'$ segment of the geodesic $\ell=qp$ can be displaced to a nearby null geodesic
from $q$ to $q'$ (fig. \ref{Fig22M}).    If so, then by slightly displacing the $qq'$ segment of $\ell$, one gets a causal path from $q$ to $p$ that is not a null geodesic,
as it has a ``kink'' at $q'$.  Not being a null geodesic, this causal path is not prompt, as we learned in section \ref{prompt}, and can be slightly modified 
to make a causal path from $q$ that arrives slightly to the past of $p$.
In fig. \ref{Drawing3}, we zoom in on the kink $q'$ in the deformed path $qq'p$ and describe this modification concretely.   The details of fig. \ref{Drawing3} are a little different from the analogous
fig. \ref{Drawing} for geodesics in Euclidean signature or fig.  \ref{Drawing2} for timelike geodesics in Lorentz signature; one has to modify the deformed path $qq'p$ not just
near the kink but in a way that continues  to the future.   This is a consequence of the fact that null geodesics do
not minimize or maximize an integral such as  length or proper time; promptness is a more global notion that depends by definition on when the signal arrives.


Just as in the analogous discussion of timelike or Euclidean signature geodesics, it is not necessary here that the null geodesic segment $qq'$ can be displaced {\it exactly} to a nearby null geodesic connecting the same two points.
It suffices if the $qq'$ segment can be displaced in a way that  satisfies the null geodesic condition in first order. A thorough explanation of this point can be found in section \ref{newlook}.
The rough idea is that the amount by which the displaced path $qq'p$ can be made more
prompt by changing the behavior near and beyond the kink is of second order in the displacement, while if the displacement satisfies the geodesic equation in first order, then the fact that it does not
satisfy that equation exactly has no effect in second order.    


 \begin{figure}
 \begin{center}
   \includegraphics[width=1.5in]{Drawing3.pdf}\caption{\small  Here $rq's$ is a neighborhood of the ``kink''  $q'$ in the displaced path $qq'p$ of fig. \ref{Fig22M}.     
   The picture is an analog of fig \ref{Drawing2}, which depicted a similar situation for timelike geodesics,  but in this null case, we only show a local Minkowski  
   neighborhood of the kink.    Thus we think of $rq'$ and $q's$ as noncollinear null geodesics in Minkowski space (represented in the picture by
    straight lines at  $\pi/4$ angles to the vertical;
   in fact, by a Lorentz transformation, two noncollinear null straight lines in Minkowski space can be made ``back to back,'' as drawn here).
  By replacing the null geodesic segment
   $q's$ with the null geodesic segment  $q''s'$ (the dashed line), which is parallel to $q's$ but to its past, one can replace $rq's$ with a more 
   prompt causal path $rq''s'$.   Then no matter what the path
   $q's$ does when continued into the future, one continues $q''s'$ into the future to be parallel to it and just to its past, as in fig. \ref{46M}(b).   
   The result is to replace the original displaced path $qq'p$
   with a causal path that is more prompt.
    \label{Drawing3}}\end{center}
\end{figure} 

We can illustrate focal points of null geodesics and their consequences
 by promoting to Lorentz signature an example that we discussed in the Euclidean case in section \ref{riemann}.   Let $M=\R\times S^2$ with the obvious
line element
\be\label{mocc}\ds^2=-\d t^2+R^2\d\Omega^2,\ee
where $\R$ is parametrized by the time $t$, and $R^2\d\Omega^2$ is the line element of a sphere of radius $R$.  A null geodesic in this spacetime is simply 
a Riemannian geodesic on $S^2$
with its arclength parametrized by $t$.  As discussed in section \ref{riemann}, in the Euclidean case, a geodesic on $S^2$ reaches a focal point 
when it has traveled half way around the sphere; once continued past that point it is not length minimizing,
since a geodesic that goes around the sphere in the opposite direction would be shorter.
Likewise a null geodesic on $\R\times S^2$ reaches a focal point when it has traveled half way around the sphere; 
when continued past that point, it is no longer prompt, as one could arrive
at the same destination sooner by traveling around the sphere in the opposite direction.

A remark about timelike geodesics that we made in section \ref{loran} has an analog here.   For a null geodesic $\ell$ from $q$ to $p$ to be prompt, it is necessary but
not sufficient for there to be no focal point in the segment $qp$.  Existence of a focal point implies that $\ell$ can be slightly deformed to a nearby causal path from $q$ to
 a point $p'$ slightly to the past of $p$.
But even if there is no focal point, there may anyway be some causal path $\gamma$ from $q$ to $p'$
  that is not a slight deformation of $\ell$.  
  
   \begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig23M.pdf}\caption{\small   
    Here $\ell$ is a null geodesic between two points $q$ and $p$. $\ell$ is is not achronal, because its segment $rr'$ can be replaced by a timelike
   path $\gamma$ between the same two points.   Accordingly, the $rr'$ segment of $\ell$ can be replaced with a causal path from $r$ that arrives
   strictly to the past of $r'$, and this can be continued into the future in a way that remains always to the past of $\ell$.   Thus when continued past $r'$, $\ell$ is not prompt.  For later 
   reference, $\ell$ is similarly not prompt on any interval strictly larger than $rr'$ if  $\gamma$  is assumed to be (rather than a timelike path) a null geodesic from $r$ to $r'$ , distinct from the $rr'$ segment of $\ell$.   \label{Fig23M}}\end{center}
\end{figure} 
  
  If such a $\gamma$ exists -- implying that $\ell$ is not prompt -- then $\ell$ is not achronal.
To see this, suppose a causal path $\gamma$ from $q$ to $p'$ exists and let  $\lambda$ be a timelike path from $p'$ to $p$.   Then $\gamma * \lambda$ is a causal path from $q$ to $p$ that is not everywhere
null.  It  can
  be deformed to a strictly timelike path from $q$ to $p$, showing that $\ell$ is not achronal.
   Conversely, if $\ell$ is not achronal, then it is not prompt.   Indeed, if $\ell$ is not achronal, this means by definition that there is  a timelike path $\gamma$ between two points $r,r'$ in the geodesic $\ell=qp$ (fig. \ref{Fig23M}).   Replacing the $rr'$ segment of $\ell$ with $\gamma$, we get a causal path from $q$ to $p$ that is not a null geodesic.    As usual, this can be deformed to a causal path from $q$
   to a point $p'$ slightly to the past of $p$, showing that $\ell$ is not prompt.  
    To summarize this, a null geodesic $\ell$ from $q$ to $p$ is prompt if and only if it is achronal.

\begin{figure}
 \begin{center}
   \includegraphics[width=4.3in]{Fig24MNew.pdf}\caption{\small  (a) $\ell$ is a null geodesic from a spacelike submanifold $W$ to a point $p\in M$.  For $\ell$ to be prompt, it must be orthogonal
   to $W$ at the point $q$ at which it departs $W$.   Otherwise, by moving $q$ slightly ``towards'' $p$, one can replace $\ell$ with another causal curve to $p$ that gets
   a ``head start'' and arrives in the past of $p$.
   (The picture can be understood to depict
    a slice of Minkowski four-space at time $t=0$.  $W$ is a two-sphere embedded at $t=0$,
   and the null geodesic $\ell$ has been projected to the $t=0$ slice.   Note that if $\ell$ is othogonal to $W$ in four dimensions, then its projection to three dimensions is also orthogonal to $W$,
   as drawn.)   (b) Even if orthogonal to $W$, $\ell$ is nonetheless not
   prompt if a segment $qq'$ of $\ell$ can be displaced to a nearby null geodesic, meeting $W$ orthogonally at some other point $r$.  This displacement
   gives a causal path from $W$ to $p$ that is not a null geodesic, so it can be modified to a causal path that is more prompt.   In this situation, we say that the point $q'$ is
   a focal point of the orthogonal null geodesics from $W$.  This situation does not arise in Minkowski space  if $W$ is a round sphere supported at $t=0$ and the
   geodesic $\ell$ is ``outgoing,''  but it can arise for a more
   general choice of $W$, as shown, or for a round sphere embedded in a more general spacetime, or for ``incoming'' geodesics from a round sphere in Minkowski
   space.  \label{Fig24M}}\end{center}
\end{figure} 



So far we have discussed prompt causal paths between two points.   
More generally, if $W$ is any set in spacetime, we say that a future-going causal path from $W$ to $p$ is prompt if it arrives as soon as possible, in the sense that no causal path from $W$ arrives
 to the past of $p$.   To be prompt, a causal path $\ell$ from $W$ to $p$ has
to be an achronal  null geodesic, just as before.    If $W$ is a spacelike submanifold of spacetime, then in addition $\ell$ has to be orthogonal to $W$ at the point $q$
at which they meet, as depicted in fig. \ref{Fig24M}(a).
   Otherwise, by changing the initial point of $\ell$ a little, one can get a causal path from $W$to $p$ that is not everywhere
null and hence can be deformed to arrive a little sooner.

Orthogonality between a spacelike submanifold $W$ and a null curve that intersects it is only possible if $W$ has real codimension at least 2.
This is a basic although elementary fact about Lorentz signature geometry.   For example, in Minkowski space with line element $\d s^2=-\d t^2+\sum_{i=1}^{\D-1}
(\d x^i)^2$, a codimension 1 spacelike hypersurface  through the origin can be modeled locally, in some Lorentz frame, by the equation $t=0$.   This hypersurface is
orthogonal to the timelike vector $(1,0,0,\cdots,0)$, but not to any null vector.  Since the question really only involves linear algebra, this example
is completely representative.    By contrast, consider the codimension 2 spacelike hypersurface $W$
defined by $t=x^1=0$.    It is orthogonal to the null vectors $u_\pm=(1,\pm 1,0,\cdots,0)$, with either choice of sign.  
These vectors  are both future-directed.   Thus, in the important case that $W$ has codimension 2, there are at each
point in $W$ two different future-directed orthogonal null directions.
 For higher codimension, the condition of orthogonality
to a null vector becomes  less restrictive.


As usual, there is a further condition for promptness that involves focal points.  If $\ell$ is an orthogonal null geodesic from $W$ to $p$, then to be prompt, 
$\ell$ must  have no focal point, where now $q'$ is a focal point if the segment of $\ell$ that connects $W$ to $q'$
can be displaced slightly to a nearby null geodesic, also connecting $W$ to $q'$ and orthogonal to $W$ (fig. \ref{Fig24M}(b)).
The reasoning is analogous to that in previous examples; after making such a displacement and then modifying the path near and beyond the resulting
kink (rather as in fig. \ref{Drawing3}), one gets a causal path from $W$
that arrives strictly to the past of $p$.

Suppose now that a codimension 2 closed spacelike submanifold $W$ is the boundary of a codimension one spacelike submanifold $Z$.  (For example, $W$ might be a sphere,
embedded in Minkowski space in the obvious way by $|\vec x|=R$, $t=0$, and $Z$ could be the closed ball $|\vec x|\leq R$, $t=0$).    What would be a prompt causal path from $Z$
to a point $p\notin Z$?   It will have to be a null geodesic from $Z$ to $p$; if it departs from $Z$ at an interior point of $Z$, it would have to be orthogonal to $Z$, but orthogonality between  a null geodesic
and a codimension 1 spacelike manifold is not possible.  So a prompt causal path from $Z$ to $p$ will have to depart from a boundary point of $Z$, that is a point in $W$. 
It will have to be orthogonal to $W$ just to be prompt as a path from $W$, let alone from $Z$. Even if a causal path  is prompt as a path from $W$, it is  not necessarily prompt as a path from $Z$, but it may be.
  For the case that $Z$ is a  closed ball in Minkowski space, the reader 
might want to figure out which points in Minkowski space
can be reached from $Z$ by prompt causal paths, and what are those paths.   Are all prompt causal paths from $W$ prompt as paths from $Z$?

In general, for any set $W$, we write $J^+(W)$ for the causal future of $W$ -- the set of points that can be reached from $W$ by a causal path.   A point $p\in J^+(W)$ is in the interior of $J^+(W)$ if
a small neighborhood of $p$ is in $J^+(W)$, and otherwise we say that it is in $\partial J^+(W)$, the boundary of $J^+(W)$.   If 
$p\in J^+(W)$  and a point $r$ slightly to the past of $p$ is also in $J^+(W)$,
then a neighborhood of $p$ is in the future of $r$ and therefore of $W$; so $p$ is in the interior of $J^+(W)$.   If, on the other hand, $p$ is in $J^+(W)$ but points slightly to the past of
$p$ are not in $J^+(W)$, then $p$ does not have a neighborhood in $J^+(W)$ so instead $p\in \partial J^+(W)$.  The reader should be able to see what these statements mean if $W$ is
a point $q$ in Minkowski space.

 An important detail is that, 
as in footnote \ref{detail} of section \ref{classic}, we consider $W$ itself to be in $J^+(W)$; in other words, we allow the
case of a future-going causal curve that consists of only one point.  The purpose of this is to ensure that for compact $W$, in a globally hyperbolic spacetime $M$,  $J^+(W)$ and $\partial J^+(W)$ are both closed in $M$.   That will make the discussion of Penrose's theorem simpler.

To show that $J^+(W)$ is closed in $M$ if $W$ is compact and
 $M$ is globally hyperbolic, we will show that if a sequence $p_1,p_2,\cdots\in J^+(W)$ converges in $M$ to a point $p$, then actually $p\in J^+(W)$.   Indeed,
the points $p_i\in J^+(W)$ can be reached from $W$ by future-going causal curves $\gamma_i$ (fig \ref{Fig25M}).  Because of compactness of spaces of causal curves in a globally hyperbolic spacetime, the $\gamma_i$
have a convergent subsequence, and this will be a future-going  causal curve $\gamma$ 
from $W$ to $p$, showing that $p\in J^+(W)$.  (If we did not consider $W$ to be in $J^+(W)$, then we could have $p\in W$
with $p_i$ strictly to the causal future of $W$, and the argument would fail.) 
To show that also $\partial J^+(W)$ is closed, we will show that
 if the $p_i$ are actually in $\partial J^+(W)$, then $p$ must be likewise in $\partial J^+(W)$, rather than in the interior of $J^+(W)$.   Indeed, if $p$ is in the interior of $J^+(W)$, then a neighborhood
 of $p$ is also in the interior, so if the sequence $p_1,p_2,\cdots$ converges to $p$, then the $p_i$ for sufficiently large $i$ are in the interior of $J^+(W)$, contradicting the hypothesis that they are in $\partial J^+(W)$.
 
 If $p\in \partial J^+(W)$, then $p$ can be reached from $W$ by a  future-going causal curve $\gamma$ (by the definition of $J^+(W)$), and more specifically  any such  $\gamma$ 
  is prompt and hence is a null geodesic without focal points.   For indeed, if $\gamma$ is not prompt, then there is a causal
 curve $\gamma'$ from $W$ to a point $p'$ to the past of $p$, and in that case $p$ is in the interior of $J^+(W)$, not the boundary.  
  
  A similar argument shows that  $\partial J^+(W)$ is always achronal.   For if $p\in \partial J^+(W)$, 
  and $\gamma$ is a future-going timelike path from $p$ to $p'$, then the future of $p$ contains a neighborhood of $p'$   (fig. \ref{Fig26M});
hence $p'$ is in the interior of $J^+(W)$, not in  its boundary.    As an example of this, the future light cone of a point $q$ in Minkowski space is achronal.

  
     \begin{figure}
 \begin{center}
   \includegraphics[width=2.3in]{Fig25M.pdf}\caption{\small   
   If $p\in \partial J^+(W)$, then there is a sequence of points $p_1,p_2,\cdots$ in the interior of $J^+(W)$ that converge to $p$.  Each of the $p_i$
   can be reached from $W$ by a causal path $\gamma_i$.   In a globally hyperbolic spacetime, a subsequence of the $\gamma_i$ will converge to
   a causal path $\gamma$ from $W$ to $p$.   $\gamma$ will automatically be prompt, since if there is a causal path from $W$ that arrives slightly
   to the past of $p$, this implies that $p$ is in the interior of $J^+(W)$, not in its boundary.  \label{Fig25M}}\end{center}
\end{figure} 
  



 
 


   \begin{figure}
 \begin{center}
   \includegraphics[width=2.3in]{Fig26M.pdf}\caption{\small   
   The purpose of this picture is to show that, for any subset $W$ of spacetime, $\partial J^+(W)$ is always achronal.   For if there is a  future-going timelike path  $\gamma$ from $p$ to $p'$
   with $p,p'\in\partial J^+(W)$, then a neighborhood of $p'$ can be reached from $p$, and therefore from $W$, by a timelike path. So $p'$ is in the interior of $J^+(W)$, not in its boundary.  Thus in the diagram, the curve $\gamma$ cannot be everywhere timelike.    An extension of the reasoning shows that if $\gamma$ is a causal curve from $p$ to $p'$, it must be a null geodesic entirely contained in $\partial J^+(W)$.  \label{Fig26M}}\end{center}
\end{figure} 


\subsection{More On The Boundary Of The Future}\label{bfuture}


The boundary of the future of any compact set $W\subset M$ has an additional property that is important in understanding black holes:  $\partial J^+(W)$ is always a codimension one submanifold of $M$,
though generally not smooth; moreover, if $M$ is globally hyperbolic, then $\partial J^+(W)$ is closed in $M$ (as we know from section \ref{pfp}) so it is actually
a closed submanifold of $M$.   Consider again the example that $q$ is a point in Minkowski
space (fig. \ref{Fig21M}).  $\partial J^+(q)$ is the future light cone, including the vertex of the cone.   It is a closed  submanifold
of Minkowski space but (because of the conical singularity at $q$) it is not smoothly embedded in Minkowski space.  This is the typical situation.


\begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Fig42M.pdf}\caption{\small  Here we show a small neighborhood of a point $p\in \partial J^+(W)$, the goal being to demonstrate that $\partial J^+(W)$
   is a manifold near $p$. The shaded region represents $J^+(W)$. 
    In a small enough neighborhood of $p$, we pick a time coordinate $t$ and spatial coordinates $\vec x$ such that $p$ is at $t=\vec x=0$.  Consider now the timelike
   path $\gamma_{\vec c}$ defined by $\vec x=\vec c$, for a constant $\vec c$.  As explained in the text, for sufficiently small $\vec c$, $\gamma_{\vec c}$ intersects $\partial J^+(W)$
   in a unique point.    Hence we can parametrize $\partial J^+(W)$ near $p$ by coordinates $\vec c$, showing that $\partial J^+(W)$ is a manifold near $p$.
   This is so for every $p\in\partial J^+(W)$, so $\partial J^+(W)$ is a manifold.   \label{Fig42M}}\end{center}
\end{figure} 


To show that in general $\partial J^+(W)$ is a manifold,  pick an arbitrary point $p\in\partial J^+(W)$.    We want to show that $\partial J^+(p)$ is a manifold near $p$.   We pick
a small ball near $p$ in which $M$ can be approximated by Minkowski space and pick coordinates $t, \vec x$ centered at $p$ (fig. \ref{Fig42M}).
Consider the timelike path $\gamma_{\vec c}$ that is parametrized by $t$ with a fixed value $\vec x=\vec c$ of the spatial coordinates.   
Since $p\in \partial J^+(W)$, a point to the past of $p$ is not in $J^+(W)$ and a point to the future of $p$ is in $J^+(W)$.
 For sufficiently small $\vec c$, the point  $t=t_0,$ $\vec x=\vec c$ is to the past of $p$ and so not in $J^+(W)$ if $t_0$ is sufficiently negative, and it is to the future of $p$ and  is in $J^+(W)$
 if $t_0$ is sufficiently positive.   So as $t$ varies from negative to positive values, there is a first value  $t=t_0(\vec c)$ at which the point $(t,\vec c)$ is in $J^+(W)$, and this point is in $\partial J^+(W)$.
 If $t>t_0$, then the point $(t,\vec c)$ is in the interior of $J^+(W)$.    So near $p$, $\partial J^+(W)$ consists of the points $t_0(\vec c), \vec c$.   
   So $\partial J^+(W)$ can be parametrized near $p$ by $\vec c$,
 and in particular is a manifold, of codimension 1 in $M$.   


It is a good exercise to return to the example that $W$ consists of a single point $q$, so that $\partial J^+(W)$ is the future light cone of $q$, and to verify that the reasoning
that we have just given is valid even if we pick $p=q\in\partial J^+(W)$. 
For another example,   let $W$ be a circle or a two-sphere, embedded in Minkowski four-space in the obvious way.    Describe $\partial J^+(W)$, showing
that it is a manifold, though not smoothly embedded in spacetime.  What is the topology of $\partial J^+(W)$?  Answer the same question for an ellipse or an ellipsoid
instead of a circle or sphere.  You should find that  $\partial J^+(W)$ is equivalent
topologically in each case to the initial value surface $t=0$, where $t$ is the time.   In particular, $\partial J^+(W)$ is never compact.  Indeed, Minkowski space
has no compact achronal hypersurface, according to  a general argument
that was sketched in fig. \ref{Fig4}.

\subsection{The Null Raychaudhuri Equation}\label{nullraych}


 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Fig27M.pdf}\caption{\small   If $W$ is a spacelike submanifold of spacetime of codimension 2, then two families of future-going null
   geodesics emanate from $W$.   In the diagram, the ``outgoing'' family sweeps out a null hypersurface $Y$.   \label{Fig27M}}\end{center}
\end{figure}
Just as in section \ref{geofocal}, to make progress, we need a reasonable way to predict that null geodesics will develop focal points.   This is provided by the null
 Raychaudhuri equation (this null analog of Raychaudhuri's original equation was first described by Sachs \cite{sachs}).

Let $W$ be a codimension two spacelike submanifold of a spacetime $M$.   For example, if $M$ is Minkowski space, $W$ might be a sphere, embedded in Minkowski space
with line element  $\d s^2=-\d t^2+\d \vec x^2$ in the standard fashion, as the submanifold $\vec x^2=R^2$, $t=0$.  

Emanating from $W$ are two families of  future-going null geodesics orthogonal to $W$ (fig. \ref{Fig27M}).  In the right conditions (for instance, if $W$ is a sphere in Minkowski space), one can naturally call
these families
``outgoing'' and ``incoming.''   In what follows, we focus on just one of these two families, which for convenience we will call outgoing.

The outgoing orthogonal null geodesics emanating from $W$ sweep out a codimension 1 submanifold $Y\subset M$.    To be more precise, $Y$ is a manifold near $W$.
When we extend the orthogonal null geodesics far enough so that they intersect each other or form focal points, $Y$ may fail to be a manifold.   This is actually the phenomenon
that we are interested in.

It is possible to choose a fairly natural set of coordinates
on $Y$.   First we pick any set of local coordinates $x^A$, $A=1,\cdots, \D-2$, on $W$.   In a somewhat similar situation in section \ref{rayeq}, we chose as one additional
coordinate the proper time measured along a timelike geodesic.    For a null geodesic, there is no notion of proper time.   But the affine parameter of a null geodesic
serves as a partial substitute.  

For a geodesic parametrized by an affine parameter $\lambda$, the geodesic equation
reads
\be\label{ziggo}0=\frac{D^2 x^\mu}{ D\lambda^2}=\frac{\d^2 x^\mu}{\d\lambda^2}+\Gamma^\mu_{\alpha\beta}\frac{\d x^\alpha}{\d\lambda}\frac{\d x^\beta}{\d\lambda}. \ee
This affine version of the geodesic equation is invariant under affine transformations
\be\label{higgo}\lambda\to a\lambda+b,~~~a,b\in\R,\ee
and two solutions that differ only by such a transformation are considered equivalent.   

On each of the null geodesics $\ell$ that make up $Y$, we pick an affine coordinate $u$ that increases towards the future
and  vanishes at the point $\ell\cap W$.   This uniquely determines
$u$ up to the possibility of multiplying it by a positive constant.  

Of course, if we let $x^A$ vary, this ``constant'' can be  a function of the $x^A$.
So following the procedure just described
 for every $\ell$ (and making sure to normalize $u$ in a way that varies smoothly with the $x^A$), we get a smooth function $u$ on $Y$ that is uniquely determined up to the possibility of multiplying it by a positive function of the $x^A$, that is,
a positive function on $W$.  We make an arbitrary specific choice.
In addition, we can extend the $x^A$ from functions on $W$ to functions on $Y$ by declaring that they are constant along each  $\ell$.
Thus at this point we have a full system of local coordinates $x^A$ and $u$ on the $\D-1$-manifold $Y$.  To complete this to a full coordinate system on $M$, or at least
on a neighborhood of $Y$ in $M$,
we need one more function $v$, and of course we need to extend $x^A$ and $u$ off of $Y$.


 \begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig28M.pdf}\caption{\small   A spacelike submanifold $W$ of codimension 2 can always be embedded locally in a spacelike hypersurface $S$.
  Moreover, near $W$, $S$ can be swept out by a family of codimension 2 submanifolds $W_\varepsilon$, $\varepsilon\in\R$, 
   such that $W_0$ is the original $W$.   \label{Fig28M}}\end{center}
\end{figure}
One way to do this (fig. \ref{Fig28M}) is to first embed $W$ in a spacelike hypersurface $S$ that is defined at least locally near $W$ (we will only be interested in what happens
near $W$).   Then we locally build $S$ out of a family of codimension 1 submanifolds $W_\varepsilon\subset S$, $\varepsilon\in\R$, where $W_0$ is the original $W$.   For this, we simply
pick a function $v$ on $S$ that vanishes along $W$ but has an everywhere nonzero normal derivative, and define  $W_\varepsilon$ by the condition $v=\varepsilon$.   We extend
the $x^A$ to functions on $S$ in an arbitrary fashion.   Then we consider the outgoing orthogonal null geodesics from $W_\varepsilon$ just as we did for the original $W$.
Letting $\varepsilon$ vary,  we are now allowing any starting point in $S$, so these geodesics together sweep out all of $M$ (or more exactly a neighborhood of $Y$ in $M$).
We parametrize these geodesics by an affine parameter $u$, normalized to vanish on $W_\varepsilon$, as we did at $\varepsilon=0$.  As before, this $u$ is well-defined up to multiplication by
a function on $S$ and we make a specific choice.   
Next, we extend $v$ and $x^A$ to functions on all of $M$ (or more exactly, on the portion of $M$ that is near $Y$) by saying that they
are constant along the outgoing null geodesics.   Finally, $u,v,$ and $x^A$ provide coordinates on a neighborhood of $Y$ in $M$.

In this coordinate system, $g_{uu}$ is identically 0, because we have arranged so that the curves parametrized by $u$, with constant $v$ and $x^A$, are null.   In addition, we have ensured that the geodesic equation is satisfied with $u$ equal to an affine parameter $\lambda$ and with $v$ and $x^A$ constant.
The condition for this is that $\Gamma^\alpha_{uu}=0$ for all $\alpha$.   Given that $g_{uu}=0$, this implies $\partial_u g_{u \beta}=0$ for all $\beta$.
Since the construction was made using null geodesics that are orthogonal to each $W_\varepsilon$, $g_{u A}$ vanishes at $u=0$, and therefore it vanishes identically.
As for $g_{uv}$, we learn that it is independent of $u$. Since $g_{uu}=g_{uA}=0$, $g_{uv}$ must be everywhere nonzero (or we would have $\det g=0$).
So we write $g_{uv}=-2e^{q}$ (the minus sign is a convention which could be reversed by changing the sign of $v$).    The line element therefore takes the general  form
\be\label{fracb}\ds^2 = -2e^q\d v \,\d u + g_{AB}\d x^A\d x^B+ 2c_A \d v \d x^A + g_{vv}\d v^2,\ee
where in general $g_{AB}$ and $c_A$ depend on all coordinates $u,v, x^C$ but $q$ depends only on $x^C$ and $v$.  

%From $g_{uu}=g_{uA}=0$, $g_{vu}\not=0$,
%it follows that 
%\be\label{acbo}g^{vv}=0,\ee
%since $g^{vv}g_{v u}=g^{v\alpha}g_{\alpha u}=\delta^v_u=0$.

One immediate conclusion comes by looking at the metric on $Y$.   Setting $v=0$, we see that this is the degenerate metric $g_{AB}(x^C,u)\d x^A\d x^B$,
with no $\d x^A \d u$ or $\d u ^2$ term.   Thus the signature of the hypersurface $Y$ is $++\cdots +0$, with  one 0 and the rest $+$'s.   Such a $Y$ is called
a null hypersurface.  We have learned that a hypersurface swept out by orthogonal null geodesics from a codimension 2 spacelike manifold $W$ is a null hypersurface.   (This statement
also has a converse, which is explained in Appendix \ref{null}.)

The null Raychaudhuri equation is just the Einstein equation $R_{uu}=8 \pi G T_{uu}$ on the hypersurface $Y$ defined by $v=0$.    Before computing $R_{uu}$, it helps to notice that by adding to $u$ a function that vanishes at $v=0$
-- and so without affecting the metric on $Y$ -- we can adjust $g_{vv}$ as we wish.   In particular, we can put the line element in the form\footnote{Once the line element is in this form modulo terms of order $v^n$,
by shifting $u$ by $v^{n+1}f_n(u,x^A)$ (for some function $f_n$), we put the line element in this form modulo terms of order $v^{n+1}$. We start the process at $n=0$.}
\be\label{racb}\ds^2=-2e^q \d v\,\d u +g_{AB}(\d x^A+c^A\d v)(\d x^B+c^B \d v),\ee
in general with different functions $q$ and $c^A$; however, $q$ is still independent of $u$ at $v=0$.
(For a more elegant route to this form of the metric, see \cite{Sachstwo}.)
In this coordinate system, 
\be\label{acb} g^{uu}=g^{vv}=g^{vA}=0=g_{uu}=g_{ua}=\Gamma^\alpha_{uu}.\ee

 A straightforward calculation of $R_{uu}$
similar to the computation of $R_{tt}$ in section \ref{rayeq} gives a similar result.  Discarding terms that vanish because of (\ref{acb}), we have
\be\label{wacf}R_{uu}=-\partial_u \Gamma^A_{u A}-\Gamma^A_{uB}\Gamma^B_{uA}=-\frac{1}{2}\partial_u\left(g^{AB}\partial_u g_{AB}\right)
-\frac{1}{4} \left(g^{AC}\partial_u g_{BC}\right)\left(g^{BD}\partial_u g_{DA}\right)  .\ee
Here $g_{AB}$ is the ($u$-dependent) metric of $W$ that appears in eqn. (\ref{racb}), and $g^{AB}$ is its inverse.   This formula is in perfect parallel with eqn. (\ref{wobbo});
the only difference is that the $(\D-1)\times (\D-1)$ metric of the hypersurface $S$ has been replaced by the ($\D-2)\times (\D-2)$ metric of the codimension 2 submanifold $W$.
The subsequent discussion therefore  can proceed in close parallel to the timelike case.  

We define the transverse area of a little bundle of orthogonal null geodesics as
\be\label{bongo}A=\sqrt{\det g_{AB}}. \ee 
As in the timelike case, we will look for points at which $A\to 0$. The interpretation of $A\to 0$ is quite analogous to the interpretation of $V\to 0$ in the timelike case.
$A\to 0$ can represent a spacetime singularity, or simply a focal point at which some of the orthogonal null geodesics from $W$ converge.\footnote{For the same reason as in the timelike
case, the condition $\det\,g_{AB}=0$ is necessary as well as sufficient for a focal point.    Indeed, as long as $M$ is smooth, the point in $M$ that is reached by an orthogonal
null geodesic that originates at a point $q\in S$ and propagates up to a value $u$ of its affine parameter is a smooth function of $q$ and $u$.  So $g_{AB}$ remains regular as long as $M$ is 
smooth.  So whenever $g_{AB}$ acquires a zero eigenvalue (corresponding to a focal point), $\det \, g_{AB}$ will vanish.}



The null expansion is defined as\footnote{It hopefully will not cause confusion to use the same symbol $\theta$ for the expansion of a $(\D-2)$-dimensional  bundle
of null  geodesics or of a $(\D-1)$-dimensional bundle of timelike ones.  Normally the context makes clear what is meant.}
\be\label{tongo}\theta=\frac{\dot A}{A}=\frac{1}{2}\Tr \,g^{-1}\dot g. \ee
The dot now represents a derivative with respect to $u$. 
One also defines the shear, the traceless part of $g^{-1}\dot g$:
\be\label{ongo}\sigma^A_B=\frac{1}{2}\left(g^{AC}\dot g_{CB}-\frac{1}{\D-2} \delta^A_B \Tr\,g^{-1}\dot g\right). \ee
So
\be\label{songo}R_{uu}=-\dot\theta-\frac{\theta^2}{\D-2}-\Tr\,\sigma^2.\ee
Hence the Einstein-Raychaudhuri equation $R_{uu}=8\pi G T_{uu}$ reads 
\be\label{kongo}\dot\theta+\frac{\theta^2}{\D-2} =-\Tr\,\sigma^2-8\pi G T_{uu}. \ee

The {\it null energy condition} is the statement that at each point and for any null vector $v^\mu$, the stress tensor satisfies
\be\label{wongox} v^\mu v^\nu T_{\mu\nu}\geq 0.\ee
This condition is satisfied by all reasonable classical matter.\footnote{There is a subtlety here in a theory with an elementary scalar field $\phi$.   In such a theory,
the metric tensor $g$ is in general not uniquely defined, as it could be redefined by a Weyl transformation $g\to e^{f(\phi)}g$ for an arbitrary function $f$.  
 There is then a unique
``Einstein frame'' in which the Ricci scalar $R$ appears in the action with a coefficient $1/16\pi G$, independent of $\phi$.   The statement made in the text
is valid in Einstein frame.   It may not hold in a more general frame.}
  It  is satisfied by all of the usual relativistic classical fields, and is not affected by a cosmological constant.
Thus the null energy condition is a very solid foundation for discussion of classical properties of General Relativity. This stands in contrast to the strong energy condition,
which was used in deducing Hawking's theorem about the Big Bang; it is not universal in classical field theory.
In the rest of this article, we will generally assume the null energy condition,
except that in section \ref{anec} we discuss a weaker condition with some of the same consequences.  

The null energy condition ensures that $T_{uu}$ is nonnegative, and therefore that the right hand side of eqn. (\ref{kongo}) is nonpositive.
Given this, we can reason as we did in the timelike case and predict the occurrence of focal points within a bounded affine distance from $W$.

Indeed, similarly to eqn. (\ref{zeg}), eqn. (\ref{kongo}) implies that
\be\label{rongox}\partial_u \frac{1}{\theta}\geq \frac{1}{\D-2}.\ee
Now suppose that $\theta<0$ at some point on $W$, say $\theta=-w$.
Then $1/\theta\geq -1/w+u/(\D-2)$ or 
\be\label{qongox} \frac{\dot A}{A} \leq -\left(\frac{1}{w}-\frac{u}{\D-2}\right)^{-1}.\ee
Integrating this formula for $\dot A/A$, we learn as in eqn. (\ref{mleg}) that $A\to 0$ at a value of the affine parameter no greater than
$u=(\D-2)/w$.  

Just as in the timelike case, there might be a spacetime singularity when $A\to 0$ (or even before), but in general $A\to 0$ represents only a focal point at which
the coordinate system assumed in the calculation breaks down.   To predict a singularity requires additional input beyond Raychaudhuri's equation.

\subsection{Trapped Surfaces}\label{trapped}

A codimension two spacelike submanifold $W$ of spacetime has two families of future-going orthogonal null geodesics, so it is possible to define two different null expansions.
Each of them is governed by the null Raychaudhuri equation that we have just described. 

If, for example, $W$ is a sphere embedded in Minkowski space in the standard fashion,
then one family of orthogonal null geodesics is ``outgoing,'' in an obvious sense, and one is ``incoming.''   The outgoing ones have positive null expansion, and the incoming
ones have negative null expansion.   


\begin{figure}
 \begin{center}
   \includegraphics[width=2.5in]{Fig43M.pdf}\caption{\small  This is a Penrose diagram describing spherically symmetric collapse to a black hole.   The
   area shaded gray represents matter and radiation that is collapsing to form a black hole; the exterior, unshaded region represents part of the Schwarzschild
   solution.     (See Fig. \ref{Fig40M} in section \ref{cc} for the Penrose diagram of the
   maximally extended Schwarzschild solution.)  A point in the diagram represents a two-sphere (or in $\D$ dimensions, a $(\D-2)$-sphere) whose radius $r$ is a function
   of the two coordinates in the diagram.   Behind the horizon, which is labeled $H$, $r$ decreases along every future-going causal curve.   For example, the point labeled $p$ is behind the horizon
   and represents a sphere $W$ of area $4\pi r^2$ (or the analog of this in $\D-2$ dimensions).    The future-going orthogonal null geodesics from $p$ are represented in the diagram by ingoing and outgoing null geodesics  (the rays
   emerging from $p$ at $\pi/4$ angles to the vertical).   These are future-going causal curves beyond the horizon, so $r$ decreases along each of them and hence the area of $W$ also decreases.
   Thus, $W$ is a trapped surface.   The points in the diagram labeled $i^0$ and $i^+$ represent spatial infinity and the future infinity of an outside observer, respectively.
    \label{Fig43M}}\end{center}
\end{figure} 
Penrose defined a ``trapped surface'' to be a codimension two spacelike
submanifold $W$ such that the expansion of each family of orthogonal future-going null geodesics is everywhere negative.   The motivating example 
 is a spherically symmetric surface behind the horizon of a spherically symmetric black hole.    Such a black hole can be conveniently represented by
a two-dimensional picture, known as a Penrose diagram, in which only the radial and time directions are shown (fig. \ref{Fig43M}). In the diagram, 
ingoing and outgoing radial null geodesics are represented by
straight lines at a $\pm\pi/4$ angle to the vertical.   A point in the diagram  represents a two-sphere (or in $\D$ dimensions,
a $\D-2$-sphere) with a round metric.   The radius of the sphere is a function $r$ on the Penrose diagram; in four dimensions, 
the two-sphere represented by a given point has an area
$4\pi r^2$.    What characterizes a Schwarzschild black hole is that behind the horizon $H$ 
of the hole, $r$ is decreasing along every future-directed 
causal curve.  Now pick a point $p$ in the diagram behind the horizon
of the black hole and let $W$ be the corresponding two-sphere.  The future-going orthogonal geodesics from $W$ are simply future-directed 
outgoing or incoming radial  geodesics, so they are represented in
the diagram by future-going rays that leave $p$ at angles $\pm \pi/4$ from the vertical, as shown.   In particular, these rays represent future-directed 
causal paths, so $r$ decreases along each of them.
Therefore both null expansions of $W$ are negative; $W$ is a trapped surface.

As an exercise, the reader can try to visualize a sphere embedded in Minkowski space in such a way that each of its null expansions is 
negative in one region and positive in another.  There is no difficulty in finding such an example.
But there is no trapped surface in Minkowski space: there is no way to embed a sphere so that each of the two null expansions is everywhere negative.  
This statement is actually a corollary of  Penrose's theorem, to which we come next.



\subsection{Penrose's Theorem}\label{penroseproof}

Penrose's theorem \cite{Penrosesing} was the first  modern singularity theorem, though in the presentation here, we have not followed the historical order.

Penrose's goal was to prove that the formation of a singularity is a generic phenomenon in gravitational collapse.   If spherical symmetry is assumed, one can solve Einstein's equations
for a collapsing star rather explicitly  and show  that formation of a singularity is unavoidable.
  But what happens if the geometry is not quite spherically symmetric?    Does infalling matter still collapse to a singularity, or does it ``miss'' and, perhaps, re-emerge in an explosion?
Penrose wanted a robust criterion for formation of a singularity that would not depend on precise spherical symmetry. This goal was the motivation for the concept of a trapped surface.


 Like the other results that came later (see the discussion at the end of section \ref{hbb}), 
Penrose's ``singularity theorem'' is proved without directly studying singularities.   It is really a statement about completeness.  Penrose proved that a spacetime $M$ satisfying certain conditions
is null geodesically incomplete, meaning that at least one null geodesic in $M$ cannot be continued in the future to an arbitrarily large value of its affine parameter.



Penrose's theorem concerns a  globally hyperbolic spacetime $M$ with a noncompact Cauchy hypersurface $\S$. 
For example, in any spacetime that is asymptotic at spatial infinity to Minkowski space, a Cauchy hypersurface -- if there is one -- is not compact. So Penrose's theorem applies to any spacetime that is asymptotically flat and also globally hyperbolic.
 In the statement and proof of Penrose's theorem,
it is not necessary to assume that $M$ is maximal in the sense of section \ref{maximal}, but the most interesting case is that $M$ is maximal.

The final input to Penrose's theorem, apart from the classical Einstein equations, is the null energy condition.
  Penrose's theorem states that, assuming global hyperbolicity, a noncompact Cauchy hypersurface,  the null energy condition, and the classical Einstein equations,
a spacetime $M$ that contains a compact trapped surface is not null geodesically complete.

The condition for a spacetime to contain a compact trapped surface $W$ is stable against small perturbations of the geometry, since if the null expansions of $W$
are negative, they remain negative after a sufficiently small perturbation.  So Penrose's theorem
applies to any spacetime that is sufficiently close to Schwarzschild, that is, sufficiently close to spherically symmetric collapse to a black hole in a spacetime that is asymptotic to Minkowski
space at spatial infinity.  

Penrose's theorem is commonly
called a ``singularity theorem'' because of a presumption that  generically, the reason that a null geodesic cannot be continued is the same as in the Schwarzschild case: it ends at a singularity.
  However, this goes beyond what is proved, and the exercises below show that on such matters, caution is called for.


  
Penrose's theorem is proved as follows. 
Let $W$ be a compact trapped surface in $M$. Pick affine parameters for the future-going null geodesics that are orthogonal to $W$.  
As usual, it is natural to normalize 
these affine parameters to vanish on $W$.   For any given point $q\in W$, one is still free to multiply the affine parameter (for either the ingoing or outgoing null geodesic from $q$) by a constant.
There is no natural way to fix the normalization; for what follows, it suffices to use any normalization that varies smoothly with $q$.
 
The  null expansions $\dot A/A$ of the compact surface $W$, being everywhere negative, satisfy a bound
   $$\frac{\dot A}{A}<-w$$
for some constant $w>0$.  Then Penrose proves, to be precise, that at least one of the future-going null geodesics orthogonal to $W$ cannot be extended to a value of
its affine parameter greater than $(\D-2)/w$.   

Suppose on the contrary that every one of the future-going null geodesics  $\ell$ orthogonal to $W$
can be extended to a value of its affine parameter greater than $(\D-2)/w$.  This means,
according to Raychaudhuri's equation, that every such $\ell$ can be extended beyond its first focal point.   

Suppose that $\ell$ leaves $W$ at a point $q\in W$ and continues past its first focal point $p$.  Let $\ell_{qp}$ be the segment of $\ell$ connecting $q$ to $p$; it is compact.
We have $\ell\cap \partial J^+(W)\subset \ell_{qp}$, since $\ell$ is not prompt when continued beyond $p$.     
Moreover,  $\ell\cap\partial J^+(W)$ is closed in $\ell$, since $\partial J^+(W)$ is closed in $M$.   So $\ell\cap \partial J^+(W)$ is a closed subset of
$\ell_{qp}$.     A closed subset of a compact space is compact, so $\ell \cap \partial J^+(W)$ is compact.\footnote{If $\ell$ cannot be continued until reaching a focal point -- for instance because it
 ends at a singularity or leaves the globally hyperbolic spacetime -- then  it is possible for the closed subset $\ell\cap\partial J^+(W)$ of $\ell$ to
 satisfy  $\ell\cap\partial J^+(W)=\ell$, and then $\ell\cap\partial J^+(W)$ can be noncompact.   Penrose's proof
 shows that if $W$ is a trapped surface, this situation will arise for some $\ell$.  (Promptness of $\ell$ can fail without $\ell$ reaching a focal point, 
 but the alternative failure mode, which is described in Appendix \ref{failure}, does not give a new way for the prompt portion of $\ell$ to be noncompact.)   
 If $\ell$ can be continued past its first focal point, then we can be more specific about $\ell\cap\partial J^+(W)$,
 though the details are not needed in the proof of Penrose's theorem.  $\ell\cap \partial J^+(W)$ is either empty (this is only possible if $W$ is not achronal), consists only of the point
 $q\in \ell$ (this is only possible if there exists a causal path to $q$ from some other point $q'\in W$, but any such path is a null geodesic), 
 or consists of a nontrivial initial segment of $\ell$.   The reader may wish
 to try to justify these statements. }  
  
  
  




 
Every point $p\in\partial J^+(W)$ is connected to $W$ by one of these future-going orthogonal null geodesics.  So $p$ is determined  by\footnote{Such a triple determines $p$, but more than one triple may lead to the same
 $p$.} a triple consisting of  the choice of a point $q\in W$
 (at which $\ell$ originates), the choice of whether $\ell$ is ``incoming'' or ``outgoing'' at $q$, and the affine parameter measured along $\ell$. 
 Moreover, from what we have just seen, the affine parameter on each $\ell$ can be restricted to a compact interval.
 Since $W$ itself is compact and the affine parameter measured along each $\ell$
 ranges over a compact interval, this implies that $\partial J^+(W)$ is compact. 

But $\partial J^+(W)$ is an achronal codimension 1 submanifold of $M$, as explained earlier  in sections \ref{pfp} and \ref{bfuture}.
In a globally hyperbolic spacetime $M$ with a noncompact Cauchy hypersurface $\S$, there is no compact achronal submanifold
of codimension 1, as we learned in section \ref{somep}.   Putting this together, our hypothesis was wrong and at least one future-going null geodesic
$\ell$ that is orthogonal to $W$ cannot be extended within $M$ beyond an affine distance $(\D-2)/w$ to the future of $W$.   This completes the proof of Penrose's theorem.

Here are some exercises that aim to help one understand the fine print in Penrose's theorem. (The two forms of the de Sitter space metric are described in Appendix \ref{dSitter}.)

(1) De Sitter space in dimension $\D$ can be described with the line element
\be\label{dS}\ds^2=-\d t^2+R^2\cosh^2(t/R) \d \Omega^2\ee
where $\d\Omega^2$ is the line element of a $\D-1$-sphere.  Convince yourself that this is a globally hyperbolic spacetime with a {\it compact} initial value
surface $S$ (because of the compactness of $S$, Penrose's theorem does not apply).  Also convince yourself that de Sitter space
 is geodesically complete; all geodesics can be continued to infinite affine
parameter in both directions.  Find a compact trapped surface $W$.  Can you describe the boundary of the future of $W$?   You should find that $\partial J^+(W)$
is topologically equivalent to the initial value surface, as the above arguments imply.

(2)  Consider the following line element, which describes just a portion of de Sitter space:
\be\label{dSp}\d \t s^2=-\d t^2+R^2\exp(-2t/R) \d \vec x^2,~~~~\vec x\in \R^{\D-1}.\ee
(A time-reversed version of this line element provides a model of an accelerating universe.  The $t$ coordinate in eqn. (\ref{dSp})
is not simply related to the coordinate of the same name in eqn. (\ref{dS}). See Appendix \ref{dSitter} for a derivation of this form of the line element and an explanation
that it describes just part of de Sitter space.)
Show that this line element describes a globally hyperbolic spacetime  with noncompact initial value surface $t=0$.  Thus Penrose's theorem applies.
Find a compact trapped surface $W$.  Do you see a singularity?
What does Penrose's theorem mean for this
spacetime?  What is the boundary of the future of the trapped surface $W$?   As a hint, look at null geodesics in this spacetime. 
You should find that every null geodesic intersects the initial value surface at (say) $t=0$, as implied by global hyperbolicity.  But
are null geodesics complete in the sense of extending to infinite affine parameter in both directions?

 \begin{figure}
 \begin{center}
   \includegraphics[width=3in]{Fig30MNew.pdf}\caption{\small  The square is a Penrose diagram of de Sitter space $\h M$.    $\I^+$ and $\I^-$ represent future and past infinity of $\h M$
   and are not part of $\h M$.    The shaded triangle is a contracting portion $M$
   of $\h M$ ($M$ is actually the causal past of a point in $\I^+$).   $\h M$ is globally hyperbolic, with compact Cauchy hypersurface $\h S$,
   and $M$ is globally hyperbolic with noncompact Cauchy hypersurface $S$ (to compactify $S$, we would have to include in $S$ the lower left corner of the diagram; this point lies
   in $\I^-$ and is not part of $M$ or $\h M$).  $M$ contains compact trapped surfaces, represented by points near the bottom of the diagram.  In particular, the point labeled $q$
   represents a trapped surface $W$.
   $M$ therefore satisfies all the conditions of Penrose's theorems.  The incompleteness implied by Penrose's theorem just means that some null geodesics orthogonal to $W$ --
   such as the one labeled $\gamma$ --  exit $M$ at a finite value of their affine parameters.   Thus $M$ is not null geodesically complete; its completion is $\h M$.  \label{Fig30MNew}}\end{center}
\end{figure}

To understand these examples better,
let $\h M$ be the de Sitter space of eqn. (\ref{dS}), and let $M$ be the spacetime of eqn. (\ref{dSp}).  Then $M$ can be embedded in $\h M$.
Both $M$ and $\h M$ are globally hyperbolic, but a Cauchy hypersurface $\S$ for $M$, when embedded in $\h M$, is not a Cauchy hypersurface
for $\h M$.   A Cauchy hypersurface $S$ for $M$ is a plane $\R^{\D-1}$, while a Cauchy hypersurface $\hat S$ for $\hat M$ is a sphere $S^{\D-1}$, obtained topologically
by adding a point at infinity to the plane.   
When $M$ is embedded in $\h M$, the portion of $\h M$ that is not in $M$ lies beyond a Cauchy horizon.  A Penrose diagram
illustrating these statements is in fig. \ref{Fig30MNew}.    Null geodesics in $\h M$ can be
continued to infinite values of their affine parameter, but they can exit $M$ at a finite value of their affine parameter.  A trapped surface $W$ can be represented by any point
below the main diagonals.  For instance, we can pick the point $q$ on the null geodesic $\gamma$, near the lower right corner of the diagram.
  Applied to this example, the phenomenon described by Penrose's theorem
is that some null geodesics orthogonal to $W$, when viewed as geodesics in $\h M$, leave $M$ at a finite value of their affine parameters and enter the part of $\h M$ that is beyond a Cauchy horizon.
$\gamma$ itself has this behavior.

The second example  illustrates why some careful authors refer to Penrose's theorem as an incompleteness theorem rather than a singularity theorem.
The geodesics that, according to Penrose's theorem, cannot be continued to arbitrary values of their affine parameter might terminate on a singularity,
as in the case of a Schwarzschild black hole.   But the theorem allows the possibility that these geodesics simply leave the globally hyperbolic spacetime $M$
under discussion, without reaching any singularity, as in our second example.   The phenomenon  is a failure of predictivity:   what happens to these
geodesics after they leave $M$ cannot be predicted based on initial data on the Cauchy hypersurface $\S$ of $M$.   


 

 
\section{Black Holes}\label{blackholes}

What Penrose's theorem actually says about the region inside a black hole is quite limited, as we learned from the examples in section \ref{penroseproof}.  
It therefore comes as a nice surprise that the
ideas on which this theorem is based lead rather naturally to an understanding of important properties of black holes.\footnote{Chapter 12 of the book \cite{Wald} is particularly useful for background to the present section, as well as to further properties of black holes that go beyond the scope of this article.  In this article, we only consider issues directly related to causality.}

To be more exact, these ideas {\it plus one more assumption} lead to such an understanding.

\subsection{Cosmic Censorship}\label{cosmic}

It is not possible to get a good theory of black holes without knowing, or assuming, that something ``worse'' than collapse
to a black hole does not occur.  

Roughly speaking, ``something worse'' might be the formation of what Penrose called a ``naked singularity'' 
\cite{PenroseA,PenroseB,Penrose\S}. This is a singularity
not enclosed by a horizon, and visible to an outside observer.

Formation of a naked singularity might bring the predictive power of classical General Relativity to an end, because the classical theory
would not uniquely determine what comes out of the naked singularity.   As an extreme case, formation of a naked singularity might bring the spacetime itself
to an end (this possibility was part of the motivation for a refinement of Penrose's conjectures \cite{GerochHorowitz}). 
For example, imagine that gravitational collapse creates an outgoing shock wave singularity
that expands to infinity at the speed of light.  If the singularity is severe enough that the classical
Einstein equations break down, and the classical spacetime cannot be continued to the future of the shock wave based only
on information provided by Einstein's classical theory, then one could describe this by saying that spacetime -- or at least
the ability to describe spacetime based only on the classical theory -- has come to an end.  


Since this may seem fanciful, perhaps it is worth mentioning that something somewhat similar, though without a singularity, can actually
happen in Kaluza-Klein theory.   Consider a $\D$-dimensional spacetime that is asymptotic
at spatial infinity to $M^{\D-1}\times S^1$ (where $M^{\D-1}$ is Minkowski space of dimension $\D-1$ and $S^1$ is a circle).   At distances long compared to the asymptotic radius of the circle, such a spacetime is effectively $(\D-1)$-dimensional.
The classical equations admit initial conditions in which, from a $(\D-1)$-dimensional point of view, there is a ``hole'' in space of zero or even negative energy  \cite{Witten}.   (From a $\D$-dimensional
point of view; there is no hole in space; the spacetime is topologically different from $M^{\D-1}\times S^1$, but looks like $M^{\D-1}\times S^1$ near spatial infinity.)   The hole expands
to infinity at the speed of light.   There is nothing to the future of this cataclysm; spacetime comes to an end.   So in such a situation, it is not
possible to make arguments -- as we will do in analyzing black holes -- based on what will be seen in the far future by an observer
who remains at a safe distance.

Penrose \cite{PenroseA,PenroseB,Penrose\S} introduced the hypothesis of ``cosmic censorship,'' which (in its simplest form, known as ``weak'' cosmic censorship,\footnote{``Strong'' cosmic censorship says that in  an arbitrary 
spacetime, not necessarily asymptotic to Minkowski space, no observer can see a naked singularity. There is no general claim of an ability to continue the spacetime to the future.  For our
purposes here, ``weak'' cosmic censorship is the relevant statement.  The terminology, though standard, is potentially misleading since ``weak'' cosmic censorship is not a special case of
``strong'' cosmic censorship.} and as elaborated later \cite{GerochHorowitz}) says that in a globally hyperbolic spacetime
asymptotic at spatial infinity to Minkowski space, no such catastrophe occurs: 
in gravitational collapse, and more generally in any localized process in an asymptotically Minkowskian spacetime, the region
in the far distance and the far future continues to exist, just as in Minkowski space.   Moreover,  the evolution seen by an outside observer
is supposed to be predictable based on the classical Einstein equations.   Any singularity is hidden by a horizon, and does not affect the outside
evolution.

If true, this is a quite remarkable and genuinely surprising fact, and possibly a little disappointing.  It is genuinely surprising because
the classical Einstein equations have no obvious stability properties that would tend to guarantee cosmic censorship. It is possibly disappointing because if cosmic censorship
is true, we lose our chance to get observational evidence concerning a hypothetical better theory.   After all, if cosmic censorship is false, and the classical Einstein
equations break down in a way that is visible to a distant observer, we might in principle hope to observe what happens when this breakdown 
occurs.\footnote{In the conclusion of \cite{PenroseB}, Penrose
expresses some ambivalence about the cosmic censorship hypothesis, observing that there appears to have been a Big Bang, which is somewhat
analogous to a naked singularity, so naked singularities might be an inescapable part of physics.}  

 For many years, the evidence
for cosmic censorship appeared meager, at least to the present author. However, by now reasonable evidence for cosmic censorship, at least for $\D=4$, has come from the fact that simulations of black hole
collisions  \cite{Pretorius} have not generated naked singularities.\footnote{For $\D>4$,
it appears that  the Gregory-Laflamme instability \cite{GLa} may violate the usual statement of cosmic censorship \cite{Pret}.   However, see footnote
\ref{welg} below.}
   If it were the case that black hole collisions produce naked singularities rather than bigger black holes,\footnote{On this
question, Penrose wrote in \cite{Penrose}, ``We might, for example, envisage two comparable black holes spiraling into one
another. Have we any reason, other than wishful thinking, to believe that a black
hole will be formed, rather than a naked singularity? Very little, I feel; it is really a
completely open question.''} 
then the recent LIGO/VIRGO observations of colliding black holes,
rather than providing a particularly interesting test of classical General Relativity, 
might have given us information about what happens when classical General Relativity breaks down.

Whether cosmic censorship is true -- and how exactly to formulate it, as there are many important subtleties\footnote{\label{welg}For example, causal propagation governed by the Einstein equations may continue
to make sense in the presence of certain limited types of singularities.    Weak null singularities that propagate outward at the speed of light are a 
candidate.
Above $\D=4$, a more concrete candidate might be the singularity arising from the Gregory-Laflamme instability. 
 So in the statement of
cosmic censorship, one might allow the formation of certain types of singularity that are  visible by an outside observer.}  -- is widely regarded as the outstanding unanswered question about
classical General Relativity.    For our purposes, we will assume that some version of cosmic censorship holds, such that it makes sense to study gravitational collapse
from the point of view of an observer at infinity in the far future.

\subsection{The Black Hole Region}\label{helpme}

If cosmic censorship is assumed, one can make a nice theory of black holes in a globally hyperbolic and asymptotically flat spacetime $M$.


     First of all, the {\it black hole region} in $M$
is the region $B$ that is not visible to an outside observer.    To be somewhat more exact, let $\I$ be the worldline of a timelike observer
who remains more or less at rest at a great distance, in the asymptotically flat region observing whatever happens.   We denote as $J^-(\I)$
the causal past of this observer, i.e. the set of  points from which the observer can receive a signal. 
$J^-(\I)$  is always open, because if a causal path $\gamma$ from a point $	q\in M$  reaches the distant observer at a point $p\in \I$,
then from any point $q'$ that is sufficiently near $q$, there is a causal path $\gamma'$ that reaches $\I$ at a point $p'$ that is near $p$.  One just defines
$\gamma'$ to follow $\gamma$  wherever it goes (somewhat as $\gamma'$ tags along after $\gamma$ in fig. \ref{46M}(b), though in the
present context $\gamma'$ is not necessarily to the past of $\gamma$).  Intuitively, an observer who can see the point $q$ at some time $t$ can
see any point that is sufficiently close to $q$ at a time close to $t$.

The black hole
region $B$ is the complement of $J^-(\I)$ in $M$:
\be\label{wondo}B=M\backslash J^-(\I).\ee
$B$ is closed, since $J^-(\I)$ is open.
 
The {\it black hole horizon} $H$ is defined to be the boundary of $B$:
\be\label{bondo} H =\partial B.\ee  (As usual, a point in $B$ is in the interior of $B$ if it has a neighborhood in $B$, and otherwise it is in the boundary of $B$.)

Let us first prove that these definitions are  sensible by showing that the existence of a black hole region is a generic property of gravitational collapse.
 We will show that {\it any compact trapped surface $W$ is in the black hole region $B$.}    In other words, we will show that a signal from a compact trapped surface
cannot reach the outside observer.


\begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig32M.pdf} 
 \end{center}
\caption{\small 
If an observer with worldline $\I$ can receive a signal from a compact set $W$ in spacetime, then the earliest possible such signal arrives
on a prompt null geodesic $\gamma$ that connects $W$ to a point $p\in\I$.  If $W$ is a trapped region and $\I$ is sufficiently far away, this is impossible.
 \label{Fig32M}}
\end{figure}



If a causal signal from the compact trapped surface $W$ can reach the worldline $\I$ of the distant observer, there is a first point $p\in\I$ at which this can occur.
The causal path from $W$ to $p$ would be prompt, so it would be a future-going null geodesic  $\ell$ from  $W$ to $p$, orthogonal to $W$,
and without focal points (fig. \ref{Fig32M}).
Since $W$ is a compact  trapped surface, there is a focal point on $\ell$ within a known, bounded affine distance from $W$.    But $\I$, the worldline of the outside
observer, can be arbitrarily far away.  
   This is a contradiction and hence there can be no causal signal from  $W$ to $\I$. 
   
    So assuming cosmic censorship, a black hole forms in any asymptotically flat spacetime that contains a trapped surface -- and thus in any spacetime
that is close enough to the explicit Schwarzschild  solution (or any of the explicit black hole solutions, such as the Kerr solution for a rotating black hole).    
Without cosmic censorship, the conclusion does not apply because the worldline $\I$
that was assumed in the discussion might not exist.


\begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig33M.pdf} 
 \end{center}
\caption{\small An observer who can receive a signal from a point $r$ in the causal future of a set $W$ can also receive a signal from $W$.   So if $W$ is contained in the black hole
set and $r$ is in its causal future, the curve labeled $?\,?\,?$ connecting $r$ to the worldline $\I$ of an observer at infinity
 must not be future-going causal; $r$ must be contained in the black hole set.  \label{optimal2}}
\end{figure}
An obvious fact is that if a set $W$ is contained in the black hole region $B$, then its future $J^+(W)$ is also in $B$.   For  if $r$ is in the future of
$W$ and an event at $r$ can be seen by the distant observer, then that observer can also receive a signal from $W$ (fig. \ref{optimal2}).

Suppose that a trapped surface $W$ is the boundary of a codimension 1 spacelike submanifold $Z$ (which might be the ``interior'' of $W$ on some Cauchy hypersurface).
As explained in section  \ref{pfp}, a prompt causal path from $Z$ to $\I$ would actually be an orthogonal null geodesic from $W$ to $\I$.   But we already know that no such geodesic exists.
So $Z$ is in the black hole region.


\begin{figure}
 \begin{center}
   \includegraphics[width=3.5in]{Fig34M.pdf} 
 \end{center}
\caption{\small (a) In a spacetime that contains multiple black holes, the black hole region on a given Cauchy hypersurface $\S$ might have several connected components $Z_i$.
(b) An impossible situation, in which a black hole splits into two, or more precisely in which a
component $Z$ of the black hole region on a Cauchy hypersurface $\S$ evolves to two disconnected components $Z_1$ and $Z_2$
on a future Cauchy hypersurface $\S'$.   Why this cannot happen is explained in the text.
 \label{Fig34M}}
\end{figure}
There might be several black holes in spacetime, so on a given Cauchy hypersurface $\S$, the black hole region might have several disconnected components
(fig. \ref{Fig34M}(a)).   Black holes can merge, but a black hole cannot split, in the sense that if $Z$ is a connected component of the black hole region on
a given Cauchy hypersurface $\S$, then the future of $Z$ intersects any Cauchy hypersurface $\S'$ to the future of $\S$ in a connected set.
To prove this, suppose that the black hole region intersects $\S'$ in disconnected components $Z'_i$, $i=1,\cdots, r$ (fig. \ref{Fig34M}(b)). 
Consider first future-going causal geodesics from $Z$.   Any such causal geodesic (like any causal path from $Z$) remains in the black hole region,
so it intersects $\S'$ in one of the $Z'_i$.  But the space of future-going causal geodesics starting at $Z$ is connected, and cannot be continuously divided into
two or more disjoint subsets that would intersect $\S'$ in different components of the black hole region.  So all causal geodesics from $Z$ arrive at $\S'$ in the
same component $Z'_i$ of the black hole region.    Now consider any future-going causal path from  $Z$.   If there is a causal path $\gamma$ from $Z$ to a given component
$Z'_i$ of the black hole region, then by maximizing
the elapsed proper time of such a path, we learn that there is a causal geodesic (lightlike or timelike) from $Z$ to $Z_i'$.  So in fact, precisely one component $Z_i'$ of the
black hole region on $\S'$ is in the future of $Z$. 

\subsection{The Horizon And Its Generators}\label{horizon}

\begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig35M.pdf} 
 \end{center}
\caption{\small In this Penrose diagram, the black hole region is shaded, and $q$ is a point in its boundary.   So $q$ is the limit of a sequence of points $q_1,q_2,\cdots$ that are outside the black hole region.
Being outside the black hole region, $q_1,q_2,\cdots$ are connected 
 by future-going causal curves to the worldline $\mathcal I$ of an observer
at a great distance. (The part of the spacetime to the right of $\mathcal I$ is not drawn.)  Hence there exist prompt null geodesics $\ell_1,\ell_2,\cdots $ from $q_1,q_2,\cdots$ to $\I$.   In a globally hyperbolic spacetime, the $\ell_i$ converge to a null geodesic
$\ell$ through $q$.   Because $q$ is contained in the black hole region, $\ell$ does not reach the worldline $\I$ of the outside observer.  What happens is rather that as $i$ increases,
the geodesic $\ell_i$ arrives at $\I$ later and later; the proper time at which the distant observer can see the point $q_i$ diverges for $i\to\infty$.   The upper corner of this
diagram, at which $\ell$ and $\I$ appear to meet, is actually at future infinity.   It is not a point in the spacetime.
 \label{Fig35M}}
\end{figure}
 Now we want to discuss the ``horizon generators.''    Let $q$ be a point on the black hole horizon, and let $\I$ be the timelike worldline of an 
 observer who is more or less stationary at infinity.     We recall that the horizon $H$ is the boundary of the black hole region $B$.
A point $q\in H$ is the limit of a sequence of points $q_1,q_2,q_3,\cdots $ that are outside of $B$.     Each of the $q_i$ is connected to the worldline $\mathcal I$ by
a future-going prompt null geodesic $\ell_i$. As $q_i\to q$, the $\ell_i$ approach a future-going null geodesic $\ell$ from $q$.   But since $q\in H\subset B$, it is not true that $\ell$ connects $q$ to a point in $\I$.   Rather, what happens is that as $q_i\to q$, the point at which $\ell_i$
reaches $\I$ goes to $\infty$ along $\I$ (fig. \ref{Fig35M}).  The limiting geodesic $\ell$ does not reach $\mathcal I$ at all. 

$\ell$ remains everywhere in the horizon.  One can see this as follows.
 $\ell$ can never go outside $B$, since in general a causal curve starting at $q\in H=\partial B$  can never reach outside $B$.
On the other hand,  $\ell$ can nowhere be in the interior of $B$, because it is the limit of the prompt null geodesics from $q_i$ that are strictly outside $B$.  So $\ell$ is everywhere in $H=\partial B$.   $\ell$ is called a horizon generator.

 In fact, we can be more precise.   
Any point $r$ that is in the past of $\ell$ (meaning that some  future-going timelike curve from $r$ reaches some point on $\ell$) is also in the past of $\ell_i$, for sufficiently
large $i$, since $\ell$ is the limit of the $\ell_i$.
  Since the $\ell_i$ meet $\I$, it follows that a causal (and in fact strictly timelike)
  path from $r$ can meet $\I$.   Thus any point $r$ that is to the past of $\ell$ is outside of the black hole
region $B$. 

$\ell$ is a prompt null geodesic, in particular with no focal point, no matter how far we continue it into the future.   Indeed, if $\ell$ fails to be prompt, there is a causal
path from $q$ to some point $r$ that is strictly to the past of some $q'\in\ell$.   As we have just discussed, such an $r$ is outside the black hole region,
and the existence of a causal path from $q$ to $r$ would show that $q$ is also outside the black hole region.

Now pick an initial value hypersurface $\S$ that contains $q$ and define $W=\S\cap H$. $\ell$ must be orthogonal\footnote{We assume here that $W$ is differentiable at least at a generic point.} to $W$, 
since a prompt causal path from any submanifold (to any destination) is always orthogonal to that submanifold.      Together, the horizon generators that pass through $W$ sweep out a three-manifold $H'$.   From what we have seen, $H'$ is contained in $H$,
and near $W$, the two are the same (assuming that $W$ is differentiable).    But if we continue into the future, $H'$ might not coincide with $H$,  since, for example, new black holes may form, as a result of which the horizon (even its connected component that contains $W$)
 may not be swept out entirely by the horizon generators that come from $W$.


Since it is swept out locally by orthogonal null geodesics, $H$ must  be a null hypersurface,
that is a hypersurface with a degenerate metric of signature $++\cdots +0$.    This is true for a general reason explained in section \ref{nullraych}:  any hypersurface
swept out by  null geodesics orthogonal to a codimension two manifold, such as $W$, is a null hypersurface.   But in the present case we can be more direct.   
The tangent vector $v$ to $\ell$ at $q$ is orthogonal to itself (since $\ell$ is null) and is orthogonal to the tangent space to $W$ (since $\ell$ is orthogonal to $W$),
so it is orthogonal to the whole tangent space to $H$, showing that the metric of $H$ is degenerate at $q$.   But here $q$ could have been any point on $H$,
so the metric of $H$ is degenerate everywhere.



 

 
 The final result that we will discuss about classical black hole horizons is possibly the most important: the Hawking area theorem.  It says that the area of the black
 hole horizon can only increase, in the sense that the area measured on an initial value hypersurface $\S'$ that is to the future of $\S$ is equal to or greater  than the
 area measured on $\S$.   The theorem applies separately to each component of the black hole region; if  two or more black holes merge, 
 the theorem says that the merger produces a black hole with a horizon area at least equal to the sum of the
 horizon areas of the original black holes. 
 
  
 It suffices to show that the null expansion $\theta=\dot A/A$ of the horizon generators is everywhere nonnegative.   This being so along every horizon generator
 means that the horizon area is everywhere nondecreasing.  (To fully determine the growth of the horizon area, one has to take into account that new horizon generators can come into existence in the future of $S$, for example because of the formation of new black holes.  But that
can only give a further increase in the horizon area.)

If we know that the horizon generators are complete in the sense that they can be continued to arbitrarily positive values of their affine parameters,
we would prove the nonnegativity of $\theta$ as follows.   From Raychaudhuri's equation, if $\theta$ is negative for one of the horizon generators $\ell$,
then there will be a focal point along $\ell$ at some bounded value of its affine parameter.   But we have already shown that the horizon generators have
no focal points.  


\begin{figure}
 \begin{center}
   \includegraphics[width=2in]{Fig36M.pdf} 
 \end{center}
\caption{\small $W$ is  the boundary of a component of the black hole set (shaded) on some Cauchy hypersurface $S$.  Such a $W$ is a codimension
2 spacelike submanifold of spacetime.     If there is a portion of $W$ on
which the  null expansion $\theta$ of the horizon generators is negative, then by pushing $W$ outward slightly in that region, while remaining in $S$,
we get a new submanifold $W'$, still spacelike and of codimension 2,
that is partly outside of the black hole set, and such that the part of $W'$ that is outside the black hole set still has $\theta<0$.  In the figure, the region between $W$ and $W'$ is unshaded, as it is not
part of the black hole  set.
 \label{Fig36M}}
\end{figure}
We might view the claim that the horizon generators are complete (which roughly says that the horizon is nonsingular) as a slight extension of the cosmic censorship hypothesis (which roughly says that the region outside the horizon is nonsingular).   However, it is possible
to prove the area theorem without assuming this.   Imagine that in some portion of $W=H\cap \S$, one has $\theta<0$.
 Then  we define a new surface $W'$  by pushing $W$ out a little in the region with $\theta<0$, leaving $W$ unchanged wherever $\theta\geq 0$.  
$\theta$ varies continuously as $W$ is moved in $M$, so if we do not push too far, $W'$ has $\theta<0$ in the portion outside of $B$ (fig. \ref{Fig36M}).  Since it is not
 entirely contained in $B$, $W'$ is connected to the worldline $\I$ of an observer at infinity by a causal path, which we can choose to be a prompt null geodesic $\ell$.
 $\ell$ must connect $\I$ to a point in $W'$ that is outside $B$, 
 but we have chosen $W'$ so that at such points, $\theta<0$.   Hence $\ell$ must have a focal
point within a bounded affine distance of $W'$.  This contradicts the fact that $\I$ can be arbitrarily far away. So in fact there was nowhere on $W$
with $\theta<0$.

 
There is certainly much more to say about black holes, but at this point we will leave the reader to continue the journey elsewhere.   We just conclude with a comment on the time-reversal
of a black hole horizon.
Black hole horizons  are {\it future horizons}; an observer at infinity can transmit a signal to the region behind a future horizon, but cannot receive a signal from that region.
Time-reversing these statements, one gets the notion of a {\it past horizon}; an observer at infinity can receive a signal from behind a past horizon, but cannot transmit a signal to that region.  
The region behind
a past horizon in an asymptotically flat spacetime is called a white hole. The time-reversed version of Penrose's theorem says that a white hole region contains a past singularity or at least a failure of past null geodesic completeness.    Idealized solutions of General
Relativity have white holes as well as black holes (the Schwarzschild solution is an example; see fig. \ref{Fig40M} in section \ref{cc}).
 In the real world, black holes form from gravitational collapse
but there is no equivalent mechanism to create white holes; and cosmic censorship suggests that white holes cannot form from good initial data.

There are also horizons in cosmology, but this notion is strongly observer-dependent. The boundary of the region that an observer can see is called the future horizon of that observer,
and the boundary of the region that an observer can influence is called the observer's past horizon.   In cosmology, past and future horizons are both natural.    For example,
the diagonal boundary of the shaded region in fig. \ref{Fig30MNew} is the future horizon of any observer whose timelike worldline ends at the upper right corner of the diagram, and the past
horizon of  any observer whose timelike worldline begins at the lower  left corner.  The shaded region is the region that the former observer can see and that the latter observer cannot influence.


. 

\section{Some Additional Topics}\label{addtop}

We turn now to several additional topics, including topological censorship, the averaged null energy condition,
and the Gao-Wald theorem.

\subsection{Topological Censorship}\label{cc}

\begin{figure}
 \begin{center}
   \includegraphics[width=4in]{Fig37M.pdf} 
 \end{center}
\caption{\small  Two types of wormhole: (a) a connection between two different worlds; (b) a shortcut between distant regions of one world.   In each case, what is depicted
is a Cauchy hypersurface.    (Compare p. 837 of \cite{MTW}.)
 \label{Fig37M}}
\end{figure}



A ``wormhole'' is, for example,\footnote{A similar discussion applies in a spacetime that is asymptotic to Anti de Sitter
space \cite{topocensor2}.} 
 a geometrical connection 
between two different asymptotically flat worlds (fig. \ref{Fig37M}(a)), or 
a shortcut between two distant regions of a single asymptotically flat world (fig. \ref{Fig37M}(b)).   The two cases are closely related. The existence of a wormhole of the second type
means that spacetime is not simply-connected; by taking a cover of spacetime, one can pass to a situation of the first type. 

We recall that, topologically, a globally hyperbolic spacetime $M$  is simply $M=\S\times \R$ where $\S$ is an initial value hypersurface and $\R$ parametrizes the ``time.''
So for $M$ to have a wormhole means simply that  $\S$ has a wormhole.

\begin{figure}
 \begin{center}
   \includegraphics[width=4in]{Fig40M.pdf}\caption{\small   This is the Penrose diagram of the maximal analytic extension of a Schwarzschild black hole.  It contains
   two asymptotically flat regions, here labeled I and II.   They are spacelike separated and causal communication between them is not possible.   The spacetime is globally
   hyperbolic, with initial value surface $S$.  It connects the two asymptotically flat regions, and has a ``wormhole'' topology, similar to that of fig. \ref{Fig37M}(a).  
   Labeled $H^+$ are the future horizons of observers who
   remain at infinity in regions I or II; beyond $H^+$ and to its future is the black hole region (shaded).  From the point of view of the outside observer,
   there also are past horizons $H^-$; beyond $H^-$ and to its past is the white hole
   region (unshaded).
    Shown in the
   figure is a radial null geodesic $\gamma$ that originates at the point $q$ at past null infinity in the asymptotically flat region on the left.   It crosses $S$ in the ``wormhole'' region, but it does not
   ``traverse the wormhole'' and enter the asymptotically flat region on the right; rather it enters the black hole region and terminates on the future singularity.      \label{Fig40M}}\end{center}
\end{figure} 
The motivating example of topological censorship is the analytically continued Schwarzschild solution (fig. \ref{Fig40M}).  This is a globally hyperbolic spacetime with
 two asymptotically flat ``ends,'' labeled I and II
in the figure.  The initial value surface $\S$ 
is actually quite similar to what was depicted in fig. \ref{Fig37M}(a).  The left and right ends of $\S$ are respectively in the asymptotically  flat regions I and II; the interior part of $\S$
 passes through the wormhole.   But as one can see from the Penrose diagram, a causal signal from one asymptotically flat region cannot travel through the wormhole to the other
region. If one enters the wormhole from the left, hoping to traverse it and to come out on the right, one will instead end up at the black hole singularity.



  Topological censorship \cite{topocensor} says that, in a spacetime that satisfies the null energy condition (and the classical Einstein equations), this is the general situation: there may be a wormhole in space, but
  an observer cannot probe it, in the sense that it is not
  possible for a causal signal to go through the wormhole and come out the other side.   In proving this, it suffices to consider a wormhole that connects two
  distinct asymptotically flat worlds, as in fig. \ref{Fig37M}(a).   The case of fig. \ref{Fig37M}(b) can be reduced to this, without affecting the classical
  null energy condition, by taking a cover of spacetime.
  
  Let $M_1$ and $M_2$ be two asymptotically flat ``ends'' of spacetime.   If it is possible for a causal signal to travel through the wormhole from $M_1$ to $M_2$, 
then such a signal could originate in the far past and at a great distance on $M_1$, travel through the wormhole, and propagate on $M_2$ to an observer
at a great distance.  To exploit this observation, we proceed as follows.

  The line element of $M_1$ is asymptotic at infinity to the Minkowski line element
\be\label{woggo}\ds^2=-\d t^2+\d r^2+r^2\d \Omega^2,\ee
where $\d\Omega^2$ is the line element of a $(\D-2)$-sphere.    Let $W$  be a sphere embedded in $M_1$ by, say, $r=r_0$, $t=-r_0+k$,
where $k$ is a constant and $r_0$ is taken to be very large.   Thus $W$ is embedded in $M_1$ at a very great distance from the wormhole and in the far past, in such
a way that
 the ``advanced time'' $t+r=k$ remains fixed.   The purpose of this is to ensure that a signal can be sent in from $W$  to arrive at the wormhole at a time of order 1, independent of $r_0$.
By varying $k$, we can adjust when the signal will arrive at the wormhole.  We will see that regardless of the choice of $k$, a signal from $W$ cannot
travel through the wormhole.  

In region $M_2$, we take $\I$ to be the worldline of an observer more or less at rest a great distance from the wormhole.\footnote{One could  introduce
Penrose's ``conformal null infinity,'' and  take $W$ to be a two-sphere in past null infinity on $M_1$, while $\I$ could be replaced by a 
 null worldline in future null infinity on $M_2$.   That  gives a simple framework to make the following argument rigorous.
We will not enter into that degree of detail.}

If it is possible for a signal to propagate from $M_1$ through the wormhole and to emerge in $M_2$, then it is possible for such a signal to be emitted from $W$ (perhaps
with $k$ chosen to be sufficiently negative), travel into the interior of $M_1$, pass through the wormhole, and eventually emerge to be detected in $M_2$ by the observer
traveling along $\I$.   If there is a causal path that propagates in this way from $W$ to $\I$, then there is a prompt causal path of 
this type, which arrives on $\I$ as soon as possible.
This prompt causal path will be a future-going null geodesic $\ell$, orthogonal to $W$ and without focal points.

Given how $W$ was defined, the future-going null geodesics orthogonal to $W$ propagate either ``outward,'' to larger $r$, or ``inward,'' to smaller $r$.
The outward-going null geodesics simply propagate outward to $r=\infty$ in the asymptotically flat region.   It is the inward-going null geodesics that might propagate
into the wormhole.    However, the inward-going null geodesics have an initially negative value of the null expansion $\theta=\dot A/A$.   Assuming the null energy condition,
Raychaudhuri's equation implies that these inward-going null geodesics reach focal points within a bounded value of their affine parameters.   As $\I$ can be arbitrarily
far away in $M_2$, it follows that all of these inward-going null geodesics reach focal points before reaching $\I$.    But this shows that there can be no prompt
causal path from $W$ to $\I$, and hence that there can be no such causal path at all.




\subsection{The Averaged Null Energy Condition}\label{anec}

  In our discussion of topological censorship,
we have assumed the null energy condition.   This is a pointwise condition on the stress tensor and was discussed in section \ref{nullraych}.
The null energy  condition is satisfied by reasonable classical matter, but  in quantum field theory,
 it is not satisfied by the expectation value of the quantum stress tensor.   So the question arises of whether topological censorship is valid in a quantum 
 universe.
 
 It turns out that topological censorship is valid under a weaker hypothesis known as the  ``averaged null energy condition'' (ANEC).\footnote{The use of integrated conditions such as the ANEC
 to prove results in General Relativity was introduced in \cite{Tipler}.} 
For a complete null geodesic $\ell$ , with affine parameter $U$ that runs to infinity at both ends, the ANEC asserts that
\be\label{zoffo}\int_\ell \d U \,T_{UU}\geq 0.\ee 
Here
\be\label{moffo} T_{UU}=\frac{\d x^\alpha}{\d U}\frac{\d x^\beta}{\d U} T_{\alpha\beta}. \ee
In the same notation, the null energy condition gives
\be\label{loffo}T_{UU}\geq 0. \ee
Clearly, the ANEC is a strictly weaker condition.

For the applications that we will give, one can think of the ANEC as a statement about the stress tensor of a classical spacetime: a certain integral is
nonnegative.  However, the ANEC is most often considered as a statement about quantum field theory in a background spacetime.
In that context, the ANEC is taken to mean that the operator $\int_\ell \d U \,T_{UU}$ is nonnegative, in the sense that its expectation value in any quantum state $\Psi$ is
nonnegative.   With that understanding of what the  statement means, the ANEC is not true in general, even if the null geodesic $\ell$ is complete (meaning that its affine
parameter extends to infinity in both directions).   For a simple counterexample,
consider the cylindrical spacetime of eqn. (\ref{zorfo}).  We earlier used this spacetime to illustrate the fact that a null geodesic is not necessarily achronal.  
To get a counterexample to the ANEC, consider a conformally invariant quantum field theory in the cylindrical spacetime.
The ground
state of a conformal field theory in this spacetime  has a negative Casimir energy.   Moreover, by translation invariance, the energy density in this state is a constant
in spacetime.    The integrand in the ANEC integral (for any null geodesic $\ell$)  is therefore negative-definite in this example, and the ANEC is not satisfied.

 It is believed that the ANEC may hold under two additional conditions:   the null geodesic in question should be achronal, and the spacetime should be 
self-consistent, meaning roughly that the Einstein equations are obeyed with a source given by the expectation of the stress tensor \cite{WY,PSW,GO}.
This has not been proved.   One basic result is that the ANEC holds for a geodesic in Minkowski space \cite{FLPW,HKT}.    There are partial results for more
general spacetimes \cite{KO}.


For our purposes, what is interesting about  the ANEC is that it suffices for some of the applications of the classical null energy condition, including topological
censorship.    In section \ref{cdp}, we will show that if $\ell$ is a null geodesic that extends in both directions to infinite values of its affine parameter, and if the ANEC is satisfied for
$\ell$ as a strict inequality,
\be\label{zoddo}\int_\ell \d U \,T_{UU}>0, \ee
then a segment of $\ell$ that is sufficiently extended in both directions is not prompt.   In the proof of topological censorship in section \ref{cc}, the key was to consider a hypothetical
prompt null geodesic $\ell$ between a sphere $W$ that is extremely far away in the asymptotically flat region $M_1$ and a timelike path $\I$ that is extremely far away in the asymptotically
flat region $M_2$.  Such an $\ell$ can be continued indefinitely  in the past and future in the two asymptotically flat 
regions, and its segment connecting $W$ to $\I$ can extended arbitrarily in both directions by moving $W$ and
$\I$ off to infinity in their respective regions.     So if we know that the ANEC would hold with a strict inequality, such an $\ell$ cannot exist and topological censorship holds for this spacetime.

What about the possibility that the ANEC would be saturated for $\ell$, in the sense that $\int_\ell \d U \,T_{UU}=0$?    
Then we can reason as follows.   If $M$ is a spacetime in which causal communication is possible from one asymptotically flat region to another, violating
topological censorship, then after a sufficiently small perturbation of $M$, causal communication between the two regions is still possible so topological censorship is
still violated.   If the ANEC is saturated by a complete null geodesic $\ell\subset M$, then after a suitable infinitesimal perturbation of $M$ -- for example, by adding a small amount of 
positive energy nonrelativistic matter
near one end of $\ell$ --
we get a spacetime $M'$ on which the ANEC holds as a strict inequality.   Thus $M'$ satisfies topological censorship, and hence so does $M$.





\subsection{The Gao-Wald Theorem}\label{gaowald}

For the next topic, the reader will need a basic familiarity with the AdS/CFT correspondence,
that is the correspondence beween quantum gravity in an asymptotically Anti de Sitter spacetime and conformal field theory (CFT) on the conformal boundary of the spacetime
(for an overview, see \cite{Overview}).


\begin{figure}
 \begin{center}
   \includegraphics[width=3.8in]{Fig38M} 
 \end{center}
\caption{\small  (a) According to the AdS/CFT correspondence, a quantum gravity theory in the Anti de Sitter spacetime $M$ is equivalent to an ordinary quantum
field theory on a spacetime $N$ of one dimension less which is the conformal boundary of $M$.   (b)   In the boundary theory, an event at a point $q\in N$
can influence an event at $p\in N$ if a future-going causal curve in $N$ can propagate from $q$ to $p$.  
Causality will be violated if it is possible to take a shortcut through the bulk, in the sense
that a future-going causal curve in $M$ can propagate from $q$ to a point $r\in N$ that cannot be reached from $q$
by a causal path in $N$. In the figure, the curve $qp$ is a causal curve in the boundary
while $qr$ is a hypothetical causality-violating shortcut in the bulk. The Gao-Wald theorem asserts that such causality
violation does not occur.
 \label{Fig38M}}
\end{figure}

Let $M$ be an asymptotically AdS spacetime, that is a spacetime that is asymptotic at spatial infinity to Anti de Sitter space. By adding some points at spatial infinity,
one can construct a partial conformal compactification of $M$.   The points at infinity make up a Lorentz signature manifold $N$, whose dimension is one less than the
dimension of $M$, and AdS/CFT duality says that a gravitational theory on $M$ is equivalent to some
conformal field  theory on $N$.   The picture is schematically indicated in fig. \ref{Fig38M}(a). 

The Gao-Wald theorem \cite{Gao-Wald} says that, assuming the null energy condition, or more generally assuming the ANEC,
 the AdS/CFT correspondence is compatible with causality.   This means the following.   In the boundary CFT, an event  $q$ can
influence an event  $p$ only if there is a future-going causal path from $q$ to $p$ in $N$.    But in the bulk gravitational theory,  $q$ can influence
 $p$ if there is a future-going causal path between them in $M$.   AdS/CFT duality violates causality if it is possible to ``take a shortcut through the bulk,'' that
is, if a causal path from $q$ through $M$ can arrive at a boundary point that could not be reached by a causal path  in the boundary.
In more detail, if $p$ can be reached from $q$ by a causal path in the boundary that is prompt among causal paths in the boundary, then the duality violates
causality if there is a bulk causal path
from $q$ to a boundary point $p'$ that is strictly to the past of $p$  (fig. \ref{Fig38M}(b)).


In empty AdS spacetime, every null geodesic is prompt, and a bulk null geodesic from $q$ can arrive on the boundary precisely at $p$, but no earlier.   In other words, the causality condition
is precisely satisfied in empty AdS spacetime.


  What happens if one perturbs away from empty AdS, by adding some matter or gravitational 
perturbations?  The Gao-Wald theorem says that, assuming the null energy condition -- or more generally the ANEC -- 
there is never a causality-violating shortcut through the bulk.

If there is a causality-violating shortcut, then there is one that is prompt in the sense that on some chosen
timelike worldline $\I$ through $p$, it arrives as soon as possible at some point $p'\in\I$ that is strictly to the past of $p$.  
This prompt shortcut will be a null geodesic $\ell$ without focal points.

To show that this situation cannot occur, we need to know that the affine parameter of a null geodesic diverges as it reaches the conformal boundary of an asymptotically
AdS spacetime.   This happens even though the time, as measured on the boundary, does not diverge.    In suitable coordinates, the line element of an asymptotically AdS
spacetime looks near the conformal boundary like
\be\label{wonfo} \ds^2=\frac{R^2}{z^2}\left(-\d t^2+\d z^2+\d \vec x^2\right), \ee
where $R$ is the radius of curvature (see Appendix \ref{ads}).
The spacetime is the region $z>0$; the conformal boundary is at $z=0$.   A typical null geodesic is 
\be\label{bonfo} z=-t, ~~\vec x=0,~~~ t\leq 0,\ee
and clearly reaches the boundary at $z=0$ at a finite value of $t$, namely $t=0$.  However, the affine parameter of this geodesic diverges as $t\to 0^-$.  To see this, one observes
that the equation $D^2 x^\mu/ D\lambda^2=0$ for a geodesic with affine parameter $\lambda$ gives in this case 
\be\label{lonfo}\frac{\d}{\d\lambda}\left(\frac{1}{z^2}\frac{\d t}{\d\lambda}\right)=0,\ee
so 
\be\label{ponfo}\frac{1}{z^2} \frac{\d t}{\d\lambda}=w, \ee
with a constant $w$.  This constant cannot be zero, since $t$ is not constant in the geodesic (\ref{bonfo}).    Setting $z=-t$, we get
$\d t/t^2=w\d \lambda$, so that up to an additive constant, $\lambda = -1/wt$.   Thus $\lambda$ diverges as $t\to 0^-$.  

Now let us return to our hypothetical causality-violating prompt geodesic $\ell$, a shortcut through the bulk from $q$ to a point $p'$ that is strictly to the past of $p$.
If the ANEC is satisfied along $\ell$ with a strict inequality,
\be\label{zonfo} \int_\ell \d U \,T_{UU}>0,\ee
then, since the affine parameter of $\ell$ diverges at both ends,
  the analysis in section \ref{newlook} will show that $\ell$ cannot be prompt and therefore the hypothetical causality-violating shortcut $\ell$ cannot exist.



As in the discussion of topological censorship, we can deal as follows with the possibility that the ANEC might be saturated,
\be\label{zonfox} \int_\ell \d U \,T_{UU}=0.\ee
 We perturb the spacetime slightly, adding an infinitesimal amount of matter or slightly changing the quantum state
so that the ANEC is satisfied with a strict inequality.   For a suitably small perturbation, $\ell$ will arrive on the conformal boundary so close to $p'$ as to be still strictly
to the past of $p$.   Then we get the same contradiction as before.


Of course, as a special case of this, we could have deduced the Gao-Wald theorem from the classical null energy condition $T_{UU}\geq 0$ rather than the ANEC.



\section{Another Look At Promptness}\label{newlook}

\subsection{Overview}\label{overview}

  In sections \ref{geofocal} and  \ref{ng}, we  studied a geodesic $\ell$  that originates at a specified point $q$ or a  suitable specified  submanifold $W$,
and investigated the behavior when $\ell$ is continued into the future.   One of the main ideas was that $\ell$, when continued past a focal point, is not proper time maximizing (in the
timelike case) or prompt (in the null case).    The goals of the present section are to justify these claims in a more precise way for the case of null geodesics,\footnote{We could
study timelike geodesics in a similar (and somewhat simpler)
way, but the ideas we will describe give more value added in the case of null geodesics.}  to explain a claim about the averaged null energy condition (ANEC) that was made
in section \ref{anec}, and to discuss complete achronal null geodesics.

 We explore in sections \ref{cdp} and \ref{igd} the causal paths that originate at a specified point $q$. In section \ref{ong} we will explore in a similar way the causal paths that originate on
 a codimension 2 spacelike submanifold $W$.    In section \ref{sra}, we tie things together by rederiving the Raychaudhuri equation, which was the main tool in section \ref{ng}, from a
 ``Schr\"{o}dinger'' equation -- essentially the equation of geodesic deviation --  which will be the main tool in the present analysis.   In section \ref{cang}, we discuss complete achronal
 null geodesics.  
 
 
\subsection{Causal Deformations And A Necessary Condition For Promptness}\label{cdp}

Let $\ell$ be a null geodesic.   We essentially already described
in fig. \ref{Fig23M} of section \ref{prompt} a necessary condition for a segment $qp$ of $\ell$ to be prompt:   $qp$ will fail to be prompt if a proper subsegment $rr'$ of $qp$ can be
deformed, at least to first order, to a nearby null geodesic $\gamma$ from $r$ to $r'$ (in which case we say that $r$ and $r'$ are conjugate points along $\ell$). 
For then, by replacing the $rr'$ segment of $\ell$ with $\gamma$, we get a causal path from  $q$ to $p$ which is not a null geodesic, so as usual it can be modified to  make a causal path from $q$ that arrives in the past of $p$.    The reasoning still applies if $q=r$ or $p=r'$ (but not both). 

In this section, we will justify that reasoning in a more precise way, and also deduce some further properties.
It is convenient  to use the fact that along a null geodesic $\ell$, it is possible to pick  coordinates $U,V,X^A$, $A=1,\cdots,\D-2$,  such that $\ell$ lies
at $V=X^A=0$ and along $\ell$ the metric coincides with the Minkowski space metric up to quadratic order in $V$ and $X^A$:
\be\label{kofflox}\d s^2=-2\d U \d V +\sum_{A=1}^{\D-2} (\d X^A)^2+\O(V^2,VX^A,X^A X^B). \ee   Such coordinates are called Fermi normal coordinates.
The reason that such coordinates exist is as follows.  In Riemannian geometry, there is no invariant information in the metric tensor and its first derivative at a given point; all invariant local information
is contained in the Riemann tensor, which depends on the second derivative of the metric, and  covariant derivatives of the Riemann tensor, which depend on higher derivatives.
Similarly,  there is no invariant information in the metric tensor and its first derivative along a given geodesic $\ell$ beyond whether
$\ell$ is timelike, spacelike, or null.  Hence the metric can be put in standard form along $\ell$, up to second order.  The procedure to do so was described for spacelike or timelike
geodesics in \cite{MM}, and extended to null geodesics in \cite{Blau}.
   In Fermi normal coordinates, the geodesic
equation $D^2 X^\mu/D\lambda^2=0$  is satisfied with $V=X^A=0$, $U=\lambda$.  In other words, for an affine parameter for the geodesic $\ell$ at $V=X^A=0$, we can take
simply $\lambda=U$.

Since the first derivative of the metric vanishes along $\ell$ in Fermi normal coordinates, the Riemann tensor along $\ell$ can be expressed in a relatively simple way in terms of
second derivatives of the metric tensor.    The special case of this that we will need is that along $\ell$
\be\label{woflox} R_{AUBU}=-\frac{1}{2}\frac{\partial^2 g_{UU}}{\partial X^A \partial X^B} . \ee
In verifying this, one uses the fact that the first derivatives of the metric vanish along $\ell$, and also that $\partial_U \partial_A g_{BU}=\partial^2_U g_{AB}=0$ along $\ell$ (since $\partial_A g_{BU}
=\partial_U g_{AB}=0$ along
$\ell$ for all $U$).  

We aim to find a useful condition that will ensure that $\ell$ is not prompt as a path from the point $q$ with $\lambda=\lambda_0$ to the point $p$ with $\lambda=\lambda_1$ (for some choices of 
$\lambda_0$ and $\lambda_1$).   For this aim, we can
 consider deformations of $\ell$ that  preserve the fact that it is a causal curve that originates at the point $q$, 
 but do not necessarily satisfy the geodesic equation.  (In  section \ref{igd}, we will see that in a sense, the optimal deformation actually does satisfy the geodesic equation.) 
 The condition for a curve to be causal is simply
that
\be\label{toflox}-g_{\mu\nu}\frac{\d X^\mu}{\d \lambda}\frac{\d X^\nu}{\d\lambda}\geq 0 \ee
for all $\lambda$.   In deforming $\ell$, there is no point in modifying the relation $\lambda=U$, since such a modification would just amount to reparametrizing  $\ell$.    But we do want to modify
the relations $V=X^A=0$.   

The obvious idea might be to expand $V=\veps v(\lambda)+\O(\veps^2)$,  $X^A=\veps x^A(\lambda)+\O(\veps^2)$, with a small parameter $\veps$, which we may as well assume
to be positive.   However, if we proceed in this way,
then  to first order in $\veps,$ the causality condition (\ref{toflox}) depends only on $v$ and just says that
\be\label{noggy}\frac{\d v}{\d\lambda}\geq 0, \ee
so that $V$ is an increasing function of $\lambda$.    But in this case, the deformed curve $\ell'$, if it starts out on $ \ell$ at $\lambda=\lambda_0$,
 enters the future of $\ell$ as soon as $\d v/\d\lambda>0$.   The most prompt deformation
in order $\veps$ is simply the one for which $\d v/\d\lambda=0$, which together with the initial condition $v(\lambda_0)=0$ implies that $v(\lambda)$ is identically 0.

We get a more interesting test of whether $\ell$ is prompt if we set $V=\veps^2 v(\lambda)+\O(\veps^3)$,  $X^A=\veps x^A(\lambda)+\O(\veps^2)$, so that $X^A$ is perturbed in
linear order, but  $V$ is perturbed only in quadratic order.     With this choice, the causality condition (\ref{toflox}) is trivial up to order $\veps^2$, and in that order it gives
\be\label{norfox} 2 \frac{\d v}{\d\lambda}- \sum_{A=1}^{\D-2} \left(\frac{\d x^A}{\d\lambda}\right)^2 +\sum_{A,B=1}^{\D-2} x^A x^B R_{AUBU}\geq 0. \ee
(In expanding the causality condition to second order, one has to take the second derivative of $g_{UU}$; evaluating this via eqn. (\ref{woflox}) leads to the curvature term in eqn. (\ref{norfox}).   Terms
involving the first derivative of $g_{UU}$ do not contribute, because this vanishes along $\ell$ in Fermi normal coordinates.)
For example, consider a perturbed curve $\ell'$ defined by  a perturbation such that $x^A$ vanishes outside the  interval $I$ defined by $\lambda_0\leq \lambda\leq \lambda_1$.  Moreover, suppose that
$v(\lambda_0)=0$, so $\ell'$ and $\ell$ coincide at $\lambda=\lambda_0$.   Then integrating (\ref{norfox}), we get
\be\label{porfox} v(\lambda_1)\geq \frac{1}{2} J(x^A), \ee
where
\be\label{lorfox} J(x^A)=\int_I \d \lambda\left( \sum_{A=1}^{\D-2} \left(\frac{\d x^A}{\d\lambda}\right)^2 -\sum_{A,B=1}^{\D-2} x^A x^B R_{AUBU}\right). \ee

Now to get a useful criterion under which $\ell$ is not prompt, let $p$ be the point on $\ell$ with $U=\lambda_1$, $V=X^A=0$.
Suppose that $x^A(\lambda_1)=0$ and $v(\lambda_1) <0$; then at $\lambda=\lambda_1$, $\ell'$ reaches the point $p'$ with coordinates $U=\lambda_1$, $X^A=0$, $V=-\veps^2 |v(\lambda_1)|<0$.
The point $p'$ is on the past light cone of $p$.    If such a causal path $\ell'$ from $q$ to $p'$ exists, then for $\lambda$ slightly less than $\lambda_1$, $\ell'$ is
inside the past light cone of  $p$. 
Thus, in this case, $\ell$ is not prompt as a path from $q$ to $p$.


In short, $\ell$ is not prompt if it can be deformed   to a causal curve $\ell'$ that coincides with $\ell$ at $\lambda=\lambda_0$ (and therefore has $x^A=0$ there)
and  at $\lambda=\lambda_1$ satisfies $x^A=0$, $v<0$.   In other words, $\ell$ is definitely not prompt if we can have $x^A=0$ at both ends of the interval and $v(\lambda_0)=0$, $v(\lambda_1)<0$.
Since the lower bound on $v(\lambda_1)$ associated to causality is $v(\lambda_1)-v(\lambda_0)\geq J(x^A)/2$,  we can arrange for this if and only if it
is possible for the functional $J(x^A)$ to be negative for a function $x^A$ that vanishes at both endpoints of the interval.  

To state this differently, in order for $\ell$ to be prompt on a given interval $I$, the functional $J(x^A)$, evaluated on functions that vanish at the endpoints of $I$, must be nonnegative.   The condition for a functional such as $J(x^A)$ to be nonnegative 
is of a type that may be familiar from nonrelativistic quantum mechanics.   Think of $x^A$ as the components of a column vector that represents a quantum state $\Psi$.
Define the ``Hamiltonian''
 \be\label{acf}H=-\delta_{AB}\frac{\d^2}{\d\lambda^2}+P_{AB} ,\ee
with the matrix-valued potential
\be\label{hacf} P_{AB}=-R_{AUBU}. \ee
Then 
\be\label{nogod} J(x^A)=\langle\Psi|H|\Psi\rangle, \ee
and the condition for $J(x^A)$ to be nonnegative is simply that the operator $H$, acting on wavefunctions that vanish at the endpoints of the interval $I$, is nonnegative.
The condition for $x^A$ to vanish at each end of the interval represents what we will call Dirichlet boundary conditions.

The ground state energy of $H$ on a sufficiently small interval with Dirichlet boundary conditions is strictly positive, because the ``kinetic energy'' $-\delta_{AB}\frac{\d^2}{\d\lambda^2}$, which
is positive, dominates over the ``potential energy'' $P_{AB}$.
The ground state energy on an interval $[\lambda_0,\lambda_1]$  
is monotonically decreasing as the interval is enlarged, because the ground state on one interval can be
used as a variational trial wavefunction on a larger interval.   So there will be a zero-mode on some interval if and only if the ground state energy is negative on a sufficiently large interval.    A
zero-mode is related to a deformation that satisfies the geodesic equation, as we will discuss in section \ref{igd}.  Verifying this will give a more precise demonstration of the
the relationship between focal points and promptness that we presented in section \ref{ng}.


Now let us specialize to the case that $\ell$ is  a complete null geodesic, one whose affine parameter is unbounded in both directions.  The ground state energy is then negative
on an interval that is extended sufficiently in both directions if and only if it is negative on the whole real line.
An obvious way to prove that the ground state energy is negative on the whole real line is to find a trial wavefunction $x^A(\lambda)$ in which the expectation value of $H$
is negative.   Suppose that there is a constant $c^A$ such that for $x^A=c^A$, the  potential energy integrated over all of $\ell$  is negative:
\be\label{woblo} 0> \int_{\ell}\d\lambda \,c^A P_{AB} c^B=-\int_\ell\d\lambda\, c^A c^B R_{AUBU}. \ee
If we naively use $c^A$ as a variational wavefunction on the whole line, then the kinetic energy vanishes, and eqn. (\ref{woblo}) says that the potential energy is negative.
This suggests that the ground state energy is negative on the whole
line and therefore also on a sufficiently large interval.

We have to be a little more careful because the constant $c^A$ is not square-integrable and so cannot be used as a variational wavefunction.
However, we can get around this by using a variational wavefunction $x^A(\lambda)=c^A\exp(-\alpha\lambda^2)$, for sufficiently small positive $\alpha$.   The kinetic energy vanishes (as $\alpha^{1/2}$)
for $\alpha\to 0$, while the limit of the potential energy for $\alpha\to 0$ is simply\footnote{We assume $R_{AUBU}$ vanishes sufficiently rapidly for $U\to\pm\infty$ to make the integral
converge and to justify this statement. However, see \cite{Ciccone, Borde} for more careful analysis.}
 the original integral $-\int_\ell\d\lambda\, c^A c^B R_{AUBU}$.
Given this, if the  inequality (\ref{woblo}) is satisfied for some constant $c^A$, it follows that the ground state energy is negative on a sufficiently large interval. 

 How can we find a suitable
$c^A$?   If we average the inequality (\ref{woblo}) over all possible choices of $c^A$, we get simply 
\be\label{unvi} 0>-\int_\ell \d U  R_{UU},\ee
where since $\lambda=U$, we write the integration variable as $U$. 
If this condition is satisfied, then certainly (\ref{woblo}) must be satisfied for some $c^A$, and again the ground state energy is negative on a sufficiently large interval.

But via Einstein's equation $R_{UU}=8\pi G T_{UU}$, eqn. (\ref{unvi}) is equivalent to 
\be\label{wunvi}\int_\ell \d U \,T_{UU}>0,  \ee
which is the averaged null energy condition or ANEC  with a strict inequality.   Thus if the ANEC holds for $\ell$ with a strict inequality, 
then the ground state energy is negative on a sufficiently large interval, and $\ell$ is not achronal.  




\subsection{Interpretation In Terms Of Geodesic Deviation}\label{igd}

In section \ref{cdp}, we found a necessary condition for $\ell$ to be prompt: the operator $H$ cannot have a zero-mode on any interval $I$ that is properly contained in $\ell$.   On the other hand, in section
\ref{overview}, we claimed as a necessary condition for promptness that the segment $I$ of $\ell$ cannot be displaced, to first order, to a nearby null geodesic segment between the same two endpoints.
The relation between the two statements is s   null geodesic displacements of $\ell$ correspond to zero-modes of $H$.   To explain this, we describe  the equation that governs a linearized perturbation of a geodesic; this is often called the equation of geodesic deviation, and its solutions are called Jacobi fields.  We will see that perturbations of a null geodesic on a given interval,
satisfying the geodesic equation to first order in the perturbation, are in natural correspondence with zero-modes of $H$.

   The path $X^\mu(\lambda)$ is a null geodesic with affine parameter $\lambda$ if 
\be \label{toggo}0=\frac{D^2 X^\mu}{D\lambda^2}=\frac{\d^2 X^\mu}{\d\lambda^2}+\Gamma^\mu_{\alpha\beta}\frac{\d X^\alpha}{\d\lambda}\frac{\d X^\beta}{\d\lambda}
\ee
and
\be\label{woggomm}0=g_{\mu\nu}\frac{\d X^\mu}{\d\lambda}\frac{\d X^\nu}{\d\lambda}.\ee  (For the moment, we write these equations in general without specializing to Fermi normal coordinates.)
We describe a perturbation of the null geodesic by 
$X^\mu_\veps(\lambda)=X^\mu(\lambda)+\veps x^\mu(\lambda)+{\mathcal O}(\veps^2)$, where $\veps$ is a small parameter.    In order for the perturbation to describe a null geodesic
up to first order in $\veps$, it should satisfy the linearized equations
\be \label{toggof}0=\frac{D^2 x^\mu}{D\lambda^2}+R^\mu{}_{\nu\alpha\beta} \frac{\d X^\nu}{\d\lambda}\frac{\d X^\beta}{\d\lambda} x^\alpha\ee
and
\be\label{toffox} 0= g_{\mu\nu}\frac{D x^\mu}{D\lambda}\frac{\d X^\nu}{\d\lambda}.\ee   
These equations always have uninteresting solutions that reflect the possibility of redefining the affine parameter of the original geodesic by $\lambda \to a\lambda+b$, with real constants $a,b$.
Concretely, these solutions take the form
\be\label{noffox}x^\mu=\alpha \frac{\d X^\mu}{\d\lambda}+\beta \lambda \frac{\d X^\mu}{\d\lambda},~~~~~\alpha,\beta\in\R.\ee 
Such solutions just describe a reparametrization of the original geodesic, not a displacement of it.   We are, of course, interested in nontrivial solutions that actually describe displacements.  

To get a null geodesic displacement of the segment $I$, we want  a solution of the linearized equations (\ref{toggof}), (\ref{toffox}) on that segment  that vanishes at the ends of the segment.   
If the endpoints  of the segment are at $\lambda=\lambda_0$ and $\lambda=\lambda_1$, we want to solve the linearized equations on the interval $[\lambda_0,\lambda_1]$ with the boundary condition
\be\label{wigo}x^\mu(\lambda_0)=x^\mu(\lambda_1)=0. \ee
The trivial solutions (\ref{noffox}) do not satisfy the boundary condition (\ref{wigo}), so this boundary condition implicitly includes a fixing of the reparametrization invariance that leads
to the existence of the trivial solutions.  Concretely, the reparametrization invariance has been fixed by specifying that after the perturbation, the values of the affine parameter at the endpoints
of the interval are unchanged.

From eqns. (\ref{toffox})  and (\ref{toggo}), we immediately deduce that
\be\label{offlox} 0 =\frac{\d}{\d\lambda}\left(g_{\mu\nu} x^\mu\frac{\d X^\nu}{\d\lambda}\right).\ee
Therefore $g_{\mu\nu}x^\mu \frac{\d X^\nu}{\d\lambda}$ is a conserved quantity along $\ell$.   This conserved quantity must vanish, since the boundary condition (\ref{wigo}) says that it vanishes
at the endpoints.   Thus we are interested in solutions of the linearized equations with
\be\label{nofflox}0=g_{\mu\nu}x^\mu\frac{\d X^\nu}{\d\lambda}. \ee


Now let us specialize to Fermi normal coordinates, $U,V,X^A$, with $\ell$ being the usual geodesic $U=\lambda$, $V=X^A=0$.   We perturb this to $U=\lambda+\veps u(\lambda)$, $V=\veps v(\lambda)$,
$X^A=\veps x^A(\lambda)$, and work to first order in $\veps$.   (Unlike section \ref{cdp}, we cannot set $u=0$.   The reason is that now we are asking for the perturbation to satisfy the geodesic
equation with affine parameter $\lambda$, while in section \ref{cdp}, there was no such requirement.)
The condition (\ref{nofflox})  just tells us that $v=0$.
Moreover, in Fermi normal  coordinates, since $\Gamma^A_{\mu\nu}=0$ at $v=x^A=0$, the equation (\ref{toggof}) reduces to
\be\label{wacb} \frac{\d^2 x^A}{\d\lambda^2}+R^A{}_{UBU}x^B=0 \ee
and 
\be\label{umab}\frac{\d^2 u}{\d\lambda^2}+R^U{}_{UBU}x^B=0. \ee
Eqn. (\ref{wacb}) is the familiar equation $H\Psi=0$, with the same Hamiltonian $H$ as in section \ref{cdp}.   On the other hand, no matter what $x^A$ may be,  there
is a unique solution of eqn. (\ref{umab}) for $u$ that obeys the boundary condition $u(\lambda_0)=u(\lambda_1)=0$.   To find this solution, pick any solution of eqn. (\ref{umab}) and then
add linear combinations of the trivial solutions (\ref{noffox}) of the homogeneous equation $\d^2 u/\d\lambda^2=0$  in order to satisfy the boundary conditions.

Thus linearized null geodesic deformations on a segment $I$  are in a natural 1-1 correspondence with zero-modes of $H$ on that segment.   Hence the criterion for promptness in terms of linearized null
geodesic deformations is equivalent to the criterion in terms of the spectrum of $H$.


Since solutions of the linear equation (\ref{wacb}) are also known as Jacobi fields,  a solution on an interval $I$ is the same
as a Jacobi field that vanishes at the endpoints of the interval.




\subsection{Orthogonal Null Geodesics}\label{ong}

So far in this section, we have considered a single null geodesic $\ell$.   However, in section \ref{ng} and in subsequent applications, it was important to also consider a family
of null geodesics that are orthogonal to a codimension two spacelike surface $W$.  Here we will adapt the present discussion to this case.   

Without any essential loss of generality, we can work in Fermi normal coordinates centered on $\ell$, and chosen so that $\ell$ intersects $W$ at $U=0$, while $W$ is defined
near $\ell$ by $U=V=0$, modulo terms of quadratic order in the normal coordinates $X^A$.  Thus
\be\label{woggi} V=f(X^A), ~~~ U=h(X^A), \ee
where $f(X^A)=f_2(X^A)+\O(X^3)$, $h(X^A)=h_2(X^A)+\O(X^3)$, and the functions $f_2(X^A)$ and $h_2(X^A)$ are homogeneous and quadratic.   
 Actually, we will see that $h_2$ plays no role and only $f_2$ is important.
 

  For some $\lambda_1>0$, we let $p$ be the point $V=X^A=0$, $U=\lambda_1$.
Thus we consider $\ell$, restricted to the interval $I=[0,\lambda_1]$, as a causal path from $W$ to $p$.   We want to know whether this path is prompt.
To find a necessary condition for promptness, we consider a small deformation of $\ell$ to a causal path $\ell'$ from $W$.   

We make the same expansion as before, defining $\ell'$ by $U(\lambda)=\lambda$, $V(\lambda)=\veps^2 v(\lambda)$, $X^A(\lambda)=\veps x^A(\lambda)$ modulo higher order terms.   We 
define
\be\label{tongi} \lambda_0=\veps^2 h_2(x^A).\ee 
and 
require 
\be\label{fongo} v(\lambda_0)=f_2(x^A(\lambda_0)).  \ee We consider $\ell'$ to be defined on the interval $[\lambda_0,\lambda_1]$.
The purpose of these 
conditions is to ensure that $\ell'$ starts on $W$ at the endpoint $\lambda=\lambda_0$ of the interval.
 (We can use $f_2$ and $h_2$ instead of $f$ and $h$, because we will only work to order $\veps^2$.)
 We do not put any constraint on $x^A(\lambda_0)$, since we want to allow $\ell'$ to originate at a different
point on $W$ than $\ell$. Suppose that it is possible to arrange so that $\ell'$ is a causal curve, $x^A(\lambda_1)=0$, and $v(\lambda_1)<0$.   Then the $\lambda=\lambda_1$ endpoint of $\ell'$
is the point $p'$ given by $U=\lambda_1$, $V=-\veps^2 |v(\lambda_1)|$, $X^A=0$.   This point is on the past light cone of $p$.   The existence of  a causal curve $\ell'$ from $W$
to a point on this past light cone implies, just as in section \ref{cdp}, that $\ell$, as a causal path from $W$ to $p$, is not prompt.   



  

Though we will not constrain $\ell'$ to be orthogonal to $W$, it will be useful later to know what would be the condition of orthogonality.
A vector field tangent to $W$ has to preserve the conditions (\ref{woggi}), so it takes the
form
\be\label{tonoggo} \frac{\partial}{\partial X^A} +\frac{\partial f(X^A)}{\partial X^A}\frac{\partial}{\partial V} +\frac{\partial h(X^A)}{\partial X^A}\frac{\partial}{\partial U}=
\frac{\partial}{\partial X^A} +\veps\frac{\partial f_2(x^A)}{\partial x^A}\frac{\partial}{\partial V} +\veps\frac{\partial h_2(x^A)}{\partial x^A}\frac{\partial}{\partial U}+\O(\veps^2). \ee
The tangent vector to $\ell'$ at $\lambda=\lambda_0$ is 
\be\label{wonoggo} \frac{\partial}{\partial U}+\veps^2 \frac{\d v(\lambda)}{\d\lambda}\frac{\partial}{\partial V} +\veps \frac{\d x^A}{\d\lambda}\frac{\partial}{\partial X^A}. \ee
The condition of orthogonality in order $\veps$ is
\be\label{onoogo} \left.\left(\frac{\d x^A}{\d \lambda}-\frac{\partial f_2(x^A)}{\partial x^A}\right)\right|_{\lambda=\lambda_0} =0. \ee



Much of the derivation in section \ref{cdp} goes through without change.   In particular, the causality condition is as before
\be\label{porfix} 2 \frac{\d v}{\d\lambda}- \sum_{A=1}^{\D-2} \left(\frac{\d x^A}{\d\lambda}\right)^2 +\sum_{A,B=1}^{\D-2} x^A x^B R_{AUBU}\geq 0. \ee  
Integrating it with $v(\lambda_0)=f_2$, we  get 
\be\label{pikk} v(\lambda_1)\geq \frac{1}{2}\t J(x^A), \ee
where now 
\be\label{colorfix}\t  J(x^A)=2f_2(x^A(\lambda_0))+\int_{\lambda_0}^{\lambda_1} \d \lambda\left( \sum_{A=1}^{\D-2} \left(\frac{\d x^A}{\d\lambda}\right)^2 -\sum_{A,B=1}^{\D-2} x^A x^B R_{AUBU}\right). \ee

Just as before, $\ell$ will fail to be prompt as a path from $W$ to $p$  if it is possible to have $\t J(x^A)<0$ along with $x^A(\lambda_1)=0$.  
The strategy to determine if $\t J(x^A)$ can be negative is the same as before.     A key is that if the $x^A$ are viewed as the components of a ``quantum state'' $\Psi$, then as before (after imposing
the right boundary condition, as we explain in a moment)
\be\label{nogodd} \t J(x^A)=\langle\Psi|H|\Psi\rangle, \ee
where $H$ is the ``Hamiltonian'' 
 \be\label{acof}H=-\delta_{AB}\frac{\d^2}{\d\lambda^2}+P_{AB}, ~~~~~~ P_{AB}=-R_{AUBU}.\ee
 The only novelty in the derivation of this statement
 is that we have to be careful with surface terms at $\lambda=\lambda_0$.    There is an explicit surface term $f_2(x^A(\lambda_0))$ in eqn. (\ref{colorfox}), and in addition when one
 integrates by parts to relate $\t J(x^A)$ to the expectation value of $H$, one picks up an additional surface term.
 In our previous discussion, $x^A$ satisfied Dirichlet boundary
conditions on the interval $I$, that is it vanished
at both ends.   This being so, there was no problem in the integration by parts.  In our present discussion, $x^A$ still satisfies
Dirichlet boundary conditions at one endpoint $\lambda=\lambda_1$,  but we do not want to constrain it in that way at the other end.
To make eqn. (\ref{nogodd}) true, we need to impose on $x^A$ a boundary condition at $\lambda=\lambda_0$ that will make the surface terms vanish.  
The  condition we need is
\be\label{wacof}\left.\left( 2f_2(x^A)-\sum_A x^A \frac{\d x^A}{\d\lambda}\right)\right|_{\lambda=\lambda_0}=0. \ee
Since $f_2(x^A)$ is homogeneous and quadratic in the $x^A$, this condition follows from (\ref{onoogo}).  In other words,
we can take the boundary condition to be that $\ell'$ is orthogonal to $W$ at the point $\lambda=\lambda_0$ where they meet.   We can think of the boundary condition
at $\lambda=\lambda_0$ as a Neumann boundary condition, while at $\lambda=\lambda_1$, $\ell'$ satisfies a Dirichlet boundary condition.    

At this point,  since $\lambda_0$ is of order $\veps^2$ and this is the only place that $\veps$ appears in the definition of $\t J(x^A)$, we can set $\lambda_0=0$
and work on the original interval $I=[0,\lambda_1]$:
\be\label{colorfox}\t  J(x^A)=2f_2(x^A(0))+\int_I \d \lambda\left( \sum_{A=1}^{\D-2} \left(\frac{\d x^A}{\d\lambda}\right)^2 -\sum_{A,B=1}^{\D-2} x^A x^B R_{AUBU}\right). \ee
Likewise in eqn. (\ref{nogodd}), we consider $H$ to be defined on that interval.
The point here is that if $\t J(x^A)$ can be negative with mixed Neumann and Dirichlet boundary conditions on the full interval $[0,\lambda_1]$, then the same is true on the interval $[\lambda_0,\lambda_1]$
if $\veps$ is sufficiently small.  

    With mixed  Neumann and Dirichlet boundary
conditions at the left and right endpoints of the interval $I=[0,\lambda_1]$, the operator $H$ is self-adjoint, and the identity (\ref{nogodd}) is satisfied for every eigenfunction of $H$.   
If the ground state energy of $H$ with mixed Neumann-Dirichlet boundary
conditions is negative,
then the ground state wavefunction gives an example of a perturbation $x^A(\lambda)$ satisfying the appropriate boundary conditions and with
$\t J(x^A)<0$, showing that $\ell$ is not prompt as a path from $W$ to $p$.   Conversely, though we will not use this, if the
spectrum of $H$ is nonnegative, then it can be shown that $\t J(x^A)$ is nonnegative, for perturbations satisfying Dirichlet conditions at $\lambda=\lambda_1$ (and without assuming
any particular boundary condition on $x^A(0)$).

Just as in section \ref{cdp}, on a sufficiently small interval, the operator $H$ with mixed Neumann-Dirichlet boundary conditions has positive ground state energy.
Moreover, the ground state energy of $H$ on an interval $[0,\lambda_1]$ is monotonically decreasing as a function of $\lambda_1$, since the ground state on one interval can
be used as a variational wavefunction on a larger interval.    Therefore, the ground state energy is negative on a sufficiently large interval if and only if there is some $\lambda_1$ such
that the ground state energy on the interval $[0,\lambda_1]$ vanishes.  If there is such a $\lambda_1$, then for every $\lambda_2>\lambda_1$, the ground state energy is
negative on the interval $[0,\lambda_2]$, and $\ell$ is not prompt on that interval.

Finally, the argument of section \ref{igd} carries over without change for the case of mixed Neumann-Dirichlet boundary conditions, and shows that a zero-mode of $H$ on an interval
$[0,\lambda_1]$ corresponds to a first-order deformation of $\ell$ as a null geodesic from $W$ to $p$ that is orthogonal to $W$.    In other words, the existence of such a zero-mode is
equivalent, in the language of section \ref{pfp},  to $p$ being a focal point of the orthogonal null geodesics from $W$.    In section \ref{pfp}, we claimed that when continued past such
a focal point, an orthogonal null geodesic is no longer prompt.   From our present standpoint, this is so because the ground state energy of $H$ becomes negative.




\subsection{The Raychaudhuri Equation and Geodesic Deviation}\label{sra}


In section 
\ref{ng}, we used Raychaudhuri's equation as a way to predict the occurrence of focal points of null geodesics that are orthogonal to a given codimension two spacelike surface $W$.  In the present section, we have done the same using the equation of geodesic
deviation, which reduced to a Schr\"{o}dinger-like equation.   This second treatment is more elaborate but gives some more detailed information.   Here we will explain
how the Raychaudhuri equation can be recovered from the more complete treatment.  

 In doing this, we will make a small generalization of our previous discussion:
we consider null geodesics that originate at a given point $q$ as well as null geodesics that are orthogonal to a given surface $W$.  (The two cases can be unified in the language
of ``twist-free null congruences,'' as explained for example in \cite{Wald}; alternatively, the first case can be put in the language of the second
by defining $W$ as a  section of the future light cone of $q$.)


\def\tr{{\mathrm {tr}}}
As before, we use Fermi normal coordinates $U,V,X^A$, $A=1,\cdots ,\D-2$,
 along a geodesic $\ell$ that is defined by $V=X^A=0$.  We consider null geodesics that are constrained either to originate from the point $q$ with  $U=V=X^A=0$
 or to be orthogonal to a specified  codimension two submanifold $W$ defined by $V=f(X^A)$, $U=h(X^A)$ (where $f,h$ and their first derivatives vanish at $X^A=0$).  We use the affine parameter $\lambda=U$, which vanishes at $q$.   
 
It will suffice to look at perturbations of $\ell$ to first order.   This means that we can set $V=0$, $X^A=\veps x^A$, and set to 0 what was called $\lambda_0$ in section \ref{ong}.
  
For $i=1,\cdots, \D-2$, there is a unique solution of the equation
\be\label{zolgo} \frac{\d^2}{\d \lambda^2}x^A + R^A{}_{UBU}x^B=0 \ee
on the half-line $\lambda\geq 0$  provided that we impose suitable initial conditions.   To study null geodesics that are constrained to originate at $q$, we choose 
the initial conditions 
\be\label{molgo} x^A(0)=0,~~~~ \left.\frac{\d x^A}{\d\lambda}\right|_{\lambda=0}=\delta^A_i, \ee
for some $i\in \{1,2,\cdots,\D-2\}$.  
For null geodesics that are constrained to originate on and be orthogonal to $W$, we choose the initial conditions
\be\label{plook} x^A(0)=\delta^A_i,   ~~~\left.\left(\frac{\d x^A}{\d\lambda}-\frac{\partial f_2(x^A)}{\partial x^A}\right)\right|_{\lambda=0}=0.  \ee
The derivation will proceed in much the same way in the two cases.


Let us denote the solution that satisfies the given initial condition as $E^A{}_i(\lambda)$.    Thus, $E^A{}_i(\lambda)$ is a $(\D-2)\times (\D-2)$ matrix and
\be\label{moood} E^A{}_i(0)=0, ~~ \left.\frac{\d E^A{}_i}{\d\lambda}\right|_{\lambda=0}=\delta^A_i \ee
in the first case
or
\be\label{woood} E^A{}_i(0)=\delta^A_i,~~~   \left.\left(\frac{\d E^A{}_i}{\d\lambda}-\left.\frac{\partial f_2(x^A)}{\partial x^A}\right|_{x^A=E^A{}_i}\right)\right|_{\lambda=0}=0 \ee
in the second case.
The equation (\ref{zolgo}) implies that
\be\label{olgo}\frac{\d^2}{\d\lambda^2}E^A{}_i +R^A
{}_{UBU}E^B{}_i =0. \ee
Multiplying on the right by the inverse matrix $(E^{-1})^i{}_C$, which satisfies $E^B{}_i (E^{-1})^i{}_C=\delta^B{}_C$, we get
\be\label{holgo}\left(\frac{\d^2}{\d\lambda^2}E^A{}_i\right) (E^{-1})^i{}_C +R^A{}_{UCU}=0. \ee
Taking the trace, 
\be\label{orgo}\Tr\, \frac{\d^2 E}{\d\lambda^2}E^{-1}+R_{UU}=0.   \ee
Equivalently,
\be\label{worgo} \frac{\d}{\d\lambda}\left(\Tr \frac{\d E}{\d\lambda} E^{-1}\right) + \Tr \left[\left(\frac{\d E}{\d\lambda} E^{-1}\right)^2\right]+R_{UU}=0. \ee

This is actually equivalent to  Raychaudhuri's equation.  To explain this, first note that the area element of a little bundle of null geodesics emanating from $q$  or of
orthogonal null geodesics emanating from $W$ is
\be\label{wacko} A= \det E. \ee    So the null expansion is
\be\label{zacko}\theta =\frac{1}{A}\frac{\d A}{\d \lambda} = \Tr\,\frac{\d E}{\d \lambda} E^{-1}. \ee 


The ``Schr\"{o}dinger'' equation (\ref{olgo}) implies that
\be\label{zackor}0=\frac{\d}{\d\lambda}\left( E^A{}_i \frac{\d E^A{}_j}{\d\lambda}-   E^A{}_j \frac{\d E^A{}_i}{\d\lambda} \right) ,\ee
where $E^A{}_i \frac{\d E^A{}_j}{\d\lambda}-   E^A{}_j \frac{\d E^A{}_i}{\d\lambda}$ is called the Wronskian.  The initial conditions (\ref{moood}) or (\ref{woood}) imply that the Wronskian vanishes at $\lambda=0$ 
and therefore this is true for all $\lambda$.  
This vanishing can be written\be\label{acko}  E^\tr E'-(E^\tr)' E =0, \ee
where $E^\tr$ is the transpose of the matrix $E$, and  the prime represents $\d/\d\lambda$.  Multiplying by $(E^\tr)^{-1}$ on the left and by $E^{-1}$ on the right, we get
\be\label{xacko} E' E^{-1}- (E^\tr)^{-1} (E^\tr)'=0. \ee 
This says that the matrix $E' E^{-1}$ is symmetric.    

Because $E' E^{-1}$ is  symmetric and its trace is $\theta$, we have
\be\label{nacko} E' E^{-1}=\frac{1}{\D-2}\theta + \sigma, \ee
where $\sigma $ is symmetric and traceless.    Eqn. (\ref{worgo}) now becomes 
\be\label{placko}\frac{\d\theta}{\d\lambda} + \frac{\theta^2}{\D-2} +\Tr\,\sigma^2 +R_{UU}=0, \ee
and this, after imposing the Einstein equation $R_{UU}=8 \pi G T_{UU}$, is the null Raychaudhuri equation (\ref{kongo}).

 From the traceless part of eqn. (\ref{holgo}), one can extract an equation that governs the evolution of $\sigma$:
\be\label{olacko} \frac{\d\sigma_{AB}}{\d\lambda}+\frac{2}{\D-2}\theta \sigma_{AB}+\sigma^2_{AB} +{\sf W}_{AUBU}=0 . \ee  
Here ${\sf W}$ is the Weyl tensor, the traceless part of the Riemann tensor: ${\sf W}_{AUBU}=R_{AUBU}-{\delta_{AB}R_{UU}}/(\D-2)$.
(In deriving eqn. (\ref{olacko}), it helps to observe that
$E'' E^{-1}=(E' E^{-1})'+(E'E^{-1})^2$.) We will see soon why this result,  which can also be obtained by
directly computing $R_{AUBU}$ in the metric (\ref{racb}), is useful.

The matrix-valued equation (\ref{olgo}) also has solutions (with different initial conditions) for which $E' E^{-1}$ is not symmetric.   In general, the antisymmetric part of $E' E^{-1}$ is
called the twist, and a solution for which $E' E^{-1}$ is symmetric is said to be twist-free.   The derivation of Raychaudhuri's equation (\ref{placko}) and of the evolution equation
(\ref{olacko}) for $\sigma$ is valid for any twist-free solution, that is, any solution whose Wronskian vanishes.


\subsection{Complete Achronal Null Geodesics}\label{cang}

Finally,  let us discuss what happens if we assume the classical null energy condition, a pointwise condition $T_{UU}\geq 0$, and not just its integrated version.

Unless $T_{UU}$ vanishes identically along $\ell$, 
the inequality (\ref{wunvi}) is satisfied and implies that $\ell$ is not achronal.   In the presence of classical fields that satisfy the null energy condition, it is rather special for $T_{UU}$ 
to vanish identically along a null geodesic, so it is very exceptional for a complete null geodesic to be achronal.   

But even in pure gravity, complete achronal null geodesics are highly nongeneric.    In the language of Hawking and Penrose, the generic condition for a null geodesic $\ell$ asserts that $R_{AUBU}$
is not identically zero along $\ell$.   As they originally argued in \cite{HP}, a complete null geodesic that satisfies the generic condition is never achronal.  
For the proof of this, first observe that in view of the evolution equation (\ref{olacko}), the generic condition implies that $\sigma$ cannot vanish identically along $\ell$.   The claimed
result will be obtained by using this fact in conjunction with Raychaudhuri's equation.

Consider the matrix-valued solution $E(\lambda)$ of the equation (\ref{olgo}) of geodesic deviation, with the initial conditions
\be\label{moowod} E^A{}_i(\lambda_0)=0, ~~ \left.\frac{\d E^A{}_i}{\d\lambda}\right|_{\lambda=\lambda_0}=\delta^A_i .\ee
Here $\lambda_0$ is a constant that we will eventually take to be very negative.

If $R_{AUBU}=0$, the exact solution for $E^A_i(\lambda)$ is
\be\label{ooood} E^A_i(\lambda)=\delta^A_i(\lambda-\lambda_0). \ee
This leads to
\be\label{noood}\theta(\lambda)= \Tr\, E' E^{-1} =\frac{\D-2}{\lambda-\lambda_0}, \ee
as well as $\sigma=0$.
Thus, $\theta(\lambda)$ is positive for all $\lambda>\lambda_0$, but it becomes very small for large $\lambda$.   More to the point, $\theta(\lambda)$ is very small for
any given $\lambda$ if $\lambda_0$ is taken to be very negative.

In general, the initial conditions (\ref{ooood}) for $E^A_i$ correspond to an initial behavior of $\theta$
\be\label{pombo}\theta\sim \frac{\D-2}{\lambda-\lambda_0}, ~~~~\lambda-\lambda_0\to 0^+.\ee
In particular
\be\label{kunombo}\left.\frac{1}{\theta}\right|_{\lambda=\lambda_0}=0.\ee
We can write Raychaudhuri's equation in the form
\be\label{knombo}\frac{\d}{\d\lambda}\frac{1}{\theta}=\frac{1}{\D-2}+ \frac{\Tr\,\sigma^2+R_{UU}}{\theta^2}. \ee
Integrating this and assuming that $R_{UU}\geq 0$, we find  in general $1/\theta\geq (\lambda-\lambda_0)/(\D-2)$, and therefore (as long as $\theta>0$)
\be\label{blombo}\theta\leq \frac{\D-2}{\lambda-\lambda_0}.\ee

We want to prove that $\theta(\lambda) $ becomes negative for some $\lambda>\lambda_0$.  In the evolution equation for $\sigma$, we have the initial condition  $\sigma=0$ at
$\lambda=\lambda_0$; moreover, the bound (\ref{blombo}) means that the $\theta\sigma$ term in the equation is not important if $\lambda_0$ is sufficiently negative.
 In any region with ${\sf W}_{AUBU}\not=0$, $\sigma$ will  be nonzero.
Suppose that, for sufficiently negative $\lambda_0$,  $\sigma\not=0$ in some interval $\lambda'\leq \lambda\leq \lambda''$. 
More specifically, assume that 
 $\Tr\,\sigma^2\geq w$ in that interval, for some $w>0$.   We assume that $\theta$ is nonnegative for $\lambda\leq \lambda'$, or there is nothing to prove.
 This being so, we can use
 the inequality (\ref{blombo}).   It  shows that by taking $\lambda_0$ to be sufficiently negative, we can ensure that $\theta(\lambda')<w(\lambda''-\lambda')$.
Since the Raychaudhuri equation implies that $\d\theta/\d\lambda\leq -\Tr\,\sigma^2$,  $\d\theta/\d\lambda$ will then be sufficiently  negative for $\lambda'\leq \lambda\leq \lambda''$  as to ensure that
$\theta(\lambda'')<0$.   Given this, as usual the Raychaudhuri equation implies that $\theta(\lambda)\to -\infty$ at some value $\lambda_1\leq \lambda''+(\D-2)/|\theta(\lambda'')|$. 


The fact that $\theta\to -\infty$ for $\lambda\to \lambda_1$ means that a linear combination of the columns of $E$ is a Jacobi field that vanishes at $\lambda=\lambda_1$.
This Jacobi field also vanishes at $\lambda=\lambda_0$, because of the initial condition (\ref{moowod}).   So we have found a Jacobi field with two zeroes, showing that $\ell$ is not
achronal.


Clearly, then, complete achronal null geodesics are very scarce.  
The main known examples of spacetimes with complete achronal null geodesics are homogeneous spaces such as Minkowski space or
Anti de Sitter space  (in these spacetimes, every null geodesic is  complete and achronal) and the Schwarzschild, Kerr, and Reissner-Nordstr\"{o}m black hole
solutions (the horizon generators are complete and achronal).
Complete achronal null geodesics actually have remarkable properties.  For example, a splitting theorem of Galloway
 \cite{Galloway2} says that any complete achronal null geodesic in a spacetime that satisfies the classical null energy condition is contained in a null hypersurface $H$ that has vanishing null expansion and
  can be defined as the boundary of the closure\footnote{The causal future or past of a null geodesic is not necessarily closed, even in a globally hyperbolic spacetime.
  What was proved in section \ref{pfp} was that  the causal future (or past) of a {\it compact} set $W$ is closed in such a spacetime.}
   of either 
 the causal future or causal past of $\ell$. $H$ is ``ruled'' by achronal null geodesics,'' meaning that every point $p\in H$ is contained in some achronal null geodesic $\ell'\subset H$.  If $\ell$ is a horizon generator of one of the usual black hole solutions, then $H$ is the black hole horizon and the $\ell'$ are the other generators.


\def\AdS{{\mathrm{AdS}}}


 
\begin{appendix}

\section{Anti de Sitter Spacetime}\label{ads}

The purpose of this appendix is to briefly describe some facts about Anti de Sitter (AdS) spacetime  that may help the reader in understanding examples
described in the text.   For simplicity, except at the end, we consider  AdS spacetime of dimension 2, denoted AdS$_2$.  This is the case that was used for
illustration in sections \ref{classic} and \ref{loran}.

An ordinary two-sphere of radius $R$ is described by the familiar equation
\be\label{fameq} u^2+v^2+w^2=R^2.\ee
The line element is
\be\label{lameq} \ds^2=\d u^2+\d v^2+\d w^2. \ee
An SO(3) symmetry is manifest.    The ``antipodal point'' of the point $q$
with coordinates $\vec X=(u,v,w)$ is the point $p$ with coordinates $\vec X'=-\vec X=(-u,-v,-w)$.
We also then say that $q$ and $p$ are a pair of antipodal points.   SO(3) maps a pair of antipodal
points to another pair of antipodal points.


A typical geodesic is the circle $w=0$, or in parametric form
\be\label{wamteq} u=R\cos\theta, ~~v=R\sin\theta,~~ w=0.\ee
The arc length along this geodesic is $R\d\theta$.     Let $q$ be the point $(u,v,w)=(R,0,0)$
and $p$ the antipodal point $(u,v,w)=(-R,0,0)$.    The geodesic in eqn. (\ref{wamteq}) passes through $q$
at $\theta=0$ and, after traversing a distance $\pi R$, it  arrives at $p$ at $\theta=\pi$.   
More generally, any geodesic through $q$ is equivalent to this one by an SO(3) rotation, and similarly arrives
at  $p$ after a distance $\pi R$.   By SO(3) symmetry, this statement holds for any point $q$ in the two-sphere:
the geodesics through $q$ have as a focal point the antipodal point $p$ to $q$, which they reach after a distance $\pi R$.



To describe Anti de Sitter space of dimension 2, we start by changing a few signs in the preceding formulas.   The equation (\ref{fameq}) is replaced by
\be\label{ameq}u^2+v^2-w^2=R^2, \ee
and the line element by
\be\label{wameq} \ds^2=-\d u^2-\d v^2+\d w^2. \ee   Because of the constraint (\ref{ameq}), this formula describes a two-dimensional spacetime
with Lorentz signature $-+$;  we will call this spacetime AdS$_2^{(0)}$.
The symmetry is now SO(2,1) rather than SO(3).   
Points with coordinates $\vec X=(u,v,w)$ and $\vec X'=-\vec X=(-u,-v,-w)$ are still defined to be antipodal.
SO(2,1) maps a pair of antipodal points to another pair of antipodal points.

 A typical timelike geodesic is the circle $w=0$, or in parametric form
\be\label{pameq} u=R\cos \theta,~~~v=R\sin\theta,~~~w=0. \ee
The elapsed proper time $\tau$ along this geodesic satisfies $\d\tau=R\d\theta$.     Let $q$ be the point $(u,v,w)=(R,0,0)$
and $p$ the antipodal point $(u,v,w)=(-R,0,0)$.    The geodesic in eqn. (\ref{wameq}) passes through $q$
at $\theta=0$ and, after a proper time $\pi R$, it  arrives at $p$ at $\theta=\pi$.   Every geodesic through $q$
is equivalent to this one by an SO(2,1) rotation and therefore all timelike geodesics through $q$ focus at the antipodal point $p$ after a proper time $\pi R$, just as in the case of the two-sphere.


The spacetime $\AdS_2^{(0)}$ that we have just described has closed timelike curves, and is not what is usually called $\AdS_2$.    Indeed, the geodesic (\ref{pameq})  in $\AdS_2^{(0)}$
is a closed timelike curve; it returns to its starting point after a proper time $2\pi R$.    A spacetime AdS$_2$ that is locally equivalent to AdS$_2^{(0)}$ but
has no closed timelike curves can be obtained by passing to the universal cover of AdS$_2^{(0)}$.     One may do this explicitly by solving the equation (\ref{ameq}) with
\be\label{wobboc} u= (R^2+w^2)^{1/2} \cos t,~~~ v=(R^2+w^2)^{1/2}\sin t.\ee
If we view $t$ as an angular variable with $t\cong t+2\pi$, these formulas give a possible description of AdS$_2^{(0)}$ with coordinates $t,w$.   Passing to the universal cover and eliminating the closed
timelike curves can be accomplished by simply regarding $t$ as a real variable.   
In terms of $t,w$, the line element takes the form 
\be\label{yotto}\ds^2=-(R^2+w^2)\d t^2 + \frac{R^2\,d w^2}{R^2+w^2}. \ee
This is one explicit description of AdS$_2$ spacetime.  

There is a map $\varphi:\AdS_2\to \AdS_2^{(0)}$ that  tells us to forget that $t$ is a real variable
and just regard it as an angle. In other words, the map $\varphi$ imposes the equivalence $t\cong t+2\pi$.  For $q\in\AdS_2$, we write $\bar q$ for $\varphi(q)$.  (Up to this
point, we have more loosely written $q$ or $p$ for a point in either $\AdS_2^{(0)}$ or its universal cover.)
A point $\bar q\in \AdS_2^{(0)}$ has infinitely many ``lifts'' to $\AdS_2$, differing by $t\to t+2\pi n$, $n\in \Z$.   

Consider the future-going  timelike geodesics through a point $q\in \AdS_2$.  When projected to $ \AdS_2^{(0)}$, they map to future-going timelike geodesics through $\bar q\in\AdS_2^{(0)}$.  After a proper
time $\pi R$, the projected geodesics focus at the antipodal point $\bar p$ of $\bar q$.   Upon lifting the picture back to $\AdS_2$, this means that future-going timelike geodesics
through $q\in\AdS_2$ focus after a proper time $\pi R$ at a  point $ p$ that is a lift of $\bar p$ to $\AdS_2$.  This focusing was depicted in fig. \ref{Fig1} of section \ref{classic}.
  What happens when we further continue the geodesics up to a proper time $2\pi R$?
In $\AdS_2^{(0)}$, they return to the starting point $\bar q$, as is evident in eqn. (\ref{pameq}).    However, in $\AdS_2$, there are no closed timelike curves, and the picture is instead that the future-going timelike geodesics
through $q$ arrive, after a proper time $2\pi R$, at another focal point $q'$ with the property that $\varphi(q')=\varphi(q)=\bar q$.  In other words, $q'$ and $q$ are two different lifts to $\AdS_2$
of the same point $\bar q\in \AdS_2^{(0)}$, differing by $t\to t+2\pi$.  If we continue the timelike geodesics through $q$ into either the future or the past, the story keeps repeating:
after a proper time $\pi R n$, for any integer $n$, one arrives at a focal point that is a lift to $\AdS_2$ of $\bar q\in \AdS_2^{(0)}$ if $n$ is even, and of $\bar p\in\AdS_2^{(0)}$ if $n$ is odd.
This repeating picture is depicted in fig. \ref{Fig1}.  

    For $\vec X=(u,v,w)$, $\vec X'=(u',v',w')$, let us define the SO(2,1) invariant $\vec X\cdot \vec X'=uu'+vv'-ww'$.    
This invariant is related  as follows to the proper time elapsed along a timelike geodesic.   Consider for example the timelike geodesic (\ref{pameq}) and let $\bar q$ and $\bar p$ be two
points on this geodesic, such as the two points that correspond respectively to 
$\vec X=(R,0,0)$ and to $\vec X'=(R\cos\theta,R\sin\theta,0)$.    The proper time elapsed from $\bar q$ to $\bar p$, assuming that one traverses this geodesic in the direction of increasing $\theta$, is
$\tau = R\theta$.    On the other hand, $\vec X\cdot \vec X'=R^2\cos \theta$.  So
\be\label{polym}\tau=R\arccos(\vec X\cdot \vec X'/R^2). \ee
By  symmetry,\footnote{The symmetry of AdS$_2$ is actually not SO(2,1) but the universal cover $\widetilde {{\mathrm{SO}}}(2,1)$
of this group.}  this formula holds for the arclength of any timelike geodesic between  points in AdS$_2$.  
For any choices of lifts of 
 $\bar q, \,\bar p\in \AdS_2^{(0)}$ to $q,p\in \AdS_2$,  the proper time elapsed on a timelike geodesic from $q$ to $p$ (if one exists) is given by eqn. (\ref{polym}), but the appropriate
 branch of the arccos function depends on the choices of $q$ and $p$.

Now let us ask the following question:   what points in $\AdS_2$ can be reached from a given point $q$ by a timelike geodesic?     It is actually equivalent to ask what points in $\AdS_2^{(0)}$ can be reached
from $\bar q$ by a timelike geodesic, since $p\in \AdS_2$ can be reached from $q$ by a timelike geodesic in AdS$_2$ if and only if $\bar p\in \AdS_2^{(0)}$ can be reached from $\bar q$
in that fashion. (If there is a timelike geodesic from $\bar q$ to $\bar p$, then its lift to AdS$_2$ gives a timelike geodesic from $q$ that, if continued far enough in the past and
future, eventually reaches $p$.)  For the example considered in the last paragraph, with the geodesic (\ref{pameq}) and with  $\bar q$ and $\bar p$ corresponding to $\vec X=(R,0,0)$ and to $\vec X'=(R\cos\theta,R\sin\theta,0)$,
we see that
\be\label{tolmo} R^2\geq \vec X\cdot \vec X'\geq -R^2,\ee
with equality in the upper or lower bound if and only if $\vec X=\vec X'$ or $\vec X=-\vec X'$.  By SO(2,1) symmetry, this result is general:   $\bar p$ can be reached from $\bar q$
by a timelike geodesic if and only if $R^2\geq \vec X\cdot \vec X'\geq -R^2$.    What happens if we consider a spacelike geodesic instead?   An example of a spacelike geodesic is
given by $u=0$, or in parametric form
\be\label{wombo}u=0,~~~ v=R\cosh \theta,~~~w=R\sinh\theta. \ee
Typical 
 points (up to the action of $\widetilde {{\mathrm{SO}}}(2,1)$)  now correspond to $\vec X=(0,R,0)$, $\vec X'=(0,R\cosh \theta, R\sinh\theta)$, so $\vec X\cdot \vec X'=R^2\cosh\theta\geq R^2$.  From the symmetry, it follows that in general
 two points in $\AdS_2^{(0)}$ with
coordinates $\vec X$, $\vec X'$ are
connected by a spacelike geodesic if and only if $\vec X\cdot \vec X'\geq R^2$.  A similar analysis shows that pairs of points in $\AdS_2^{(0)}$ are connected by a null geodesic if and only if
$\vec X\cdot \vec X'=R^2$.  
A pair of points in $\AdS_2^{(0)}$ with $\vec X\cdot \vec X'<-R^2$ are not connected by any geodesic at all. If such a pair of points is lifted to $\AdS_2$ in a suitable fashion, one
gets a pair of points   $q,p\in \AdS_2$ (such as the pair $q,p$ in fig. \ref{Fig1}) such that $p$ is in the future of $q$ but there is no geodesic from $q$ to $p$.   These remarks
account for some statements in section \ref{classic}.

Finally, let us discuss spatial infinity in AdS$_2$.   In the coordinates $t,w$ of eqn. (\ref{yotto}), spatial infinity corresponds to $w\to \pm \infty$.    Let us focus on one end, say $w\to +\infty$.  We note
that $w=\infty$  is infinitely far away along the spacelike hypersurface $t=0$, and similarly along any spacelike hypersurface that is close enough to this one.   However,
a null geodesic can reach $w=\infty$ at finite $t$.   We have actually already demonstrated this in a different guise in section \ref{gaowald}.   Let us set $z=R/w$, so that $w\to\infty$ becomes
$z\to 0$.   From eqn. (\ref{yotto}), we see that near $z=0$, the AdS$_2$ line element is
\be\label{onno}\ds^2=\frac{R^2}{z^2}(-\d t^2+\d z^2). \ee
We analyzed null geodesics in this metric in section \ref{gaowald}, showing that they reach $z=0$ at finite $t$ but at an infinite value of their affine parameter. 

It is convenient to make the change of variables $\sin\sigma=R/\sqrt{R^2+w^2}$, where $0<\sigma<\pi$ for $-\infty<w<\infty$.  The AdS$_2$ line element becomes
\be\label{onco}\ds^2=\frac{R^2}{\sin^2\sigma}\left(-\d t^2+\d \sigma^2\right). \ee
The Weyl factor $R^2/\sin^2\sigma$ does not affect the causal structure of this spacetime, which therefore  is the same as that of the strip $0<\sigma<\pi$, $-\infty<t<\infty$
in a Minkowski spacetime with line element $\ds^2 =-\d t^2+\d \sigma^2$.  This strip is depicted in the Penrose diagram of fig. \ref{Fig1}.  The boundaries of the strip are not part of the spacetime, because
of the $1/\sin^2\sigma$ factor in the line element. The boundaries are at an infinite distance along a spacelike geodesic, or at an infinite value
of the affine parameter along a null geodesic.    But it is sometimes convenient to make a partial compactification of the spacetime by including the boundaries of the strip.

To describe in a similar fashion an Anti de Sitter spacetime of dimension $\D$, denoted AdS$_\D$, we start with the spacetime AdS$_\D^{(0)}$ defined by
\be\label{domo} u^2+v^2-\vec w^2=R^2,\ee
where now $\vec w=(w_1,w_2,\cdots, w_{\D-1})$ is a $(\D-1)$-vector.   The line element
is
\be\label{womo}\ds^2=R^2(-\d u^2-d v^2+\d \vec w^2). \ee
This spacetime has closed timelike curves as before.   To eliminate them, one again passes to the universal cover by writing
\be\label{minno} u=(R^2+\vec w^2)^{1/2}\cos t,~~~~ v=(R^2+\vec w^2)^{1/2}\sin t, \ee
and viewing $t$ as a real variable. This gives a spacetime known as AdS$_\D$, parametrized by $t$ and $\vec w$. Everything we said for AdS$_2$ has a fairly close analog for AdS$_\D$.    Topologically, while AdS$_2$ is $\R\times I$, where $\R $ is parametrized
by the ``time'' $t$ and $I$ is the open interval $0<\sigma<\pi$, AdS$_\D$ is $\R\times B_{\D-1}$, where $\R$ is as before but $B_{\D-1}$ is now an open ball of dimension $\D-1$.   As in the case $\D=2$,
it is convenient to make a partial compactification by adding boundary points to $B_{\D-1}$, replacing it by a closed ball $\bar B_{\D-1}$.    The partial compactification is thus $\R\times \bar B_{\D-1}$,
as  schematically depicted in fig. \ref{Fig38M} of section \ref{gaowald}.  

We can introduce a new variable $\sigma$ by $\sin\sigma=R/\sqrt{R^2+|\vec w|^2}$.  $\sigma$
varies from $0$ to $\pi/2$ as $|\vec w|$ varies from  $\infty$ to 0.    A Penrose diagram of AdS$_\D$ that depicts the coordinates $t$ and $\sigma$ looks like just half of fig. \ref{Fig1}, for instance the left half with $\sigma\leq \pi/2$.  
A point in the diagram represents a $(\D-1)$-sphere parametrized by $\vec w$ with fixed $|\vec w|$. These $(\D-1)$-spheres sweep out all of AdS$_\D$.
 Alternatively, one can define a Penrose diagram for AdS$_\D$ that consists of a two-dimensional
slice of AdS$_\D$ with the whole range $0<\sigma<\pi$ included.  From this point of view, the Penrose diagram of AdS$_\D$ looks just like fig. \ref{Fig1}.   

\section{Two Coordinate Systems For de Sitter Space}\label{dSitter}

Here we will derive  the two forms of the de Sitter space metric that were used in eqns. (\ref{dS}) and (\ref{dSp}) in illustrating the fine print in Penrose's theorem.

De Sitter space of dimension $\D$ and radius of curvature $R$ can be described by coordinates $X_0,X_1,\cdots ,X_\D$ satisfying
\be\label{bozo} -X_0^2+\sum_{i=1}^\D X_i^2=R^2, \ee
with the line element
\be\label{nozo}\d s^2=-\d X_0^2+\sum_{i=1}^\D\d X_i^2.\ee
An SO(1,$\D$) symmetry is manifest.

To get one convenient form for the metric, let $\vec Y$ be a unit $\D$-vector, satisfying $\vec Y\cdot \vec Y=1$.   Then we can solve the constraint (\ref{bozo})
by
\be\label{wozo} X_0=R\sinh t/R, ~~\vec X=R\vec Y \cosh t/R .  \ee
The line element is
\be\label{poazo}\d s^2=-\d t^2+R^2\cosh^2 t/R \,\d\Omega^2,~~~~\d\Omega^2=\d\vec Y\cdot \d\vec Y. \ee
This accounts for the form (\ref{dS}) of the de Sitter metric.   Clearly, these coordinates cover all of de Sitter space.

For an alternative coordinate system, define
\be\label{plozo} X_0-X_\D=\sqrt 2 \, V,~~~X_0+X_\D=\sqrt 2 U. \ee
Let $\vec X$ be the $(\D-1)$-vector $\vec X=(X_1,X_2,\cdots, X_{\D-1})$,
and set
\be\label{mottob} V=- \exp(-t/R),~~~\vec X = V\vec x. \ee
The line element turns out to be
\be\label{roszo} \d s^2= -\d t^2+R^2 e^{-2t/R}\d \vec x^2. \ee This accounts for the second form of the metric in eqn. (\ref{dSp}).
Clearly, these coordinates describe only part of de Sitter space, namely the part with $V<0$.   This part is shaded gray in fig. \ref{Fig30MNew} (in the figure, $U$ increases to the upper
right and $V$ to the upper left).

The condition $V=0$ defines a hypersurface $Y$ that bounds the region described by our second set of coordinates $t, \vec x$.   This hypersurface
has interesting properties.   Let $W$ be the codimension 2 submanifold $U=V=0$.    The hypersurface $Y$ is swept out by one of the two families of null
geodesics orthogonal to $W$.   (The other family sweeps out the hypersurface $U=0$.)  The line element of $Y$ is of  the degenerate form $\d \vec X^2$.
  The null geodesics orthogonal to $W$ and tangent to $Y$ are simply defined by $V=0$,
$\vec X=\vec a$ (where $\vec a$ is a constant of length $R$).      These geodesics are complete and achronal; their expansion is 0, since a cross section
of $Y$ at any value of $U$ is a round $(\D-2)$-sphere of radius $R$, independent of $U$.   $Y$ is a cosmological horizon for some observers,
as we noted at the end of section \ref{horizon}.  The second family of null geodesics orthogonal to $W$ is defined by $U=0$, $\vec X=\vec a$, also with vanishing
expansion.   Because its null expansions vanish,
 $W$ is called a marginally trapped surface.    A point with $U,V<0$ -- such as the point $q$ in fig. \ref{Fig30MNew} -- defines a trapped surface, with
negative expansions.   

\section{Existence Of Complete Metrics Of Euclidean Signature}\label{moredetail}

 In section \ref{cpct}, we used the fact \cite{NO}  that any manifold $M$ admits a complete  metric of Euclidean signature (a metric in which every inextendible
 curve has infinite arclength).   Here we explain this fact in more detail.   
 
 First of all, the reason that every $M$ admits some Euclidean signature metric is that such metrics can be added.   A Euclidean metric  is a symmetric
 tensor field $h_{ij}(x)$  that is positive-definite for each $x$; it satisfies no other general constraint.   Any $M$ can be covered by small open sets $U_\alpha$ each of which is
 isomorphic to an open ball in $\R^n$.   To define a Euclidean signature
 metric tensor $h$ on $M$, we simply pick  for each $\alpha$ a  tensor field $h_\alpha$ that is positive-definite on $U_\alpha$ and vanishes outside $U_\alpha$,
 and add them
 up to get a tensor field $h=\sum_\alpha h_\alpha$ on $M$.   Such an $h$ is everywhere positive-definite.
  By picking the $h_\alpha$ to vanish appropriately near the boundary of the closure of $U_\alpha$, 
 one can ensure that $h$ is smooth. 
 
In general, this construction will not give a {\it complete} metric.    In constructing a complete metric, we may as well assume that $M$ is connected,
so that there is a path in $M$ between any two points $p,q\in M$.  Otherwise, we make the following argument for each connected component
in $M$.

To find a complete metric, begin with any Euclidean signature metric $h_0$.
If this metric is not complete, then there is a point $q\in M$ and an inextendible path $\gamma_0$ from $q$ that has finite length in the metric $h_0$. (The
path $\gamma_0$ ``goes to infinity in $M$ in finite length.'')
This implies that there is such a finite length inextendible path $\gamma$ from any $p\in M$: one can just define $\gamma$ as the composition
$\gamma_0 *\gamma_1$, where $\gamma_1$ is any path from $p$ to $q$ (paths are composed by joining them end to end).
So we can 
define on $M$ the following function $\upphi$  valued in the positive real numbers $\R_+$: for a point  $p\in  M$, $\upphi(p)$  is the greatest lower bound of the length  of any inextendible
 curve in $M$ that starts at $p$.  ($\upphi(p)$ is strictly positive for each $p$ because each $p$ has a small neighborhood $B$ that can be approximated by
 a ball in Euclidean space; the radius of such a ball is a lower bound for $\upphi(p)$, since any path from $p$ has to begin with a path in $B$.)   
   If $|p-q|$ is the shortest distance between points $p,q\in M$ in the  metric $h_0$, then $|\upphi(p)-\upphi(q)|\leq |p-q|$, showing that the function $\upphi$
 is continuous.
   Define  a  new metric  $h$ by $h=\exp(1/\upphi(x)) h_0$.
 Since  $1/\upphi(x)> 0$ everywhere, the length of any curve in the metric $h$  exceeds its length  in the metric $h_0$.   So  to show that  in the metric  $h$, every inextendible curve has infinite length,
 we just have to prove that if $\gamma$ is a finite length inextendible curve starting at $p$ in the metric $h_0$,
 then it has infinite length in the metric $h$.   Suppose that $\gamma$ has length $a$ in the  metric $h_0$ and parametrize it by an arclength parameter $t$ in that metric, so $t$
 ranges over a semi-open interval $[0,a)$.   For any point $t=t_0$ in this interval,  the segment $[t_0,a)$ of $\gamma$ is an inextendible
 curve from the point $x(t_0)$ that has length $a-t_0$ in the metric $h_0$.   So $\upphi(x(t_0))\leq a-t_0$ and  $1/\upphi(x(t_0)) \geq 1/(a-t_0)$. Hence $\exp(1/\upphi(x(t)))$ blows up rapidly
 for $t\to a$ and $\gamma$  has
 infinite length in the metric $h$.  Thus every inextendible curve in the metric $h$ has divergent arclength, and $M$ with this metric
 is a complete Riemannian manifold.  In particular, in the metric $h$,  inextendible
 geodesics have infinite arclength in both directions  and $M$  is geodesically complete. 
 (Conversely, geodesic completeness implies that
 all inextendible curves have infinite  length.)  



\section{Some Details About Compactness}\label{detailedproof}

Let $M$ be a globally hyperbolic spacetime, with Cauchy hypersurface $\S$, and let $q$ be a point to the past of $\S$.   Let $\CC_q^\S$ be the space of causal
paths from $q$ to $\S$.   An important fact is that $\CC_q^\S$ is compact; a corollary is that $D_q^\S$, the set of points in $M$ that can be visited by a causal path
from $q$ to $\S$, is also compact.
In section \ref{cpct}, we described some initial steps of a proof of compactness of $\CC_q^\S$, deferring details to this appendix.   We will explain two versions of the proof,
adapted respectively from \cite{Wald} (see the proof of  Lemma 8.1.5) and \cite{BEE} (see the proof of Proposition 3.31).

Let $\gamma_1,\gamma_2,\cdots$ be a sequence of causal curves from $q$ to $\S$.   It is convenient to extend the $\gamma_i$ into the future as inextendible causal curves;
for example, we can continue $\gamma_i$ to the future of $S$ as a timelike geodesic orthogonal to $S$, continued into the future for as far as it will go.

Let $\t \gamma$ be some future-going causal curve from $q$.  We do not  assume that $\t\gamma$ is inextendible.  $\t\gamma$ has $q$ as a past endpoint.\footnote{We use the term ``endpoint'' in
this familiar sense, and not in a more technical sense
that the term is used in mathematical relativity.   See footnote \ref{technical} of section \ref{def}, and the accompanying discussion.}   It is convenient
in the following to assume that $\t\gamma$ does not have a future endpoint
 and so is topologically a semi-open interval $[0,1)$.  (If $\t\gamma$ has a future endpoint, we omit this point.)
We say that $\t\gamma$ is a partial limit curve of the $\gamma_i$ if, after possibly passing to a subsequence, the $\gamma_i$  have initial segments
that converge to $\t\gamma$.    
  We call such a $\t\gamma$ a {\it partial} limit curve,
because  the $\gamma_i$ may possibly  continue to the future of $\t\gamma$.   Only initial segments of the $\gamma_i$ are assumed to converge to $\t\gamma$.

The argument in section \ref{cpct} shows that partial limit curves exist, and moreover that if $\t\gamma$ is a partial limit curve that can be extended as a curve, then it can be
extended as a partial limit curve.    To clarify this last point, suppose that $\t\gamma$ is a partial limit curve that is extendible as a curve.   This in particular
means that it is possible to add to $\t\gamma$
a future endpoint $p$. 
 As the curves $\gamma_i$ are causal curves that converge to $\t\gamma$ everywhere in the past of $p$,
and as causality prevents the $\gamma_i$ from having wild fluctuations near $p$, the $\gamma_i$ also converge to $\t\gamma$ at $p$.  (Essentially this argument
was the starting point in section \ref{classic}.)  If the point $p$ is in $S$, then we have found a convergent subsequence of the original sequence $\{\gamma_i\}$, showing that $\CC_q^S$ is compact.
Otherwise,   arguing as in  section \ref{cpct}, 
 we learn that a subsequence of the $\gamma_i$ converges to $\t\gamma$ also to the future of $p$, at least for a limited time.  
 
Thus we can keep improving partial limit curves to find better ones that reach closer to $\S$.  But to finish a proof along these lines is still tricky.  

Let $\L$ be the set of all partial limit curves of the $\gamma_i$.   If $\t\gamma,\t\gamma'\in\L$, we say that $\t\gamma<\t\gamma'$ if $\t\gamma'$ is an extension of $\t\gamma$.
This defines a partial order on $\L$.   It is only a partial order, because in general if $\t\gamma,\t\gamma'\in\L$, neither one is an extension of the other.

\def\W{{\mathcal W}}
A {\it chain} is a subset $\W$ of $\L$ that is totally ordered, meaning that if $\t\gamma,\t\gamma'\in\L$ (and $\t\gamma\not=\t\gamma'$), then one of them is an extension of the other, so that either $\t\gamma<\t\gamma'$
or $\t\gamma'<\t\gamma$.   If $\W$ is a chain, then we can define a future-going causal curve $\bar\gamma$ from $q$ by simply taking the union of all $\t\gamma\in \W$.
We will show in a moment that $\bar\gamma$ is a partial limit curve.    In this case, since every $\t\gamma\in \W$ is contained in $\bar\gamma$, any such $\t\gamma$ obeys
$\t\gamma< \bar\gamma$ (or $\t\gamma=\bar\gamma$), so that $\bar\gamma$ is an ``upper bound'' for the chain $\W$.

An abstract statement of set theory known as Zorn's Lemma\footnote{Zorn's Lemma is equivalent to the Axiom of Choice. To some, it is an essential
part of the foundations of mathematics. To others, it is an unnecessary adornment.}
 asserts that if $\L$ is a partially ordered set in which every chain has an upper bound, then $\L$ has a maximal
element $\gamma^*$.   In the present context, a maximal element of $\L$ is a partial limit curve $\gamma^*$ that is inextendible as a partial limit curve.   But this means that $\gamma^*$
is actually inextendible as a curve (since we have seen that if a partial limit curve can be extended as a curve, then it can be extended as a partial limit curve).   Now we invoke
the assumption that $M$ is globally hyperbolic.    As $q$ is to the past of $M$ and $\gamma^*$ is an inextendible future-going causal curve from $q$, it meets $\S$ and so defines
a point in $\CC_q^\S$.  Thus any sequence $\gamma_1,\gamma_2,\cdots\in \CC_q^S$ has a subsequence that converges to $\gamma^*\in \CC_q^\S$;
in other words, $\CC_q^\S$ is compact.

To complete this argument, we need to justify the claim that $\bar\gamma$ is a partial limit curve.   Since it has no future endpoint,  $\bar\gamma$ is isomorphic topologically to the
semi-open interval $[0,1)$; pick a specific isomorphism.   As
 $\bar\gamma$ is the union of the curves in the totally ordered set $\W$, there is a sequence $\ell_1,\ell_2,\cdots \in \W$ whose union is $\bar\gamma$.  If one of the $\ell_i$ equals $\bar\gamma$,
 we are done.   Otherwise,
after possibly passing to a subsequence, we can assume that the image of the closed interval $[0,1-1/n]$ is contained in $\ell_n$ for every positive integer $n$.   Pick an arbitrary Euclidean signature metric
 $h$ on $M$,
and for any positive integer $n$, let $\Phi_n$ be the subset
of the original sequence $\gamma_1,\gamma_2,\cdots$ consisting of curves that are everywhere within a Euclidean distance $1/n$ of $\bar\gamma$ over the whole interval $[0,1-1/n]$.
Each $\Phi_n$ is nonempty, since each $\ell_n$ is a partial limit curve.   Let $\gamma'_1,\gamma'_2,\cdots $ be a subsequence of the original sequence $\gamma_1,\gamma_2,\cdots$
such that $\gamma'_n\in \Phi_n$ for all $n$.   Then $\gamma'_1,\gamma'_2,\cdots $ is a subsequence of the original sequence that converges to $\bar\gamma$ everywhere,
so $\bar\gamma$ is a partial limit curve.  


\def\SS{{\sf S}}
\def\BB{{\sf B}}
As Wald notes (see the footnote on p. 194 of \cite{Wald}), one would prefer not to base a concrete statement of physics on subtleties of set theory and assumptions
about the foundations of mathematics unless this becomes unavoidable.   
The following, adapted from \cite{BEE}, is one way to avoid\footnote{The fundamentals of calculus might depend on Zorn's Lemma, depending on one's point of view.  Still it seems that the use of Zorn's Lemma in the argument  just described is the sort of thing that one would wish to avoid.}   Zorn's Lemma.
Pick again a Riemannian metric $h$ on $M$, that is a metric of Euclidean signature.   
After possibly making a conformal rescaling of $h$ by a factor that blows up at infinity in a suitable fashion,
one can assume that the metric $h$ is complete \cite{NO}.   (For the  proof, see Appendix \ref{moredetail}.)   Let now $q$ be any point in $M$.   Because the metric $h$ on $M$ is complete, any point $p\in M$ is connected to $q$
by a geodesic of the shortest possible length.\footnote{Let $b$ be the greatest lower bound of the lengths of paths from $p$ to $q$ and let $\gamma_1,\gamma_2,\cdots $ be
a sequence of paths from $p$ to $q$ whose lengths approach $b$.  In a complete Euclidean signature metric, a subsequence of $\gamma_1,\gamma_2,\cdots$ will
converge to a geodesic from $p$ to $q$ of the minimum possible length $b$.} The length of this geodesic gives a function $f(p)$.    The generalized sphere $\SS_\rho\subset M$ consisting of points with $f(p)=\rho$ is always
compact.\footnote{A geodesic $\ell$ (in the metric $h$) that originates at $q$ is determined by its initial direction, which takes values in an ordinary sphere $\SS$, which is certainly compact.
Mapping $\ell$ to the point on $\ell$ whose arclength from $q$ is $\rho$ gives a continuous and surjective map from $\SS$ to $\SS_\rho$, showing that $\SS_\rho$ is compact.   This argument has been stated assuming that
every geodesic is length-minimizing up to distance $\rho$.   If not, before making this argument, one replaces
$\SS$ by its compact subset consisting of initial directions of geodesics that are length-minimizing up to that
distance.}   Likewise, the generalized ball $\BB_\rho\subset M$ consisting of points with $f(p)\leq \rho$ is compact.   

Now let $\gamma_1,\gamma_2,\cdots $ be any sequence of inextendible curves that originate at $q\in M$.  (For the moment, there is no need to assume that the $\gamma_i$ are causal
curves in the Lorentz signature metric of $M$, or that $M$ is globally hyperbolic.)   Because the Riemannian metric of $M$ is complete and the $\gamma_i$ are inextendible, they
all have infinite length in the Riemannian metric.   We parametrize them by their Riemannian arclength $t$, which runs over the full range $[0,\infty)$.   If we restrict the $\gamma_i$
to $t\leq 1$, they are contained in the compact set $\BB_1$.   Therefore, by the argument explained in section \ref{classic}, the $\gamma_i$ have a subsequence $\gamma_{i,1}$ that
converges for $t\leq 1$.   Similarly, for $t\leq 2$, the $\gamma_{i,1}$ are contained in $\BB_2$, so they have a subsequence $\gamma_{i,2}$ that converges for $t\leq 2$.    Continuing this way, we define for every positive
integer $n$ a subsequence $\gamma_{i,n}$ of a previously defined sequence $\gamma_{i,n-1}$, such that $\gamma_{i,n}$ converges for $t\leq n$.   Then the ``diagonal sequence''
$\gamma_{1,1},\gamma_{2,2},\cdots$ is a subsequence of the original sequence $\gamma_1,\gamma_2,\cdots$ that converges for all $t\geq 0$.    Thus we have shown, with no assumption
about causality or Lorentz signature, that every sequence $\gamma_1,\gamma_2,\cdots$
 of inextendible curves from $q$ has a subsequence that converges to a limit curve $\bar\gamma$.   Moreover, $\bar\gamma$
has infinite Euclidean length, like the $\gamma_i$, so it is inextendible.  

Now let us remember the Lorentz signature metric of $M$.   If the $\gamma_i$ are causal curves, then, as a limit of causal curves, $\bar\gamma$ is also causal.  If the $\gamma_i$
are future-going curves from a point $q\in M$, then $\bar\gamma$ is also a future-going curve from $q$.  If $M$ is globally hyperbolic and $q$ is to the past of a Cauchy hypersurface 
$\S$, then $\bar\gamma$
 intersects $\S$ somewhere.   Thus, $\bar\gamma$ is the desired limit of a subsequence of the $\gamma_i$, and  we learn again that the space of causal curves from $q$ to $\S$ is compact.

We can also use this second argument as the starting point to show that globally hyperbolic spacetimes are strongly causal, as claimed in section \ref{causality}. (We cannot use the first
argument for this purpose, since strong causality was assumed at the outset in section \ref{cpct}.)    Let $M$ be a globally hyperbolic
spacetime with Cauchy hypersurface $\S$.   Let $q$ be a point to the past of $\S$.
 A point to the future of $\S$ can be treated similarly; later, we consider the case $q\in \S$.   If strong causality
is violated at $q$, this means that there are sequences of points $p_1,p_2,\cdots$ and $p'_1,p'_2,\cdots$, with both sequences converging to $q$, and future-directed causal curves $\gamma_i$
from $p_i$ to $p'_i$, which make large excursions away from $q$ even though the $p_i$ and $p'_i$ are near $q$.   The precise meaning of ``large excursions'' is that a sufficiently 
small open set $U$ containing $q$ does not contain the curves $\gamma_i$, for large $i$.  
After possibly discarding the first few pairs of points, we can
assume that the points $p_i$ and $p'_i$ are all to the past of $\S$, and therefore that the curves $\gamma_i$ are to the past of $\S$.   

We consider two cases: (1) the arclengths of the curves $\gamma_i$
in the complete Riemannian metric introduced earlier are bounded; (2) those arclengths are unbounded.
In case (1), the curves $\gamma_i$ are all contained in a generalized ball $\BB_N$, for sufficiently large $N$.    $\BB_N$ is compact and the $\gamma_i$ are causal, so reasoning
as before, we find that a subsequence of the $\gamma_i$ converges to a causal curve $\bar\gamma$.    Since the sequences $\{p_i\}$
and $\{p'_i\}$ both converge to $q$, $\bar\gamma$ is a closed causal curve from $q$ to itself. ($\bar\gamma$ is a nontrivial closed causal curve, not
just consisting of the single point $q$, since there is an open neighborhood
$U$ of $q$ that does not contain the $\gamma_i$, for large $i$.)    In a globally hyperbolic spacetime, this is not possible.

In case (2), after possibly passing to a subsequence, we can assume that, for all $k\geq 1$,  the curve $\gamma_k$ has Euclidean arclength at least $k$.   We parametrize
the $\gamma_k$ by the Euclidean arclength $t$, with $t=0$ corresponding to the past endpoint $p_k$.    Arguing as before, if we restrict the $\gamma_k$ to $0\leq t\leq 1$,
then a subsequence $\{\gamma_{k,1}\}$ of the sequence $\{\gamma_k\}$ converges to a limit curve $\bar \gamma_1$.  $\bar\gamma_1$ is a future-going causal curve that originates at $q$, since the $p_k$ converge to $q$.
 Restricting to $0\leq t\leq 2$, a subsequence \{$\gamma_{k,2}\}$ of the sequence $\{\gamma_{k,1}\}$
converges on the interval $0\leq t\leq 2$ to a limit curve $\bar\gamma_2$ that is an extension of $\bar\gamma_1$. It is again a future-going causal curve from $q$.
   Continuing in this way, at the $n^{th}$ step, we define a subsequence $\{\gamma_{k,n}\}$
of $\{\gamma_{k,n-1}\}$ that converges for $0\leq t\leq n$ to a limit curve $\bar\gamma_n$ that is an extension of $\bar\gamma_{n-1}$.   All of the $\bar\gamma_{n}$ are future-going causal
curves from $q$ and each one is an extension of the previous one.   Each one is in the past of $\S$, since the original curves $\gamma_k$ are all in the past of $\S$.    The diagonal sequence
whose $n^{th}$ element is $\gamma_{n,n}$ converges to a limit curve $\bar\gamma$ that is the union of the $\bar\gamma_n$.    $\bar\gamma$ is to the past of $\S$, since all of the $\bar\gamma_n$ are.
$\bar\gamma$ is inextendible, since the Euclidean arclength of the curve $\bar\gamma_n$ diverges for $n\to\infty$.   Thus we have found, from a point $q$ to the past of $\S$, an inextendible
future-going causal curve that remains forever to the past of $\S$.   In a globally hyperbolic spacetime, this is not possible.

The reader might want to consider the example (\ref{vunxo}) of a spacetime that has no closed causal curves, but violates strong causality, to see how case (2) comes about.   Taking $q$ to
be a point at $v=0$, describe
suitable pairs $p_i$, $p'_i$ and corresponding causal curves $\gamma_i$, and try to identify the inextendible causal curve $\bar\gamma$  that will arise from this construction.


Finally, we have to consider the case that $q\in \S$.   By displacing $\S$ slightly forward in time in a local Minkowski neighborhood of $q$, we can replace it with a different Cauchy hypersurface
$\S'$ that does not contain $q$, and thus reduce to the previous case.

\section{Geometry Of A Null Hypersurface}\label{null}

In section \ref{nullraych}, we showed that a hypersurface $Y$ that is swept out by orthogonal null geodesics from some codimension 2 spacelike submanifold $W$ is null, that is its metric has signature 
$+ + \cdots +0$.  This statement has a rather surprising converse, which will be explained here.
Let $Y$ be any null hypersurface, that is any hypersurface of signature $+ + \cdots + 0$, in a spacetime $M$. Let $K^\mu$ be a vector field that is tangent to $Y$ and null.
In view of the signature of $Y$, if $Z^\mu$  is any vector field tangent to $Y$, then 
\be\label{zoff} g_{\mu\nu}K^\mu Z^\nu = 0.\ee
These conditions do not determine $K$ uniquely, as we may transform \be\label{delbo}K^\mu\to e^f K^\mu\ee
for any real-valued function $f$  on $Y$.

The integral curves of $K$ are the null curves found by solving the equation $\frac{\d X^\mu}{\d s}=K^\mu(X(s))$, 
 with some choice of an initial point on $Y$. Note that if one transforms $K$ as in eqn. (\ref{delbo}), this simply leads to a reparametrization of the integral curves.
  We want to show that the integral curves are null geodesics. Every point in $Y$ lies on a unique integral curve, so this will give a family of null geodesics with each point in $Y$ contained in a unique member of the family. One describes this by saying that $Y$ is  ``ruled by null geodesics.''

To show that the integral curves are geodesics, it suffices to show that
\be\label{zon}K^\mu D_\mu K^\nu = w K^\nu,\ee
for some function $w$.  
 For then, by a transformation $K^\mu\to e^f  K^\mu$, we can reduce to the case that
\be\label{plon} K^\mu D_\mu K^\nu = 0,\ee
which is equivalent to the geodesic equation for the integral curves.


For $p\in Y$, let $TM|_p$ be the tangent space to $p$ in $M$, and let $TY|_p$ be the tangent space to $p$ in $Y$. A vector in $TM|_p$ is a multiple of $K$ if and only if it is orthogonal to $TY|_p$. So to verify eqn. (\ref{zon})  at $p$, it suffices to show that if $Z$ is any vector in $TY|_p$, then
\be\label{lfelgo} g_{\alpha\beta} (K^\mu D_\mu K^\alpha) Z^\beta  = 0\ee at $p$. We extend $Z$ away from $ p$ in an arbitrary fashion, requiring only that it is tangent to $Y$ . Then $K$
and $Z$ are both vector fields tangent to $Y$, so their commutator, which is 
\be\label{pleffo} Q^\alpha = K^\mu D_\mu Z^\alpha - Z^\mu D_\mu K^\alpha,\ee
is also tangent to $Y$ . So eqn. (\ref{zoff}) holds if $Z$ is replaced by $Q$:
\be\label{izoff} g_{\mu\nu}K^\mu Q^\nu = 0.\ee



Differentiating eqn. (\ref{zoff}), we get
\be\label{droff} 0=K^\mu D_\mu(g_{\alpha\beta}K^\alpha Z^\beta)= g_{\alpha\beta}(K^\mu D_\mu K^\alpha) Z^\beta +g_{\alpha\beta}K^\alpha K^\mu D_\mu Z^\beta.\ee
But the last term on the right hand side vanishes, since
\be\label{miroof} g_{\alpha\beta}K^\alpha K^\mu D_\mu Z^\beta=g_{\alpha\beta}K^\alpha Q^\beta+\frac{1}{2}Z^\mu D_\mu(g_{\alpha\beta}K^\alpha K^\beta)=0, \ee
where we use the fact that $Q$ satisfies eqn. (\ref{izoff})  and $K$ is everywhere null. Thus eqn. (\ref{droff})  is equivalent to the desired result (\ref{lfelgo}).


If $W$ is any spacelike surface that is of codimension 1 in $Y$, then the integral curves are orthogonal to $W$ and so $Y$ is ruled by 
a family of null geodesics that are orthogonal to $W$, the situation considered in section \ref{nullraych}.



\section{How Promptness Fails}\label{failure}

Let $\gamma$ be a future-going null geodesic that originates at a point $q$ in a globally hyperbolic spacetime $M$.    As explained in section \ref{prompt}, in a strongly causal spacetime, an initial segment
of $\gamma$ is prompt.   It may be that $\gamma$ remains prompt no matter how far it is continued into the future.   Otherwise, the prompt portion of $\gamma$ is
an initial segment.   Let $p$ be the endpoint of this segment.    We would like to know what is happening at $p$.  An analogous question concerns the case that $\gamma$ is a null geodesic
orthogonal to a compact codimension 2 spacelike surface $W$.   These questions have been analyzed respectively in  \cite{Ehr} and \cite{ab}.    We will sketch the arguments, starting with the case of 
geodesics that originate at a specified point $q$.



Let $p_1,p_2,\cdots$ be a sequence of points that are to the future of $p$ along $\gamma$, and approach $p$.   The segment $qp_i$ of $\gamma$ is non-prompt for each $i$, so there
exists a strictly timelike curve $\gamma_i$ from $q$ to $p_i$.   In a globally hyperbolic spacetime, we can choose the $\gamma_i$ to maximize the elapsed proper time, and thus
they are timelike geodesics.    Moreover, after possibly passing to a subsequence, we can assume that the $\gamma_i$ converge to a causal curve $\bar\gamma$
from $q$ to $p$.  There are two cases: (1) $\bar\gamma\not=\gamma$; (2) $\bar\gamma=\gamma$.

In case (1), $\bar\gamma$ is a null geodesic, since otherwise it could be deformed to a causal path from $q$ that arrives to the past of $p$, implying that $\gamma$ does not remain prompt
up to $p$.   So case (1) means that at the point $p$, $\gamma$ intersects a second null geodesic that also originates at $q$.  This is perfectly possible.   For example, when gravitational
lensing produces multiple images of the same supernova explosion, there will be some observers who see the first two  images  appear simultaneously.  Note that in case (1), the geodesic
$\gamma$ is always nonprompt when continued to any point $p'$ that is beyond $p$, because by going from $q$ to $p$ along $\bar\gamma$ and then from $p$ to $p'$ along $\gamma$, one gets
a causal path from $q$ to $p'$ that is not a null geodesic.   We leave it to the reader to verify that in case (1), $\bar\gamma$ is also prompt up to $p$, but no farther.

We want to show that case (2) is the main failure mode that has been studied in this paper: it means that to first order, there is a null geodesic deformation of the segment $qp$,
or in other words there is a Jacobi field along $\gamma$ that vanishes at $q$ and $p$.  

To do this, we will construct a convenient set of $\D$ functions on $M$, and ask if they are a good set of coordinates in a small neighborhood of $p$.   We will make use of the Fermi normal coordinates of eqn. (\ref{kofflox}),
with $\gamma$ being the usual geodesic $V=X^A=0$, and $q$ the point $U=0$ on this geodesic.  We consider the geodesic equation with affine parameter $\lambda$
\be\label{uncup} \frac{D^2 X^\mu}{D\lambda^2}=0 .\ee
Thus $\gamma$ is the solution $U=\lambda$, $V=X^A=0$.  If we expand $U=U+\veps u$, $V=\veps v$, $X^A=\veps x^A$, then to first order in $\veps$, the equation of geodesic deviation gives
just
\be\label{wuncup} \frac{\d^2 v}{\d\lambda^2}=0. \ee  There is no curvature term here, because along $\gamma$, $R^V{}_{UAU}=R_{UUAU}=0$.   
(In section \ref{igd}, we did not consider this equation, because we considered only null deformations that were constrained to have $v=0$.)

We consider the geodesic equation (\ref{uncup}) with the initial conditions
\begin{align}\label{guncup} U(0)=V(0)=X^A(0)& = 0 \cr
 \left.\frac{\d U}{\d\lambda}\right|_{\lambda=0}&=1  \cr
\left. \frac{\d V}{\d\lambda}\right|_{\lambda=0}&= \sv\cr
 \left.\frac{\d X^A}{\d\lambda}\right|_{\lambda=0}&=\sx^A. \end{align}
The geodesic with $\sv=\sx^A=0$ is the original $\gamma$, and reaches the point $p$ at some value $\lambda=\lambda_1$.  We map a triple $\lambda, \sv, \sx^B$ to the point with coordinates
 $V(\lambda;\sv,\sx^B)$, $U(\lambda;\sv,\sx^B)$, $X^A(\lambda;\sv,\sx^B)$, where those functions are determined by solving the geodesic equation with the initial conditions (\ref{guncup}).
   We ask whether $\lambda, \sv, $ and $\sx^B$ are a good set of coordinates for $M$ in a neighborhood of $p$, that is in a neighborhood
of $(\lambda,\sv, \sx^B)=(\lambda_1,0,0)$, which corresponds to $p$.

In case (2), the answer to this question is ``no,'' because of the following facts.  For each $i$, $\gamma$ and $\gamma_i$ are two different geodesics from $q$ to $p_i$. 
As the $\gamma_i$ converge to $\gamma$ for $i\to\infty$, the initial conditions of $\gamma_i$ converge for large $i$  to the initial conditions $\sv=\sx^B=0$ of $\gamma$.  Likewise, the
affine parameter at which $\gamma_i$ reaches $p_i$  converges to the corresponding value for $\gamma$.   Thus there are pairs of triples $(\lambda,\sv,\sx^B)$ that are arbitrarily
close to each other and to $(\lambda_1,0,0)$ and represent the same point in $M$; hence there is no neighborhood of $(\lambda_1,0,0)$ in which $(\lambda,\sv,\sx^B)$ are good coordinates.

On the other hand, in general, suppose that $X^\mu,~\mu=1,\cdots,\D$ are a good set of coordinates on a manifold 
$M$ in a neighborhood of a point $p$, and that we parametrize them by variables $f^\alpha,\,
\alpha=1,\cdots ,\D$,
specifying $X^\mu=X^\mu(f^\alpha)$ as smooth functions of the $f^\alpha$.   
The condition for the $f^\alpha$ to be a good set of coordinates on $M$ in
a neighborhood of  $p$ is that $\Delta=\det \partial X^\mu/\partial f^\alpha$ is nonzero at  $p$.    Let us compute this
determinant for the case that the $X^\mu$ are $(U,V,X^A)$, the $f^\alpha$ are $(\lambda,\sv,\sx^B)$, and $p$ is the point $(\lambda_1,0,0)$.

First of all, at $p$, we have 
\be\label{govo}\frac{\partial V}{\partial \sv}\not=0, ~~~~~~\frac{\partial V}{\partial\lambda}=\frac{\partial V}{\partial \sx^A}=0, \ee
Eqn. (\ref{govo}) is true because equation (\ref{wuncup}) together with the initial conditions give simply $V=\lambda \sv$ to first order in $\sv$ and $\sx^B$.   So at $p$, $\partial V/\partial \sv\not=0$
and the other derivatives of $V$ vanish.
Therefore, the determinant $\Delta$ vanishes at $p$ if and only if a reduced determinant with $V$ and $\sv$ omitted vanishes at $p$.
  In other words, we can set $V=\sv=0$, and take  the $X^\mu$ to be just $U$ and $X^A$ and the $f^\alpha$ to be just $\lambda$ and $\sx^B$. 

Similarly, at $\sx^B=0$, we have 
\be\label{lovo} \frac{\partial U}{\partial\lambda}=1, ~~~\frac{\partial X^A}{\partial\lambda}=0, \ee
since the solution of the geodesic equation with $\sv=\sx^B=0$ is $U=\lambda$, $V=X^A=0$.    This means that the original determinant $\Delta$ vanishes if and only
if a reduced determinant vanishes in which we consider only $X^A$ and $\sx^B$, at $\sv=0$, $\lambda=\lambda_1$.


In other words, the condition for vanishing of $\Delta$ is that
\be\label{wackor}\left.\det\frac{\partial X^A(\lambda_1,0,\vec \sx)}{\partial \sx^B}\right|_{\vec\sx=0} =0 .\ee
But the vanishing of this determinant is equivalent to the existence of a Jacobi field on the interval $[0,\lambda_1]$ that vanishes at the endpoints of the interval.  Indeed, vanishing of the determinant of
 a matrix
means that some linear combination of its columns vanishes, say
\be\label{ackor}\sum_B\left.\frac{\partial X^A(\lambda_1,0,\vec\sx)}{\partial \sx^B}\right|_{\vec \sx=0}c^B =0 ,\ee
with constants $c^B$.   If we set $\sx^A=\veps c^A,\,\sv=0$ in eqn. (\ref{guncup}), then to first order in $\veps$, the solution of the geodesic equation will be a Jacobi field that vanishes
at $\lambda=0$ because of the initial conditions  and at $\lambda=\lambda_1$ because of eqn. (\ref{ackor}).

One can study in a similar way a timelike, rather than null, geodesic $\gamma$ from a point $q$.   A short initial segment of $\gamma$ maximizes the elapsed proper time.  As $\gamma$ is continued
into the future, it may fail to be proper time maximizing beyond some point $p$. An argument similar to what we have just described shows that for
 this to happen, either $\gamma$ meets at $p$ another timelike geodesic from $q$ with the same proper time,
or there is a Jacobi field on $\gamma$ that vanishes at $q$ and at $p$, so that $p$ is a focal point of the timelike geodesics from $q$.


Now let us consider the case of a null geodesic $\gamma$ that is orthogonal to a compact codimension 2 spacelike surface $W$ \cite{ab}.   Again, if $\gamma$ does not remain prompt indefinitely,
we define $p$ as the future boundary of the largest prompt segment of $\gamma$, and consider a sequence of points $p_i\in\gamma$ that approach $p_i$ from the future.   The $p_i$ can
now be reached from $W$ by timelike geodesics $\gamma_i$ that are orthogonal to $W$.   After possibly passing to a subsequence, we can assume that the $\gamma_i$ converge 
to an orthogonal null geodesic
$\bar\gamma$ from $W$ to $p$.  We have the same alternatives as before: (1) $\bar\gamma\not=\gamma$; (2) $\bar\gamma=\gamma$. Case (1) now means that there is some other orthogonal
null geodesic $\bar\gamma$ from $W$ to $p$.    This is perfectly possible, and when it happens, $\gamma$ is not prompt when continued beyond $p$.  (Moreover, $\bar\gamma$ is prompt up to
$p$ and no farther.)   


As before, case (2) is the main failure mode that has been studied in this paper.   To show this, one repeats the previous argument, now with different initial conditions on the geodesics.
As before, let $\gamma$ be the geodesic $U=\lambda$, $V=X^A=0$,
 and suppose that as in section \ref{ong}, $W$ is described near $\gamma$ by $V=f(X^A)$,  $U=h(X^A)$ where $f$ and $h$ vanish near $X^A=0$ up to second order.   Thus
$\gamma\cap W$ is the point $q$ with $U=0$.    Now we introduce a $(\D-1)$-parameter
family of geodesics orthogonal to $W$.   For initial conditions on these geodesics, we take
\be\label{unv} X^A(0)=\sx^A,~~V(0)=f(\sx^A),~~ U(0) = h(\sx^A), \ee
so that the geodesics originate on $W$ at $\lambda=0$.    We also set
\be\label{punv}\left. \frac{\partial U}{\partial \lambda}\right|_{\lambda=0}=1,  ~~~\left.\frac{\partial V}{\partial \lambda}\right|_{\lambda=0}=\zeta, \ee
where $\zeta$ is a free parameter, and constrain $\d X^A/\d\lambda|_{\lambda=0}$ so that the geodesics in this family are orthogonal to $W$.
Similarly to (\ref{onoogo}), except that now we have to include $\zeta$, the  condition of orthogonality is
\be\label{lunv}\left.\frac{\d  X^A}{\d\lambda}\right|_{\lambda=0} -\partial_A  f(\sx)-\zeta \,\partial_A h(\sx)=0. \ee
We now ask whether we can use $\sx^A$, $\zeta$, and $\lambda$ as a good set of coordinates near $p$.   For the same reason as before, the answer is ``no'' in case (2).   On the other hand,
an analysis similar to the previous one shows that a ``no'' answer to this question means that there is a Jacobi field along $\gamma$ that obeys the boundary
condition at $q$ and vanishes at $p$, or in other words
that $p$ is a focal point for the null geodesics orthogonal to $W$. 


An analog of this problem for timelike geodesics is to consider a future-going timelike geodesic $\gamma$ orthogonal to a codimension 1 spacelike surface $S$.    A short initial segment of $\gamma$
maximizes the elapsed proper time to its endpoint.    If this fails when $\gamma$ is continued into the future, let $p$ be the endpoint of the maximal segment on which $\gamma$ is proper time
maximizing.   Then either there is a second timelike orthogonal geodesic $\bar\gamma$ from $S$ to $p$, with the same proper time as $\gamma$, or there is a Jacobi field along $\gamma$
that preserves the orthogonality at  $\gamma\cap S$ and vanishes at $p$, so that $p$ is a focal point of the orthogonal timelike geodesics from $S$.

\end{appendix}



 
\vskip1cm
\noindent{\it Acknowledgments}

Lectures on some of this material were  presented at the 2018 summer program Prospects in Theoretical Physics
 at the Institute for Advanced Study in Princeton, NJ, and the January, 2020 summer
school of the New Zealand Mathematical Research Institute (NZMRI), held in Nelson, New Zealand.  Both audiences provided useful feedback.
 The NZMRI summer school lectures were  supported  by the Clay Mathematical Institute.
Research was also supported in part by NSF Grant PHY-1606531.  I thank G. Galloway, A. Kar, R. Wald, and A. Wall   for helpful 
comments and suggested improvements and for pointing out useful references, M. Turansick for assistance with the manuscript, and Tong Chen and  Zi-hao Li for pointing out some typographical errors.
\bibliographystyle{unsrt}
\begin{thebibliography}{99}

\bibitem{Penrose}
R. Penrose, {\it Techniques Of Differential Topology in Relativity} (SIAM, 1972).

\bibitem{HawkingEllis} S. W. Hawking and G. F. R. Ellis, {\it The Large Scale
Structure Of Space-Time} (Cambridge University Press, 1973).

\bibitem{Wald}
R. M. Wald, {\it General Relativity} (University of Chicago Press, 1984).


\bibitem{Chrusciel}
P. T. Chrusciel,  ``Elements Of Causal Theory,'' arXiv:1110.6706.

\bibitem{Galloway}
G. J. Galloway, ``Notes on Lorentzian Causality,'' available at 
\url{http://www.math.miami.edu/~galloway/vienna-course-notes.pdf}.

\bibitem{Aretakis}
S. Aretakis, ``Lecture Notes On General Relativity,'' available at \url{https://web.math.princeton.edu/~aretakis/columbiaGR.pdf}.

\bibitem{BEE}
J. K. Beem, P. E. Ehrlich, and K.  L. Easley, {\it Global Lorentzian Geometry}, second edition (CRC Press, 1996).


\bibitem{Hawkingsing}
S. W. Hawking, ``Singularities In The Universe,'' Phys. Rev. Lett. {\bf 17} (1966) 444-5.

\bibitem{Penrosesing}
R. Penrose, ``Gravitational Collapse And Spacetime Singularities,''  Phys. Rev. Lett. {\bf 14} (1965) 57.

\bibitem{Hawkingarea}
S. W. Hawking, ``Black Holes In General Relativity,'' Commun. Math. Phys. {\bf 25} (1972) 152-66.



\bibitem{topocensor}
J. L. Friedman, K. Schleich, and D. M. Witt, ``Topological Censorship,'' Phys. Rev. Lett. {\bf 71} (1993) 1486-9, arXiv:gr-qc/9305017.

\bibitem{topocensor2}
G. J. Galloway, K. Schleich, D. Witt, and E. Woolgar, ``The AdS/CFT Correspondence And Topological Censorship,''  Phys. Lett. {\bf B505} (2001) 255-62,  hep-th/9912119.

\bibitem{Gao-Wald}
S. Gao and R. M. Wald, ``Theorems on Gravitational Time Delay And Related Issues,'' 
Class. Quant. Grav. {\bf 17} (2000) 4999-5008, arXiv:gr-qc/0007021.

\bibitem{CG}
Y. Choquet-Bruhat and R. Geroch, ``Global Aspects of the Cauchy Problem in General Relativity,''
Comm. Math. Pys. {\bf 14} (1969) 329-35.

\bibitem{Geroch}
R. Geroch, ``Domain of Dependence,'' J. Math. Phys. {\bf 11} (1970) 437-49.

\bibitem{NO} K. Nomizu and H. Ozeki, ``The Existence of Complete Riemannian Metrics,''  Proc. Am. Math. Soc. {\bf 12} (1961) 889-91.

\bibitem{Leray}
J. Leray, ``Hyperbolic Partial Differential Equations'' (mimeographed notes, Institute for Advanced Study, 1952).  


\bibitem{MTW}
C. W. Misner, K. S. Thorne, and J. A. Wheeler, {\it Gravitation} (W. H. Freeman and Co., 1970).


\bibitem{Jost}
J\"{u}rgen Jost, {\it Riemannian Geometry and Geometric Analysis}, seventh edition (Springer, 2011).

\bibitem{Raychaudhuri}
A. Raychaudhuri, ``Relativistic Cosmology,'' Phys. Rev. {\bf 98} (1955) 1123.

\bibitem{sachs}
R. K. Sachs, ``Gravitational Waves In General Relativity, 6.   The Outgoing Radiation Condition,'' Proc. Roy. Soc. Lond. {\bf A64} (1961) 309-38.

\bibitem{Sachstwo}
R. K. Sachs, ``On The Characteristic Initial Value Problem In Gravitational Theory,'' J. Math. Phys. {\bf 1} (1962) 908.

\bibitem{PenroseA}
R. Penrose, ``Gravitational Collapse: The Role Of General Relativity,'' Riv. Nuovo Cimento {\bf 257} (1969) 1141-65.

\bibitem{PenroseB}
R. Penrose, ``Naked Singularities,'' Ann. NY Acad. Sci. {\bf 224} (1973)   125-34.

\bibitem{Penrose\S}
R. Penrose, ``The Question Of Cosmic Censorship,'' J. Astrophys. Astr. {\bf 20} (1999) 233-48.

\bibitem{GerochHorowitz}
R. Geroch and G. T. Horowitz, ``Global Structure Of Spacetimes,''   in S. W. Hawking and W. Israel, eds., {\it General Relativity: An Einstein Centenary Survey} (Cambridge University Press, 1979)
pp.  212-293.


\bibitem{Witten}
E. Witten, ``Instability of the Kaluza-Klein Vacuum,'' Nucl. Phys. {\bf B195} (1982) 481-92.

\bibitem{GLa}
R. Gregory and R. Laflamme, ``Black Strings and $p$-Branes Are Unstable,'' Phys. Rev. Lett. {\bf 70} (1993) arXiv:hep-th/9301052.

\bibitem{Pret}
L. Lehner and F. Pretorius, ``Final State of Gregory-Laflamme Instability,'' in {\it Black Holes In Higher Dimensions}, ed. G. Horowitz (Cambridge University
Press, 2012).

\bibitem{Pretorius}
F. Pretorius, ``Evolution of Binary Black Hole Spacetimes,'' Phys. Rev. Lett. {\bf 95} (2005) 121101, gr-qc/0507014.



\bibitem{GJW}
P. Gao, D. Jafferis, and A. Wall, ``Traversable Wormholes Via A Double Trace Deformation,'' JHEP {\bf 12} (2017) 151, arXiv:1608.05687.

\bibitem{MMP}
J. Maldacena, A. Milekhin, and F. Popov, ``Traversable Wormholes In Four Dimensions,'' arXiv:1807.04726.

\bibitem{Tipler}
F. J. Tipler, ``Energy Conditions And Spacetime Singularities,'' Phys. Rev. {\bf D17} (1978)  2521.

\bibitem{WY}
R. Wald and U. Yurtsever, ``General Proof of the Averaged Null Energy Condition For A Scalar Field In Two-Dimensional Curved Spacetime,''
Phys. Rev. {\bf D44} (1991) 403.

\bibitem{PSW}R. Penrose, R. Sorkin, and E. Woolgar, ``A Positive Mass Theorem Based On The Focusing and Retardation Of Null Geodesics,''  gr-qc/9301015.

\bibitem{GO}
N. Graham and K. D. Olum, ``Achronal Averaged Null Energy Condition,'' Phys. Rev. {\bf D76} (2007) 064001, arXiv:0705.3193.

\bibitem{FLPW}
T. Faulkner, R. G. Leigh, O. Parrikar, and H. Wang, ``Modular Hamiltonians For Deformed Half-Spaces And The Averaged Null Energy Condition,'' JHEP {\bf 09} (2016) 038, arXiv:1605.08072.

\bibitem{HKT}
T. Hartman, S. Kundu, and A. Tadjini, ``Averaged Null Energy Condition From Causality,'' JHEP {\bf 07} (2017) 066, arxiv:1610.05308.

\bibitem{KO}
E.-A. Kontou and K. D. Olum, ``Proof of the Averaged Null Energy Condition in a Classical Curved Spacetime Using A Null-Projected
Quantum Inequality,'' Phys. Ref. {\bf D92} (2015) 124009, arXiv:1507.00297. 

\bibitem{Ciccone}C. Ciccone and P. Ehrlich, ``Line Integration Of Ricci Curvature And Conjugate Points In Lorentzian and Riemannian Manifolds,''
Manuscripta Math. {\bf 31} (1980) 297-316.

\bibitem{Borde}A. Borde, ``Geodesic Focusing, Energy Conditions, and Singularities,'' Class. Quant. Grav. {\bf 4} (1987) 343-56.

\bibitem{MM}
F. K. Manasse and C. W. Misner, ``Fermi Normal Coordinates And Some Basic Concepts in Differential Geometry,'' J. Math. Phys. {\bf 4} (1963) 735-45.

\bibitem{Blau}
M. Blau, D. Frank, and S. Weiss, ``Fermi Coordinates And Penrose Limits,'' Class. Quantum Grav. {\bf 23} (2006) 3993, hep-th/0603109.

\bibitem{Overview}
O. Aharony, S. S. Gubser, J. M. Maldacena, H. Ooguri, and Y. Oz, ``Large $N$ Field Theories, String Theory, and Gravity,''
Phys. Rept. {\bf 323} (2000) 183-386, hep-th/9905111.

\bibitem{HP}
S. W. Hawking and R. Penrose, ``The Singularities of Gravitational Collapse and Cosmology,'' Proc. Roy. Soc. London {\bf A314} (1970) 529-48.



\bibitem{Galloway2}G. J. Galloway, ``Maximum Principles For Null Hypersurfaces And Null Splitting Properties,''  Ann. Henri Poincar\'{e} {\bf 1} (2000) 543-67, arXiv:math/9909158.



\bibitem{Ehr} J. K. Beem and P. E. Ehrlich, ``The Space-Time Cut Locus,'' Gen. Rel. Grav. {\bf 11} (1979) 89-103.

\bibitem{ab} C. Akers, R. Bousso, I. F. Halpern, and G. N. Remmen, ``The Boundary Of The Future,'' Phys. Rev. {\bf D97} (2018) 024018, arXiv:1711.06689.

\end{thebibliography}
\end{document}